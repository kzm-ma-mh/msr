{"instruction": "Fix the following bug: Docs: Corrected `RequestValidationError` inheritance detail", "input": "### What Changed\r\n\r\n- Corrected the documentation: `RequestValidationError` is *not* a subclass of Pydantic‚Äôs `ValidationError`.  \r\n- Updated the explanation to reflect that it inherits from `fastapi.exceptions.ValidationException`, making it a FastAPI-specific exception.  \r\n- Added context on why this matters, since they are different exception types, a handler for `ValidationError` won‚Äôt catch `RequestValidationError`.\r\n\r\n### Why This Matters\r\n\r\n- The previous docs were misleading: users might think that catching `ValidationError` will also capture request validation issues, which is incorrect.  \r\n- Because they‚Äôre distinct, developers need to explicitly register an exception handler for `RequestValidationError` if they want to customize handling of invalid client requests.  \r\n- This improves clarity about FastAPI‚Äôs validation behavior and prevents potential confusion or bugs in error-handling logic.\r\n\r\n### Related Issue\r\n\r\nCloses https://github.com/fastapi/fastapi/issues/10424\r\n\r\n**Note:**  \r\nThis PR targets **English docs only**. Please let me know if we need to update translations in other languages as well.", "output": "```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 618}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```", "output": "Bug: Docs: Corrected `RequestValidationError` inheritance detail\n\n### What Changed\r\n\r\n- Corrected the documentation: `RequestValidationError` is *not* a subclass of Pydantic‚Äôs `ValidationError`.  \r\n- Updated the explanation to reflect that it inherits from `fastapi.exceptions.ValidationException`, making it a FastAPI-specific exception.  \r\n- Added context on why this matters, since they are different exception types, a handler for `ValidationError` won‚Äôt catch `RequestValidationError`.\r\n\r\n### Why This Matters\r\n\r\n- The previous docs were misleading: users might think that catching `ValidationError` will also capture request validation issues, which is incorrect.  \r\n- Because they‚Äôre distinct, developers need to explicitly register an exception handler for `RequestValidationError` if they want to customize handling of invalid client requests.  \r\n- This improves clarity about FastAPI‚Äôs validation behavior and prevents potential confusion or bugs in error-handling logic.\r\n\r\n### Related Issue\r\n\r\nCloses https://github.com/fastapi/fastapi/issues/10424\r\n\r\n**Note:**  \r\nThis PR targets **English docs only**. Please let me know if we need to update translations in other languages as well.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 618}
{"instruction": "Review the following code changes: Docs: Corrected `RequestValidationError` inheritance detail", "input": "```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```\n\n```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n \n```", "output": "Code Review for: Docs: Corrected `RequestValidationError` inheritance detail\n\nüìù **docs/en/docs/tutorial/handling-errors.md**: ```suggestion\r\nThis behavior is intentional. If you have a validation error while building a *response* or anywhere else in your code (not in the client's *request*), it's actually a bug in your application code.\r\n\r\nAnd while you fix it, your clients/users shouldn't have access to internal information about the error, as that could expose a security vulnerability.\r\n```\n\nüìù **docs/en/docs/tutorial/handling-errors.md**: Code examples should be placed in separate files in `docs_src/tutorial` and covered by tests (`tests/turorial`)\n\nüìù **docs/en/docs/tutorial/handling-errors.md**: ```suggestion\r\n- Pydantic's <a href=\"https://docs.pydantic.dev/latest/concepts/models/#error-handling\" class=\"external-link\" target=\"_blank\">`ValidationError`</a> comes from `pydantic-core`.\r\n```\r\n\r\nSwap with prev. point and add \"`ValidationException` completely independent of `ValidationError`\"?\r\n\r\n<details>\r\n\r\n```\r\n- Pydantic's <a href=\"https://docs.pydantic.dev/latest/concepts/models/#error-handling\" class=\"external-link\" target=\"_blank\">`ValidationError`</a> comes from `pydantic-core`.\r\n- `RequestValidationError`, `WebSocketRequestValidationError`, and `ResponseValidationError` are FastAPI-specific exceptions that all inherit from `fastapi.exceptions.ValidationException`. They are completely independent of `ValidationError`.\r\n```\r\n\r\n</details>\r\n\nüìù **docs/en/docs/tutorial/handling-errors.md**: This is a bit misleading. It sounds like we can't set handler for `fastapi.exceptions.ValidationException` to handle all FastAPI validation exceptions\n\nüìù **docs/en/docs/tutorial/handling-errors.md**: Code examples should be in separate file and covered by tests\n\n", "source": "pr", "type": "code_review", "pr_number": 618}
{"instruction": "Review this code change in `docs/en/docs/tutorial/handling-errors.md`", "input": "```diff\n@@ -154,23 +154,73 @@ path -> item_id\n   value is not a valid integer (type=type_error.integer)\n ```\n \n-#### `RequestValidationError` vs `ValidationError` { #requestvalidationerror-vs-validationerror }\n+This only affects validation of incoming **request** data. It does not change how validation errors are handled for your `response_model` data or for other Pydantic validations that you perform in your own code.\n+\n+### Override response validation exceptions { #override-response-validation-exceptions }\n+\n+When you declare a `response_model`, **FastAPI** also validates the data returned by your *path operation* against that model. If the returned data doesn't conform to the declared schema, **FastAPI** raises a `ResponseValidationError` while building the response.\n+\n+By default, this is treated as an internal server error: the client receives an HTTP status code `500 Internal Server Error`, and the detailed validation errors are available in your server logs.\n+\n+This behavior is intentional. If you have a validation error while building a *response* or anywhere else in your code (not in the client's *request*), it's considered a bug in your application code, not an error from the client.\n\n```", "output": "```suggestion\r\nThis behavior is intentional. If you have a validation error while building a *response* or anywhere else in your code (not in the client's *request*), it's actually a bug in your application code.\r\n\r\nAnd while you fix it, your clients/users shouldn't have access to internal information about the error, as that could expose a security vulnerability.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 618}
{"instruction": "Fix the following bug: üêõ Fix request body mediatype for form model with `File` fields", "input": "Currently if form parameter model contains `File` field, the content mediatype for this path operation in openapi will be wrong:\r\n\r\n```py\r\nfrom fastapi import FastAPI, Form, File\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\nclass MyModel(BaseModel):\r\n    file_model: bytes = File()\r\n\r\n@app.post(\"/file-model\")\r\nasync def create_item(item: MyModel = Form()):\r\n    return {\"file_size\": len(item.file_model)}\r\n```\r\n\r\nRequest body content mediatype in openapi will be `application/x-www-form-urlencoded` instead of `multipart/form-data`:\r\n```json\r\n        \"requestBody\": {\r\n          \"content\": {\r\n            \"application/x-www-form-urlencoded\": {\r\n              \"schema\": {\r\n                \"$ref\": \"#/components/schemas/MyModel\"\r\n              }\r\n            }\r\n          },\r\n          \"required\": true\r\n        },\r\n```\r\n\r\nThis PR enforces the content mediatype to be `multipart/form-data` for form parameter models that contain at least one `File` field.\r\nI added `if request_media_type == \"application/x-www-form-urlencoded\"` condition to make it possible to override mediatype by passing a parameter to `Form`:\r\n\r\n```\r\n@app.post(\"/file-model\")\r\nasync def create_item(item: MyModel = Form(media_type=\"whatever\")):\r\n    ...\r\n```", "output": "```diff\n@@ -36,6 +36,14 @@ You can verify it in the docs UI at `/docs`:\n <img src=\"/img/tutorial/request-form-models/image01.png\">\n </div>\n \n+## Including `File` Fields { #including-file-fields }\n+\n+You can also include **file fields** inside a form model by using `UploadFile` or `bytes` as field types and annotating them with `File`.\n+\n+If there is at least one `File` field in the form model, **FastAPI** will automatically set the request content media type to `multipart/form-data` for this path operation.\n+\n+{* ../../docs_src/request_form_models/tutorial001b_an_py39.py hl[3,12,16] *}\n+\n ## Forbid Extra Form Fields { #forbid-extra-form-fields }\n \n In some special use cases (probably not very common), you might want to **restrict** the form fields to only those declared in the Pydantic model. And **forbid** any **extra** fields.\n@@ -75,4 +83,4 @@ They will receive an error response telling them that the field `extra` is not a\n \n ## Summary { #summary }\n \n-You can use Pydantic models to declare form fields in FastAPI. üòé\n+You can use Pydantic models to declare form fields - including file uploads - in FastAPI. üòé\n\n```\n\n```diff\n@@ -0,0 +1,19 @@\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: FormData = Form()):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,20 @@\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: Annotated[FormData, Form()]):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,21 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: Annotated[FormData, Form()]):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -8,6 +8,7 @@\n     JsonSchemaValue,\n     ModelField,\n     Undefined,\n+    get_cached_model_fields,\n     get_compat_model_name_map,\n     get_definitions,\n     get_schema_from_model_field,\n@@ -23,7 +24,7 @@\n from fastapi.encoders import jsonable_encoder\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n-from fastapi.params import Body, ParamTypes\n+from fastapi.params import Body, File, Form, ParamTypes\n from fastapi.responses import Response\n from fastapi.types import ModelNameMap\n from fastapi.utils import (\n@@ -185,6 +186,16 @@ def get_openapi_operation_request_body(\n     )\n     field_info = cast(Body, body_field.field_info)\n     request_media_type = field_info.media_type\n+    if (\n+        isinstance(field_info, Form)\n+        and request_media_type == \"application/x-www-form-urlencoded\"\n+        and lenient_issubclass(body_field.type_, BaseModel)\n+    ):  # Enforce multipart/form-data media type for Form models with File fields\n+        form_model_fields = get_cached_model_fields(body_field.type_)\n+        if any(\n+            isinstance(form_field.field_info, File) for form_field in form_model_fields\n+        ):\n+            request_media_type = \"multipart/form-data\"\n     required = body_field.required\n     request_body_oai: Dict[str, Any] = {}\n     if required:\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 617}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -36,6 +36,14 @@ You can verify it in the docs UI at `/docs`:\n <img src=\"/img/tutorial/request-form-models/image01.png\">\n </div>\n \n+## Including `File` Fields { #including-file-fields }\n+\n+You can also include **file fields** inside a form model by using `UploadFile` or `bytes` as field types and annotating them with `File`.\n+\n+If there is at least one `File` field in the form model, **FastAPI** will automatically set the request content media type to `multipart/form-data` for this path operation.\n+\n+{* ../../docs_src/request_form_models/tutorial001b_an_py39.py hl[3,12,16] *}\n+\n ## Forbid Extra Form Fields { #forbid-extra-form-fields }\n \n In some special use cases (probably not very common), you might want to **restrict** the form fields to only those declared in the Pydantic model. And **forbid** any **extra** fields.\n@@ -75,4 +83,4 @@ They will receive an error response telling them that the field `extra` is not a\n \n ## Summary { #summary }\n \n-You can use Pydantic models to declare form fields in FastAPI. üòé\n+You can use Pydantic models to declare form fields - including file uploads - in FastAPI. üòé\n\n```\n\n```diff\n@@ -0,0 +1,19 @@\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: FormData = Form()):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,20 @@\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: Annotated[FormData, Form()]):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,21 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: Annotated[FormData, Form()]):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -8,6 +8,7 @@\n     JsonSchemaValue,\n     ModelField,\n     Undefined,\n+    get_cached_model_fields,\n     get_compat_model_name_map,\n     get_definitions,\n     get_schema_from_model_field,\n@@ -23,7 +24,7 @@\n from fastapi.encoders import jsonable_encoder\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n-from fastapi.params import Body, ParamTypes\n+from fastapi.params import Body, File, Form, ParamTypes\n from fastapi.responses import Response\n from fastapi.types import ModelNameMap\n from fastapi.utils import (\n@@ -185,6 +186,16 @@ def get_openapi_operation_request_body(\n     )\n     field_info = cast(Body, body_field.field_info)\n     request_media_type = field_info.media_type\n+    if (\n+        isinstance(field_info, Form)\n+        and request_media_type == \"application/x-www-form-urlencoded\"\n+        and lenient_issubclass(body_field.type_, BaseModel)\n+    ):  # Enforce multipart/form-data media type for Form models with File fields\n+        form_model_fields = get_cached_model_fields(body_field.type_)\n+        if any(\n+            isinstance(form_field.field_info, File) for form_field in form_model_fields\n+        ):\n+            request_media_type = \"multipart/form-data\"\n     required = body_field.required\n     request_body_oai: Dict[str, Any] = {}\n     if required:\n\n```", "output": "Bug: üêõ Fix request body mediatype for form model with `File` fields\n\nCurrently if form parameter model contains `File` field, the content mediatype for this path operation in openapi will be wrong:\r\n\r\n```py\r\nfrom fastapi import FastAPI, Form, File\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\nclass MyModel(BaseModel):\r\n    file_model: bytes = File()\r\n\r\n@app.post(\"/file-model\")\r\nasync def create_item(item: MyModel = Form()):\r\n    return {\"file_size\": len(item.file_model)}\r\n```\r\n\r\nRequest body content mediatype in openapi will be `application/x-www-form-urlencoded` instead of `multipart/form-data`:\r\n```json\r\n        \"requestBody\": {\r\n          \"content\": {\r\n            \"application/x-www-form-urlencoded\": {\r\n              \"schema\": {\r\n                \"$ref\": \"#/components/schemas/MyModel\"\r\n              }\r\n            }\r\n          },\r\n          \"required\": true\r\n        },\r\n```\r\n\r\nThis PR enforces the content mediatype to be `multipart/form-data` for form parameter models that contain at least one `File` field.\r\nI added `if request_media_type == \"application/x-www-form-urlencoded\"` condition to make it possible to override mediatype by passing a parameter to `Form`:\r\n\r\n```\r\n@app.post(\"/file-model\")\r\nasync def create_item(item: MyModel = Form(media_type=\"whatever\")):\r\n    ...\r\n```", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 617}
{"instruction": "Review the following code changes: üêõ Fix request body mediatype for form model with `File` fields", "input": "```diff\n@@ -36,6 +36,14 @@ You can verify it in the docs UI at `/docs`:\n <img src=\"/img/tutorial/request-form-models/image01.png\">\n </div>\n \n+## Including `File` Fields { #including-file-fields }\n+\n+You can also include **file fields** inside a form model by using `UploadFile` or `bytes` as field types and annotating them with `File`.\n+\n+If there is at least one `File` field in the form model, **FastAPI** will automatically set the request content media type to `multipart/form-data` for this path operation.\n+\n+{* ../../docs_src/request_form_models/tutorial001b_an_py39.py hl[3,12,16] *}\n+\n ## Forbid Extra Form Fields { #forbid-extra-form-fields }\n \n In some special use cases (probably not very common), you might want to **restrict** the form fields to only those declared in the Pydantic model. And **forbid** any **extra** fields.\n@@ -75,4 +83,4 @@ They will receive an error response telling them that the field `extra` is not a\n \n ## Summary { #summary }\n \n-You can use Pydantic models to declare form fields in FastAPI. üòé\n+You can use Pydantic models to declare form fields - including file uploads - in FastAPI. üòé\n\n```\n\n```diff\n@@ -0,0 +1,19 @@\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: FormData = Form()):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,20 @@\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: Annotated[FormData, Form()]):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,21 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, File, Form\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class FormData(BaseModel):\n+    username: str\n+    password: str\n+    avatar: bytes = File()\n+\n+\n+@app.post(\"/users/\")\n+async def create_user(data: Annotated[FormData, Form()]):\n+    return {\n+        \"username\": data.username,\n+        \"password\": data.password,\n+        \"avatar_file_size\": len(data.avatar),\n+    }\n\n```\n\n```diff\n@@ -8,6 +8,7 @@\n     JsonSchemaValue,\n     ModelField,\n     Undefined,\n+    get_cached_model_fields,\n     get_compat_model_name_map,\n     get_definitions,\n     get_schema_from_model_field,\n@@ -23,7 +24,7 @@\n from fastapi.encoders import jsonable_encoder\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n-from fastapi.params import Body, ParamTypes\n+from fastapi.params import Body, File, Form, ParamTypes\n from fastapi.responses import Response\n from fastapi.types import ModelNameMap\n from fastapi.utils import (\n@@ -185,6 +186,16 @@ def get_openapi_operation_request_body(\n     )\n     field_info = cast(Body, body_field.field_info)\n     request_media_type = field_info.media_type\n+    if (\n+        isinstance(field_info, Form)\n+        and request_media_type == \"application/x-www-form-urlencoded\"\n+        and lenient_issubclass(body_field.type_, BaseModel)\n+    ):  # Enforce multipart/form-data media type for Form models with File fields\n+        form_model_fields = get_cached_model_fields(body_field.type_)\n+        if any(\n+            isinstance(form_field.field_info, File) for form_field in form_model_fields\n+        ):\n+            request_media_type = \"multipart/form-data\"\n     required = body_field.required\n     request_body_oai: Dict[str, Any] = {}\n     if required:\n\n```", "output": "Code Review for: üêõ Fix request body mediatype for form model with `File` fields\n\nüìù **docs/en/docs/tutorial/request-form-models.md**: Should we add here a note to indicate from which version onwards, this is the case? Something like \r\n```suggestion\r\nIf there is at least one `File` field in the form model, **FastAPI** (from v.0.121.3 onwards) will automatically set the request content media type to `multipart/form-data` for this path operation.\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 617}
{"instruction": "Review this code change in `docs/en/docs/tutorial/request-form-models.md`", "input": "```diff\n@@ -36,6 +36,14 @@ You can verify it in the docs UI at `/docs`:\n <img src=\"/img/tutorial/request-form-models/image01.png\">\n </div>\n \n+## Including `File` Fields { #including-file-fields }\n+\n+You can also include **file fields** inside a form model by using `UploadFile` or `bytes` as field types and annotating them with `File`.\n+\n+If there is at least one `File` field in the form model, **FastAPI** will automatically set the request content media type to `multipart/form-data` for this path operation.\n\n```", "output": "Should we add here a note to indicate from which version onwards, this is the case? Something like \r\n```suggestion\r\nIf there is at least one `File` field in the form model, **FastAPI** (from v.0.121.3 onwards) will automatically set the request content media type to `multipart/form-data` for this path operation.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 617}
{"instruction": "Review the following code changes: üåê Sync Russian docs", "input": "```diff\n@@ -15,7 +15,7 @@\n \n –¢–µ—Å—Ç—ã:\n \n-## –§—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–¥–∞ { #code-snippets}\n+## –§—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–¥–∞ { #code-snippets }\n \n //// tab | –¢–µ—Å—Ç\n \n@@ -53,7 +53,7 @@ LLM, –≤–µ—Ä–æ—è—Ç–Ω–æ, –ø–µ—Ä–µ–≤–µ–¥—ë—Ç —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ò–Ω—Ç\n \n ////\n \n-## –ö–∞–≤—ã—á–∫–∏ –≤–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥–∞ { #quotes-in-code-snippets}\n+## –ö–∞–≤—ã—á–∫–∏ –≤–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥–∞ { #quotes-in-code-snippets }\n \n //// tab | –¢–µ—Å—Ç\n \n\n```\n\n```diff\n@@ -175,7 +175,7 @@\n \n –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `image/png`, –æ–±—ä—è–≤–∏–≤, —á—Ç–æ –≤–∞—à–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—É—Ç–∏ –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å JSON‚Äë–æ–±—ä–µ–∫—Ç (—Å —Ç–∏–ø–æ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `application/json`) –∏–ª–∏ PNG‚Äë–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:\n \n-{* ../../docs_src/additional_responses/tutorial002.py hl[19:24,28] *}\n+{* ../../docs_src/additional_responses/tutorial002_py310.py hl[17:22,26] *}\n \n /// note | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ\n \n@@ -237,7 +237,7 @@ new_dict = {**old_dict, \"new key\": \"new value\"}\n \n –ù–∞–ø—Ä–∏–º–µ—Ä:\n \n-{* ../../docs_src/additional_responses/tutorial004.py hl[13:17,26] *}\n+{* ../../docs_src/additional_responses/tutorial004_py310.py hl[11:15,24] *}\n \n ## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–≤–µ—Ç–∞—Ö OpenAPI { #more-information-about-openapi-responses }\n \n\n```\n\n```diff\n@@ -144,7 +144,7 @@ checker(q=\"somequery\")\n \n ### –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å `yield`, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ { #background-tasks-and-dependencies-with-yield-technical-details }\n \n-–î–æ FastAPI 0.106.0 –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–ª–µ `yield` –±—ã–ª–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ: –∫–æ–¥ –ø–æ—Å–ª–µ `yield` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö –≤—ã–ø–æ–ª–Ω—è–ª—Å—è —É–∂–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞, –ø–æ—ç—Ç–æ–º—É [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π](../handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank} –∫ —Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É —É–∂–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏.\n+–î–æ FastAPI 0.106.0 –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ—Å–ª–µ `yield` –±—ã–ª–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ: –∫–æ–¥ –ø–æ—Å–ª–µ `yield` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö –≤—ã–ø–æ–ª–Ω—è–ª—Å—è —É–∂–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞, –ø–æ—ç—Ç–æ–º—É [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π](../tutorial/handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank} –∫ —Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É —É–∂–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏.\n \n –¢–∞–∫ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ –∂–µ –æ–±—ä–µ–∫—Ç—ã, ¬´–æ—Ç–¥–∞–Ω–Ω—ã–µ¬ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —á–µ—Ä–µ–∑ `yield`, –≤–Ω—É—Ç—Ä–∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–¥ –ø–æ—Å–ª–µ `yield` –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.\n \n\n```\n\n```diff\n@@ -64,7 +64,7 @@ https://mysuperapp.com/items/\n \n ///\n \n-### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–æ–∫—Å–∏\n+### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–æ–∫—Å–∏ { #how-proxy-forwarded-headers-work }\n \n –ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ –ø—Ä–æ–∫—Å–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—Å—ã–ª–∞–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n \n@@ -443,6 +443,14 @@ $ fastapi run main.py --forwarded-allow-ips=\"*\" --root-path /api/v1\n \n ///\n \n+/// note | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n+\n+–°–≤–æ–π—Å—Ç–≤–æ `servers` –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ OpenAPI —è–≤–ª—è–µ—Ç—Å—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.\n+\n+–ï—Å–ª–∏ –≤—ã –Ω–µ —É–∫–∞–∂–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `servers`, –∞ `root_path` —Ä–∞–≤–µ–Ω `/`, —Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ `servers` –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ OpenAPI –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥–µ—Ç –æ–ø—É—â–µ–Ω–æ. –≠—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —Å–µ—Ä–≤–µ—Ä—É —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `url` —Ä–∞–≤–Ω—ã–º `/`.\n+\n+///\n+\n ### –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ `root_path` { #disable-automatic-server-from-root-path }\n \n –ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã FastAPI –¥–æ–±–∞–≤–ª—è–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—è `root_path`, —É–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `root_path_in_servers=False`:\n\n```\n\n```diff\n@@ -4,7 +4,7 @@ FastAPI –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ–≤–µ—Ä—Ö **Pydantic**, –∏ —è –ø–æ–∫–∞–∑—ã–≤–∞–ª –≤\n \n –ù–æ FastAPI —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ <a href=\"https://docs.python.org/3/library/dataclasses.html\" class=\"external-link\" target=\"_blank\">`dataclasses`</a> —Ç–µ–º –∂–µ —Å–ø–æ—Å–æ–±–æ–º:\n \n-{* ../../docs_src/dataclasses/tutorial001.py hl[1,7:12,19:20] *}\n+{* ../../docs_src/dataclasses/tutorial001_py310.py hl[1,6:11,18:19] *}\n \n –≠—Ç–æ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è **Pydantic**, —Ç–∞–∫ –∫–∞–∫ –≤ –Ω—ë–º –µ—Å—Ç—å <a href=\"https://docs.pydantic.dev/latest/concepts/dataclasses/#use-of-stdlib-dataclasses-with-basemodel\" class=\"external-link\" target=\"_blank\">–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `dataclasses`</a>.\n \n@@ -32,7 +32,7 @@ FastAPI –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ–≤–µ—Ä—Ö **Pydantic**, –∏ —è –ø–æ–∫–∞–∑—ã–≤–∞–ª –≤\n \n –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `dataclasses` –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `response_model`:\n \n-{* ../../docs_src/dataclasses/tutorial002.py hl[1,7:13,19] *}\n+{* ../../docs_src/dataclasses/tutorial002_py310.py hl[1,6:12,18] *}\n \n –≠—Ç–æ—Ç dataclass –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ Pydantic dataclass.\n \n@@ -48,7 +48,7 @@ FastAPI –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ–≤–µ—Ä—Ö **Pydantic**, –∏ —è –ø–æ–∫–∞–∑—ã–≤–∞–ª –≤\n \n –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ `dataclasses` –Ω–∞ `pydantic.dataclasses`, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π –∑–∞–º–µ–Ω–æ–π (drop-in replacement):\n \n-{* ../../docs_src/dataclasses/tutorial003.py hl[1,5,8:11,14:17,23:25,28] *}\n+{* ../../docs_src/dataclasses/tutorial003_py310.py hl[1,4,7:10,13:16,22:24,27] *}\n \n 1. –ú—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º `field` –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö `dataclasses`.\n \n\n```", "output": "Changes look good. This PR implements: üåê Sync Russian docs", "source": "pr", "type": "code_review", "pr_number": 616}
{"instruction": "Fix the following bug: üêõ Fix support for tagged union with discriminator inside of `Annotated` with `Body()`", "input": "üêõ Fix support for tagged union with discriminator inside of `Annotated` with `Body()`\r\n\r\nRelated to: https://github.com/fastapi/fastapi/discussions/14495, https://github.com/fastapi/fastapi/issues/14508", "output": "```diff\n@@ -18,7 +18,7 @@\n from fastapi._compat import may_v1, shared\n from fastapi.openapi.constants import REF_TEMPLATE\n from fastapi.types import IncEx, ModelNameMap, UnionType\n-from pydantic import BaseModel, ConfigDict, TypeAdapter, create_model\n+from pydantic import BaseModel, ConfigDict, Field, TypeAdapter, create_model\n from pydantic import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n from pydantic import PydanticUndefinedAnnotation as PydanticUndefinedAnnotation\n from pydantic import ValidationError as ValidationError\n@@ -50,6 +50,45 @@\n evaluate_forwardref = eval_type_lenient\n Validator = Any\n \n+# TODO: remove when dropping support for Pydantic < v2.12.3\n+_Attrs = {\n+    \"default\": ...,\n+    \"default_factory\": None,\n+    \"alias\": None,\n+    \"alias_priority\": None,\n+    \"validation_alias\": None,\n+    \"serialization_alias\": None,\n+    \"title\": None,\n+    \"field_title_generator\": None,\n+    \"description\": None,\n+    \"examples\": None,\n+    \"exclude\": None,\n+    \"exclude_if\": None,\n+    \"discriminator\": None,\n+    \"deprecated\": None,\n+    \"json_schema_extra\": None,\n+    \"frozen\": None,\n+    \"validate_default\": None,\n+    \"repr\": True,\n+    \"init\": None,\n+    \"init_var\": None,\n+    \"kw_only\": None,\n+}\n+\n+\n+# TODO: remove when dropping support for Pydantic < v2.12.3\n+def asdict(field_info: FieldInfo) -> Dict[str, Any]:\n+    attributes = {}\n+    for attr in _Attrs:\n+        value = getattr(field_info, attr, Undefined)\n+        if value is not Undefined:\n+            attributes[attr] = value\n+    return {\n+        \"annotation\": field_info.annotation,\n+        \"metadata\": field_info.metadata,\n+        \"attributes\": attributes,\n+    }\n+\n \n class BaseConfig:\n     pass\n@@ -95,10 +134,15 @@ def __post_init__(self) -> None:\n                 warnings.simplefilter(\n                     \"ignore\", category=UnsupportedFieldAttributeWarning\n                 )\n+            # TODO: remove after dropping support for Python 3.8 and\n+            # setting the min Pydantic to v2.12.3 that adds asdict()\n+            field_dict = asdict(self.field_info)\n             annotated_args = (\n-                self.field_info.annotation,\n-                *self.field_info.metadata,\n-                self.field_info,\n+                field_dict[\"annotation\"],\n+                *field_dict[\"metadata\"],\n+                # this FieldInfo needs to be created again so that it doesn't include\n+                # the old field info metadata and only the rest of the attributes\n+                Field(**field_dict[\"attributes\"]),\n             )\n             self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n                 Annotated[annotated_args],\n\n```\n\n```diff\n@@ -0,0 +1,207 @@\n+# Ref: https://github.com/fastapi/fastapi/discussions/14495\n+\n+from typing import Union\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+from .utils import needs_pydanticv2\n+\n+\n+@pytest.fixture(name=\"client\")\n+def client_fixture() -> TestClient:\n+    from fastapi import Body\n+    from pydantic import Discriminator, Tag\n+\n+    class Cat(BaseModel):\n+        pet_type: str = \"cat\"\n+        meows: int\n+\n+    class Dog(BaseModel):\n+        pet_type: str = \"dog\"\n+        barks: float\n+\n+    def get_pet_type(v):\n+        assert isinstance(v, dict)\n+        return v.get(\"pet_type\", \"\")\n+\n+    Pet = Annotated[\n+        Union[Annotated[Cat, Tag(\"cat\")], Annotated[Dog, Tag(\"dog\")]],\n+        Discriminator(get_pet_type),\n+    ]\n+\n+    app = FastAPI()\n+\n+    @app.post(\"/pet/assignment\")\n+    async def create_pet_assignment(pet: Pet = Body()):\n+        return pet\n+\n+    @app.post(\"/pet/annotated\")\n+    async def create_pet_annotated(pet: Annotated[Pet, Body()]):\n+        return pet\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+@needs_pydanticv2\n+def test_union_body_discriminator_assignment(client: TestClient) -> None:\n+    response = client.post(\"/pet/assignment\", json={\"pet_type\": \"cat\", \"meows\": 5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"pet_type\": \"cat\", \"meows\": 5}\n+\n+\n+@needs_pydanticv2\n+def test_union_body_discriminator_annotated(client: TestClient) -> None:\n+    response = client.post(\"/pet/annotated\", json={\"pet_type\": \"dog\", \"barks\": 3.5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"pet_type\": \"dog\", \"barks\": 3.5}\n+\n+\n+@needs_pydanticv2\n+def test_openapi_schema(client: TestClient) -> None:\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/pet/assignment\": {\n+                    \"post\": {\n+                        \"summary\": \"Create Pet Assignment\",\n+                        \"operationId\": \"create_pet_assignment_pet_assignment_post\",\n+                        \"requestBody\": {\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"anyOf\": [\n+                                            {\"$ref\": \"#/components/schemas/Cat\"},\n+                                            {\"$ref\": \"#/components/schemas/Dog\"},\n+                                        ],\n+                                        \"title\": \"Pet\",\n+                                    }\n+                                }\n+                            },\n+            \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 615}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -18,7 +18,7 @@\n from fastapi._compat import may_v1, shared\n from fastapi.openapi.constants import REF_TEMPLATE\n from fastapi.types import IncEx, ModelNameMap, UnionType\n-from pydantic import BaseModel, ConfigDict, TypeAdapter, create_model\n+from pydantic import BaseModel, ConfigDict, Field, TypeAdapter, create_model\n from pydantic import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n from pydantic import PydanticUndefinedAnnotation as PydanticUndefinedAnnotation\n from pydantic import ValidationError as ValidationError\n@@ -50,6 +50,45 @@\n evaluate_forwardref = eval_type_lenient\n Validator = Any\n \n+# TODO: remove when dropping support for Pydantic < v2.12.3\n+_Attrs = {\n+    \"default\": ...,\n+    \"default_factory\": None,\n+    \"alias\": None,\n+    \"alias_priority\": None,\n+    \"validation_alias\": None,\n+    \"serialization_alias\": None,\n+    \"title\": None,\n+    \"field_title_generator\": None,\n+    \"description\": None,\n+    \"examples\": None,\n+    \"exclude\": None,\n+    \"exclude_if\": None,\n+    \"discriminator\": None,\n+    \"deprecated\": None,\n+    \"json_schema_extra\": None,\n+    \"frozen\": None,\n+    \"validate_default\": None,\n+    \"repr\": True,\n+    \"init\": None,\n+    \"init_var\": None,\n+    \"kw_only\": None,\n+}\n+\n+\n+# TODO: remove when dropping support for Pydantic < v2.12.3\n+def asdict(field_info: FieldInfo) -> Dict[str, Any]:\n+    attributes = {}\n+    for attr in _Attrs:\n+        value = getattr(field_info, attr, Undefined)\n+        if value is not Undefined:\n+            attributes[attr] = value\n+    return {\n+        \"annotation\": field_info.annotation,\n+        \"metadata\": field_info.metadata,\n+        \"attributes\": attributes,\n+    }\n+\n \n class BaseConfig:\n     pass\n@@ -95,10 +134,15 @@ def __post_init__(self) -> None:\n                 warnings.simplefilter(\n                     \"ignore\", category=UnsupportedFieldAttributeWarning\n                 )\n+            # TODO: remove after dropping support for Python 3.8 and\n+            # setting the min Pydantic to v2.12.3 that adds asdict()\n+            field_dict = asdict(self.field_info)\n             annotated_args = (\n-                self.field_info.annotation,\n-                *self.field_info.metadata,\n-                self.field_info,\n+                field_dict[\"annotation\"],\n+                *field_dict[\"metadata\"],\n+                # this FieldInfo needs to be created again so that it doesn't include\n+                # the old field info metadata and only the rest of the attributes\n+                Field(**field_dict[\"attributes\"]),\n             )\n             self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n                 Annotated[annotated_args],\n\n```\n\n```diff\n@@ -0,0 +1,207 @@\n+# Ref: https://github.com/fastapi/fastapi/discussions/14495\n+\n+from typing import Union\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+from .utils import needs_pydanticv2\n+\n+\n+@pytest.fixture(name=\"client\")\n+def client_fixture() -> TestClient:\n+    from fastapi import Body\n+    from pydantic import Discriminator, Tag\n+\n+    class Cat(BaseModel):\n+        pet_type: str = \"cat\"\n+        meows: int\n+\n+    class Dog(BaseModel):\n+        pet_type: str = \"dog\"\n+        barks: float\n+\n+    def get_pet_type(v):\n+        assert isinstance(v, dict)\n+        return v.get(\"pet_type\", \"\")\n+\n+    Pet = Annotated[\n+        Union[Annotated[Cat, Tag(\"cat\")], Annotated[Dog, Tag(\"dog\")]],\n+        Discriminator(get_pet_type),\n+    ]\n+\n+    app = FastAPI()\n+\n+    @app.post(\"/pet/assignment\")\n+    async def create_pet_assignment(pet: Pet = Body()):\n+        return pet\n+\n+    @app.post(\"/pet/annotated\")\n+    async def create_pet_annotated(pet: Annotated[Pet, Body()]):\n+        return pet\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+@needs_pydanticv2\n+def test_union_body_discriminator_assignment(client: TestClient) -> None:\n+    ", "output": "Bug: üêõ Fix support for tagged union with discriminator inside of `Annotated` with `Body()`\n\nüêõ Fix support for tagged union with discriminator inside of `Annotated` with `Body()`\r\n\r\nRelated to: https://github.com/fastapi/fastapi/discussions/14495, https://github.com/fastapi/fastapi/issues/14508", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 615}
{"instruction": "Review the following code changes: üêõ Fix support for tagged union with discriminator inside of `Annotated` with `Body()`", "input": "```diff\n@@ -18,7 +18,7 @@\n from fastapi._compat import may_v1, shared\n from fastapi.openapi.constants import REF_TEMPLATE\n from fastapi.types import IncEx, ModelNameMap, UnionType\n-from pydantic import BaseModel, ConfigDict, TypeAdapter, create_model\n+from pydantic import BaseModel, ConfigDict, Field, TypeAdapter, create_model\n from pydantic import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n from pydantic import PydanticUndefinedAnnotation as PydanticUndefinedAnnotation\n from pydantic import ValidationError as ValidationError\n@@ -50,6 +50,45 @@\n evaluate_forwardref = eval_type_lenient\n Validator = Any\n \n+# TODO: remove when dropping support for Pydantic < v2.12.3\n+_Attrs = {\n+    \"default\": ...,\n+    \"default_factory\": None,\n+    \"alias\": None,\n+    \"alias_priority\": None,\n+    \"validation_alias\": None,\n+    \"serialization_alias\": None,\n+    \"title\": None,\n+    \"field_title_generator\": None,\n+    \"description\": None,\n+    \"examples\": None,\n+    \"exclude\": None,\n+    \"exclude_if\": None,\n+    \"discriminator\": None,\n+    \"deprecated\": None,\n+    \"json_schema_extra\": None,\n+    \"frozen\": None,\n+    \"validate_default\": None,\n+    \"repr\": True,\n+    \"init\": None,\n+    \"init_var\": None,\n+    \"kw_only\": None,\n+}\n+\n+\n+# TODO: remove when dropping support for Pydantic < v2.12.3\n+def asdict(field_info: FieldInfo) -> Dict[str, Any]:\n+    attributes = {}\n+    for attr in _Attrs:\n+        value = getattr(field_info, attr, Undefined)\n+        if value is not Undefined:\n+            attributes[attr] = value\n+    return {\n+        \"annotation\": field_info.annotation,\n+        \"metadata\": field_info.metadata,\n+        \"attributes\": attributes,\n+    }\n+\n \n class BaseConfig:\n     pass\n@@ -95,10 +134,15 @@ def __post_init__(self) -> None:\n                 warnings.simplefilter(\n                     \"ignore\", category=UnsupportedFieldAttributeWarning\n                 )\n+            # TODO: remove after dropping support for Python 3.8 and\n+            # setting the min Pydantic to v2.12.3 that adds asdict()\n+            field_dict = asdict(self.field_info)\n             annotated_args = (\n-                self.field_info.annotation,\n-                *self.field_info.metadata,\n-                self.field_info,\n+                field_dict[\"annotation\"],\n+                *field_dict[\"metadata\"],\n+                # this FieldInfo needs to be created again so that it doesn't include\n+                # the old field info metadata and only the rest of the attributes\n+                Field(**field_dict[\"attributes\"]),\n             )\n             self._type_adapter: TypeAdapter[Any] = TypeAdapter(\n                 Annotated[annotated_args],\n\n```\n\n```diff\n@@ -0,0 +1,207 @@\n+# Ref: https://github.com/fastapi/fastapi/discussions/14495\n+\n+from typing import Union\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+from .utils import needs_pydanticv2\n+\n+\n+@pytest.fixture(name=\"client\")\n+def client_fixture() -> TestClient:\n+    from fastapi import Body\n+    from pydantic import Discriminator, Tag\n+\n+    class Cat(BaseModel):\n+        pet_type: str = \"cat\"\n+        meows: int\n+\n+    class Dog(BaseModel):\n+        pet_type: str = \"dog\"\n+        barks: float\n+\n+    def get_pet_type(v):\n+        assert isinstance(v, dict)\n+        return v.get(\"pet_type\", \"\")\n+\n+    Pet = Annotated[\n+        Union[Annotated[Cat, Tag(\"cat\")], Annotated[Dog, Tag(\"dog\")]],\n+        Discriminator(get_pet_type),\n+    ]\n+\n+    app = FastAPI()\n+\n+    @app.post(\"/pet/assignment\")\n+    async def create_pet_assignment(pet: Pet = Body()):\n+        return pet\n+\n+    @app.post(\"/pet/annotated\")\n+    async def create_pet_annotated(pet: Annotated[Pet, Body()]):\n+        return pet\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+@needs_pydanticv2\n+def test_union_body_discriminator_assignment(client: TestClient) -> None:\n+    response = client.post(\"/pet/assignment\", json={\"pet_type\": \"cat\", \"meows\": 5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"pet_type\": \"cat\", \"meows\": 5}\n+\n+\n+@needs_pydanticv2\n+def test_union_body_discriminator_annotated(client: TestClient) -> None:\n+    response = client.post(\"/pet/annotated\", json={\"pet_type\": \"dog\", \"barks\": 3.5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"pet_type\": \"dog\", \"barks\": 3.5}\n+\n+\n+@needs_pydanticv2\n+def test_openapi_schema(client: TestClient) -> None:\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/pet/assignment\": {\n+                    \"post\": {\n+                        \"summary\": \"Create Pet Assignment\",\n+                    ", "output": "Changes look good. This PR implements: üêõ Fix support for tagged union with discriminator inside of `Annotated` with `Body()`", "source": "pr", "type": "code_review", "pr_number": 615}
{"instruction": "Fix the following bug: Fix Pylance typing warnings in tutorial examples", "input": "### Summary\r\nFix Pylance type checking warnings in several tutorial examples by explicitly typing `results` as `dict[str, Any]` and using direct assignment instead of `.update()`.\r\n\r\n### Reason\r\nRecent versions of Python and Pylance infer `results` as `dict[str, list[dict[str, str]]]`,\r\ncausing false positives when adding a `str` value.\r\n\r\n### Changes\r\n- Updated multiple `docs_src/query_params_str_validations/*.py` files to fix Pylance typing warnings.", "output": "```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Union[str, None] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,11 +1,13 @@\n+from typing import Any\n+\n from fastapi import FastAPI\n \n app = FastAPI()\n \n \n @app.get(\"/items/\")\n async def read_items(q: str | None = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI, Query\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Union[str, None] = Query(default=None, max_length=50)):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI, Query\n from typing_extensions import Annotated\n@@ -8,7 +8,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Annotated[Union[str, None], Query(max_length=50)] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Annotated\n+from typing import Annotated, Any\n \n from fastapi import FastAPI, Query\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Annotated[str | None, Query(max_length=50)] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 614}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Union[str, None] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,11 +1,13 @@\n+from typing import Any\n+\n from fastapi import FastAPI\n \n app = FastAPI()\n \n \n @app.get(\"/items/\")\n async def read_items(q: str | None = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI, Query\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Union[str, None] = Query(default=None, max_length=50)):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI, Query\n from typing_extensions import Annotated\n@@ -8,7 +8,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Annotated[Union[str, None], Query(max_length=50)] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Annotated\n+from typing import Annotated, Any\n \n from fastapi import FastAPI, Query\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Annotated[str | None, Query(max_length=50)] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```", "output": "Bug: Fix Pylance typing warnings in tutorial examples\n\n### Summary\r\nFix Pylance type checking warnings in several tutorial examples by explicitly typing `results` as `dict[str, Any]` and using direct assignment instead of `.update()`.\r\n\r\n### Reason\r\nRecent versions of Python and Pylance infer `results` as `dict[str, list[dict[str, str]]]`,\r\ncausing false positives when adding a `str` value.\r\n\r\n### Changes\r\n- Updated multiple `docs_src/query_params_str_validations/*.py` files to fix Pylance typing warnings.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 614}
{"instruction": "Review the following code changes: Fix Pylance typing warnings in tutorial examples", "input": "```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Union[str, None] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,11 +1,13 @@\n+from typing import Any\n+\n from fastapi import FastAPI\n \n app = FastAPI()\n \n \n @app.get(\"/items/\")\n async def read_items(q: str | None = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI, Query\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Union[str, None] = Query(default=None, max_length=50)):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Union\n+from typing import Any, Union\n \n from fastapi import FastAPI, Query\n from typing_extensions import Annotated\n@@ -8,7 +8,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Annotated[Union[str, None], Query(max_length=50)] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from typing import Annotated\n+from typing import Annotated, Any\n \n from fastapi import FastAPI, Query\n \n@@ -7,7 +7,7 @@\n \n @app.get(\"/items/\")\n async def read_items(q: Annotated[str | None, Query(max_length=50)] = None):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n+    results: dict[str, Any] = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n-        results.update({\"q\": q})\n+        results[\"q\"] = q\n     return results\n\n```", "output": "Changes look good. This PR implements: Fix Pylance typing warnings in tutorial examples", "source": "pr", "type": "code_review", "pr_number": 614}
{"instruction": "Review the following code changes: ‚ûï Add requirements for translations", "input": "```diff\n@@ -1,2 +1,3 @@\n pydantic-ai==0.4.10\n GitPython==3.1.45\n+pygithub==2.8.1\n\n```\n\n```diff\n@@ -1,6 +1,7 @@\n -e .[all]\n -r requirements-tests.txt\n -r requirements-docs.txt\n+-r requirements-translations.txt\n pre-commit >=4.5.0,<5.0.0\n # For generating screenshots\n playwright\n\n```", "output": "Changes look good. This PR implements: ‚ûï Add requirements for translations", "source": "pr", "type": "code_review", "pr_number": 613}
{"instruction": "Review the following code changes: üåê Remove translations for removed docs", "input": "```diff\n@@ -1,96 +0,0 @@\n-# Í≥†Í∏â ÎØ∏Îì§Ïõ®Ïñ¥\n-\n-Î©îÏù∏ ÌäúÌÜ†Î¶¨ÏñºÏóêÏÑú [Custom Middleware](../tutorial/middleware.md){.internal-link target=_blank}Î•º ÏùëÏö©ÌîÑÎ°úÍ∑∏Îû®Ïóê Ï∂îÍ∞ÄÌïòÎäî Î∞©Î≤ïÏùÑ ÏùΩÏúºÏÖ®ÏäµÎãàÎã§.\n-\n-Í∑∏Î¶¨Í≥† [CORS with the `CORSMiddleware`](){.internal-link target=_blank}ÌïòÎäî Î∞©Î≤ïÎèÑ Î≥¥ÏÖ®ÏäµÎãàÎã§.\n-\n-Ïù¥ ÏÑπÏÖòÏóêÏÑúÎäî Îã§Î•∏ ÎØ∏Îì§Ïõ®Ïñ¥Îì§ÏùÑ ÏÇ¨Ïö©ÌïòÎäî Î∞©Î≤ïÏùÑ ÏïåÏïÑÎ≥¥Í≤†ÏäµÎãàÎã§.\n-\n-## ASGI ÎØ∏Îì§Ïõ®Ïñ¥ Ï∂îÍ∞ÄÌïòÍ∏∞\n-\n-**FastAPI**Îäî StarletteÏùÑ Í∏∞Î∞òÏúºÎ°ú ÌïòÍ≥† ÏûàÏúºÎ©∞, <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr> ÏÇ¨ÏñëÏùÑ Íµ¨ÌòÑÌïòÎØÄÎ°ú ASGI ÎØ∏Îì§Ïõ®Ïñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-ÎØ∏Îì§Ïõ®Ïñ¥Í∞Ä FastAPIÎÇò StarletteÏö©ÏúºÎ°ú ÎßåÎì§Ïñ¥ÏßÄÏßÄ ÏïäÏïÑÎèÑ ASGI ÏÇ¨ÏñëÏùÑ Ï§ÄÏàòÌïòÎäî Ìïú ÎèôÏûëÌï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-ÏùºÎ∞òÏ†ÅÏúºÎ°ú ASGI ÎØ∏Îì§Ïõ®Ïñ¥Îäî Ï≤´ Î≤àÏß∏ Ïù∏ÏàòÎ°ú ASGI Ïï±ÏùÑ Î∞õÎäî ÌÅ¥ÎûòÏä§Îì§ÏûÖÎãàÎã§.\n-\n-Îî∞ÎùºÏÑú ÌÉÄÏÇ¨ ASGI ÎØ∏Îì§Ïõ®Ïñ¥ Î¨∏ÏÑúÏóêÏÑú ÏùºÎ∞òÏ†ÅÏúºÎ°ú Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏÇ¨Ïö©ÌïòÎèÑÎ°ù ÏïàÎÇ¥Ìï† Í≤ÉÏûÖÎãàÎã§.\n-\n-\n```\n\n```diff\n@@ -1,55 +0,0 @@\n-# OpenAPI ÏõπÌõÖ(Webhooks)\n-\n-API **ÏÇ¨Ïö©Ïûê**ÏóêÍ≤å ÌäπÏ†ï **Ïù¥Î≤§Ìä∏**Í∞Ä Î∞úÏÉùÌï† Îïå *Í∑∏Îì§*Ïùò Ïï±(ÏãúÏä§ÌÖú)Ïóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥ **ÏïåÎ¶º**ÏùÑ Ï†ÑÎã¨Ìï† Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏïåÎ¶¨Í≥† Ïã∂ÏùÄ Í≤ΩÏö∞Í∞Ä ÏûàÏäµÎãàÎã§.\n-\n-Ï¶â, ÏùºÎ∞òÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©ÏûêÍ∞Ä APIÏóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Îäî Í≤ÉÍ≥ºÎäî Î∞òÎåÄÎ°ú, **API**(ÎòêÎäî Ïï±)Í∞Ä **ÏÇ¨Ïö©ÏûêÏùò ÏãúÏä§ÌÖú**(Í∑∏Îì§Ïùò APIÎÇò Ïï±)ÏúºÎ°ú **ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Îäî** ÏÉÅÌô©ÏùÑ ÏùòÎØ∏Ìï©ÎãàÎã§.\n-\n-Ïù¥Î•º ÌùîÌûà **ÏõπÌõÖ(Webhook)**Ïù¥ÎùºÍ≥† Î∂ÄÎ¶ÖÎãàÎã§.\n-\n-## ÏõπÌõÖ Ïä§ÌÖù\n-\n-**ÏΩîÎìúÏóêÏÑú** ÏõπÌõÖÏúºÎ°ú Î≥¥ÎÇº Î©îÏãúÏßÄ, Ï¶â ÏöîÏ≤≠Ïùò **Î∞îÎîî(body)**Î•º Ï†ïÏùòÌïòÎäî Í≤ÉÏù¥ ÏùºÎ∞òÏ†ÅÏù∏ ÌîÑÎ°úÏÑ∏Ïä§ÏûÖÎãàÎã§.\n-\n-Ïï±ÏóêÏÑú Ìï¥Îãπ ÏöîÏ≤≠Ïù¥ÎÇò Ïù¥Î≤§Ìä∏Î•º Ï†ÑÏÜ°Ìï† **ÏãúÏ†ê**ÏùÑ Ï†ïÏùòÌï©ÎãàÎã§.\n-\n-**ÏÇ¨Ïö©Ïûê**Îäî Ïï±Ïù¥ Ìï¥Îãπ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇº **URL**ÏùÑ Ï†ïÏùòÌï©ÎãàÎã§. (Ïòà: Ïõπ ÎåÄÏãúÎ≥¥ÎìúÏóêÏÑú ÏÑ§Ï†ï)\n-\n-ÏõπÌõÖÏùò URLÏùÑ Îì±Î°ùÌïòÎäî Î∞©Î≤ïÍ≥º Ïù¥Îü¨Ìïú ÏöîÏ≤≠ÏùÑ Ïã§Ï†úÎ°ú Ï†ÑÏÜ°ÌïòÎäî ÏΩîÎìúÏóê ÎåÄÌïú Î™®Îì† Î°úÏßÅÏùÄ Ïó¨Îü¨Î∂ÑÏóêÍ≤å Îã¨Î†§ ÏûàÏäµÎãàÎã§. ÏõêÌïòÎäîÎåÄÎ°ú **Í≥†Ïú†Ïùò ÏΩîÎìú**Î•º ÏûëÏÑ±ÌïòÎ©¥ Îê©ÎãàÎã§.\n-\n-## **FastAPI**ÏôÄ OpenAPIÎ°ú ÏõπÌõÖ Î¨∏ÏÑúÌôîÌïòÍ∏∞\n-\n-**FastAPI**Î•º ÏÇ¨Ïö©ÌïòÏó¨ OpenAPIÏôÄ Ìï®Íªò ÏõπÌõÖÏùò Ïù¥Î¶Ñ, Ïï±Ïù¥ Î≥¥ÎÇº Ïàò ÏûàÎäî HTTP ÏûëÏóÖ Ïú†Ìòï(Ïòà: `POST`, `PUT` Îì±), Í∑∏Î¶¨Í≥† Î≥¥ÎÇº ÏöîÏ≤≠Ïùò **Î∞îÎîî**Î•º Ï†ïÏùòÌï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-Ïù¥Î•º ÌÜµÌï¥ ÏÇ¨Ïö©ÏûêÍ∞Ä **ÏõπÌõÖ** ÏöîÏ≤≠ÏùÑ ÏàòÏã†Ìï† **API Íµ¨ÌòÑ**ÏùÑ Ìõ®Ïî¨ ÏâΩÍ≤å Ìï† Ïàò ÏûàÏúºÎ©∞, Í≤ΩÏö∞Ïóê Îî∞Îùº ÏÇ¨Ïö©Ïûê API ÏΩîÎìúÏùò ÏùºÎ∂ÄÎ•º ÏûêÎèô ÏÉùÏÑ±Ìï† ÏàòÎèÑ ÏûàÏäµÎãàÎã§.\n-\n-/// info\n-\n-ÏõπÌõÖÏùÄ OpenAPI 3.1.0 Ïù¥ÏÉÅÏóêÏÑú ÏßÄÏõêÎêòÎ©∞, FastAPI `0.99.0` Ïù¥ÏÉÅ Î≤ÑÏ†ÑÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-///\n-\n-## ÏõπÌõÖÏù¥ Ìè¨Ìï®Îêú Ïï± ÎßåÎì§Í∏∞\n-\n-**FastAPI** Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÎßåÎì§ Îïå, `webhooks` ÏÜçÏÑ±ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ *ÏõπÌõÖ*ÏùÑ Ï†ïÏùòÌï† Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îäî `@app.webhooks.post()`ÏôÄ Í∞ôÏùÄ Î∞©ÏãùÏúºÎ°ú *Í≤ΩÎ°ú(path) ÏûëÏóÖ*ÏùÑ Ï†ïÏùòÌïòÎäî Í≤ÉÍ≥º ÎπÑÏä∑Ìï©ÎãàÎã§.\n-\n-{* ../../docs_src/openapi_webhooks/tutorial001.py hl[9:13,36:53] *}\n-\n-Ïù¥Î†áÍ≤å Ï†ïÏùòÌïú ÏõπÌõÖÏùÄ **OpenAPI** Ïä§ÌÇ§ÎßàÏôÄ ÏûêÎèô **Î¨∏ÏÑúÌôî UI**Ïóê ÌëúÏãúÎê©ÎãàÎã§.\n-\n-/// info\n-\n-`app.webhooks` Í∞ùÏ≤¥Îäî ÏÇ¨Ïã§ `APIRouter`Ïùº ÎøêÏù¥Î©∞, Ïó¨Îü¨ ÌååÏùºÎ°ú Ïï±ÏùÑ Íµ¨ÏÑ±Ìï† Îïå ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÍ≥º ÎèôÏùºÌïú ÌÉÄÏûÖÏûÖÎãàÎã§.\n-\n-///\n-\n-ÏõπÌõÖÏóêÏÑúÎäî Ïã§Ï†ú **Í≤ΩÎ°ú(path)** (Ïòà: `/items/`)Î•º ÏÑ†Ïñ∏ÌïòÏßÄ ÏïäÎäî Ï†êÏóê Ïú†ÏùòÌï¥Ïïº Ìï©ÎãàÎã§. Ïó¨Í∏∞ÏÑú Ï†ÑÎã¨ÌïòÎäî ÌÖçÏä§Ìä∏Îäî **ÏãùÎ≥ÑÏûê**Î°ú, ÏõπÌõÖÏùò Ïù¥Î¶Ñ(Ïù¥Î≤§Ìä∏ Ïù¥Î¶Ñ)ÏûÖÎãàÎã§. ÏòàÎ•º Îì§Ïñ¥, `@app.webhooks.post(\"new-subscription\")`ÏóêÏÑú ÏõπÌõÖ Ïù¥Î¶ÑÏùÄ `new-subscription`ÏûÖÎãàÎã§.\n-\n-Ïù¥Îäî Ïã§Ï†ú **URL Í≤ΩÎ°ú**Îäî **ÏÇ¨Ïö©Ïûê**Í∞Ä Îã§Î•∏ Î∞©Î≤ï(Ïòà: Ïõπ ÎåÄÏãúÎ≥¥Îìú)ÏùÑ ÌÜµÌï¥ ÏßÄÏ†ïÌïòÎèÑÎ°ù Í∏∞ÎåÄÎêòÍ∏∞ ÎïåÎ¨∏ÏûÖÎãàÎã§.\n-\n-### Î¨∏ÏÑú ÌôïÏù∏ÌïòÍ∏∞\n-\n-Ïù¥Ï†ú Ïï±ÏùÑ ÏãúÏûëÌïòÍ≥† <a href=\"http://127.0.0.1:8000/docs\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8000/docs</a>Î°ú Ïù¥ÎèôÌï¥ Î¥ÖÏãúÎã§.\n-\n-Î¨∏ÏÑúÏóêÏÑú Í∏∞Ï°¥ *Í≤ΩÎ°ú ÏûëÏóÖ*ÎøêÎßå ÏïÑÎãàÎùº **ÏõπÌõÖ**ÎèÑ ÌëúÏãúÎêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n-\n-<img src=\"/img/tutorial/openapi-webhooks/image01.png\">\n\n```\n\n```diff\n@@ -1,19 +0,0 @@\n-# Í≥†Í∏â Î≥¥Ïïà\n-\n-## Ï∂îÍ∞Ä Í∏∞Îä•\n-\n-[ÏûêÏäµÏÑú - ÏÇ¨Ïö©Ïûê Í∞ÄÏù¥Îìú: Î≥¥Ïïà](../../tutorial/security/index.md){.internal-link target=_blank} Î¨∏ÏÑúÏóêÏÑú Îã§Î£¨ ÎÇ¥Ïö© Ïô∏ÏóêÎèÑ Î≥¥Ïïà Ï≤òÎ¶¨Î•º ÏúÑÌïú Î™á Í∞ÄÏßÄ Ï∂îÍ∞Ä Í∏∞Îä•Ïù¥ ÏûàÏäµÎãàÎã§.\n-\n-/// tip\n-\n-Îã§Ïùå ÏÑπÏÖòÏùÄ **Î∞òÎìúÏãú \"Í≥†Í∏â\"** Í∏∞Îä•ÏùÄ ÏïÑÎãôÎãàÎã§.\n-\n-Í∑∏Î¶¨Í≥† Ïó¨Îü¨Î∂ÑÏùò ÏÇ¨Ïö© ÏÇ¨Î°ÄÏóê Îî∞Îùº, Ï†ÅÌï©Ìïú Ìï¥Í≤∞Ï±ÖÏù¥ Í∑∏ Ï§ë ÌïòÎÇòÏóê ÏûàÏùÑ Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÏäµÎãàÎã§.\n-\n-///\n-\n-## Î®ºÏ†Ä ÏûêÏäµÏÑú ÏùΩÍ∏∞\n-\n-Îã§Ïùå ÏÑπÏÖòÏùÄ Ïù¥ÎØ∏ [ÏûêÏäµÏÑú - ÏÇ¨Ïö©Ïûê Í∞ÄÏù¥Îìú: Î≥¥Ïïà](../../tutorial/security/index.md){.internal-link target=_blank} Î¨∏ÏÑúÎ•º ÏùΩÏóàÎã§Í≥† Í∞ÄÏ†ïÌï©ÎãàÎã§.\n-\n-Ïù¥ ÏÑπÏÖòÎì§ÏùÄ Î™®Îëê ÎèôÏùºÌïú Í∞úÎÖêÏùÑ Î∞îÌÉïÏúºÎ°ú ÌïòÎ©∞, Ï∂îÍ∞Ä Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.\n\n```", "output": "Changes look good. This PR implements: üåê Remove translations for removed docs", "source": "pr", "type": "code_review", "pr_number": 612}
{"instruction": "Review the following code changes: üåê Update translations - remove unused files", "input": "```diff\n@@ -1,96 +0,0 @@\n-# Í≥†Í∏â ÎØ∏Îì§Ïõ®Ïñ¥\n-\n-Î©îÏù∏ ÌäúÌÜ†Î¶¨ÏñºÏóêÏÑú [Custom Middleware](../tutorial/middleware.md){.internal-link target=_blank}Î•º ÏùëÏö©ÌîÑÎ°úÍ∑∏Îû®Ïóê Ï∂îÍ∞ÄÌïòÎäî Î∞©Î≤ïÏùÑ ÏùΩÏúºÏÖ®ÏäµÎãàÎã§.\n-\n-Í∑∏Î¶¨Í≥† [CORS with the `CORSMiddleware`](){.internal-link target=_blank}ÌïòÎäî Î∞©Î≤ïÎèÑ Î≥¥ÏÖ®ÏäµÎãàÎã§.\n-\n-Ïù¥ ÏÑπÏÖòÏóêÏÑúÎäî Îã§Î•∏ ÎØ∏Îì§Ïõ®Ïñ¥Îì§ÏùÑ ÏÇ¨Ïö©ÌïòÎäî Î∞©Î≤ïÏùÑ ÏïåÏïÑÎ≥¥Í≤†ÏäµÎãàÎã§.\n-\n-## ASGI ÎØ∏Îì§Ïõ®Ïñ¥ Ï∂îÍ∞ÄÌïòÍ∏∞\n-\n-**FastAPI**Îäî StarletteÏùÑ Í∏∞Î∞òÏúºÎ°ú ÌïòÍ≥† ÏûàÏúºÎ©∞, <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr> ÏÇ¨ÏñëÏùÑ Íµ¨ÌòÑÌïòÎØÄÎ°ú ASGI ÎØ∏Îì§Ïõ®Ïñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-ÎØ∏Îì§Ïõ®Ïñ¥Í∞Ä FastAPIÎÇò StarletteÏö©ÏúºÎ°ú ÎßåÎì§Ïñ¥ÏßÄÏßÄ ÏïäÏïÑÎèÑ ASGI ÏÇ¨ÏñëÏùÑ Ï§ÄÏàòÌïòÎäî Ìïú ÎèôÏûëÌï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-ÏùºÎ∞òÏ†ÅÏúºÎ°ú ASGI ÎØ∏Îì§Ïõ®Ïñ¥Îäî Ï≤´ Î≤àÏß∏ Ïù∏ÏàòÎ°ú ASGI Ïï±ÏùÑ Î∞õÎäî ÌÅ¥ÎûòÏä§Îì§ÏûÖÎãàÎã§.\n-\n-Îî∞ÎùºÏÑú ÌÉÄÏÇ¨ ASGI ÎØ∏Îì§Ïõ®Ïñ¥ Î¨∏ÏÑúÏóêÏÑú ÏùºÎ∞òÏ†ÅÏúºÎ°ú Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏÇ¨Ïö©ÌïòÎèÑÎ°ù ÏïàÎÇ¥Ìï† Í≤ÉÏûÖÎãàÎã§.\n-\n-\n```\n\n```diff\n@@ -1,55 +0,0 @@\n-# OpenAPI ÏõπÌõÖ(Webhooks)\n-\n-API **ÏÇ¨Ïö©Ïûê**ÏóêÍ≤å ÌäπÏ†ï **Ïù¥Î≤§Ìä∏**Í∞Ä Î∞úÏÉùÌï† Îïå *Í∑∏Îì§*Ïùò Ïï±(ÏãúÏä§ÌÖú)Ïóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥ **ÏïåÎ¶º**ÏùÑ Ï†ÑÎã¨Ìï† Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏïåÎ¶¨Í≥† Ïã∂ÏùÄ Í≤ΩÏö∞Í∞Ä ÏûàÏäµÎãàÎã§.\n-\n-Ï¶â, ÏùºÎ∞òÏ†ÅÏúºÎ°ú ÏÇ¨Ïö©ÏûêÍ∞Ä APIÏóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Îäî Í≤ÉÍ≥ºÎäî Î∞òÎåÄÎ°ú, **API**(ÎòêÎäî Ïï±)Í∞Ä **ÏÇ¨Ïö©ÏûêÏùò ÏãúÏä§ÌÖú**(Í∑∏Îì§Ïùò APIÎÇò Ïï±)ÏúºÎ°ú **ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Îäî** ÏÉÅÌô©ÏùÑ ÏùòÎØ∏Ìï©ÎãàÎã§.\n-\n-Ïù¥Î•º ÌùîÌûà **ÏõπÌõÖ(Webhook)**Ïù¥ÎùºÍ≥† Î∂ÄÎ¶ÖÎãàÎã§.\n-\n-## ÏõπÌõÖ Ïä§ÌÖù\n-\n-**ÏΩîÎìúÏóêÏÑú** ÏõπÌõÖÏúºÎ°ú Î≥¥ÎÇº Î©îÏãúÏßÄ, Ï¶â ÏöîÏ≤≠Ïùò **Î∞îÎîî(body)**Î•º Ï†ïÏùòÌïòÎäî Í≤ÉÏù¥ ÏùºÎ∞òÏ†ÅÏù∏ ÌîÑÎ°úÏÑ∏Ïä§ÏûÖÎãàÎã§.\n-\n-Ïï±ÏóêÏÑú Ìï¥Îãπ ÏöîÏ≤≠Ïù¥ÎÇò Ïù¥Î≤§Ìä∏Î•º Ï†ÑÏÜ°Ìï† **ÏãúÏ†ê**ÏùÑ Ï†ïÏùòÌï©ÎãàÎã§.\n-\n-**ÏÇ¨Ïö©Ïûê**Îäî Ïï±Ïù¥ Ìï¥Îãπ ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇº **URL**ÏùÑ Ï†ïÏùòÌï©ÎãàÎã§. (Ïòà: Ïõπ ÎåÄÏãúÎ≥¥ÎìúÏóêÏÑú ÏÑ§Ï†ï)\n-\n-ÏõπÌõÖÏùò URLÏùÑ Îì±Î°ùÌïòÎäî Î∞©Î≤ïÍ≥º Ïù¥Îü¨Ìïú ÏöîÏ≤≠ÏùÑ Ïã§Ï†úÎ°ú Ï†ÑÏÜ°ÌïòÎäî ÏΩîÎìúÏóê ÎåÄÌïú Î™®Îì† Î°úÏßÅÏùÄ Ïó¨Îü¨Î∂ÑÏóêÍ≤å Îã¨Î†§ ÏûàÏäµÎãàÎã§. ÏõêÌïòÎäîÎåÄÎ°ú **Í≥†Ïú†Ïùò ÏΩîÎìú**Î•º ÏûëÏÑ±ÌïòÎ©¥ Îê©ÎãàÎã§.\n-\n-## **FastAPI**ÏôÄ OpenAPIÎ°ú ÏõπÌõÖ Î¨∏ÏÑúÌôîÌïòÍ∏∞\n-\n-**FastAPI**Î•º ÏÇ¨Ïö©ÌïòÏó¨ OpenAPIÏôÄ Ìï®Íªò ÏõπÌõÖÏùò Ïù¥Î¶Ñ, Ïï±Ïù¥ Î≥¥ÎÇº Ïàò ÏûàÎäî HTTP ÏûëÏóÖ Ïú†Ìòï(Ïòà: `POST`, `PUT` Îì±), Í∑∏Î¶¨Í≥† Î≥¥ÎÇº ÏöîÏ≤≠Ïùò **Î∞îÎîî**Î•º Ï†ïÏùòÌï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-Ïù¥Î•º ÌÜµÌï¥ ÏÇ¨Ïö©ÏûêÍ∞Ä **ÏõπÌõÖ** ÏöîÏ≤≠ÏùÑ ÏàòÏã†Ìï† **API Íµ¨ÌòÑ**ÏùÑ Ìõ®Ïî¨ ÏâΩÍ≤å Ìï† Ïàò ÏûàÏúºÎ©∞, Í≤ΩÏö∞Ïóê Îî∞Îùº ÏÇ¨Ïö©Ïûê API ÏΩîÎìúÏùò ÏùºÎ∂ÄÎ•º ÏûêÎèô ÏÉùÏÑ±Ìï† ÏàòÎèÑ ÏûàÏäµÎãàÎã§.\n-\n-/// info\n-\n-ÏõπÌõÖÏùÄ OpenAPI 3.1.0 Ïù¥ÏÉÅÏóêÏÑú ÏßÄÏõêÎêòÎ©∞, FastAPI `0.99.0` Ïù¥ÏÉÅ Î≤ÑÏ†ÑÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n-\n-///\n-\n-## ÏõπÌõÖÏù¥ Ìè¨Ìï®Îêú Ïï± ÎßåÎì§Í∏∞\n-\n-**FastAPI** Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÎßåÎì§ Îïå, `webhooks` ÏÜçÏÑ±ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ *ÏõπÌõÖ*ÏùÑ Ï†ïÏùòÌï† Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îäî `@app.webhooks.post()`ÏôÄ Í∞ôÏùÄ Î∞©ÏãùÏúºÎ°ú *Í≤ΩÎ°ú(path) ÏûëÏóÖ*ÏùÑ Ï†ïÏùòÌïòÎäî Í≤ÉÍ≥º ÎπÑÏä∑Ìï©ÎãàÎã§.\n-\n-{* ../../docs_src/openapi_webhooks/tutorial001.py hl[9:13,36:53] *}\n-\n-Ïù¥Î†áÍ≤å Ï†ïÏùòÌïú ÏõπÌõÖÏùÄ **OpenAPI** Ïä§ÌÇ§ÎßàÏôÄ ÏûêÎèô **Î¨∏ÏÑúÌôî UI**Ïóê ÌëúÏãúÎê©ÎãàÎã§.\n-\n-/// info\n-\n-`app.webhooks` Í∞ùÏ≤¥Îäî ÏÇ¨Ïã§ `APIRouter`Ïùº ÎøêÏù¥Î©∞, Ïó¨Îü¨ ÌååÏùºÎ°ú Ïï±ÏùÑ Íµ¨ÏÑ±Ìï† Îïå ÏÇ¨Ïö©ÌïòÎäî Í≤ÉÍ≥º ÎèôÏùºÌïú ÌÉÄÏûÖÏûÖÎãàÎã§.\n-\n-///\n-\n-ÏõπÌõÖÏóêÏÑúÎäî Ïã§Ï†ú **Í≤ΩÎ°ú(path)** (Ïòà: `/items/`)Î•º ÏÑ†Ïñ∏ÌïòÏßÄ ÏïäÎäî Ï†êÏóê Ïú†ÏùòÌï¥Ïïº Ìï©ÎãàÎã§. Ïó¨Í∏∞ÏÑú Ï†ÑÎã¨ÌïòÎäî ÌÖçÏä§Ìä∏Îäî **ÏãùÎ≥ÑÏûê**Î°ú, ÏõπÌõÖÏùò Ïù¥Î¶Ñ(Ïù¥Î≤§Ìä∏ Ïù¥Î¶Ñ)ÏûÖÎãàÎã§. ÏòàÎ•º Îì§Ïñ¥, `@app.webhooks.post(\"new-subscription\")`ÏóêÏÑú ÏõπÌõÖ Ïù¥Î¶ÑÏùÄ `new-subscription`ÏûÖÎãàÎã§.\n-\n-Ïù¥Îäî Ïã§Ï†ú **URL Í≤ΩÎ°ú**Îäî **ÏÇ¨Ïö©Ïûê**Í∞Ä Îã§Î•∏ Î∞©Î≤ï(Ïòà: Ïõπ ÎåÄÏãúÎ≥¥Îìú)ÏùÑ ÌÜµÌï¥ ÏßÄÏ†ïÌïòÎèÑÎ°ù Í∏∞ÎåÄÎêòÍ∏∞ ÎïåÎ¨∏ÏûÖÎãàÎã§.\n-\n-### Î¨∏ÏÑú ÌôïÏù∏ÌïòÍ∏∞\n-\n-Ïù¥Ï†ú Ïï±ÏùÑ ÏãúÏûëÌïòÍ≥† <a href=\"http://127.0.0.1:8000/docs\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8000/docs</a>Î°ú Ïù¥ÎèôÌï¥ Î¥ÖÏãúÎã§.\n-\n-Î¨∏ÏÑúÏóêÏÑú Í∏∞Ï°¥ *Í≤ΩÎ°ú ÏûëÏóÖ*ÎøêÎßå ÏïÑÎãàÎùº **ÏõπÌõÖ**ÎèÑ ÌëúÏãúÎêú Í≤ÉÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n-\n-<img src=\"/img/tutorial/openapi-webhooks/image01.png\">\n\n```\n\n```diff\n@@ -1,19 +0,0 @@\n-# Í≥†Í∏â Î≥¥Ïïà\n-\n-## Ï∂îÍ∞Ä Í∏∞Îä•\n-\n-[ÏûêÏäµÏÑú - ÏÇ¨Ïö©Ïûê Í∞ÄÏù¥Îìú: Î≥¥Ïïà](../../tutorial/security/index.md){.internal-link target=_blank} Î¨∏ÏÑúÏóêÏÑú Îã§Î£¨ ÎÇ¥Ïö© Ïô∏ÏóêÎèÑ Î≥¥Ïïà Ï≤òÎ¶¨Î•º ÏúÑÌïú Î™á Í∞ÄÏßÄ Ï∂îÍ∞Ä Í∏∞Îä•Ïù¥ ÏûàÏäµÎãàÎã§.\n-\n-/// tip\n-\n-Îã§Ïùå ÏÑπÏÖòÏùÄ **Î∞òÎìúÏãú \"Í≥†Í∏â\"** Í∏∞Îä•ÏùÄ ÏïÑÎãôÎãàÎã§.\n-\n-Í∑∏Î¶¨Í≥† Ïó¨Îü¨Î∂ÑÏùò ÏÇ¨Ïö© ÏÇ¨Î°ÄÏóê Îî∞Îùº, Ï†ÅÌï©Ìïú Ìï¥Í≤∞Ï±ÖÏù¥ Í∑∏ Ï§ë ÌïòÎÇòÏóê ÏûàÏùÑ Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÏäµÎãàÎã§.\n-\n-///\n-\n-## Î®ºÏ†Ä ÏûêÏäµÏÑú ÏùΩÍ∏∞\n-\n-Îã§Ïùå ÏÑπÏÖòÏùÄ Ïù¥ÎØ∏ [ÏûêÏäµÏÑú - ÏÇ¨Ïö©Ïûê Í∞ÄÏù¥Îìú: Î≥¥Ïïà](../../tutorial/security/index.md){.internal-link target=_blank} Î¨∏ÏÑúÎ•º ÏùΩÏóàÎã§Í≥† Í∞ÄÏ†ïÌï©ÎãàÎã§.\n-\n-Ïù¥ ÏÑπÏÖòÎì§ÏùÄ Î™®Îëê ÎèôÏùºÌïú Í∞úÎÖêÏùÑ Î∞îÌÉïÏúºÎ°ú ÌïòÎ©∞, Ï∂îÍ∞Ä Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.\n\n```\n\n```diff\n@@ -1,172 +0,0 @@\n-# Arquivos de Requisi√ß√£o\n-\n-Voc√™ pode definir arquivos para serem enviados para o cliente utilizando `File`.\n-\n-/// info\n-\n-Para receber arquivos compartilhados, primeiro  instale <a href=\"https://github.com/Kludex/python-multipart\" class=\"external-link\" target=\"_blank\">`python-multipart`</a>.\n-\n-E.g. `pip install python-multipart`.\n-\n-Isso se deve por que arquivos enviados s√£o enviados como \"dados de formul√°rio\".\n-\n-///\n-\n-## Importe `File`\n-\n-Importe `File` e `UploadFile` do `fastapi`:\n-\n-{* ../../docs_src/request_files/tutorial001_an_py39.py hl[3] *}\n-\n-## Defina os par√¢metros de `File`\n-\n-Cria os par√¢metros do arquivo da mesma forma que voc√™ faria para `Body` ou `Form`:\n-\n-{* ../../docs_src/request_files/tutorial001_an_py39.py hl[9] *}\n-\n-/// info | Informa√ß√£o\n-\n-`File` √© uma classe que herda diretamente de `Form`.\n-\n-Mas lembre-se que quando voc√™ importa `Query`,`Path`, `File`, entre outros, do `fastapi`, essas s√£o na verdade fun√ß√µes que retornam classes especiais.\n-\n-///\n-\n-/// tip | Dica\n-\n-Para declarar o corpo de arquivos, voc√™ precisa utilizar `File`, do contr√°rio os par√¢metros seriam interpretados como par√¢metros de consulta ou corpo (JSON) da requisi√ß√£o.\n-\n-///\n-\n-Os arquivos ser√£o enviados como \"form data\".\n-\n-Se voc√™ declarar o tipo do seu par√¢metro na sua *fun√ß√£o de opera√ß√£o de rota* como `bytes`, o **FastAPI** ir√° ler o arquivo para voc√™ e voc√™ receber√° o conte√∫do como `bytes`.\n-\n-Lembre-se que isso significa que o conte√∫do inteiro ser√° armazenado em mem√≥ria. Isso funciona bem para arquivos pequenos.\n-\n-Mas existem v√°rios casos em que voc√™ pode se beneficiar ao usar `UploadFile`.\n-\n-## Par√¢metros de arquivo com `UploadFile`\n-\n-Defina um par√¢metro de arquivo com o tipo `UploadFile`\n-\n-{* ../../docs_src/request_files/tutorial001_an_py39.py hl[14] *}\n-\n-Utilizando `UploadFile` tem v√°rias vantagens sobre `bytes`:\n-\n-* Voc√™ n√£o precisa utilizar `File()` como o valor padr√£o do par√¢metro.\n-* A classe utiliza um arquivo em \"spool\":\n-    * Um arquivo guardado em mem√≥ria at√© um tamanho m√°ximo, depois desse limite ele √© guardado em disco.\n-* Isso significa que a classe funciona be", "output": "Changes look good. This PR implements: üåê Update translations - remove unused files", "source": "pr", "type": "code_review", "pr_number": 611}
{"instruction": "Review the following code changes: ‚ú® Add warning when route conflict detected in api routes", "input": "```diff\n@@ -676,6 +676,87 @@ def matches(self, scope: Scope) -> Tuple[Match, Scope]:\n         return match, child_scope\n \n \n+def _detect_route_conflicts(\n+    new_route: \"BaseRoute\",\n+    existing_routes: Sequence[BaseRoute],\n+) -> List[str]:\n+    \"\"\"\n+    Detect and warn about route conflicts.\n+\n+    Checks if route patterns could shadow each other. Only compares routes of the same type\n+    and warns when HTTP methods overlap. Different route types (APIRoute vs WebSocketRoute)\n+    are not compared as they handle different protocols.\n+    \"\"\"\n+    import warnings\n+\n+    conflicts = []\n+\n+    # Only check routes that have path_regex attribute (APIRoute, WebSocketRoute, etc.)\n+    if not hasattr(new_route, \"path_regex\"):\n+        return conflicts\n+\n+    # Cache new_route attributes once before loop for performance\n+    new_methods = getattr(new_route, \"methods\", None)\n+    new_path = getattr(new_route, \"path\", None)\n+    new_path_regex = getattr(new_route, \"path_regex\", None)\n+\n+    # Skip if new route doesn't have path attribute\n+    if new_path is None:\n+        return conflicts\n+\n+    # Build method string for warning message\n+    methods_str = \"\"\n+    if new_methods is not None:\n+        methods_str = f\" ({', '.join(sorted(new_methods))})\"\n+\n+    for existing in existing_routes:\n+        # Only compare routes of the exact same type\n+        if type(new_route) is not type(existing):\n+            continue\n+\n+        # Skip if existing route doesn't have path_regex\n+        if not hasattr(existing, \"path_regex\"):\n+            continue\n+\n+        # Check if methods overlap (both routes must have methods attribute)\n+        existing_methods = getattr(existing, \"methods\", None)\n+        if new_methods is not None and existing_methods is not None:\n+            if not (new_methods & existing_methods):\n+                continue\n+\n+        # Get existing path attributes safely\n+        existing_path = getattr(existing, \"path\", None)\n+\n+        # Skip if existing route doesn't have path attribute\n+        if existing_path is None:\n+            continue\n+\n+        # Skip if paths are identical (route override, not a conflict)\n+        if new_path == existing_path:\n+            continue\n+\n+        # Get existing path_regex attribute safely\n+        existing_path_regex = getattr(existing, \"path_regex\", None)\n+\n+        # Check for shadowing patterns\n+        if new_path_regex and new_path_regex.match(existing_path):\n+            conflicts.append(\n+                f\"Route {new_path}{methods_str} \"\n+                f\"may shadow existing route {existing_path}\"\n+            )\n+        elif existing_path_regex and existing_path_regex.match(new_path):\n+            conflicts.append(\n+                f\"Route {new_path}{methods_str} \"\n+                f\"may be shadowed by existing route {existing_path}\"\n+            )\n+\n+    if conflicts:\n+        for conflict in conflicts:\n+            warnings.warn(conflict, UserWarning, stacklevel=4)\n+\n+    return conflicts\n+\n+\n class A\n\n```\n\n```diff\n@@ -0,0 +1,571 @@\n+import warnings\n+\n+from fastapi import FastAPI\n+from fastapi.routing import APIRouter, _detect_route_conflicts\n+from fastapi.testclient import TestClient\n+from starlette.routing import Mount\n+\n+\n+def test_route_conflict_warning_dynamic_before_static():\n+    \"\"\"Dynamic route registered before static route should warn.\"\"\"\n+    app = FastAPI()\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        @app.get(\"/items/{item_id}\")\n+        def get_item(item_id: str):\n+            return {\"item_id\": item_id}\n+\n+        @app.get(\"/items/sync\")  # This will be shadowed!\n+        def sync_items():\n+            return {\"action\": \"sync\"}\n+\n+        # Should have warning\n+        assert len(w) == 1\n+        assert \"shadow\" in str(w[0].message).lower()\n+        assert \"/items/sync\" in str(w[0].message)\n+        assert \"/items/{item_id}\" in str(w[0].message)\n+\n+\n+def test_route_conflict_warning_static_before_dynamic():\n+    \"\"\"Static route before dynamic should work but warn about potential conflict.\"\"\"\n+    app = FastAPI()\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        @app.get(\"/items/sync\")\n+        def sync_items():\n+            return {\"action\": \"sync\"}\n+\n+        @app.get(\"/items/{item_id}\")\n+        def get_item(item_id: str):\n+            return {\"item_id\": item_id}\n+\n+        # Should warn about potential conflict\n+        assert len(w) == 1\n+        assert \"shadow\" in str(w[0].message).lower()\n+\n+\n+def test_no_conflict_different_methods():\n+    \"\"\"Different HTTP methods should not conflict.\"\"\"\n+    app = FastAPI()\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        @app.get(\"/items/{item_id}\")\n+        def get_item(item_id: str):\n+            return {\"item_id\": item_id}\n+\n+        @app.post(\"/items/sync\")\n+        def sync_items():\n+            return {\"action\": \"sync", "output": "Code Review for: ‚ú® Add warning when route conflict detected in api routes\n\nüìù **tests/test_route_conflicts.py**: I think this is absolutely normal situation and FastAPI shouldn't warn in this case\n\n", "source": "pr", "type": "code_review", "pr_number": 610}
{"instruction": "Review this code change in `tests/test_route_conflicts.py`", "input": "```diff\n@@ -0,0 +1,571 @@\n+import warnings\n+\n+from fastapi import FastAPI\n+from fastapi.routing import APIRouter, _detect_route_conflicts\n+from fastapi.testclient import TestClient\n+from starlette.routing import Mount\n+\n+\n+def test_route_conflict_warning_dynamic_before_static():\n+    \"\"\"Dynamic route registered before static route should warn.\"\"\"\n+    app = FastAPI()\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        @app.get(\"/items/{item_id}\")\n+        def get_item(item_id: str):\n+            return {\"item_id\": item_id}\n+\n+        @app.get(\"/items/sync\")  # This will be shadowed!\n+        def sync_items():\n+            return {\"action\": \"sync\"}\n+\n+        # Should have warning\n+        assert len(w) == 1\n+        assert \"shadow\" in str(w[0].message).lower()\n+        assert \"/items/sync\" in str(w[0].message)\n+        assert \"/items/{item_id}\" in str(w[0].message)\n+\n+\n+def test_route_conflict_warning_static_before_dynamic():\n+    \"\"\"Static route before dynamic should work but warn about potential conflict.\"\"\"\n+    app = FastAPI()\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        @app.get(\"/items/sync\")\n+        def sync_items():\n+            return {\"action\": \"sync\"}\n+\n+        @app.get(\"/items/{item_id}\")\n+        def get_item(item_id: str):\n+            return {\"item_id\": item_id}\n+\n+        # Should warn about potential conflict\n+        assert len(w) == 1\n\n```", "output": "I think this is absolutely normal situation and FastAPI shouldn't warn in this case", "source": "pr_review", "type": "inline_review", "pr_number": 610}
{"instruction": "Review the following code changes: Refactor request validation and dependency handling", "input": "```diff\n@@ -736,7 +736,7 @@ def _validate_value_with_model_field(\n ) -> Tuple[Any, List[Any]]:\n     if value is None:\n         if field.required:\n-            return None, [get_missing_field_error(loc=loc)]\n+            return None, []\n         else:\n             return deepcopy(field.default), []\n     v_, errors_ = field.validate(value, values, loc=loc)\n@@ -796,7 +796,7 @@ def request_params_to_args(\n             first_field.field_info, \"convert_underscores\", True\n         )\n \n-    params_to_process: Dict[str, Any] = {}\n+    data: Dict[str, Any] = {}\n \n     processed_keys = set()\n \n@@ -814,19 +814,19 @@ def request_params_to_args(\n                     alias = alias.replace(\"_\", \"-\")\n         value = _get_multidict_value(field, received_params, alias=alias)\n         if value is not None:\n-            params_to_process[get_validation_alias(field)] = value\n+            data[get_validation_alias(field)] = value\n         processed_keys.add(alias or get_validation_alias(field))\n \n     for key in received_params.keys():\n         if key not in processed_keys:\n             if hasattr(received_params, \"getlist\"):\n                 value = received_params.getlist(key)\n                 if isinstance(value, list) and (len(value) == 1):\n-                    params_to_process[key] = value[0]\n+                    data[key] = value[0]\n                 else:\n-                    params_to_process[key] = value\n+                    data[key] = value\n             else:\n-                params_to_process[key] = received_params.get(key)\n+                data[key] = received_params.get(key)\n \n     if single_not_embedded_field:\n         field_info = first_field.field_info\n@@ -835,7 +835,7 @@ def request_params_to_args(\n         )\n         loc: Tuple[str, ...] = (field_info.in_.value,)\n         v_, errors_ = _validate_value_with_model_field(\n-            field=first_field, value=params_to_process, values=values, loc=loc\n+            field=first_field, value=data, values=values, loc=loc\n         )\n         return {first_field.name: v_}, errors_\n \n\n```", "output": "Changes look good. This PR implements: Refactor request validation and dependency handling", "source": "pr", "type": "code_review", "pr_number": 609}
{"instruction": "Review the following code changes: üìù Update async tests and documentation", "input": "```diff\n@@ -1,15 +1,20 @@\n-# Async Tests\n+# Async Tests with Lifespan Trigger\n \n-You have already seen how to test your **FastAPI** applications using the provided `TestClient`. Up to now, you have only seen how to write synchronous tests, without using `async` functions.\n+You‚Äôve already seen how to test your **FastAPI** applications using `TestClient`. So far, you‚Äôve primarily written synchronous tests using def functions.\n \n-Being able to use asynchronous functions in your tests could be useful, for example, when you're querying your database asynchronously. Imagine you want to test sending requests to your FastAPI application and then verify that your backend successfully wrote the correct data in the database, while using an async database library.\n-\n-Let's look at how we can make that work.\n+However, asynchronous test functions can be useful, especially when querying your database asynchronously. For instance, you may want to test that sending requests to your **FastAPI** app successfully writes correct data to the database using an async library. Let‚Äôs explore how to achieve this.\n \n ## pytest.mark.anyio\n \n If we want to call asynchronous functions in our tests, our test functions have to be asynchronous. AnyIO provides a neat plugin for this, that allows us to specify that some test functions are to be called asynchronously.\n \n+/// note\n+\n+You can also use <a href=\"https://pytest-asyncio.readthedocs.io/en/latest/\" class=\"external-link\" target=\"_blank\">PyTest asyncio</a>.\n+\n+///\n+\n+\n ## HTTPX\n \n Even if your **FastAPI** application uses normal `def` functions instead of `async def`, it is still an `async` application underneath.\n@@ -25,9 +30,9 @@ For a simple example, let's consider a file structure similar to the one describ\n \n```\n\n```diff\n@@ -1,8 +1,24 @@\n-from fastapi import FastAPI\n+from contextlib import asynccontextmanager\n \n-app = FastAPI()\n+from fastapi import Depends, FastAPI, Request\n+\n+\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    # Initialize a shared state when the app starts\n+    app.state.some_state = \"some_state_open\"\n+    yield\n+    # Cleanup the shared state when the app shuts down\n+    app.state.some_state = \"some_state_close\"\n+\n+\n+async def get_some_state(request: Request):\n+    return request.app.state.some_state\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.get(\"/\")\n-async def root():\n-    return {\"message\": \"Tomato\"}\n+async def root(some_state=Depends(get_some_state)):\n+    return {\"message\": some_state}\n\n```\n\n```diff\n@@ -1,14 +1,21 @@\n import pytest\n from httpx import ASGITransport, AsyncClient\n \n-from .main import app\n+from .main import app, lifespan\n \n \n @pytest.mark.anyio\n async def test_root():\n     async with AsyncClient(\n         transport=ASGITransport(app=app), base_url=\"http://test\"\n-    ) as ac:\n-        response = await ac.get(\"/\")\n-    assert response.status_code == 200\n-    assert response.json() == {\"message\": \"Tomato\"}\n+    ) as client:\n+        async with lifespan(app=app):\n+            # Send a GET request to the root endpoint\n+            response = await client.get(\"/\")\n+            # Verify that the response is successful\n+            assert response.status_code == 200\n+            # Verify that the app's state is initialized\n+            assert response.json() == {\"message\": \"some_state_open\"}\n+\n+    # Verify that the app's state is cleaned up\n+    assert app.state.some_state == \"some_state_close\"\n\n```\n\n```diff\n@@ -54,46 +59,31 @@ $ pytest\n \n ## In Detail\n \n-The marker `@pytest.mark.anyio` tells pytest that this test function should be called asynchronously:\n+The lifespan function demonstrates how to manage the lifecycle of application-wide resources. During the app's lifespan, we open a resource (`some_state_open`) at startup and clean it up (`some_state_close`) during shutdown.\n \n-{* ../../docs_src/async_tests/test_main.py hl[7] *}\n+We use **ASGITransport** from **HTTPX** to interact directly with the **FastAPI** app in an async test environment.\n \n-/// tip\n+When testing **FastAPI** apps with a custom lifespan, it's critical to manually trigger it in the test context to ensure proper setup and teardown of resources.\n \n-Note that the test function is now `async def` instead of just `def` as before when using the `TestClient`.\n+If you observe issues with state initialization or teardown in your tests, ensure that the lifespan is correctly invoked, and verify the app's state before and after requests.\n \n-///\n-\n-Then we can create an `AsyncClient` with the app, and send async requests to it, using `await`.\n-\n-{* ../../docs_src/async_tests/test_main.py hl[9:12] *}\n-\n-This is the equivalent to:\n-\n-\n```\n\n```diff\n@@ -54,46 +59,31 @@ $ pytest\n \n ## In Detail\n \n-The marker `@pytest.mark.anyio` tells pytest that this test function should be called asynchronously:\n+The lifespan function demonstrates how to manage the lifecycle of application-wide resources. During the app's lifespan, we open a resource (`some_state_open`) at startup and clean it up", "output": "Code Review for: üìù Update async tests and documentation\n\nüìù **docs/en/docs/advanced/async-tests.md**: event loop policy is deprecated in 3.14 and will be removed\n\nüìù **docs/en/docs/advanced/async-tests.md**: this fixture isn't used by the anyio plugin\n\nüìù **docs/en/docs/advanced/async-tests.md**: This advice is wrong, the existing advice was correct\n\nüìù **docs/en/docs/advanced/async-tests.md**: The deprecated event loop policy is still being used here\n\nüìù **docs/en/docs/advanced/async-tests.md**: This just scopes the same loop for the whole session, each test function should get a fresh loop. The only way to fix this issue is to fix the underlying code that uses a global database connection to make it in lifespan_context\n\n", "source": "pr", "type": "code_review", "pr_number": 608}
{"instruction": "Review this code change in `docs/en/docs/advanced/async-tests.md`", "input": "```diff\n@@ -54,46 +59,31 @@ $ pytest\n \n ## In Detail\n \n-The marker `@pytest.mark.anyio` tells pytest that this test function should be called asynchronously:\n+The lifespan function demonstrates how to manage the lifecycle of application-wide resources. During the app's lifespan, we open a resource (`some_state_open`) at startup and clean it up (`some_state_close`) during shutdown.\n \n-{* ../../docs_src/async_tests/test_main.py hl[7] *}\n+We use **ASGITransport** from **HTTPX** to interact directly with the **FastAPI** app in an async test environment.\n \n-/// tip\n+When testing **FastAPI** apps with a custom lifespan, it's critical to manually trigger it in the test context to ensure proper setup and teardown of resources.\n \n-Note that the test function is now `async def` instead of just `def` as before when using the `TestClient`.\n+If you observe issues with state initialization or teardown in your tests, ensure that the lifespan is correctly invoked, and verify the app's state before and after requests.\n \n-///\n-\n-Then we can create an `AsyncClient` with the app, and send async requests to it, using `await`.\n-\n-{* ../../docs_src/async_tests/test_main.py hl[9:12] *}\n-\n-This is the equivalent to:\n-\n-```Python\n-response = client.get('/')\n-```\n-\n-...that we used to make our requests with the `TestClient`.\n-\n-/// tip\n-\n-Note that we're using async/await with the new `AsyncClient` - the request is asynchronous.\n-\n-///\n-\n-/// warning\n-\n-If your application relies on lifespan events, the `AsyncClient` won't trigger these events. To ensure they are triggered, use `LifespanManager` from <a href=\"https://github.com/florimondmanca/asgi-lifespan#usage\" class=\"external-link\" target=\"_blank\">florimondmanca/asgi-lifespan</a>.\n-\n-///\n \n ## Other Asynchronous Function Calls\n \n-As the testing function is now asynchronous, you can now also call (and `await`) other `async` functions apart from sending requests to your FastAPI application in your tests, exactly as you would call them anywhere else in your code.\n+As the testing function is now asynchronous, you can now also call (and await) other async functions apart from sending requests to your FastAPI application in your tests, exactly as you would call them anywhere else in your code.\n \n /// tip\n \n-If you encounter a `RuntimeError: Task attached to a different loop` when integrating asynchronous function calls in your tests (e.g. when using <a href=\"https://stackoverflow.com/questions/41584243/runtimeerror-task-attached-to-a-different-loop\" class=\"external-link\" target=\"_blank\">MongoDB's MotorClient</a>), remember to instantiate objects that need an event loop only within async functions, e.g. an `'@app.on_event(\"startup\")` callback.\n+If you encounter a `RuntimeError: Task attached to a different loop` when integrating asynchronous function calls in your tests, you can override the default pytest event loop using the following fixture:\n+\n+```python\n+@pytest.fixture(scope=\"session\")\n+def event_loop() -> Generator[AbstractEventLoop, None, None]:\n+    \"\"\"Overrides pytest default function scoped event loop\"\"\"\n+    policy = asyncio.get_event_loop_policy()\n\n```", "output": "event loop policy is deprecated in 3.14 and will be removed", "source": "pr_review", "type": "inline_review", "pr_number": 608}
{"instruction": "Review this code change in `docs/en/docs/advanced/async-tests.md`", "input": "```diff\n@@ -54,46 +59,34 @@ $ pytest\n \n ## In Detail\n \n-The marker `@pytest.mark.anyio` tells pytest that this test function should be called asynchronously:\n+The lifespan function demonstrates how to manage the lifecycle of application-wide resources. During the app's lifespan, we open a resource (`some_state_open`) at startup and clean it up (`some_state_close`) during shutdown.\n \n-{* ../../docs_src/async_tests/test_main.py hl[7] *}\n+We use **ASGITransport** from **HTTPX** to interact directly with the **FastAPI** app in an async test environment.\n \n-/// tip\n-\n-Note that the test function is now `async def` instead of just `def` as before when using the `TestClient`.\n-\n-///\n-\n-Then we can create an `AsyncClient` with the app, and send async requests to it, using `await`.\n+When testing **FastAPI** apps with a custom lifespan, it's critical to manually trigger it in the test context to ensure proper setup and teardown of resources.\n \n-{* ../../docs_src/async_tests/test_main.py hl[9:12] *}\n+If you observe issues with state initialization or teardown in your tests, ensure that the lifespan is correctly invoked, and verify the app's state before and after requests.\n \n-This is the equivalent to:\n \n-```Python\n-response = client.get('/')\n-```\n+## Other Asynchronous Function Calls\n \n-...that we used to make our requests with the `TestClient`.\n+As the testing function is now asynchronous, you can now also call (and await) other async functions apart from sending requests to your FastAPI application in your tests, exactly as you would call them anywhere else in your code.\n \n /// tip\n \n-Note that we're using async/await with the new `AsyncClient` - the request is asynchronous.\n-\n-///\n-\n-/// warning\n+If you encounter a `RuntimeError: Task attached to a different loop` when integrating asynchronous function calls in your tests, you can override the default pytest event loop using the following fixture:\n \n-If your application relies on lifespan events, the `AsyncClient` won't trigger these events. To ensure they are triggered, use `LifespanManager` from <a href=\"https://github.com/florimondmanca/asgi-lifespan#usage\" class=\"external-link\" target=\"_blank\">florimondmanca/asgi-lifespan</a>.\n+```python\n+import asyncio\n+import pytest\n+from collections.abc import Generator\n \n-///\n+@pytest.fixture(scope=\"session\")\n+def event_loop() -> Generator[asyncio.AbstractEventLoop, None, None]:\n\n```", "output": "This just scopes the same loop for the whole session, each test function should get a fresh loop. The only way to fix this issue is to fix the underlying code that uses a global database connection to make it in lifespan_context", "source": "pr_review", "type": "inline_review", "pr_number": 608}
{"instruction": "Review this code change in `docs/en/docs/advanced/async-tests.md`", "input": "```diff\n@@ -54,46 +59,40 @@ $ pytest\n \n ## In Detail\n \n-The marker `@pytest.mark.anyio` tells pytest that this test function should be called asynchronously:\n-\n-{* ../../docs_src/async_tests/test_main.py hl[7] *}\n+The lifespan function demonstrates how to manage the lifecycle of application-wide resources. During the app's lifespan, we open a resource (`some_state_open`) at startup and clean it up (`some_state_close`) during shutdown.\n \n-/// tip\n+We use **ASGITransport** from **HTTPX** to interact directly with the **FastAPI** app in an async test environment.\n \n-Note that the test function is now `async def` instead of just `def` as before when using the `TestClient`.\n+When testing **FastAPI** apps with a custom lifespan, it's critical to manually trigger it in the test context to ensure proper setup and teardown of resources.\n \n-///\n+If you observe issues with state initialization or teardown in your tests, ensure that the lifespan is correctly invoked, and verify the app's state before and after requests.\n \n-Then we can create an `AsyncClient` with the app, and send async requests to it, using `await`.\n \n-{* ../../docs_src/async_tests/test_main.py hl[9:12] *}\n+## Other Asynchronous Function Calls\n \n-This is the equivalent to:\n+As the testing function is now asynchronous, you can now also call (and await) other async functions apart from sending requests to your FastAPI application in your tests, exactly as you would call them anywhere else in your code.\n \n-```Python\n-response = client.get('/')\n-```\n+//// tip\n \n-...that we used to make our requests with the `TestClient`.\n+If you encounter a `RuntimeError: Task attached to a different loop` when integrating asynchronous function calls in your tests, you can override the default pytest event loop using the following fixture:\n \n-/// tip\n+```python\n+import asyncio\n+import pytest\n+from collections.abc import Generator\n \n-Note that we're using async/await with the new `AsyncClient` - the request is asynchronous.\n+@pytest.fixture(scope=\"function\")\n+def event_loop() -> Generator[asyncio.AbstractEventLoop, None, None]:\n\n```", "output": "Not sure about this part.\r\nWe recommend using `pytest.mark.anyio`, but this fixture is tied to `asyncio` (`pytest-asyncio`?).", "source": "pr_review", "type": "inline_review", "pr_number": 608}
{"instruction": "Review the following code changes: Docs second pr", "input": "```diff\n@@ -8,7 +8,7 @@\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+   <em>FastAPI framework: high performance, easy to learn, fast to code, and ready for production</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -123,7 +123,9 @@ The key features are:\n \n If you are building a <abbr title=\"Command Line Interface\">CLI</abbr> app to be used in the terminal instead of a web API, check out <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n \n-**Typer** is FastAPI's little sibling. And it's intended to be the **FastAPI of CLIs**. ‚å®Ô∏è üöÄ\n+**Typer** is FastAPI's little sibling, intended to be the **FastAPI of CLIs**.\n+\n+üöÄ\n \n ## Requirements { #requirements }\n \n\n```", "output": "Changes look good. This PR implements: Docs second pr", "source": "pr", "type": "code_review", "pr_number": 607}
{"instruction": "Review the following code changes: üë∑ Update github-actions user for GitHub Actions workflows", "input": "```diff\n@@ -282,9 +282,10 @@ def main() -> None:\n         return\n \n     logging.info(\"Setting up GitHub Actions git user\")\n-    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions\"], check=True)\n+    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions[bot]\"], check=True)\n     subprocess.run(\n-        [\"git\", \"config\", \"user.email\", \"github-actions@github.com\"], check=True\n+        [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n+        check=True,\n     )\n     branch_name = f\"fastapi-people-contributors-{secrets.token_hex(4)}\"\n     logging.info(f\"Creating a new branch {branch_name}\")\n\n```\n\n```diff\n@@ -378,9 +378,10 @@ def main() -> None:\n         return\n \n     logging.info(\"Setting up GitHub Actions git user\")\n-    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions\"], check=True)\n+    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions[bot]\"], check=True)\n     subprocess.run(\n-        [\"git\", \"config\", \"user.email\", \"github-actions@github.com\"], check=True\n+        [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n+        check=True,\n     )\n     branch_name = f\"fastapi-people-experts-{secrets.token_hex(4)}\"\n     logging.info(f\"Creating a new branch {branch_name}\")\n\n```\n\n```diff\n@@ -190,9 +190,10 @@ def main() -> None:\n         return\n \n     logging.info(\"Setting up GitHub Actions git user\")\n-    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions\"], check=True)\n+    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions[bot]\"], check=True)\n     subprocess.run(\n-        [\"git\", \"config\", \"user.email\", \"github-actions@github.com\"], check=True\n+        [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n+        check=True,\n     )\n     branch_name = f\"fastapi-people-sponsors-{secrets.token_hex(4)}\"\n     logging.info(f\"Creating a new branch {branch_name}\")\n\n```\n\n```diff\n@@ -56,9 +56,10 @@ def main() -> None:\n         return\n     repos_path.write_text(new_repos_content, encoding=\"utf-8\")\n     logging.info(\"Setting up GitHub Actions git user\")\n-    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions\"], check=True)\n+    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions[bot]\"], check=True)\n     subprocess.run(\n-        [\"git\", \"config\", \"user.email\", \"github-actions@github.com\"], check=True\n+        [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n+        check=True,\n     )\n     branch_name = f\"fastapi-topic-repos-{secrets.token_hex(4)}\"\n     logging.info(f\"Creating a new branch {branch_name}\")\n\n```\n\n```diff\n@@ -947,9 +947,10 @@ def make_pr(\n     if not repo.is_dirty(untracked_files=True):\n         print(\"Repository is clean, no changes to commit\")\n         return\n-    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions\"], check=True)\n+    subprocess.run([\"git\", \"config\", \"user.name\", \"github-actions[bot]\"], check=True)\n     subprocess.run(\n-        [\"git\", \"config\", \"user.email\", \"github-actions@github.com\"], check=True\n+        [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n+        check=True,\n     )\n     branch_name = \"translate\"\n     if language:\n\n```", "output": "Changes look good. This PR implements: üë∑ Update github-actions user for GitHub Actions workflows", "source": "pr", "type": "code_review", "pr_number": 606}
{"instruction": "Review the following code changes: üë∑ Update LLM translation CI, add language matrix and extra commands, prepare for scheduled run", "input": "```diff\n@@ -16,7 +16,7 @@ on:\n           - update-outdated\n           - add-missing\n           - update-and-add\n-          - remove-all-removable\n+          - remove-removable\n       language:\n         description: Language to translate to as a letter code (e.g. \"es\" for Spanish)\n         type: string\n@@ -32,9 +32,42 @@ env:\n   UV_SYSTEM_PYTHON: 1\n \n jobs:\n-  job:\n+  langs:\n+    runs-on: ubuntu-latest\n+    outputs:\n+      langs: ${{ steps.show-langs.outputs.langs }}\n+      commands: ${{ steps.show-langs.outputs.commands }}\n+    steps:\n+      - uses: actions/checkout@v6\n+      - name: Set up Python\n+        uses: actions/setup-python@v6\n+        with:\n+          python-version: \"3.11\"\n+      - name: Setup uv\n+        uses: astral-sh/setup-uv@v7\n+        with:\n+          cache-dependency-glob: |\n+            requirements**.txt\n+            pyproject.toml\n+      - name: Install Dependencies\n+        run: uv pip install -r requirements-github-actions.txt -r requirements-translations.txt\n+      - name: Export Language Codes\n+        id: show-langs\n+        run: |\n+          echo \"langs=$(python ./scripts/translate.py llm-translatable-json)\" >> $GITHUB_OUTPUT\n+          echo \"commands=$(python ./scripts/translate.py commands-json)\" >> $GITHUB_OUTPUT\n+        env:\n+          LANGUAGE: ${{ github.event.inputs.language }}\n+          COMMAND: ${{ github.event.inputs.command }}\n+\n+  translate:\n     if: github.repository_owner == 'fastapi'\n+    needs: langs\n     runs-on: ubuntu-latest\n+    strategy:\n+      matrix:\n+        lang: ${{ fromJson(needs.langs.outputs.langs) }}\n+        command: ${{ fromJson(needs.langs.outputs.commands) }}\n     permissions:\n       contents: write\n     steps:\n@@ -50,8 +83,6 @@ jobs:\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n-          enable-cache: true\n           cache-dependency-glob: |\n             requirements**.txt\n             pyproject.toml\n@@ -68,10 +99,11 @@ jobs:\n           OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n       - name: FastAPI Translate\n         run: |\n-          python ./scripts/translate.py ${{ github.event.inputs.command }}\n+          python ./scripts/translate.py ${{ matrix.command }}\n           python ./scripts/translate.py make-pr\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_TRANSLATIONS }}\n           OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}\n-          LANGUAGE: ${{ github.event.inputs.language }}\n+          LANGUAGE: ${{ matrix.lang }}\n           EN_PATH: ${{ github.event.inputs.en_path }}\n+          COMMAND: ${{ matrix.command }}\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+import json\n import secrets\n import subprocess\n from collections.abc import Iterable\n@@ -828,6 +829,65 @@ def translate_lang(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) ->\n         print(f\"Done translating: {p}\")\n \n \n+def get_llm_translatable() -> list[str]:\n+    translatable_langs = []\n+    langs = get_langs()\n+    for lang in langs:\n+        if lang == \"en\":\n+            continue\n+        lang_prompt_path = Path(f\"docs/{lang}/llm-prompt.md\")\n+        if lang_prompt_path.exists():\n+            translatable_langs.append(lang)\n+    return translatable_langs\n+\n+\n+@app.command()\n+def list_llm_translatable() -> list[str]:\n+    translatable_langs = get_llm_translatable()\n+    print(\"LLM translatable languages:\", translatable_langs)\n+    return translatable_langs\n+\n+\n+@app.command()\n+def llm_translatable_json(\n+    language: Annotated[str | None, typer.Option(envvar=\"LANGUAGE\")] = None,\n+) -> None:\n+    translatable_langs = get_llm_translatable()\n+    if language:\n+        if language in translatable_langs:\n+            print(json.dumps([language]))\n+            return\n+        else:\n+            raise typer.Exit(code=1)\n+    print(json.dumps(translatable_langs))\n+\n+\n+@app.command()\n+def commands_json(\n+    command: Annotated[str | None, typer.Option(envvar=\"COMMAND\")] = None,\n+) -> None:\n+    available_commands = [\n+        \"translate-page\",\n+        \"translate-lang\",\n+        \"update-outdated\",\n+        \"add-missing\",\n+        \"update-and-add\",\n+        \"remove-removable\",\n+    ]\n+    default_commands = [\n+        \"remove-removable\",\n+        \"update-outdated\",\n+        \"add-missing\",\n+    ]\n+    if command:\n+        if command in available_commands:\n+            print(json.dumps([command]))\n+            return\n+        else:\n+            raise typer.Exit(code=1)\n+    print(json.dumps(default_commands))\n+\n+\n @app.command()\n def list_removable(language: str) -> list[Path]:\n     removable_paths: list[Path] = []\n@@ -939,6 +999,7 @@ def update_and_add(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) ->\n def make_pr(\n     *,\n     language: Annotated[str | None, typer.Option(envvar=\"LANGUAGE\")] = None,\n+    command: Annotated[str | None, typer.Option(envvar=\"COMMAND\")] = None,\n     github_token: Annotated[str, typer.Option(envvar=\"GITHUB_TOKEN\")],\n     github_repository: Annotated[str, typer.Option(envvar=\"GI", "output": "Changes look good. This PR implements: üë∑ Update LLM translation CI, add language matrix and extra commands, prepare for scheduled run", "source": "pr", "type": "code_review", "pr_number": 605}
{"instruction": "Fix the following bug: üë∑ Fix Typer command for CI LLM translations", "input": "üë∑ Fix Typer command for CI LLM translations", "output": "```diff\n@@ -914,7 +914,7 @@ def list_all_removable() -> list[Path]:\n \n \n @app.command()\n-def remove_removable(language: str) -> None:\n+def remove_removable(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n     removable_paths = list_removable(language)\n     for path in removable_paths:\n         path.unlink()\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 604}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -914,7 +914,7 @@ def list_all_removable() -> list[Path]:\n \n \n @app.command()\n-def remove_removable(language: str) -> None:\n+def remove_removable(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n     removable_paths = list_removable(language)\n     for path in removable_paths:\n         path.unlink()\n\n```", "output": "Bug: üë∑ Fix Typer command for CI LLM translations\n\nüë∑ Fix Typer command for CI LLM translations", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 604}
{"instruction": "Review the following code changes: üë∑ Fix Typer command for CI LLM translations", "input": "```diff\n@@ -914,7 +914,7 @@ def list_all_removable() -> list[Path]:\n \n \n @app.command()\n-def remove_removable(language: str) -> None:\n+def remove_removable(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n     removable_paths = list_removable(language)\n     for path in removable_paths:\n         path.unlink()\n\n```", "output": "Changes look good. This PR implements: üë∑ Fix Typer command for CI LLM translations", "source": "pr", "type": "code_review", "pr_number": 604}
{"instruction": "Fix the following bug: üë∑ Fix checkout GitHub Action fetch-depth for LLM translations, enable cron monthly", "input": "üë∑ Fix checkout GitHub Action fetch-depth for LLM translations, enable cron monthly", "output": "```diff\n@@ -1,6 +1,9 @@\n name: Translate\n \n on:\n+  schedule:\n+    - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n+\n   workflow_dispatch:\n     inputs:\n       debug_enabled:\n@@ -76,6 +79,8 @@ jobs:\n           GITHUB_CONTEXT: ${{ toJson(github) }}\n         run: echo \"$GITHUB_CONTEXT\"\n       - uses: actions/checkout@v6\n+        with:\n+          fetch-depth: 0\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 603}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,6 +1,9 @@\n name: Translate\n \n on:\n+  schedule:\n+    - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n+\n   workflow_dispatch:\n     inputs:\n       debug_enabled:\n@@ -76,6 +79,8 @@ jobs:\n           GITHUB_CONTEXT: ${{ toJson(github) }}\n         run: echo \"$GITHUB_CONTEXT\"\n       - uses: actions/checkout@v6\n+        with:\n+          fetch-depth: 0\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n\n```", "output": "Bug: üë∑ Fix checkout GitHub Action fetch-depth for LLM translations, enable cron monthly\n\nüë∑ Fix checkout GitHub Action fetch-depth for LLM translations, enable cron monthly", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 603}
{"instruction": "Review the following code changes: üë∑ Fix checkout GitHub Action fetch-depth for LLM translations, enable cron monthly", "input": "```diff\n@@ -1,6 +1,9 @@\n name: Translate\n \n on:\n+  schedule:\n+    - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n+\n   workflow_dispatch:\n     inputs:\n       debug_enabled:\n@@ -76,6 +79,8 @@ jobs:\n           GITHUB_CONTEXT: ${{ toJson(github) }}\n         run: echo \"$GITHUB_CONTEXT\"\n       - uses: actions/checkout@v6\n+        with:\n+          fetch-depth: 0\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n\n```", "output": "Changes look good. This PR implements: üë∑ Fix checkout GitHub Action fetch-depth for LLM translations, enable cron monthly", "source": "pr", "type": "code_review", "pr_number": 603}
{"instruction": "Review the following code changes: üåê Update translations for es (add-missing)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# Archivo de prueba de LLM { #llm-test-file }\n+\n+Este documento prueba si el <abbr title=\"Large Language Model ‚Äì Modelo de lenguaje grande\">LLM</abbr>, que traduce la documentaci√≥n, entiende el `general_prompt` en `scripts/translate.py` y el prompt espec√≠fico del idioma en `docs/{language code}/llm-prompt.md`. El prompt espec√≠fico del idioma se agrega al final de `general_prompt`.\n+\n+Las pruebas a√±adidas aqu√≠ ser√°n vistas por todas las personas que dise√±an prompts espec√≠ficos del idioma.\n+\n+√ösalo de la siguiente manera:\n+\n+* Ten un prompt espec√≠fico del idioma ‚Äì `docs/{language code}/llm-prompt.md`.\n+* Haz una traducci√≥n fresca de este documento a tu idioma destino (mira, por ejemplo, el comando `translate-page` de `translate.py`). Esto crear√° la traducci√≥n en `docs/{language code}/docs/_llm-test.md`.\n+* Comprueba si todo est√° bien en la traducci√≥n.\n+* Si es necesario, mejora tu prompt espec√≠fico del idioma, el prompt general, o el documento en ingl√©s.\n+* Luego corrige manualmente los problemas restantes en la traducci√≥n para que sea una buena traducci√≥n.\n+* Vuelve a traducir, teniendo la buena traducci√≥n en su lugar. El resultado ideal ser√≠a que el LLM ya no hiciera cambios a la traducci√≥n. Eso significa que el prompt general y tu prompt espec√≠fico del idioma est√°n tan bien como pueden estar (a veces har√° algunos cambios aparentemente aleatorios; la raz√≥n es que <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">los LLMs no son algoritmos deterministas</a>).\n+\n+Las pruebas:\n+\n+## Fragmentos de c√≥digo { #code-snippets }\n+\n+//// tab | Prueba\n+\n+Este es un fragmento de c√≥digo: `foo`. Y este es otro fragmento de c√≥digo: `bar`. Y otro m√°s: `baz quux`.\n+\n+////\n+\n+//// tab | Informaci√≥n\n+\n+El contenido de los fragmentos de c√≥digo debe dejarse tal cual.\n+\n+Consulta la secci√≥n `### Content of code snippets` en el prompt general en `scripts/translate.py`.\n+\n+////\n+\n+## Comillas { #quotes }\n+\n+//// tab | Prueba\n+\n+Ayer, mi amigo escribi√≥: \"Si escribes 'incorrectly' correctamente, lo habr√°s escrito incorrectamente\". A lo que respond√≠: \"Correcto, pero 'incorrectly' est√° incorrecto, no '\"incorrectly\"'\".\n+\n+/// note | Nota\n+\n+El LLM probablemente traducir√° esto mal. Lo interesante es si mantiene la traducci√≥n corregida al volver a traducir.\n+\n+///\n+\n+////\n+\n+//// tab | Informaci√≥n\n+\n+La persona que dise√±a el prompt puede elegir si quiere convertir comillas neutras a comillas tipogr√°ficas. Tambi√©n est√° bien dejarlas como est√°n.\n+\n+Consulta por ejemplo la secci√≥n `### Quotes` en `docs/de/llm-prompt.md`.\n+\n+////\n+\n+## Comillas en fragmentos de c√≥digo { #quotes-in-code-snippets }\n+\n+//// tab | Prueba\n+\n+`pip install \"foo[bar]\"`\n+\n+Ejemplos de literales de string en fragmentos de c√≥digo: `\"this\"`, `'that'`.\n+\n+Un ejemplo dif√≠cil de literales de string en fragmentos de c√≥digo: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+Hardcore: `Yesterday, my friend wrote: \"If you spell incorrectly cor\n\n```\n\n```diff\n@@ -0,0 +1,65 @@\n+# FastAPI Cloud { #fastapi-cloud }\n+\n+Puedes desplegar tu app de FastAPI en <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a> con un solo comando; ve y √∫nete a la lista de espera si a√∫n no lo has hecho. üöÄ\n+\n+## Iniciar sesi√≥n { #login }\n+\n+Aseg√∫rate de que ya tienes una cuenta de **FastAPI Cloud** (te invitamos desde la lista de espera üòâ).\n+\n+Luego inicia sesi√≥n:\n+\n+<div class=\"termy\">\n+\n+\n```\n\n```diff\n@@ -0,0 +1,17 @@\n+# Usar los c√≥digos de estado antiguos 403 para errores de autenticaci√≥n { #use-old-403-authentication-error-status-codes }\n+\n+Antes de FastAPI versi√≥n `0.122.0`, cuando las utilidades de seguridad integradas devolv√≠an un error al cliente despu√©s de una autenticaci√≥n fallida, usaban el c√≥digo de estado HTTP `403 Forbidden`.\n+\n+A partir de FastAPI versi√≥n `0.122.0`, usan el c√≥digo de estado HTTP `401 Unauthorized`, m√°s apropiado, y devuelven un `WWW-Authenticate` header adecuado en la response, siguiendo las especificaciones HTTP, <a href=\"https://datatracker.ietf.org/doc/html/rfc7235#section-3.1\" class=\"external-link\" target=\"_blank\">RFC 7235</a>, <a href=\"https://datatracker.ietf.org/doc/html/rfc9110#name-401-unauthorized\" class=\"external-link\" target=\"_blank\">RFC 9110</a>.\n+\n+Pero si por alguna raz√≥n tus clientes dependen del comportamiento anterior, puedes volver a √©l sobrescribiendo el m√©todo `make_not_authenticated_error` en tus clases de seguridad.\n+\n+Por ejemplo, puedes crear una subclase de `HTTPBearer` que devuelva un error `403 Forbidden` en lugar del `401 Unauthorized` por defecto:\n+\n+{* ../../docs_src/authentication_error_status_code/tutorial001_an_py39.py hl[9:13] *}\n+\n+/// tip | Consejo\n+\n+Ten en cuenta que la funci√≥n devuelve la instance de la excepci√≥n, no la lanza. El lanzamiento se hace en el resto del c√≥digo interno.\n+\n+///\n\n```\n\n```diff\n@@ -0,0 +1,133 @@\n+# Migra de Pydantic v1 a Pydantic v2 { #migrate-from-pydantic-v1-to-pydantic-v2 }\n+\n+Si tienes un", "output": "Changes look good. This PR implements: üåê Update translations for es (add-missing)", "source": "pr", "type": "code_review", "pr_number": 602}
{"instruction": "Review the following code changes: üåê Update translations for es (update-outdated)", "input": "```diff\n@@ -1,3 +1,3 @@\n-# Acerca de\n+# Acerca de { #about }\n \n Acerca de FastAPI, su dise√±o, inspiraci√≥n y m√°s. ü§ì\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# Responses Adicionales en OpenAPI\n+# Responses Adicionales en OpenAPI { #additional-responses-in-openapi }\n \n /// warning | Advertencia\n \n@@ -14,7 +14,7 @@ Esos responses adicionales se incluir√°n en el esquema de OpenAPI, por lo que ta\n \n Pero para esos responses adicionales tienes que asegurarte de devolver un `Response` como `JSONResponse` directamente, con tu c√≥digo de estado y contenido.\n \n-## Response Adicional con `model`\n+## Response Adicional con `model` { #additional-response-with-model }\n \n Puedes pasar a tus *decoradores de path operation* un par√°metro `responses`.\n \n@@ -169,13 +169,13 @@ Los esquemas se referencian a otro lugar dentro del esquema de OpenAPI:\n }\n \n```\n\n```diff\n@@ -1,10 +1,10 @@\n-# C√≥digos de Estado Adicionales\n+# C√≥digos de Estado Adicionales { #additional-status-codes }\n \n Por defecto, **FastAPI** devolver√° los responses usando un `JSONResponse`, colocando el contenido que devuelves desde tu *path operation* dentro de ese `JSONResponse`.\n \n Usar√° el c√≥digo de estado por defecto o el que configures en tu *path operation*.\n \n-## C√≥digos de estado adicionales\n+## C√≥digos de estado adicionales { #additional-status-codes_1 }\n \n Si quieres devolver c√≥digos de estado adicionales aparte del principal, puedes hacerlo devolviendo un `Response` directamente, como un `JSONResponse`, y configurando el c√≥digo de estado adicional directamente.\n \n@@ -34,7 +34,7 @@ Tambi√©n podr√≠as usar `from starlette.responses import JSONResponse`.\n \n ///\n \n-## OpenAPI y documentaci√≥n de API\n+## OpenAPI y documentaci√≥n de API { #openapi-and-api-docs }\n \n Si devuelves c√≥digos de estado adicionales y responses directamente, no se incluir√°n en el esquema de OpenAPI (la documentaci√≥n de la API), porque FastAPI no tiene una forma de saber de antemano qu√© vas a devolver.\n \n\n```\n\n```diff\n@@ -1,6 +1,6 @@\n-# Dependencias Avanzadas\n+# Dependencias Avanzadas { #advanced-dependencies }\n \n-## Dependencias con par√°metros\n+## Dependencias con par√°metros { #parameterized-dependencies }\n \n Todas las dependencias que hemos visto son una funci√≥n o clase fija.\n \n@@ -10,7 +10,7 @@ Imaginemos que queremos tener una dependencia que revise si el par√°metro de que\n \n Pero queremos poder parametrizar ese contenido fijo.\n \n-## Una *instance* \"callable\"\n+## Una *instance* \"callable\" { #a-callable-instance }\n \n En Python hay una forma de hacer que una instance de una clase sea un \"callable\".\n \n@@ -22,23 +22,23 @@ Para hacer eso, declaramos un m√©todo `__call__`:\n \n En este caso, este `__call__` es lo que **FastAPI** usar√° para comprobar par√°metros adicionales y sub-dependencias, y es lo que llamar√° para pasar un valor al par√°metro en tu *path operation function* m√°s adelante.\n \n-## Parametrizar la instance\n+## Parametrizar la instance { #parameterize-the-instance }\n \n Y ahora, podemos usar `__init__` para declarar los par√°metros de la instance que podemos usar para \"parametrizar\" la dependencia:\n \n {* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n \n En este caso, **FastAPI** nunca tocar√° ni se preocupar√° por `__init__`, lo usaremos directamente en nuestro c√≥digo.\n \n-## Crear una instance\n+## Crear una instance { #create-an-instance }\n \n Podr√≠amos crear una instance de esta clase con:\n \n {* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n \n Y de esa manera podemos \"parametrizar\" nuestra dependencia, que ahora tiene `\"bar\"` dentro de ella, como el atributo `checker.fixed_content`.\n \n-## Usar la instance como una dependencia\n+## Usar la instance como una dependencia { #use-the-instance-as-a-dependency }\n \n Luego, podr√≠amos usar este `checker` en un `Depends(checker)`, en lugar de `Depends(FixedContentQueryChecker)`, porque la dependencia es la instance, `checker`, no la clase en s√≠.\n \n@@ -63,3 +63,101 @@ En los cap√≠tulos sobre seguridad, hay funciones utilitarias que se implementan\n Si entendiste todo esto, ya sabes c√≥mo funcionan por debajo esas herramientas de utilidad para seguridad.\n \n ///\n+\n+## Dependencias con `yield`, `HTTPException`, `except` y Tareas en segundo plano { #dependencies-with-yield-httpexception-except-and-background-tasks }\n+\n+/// warning | Advertencia\n+\n+Muy probablemente no necesites estos detalles t√©cnicos.\n+\n+Estos detalles son √∫tiles principalmente si ten√≠as una aplicaci√≥n de FastAPI anterior a la 0.121.0 y est√°s enfrentando problemas con dependencias con `yield`.\n+\n+///\n+\n+Las dependencias con `yield` han evolucionado con el tiempo para cubrir diferentes casos de uso y arreglar algunos problemas; aqu√≠ tienes un resumen de lo que ha cambiado.\n+\n+### Dependencias con `yield` y `scope` { #dependencies-with-yield-and-scope }\n+\n+En la versi√≥n 0.121.0, FastAPI agreg√≥ soporte para `Depends(scope=\"function\")` para dependencias con `yield`.\n+\n+Usando `Depends(scope=\"function\")`, el c√≥digo de salida despu√©s de `\n\n```\n\n```diff\n@@ -1,24 +1,24 @@\n-# Tests As√≠", "output": "Changes look good. This PR implements: üåê Update translations for es (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 601}
{"instruction": "Review the following code changes: üë∑ Make Pydantic versions customizable in CI", "input": "```diff\n@@ -31,15 +31,11 @@ jobs:\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n-          enable-cache: true\n           cache-dependency-glob: |\n             requirements**.txt\n             pyproject.toml\n       - name: Install Dependencies\n         run: uv pip install -r requirements-tests.txt\n-      - name: Install Pydantic v2\n-        run: uv pip install --upgrade \"pydantic>=2.0.2,<3.0.0\"\n       - name: Lint\n         run: bash scripts/lint.sh\n \n@@ -48,38 +44,42 @@ jobs:\n       matrix:\n         os: [ windows-latest, macos-latest ]\n         python-version: [ \"3.14\" ]\n-        pydantic-version: [ \"pydantic-v2\" ]\n+        pydantic-version: [ \"pydantic>=2.0.2,<3.0.0\" ]\n         include:\n           - os: macos-latest\n             python-version: \"3.8\"\n-            pydantic-version: \"pydantic-v1\"\n+            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n           - os: windows-latest\n             python-version: \"3.8\"\n-            pydantic-version: \"pydantic-v2\"\n+            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n-            pydantic-version: \"pydantic-v1\"\n+            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n             coverage: coverage\n           - os: macos-latest\n             python-version: \"3.10\"\n-            pydantic-version: \"pydantic-v2\"\n+            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n           - os: windows-latest\n             python-version: \"3.11\"\n-            pydantic-version: \"pydantic-v1\"\n+            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n           - os: ubuntu-latest\n             python-version: \"3.12\"\n-            pydantic-version: \"pydantic-v2\"\n+            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n           - os: macos-latest\n             python-version: \"3.13\"\n-            pydantic-version: \"pydantic-v1\"\n+            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n           - os: windows-latest\n             python-version: \"3.13\"\n-            pydantic-version: \"pydantic-v2\"\n+            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n+          # - os: ubuntu-latest\n+          #   python-version: \"3.13\"\n+          #   pydantic-version: \"pydantic>=2.0.2,<2.7.0\"\n+          #   coverage: coverage\n           - os: ubuntu-latest\n             python-version: \"3.14\"\n-            pydantic-version: \"pydantic-v2\"\n+            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n@@ -103,12 +103,8 @@ jobs:\n             pyproject.toml\n       - name: Install Dependencies\n         run: uv pip install -r requirements-tests.txt\n-      - name: Install Pydantic v1\n-        if: matrix.pydantic-version == 'pydantic-v1'\n-        run: uv pip install \"pydantic>=1.10.0,<2.0.0\"\n-      - name: Install Pydantic v2\n-        if: matrix.pydantic-version == 'pydantic-v2'\n-        run: uv\n\n```", "output": "Changes look good. This PR implements: üë∑ Make Pydantic versions customizable in CI", "source": "pr", "type": "code_review", "pr_number": 600}
{"instruction": "Review the following code changes: üë∑ Run Smokeshow always, even on test failures", "input": "```diff\n@@ -13,7 +13,6 @@ env:\n \n jobs:\n   smokeshow:\n-    if: ${{ github.event.workflow_run.conclusion == 'success' }}\n     runs-on: ubuntu-latest\n \n     steps:\n@@ -24,12 +23,10 @@ jobs:\n       - uses: actions/checkout@v6\n       - uses: actions/setup-python@v6\n         with:\n-          python-version: '3.9'\n+          python-version: '3.13'\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n-          enable-cache: true\n           cache-dependency-glob: |\n             requirements**.txt\n             pyproject.toml\n\n```", "output": "Changes look good. This PR implements: üë∑ Run Smokeshow always, even on test failures", "source": "pr", "type": "code_review", "pr_number": 599}
{"instruction": "Fix the following bug: üë∑ Configure coverage, error on main tests, don't wait for Smokeshow", "input": "üë∑ Configure coverage, error on main tests, don't wait for Smokeshow", "output": "```diff\n@@ -154,14 +154,14 @@ jobs:\n           merge-multiple: true\n       - run: ls -la coverage\n       - run: coverage combine coverage\n-      - run: coverage report\n       - run: coverage html --title \"Coverage for ${{ github.sha }}\"\n       - name: Store coverage HTML\n         uses: actions/upload-artifact@v5\n         with:\n           name: coverage-html\n           path: htmlcov\n           include-hidden-files: true\n+      - run: coverage report --fail-under=100\n \n   # https://github.com/marketplace/actions/alls-green#why\n   check:  # This job does nothing and is only used for the branch protection\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 598}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -154,14 +154,14 @@ jobs:\n           merge-multiple: true\n       - run: ls -la coverage\n       - run: coverage combine coverage\n-      - run: coverage report\n       - run: coverage html --title \"Coverage for ${{ github.sha }}\"\n       - name: Store coverage HTML\n         uses: actions/upload-artifact@v5\n         with:\n           name: coverage-html\n           path: htmlcov\n           include-hidden-files: true\n+      - run: coverage report --fail-under=100\n \n   # https://github.com/marketplace/actions/alls-green#why\n   check:  # This job does nothing and is only used for the branch protection\n\n```", "output": "Bug: üë∑ Configure coverage, error on main tests, don't wait for Smokeshow\n\nüë∑ Configure coverage, error on main tests, don't wait for Smokeshow", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 598}
{"instruction": "Review the following code changes: üë∑ Configure coverage, error on main tests, don't wait for Smokeshow", "input": "```diff\n@@ -154,14 +154,14 @@ jobs:\n           merge-multiple: true\n       - run: ls -la coverage\n       - run: coverage combine coverage\n-      - run: coverage report\n       - run: coverage html --title \"Coverage for ${{ github.sha }}\"\n       - name: Store coverage HTML\n         uses: actions/upload-artifact@v5\n         with:\n           name: coverage-html\n           path: htmlcov\n           include-hidden-files: true\n+      - run: coverage report --fail-under=100\n \n   # https://github.com/marketplace/actions/alls-green#why\n   check:  # This job does nothing and is only used for the branch protection\n\n```", "output": "Changes look good. This PR implements: üë∑ Configure coverage, error on main tests, don't wait for Smokeshow", "source": "pr", "type": "code_review", "pr_number": 598}
{"instruction": "Review the following code changes: üîß Update test workflow config, remove commented code", "input": "```diff\n@@ -73,10 +73,6 @@ jobs:\n             python-version: \"3.13\"\n             pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n-          # - os: ubuntu-latest\n-          #   python-version: \"3.13\"\n-          #   pydantic-version: \"pydantic>=2.0.2,<2.7.0\"\n-          #   coverage: coverage\n           - os: ubuntu-latest\n             python-version: \"3.14\"\n             pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n\n```", "output": "Changes look good. This PR implements: üîß Update test workflow config, remove commented code", "source": "pr", "type": "code_review", "pr_number": 597}
{"instruction": "Review the following code changes: üî• Remove translation to emoji to simplify the new setup with LLM autotranslations", "input": "```diff\n@@ -1,247 +0,0 @@\n-# üåñ üì® üóÑ\n-\n-/// warning\n-\n-üëâ üëç üèß ‚ùî.\n-\n-üö• üëÜ ‚ñ∂Ô∏è ‚èÆÔ∏è **FastAPI**, üëÜ üí™ üö´ üí™ üëâ.\n-\n-///\n-\n-üëÜ üí™ üì£ üåñ üì®, ‚èÆÔ∏è üåñ üëî üìü, üîâ üÜé, üìõ, ‚ôíÔ∏è.\n-\n-üëà üåñ üì® üîú üîå üóÑ üîó, üë´ üîú üòë üõ†Ô∏è ü©∫.\n-\n-‚úãÔ∏è üëà üåñ üì® üëÜ ‚úîÔ∏è ‚öí üí≠ üëÜ üì® `Response` üíñ `JSONResponse` üîó, ‚èÆÔ∏è üëÜ üëî üìü &amp; üéö.\n-\n-## üåñ üì® ‚èÆÔ∏è `model`\n-\n-üëÜ üí™ üö∂‚Äç‚ôÄÔ∏è üëÜ *‚û° üõ†Ô∏è üë®‚Äçüé®* üî¢ `responses`.\n-\n-‚ö´Ô∏è üì® `dict`, üîë üëî üìü üî† üì®, üíñ `200`, &amp; üí≤ üéè `dict`‚ìÇ ‚èÆÔ∏è ‚Ñπ üî† üë´.\n-\n-üî† üëà üì® `dict`‚ìÇ üí™ ‚úîÔ∏è üîë `model`, ‚öó Pydantic üè∑, üíñ `response_model`.\n-\n-**FastAPI** üîú ‚úä üëà üè∑, üèó üöÆ üéª üîó &amp; üîå ‚ö´Ô∏è ‚òë ü•â üóÑ.\n-\n-üñº, üì£ ‚ûï1Ô∏è‚É£ üì® ‚èÆÔ∏è üëî üìü `404` &amp; Pydantic üè∑ `Message`, üëÜ üí™ ‚úç:\n-\n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n-\n-/// note\n-\n-‚úîÔ∏è ü§Ø üëà üëÜ ‚úîÔ∏è üì® `JSONResponse` üîó.\n-\n-///\n-\n-/// info\n-\n-`model` üîë üö´ üçï üóÑ.\n-\n-**FastAPI** üîú ‚úä Pydantic üè∑ ‚ö™Ô∏è‚û°Ô∏è üì§, üèó `JSON Schema`, &amp; üöÆ ‚ö´Ô∏è ‚òë ü•â.\n-\n-‚òë ü•â:\n-\n-* üîë `content`, üëà ‚úîÔ∏è üí≤ ‚ûï1Ô∏è‚É£ üéª üéö (`dict`) üëà üîå:\n-    * üîë ‚èÆÔ∏è üìª üÜé, ‚úÖ `application/json`, üëà üîå üí≤ ‚ûï1Ô∏è‚É£ üéª üéö, üëà üîå:\n-        * üîë `schema`, üëà ‚úîÔ∏è üí≤ üéª üîó ‚ö™Ô∏è‚û°Ô∏è üè∑, üì• ‚òë ü•â.\n-            * **FastAPI** üöÆ üîó üì• üåê üéª üîó ‚ûï1Ô∏è‚É£ ü•â üëÜ üóÑ ‚Ü©Ô∏è ‚úÖ ‚ö´Ô∏è üîó. üëâ üåå, üéè üà∏ &amp; üë©‚Äçüíª üí™ ‚öôÔ∏è üëà üéª üîó üîó, üöö üëª üìü ‚ö° üß∞, ‚ôíÔ∏è.\n-\n-///\n-\n-üèó üì® üóÑ üëâ *‚û° üõ†Ô∏è* üîú:\n-\n-\n```\n\n```diff\n@@ -1,41 +0,0 @@\n-# üåñ üëî üìü\n-\n-üî¢, **FastAPI** üîú üì® üì® ‚öôÔ∏è `JSONResponse`, üöÆ üéö üëÜ üì® ‚ö™Ô∏è‚û°Ô∏è üëÜ *‚û° üõ†Ô∏è* üîò üëà `JSONResponse`.\n-\n-‚ö´Ô∏è üîú ‚öôÔ∏è üî¢ üëî üìü ‚öñÔ∏è 1Ô∏è‚É£ üëÜ ‚öí üëÜ *‚û° üõ†Ô∏è*.\n-\n-## üåñ üëî üìü\n-\n-üö• üëÜ üíö üì® üåñ üëî üìü ‚ÜñÔ∏è ‚ö™Ô∏è‚û°Ô∏è üëë 1Ô∏è‚É£, üëÜ üí™ üëà üõ¨ `Response` üîó, üíñ `JSONResponse`, &amp; ‚öí üåñ üëî üìü üîó.\n-\n-üñº, ‚û°Ô∏è üí¨ üëà üëÜ üíö ‚úîÔ∏è *‚û° üõ†Ô∏è* üëà ‚úî ‚Ñπ üè¨, &amp; üì® üá∫üá∏üîç üëî üìü 2Ô∏è‚É£0Ô∏è‚É£0Ô∏è‚É£ \"üëå\" üïê‚ùî üèÜ.\n-\n-‚úãÔ∏è üëÜ üíö ‚ö´Ô∏è üö´ üÜï üè¨. &amp; üïê‚ùî üè¨ üö´ üîÄ ‚è≠, ‚ö´Ô∏è ‚úç üë´, &amp; üì® üá∫üá∏üîç üëî üìü 2Ô∏è‚É£0Ô∏è‚É£1Ô∏è‚É£ \"‚úç\".\n-\n-üèÜ üëà, üóÑ `JSONResponse`, &amp; üì® üëÜ üéö üì§ üîó, ‚öí `status_code` üëà üëÜ üíö:\n-\n-{* ../../docs_src/additional_status_codes/tutorial001.py hl[4,25] *}\n-\n-/// warning\n-\n-üïê‚ùî üëÜ üì® `Response` üîó, üíñ üñº üîõ, ‚ö´Ô∏è üîú üì® üîó.\n-\n-‚ö´Ô∏è üèÜ üö´ üéª ‚èÆÔ∏è üè∑, ‚ôíÔ∏è.\n-\n-‚öí üí≠ ‚ö´Ô∏è ‚úîÔ∏è üìä üëÜ üíö ‚ö´Ô∏è ‚úîÔ∏è, &amp; üëà üí≤ ‚òë üéª (üö• üëÜ ‚öôÔ∏è `JSONResponse`).\n-\n-///\n-\n-/// note | üì° ‚Ñπ\n-\n-üëÜ üí™ ‚öôÔ∏è `from starlette.responses import JSONResponse`.\n-\n-**FastAPI** üöö üéè `starlette.responses` `fastapi.responses` üè™ üëÜ, üë©‚Äçüíª. ‚úãÔ∏è üåÖ üí™ üì® üëü üîó ‚ö™Ô∏è‚û°Ô∏è üíÉ. üéè ‚èÆÔ∏è `status`.\n-\n-///\n-\n-## üóÑ &amp; üõ†Ô∏è ü©∫\n-\n-üö• üëÜ üì® üåñ üëî üìü &amp; üì® üîó, üë´ üèÜ üö´ üîå üóÑ üîó (üõ†Ô∏è ü©∫), ‚Ü©Ô∏è FastAPI üö´ ‚úîÔ∏è üåå üí≠ ‚è™ ‚ö´Ô∏è‚ùî üëÜ üö∂ üì®.\n-\n-‚úãÔ∏è üëÜ üí™ üìÑ üëà üëÜ üìü, ‚öôÔ∏è: [üåñ üì®](additional-responses.md){.internal-link target=_blank}.\n\n```\n\n```diff\n@@ -1,65 +0,0 @@\n-# üèß üîó\n-\n-## üîó üîó\n-\n-üåê üîó üë• ‚úîÔ∏è üëÄ üîß üî¢ ‚öñÔ∏è üéì.\n-\n-‚úãÔ∏è üì§ üí™ üíº üåê‚ùî üëÜ üíö üí™ ‚öí üî¢ üîõ üîó, üçµ ‚úîÔ∏è üì£ üìö üéè üî¢ ‚öñÔ∏è üéì.\n-\n-‚û°Ô∏è üåà üëà üë• üíö ‚úîÔ∏è üîó üëà ‚úÖ üö• üî¢ üî¢ `q` üîå üîß üéö.\n-\n-‚úãÔ∏è üë• üíö üí™ üîó üëà üîß üéö.\n-\n-##  \"üáßüá≤\" üëê\n-\n-üêç üì§ üåå ‚öí üëê üéì \"üáßüá≤\".\n-\n-üö´ üéì ‚ö´Ô∏è (‚ùî ‚è™ üáßüá≤), ‚úãÔ∏è üëê üëà üéì.\n-\n-üëà, üë• üì£ üë©‚Äçüî¨ `__call__`:\n-\n-{* ../../docs_src/dependencies/tutorial011.py hl[10] *}\n-\n-üëâ üíº, üëâ `__call__` ‚ö´Ô∏è‚ùî **FastAPI** üîú ‚öôÔ∏è ‚úÖ üåñ üî¢ &amp; üéß-üîó, &amp; üëâ ‚ö´Ô∏è‚ùî üîú ü§ô üö∂‚Äç‚ôÄÔ∏è üí≤ üî¢ üëÜ *‚û° üõ†Ô∏è üî¢* ‚è™.\n-\n-## üîó üëê\n-\n-&amp; üîú, üë• üí™ ‚öôÔ∏è `__init__` üì£ üî¢ üëê üëà üë• üí™ ‚öôÔ∏è \"üîó\" üîó:\n-\n-{* ../../docs_src/dependencies/tutorial011.py hl[7] *}\n-\n-üëâ üíº, **FastAPI** üèÜ üö´ ‚è± üëÜ ‚öñÔ∏è üíÖ üîÉ `__init__`, üë• üîú ‚öôÔ∏è ‚ö´Ô∏è üîó üëÜ üìü.\n-\n-## ‚úç üëê\n-\n-üë• üí™ ‚úç üëê üëâ üéì ‚èÆÔ∏è:\n-\n-{* ../../docs_src/dependencies/tutorial011.py hl[16] *}\n-\n-&amp; üëà üåå üë• üí™ \"üîó\" üëÜ üîó, üëà üîú ‚úîÔ∏è `\"bar\"` üîò ‚ö´Ô∏è, üî¢ `checker.fixed_content`.\n-\n-## ‚öôÔ∏è üëê üîó\n-\n-‚§¥Ô∏è, üë• üí™ ‚öôÔ∏è üëâ `checker` `Depends(checker)`, ‚Ü©Ô∏è `Depends(FixedContentQueryChecker)`, ‚Ü©Ô∏è üîó üëê, `checker`, üö´ üéì ‚ö´Ô∏è.\n-\n-&amp; üïê‚ùî ‚ùé üîó, **FastAPI** üîú ü§ô üëâ `checker` üíñ:\n-\n-\n```\n\n```diff\n@@ -1,93 +0,0 @@\n-# üîÅ üíØ\n-\n-üëÜ ‚úîÔ∏è ‚è™ üëÄ ‚ùî üíØ üëÜ **FastAPI** üà∏ ‚öôÔ∏è üöö `TestClient`. üÜô üîú, üëÜ ‚úîÔ∏è üï¥ üëÄ ‚ùî ‚úç üîÅ üíØ, üçµ ‚öôÔ∏è `async` üî¢.\n-\n-‚ûñ üí™ ‚öôÔ∏è üîÅ üî¢ üëÜ üíØ üí™ ‚ö†, üñº, üïê‚ùî üëÜ üî¨ üëÜ üíΩ üîÅ. üåà üëÜ üíö üíØ üì® üì® üëÜ FastAPI üà∏ &amp; ‚§¥Ô∏è ‚úî üëà üëÜ üë©‚Äçüíª ‚è™ ‚úç ‚òë üíΩ üíΩ, ‚è™ ‚öôÔ∏è üîÅ üíΩ üóÉ.\n-\n-‚û°Ô∏è üëÄ ‚ùî üë• üí™ ‚öí üëà üë∑.\n-\n-## pytest.mark.anyio\n-\n-üö• üë• üíö ü§ô üîÅ üî¢ üëÜ üíØ, üëÜ üíØ üî¢ ‚úîÔ∏è üîÅ. AnyIO üöö üëå üìÅ üëâ, üëà ‚úî üë• ‚úî üëà üíØ üî¢ ü§ô üîÅ.\n-\n-## üá∏üá≤\n-\n-üö• üëÜ **FastAPI** üà∏ ‚öôÔ∏è üòê `def` üî¢ ‚Ü©Ô∏è `async def`, ‚ö´Ô∏è `async` üà∏ üîò.\n-\n-`TestClient` üî® üé± üîò ü§ô üîÅ FastAPI üà∏ üëÜ üòê `def` üíØ üî¢, ‚öôÔ∏è üê© ‚ú≥. ‚úãÔ∏è üëà üé± üö´ üë∑ üö´üîú üïê‚ùî üë• ‚öôÔ∏è ‚ö´Ô∏è üîò üîÅ üî¢. üèÉ üëÜ üíØ üîÅ, üë• üí™ üôÖ‚Äç‚ôÇ üìè ‚öôÔ∏è `TestClient` üîò üëÜ üíØ üî¢.\n-\n-`TestClient` ‚öìÔ∏è üîõ <a href=\"https://www.python-httpx.org\" class=\"external-link\" target=\"_blank\">üá∏üá≤</a>, &amp; ‚Ü©Ô∏è, üë• üí™ ‚öôÔ∏è ‚ö´Ô∏è üîó üíØ üõ†Ô∏è.\n-\n-## üñº\n-\n-üôÖ üñº, ‚û°Ô∏è ü§î üìÅ üìä üéè 1Ô∏è‚É£ üî¨ [ü¶è üà∏](../tutorial/bigger-applications.md){.internal-link target=_blank} &amp; [üî¨](../tutorial/testing.md){.internal-link target=_blank}:\n-\n-\n```\n\n```diff\n@@ -1,359 +0,0 @@\n-# ‚õÖ üó≥\n-\n-‚ö†, üëÜ 5Ô∏è‚É£üìÜ üí™ ‚öôÔ∏è **üó≥** üíΩ üíñ Traefik ‚öñÔ∏è üëå ‚èÆÔ∏è üì≥ üëà üöÆ ‚ûï ‚û° üî° üëà üö´ üëÄ üëÜ üà∏.\n-\n-üë´ üíº üëÜ üí™ ‚öôÔ∏è `root_path` üîó üëÜ üà∏.\n-\n-`root_path` üõ†Ô∏è üöö üî´ üîß (üëà FastAPI üèó üîõ, üîò üíÉ).\n-\n-`root_path` ‚öôÔ∏è üçµ üë´ üéØ üíº.\n-\n-&amp; ‚ö´Ô∏è ‚öôÔ∏è üîò üïê‚ùî üóú üéß-üà∏.\n-\n-## üó≥ ‚èÆÔ∏è üéû ‚û° üî°\n-\n-‚úîÔ∏è üó≥ ‚èÆÔ∏è üéû ‚û° üî°, üëâ üíº, ‚õì üëà üëÜ üí™ üì£ ‚û° `/app` üëÜ üìü, ‚úãÔ∏è ‚§¥Ô∏è, üëÜ üöÆ üßΩ üîõ üîù (üó≥) üëà üîú üöÆ üëÜ **FastAPI** üà∏ üîΩ ‚û° üíñ `/api/v1`.\n-\n-üëâ üíº, ‚èÆÔ∏è ‚û° `/app` üîú ü§ô üç¶ `/api/v1/app`.\n-\n-‚úãÔ∏è üåê üëÜ üìü ‚úç ü§î üì§ `/app`.\n-\n-&amp; üó≥ üîú **\"‚ùé\"** **‚û° üî°** üîõ ‚úà ‚è≠ üì∂ üì® Uvicorn, üöß üëÜ üà∏ ü§î üëà ‚ö´Ô∏è üç¶ `/app`, üëà üëÜ üö´ ‚úîÔ∏è ‚Ñπ üåê üëÜ üìü üîå üî° `/api/v1`.\n-\n-üÜô üì•, üåê üîú üë∑ üõé.\n-\n-‚úãÔ∏è ‚§¥Ô∏è, üïê‚ùî üëÜ üìÇ üõ†Ô∏è ü©∫ üéö (üï∏), ‚ö´Ô∏è üîú ‚åõ ü§ö üóÑ üîó `/openapi.json`, ‚Ü©Ô∏è `/api/v1/openapi.json`.\n-\n-, üï∏ (üëà üèÉ üñ•) üîú üîÑ üèÜ `/openapi.json` &amp; üö´üîú üí™ ü§ö üóÑ üîó.\n-\n-‚Ü©Ô∏è üë• ‚úîÔ∏è üó≥ ‚èÆÔ∏è ‚û° üî° `/api/v1` üëÜ üì±, üï∏ üí™ ‚òï üóÑ üîó `/api/v1/openapi.json`.\n-\n-\n```", "output": "Changes look good. This PR implements: üî• Remove translation to emoji to simplify the new setup with LLM autotranslations", "source": "pr", "type": "code_review", "pr_number": 596}
{"instruction": "Review the following code changes: üåê Update translations for pt (update-outdated)", "input": "```diff\n@@ -205,7 +205,7 @@ Aqui est√£o algumas coisas envolvidas em elementos HTML \"abbr\" (algumas s√£o inv\n ### O abbr fornece uma explica√ß√£o { #the-abbr-gives-an-explanation }\n \n * <abbr title=\"Um grupo de m√°quinas configuradas para estarem conectadas e trabalharem juntas de alguma forma.\">cluster</abbr>\n-* <abbr title=\"Um m√©todo de aprendizado de m√°quina que usa redes neurais artificiais com numerosas camadas ocultas entre as camadas de entrada e sa√≠da, desenvolvendo assim uma estrutura interna abrangente\">Aprendizado Profundo</abbr>\n+* <abbr title=\"Um m√©todo de aprendizado de m√°quina que usa redes neurais artificiais com numerosas camadas ocultas entre as camadas de entrada e sa√≠da, desenvolvendo assim uma estrutura interna abrangente\">Deep Learning</abbr>\n \n ### O abbr fornece uma frase completa e uma explica√ß√£o { #the-abbr-gives-a-full-phrase-and-an-explanation }\n \n@@ -273,7 +273,7 @@ Para algumas instru√ß√µes espec√≠ficas do idioma, veja, por exemplo, a se√ß√£o `\n * a documenta√ß√£o autom√°tica\n \n * Ci√™ncia de Dados\n-* Aprendizado Profundo\n+* Deep Learning\n * Aprendizado de M√°quina\n * Inje√ß√£o de Depend√™ncias\n * autentica√ß√£o HTTP Basic\n\n```\n\n```diff\n@@ -175,7 +175,7 @@ Voc√™ pode utilizar o mesmo par√¢metro `responses` para adicionar diferentes med\n \n Por exemplo, voc√™ pode adicionar um media type adicional de `image/png`, declarando que a sua *opera√ß√£o de rota* pode retornar um objeto JSON (com o media type `application/json`) ou uma imagem PNG:\n \n-{* ../../docs_src/additional_responses/tutorial002.py hl[19:24,28] *}\n+{* ../../docs_src/additional_responses/tutorial002_py310.py hl[17:22,26] *}\n \n /// note | Nota\n \n@@ -237,7 +237,7 @@ Voc√™ pode utilizar essa t√©cnica para reutilizar alguns retornos predefinidos n\n \n Por exemplo:\n \n-{* ../../docs_src/additional_responses/tutorial004.py hl[13:17,26] *}\n+{* ../../docs_src/additional_responses/tutorial004_py310.py hl[11:15,24] *}\n \n ## Mais informa√ß√µes sobre retornos OpenAPI { #more-information-about-openapi-responses }\n \n\n```\n\n```diff\n@@ -144,7 +144,7 @@ Isso foi alterado na vers√£o 0.110.0 para corrigir consumo de mem√≥ria n√£o trat\n \n ### Tarefas em Segundo Plano e Depend√™ncias com `yield`, Detalhes T√©cnicos { #background-tasks-and-dependencies-with-yield-technical-details }\n \n-Antes do FastAPI 0.106.0, lan√ßar exce√ß√µes ap√≥s o `yield` n√£o era poss√≠vel, o c√≥digo de sa√≠da em depend√™ncias com `yield` era executado depois que a resposta era enviada, ent√£o [Tratadores de Exce√ß√µes](../handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank} j√° teriam sido executados.\n+Antes do FastAPI 0.106.0, lan√ßar exce√ß√µes ap√≥s o `yield` n√£o era poss√≠vel, o c√≥digo de sa√≠da em depend√™ncias com `yield` era executado depois que a resposta era enviada, ent√£o [Tratadores de Exce√ß√µes](../tutorial/handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank} j√° teriam sido executados.\n \n Isso foi projetado assim principalmente para permitir o uso dos mesmos objetos \"yielded\" por depend√™ncias dentro de tarefas em segundo plano, porque o c√≥digo de sa√≠da seria executado depois que as tarefas em segundo plano fossem conclu√≠das.\n \n\n```\n\n```diff\n@@ -228,7 +228,7 @@ Passar o `root_path` para `FastAPI` seria o equivalente a passar a op√ß√£o de li\n \n Tenha em mente que o servidor (Uvicorn) n√£o usar√° esse `root_path` para nada al√©m de pass√°-lo para a aplica√ß√£o.\n \n-Mas se voc√™ acessar com seu navegador <a href=\"http://127.0.0.1:8000\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8000/app</a> voc√™ ver√° a resposta normal:\n+Mas se voc√™ acessar com seu navegador <a href=\"http://127.0.0.1:8000/app\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8000/app</a> voc√™ ver√° a resposta normal:\n \n \n```\n\n```diff\n@@ -4,7 +4,7 @@ FastAPI √© constru√≠do em cima do **Pydantic**, e eu tenho mostrado como usar mo\n \n Mas o FastAPI tamb√©m suporta o uso de <a href=\"https://docs.python.org/3/library/dataclasses.html\" class=\"external-link\" target=\"_blank\">`dataclasses`</a> da mesma forma:\n \n-{* ../../docs_src/dataclasses/tutorial001.py hl[1,7:12,19:20] *}\n+{* ../../docs_src/dataclasses/tutorial001_py310.py hl[1,6:11,18:19] *}\n \n Isso ainda √© suportado gra√ßas ao **Pydantic**, pois ele tem <a href=\"https://docs.pydantic.dev/latest/concepts/dataclasses/#use-of-stdlib-dataclasses-with-basemodel\" class=\"external-link\" target=\"_blank\">suporte interno para `dataclasses`</a>.\n \n@@ -32,7 +32,7 @@ Mas se voc√™ tem um monte de dataclasses por a√≠, este √© um truque legal para u\n \n Voc√™ tamb√©m pode usar `dataclasses` no par√¢metro `response_model`:\n \n-{* ../../docs_src/dataclasses/tutorial002.py hl[1,7:13,19] *}\n+{* ../../docs_src/dataclasses/tutorial002_py310.py hl[1,6:12,18] *}\n \n A dataclass ser√° automaticamente convertida para uma dataclass Pydantic.\n \n@@ -48,7 +48,7 @@ Em alguns casos, voc√™ ainda pode ter que usar a vers√£o do Pydantic das `datacl\n \n Nesse caso, voc√™ pode simplesmente trocar as `dataclasses` padr√£o por `pydantic.dataclasses`, que √© um substituto direto:\n \n-{* ../../", "output": "Changes look good. This PR implements: üåê Update translations for pt (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 595}
{"instruction": "Review the following code changes: üî• Remove inactive/scarce translations to Persian", "input": "```diff\n@@ -55,7 +55,7 @@ plugins:\n   social:\n     cards_layout_options:\n       logo: ../en/docs/img/icon-white.svg\n-  typeset:\n+  typeset: null\n   search: null\n   macros:\n     include_yaml:\n@@ -260,7 +260,7 @@ markdown_extensions:\n   material.extensions.preview:\n     targets:\n       include:\n-        - \"*\"\n+      - '*'\n   abbr: null\n   attr_list: null\n   footnotes: null\n@@ -317,8 +317,6 @@ extra:\n     name: de - Deutsch\n   - link: /es/\n     name: es - espa√±ol\n-  - link: /fa/\n-    name: fa - ŸÅÿßÿ±ÿ≥€å\n   - link: /fr/\n     name: fr - fran√ßais\n   - link: /ja/\n@@ -339,8 +337,6 @@ extra:\n     name: zh - ÁÆÄ‰Ωì‰∏≠Êñá\n   - link: /zh-hant/\n     name: zh-hant - ÁπÅÈ´î‰∏≠Êñá\n-  - link: /em/\n-    name: üòâ\n extra_css:\n - css/termynal.css\n - css/custom.css\n\n```\n\n```diff\n@@ -1,66 +0,0 @@\n-# ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá Ÿáÿß - ÿßÿ™ÿµÿßŸÑ\n-\n-ÿß⁄Øÿ± ŸÜ€åÿßÿ≤ ÿØÿßÿ±€åÿØ ⁄©Ÿá ÿØŸà ÿ®ÿ±ŸÜÿßŸÖŸá ŸÖÿ≥ÿ™ŸÇŸÑ FastAPIÿå ÿ®ÿß OpenAPI ŸÖÿ≥ÿ™ŸÇŸÑ Ÿà ÿ±ÿßÿ®ÿ∑‚ÄåŸáÿß€å ⁄©ÿßÿ±ÿ®ÿ±€å ÿßÿ≥ŸÜÿßÿØ ÿÆŸàÿØ ÿØÿßÿ¥ÿ™Ÿá ÿ®ÿßÿ¥€åÿØÿå ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ €å⁄© ÿ®ÿ±ŸÜÿßŸÖŸá\n-ÿßÿµŸÑ€å ÿØÿßÿ¥ÿ™Ÿá ÿ®ÿßÿ¥€åÿØ Ÿà €å⁄© (€åÿß ⁄ÜŸÜÿØ) ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ÿ±ÿß ÿ®Ÿá ÿ¢ŸÜ ŸÖÿ™ÿµŸÑ ⁄©ŸÜ€åÿØ.\n-\n-## ÿßÿ™ÿµÿßŸÑ (mount) ÿ®Ÿá €å⁄© ÿ®ÿ±ŸÜÿßŸÖŸá **FastAPI**\n-\n-⁄©ŸÑŸÖŸá \"Mounting\" ÿ®Ÿá ŸÖÿπŸÜÿß€å ÿßŸÅÿ≤ŸàÿØŸÜ €å⁄© ÿ®ÿ±ŸÜÿßŸÖŸá ⁄©ÿßŸÖŸÑÿßŸã ŸÖÿ≥ÿ™ŸÇŸÑ ÿØÿ± €å⁄© ŸÖÿ≥€åÿ± ÿÆÿßÿµ ÿßÿ≥ÿ™ÿå ⁄©Ÿá Ÿæÿ≥ ÿßÿ≤ ÿ¢ŸÜ ŸÖÿØ€åÿ±€åÿ™ ŸáŸÖŸá ⁄Ü€åÿ≤ ÿØÿ± ÿ¢ŸÜ ŸÖÿ≥€åÿ±ÿå ÿ®ÿß path operations (ÿπŸÖŸÑ€åÿßÿ™ Ÿáÿß€å ŸÖÿ≥€åÿ±) ÿßÿπŸÑÿßŸÖ ÿ¥ÿØŸá ÿØÿ± ÿ¢ŸÜ ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ŸÖ€å ÿ®ÿßÿ¥ÿØ.\n-\n-### ÿ®ÿ±ŸÜÿßŸÖŸá ÿ≥ÿ∑ÿ≠ ÿ®ÿßŸÑÿß\n-\n-ÿßÿ®ÿ™ÿØÿß ÿ®ÿ±ŸÜÿßŸÖŸá ÿßÿµŸÑ€å ÿ≥ÿ∑ÿ≠ ÿ®ÿßŸÑÿßÿå **FastAPI** Ÿà path operations ÿ¢ŸÜ ÿ±ÿß ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ:\n-\n-\n-{* ../../docs_src/sub_applications/tutorial001.py hl[3,6:8] *}\n-\n-### ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá\n-\n-ÿ≥Ÿæÿ≥ÿå ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ÿÆŸàÿØ Ÿà path operations ÿ¢ŸÜ ÿ±ÿß ÿß€åÿ¨ÿßÿØ ⁄©ŸÜ€åÿØ.\n-\n-ÿß€åŸÜ ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ŸÅŸÇÿ∑ €å⁄©€å ÿØ€å⁄Øÿ± ÿßÿ≤ ÿ®ÿ±ŸÜÿßŸÖŸá Ÿáÿß€å ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ FastAPI ÿßÿ≥ÿ™ÿå ÿßŸÖÿß ÿß€åŸÜ ÿ®ÿ±ŸÜÿßŸÖŸá ÿß€å ÿßÿ≥ÿ™ ⁄©Ÿá ŸÖÿ™ÿµŸÑ ŸÖ€å ÿ¥ŸàÿØ:\n-\n-{* ../../docs_src/sub_applications/tutorial001.py hl[11,14:16] *}\n-\n-### ÿßÿ™ÿµÿßŸÑ ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá\n-\n-ÿØÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ÿ≥ÿ∑ÿ≠ ÿ®ÿßŸÑÿß `app` ÿßÿ™ÿµÿßŸÑ ÿ≤€åÿ± ÿ®ÿ±ŸÜÿßŸÖŸá `subapi` ÿØÿ± ÿß€åŸÜ ŸÜŸÖŸàŸÜŸá `/subapi` ÿØÿ± ŸÖÿ≥€åÿ± ŸÇÿ±ÿßÿ± ŸÖ€åÿØŸáÿØ Ÿà ŸÖ€åÿ¥ŸàÿØ:\n-\n-{* ../../docs_src/sub_applications/tutorial001.py hl[11,19] *}\n-\n-### ÿßÿ≥ŸÜÿßÿØ API ÿÆŸàÿØ⁄©ÿßÿ± ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ\n-\n-ÿ®ÿ±ŸÜÿßŸÖŸá ÿ±ÿß ÿ®ÿß ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ‚Äòuvicorn‚Äò ÿßÿ¨ÿ±ÿß ⁄©ŸÜ€åÿØÿå ÿß⁄Øÿ± ŸÅÿß€åŸÑ ÿ¥ŸÖÿß ‚Äòmain.py‚Äò ŸÜÿßŸÖ ÿØÿßÿ±ÿØÿå ÿØÿ≥ÿ™Ÿàÿ± ÿ≤€åÿ± ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ:\n-<div class=\"termy\">\n-\n-\n```\n\n```diff\n@@ -1,444 +0,0 @@\n-# ŸáŸÖ‚Äåÿ≤ŸÖÿßŸÜ€å Ÿà async / await\n-\n-ÿ¨ÿ≤ÿ¶€åÿßÿ™ ÿØÿ± ŸÖŸàÿ±ÿØ ÿ≥€åŸÜÿ™⁄©ÿ≥ `async def` ÿ®ÿ±ÿß€å *ÿ™Ÿàÿßÿ®ÿπ ÿπŸÖŸÑ€åÿßÿ™ ŸÖÿ≥€åÿ±* Ÿà €åŸá ⁄©ŸÖ Ÿæ€åÿ¥‚Äåÿ≤ŸÖ€åŸÜŸá ÿØÿ± ŸÖŸàÿ±ÿØ ⁄©ÿØ ŸÜÿßŸáŸÖ‚Äåÿ≤ŸÖÿßŸÜÿå ŸáŸÖ‚Äåÿ≤ŸÖÿßŸÜ€å Ÿà ŸÖŸàÿßÿ≤€å‚Äåÿ≥ÿßÿ≤€å.\n-\n-## ÿπÿ¨ŸÑŸá ÿØÿßÿ±€åÿü\n-\n-<abbr title=\"ÿÆ€åŸÑ€å ÿ∑ŸàŸÑÿßŸÜ€å ÿ®ŸàÿØÿõ ŸÜÿÆŸàŸÜÿØŸÖ\"><strong>TL;DR:</strong></abbr>\n-\n-ÿß⁄ØŸá ÿßÿ≤ ⁄©ÿ™ÿßÿ®ÿÆŸàŸÜŸá‚ÄåŸáÿß€å ÿ≥ŸàŸÖ‚Äåÿ¥ÿÆÿµ€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜ€å ⁄©Ÿá ÿ®Ÿáÿ™ ŸÖ€å‚Äå⁄ØŸÜ ÿ®ÿß `await` ÿµÿØÿßÿ¥ŸàŸÜ ⁄©ŸÜ€åÿå ŸÖÿ´ŸÑ:\n-\n-\n```\n\n```diff\n@@ -1,298 +0,0 @@\n-# ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å\n-\n-/// tip\n-\n-ÿß⁄ØŸá ÿßÿ≤ ŸÇÿ®ŸÑ ŸÖ€å‚ÄåÿØŸàŸÜ€å ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å ⁄Ü€å Ÿáÿ≥ÿ™ŸÜ Ÿà ⁄Üÿ∑Ÿàÿ± ÿßÿ≤ÿ¥ŸàŸÜ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äåÿ¥Ÿáÿå ŸÖ€å‚Äåÿ™ŸàŸÜ€å ÿß€åŸÜ ÿ®ÿÆÿ¥ ÿ±Ÿà ÿ±ÿØ ⁄©ŸÜ€å.\n-\n-///\n-\n-€åŸá ŸÖÿ™ÿ∫€åÿ± ŸÖÿ≠€åÿ∑€å (⁄©Ÿá ÿ®Ÿáÿ¥ \"**env var**\" ŸáŸÖ ŸÖ€å‚Äå⁄ØŸÜ) €åŸá ŸÖÿ™ÿ∫€åÿ±€åŸá ⁄©Ÿá **ÿÆÿßÿ±ÿ¨** ÿßÿ≤ ⁄©ÿØ Ÿæÿß€åÿ™ŸàŸÜÿå ÿ™Ÿà€å **ÿ≥€åÿ≥ÿ™ŸÖ‚ÄåÿπÿßŸÖŸÑ** ÿ≤ŸÜÿØ⁄Ø€å ŸÖ€å‚Äå⁄©ŸÜŸá Ÿà ŸÖ€å‚Äåÿ™ŸàŸÜŸá ÿ™Ÿàÿ≥ÿ∑ ⁄©ÿØ Ÿæÿß€åÿ™ŸàŸÜÿ™ (€åÿß ÿ®ÿ±ŸÜÿßŸÖŸá‚ÄåŸáÿß€å ÿØ€å⁄ØŸá) ÿÆŸàŸÜÿØŸá ÿ®ÿ¥Ÿá.\n-\n-ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å ŸÖ€å‚Äåÿ™ŸàŸÜŸÜ ÿ®ÿ±ÿß€å ŸÖÿØ€åÿ±€åÿ™ **ÿ™ŸÜÿ∏€åŸÖÿßÿ™** ÿ®ÿ±ŸÜÿßŸÖŸáÿå ÿ®Ÿá‚ÄåÿπŸÜŸàÿßŸÜ ÿ®ÿÆÿ¥€å ÿßÿ≤ **ŸÜÿµÿ®** Ÿæÿß€åÿ™ŸàŸÜ Ÿà ÿ∫€åÿ±Ÿá ŸÖŸÅ€åÿØ ÿ®ÿßÿ¥ŸÜ.\n-\n-## ÿ≥ÿßÿÆÿ™ Ÿà ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å\n-\n-ŸÖ€å‚Äåÿ™ŸàŸÜ€å ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ŸÖÿ≠€åÿ∑€å ÿ±Ÿà ÿ™Ÿà€å **ÿ¥ŸÑ (ÿ™ÿ±ŸÖ€åŸÜÿßŸÑ)** **ÿ®ÿ≥ÿßÿ≤€å** Ÿà ÿßÿ≤ÿ¥ŸàŸÜ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿå ÿ®ÿØŸàŸÜ ÿß€åŸÜ⁄©Ÿá ÿ®Ÿá Ÿæÿß€åÿ™ŸàŸÜ ŸÜ€åÿßÿ≤ ÿØÿßÿ¥ÿ™Ÿá ÿ®ÿßÿ¥€å:\n-\n-//// tab | ŸÑ€åŸÜŸà⁄©ÿ≥ÿå ŸÖ⁄©‚ÄåÿßŸàÿßÿ≥ÿå Ÿà€åŸÜÿØŸàÿ≤ ÿ®ÿ¥\n-\n-<div class=\"termy\">\n-\n-\n```\n\n```diff\n@@ -1,209 +0,0 @@\n-# Ÿà€å⁄ò⁄Ø€å Ÿáÿß\n-\n-## Ÿà€å⁄ò⁄Ø€å Ÿáÿß€å FastAPI\n-\n-**FastAPI** ŸÖŸàÿßÿ±ÿØ ÿ≤€åÿ± ÿ±ÿß ÿ®Ÿá ÿ¥ŸÖÿß ÿßÿ±ÿßÿ¶Ÿá ŸÖ€åÿØŸáÿØ:\n-\n-### ÿ®ÿ±Ÿæÿß€åŸá ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ Ÿáÿß€å ÿ®ÿßÿ≤\n-\n-* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> ÿ®ÿ±ÿß€å ÿ≥ÿßÿÆÿ™ API, ÿ¥ÿßŸÖŸÑ ŸÖÿ¥ÿÆÿµ ÿ≥ÿßÿ≤€å <abbr title=\"⁄©Ÿá ÿπŸÑÿßŸàŸá ÿ®ÿ± path, ÿ®Ÿá ÿπŸÜŸàÿßŸÜ endpoint Ÿà route ŸÜ€åÿ≤ ÿ¥ŸÜÿßÿÆÿ™Ÿá ŸÖ€åÿ¥ŸàÿØ\">path</abbr> <abbr title=\"⁄©Ÿá ÿ®Ÿá ÿπŸÜŸàÿßŸÜ ŸÖÿ™ŸàÿØŸáÿß€å HTTP €åÿπŸÜ€å POST,GET,PUT,DELETE Ÿà ... ÿ¥ŸÜÿßÿÆÿ™Ÿá ŸÖ€åÿ¥ŸàŸÜÿØ\">operation</abbr> Ÿáÿß, <abbr title=\"parameters\">Ÿæÿßÿ±ÿßŸÖÿ™ÿ±Ÿáÿß</abbr>, body request Ÿáÿß, ÿßŸÖŸÜ€åÿ™ Ÿà ÿ∫€åÿ±Ÿá.\n-* ŸÖÿ≥ÿ™ŸÜÿØÿ≥ÿßÿ≤€å ÿÆŸàÿØ⁄©ÿßÿ± data model ÿ®ÿß <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (ŸáŸÖÿßŸÜÿ∑Ÿàÿ± ⁄©Ÿá OpenAPI ÿÆŸàÿØ ŸÜ€åÿ≤ ŸÖÿ®ÿ™ŸÜ€å ÿ®ÿ± JSON Schema ÿßÿ≥ÿ™).\n-* ÿ∑ÿ±ÿßÿ≠€å ÿ¥ÿØŸá ÿ®ÿ± ÿßÿ≥ÿßÿ≥ ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ Ÿáÿß€å€å ⁄©Ÿá Ÿæÿ≥ ÿßÿ≤ €å⁄© ŸÖÿ∑ÿßŸÑÿπŸá ÿØŸÇ€åŸÇ ÿ®ÿØÿ≥ÿ™ ÿ¢ŸÖÿØŸá ÿßŸÜÿØ ÿ®ÿ¨ÿß€å ÿ∑ÿ±ÿ≠€å ŸÜÿßŸæÿÆÿ™Ÿá Ÿà ÿ®ÿØŸàŸÜ ŸÅ⁄©ÿ±.\n-* ŸáŸÖ⁄ÜŸÜ€åŸÜ ÿ®Ÿá ÿ¥ŸÖÿß ÿßÿ¨ÿßÿ≤Ÿá ŸÖ€åÿØŸáÿØ ÿ™ÿß ÿßÿ≤ ÿ™ŸàŸÑ€åÿØ ÿÆŸàÿØ⁄©ÿßÿ± client code ÿØÿ± ÿ®ÿ≥€åÿßÿ±€å ÿßÿ≤ ÿ≤ÿ®ÿßŸÜ Ÿáÿß ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ.\n-\n-### ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ÿÆŸàÿØ⁄©ÿßÿ±\n-\n-ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ API ÿ™ÿπÿßŸÖŸÑ€å Ÿà ÿß€åÿ¨ÿßÿØ ÿ±ÿßÿ®ÿ∑ ⁄©ÿßÿ±ÿ®ÿ±€å Ÿàÿ®. ÿßÿ≤ ÿ¢ŸÜÿ¨ÿß€å€å ⁄©Ÿá ÿß€åŸÜ ŸÅÿ±€åŸÖ Ÿàÿ±⁄© ÿ®ÿ±Ÿæÿß€åŸá OpenAPI ŸÖ€åÿ®ÿßÿ¥ÿØÿå ÿ¢Ÿæÿ¥ŸÜ Ÿáÿß€å ŸÖÿ™ÿπÿØÿØ€å Ÿàÿ¨ŸàÿØ ÿØÿßÿ±ÿØ ⁄©Ÿá €≤ ŸÖŸàÿ±ÿØ ÿ®ÿµŸàÿ±ÿ™ Ÿæ€åÿ¥ ŸÅÿ±ÿ∂ ⁄ØŸÜÿ¨ÿßŸÜÿØŸá ÿ¥ÿØŸá ÿßŸÜÿØ.\n-\n-* <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>ÿå ÿ®ÿß <abbr title=\"interactive exploration\">⁄©ÿßŸàÿ¥ ÿ™ÿπÿßŸÖŸÑ€å</abbr>ÿå API ÿÆŸàÿØ ÿ±ÿß ŸÖÿ≥ÿ™ŸÇ€åŸÖÿß ÿßÿ≤ ÿ∑ÿ±€åŸÇ ŸÖÿ±Ÿàÿ±⁄Øÿ± ÿµÿØÿßÿ≤ÿØŸá Ÿà ÿ™ÿ≥ÿ™ ⁄©ŸÜ€åÿØ.\n-\n-![Swagger UI interaction](https://fastapi.tiangolo.com/img/index/index-03-swagger-02.png)\n-\n-* ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ API ÿ¨ÿß€å⁄Øÿ≤€åŸÜ ÿ®ÿß <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>.\n-\n-![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n-\n-### ŸÅŸÇÿ∑ Ÿæÿß€åÿ™ŸàŸÜ ŸÖÿØÿ±ŸÜ\n-\n-ŸáŸÖŸá ÿß€åŸÜŸáÿß ÿ®ÿ±Ÿæÿß€åŸá type declaration Ÿáÿß€å **Ÿæÿß€åÿ™ŸàŸÜ €≥.€∂** ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ (ÿ®Ÿá ŸÑÿ∑ŸÅ Pydantic) ŸÖ€åÿ®ÿßÿ¥ŸÜÿØ. ÿ≥€åŸÜÿ™⁄©ÿ≥ ÿ¨ÿØ€åÿØ€å ÿØÿ±⁄©ÿßÿ± ŸÜ€åÿ≥ÿ™. ÿ™ŸÜŸáÿß Ÿæÿß€åÿ™ŸàŸÜ ŸÖÿØÿ±ŸÜ ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ.\n-\n-ÿß⁄Øÿ± ÿ®Ÿá €å⁄© €åÿßÿØÿ¢Ÿàÿ±€å €≤ ÿØŸÇ€åŸÇŸá ÿß€å ÿØÿ± ŸÖŸàÿ±ÿØ ŸÜÿ≠ŸàŸá ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ÿ™ÿß€åŸæ Ÿáÿß€å Ÿæÿß€åÿ™ŸàŸÜ ÿØÿßÿ±€åÿØ (ÿ≠ÿ™€å ÿß⁄Øÿ± ÿßÿ≤ FastAPI ", "output": "Changes look good. This PR implements: üî• Remove inactive/scarce translations to Persian", "source": "pr", "type": "code_review", "pr_number": 594}
{"instruction": "Review the following code changes: üî• Remove inactive/scarce translations to Vietnamese", "input": "```diff\n@@ -331,8 +331,6 @@ extra:\n     name: tr - T√ºrk√ße\n   - link: /uk/\n     name: uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞\n-  - link: /vi/\n-    name: vi - Ti·∫øng Vi·ªát\n   - link: /zh/\n     name: zh - ÁÆÄ‰Ωì‰∏≠Êñá\n   - link: /zh-hant/\n\n```\n\n```diff\n@@ -1,14 +0,0 @@\n-# Tri·ªÉn khai FastAPI tr√™n c√°c D·ªãch v·ª• Cloud\n-\n-B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng **b·∫•t k·ª≥ nh√† cung c·∫•p d·ªãch v·ª• cloud** n√†o ƒë·ªÉ tri·ªÉn khai ·ª©ng d·ª•ng FastAPI c·ªßa m√¨nh.\n-\n-Trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, c√°c nh√† cung c·∫•p d·ªãch v·ª• cloud l·ªõn ƒë·ªÅu c√≥ h∆∞·ªõng d·∫´n tri·ªÉn khai FastAPI v·ªõi h·ªç.\n-\n-## Nh√† cung c·∫•p d·ªãch v·ª• Cloud - Nh√† t√†i tr·ª£\n-M·ªôt v√†i nh√† cung c·∫•p d·ªãch v·ª• cloud ‚ú® [**t√†i tr·ª£ cho FastAPI**](../help-fastapi.md#sponsor-the-author){.internal-link target=_blank} ‚ú®, ƒëi·ªÅu n√†y gi√∫p ƒë·∫£m b·∫£o s·ª± ph√°t tri·ªÉn li√™n t·ª•c v√† kh·ªèe m·∫°nh c·ªßa FastAPI v√† h·ªá sinh th√°i c·ªßa n√≥.\n-\n-Th√™m n·ªØa, ƒëi·ªÅu n√†y c≈©ng th·ªÉ hi·ªán cam k·∫øt th·ª±c s·ª± c·ªßa h·ªç ƒë·ªëi v·ªõi FastAPI v√† **c·ªông ƒë·ªìng ng∆∞·ªùi d√πng** (b·∫°n), v√¨ h·ªç kh√¥ng ch·ªâ mu·ªën cung c·∫•p cho b·∫°n m·ªôt **d·ªãch v·ª• t·ªët** m√† c√≤n mu·ªën ƒë·∫£m b·∫£o r·∫±ng b·∫°n c√≥ m·ªôt **framework t·ªët v√† b·ªÅn v·ªØng**, ƒë√≥ ch√≠nh l√† FastAPI. üôá\n-\n-B·∫°n c√≥ th·ªÉ th·ª≠ c√°c d·ªãch v·ª• c·ªßa h·ªç v√† l√†m theo h∆∞·ªõng d·∫´n c·ªßa h·ªç:\n-\n-* <a href=\"https://docs.render.com/deploy-fastapi?utm_source=deploydoc&utm_medium=referral&utm_campaign=fastapi\" class=\"external-link\" target=\"_blank\">Render</a>\n\n```\n\n```diff\n@@ -1,21 +0,0 @@\n-# Tri·ªÉn khai\n-\n-Tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng **FastAPI** kh√° d·ªÖ d√†ng.\n-\n-## Tri·ªÉn khai l√† g√¨\n-\n-Tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng c√≥ nghƒ©a l√† th·ª±c hi·ªán c√°c b∆∞·ªõc c·∫ßn thi·∫øt ƒë·ªÉ l√†m cho n√≥ **s·∫µn s√†ng ph·ª•c v·ª• ng∆∞·ªùi d√πng**.\n-\n-ƒê·ªëi v·ªõi m·ªôt **API web**, ƒëi·ªÅu n√†y c√≥ nghƒ©a l√† ƒë·∫∑t n√≥ trong m·ªôt **m√°y ch·ªß t·ª´ xa**, v·ªõi m·ªôt **ch∆∞∆°ng tr√¨nh m√°y ch·ªß** cung c·∫•p hi·ªáu su·∫•t t·ªët, ·ªïn ƒë·ªãnh, v.v., ƒë·ªÉ ng∆∞·ªùi d√πng c·ªßa b·∫°n c√≥ th·ªÉ truy c·∫≠p ·ª©ng d·ª•ng c·ªßa b·∫°n m·ªôt c√°ch hi·ªáu qu·∫£ v√† kh√¥ng b·ªã gi√°n ƒëo·∫°n ho·∫∑c g·∫∑p v·∫•n ƒë·ªÅ.\n-\n-ƒêi·ªÅu n√†y tr√°i ng∆∞·ª£c v·ªõi c√°c **giai ƒëo·∫°n ph√°t tri·ªÉn**, trong ƒë√≥ b·∫°n li√™n t·ª•c thay ƒë·ªïi m√£, ph√° v·ª° n√≥ v√† s·ª≠a n√≥, ng·ª´ng v√† kh·ªüi ƒë·ªông l·∫°i m√°y ch·ªß ph√°t tri·ªÉn, v.v.\n-\n-## C√°c Chi·∫øn l∆∞·ª£c Tri·ªÉn khai\n-\n-C√≥ nhi·ªÅu c√°ch ƒë·ªÉ tri·ªÉn khai ·ª©ng d·ª•ng c·ªßa b·∫°n t√πy thu·ªôc v√†o tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng c·ªßa b·∫°n v√† c√°c c√¥ng c·ª• m√† b·∫°n s·ª≠ d·ª•ng.\n-\n-B·∫°n c√≥ th·ªÉ **tri·ªÉn khai m·ªôt m√°y ch·ªß** c·ªßa ri√™ng b·∫°n b·∫±ng c√°ch s·ª≠ d·ª•ng m·ªôt s·ª± k·∫øt h·ª£p c√°c c√¥ng c·ª•, ho·∫∑c b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng m·ªôt **d·ªãch v·ª• cloud** ƒë·ªÉ l√†m m·ªôt s·ªë c√¥ng vi·ªác cho b·∫°n, ho·∫∑c c√°c t√πy ch·ªçn kh√°c.\n-\n-T√¥i s·∫Ω ch·ªâ ra m·ªôt s·ªë kh√°i ni·ªám ch√≠nh c·∫ßn thi·∫øt khi tri·ªÉn khai m·ªôt ·ª©ng d·ª•ng **FastAPI** (m·∫∑c d√π h·∫ßu h·∫øt n√≥ √°p d·ª•ng cho b·∫•t k·ª≥ lo·∫°i ·ª©ng d·ª•ng web n√†o).\n-\n-B·∫°n s·∫Ω th·∫•y nhi·ªÅu chi ti·∫øt c·∫ßn thi·∫øt v√† m·ªôt s·ªë k·ªπ thu·∫≠t ƒë·ªÉ tri·ªÉn khai trong c√°c ph·∫ßn ti·∫øp theo. ‚ú®\n\n```\n\n```diff\n@@ -1,93 +0,0 @@\n-# V·ªÅ c√°c phi√™n b·∫£n c·ªßa FastAPI\n-\n-**FastAPI** ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü quy m√¥ th·ª±c t·∫ø (production) trong nhi·ªÅu ·ª©ng d·ª•ng v√† h·ªá th·ªëng. V√† ph·∫°m vi ki·ªÉm th·ª≠ ƒë∆∞·ª£c gi·ªØ ·ªü m·ª©c 100%. Nh∆∞ng vi·ªác ph√°t tri·ªÉn c·ªßa n√≥ v·∫´n ƒëang di·ªÖn ra nhanh ch√≥ng.\n-\n-C√°c t√≠nh nƒÉng m·ªõi ƒë∆∞·ª£c b·ªï sung th∆∞·ªùng xuy√™n, l·ªói ƒë∆∞·ª£c s·ª≠a ƒë·ªãnh k·ª≥, v√† m√£ ngu·ªìn v·∫´n ƒëang ƒë∆∞·ª£c c·∫£i thi·ªán li√™n t·ª•c\n-\n-ƒê√≥ l√† l√≠ do c√°c phi√™n b·∫£n hi·ªán t·∫°i v·∫´n c√≤n l√† 0.x.x, ƒëi·ªÅu n√†y ph·∫£n √°nh r·∫±ng m·ªói phi√™n b·∫£n c√≥ th·ªÉ c√≥ c√°c thay ƒë·ªïi g√¢y m·∫•t t∆∞∆°ng th√≠ch. ƒêi·ªÅu n√†y tu√¢n theo c√°c quy ∆∞·ªõc v·ªÅ <a href=\"https://semver.org/\" class=\"external-link\" target=\"blank\">Semantic Versioning</a>.\n-\n-B·∫°n c√≥ th·ªÉ t·∫°o ra s·∫£n ph·∫©m th·ª±c t·∫ø v·ªõi **FastAPI** ngay b√¢y gi·ªù (v√† b·∫°n c√≥ th·ªÉ ƒë√£ l√†m ƒëi·ªÅu n√†y trong m·ªôt th·ªùi gian d√†i), b·∫°n ch·ªâ c·∫ßn ƒë·∫£m b·∫£o r·∫±ng b·∫°n s·ª≠ d·ª•ng m·ªôt phi√™n b·∫£n ho·∫°t ƒë·ªông ƒë√∫ng v·ªõi c√°c ƒëo·∫°n m√£ c√≤n l·∫°i c·ªßa b·∫°n.\n-\n-## C·ªë ƒë·ªãnh phi√™n b·∫£n c·ªßa `fastapi`\n-\n-ƒêi·ªÅu ƒë·∫ßu ti√™n b·∫°n n√™n l√†m l√† \"c·ªë ƒë·ªãnh\" phi√™n b·∫£n c·ªßa **FastAPI** b·∫°n ƒëang s·ª≠ d·ª•ng ƒë·ªÉ phi√™n b·∫£n m·ªõi nh·∫•t m√† b·∫°n bi·∫øt ho·∫°t ƒë·ªông ƒë√∫ng v·ªõi ·ª©ng d·ª•ng c·ªßa b·∫°n.\n-\n-V√≠ d·ª•, gi·∫£ s·ª≠ b·∫°n ƒëang s·ª≠ d·ª•ng phi√™n b·∫£n `0.112.0` trong ·ª©ng d·ª•ng c·ªßa b·∫°n.\n-\n-N·∫øu b·∫°n s·ª≠ d·ª•ng m·ªôt t·ªáp `requirements.txt` b·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh phi√™n b·∫£n v·ªõi:\n-\n-\n```\n\n```diff\n@@ -1,300 +0,0 @@\n-# Bi·∫øn m√¥i tr∆∞·ªùng (Environment Variables)\n-\n-/// tip\n-\n-N·∫øu b·∫°n ƒë√£ bi·∫øt v·ªÅ \"bi·∫øn m√¥i tr∆∞·ªùng\" v√† c√°ch s·ª≠ d·ª•ng ch√∫ng, b·∫°n c√≥ th·ªÉ b·ªè qua ph·∫ßn n√†y.\n-\n-///\n-\n-M·ªôt bi·∫øn m√¥i tr∆∞·ªùng (c√≤n ƒë∆∞·ª£c g·ªçi l√† \"**env var**\") l√† m·ªôt bi·∫øn m√† t·ªìn t·∫°i **b√™n ngo√†i** ƒëo·∫°n m√£ Python, ·ªü trong **h·ªá ƒëi·ªÅu h√†nh**, v√† c√≥ th·ªÉ ƒë∆∞·ª£c ƒë·ªçc b·ªüi ƒëo·∫°n m√£ Python c·ªßa b·∫°n (ho·∫∑c b·ªüi c√°c ch∆∞∆°ng tr√¨nh kh√°c).\n-\n-C√°c bi·∫øn m√¥i tr∆∞·ªùng c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ x·ª≠ l√≠ **c√°c thi·∫øt l·∫≠p** c·ªßa ·ª©ng d·ª•ng, nh∆∞ m·ªôt ph·∫ßn c·ªßa **c√°c qu√° tr√¨nh c√†i ƒë·∫∑t** Python, v.v.\n-\n-## T·∫°o v√† S·ª≠ d·ª•ng c√°c Bi·∫øn M√¥i Tr∆∞·ªùng\n-\n-B·∫°n c√≥ th·ªÉ **t·∫°o** v√† s·ª≠ d·ª•ng c√°c bi·∫øn m√¥i tr∆∞·ªùng trong **shell (terminal)**, m√† kh√¥ng c·∫ßn s·ª≠ d·ª•ng Python:\n-\n-//// tab | Linux, macOS, Windows Bash\n-\n-<div class=\"termy\">\n-\n-\n```", "output": "Changes look good. This PR implements: üî• Remove inactive/scarce translations to Vietnamese", "source": "pr", "type": "code_review", "pr_number": 593}
{"instruction": "Review the following code changes: üåê Update translations for de (update-outdated)", "input": "```diff\n@@ -1,6 +1,6 @@\n # LLM-Testdatei { #llm-test-file }\n \n-Dieses Dokument testet, ob das <abbr title=\"Large Language Model ‚Äì Gro√ües Sprachmodell\">LLM</abbr>, das die Dokumentation √ºbersetzt, den <abbr title=\"General Prompt ‚Äì Allgemeiner Prompt\">`general_prompt`</abbr> in `scripts/translate.py` und den sprachspezifischen Prompt in `docs/{language code}/llm-prompt.md` versteht. Der sprachspezifische Prompt wird an `general_prompt` angeh√§ngt.\n+Dieses Dokument testet, ob das <abbr title=\"Large Language Model ‚Äì Gro√ües Sprachmodell\">LLM</abbr>, das die Dokumentation √ºbersetzt, den <abbr title=\"General Prompt ‚Äì Allgemeiner Prompt\">`general_prompt`</abbr> in `scripts/translate.py` und den sprachspezifischen Prompt in `docs/{language code}/llm-prompt.md` versteht. Der sprachsspezifische Prompt wird an `general_prompt` angeh√§ngt.\n \n Hier hinzugef√ºgte Tests werden von allen Erstellern sprachspezifischer Prompts gesehen.\n \n@@ -35,7 +35,7 @@ Siehe Abschnitt `### Content of code snippets` im allgemeinen Prompt in `scripts\n \n //// tab | Test\n \n-Gestern schrieb mein Freund: ‚ÄûWenn man unkorrekt korrekt schreibt, hat man es unkorrekt geschrieben‚Äú. Worauf ich antwortete: ‚ÄûKorrekt, aber ‚Äöunkorrekt‚Äò ist unkorrekterweise nicht ‚Äö‚Äûunkorrekt‚Äú‚Äò‚Äú.\n+Gestern schrieb mein Freund: ‚ÄûWenn man ‚Äöincorrectly‚Äò korrekt buchstabiert, hat man es falsch buchstabiert‚Äú. Worauf ich antwortete: ‚ÄûKorrekt, aber ‚Äöincorrectly‚Äò ist inkorrekt nicht ‚Äö‚Äö‚Äûincorrectly‚Äú‚Äò‚Äò‚Äú.\n \n /// note | Hinweis\n \n\n```\n\n```diff\n@@ -52,13 +52,13 @@ Seine Schl√ºssel-Merkmale sind:\n \n <!-- sponsors -->\n \n-### Keystone-Sponsor\n+### Keystone-Sponsor { #keystone-sponsor }\n \n {% for sponsor in sponsors.keystone -%}\n <a href=\"{{ sponsor.url }}\" target=\"_blank\" title=\"{{ sponsor.title }}\"><img src=\"{{ sponsor.img }}\" style=\"border-radius:15px\"></a>\n {% endfor -%}\n \n-### Gold- und Silber-Sponsoren\n+### Gold- und Silber-Sponsoren { #gold-and-silver-sponsors }\n \n {% for sponsor in sponsors.gold -%}\n <a href=\"{{ sponsor.url }}\" target=\"_blank\" title=\"{{ sponsor.title }}\"><img src=\"{{ sponsor.img }}\" style=\"border-radius:15px\"></a>\n\n```", "output": "Changes look good. This PR implements: üåê Update translations for de (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 592}
{"instruction": "Review the following code changes: üåê Sync Spanish docs (outdated pages found with script)", "input": "```diff\n@@ -414,11 +414,11 @@ Generar√° un esquema de OpenAPI como:\n         },\n         {\n             \"url\": \"https://stag.example.com\",\n-            \"description\": \"Entorno de pruebas\"\n+            \"description\": \"Staging environment\"\n         },\n         {\n             \"url\": \"https://prod.example.com\",\n-            \"description\": \"Entorno de producci√≥n\"\n+            \"description\": \"Production environment\"\n         }\n     ],\n     \"paths\": {\n\n```\n\n```diff\n@@ -220,7 +220,7 @@ Toma un generador `async` o un generador/iterador normal y transmite el cuerpo d\n \n #### Usando `StreamingResponse` con objetos similares a archivos { #using-streamingresponse-with-file-like-objects }\n \n-Si tienes un objeto similar a un archivo (por ejemplo, el objeto devuelto por `open()`), puedes crear una funci√≥n generadora para iterar sobre ese objeto similar a un archivo.\n+Si tienes un <a href=\"https://docs.python.org/3/glossary.html#term-file-like-object\" class=\"external-link\" target=\"_blank\">objeto similar a un archivo</a> (por ejemplo, el objeto devuelto por `open()`), puedes crear una funci√≥n generadora para iterar sobre ese objeto similar a un archivo.\n \n De esa manera, no tienes que leerlo todo primero en memoria, y puedes pasar esa funci√≥n generadora al `StreamingResponse`, y devolverlo.\n \n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# Eventos de Lifespan\n+# Eventos de Lifespan { #lifespan-events }\n \n Puedes definir l√≥gica (c√≥digo) que deber√≠a ser ejecutada antes de que la aplicaci√≥n **inicie**. Esto significa que este c√≥digo ser√° ejecutado **una vez**, **antes** de que la aplicaci√≥n **comience a recibir requests**.\n \n@@ -8,7 +8,7 @@ Debido a que este c√≥digo se ejecuta antes de que la aplicaci√≥n **comience** a\n \n Esto puede ser muy √∫til para configurar **recursos** que necesitas usar para toda la app, y que son **compartidos** entre requests, y/o que necesitas **limpiar** despu√©s. Por ejemplo, un pool de conexiones a una base de datos, o cargando un modelo de machine learning compartido.\n \n-## Caso de Uso\n+## Caso de Uso { #use-case }\n \n Empecemos con un ejemplo de **caso de uso** y luego veamos c√≥mo resolverlo con esto.\n \n@@ -22,7 +22,7 @@ Podr√≠as cargarlo en el nivel superior del m√≥dulo/archivo, pero eso tambi√©n si\n \n Eso es lo que resolveremos, vamos a cargar el modelo antes de que los requests sean manejados, pero solo justo antes de que la aplicaci√≥n comience a recibir requests, no mientras el c√≥digo se est√° cargando.\n \n-## Lifespan\n+## Lifespan { #lifespan }\n \n Puedes definir esta l√≥gica de *startup* y *shutdown* usando el par√°metro `lifespan` de la app de `FastAPI`, y un \"context manager\" (te mostrar√© lo que es en un momento).\n \n@@ -44,7 +44,7 @@ Quiz√°s necesites iniciar una nueva versi√≥n, o simplemente te cansaste de ejecu\n \n ///\n \n-### Funci√≥n de Lifespan\n+### Funci√≥n de Lifespan { #lifespan-function }\n \n Lo primero que hay que notar es que estamos definiendo una funci√≥n as√≠ncrona con `yield`. Esto es muy similar a las Dependencias con `yield`.\n \n@@ -54,15 +54,15 @@ La primera parte de la funci√≥n, antes del `yield`, ser√° ejecutada **antes** de\n \n Y la parte despu√©s del `yield` ser√° ejecutada **despu√©s** de que la aplicaci√≥n haya terminado.\n \n-### Async Context Manager\n+### Async Context Manager { #async-context-manager }\n \n Si revisas, la funci√≥n est√° decorada con un `@asynccontextmanager`.\n \n Eso convierte a la funci√≥n en algo llamado un \"**async context manager**\".\n \n {* ../../docs_src/events/tutorial003.py hl[1,13] *}\n \n-Un **context manager** en Python es algo que puedes usar en una declaraci√≥n `with`, por ejemplo, `open()` puede ser usado como un context manager:\n+Un **context manager** en Python es algo que puedes usar en un statement `with`, por ejemplo, `open()` puede ser usado como un context manager:\n \n \n```\n\n```diff\n@@ -1,14 +1,14 @@\n-# Middleware Avanzado\n+# Middleware Avanzado { #advanced-middleware }\n \n En el tutorial principal le√≠ste c√≥mo agregar [Middleware Personalizado](../tutorial/middleware.md){.internal-link target=_blank} a tu aplicaci√≥n.\n \n Y luego tambi√©n le√≠ste c√≥mo manejar [CORS con el `CORSMiddleware`](../tutorial/cors.md){.internal-link target=_blank}.\n \n En esta secci√≥n veremos c√≥mo usar otros middlewares.\n \n-## Agregando middlewares ASGI\n+## Agregando middlewares ASGI { #adding-asgi-middlewares }\n \n-Como **FastAPI** est√° basado en Starlette e implementa la especificaci√≥n <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr>, puedes usar cualquier middleware ASGI.\n+Como **FastAPI** est√° basado en Starlette e implementa la especificaci√≥n <abbr title=\"Asynchronous Server Gateway Interface ‚Äì Interfaz de puerta de enlace de servidor as√≠ncrona\">ASGI</abbr>, puedes usar cualquier middleware ASGI.\n \n Un middleware no tiene que estar hecho para FastAPI o Starlette para funcionar, siempre que siga la especificaci√≥n ASGI.\n \n@@ -39,7 +39,7 @@ app.add_middleware(UnicornMiddleware, some_config=\"rainbow\")\n \n `app.add_middleware()` recibe una clase de middleware como primer argumento y cualquier argument", "output": "Changes look good. This PR implements: üåê Sync Spanish docs (outdated pages found with script)", "source": "pr", "type": "code_review", "pr_number": 591}
{"instruction": "Review the following code changes: üåê Sync Portuguese docs (pages found with script)", "input": "```diff\n@@ -15,7 +15,7 @@ Use da seguinte forma:\n \n Os testes:\n \n-## Trechos de c√≥digo { #code-snippets}\n+## Trechos de c√≥digo { #code-snippets }\n \n //// tab | Teste\n \n@@ -53,7 +53,7 @@ Veja, por exemplo, a se√ß√£o `### Quotes` em `docs/de/llm-prompt.md`.\n \n ////\n \n-## Cita√ß√µes em trechos de c√≥digo { #quotes-in-code-snippets}\n+## Cita√ß√µes em trechos de c√≥digo { #quotes-in-code-snippets }\n \n //// tab | Teste\n \n\n```\n\n```diff\n@@ -13,7 +13,7 @@ Reposit√≥rio GitHub: <a href=\"https://github.com/tiangolo/full-stack-fastapi-tem\n     - üîç [Pydantic](https://docs.pydantic.dev), usado pelo FastAPI, para valida√ß√£o de dados e gerenciamento de configura√ß√µes.\n     - üíæ [PostgreSQL](https://www.postgresql.org) como banco de dados SQL.\n - üöÄ [React](https://react.dev) para o frontend.\n-    - üíÉ Usando TypeScript, hooks, [Vite](https://vitejs.dev), e outras partes de uma _stack_ frontend moderna.\n+    - üíÉ Usando TypeScript, hooks, Vite, e outras partes de uma _stack_ frontend moderna.\n     - üé® [Tailwind CSS](https://tailwindcss.com) e [shadcn/ui](https://ui.shadcn.com) para os componentes de frontend.\n     - ü§ñ Um cliente frontend automaticamente gerado.\n     - üß™ [Playwright](https://playwright.dev) para testes Ponta-a-Ponta.\n\n```\n\n```diff\n@@ -147,8 +147,8 @@ Se voc√™ for ao `/items/foo`, em vez de receber o JSON padr√£o com o erro:\n voc√™ receber√° a vers√£o em texto:\n \n \n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# Seguran√ßa\n+# Seguran√ßa { #security }\n \n H√° v√°rias formas de lidar seguran√ßa, autentica√ß√£o e autoriza√ß√£o.\n \n@@ -10,11 +10,11 @@ Em muitos frameworks e sistemas, apenas lidar com seguran√ßa e autentica√ß√£o ex\n \n Mas primeiro, vamos verificar alguns pequenos conceitos.\n \n-## Est√° com pressa?\n+## Est√° com pressa? { #in-a-hurry }\n \n Se voc√™ n√£o se importa com qualquer um desses termos e s√≥ precisa adicionar seguran√ßa com autentica√ß√£o baseada em usu√°rio e senha _agora_, pule para os pr√≥ximos cap√≠tulos.\n \n-## OAuth2\n+## OAuth2 { #oauth2 }\n \n OAuth2 √© uma especifica√ß√£o que define v√°rias formas para lidar com autentica√ß√£o e autoriza√ß√£o.\n \n@@ -24,7 +24,7 @@ Ela inclui uma forma para autentica√ß√£o usando ‚Äúthird party‚Äù/aplica√ß√µes d\n \n Isso √© o que todos os sistemas com ‚ÄúLogin with Facebook, Google, X (Twitter), GitHub‚Äù usam por baixo.\n \n-### OAuth 1\n+### OAuth 1 { #oauth-1 }\n \n Havia um OAuth 1, que √© bem diferente do OAuth2, e mais complexo, isso inclu√≠a diretamente as especifica√ß√µes de como criptografar a comunica√ß√£o.\n \n@@ -38,7 +38,7 @@ Na se√ß√£o sobre **deployment** voc√™ ir√° ver como configurar HTTPS de modo gra\n \n ///\n \n-## OpenID Connect\n+## OpenID Connect { #openid-connect }\n \n OpenID Connect √© outra especifica√ß√£o, baseada em **OAuth2**.\n \n@@ -48,15 +48,15 @@ Por exemplo, o login do Google usa OpenID Connect (que por baixo dos panos usa O\n \n Mas o login do Facebook n√£o tem suporte para OpenID Connect. Ele tem a pr√≥pria implementa√ß√£o do OAuth2.\n \n-### OpenID (n√£o \"OpenID Connect\")\n+### OpenID (n√£o \"OpenID Connect\") { #openid-not-openid-connect }\n \n Houve tamb√©m uma especifica√ß√£o ‚ÄúOpenID‚Äù. Ela tentou resolver a mesma coisa que a **OpenID Connect**, mas n√£o baseada em OAuth2.\n \n Ent√£o, ela foi um sistema adicional completo.\n \n Ela n√£o √© muito popular ou usada nos dias de hoje.\n \n-## OpenAPI\n+## OpenAPI { #openapi }\n \n OpenAPI (anteriormente conhecido como Swagger) √© a especifica√ß√£o aberta para a cria√ß√£o de APIs (agora parte da Linux Foundation).\n \n@@ -97,7 +97,7 @@ O problema mais complexo √© criar um provedor de autentica√ß√£o/autoriza√ß√£o co\n \n ///\n \n-## **FastAPI** utilit√°rios\n+## **FastAPI** utilit√°rios { #fastapi-utilities }\n \n **FastAPI** fornece v√°rias ferramentas para cada um desses esquemas de seguran√ßa no m√≥dulo `fastapi.security` que simplesmente usa esses mecanismos de seguran√ßa.\n \n\n```", "output": "Changes look good. This PR implements: üåê Sync Portuguese docs (pages found with script)", "source": "pr", "type": "code_review", "pr_number": 590}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for French, generated from the existing French docs", "input": "```diff\n@@ -0,0 +1,128 @@\n+### Target language\n+\n+Translate to French (fran√ßais).\n+\n+Language code: fr.\n+\n+### Grammar to use when talking to the reader\n+\n+Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+\n+### Quotes\n+\n+1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+\n+2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+\n+3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        ¬´¬´¬´\n+        \"Hello world\"\n+        ‚ÄúHello Universe‚Äù\n+        \"He said: 'Hello'\"\n+        \"The module is `__main__`\"\n+        ¬ª¬ª¬ª\n+\n+    Result (French):\n+\n+        ¬´¬´¬´\n+        ¬´Hello world¬ª\n+        ¬´Hello Universe¬ª\n+        ¬´He said: 'Hello'¬ª\n+        ¬´The module is `__main__`¬ª\n+        ¬ª¬ª¬ª\n+\n+### Ellipsis\n+\n+1) Make sure there is a space between an ellipsis and a word following or preceding the ellipsis.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        ¬´¬´¬´\n+        ...as we intended.\n+        ...this would work:\n+        ...etc.\n+        others...\n+        More to come...\n+        ¬ª¬ª¬ª\n+\n+    Result (French):\n+\n+        ¬´¬´¬´\n+        ... comme pr√©vu.\n+        ... cela fonctionnerait :\n+        ... etc.\n+        D'autres ...\n+        La suite ...\n+        ¬ª¬ª¬ª\n+\n+2) This does not apply in URLs, code blocks, and code snippets. Do not remove or add spaces there.\n+\n+### Headings\n+\n+1) Prefer translating headings using the infinitive form (as is common in the existing French docs): ¬´Cr√©er‚Ä¶¬ª, ¬´Utiliser‚Ä¶¬ª, ¬´Ajouter‚Ä¶¬ª.\n+\n+2) For headings that are instructions written in imperative in English (e.g. ‚ÄúGo check ‚Ä¶‚Äù), keep them in imperative in French, using the formal grammar (e.g. ¬´Allez voir ‚Ä¶¬ª).\n+\n+3) Keep heading punctuation as in the source. In particular, keep occurrences of literal ¬´ - ¬ª (space-hyphen-space) as ¬´ - ¬ª (the existing French docs use a hyphen here).\n+\n+### French instructions about technical terms\n+\n+Do not try to translate everything. In particular, keep common programming terms when that is the established usage in the French docs (e.g. ¬´framework¬ª, ¬´endpoint¬ª, ¬´plug-in¬ª, ¬´payload¬ª). Use French where the existing docs already consistently use French (e.g. ¬´requ√™te¬ª, ¬´r√©ponse¬ª).\n+\n+Keep class names, function names, modules, file names, and CLI commands unchanged.\n+\n+### List of English terms and their preferred French translations\n+\n+Below is a list of English terms and their preferred French translations, separated by a colon (¬´:¬ª). Use these translations, do not use your own. If an existing translation does not use these terms, update it to use them.\n+\n+* ¬´/// note | Technical Details¬ª: ¬´/// note | D√©tails techniques¬ª\n+* ¬´/// note¬ª: ¬´/// note | Remarque¬ª\n+* ¬´/// tip¬ª: ¬´/// tip | Astuce¬ª\n+* ¬´/// warning¬ª: ¬´/// warning | Attention¬ª\n+* ¬´/// check¬ª: ¬´/// check | v√©rifier¬ª\n+* ¬´/// info¬ª: ¬´/// info¬ª\n+\n+* ¬´the docs¬ª: ¬´les documents¬ª\n+* ¬´the documentatio\n\n```\n\n```diff\n@@ -0,0 +1,132 @@\n+### Target language\n+\n+Translate to French (fran√ßais).\n+\n+Language code: fr.\n+\n+### Grammar to use when talking to the reader\n+\n+Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+\n+### Quotes\n+\n+1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+\n+2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+\n+3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        ¬´¬´¬´\n+        \"Hello world\"\n+        ‚ÄúHello Universe‚Äù\n+        \"He said: 'Hello'\"\n+        \"The module is `__main__`\"\n+        ¬ª¬ª¬ª\n+\n+    Result (French):\n+\n+        ¬´¬´¬´\n+        ¬´Hello world¬ª\n+        ¬´Hello Universe¬ª\n+        ¬´He said: 'Hello'¬ª\n+        ¬´The module is `__main__`¬ª\n+        ¬ª¬ª¬ª\n+\n+### Ellipsis\n+\n+1) Make sure there is a space between an ellipsis and a word following or preceding the ellipsis.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        ¬´¬´¬´\n+        ...as we intended.\n+        ...this would work:\n+        ...etc.\n+        others...\n+        More to come...\n+        ¬ª¬ª¬ª\n+\n+    Result (French):\n+\n+        ¬´¬´¬´\n+        ... comme pr√©vu.\n+        ... cela fonctionnerait :\n+        ... etc.\n+        D'autres ...\n+        La suite ...\n+        ¬ª¬ª¬ª\n+\n+2) This does not apply in URLs, code blocks, and code snippets. Do not remove or add spaces there.\n+\n+### Headings\n+\n+1) Prefer translating headings using the infinitive form (as is common in the existing French docs): ¬´Cr√©er‚Ä¶¬ª, ¬´Utiliser‚Ä¶¬ª, ¬´Ajouter‚Ä¶¬ª.\n+\n+2) For headings that are instructions written in imperative in English (e.g. ‚ÄúGo check ‚Ä¶‚Äù), keep them in imperative in French, using the formal grammar (e.g. ¬´Allez voir ‚Ä¶¬ª).\n+\n+3) Keep heading punctuation as in the source. In particular, keep occurrences of literal ¬´ - ¬ª (space-hyphen-space) as ¬´ - ¬ª (the existing French docs use a hyphen her", "output": "Code Review for: üîß Add LLM prompt file for French, generated from the existing French docs\n\nüìù **docs/fr/llm-prompt.md**: attention\n\nüìù **docs/fr/llm-prompt.md**: maybe `les documents` ? Not sure in which context is `the docs` but it sounds like plurals of document, not documentation. Or maybe it's for documentation`s` so in this case it will be `les documentations`\n\nüìù **docs/fr/llm-prompt.md**: If your really want to translate it in french, it should be `autcompl√©tion` for both line but does it make sense to translate it ?\n\nüìù **docs/fr/llm-prompt.md**: `le corps de la requ√™te`\n\nüìù **docs/fr/llm-prompt.md**: `le corps de la r√©ponse`\n\n", "source": "pr", "type": "code_review", "pr_number": 589}
{"instruction": "Review this code change in `docs/fr/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,132 @@\n+### Target language\n+\n+Translate to French (fran√ßais).\n+\n+Language code: fr.\n+\n+### Grammar to use when talking to the reader\n+\n+Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+\n+### Quotes\n+\n+1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+\n+2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+\n+3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        ¬´¬´¬´\n+        \"Hello world\"\n+        ‚ÄúHello Universe‚Äù\n+        \"He said: 'Hello'\"\n+        \"The module is `__main__`\"\n+        ¬ª¬ª¬ª\n+\n+    Result (French):\n+\n+        ¬´¬´¬´\n+        ¬´Hello world¬ª\n+        ¬´Hello Universe¬ª\n+        ¬´He said: 'Hello'¬ª\n+        ¬´The module is `__main__`¬ª\n+        ¬ª¬ª¬ª\n+\n+### Ellipsis\n+\n+1) Make sure there is a space between an ellipsis and a word following or preceding the ellipsis.\n+\n+Examples:\n+\n+    Source (English):\n+\n+        ¬´¬´¬´\n+        ...as we intended.\n+        ...this would work:\n+        ...etc.\n+        others...\n+        More to come...\n+        ¬ª¬ª¬ª\n+\n+    Result (French):\n+\n+        ¬´¬´¬´\n+        ... comme pr√©vu.\n+        ... cela fonctionnerait :\n+        ... etc.\n+        D'autres ...\n+        La suite ...\n+        ¬ª¬ª¬ª\n+\n+2) This does not apply in URLs, code blocks, and code snippets. Do not remove or add spaces there.\n+\n+### Headings\n+\n+1) Prefer translating headings using the infinitive form (as is common in the existing French docs): ¬´Cr√©er‚Ä¶¬ª, ¬´Utiliser‚Ä¶¬ª, ¬´Ajouter‚Ä¶¬ª.\n+\n+2) For headings that are instructions written in imperative in English (e.g. ‚ÄúGo check ‚Ä¶‚Äù), keep them in imperative in French, using the formal grammar (e.g. ¬´Allez voir ‚Ä¶¬ª).\n+\n+3) Keep heading punctuation as in the source. In particular, keep occurrences of literal ¬´ - ¬ª (space-hyphen-space) as ¬´ - ¬ª (the existing French docs use a hyphen here).\n+\n+### French instructions about technical terms\n+\n+Do not try to translate everything. In particular, keep common programming terms when that is the established usage in the French docs (e.g. ¬´framework¬ª, ¬´endpoint¬ª, ¬´plug-in¬ª, ¬´payload¬ª). Use French where the existing docs already consistently use French (e.g. ¬´requ√™te¬ª, ¬´r√©ponse¬ª).\n+\n+Keep class names, function names, modules, file names, and CLI commands unchanged.\n+\n+### List of English terms and their preferred French translations\n+\n+Below is a list of English terms and their preferred French translations, separated by a colon (¬´:¬ª). Use these translations, do not use your own. If an existing translation does not use these terms, update it to use them.\n+\n+* ¬´/// note | Technical Details¬ª: ¬´/// note | D√©tails techniques¬ª\n+* ¬´/// note¬ª: ¬´/// note | Remarque¬ª\n+* ¬´/// tip¬ª: ¬´/// tip | Astuce¬ª\n+* ¬´/// warning¬ª: ¬´/// warning | Attention¬ª\n+* ¬´/// check¬ª: ¬´/// check | v√©rifier¬ª\n+* ¬´/// info¬ª: ¬´/// info¬ª\n+\n+* ¬´the docs¬ª: ¬´la documentation¬ª\n\n```", "output": "maybe `les documents` ? Not sure in which context is `the docs` but it sounds like plurals of document, not documentation. Or maybe it's for documentation`s` so in this case it will be `les documentations`", "source": "pr_review", "type": "inline_review", "pr_number": 589}
{"instruction": "Review the following code changes: üîß Temporarily disable translations still in progress, being migrated to the new LLM setup", "input": "```diff\n@@ -317,24 +317,10 @@ extra:\n     name: de - Deutsch\n   - link: /es/\n     name: es - espa√±ol\n-  - link: /fr/\n-    name: fr - fran√ßais\n-  - link: /ja/\n-    name: ja - Êó•Êú¨Ë™û\n-  - link: /ko/\n-    name: ko - ÌïúÍµ≠Ïñ¥\n   - link: /pt/\n     name: pt - portugu√™s\n   - link: /ru/\n     name: ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫\n-  - link: /tr/\n-    name: tr - T√ºrk√ße\n-  - link: /uk/\n-    name: uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞\n-  - link: /zh/\n-    name: zh - ÁÆÄ‰Ωì‰∏≠Êñá\n-  - link: /zh-hant/\n-    name: zh-hant - ÁπÅÈ´î‰∏≠Êñá\n extra_css:\n - css/termynal.css\n - css/custom.css\n\n```\n\n```diff\n@@ -19,6 +19,9 @@\n \n logging.basicConfig(level=logging.INFO)\n \n+SUPPORTED_LANGS = {\"en\", \"de\", \"es\", \"pt\", \"ru\"}\n+\n+\n app = typer.Typer()\n \n mkdocs_name = \"mkdocs.yml\"\n@@ -260,7 +263,11 @@ def build_all() -> None:\n     \"\"\"\n     update_languages()\n     shutil.rmtree(site_path, ignore_errors=True)\n-    langs = [lang.name for lang in get_lang_paths() if lang.is_dir()]\n+    langs = [\n+        lang.name\n+        for lang in get_lang_paths()\n+        if (lang.is_dir() and lang.name in SUPPORTED_LANGS)\n+    ]\n     cpu_count = os.cpu_count() or 1\n     process_pool_size = cpu_count * 4\n     typer.echo(f\"Using process pool size: {process_pool_size}\")\n@@ -340,6 +347,9 @@ def get_updated_config_content() -> Dict[str, Any]:\n     for lang_path in get_lang_paths():\n         if lang_path.name in {\"en\", \"em\"} or not lang_path.is_dir():\n             continue\n+        if lang_path.name not in SUPPORTED_LANGS:\n+            # Skip languages that are not yet ready\n+            continue\n         code = lang_path.name\n         languages.append({code: f\"/{code}/\"})\n     for lang_dict in languages:\n@@ -418,7 +428,7 @@ def verify_docs():\n def langs_json():\n     langs = []\n     for lang_path in get_lang_paths():\n-        if lang_path.is_dir():\n+        if lang_path.is_dir() and lang_path.name in SUPPORTED_LANGS:\n             langs.append(lang_path.name)\n     print(json.dumps(langs))\n \n\n```", "output": "Changes look good. This PR implements: üîß Temporarily disable translations still in progress, being migrated to the new LLM setup", "source": "pr", "type": "code_review", "pr_number": 588}
{"instruction": "Review the following code changes: ‚¨Ü Bump markdown-include-variants from 0.0.6 to 0.0.7", "input": "```diff\n@@ -17,5 +17,5 @@ griffe-warnings-deprecated==1.1.0\n # For griffe, it formats with black\n black==25.1.0\n mkdocs-macros-plugin==1.4.1\n-markdown-include-variants==0.0.6\n+markdown-include-variants==0.0.7\n python-slugify==8.0.4\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump markdown-include-variants from 0.0.6 to 0.0.7", "source": "pr", "type": "code_review", "pr_number": 587}
{"instruction": "Review the following code changes: ‚¨Ü Bump `markdown-include-variants` from 0.0.7 to 0.0.8", "input": "```diff\n@@ -17,5 +17,5 @@ griffe-warnings-deprecated==1.1.0\n # For griffe, it formats with black\n black==25.1.0\n mkdocs-macros-plugin==1.4.1\n-markdown-include-variants==0.0.7\n+markdown-include-variants==0.0.8\n python-slugify==8.0.4\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump `markdown-include-variants` from 0.0.7 to 0.0.8", "source": "pr", "type": "code_review", "pr_number": 586}
{"instruction": "Review the following code changes: üåê Sync German docs", "input": "```diff\n@@ -15,7 +15,7 @@ So verwenden:\n \n Die Tests:\n \n-## Codeschnipsel { #code-snippets}\n+## Codeschnipsel { #code-snippets }\n \n //// tab | Test\n \n@@ -53,7 +53,7 @@ Siehe zum Beispiel den Abschnitt `### Quotes` in `docs/de/llm-prompt.md`.\n \n ////\n \n-## Anf√ºhrungszeichen in Codeschnipseln { #quotes-in-code-snippets}\n+## Anf√ºhrungszeichen in Codeschnipseln { #quotes-in-code-snippets }\n \n //// tab | Test\n \n\n```\n\n```diff\n@@ -52,13 +52,13 @@ Seine Schl√ºssel-Merkmale sind:\n \n <!-- sponsors -->\n \n-### Keystone-Sponsor\n+### Keystone-Sponsor { #keystone-sponsor }\n \n {% for sponsor in sponsors.keystone -%}\n <a href=\"{{ sponsor.url }}\" target=\"_blank\" title=\"{{ sponsor.title }}\"><img src=\"{{ sponsor.img }}\" style=\"border-radius:15px\"></a>\n {% endfor -%}\n \n-### Gold- und Silber-Sponsoren\n+### Gold- und Silber-Sponsoren { #gold-and-silver-sponsors }\n \n {% for sponsor in sponsors.gold -%}\n <a href=\"{{ sponsor.url }}\" target=\"_blank\" title=\"{{ sponsor.title }}\"><img src=\"{{ sponsor.img }}\" style=\"border-radius:15px\"></a>\n\n```", "output": "Changes look good. This PR implements: üåê Sync German docs", "source": "pr", "type": "code_review", "pr_number": 585}
{"instruction": "Review the following code changes: Security dependencies now working with websockets", "input": "```diff\n@@ -4,7 +4,7 @@\n from fastapi.openapi.models import APIKey, APIKeyIn\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated\n \n@@ -138,7 +138,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         api_key = request.query_params.get(self.model.name)\n         return self.check_api_key(api_key)\n \n@@ -226,7 +226,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         api_key = request.headers.get(self.model.name)\n         return self.check_api_key(api_key)\n \n@@ -314,6 +314,6 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         api_key = request.cookies.get(self.model.name)\n         return self.check_api_key(api_key)\n\n```\n\n```diff\n@@ -9,7 +9,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated\n \n@@ -93,7 +93,7 @@ def make_not_authenticated_error(self) -> HTTPException:\n         )\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n@@ -203,7 +203,7 @@ def make_authenticate_headers(self) -> Dict[str, str]:\n         return {\"WWW-Authenticate\": \"Basic\"}\n \n     async def __call__(  # type: ignore\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPBasicCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n@@ -304,7 +304,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n@@ -407,7 +407,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.param_functions import Form\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n # TODO: import from typing when deprecating Python 3.9\n@@ -399,7 +399,7 @@ def make_not_authenticated_error(self) -> HTTPException:\n             headers={\"WWW-Authenticate\": \"Bearer\"},\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         authorization = request.headers.get(\"Authorization\")\n         if not authorization:\n             if self.auto_error:\n@@ -506,7 +506,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n         if not authorization or scheme.lower() != \"bearer\":\n@@ -612,7 +612,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n         if not authorization or scheme.lower() != \"bearer\":\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n from fastapi.openapi.models import OpenIdConnect as OpenIdConnectModel\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HT", "output": "Changes look good. This PR implements: Security dependencies now working with websockets", "source": "pr", "type": "code_review", "pr_number": 584}
{"instruction": "Review the following code changes: üåê Update translations for pt (add-missing)", "input": "```diff\n@@ -0,0 +1,65 @@\n+# FastAPI Cloud { #fastapi-cloud }\n+\n+Voc√™ pode implantar sua aplica√ß√£o FastAPI no <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a> com um **√∫nico comando**; entre na lista de espera, caso ainda n√£o tenha feito isso. üöÄ\n+\n+## Login { #login }\n+\n+Certifique-se de que voc√™ j√° tem uma conta no **FastAPI Cloud** (n√≥s convidamos voc√™ a partir da lista de espera üòâ).\n+\n+Depois, fa√ßa login:\n+\n+<div class=\"termy\">\n+\n+\n```\n\n```diff\n@@ -0,0 +1,17 @@\n+# Usar antigos c√≥digos de status de erro de autentica√ß√£o 403 { #use-old-403-authentication-error-status-codes }\n+\n+Antes da vers√£o `0.122.0` do FastAPI, quando os utilit√°rios de seguran√ßa integrados retornavam um erro ao cliente ap√≥s uma falha na autentica√ß√£o, eles usavam o c√≥digo de status HTTP `403 Forbidden`.\n+\n+A partir da vers√£o `0.122.0` do FastAPI, eles usam o c√≥digo de status HTTP `401 Unauthorized`, mais apropriado, e retornam um cabe√ßalho `WWW-Authenticate` adequado na response, seguindo as especifica√ß√µes HTTP, <a href=\"https://datatracker.ietf.org/doc/html/rfc7235#section-3.1\" class=\"external-link\" target=\"_blank\">RFC 7235</a>, <a href=\"https://datatracker.ietf.org/doc/html/rfc9110#name-401-unauthorized\" class=\"external-link\" target=\"_blank\">RFC 9110</a>.\n+\n+Mas, se por algum motivo seus clientes dependem do comportamento antigo, voc√™ pode voltar a ele sobrescrevendo o m√©todo `make_not_authenticated_error` nas suas classes de seguran√ßa.\n+\n+Por exemplo, voc√™ pode criar uma subclasse de `HTTPBearer` que retorne um erro `403 Forbidden` em vez do erro padr√£o `401 Unauthorized`:\n+\n+{* ../../docs_src/authentication_error_status_code/tutorial001_an_py39.py hl[9:13] *}\n+\n+/// tip | Dica\n+\n+Perceba que a fun√ß√£o retorna a inst√¢ncia da exce√ß√£o, ela n√£o a lan√ßa. O lan√ßamento √© feito no restante do c√≥digo interno.\n+\n+///\n\n```", "output": "Changes look good. This PR implements: üåê Update translations for pt (add-missing)", "source": "pr", "type": "code_review", "pr_number": 583}
{"instruction": "Review the following code changes: üìù Remove code examples for Python 3.8", "input": "```diff\n@@ -26,7 +26,7 @@ Jedes dieser Response-`dict`s kann einen Schl√ºssel `model` haben, welcher ein P\n \n Um beispielsweise eine weitere Response mit dem Statuscode `404` und einem Pydantic-Modell `Message` zu deklarieren, k√∂nnen Sie schreiben:\n \n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n /// note | Hinweis\n \n@@ -203,7 +203,7 @@ Sie k√∂nnen beispielsweise eine Response mit dem Statuscode `404` deklarieren, d\n \n Und eine Response mit dem Statuscode `200`, die Ihr `response_model` verwendet, aber ein benutzerdefiniertes Beispiel (`example`) enth√§lt:\n \n-{* ../../docs_src/additional_responses/tutorial003.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n \n Es wird alles kombiniert und in Ihre OpenAPI eingebunden und in der API-Dokumentation angezeigt:\n \n\n```\n\n```diff\n@@ -32,11 +32,11 @@ Betrachten wir als einfaches Beispiel eine Dateistruktur √§hnlich der in [Gr√∂√ü\n \n Die Datei `main.py` h√§tte als Inhalt:\n \n-{* ../../docs_src/async_tests/main.py *}\n+{* ../../docs_src/async_tests/app_a_py39/main.py *}\n \n Die Datei `test_main.py` h√§tte die Tests f√ºr `main.py`, das k√∂nnte jetzt so aussehen:\n \n-{* ../../docs_src/async_tests/test_main.py *}\n+{* ../../docs_src/async_tests/app_a_py39/test_main.py *}\n \n ## Es ausf√ºhren { #run-it }\n \n@@ -56,7 +56,7 @@ $ pytest\n \n Der Marker `@pytest.mark.anyio` teilt pytest mit, dass diese Testfunktion asynchron aufgerufen werden soll:\n \n-{* ../../docs_src/async_tests/test_main.py hl[7] *}\n+{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[7] *}\n \n /// tip | Tipp\n \n@@ -66,7 +66,7 @@ Beachten Sie, dass die Testfunktion jetzt `async def` ist und nicht nur `def` wi\n \n Dann k√∂nnen wir einen `AsyncClient` mit der App erstellen und mit `await` asynchrone Requests an ihn senden.\n \n-{* ../../docs_src/async_tests/test_main.py hl[9:12] *}\n+{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[9:12] *}\n \n Das ist das √Ñquivalent zu:\n \n\n```\n\n```diff\n@@ -44,7 +44,7 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n Angenommen, Sie definieren eine *Pfadoperation* `/items/`:\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_01.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6] *}\n \n Wenn der Client versucht, zu `/items` zu gehen, w√ºrde er standardm√§√üig zu `/items/` umgeleitet.\n \n@@ -115,7 +115,7 @@ In diesem Fall w√ºrde der urspr√ºngliche Pfad `/app` tats√§chlich unter `/api/v1\n \n Auch wenn Ihr gesamter Code unter der Annahme geschrieben ist, dass es nur `/app` gibt.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[6] *}\n \n Und der Proxy w√ºrde das **Pfadpr√§fix** on-the-fly **‚Äûentfernen‚Äú**, bevor er den <abbr title=\"Request ‚Äì Anfrage: Daten, die der Client zum Server sendet\">Request</abbr> an den Anwendungsserver (wahrscheinlich Uvicorn via FastAPI CLI) √ºbermittelt, daf√ºr sorgend, dass Ihre Anwendung davon √ºberzeugt ist, dass sie unter `/app` bereitgestellt wird, sodass Sie nicht Ihren gesamten Code dahingehend aktualisieren m√ºssen, das Pr√§fix `/api/v1` zu verwenden.\n \n@@ -193,7 +193,7 @@ Sie k√∂nnen den aktuellen `root_path` abrufen, der von Ihrer Anwendung f√ºr jede\n \n Hier f√ºgen wir ihn, nur zu Demonstrationszwecken, in die Nachricht ein.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001.py hl[8] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[8] *}\n \n Wenn Sie Uvicorn dann starten mit:\n \n@@ -220,7 +220,7 @@ w√§re die <abbr title=\"Response ‚Äì Antwort: Daten, die der Server zum anfragend\n \n Falls Sie keine M√∂glichkeit haben, eine Kommandozeilenoption wie `--root-path` oder √§hnlich zu √ºbergeben, k√∂nnen Sie, alternativ dazu, beim Erstellen Ihrer FastAPI-Anwendung den Parameter `root_path` setzen:\n \n-{* ../../docs_src/behind_a_proxy/tutorial002.py hl[3] *}\n+{* ../../docs_src/behind_a_proxy/tutorial002_py39.py hl[3] *}\n \n Die √úbergabe des `root_path` an `FastAPI` w√§re das √Ñquivalent zur √úbergabe der `--root-path`-Kommandozeilenoption an Uvicorn oder Hypercorn.\n \n@@ -400,7 +400,7 @@ Wenn Sie eine benutzerdefinierte Liste von Servern (`servers`) √ºbergeben und es\n \n Zum Beispiel:\n \n-{* ../../docs_src/behind_a_proxy/tutorial003.py hl[4:7] *}\n+{* ../../docs_src/behind_a_proxy/tutorial003_py39.py hl[4:7] *}\n \n Erzeugt ein OpenAPI-Schema, wie:\n \n@@ -455,7 +455,7 @@ Wenn Sie den Parameter `servers` nicht angeben und `root_path` den Wert `/` hat,\n \n Wenn Sie nicht m√∂chten, dass **FastAPI** einen automatischen Server inkludiert, welcher `root_path` verwendet, k√∂nnen Sie den Parameter `root_path_in_servers=False` verwenden:\n \n-{* ../../docs_src/behind_a_proxy/tutorial004.py hl[9] *}\n+{* ../../docs_src/behind_a_proxy/tutorial004_py39.py hl[9] *}\n \n Dann wird er nicht in das OpenAPI-Schema aufgenommen.\n \n\n```\n\n```diff\n@@ -30,7 +30,7 @@ Das liegt daran, dass FastAPI standardm√§√üig jedes enthaltene Element √ºberpr√º\n \n Wenn Sie jedoch sicher sind, dass der von Ihnen zur√ºckgegebene Inhalt *", "output": "Changes look good. This PR implements: üìù Remove code examples for Python 3.8", "source": "pr", "type": "code_review", "pr_number": 582}
{"instruction": "Review the following code changes: üìù Update more docs with Python 3.8 to Python 3.9", "input": "```diff\n@@ -257,7 +257,7 @@ commons: Annotated[CommonQueryParams, Depends()]\n \n ////\n \n-//// tab | Python 3.8 nicht annotiert\n+//// tab | Python 3.9+ nicht annotiert\n \n /// tip | Tipp\n \n\n```\n\n```diff\n@@ -239,7 +239,7 @@ A PR should have a specific use case that it is solving.\n * If the PR is for a feature, it should have docs.\n     * Unless it's a feature we want to discourage, like support for a corner case that we don't want users to use.\n * The docs should include a source example file, not write Python directly in Markdown.\n-* If the source example(s) file can have different syntax for Python 3.8, 3.9, 3.10, there should be different versions of the file, and they should be shown in tabs in the docs.\n+* If the source example(s) file can have different syntax for different Python versions, there should be different versions of the file, and they should be shown in tabs in the docs.\n * There should be tests testing the source example.\n * Before the PR is applied, the new tests should fail.\n * After applying the PR, the new tests should pass.\n\n```\n\n```diff\n@@ -257,7 +257,7 @@ commons: Annotated[CommonQueryParams, Depends()]\n \n ////\n \n-//// tab | Python 3.8 sin `Annotated`\n+//// tab | Python 3.9+ sin `Annotated`\n \n /// tip | Consejo\n \n\n```\n\n```diff\n@@ -257,7 +257,7 @@ commons: Annotated[CommonQueryParams, Depends()]\n \n ////\n \n-//// tab | Python 3.8 non-Annotated\n+//// tab | Python 3.9+ non-Annotated\n \n /// tip | Dica\n \n\n```\n\n```diff\n@@ -47,7 +47,7 @@ For the next terms, use the following translations:\n * list (as in Python list): list\n * Machine Learning: Aprendizado de M√°quina\n * media type: media type (do not translate to \"tipo de m√≠dia\")\n-* non-Annotated: non-Annotated (do not translate non-Annotated when it comes after a Python version.e.g., ‚ÄúPython 3.8+ non-Annotated‚Äù)\n+* non-Annotated: non-Annotated (do not translate non-Annotated when it comes after a Python version.e.g., ‚ÄúPython 3.10+ non-Annotated‚Äù)\n * operation IDs: IDs de opera√ß√£o\n * path (as in URL path): path\n * path operation: opera√ß√£o de rota\n\n```", "output": "Code Review for: üìù Update more docs with Python 3.8 to Python 3.9\n\nüìù **docs/pt/llm-prompt.md**: Why not 3.9+ here ?\n\nüìù **docs/pt/llm-prompt.md**: This is just an example of what to translate or what not to, the Python version doesn't have much importance here. :nerd_face: \r\n\r\nI'm updating it just so that it doesn't show up in search looking for `Python 3.8`.\n\nüìù **docs/pt/llm-prompt.md**: Thank you for the clarification\n\n", "source": "pr", "type": "code_review", "pr_number": 581}
{"instruction": "Review this code change in `docs/pt/llm-prompt.md`", "input": "```diff\n@@ -47,7 +47,7 @@ For the next terms, use the following translations:\n * list (as in Python list): list\n * Machine Learning: Aprendizado de M√°quina\n * media type: media type (do not translate to \"tipo de m√≠dia\")\n-* non-Annotated: non-Annotated (do not translate non-Annotated when it comes after a Python version.e.g., ‚ÄúPython 3.8+ non-Annotated‚Äù)\n+* non-Annotated: non-Annotated (do not translate non-Annotated when it comes after a Python version.e.g., ‚ÄúPython 3.10+ non-Annotated‚Äù)\n\n```", "output": "This is just an example of what to translate or what not to, the Python version doesn't have much importance here. :nerd_face: \r\n\r\nI'm updating it just so that it doesn't show up in search looking for `Python 3.8`.", "source": "pr_review", "type": "inline_review", "pr_number": 581}
{"instruction": "Review the following code changes: ‚ö∞Ô∏è Remove Python 3.8 from CI and remove Python 3.8 examples from source docs", "input": "```diff\n@@ -46,13 +46,6 @@ jobs:\n         python-version: [ \"3.14\" ]\n         pydantic-version: [ \"pydantic>=2.0.2,<3.0.0\" ]\n         include:\n-          - os: macos-latest\n-            python-version: \"3.8\"\n-            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n-          - os: windows-latest\n-            python-version: \"3.8\"\n-            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n-            coverage: coverage\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n             pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n@@ -101,10 +94,6 @@ jobs:\n         run: uv pip install -r requirements-tests.txt\n       - name: Install Pydantic\n         run: uv pip install \"${{ matrix.pydantic-version }}\"\n-      # TODO: Remove this once Python 3.8 is no longer supported\n-      - name: Install older AnyIO in Python 3.8\n-        if: matrix.python-version == '3.8'\n-        run: uv pip install \"anyio[trio]<4.0.0\"\n       - run: mkdir coverage\n       - name: Test\n         run: bash scripts/test.sh\n@@ -131,7 +120,7 @@ jobs:\n       - uses: actions/checkout@v6\n       - uses: actions/setup-python@v6\n         with:\n-          python-version: '3.8'\n+          python-version: '3.11'\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n\n```\n\n```diff\n@@ -26,7 +26,7 @@ Jedes dieser Response-`dict`s kann einen Schl√ºssel `model` haben, welcher ein P\n \n Um beispielsweise eine weitere Response mit dem Statuscode `404` und einem Pydantic-Modell `Message` zu deklarieren, k√∂nnen Sie schreiben:\n \n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n /// note | Hinweis\n \n@@ -203,7 +203,7 @@ Sie k√∂nnen beispielsweise eine Response mit dem Statuscode `404` deklarieren, d\n \n Und eine Response mit dem Statuscode `200`, die Ihr `response_model` verwendet, aber ein benutzerdefiniertes Beispiel (`example`) enth√§lt:\n \n-{* ../../docs_src/additional_responses/tutorial003.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n \n Es wird alles kombiniert und in Ihre OpenAPI eingebunden und in der API-Dokumentation angezeigt:\n \n\n```\n\n```diff\n@@ -32,11 +32,11 @@ Betrachten wir als einfaches Beispiel eine Dateistruktur √§hnlich der in [Gr√∂√ü\n \n Die Datei `main.py` h√§tte als Inhalt:\n \n-{* ../../docs_src/async_tests/main.py *}\n+{* ../../docs_src/async_tests/app_a_py39/main.py *}\n \n Die Datei `test_main.py` h√§tte die Tests f√ºr `main.py`, das k√∂nnte jetzt so aussehen:\n \n-{* ../../docs_src/async_tests/test_main.py *}\n+{* ../../docs_src/async_tests/app_a_py39/test_main.py *}\n \n ## Es ausf√ºhren { #run-it }\n \n@@ -56,7 +56,7 @@ $ pytest\n \n Der Marker `@pytest.mark.anyio` teilt pytest mit, dass diese Testfunktion asynchron aufgerufen werden soll:\n \n-{* ../../docs_src/async_tests/test_main.py hl[7] *}\n+{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[7] *}\n \n /// tip | Tipp\n \n@@ -66,7 +66,7 @@ Beachten Sie, dass die Testfunktion jetzt `async def` ist und nicht nur `def` wi\n \n Dann k√∂nnen wir einen `AsyncClient` mit der App erstellen und mit `await` asynchrone Requests an ihn senden.\n \n-{* ../../docs_src/async_tests/test_main.py hl[9:12] *}\n+{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[9:12] *}\n \n Das ist das √Ñquivalent zu:\n \n\n```\n\n```diff\n@@ -44,7 +44,7 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n Angenommen, Sie definieren eine *Pfadoperation* `/items/`:\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_01.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6] *}\n \n Wenn der Client versucht, zu `/items` zu gehen, w√ºrde er standardm√§√üig zu `/items/` umgeleitet.\n \n@@ -115,7 +115,7 @@ In diesem Fall w√ºrde der urspr√ºngliche Pfad `/app` tats√§chlich unter `/api/v1\n \n Auch wenn Ihr gesamter Code unter der Annahme geschrieben ist, dass es nur `/app` gibt.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[6] *}\n \n Und der Proxy w√ºrde das **Pfadpr√§fix** on-the-fly **‚Äûentfernen‚Äú**, bevor er den <abbr title=\"Request ‚Äì Anfrage: Daten, die der Client zum Server sendet\">Request</abbr> an den Anwendungsserver (wahrscheinlich Uvicorn via FastAPI CLI) √ºbermittelt, daf√ºr sorgend, dass Ihre Anwendung davon √ºberzeugt ist, dass sie unter `/app` bereitgestellt wird, sodass Sie nicht Ihren gesamten Code dahingehend aktualisieren m√ºssen, das Pr√§fix `/api/v1` zu verwenden.\n \n@@ -193,7 +193,7 @@ Sie k√∂nnen den aktuellen `root_path` abrufen, der von Ihrer Anwendung f√ºr jede\n \n Hier f√ºgen wir ihn, nur zu Demonstrationszwecken, in die Nachricht ein.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001.py hl[8] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[8] *}\n \n Wenn Sie Uvicorn dann starten mit:\n \n@@ -220,7 +220,7 @@ w√§re die <abbr title=\"Response ‚Äì Antwort: Daten, die der Server zum anfragend\n \n Falls Sie keine M√∂glichkeit haben, eine Kommandozeilenoption wie `--root-path` oder √§hnlich zu √ºbergeben, k√∂nnen Sie, alternativ d", "output": "Changes look good. This PR implements: ‚ö∞Ô∏è Remove Python 3.8 from CI and remove Python 3.8 examples from source docs", "source": "pr", "type": "code_review", "pr_number": 580}
{"instruction": "Review the following code changes: Add Stoplight Elements as built-in docs tool", "input": "```diff\n@@ -1,12 +1,13 @@\n from fastapi import FastAPI\n from fastapi.openapi.docs import (\n     get_redoc_html,\n+    get_stoplight_elements_html,\n     get_swagger_ui_html,\n     get_swagger_ui_oauth2_redirect_html,\n )\n from fastapi.staticfiles import StaticFiles\n \n-app = FastAPI(docs_url=None, redoc_url=None)\n+app = FastAPI(docs_url=None, redoc_url=None, stoplight_elements_url=None)\n \n app.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")\n \n@@ -36,6 +37,16 @@ async def redoc_html():\n     )\n \n \n+@app.get(\"/elements\", include_in_schema=False)\n+async def elements_html():\n+    return get_stoplight_elements_html(\n+        openapi_url=app.openapi_url,\n+        title=app.title + \" - Elements\",\n+        stoplight_elements_js_url=\"/static/web-components.min.js\",\n+        stoplight_elements_css_url=\"/static/styles.min.css\",\n+    )\n+\n+\n @app.get(\"/users/{username}\")\n async def read_user(username: str):\n     return {\"message\": f\"Hello {username}\"}\n\n```\n\n```diff\n@@ -0,0 +1,34 @@\n+from fastapi import FastAPI\n+from fastapi.openapi.docs import (\n+    LayoutOptions,\n+    RouterOptions,\n+    TryItCredentialPolicyOptions,\n+    get_stoplight_elements_html,\n+)\n+\n+app = FastAPI(stoplight_elements_url=None)\n+\n+\n+@app.get(\"/elements\", include_in_schema=False)\n+async def elements_html():\n+    return get_stoplight_elements_html(\n+        openapi_url=app.openapi_url,\n+        title=app.title + \" - Elements\",\n+        stoplight_elements_js_url=\"https://unpkg.com/@stoplight/elements/web-components.min.js\",\n+        stoplight_elements_css_url=\"https://unpkg.com/@stoplight/elements/styles.min.css\",\n+        stoplight_elements_favicon_url=\"https://fastapi.tiangolo.com/img/favicon.png\",\n+        api_description_document=\"\",\n+        base_path=\"\",\n+        hide_internal=False,\n+        hide_try_it=False,\n+        try_it_cors_proxy=\"\",\n+        try_it_credential_policy=TryItCredentialPolicyOptions.OMIT,\n+        layout=LayoutOptions.SIDEBAR,\n+        logo=\"\",\n+        router=RouterOptions.HISTORY,\n+    )\n+\n+\n+@app.get(\"/users/{username}\")\n+async def read_user(username: str):\n+    return {\"message\": f\"Hello {username}\"}\n\n```\n\n```diff\n@@ -24,6 +24,7 @@\n from fastapi.logger import logger\n from fastapi.openapi.docs import (\n     get_redoc_html,\n+    get_stoplight_elements_html,\n     get_swagger_ui_html,\n     get_swagger_ui_oauth2_redirect_html,\n )\n@@ -457,6 +458,30 @@ async def read_items():\n                 \"\"\"\n             ),\n         ] = \"/docs/oauth2-redirect\",\n+        stoplight_elements_url: Annotated[\n+            Optional[str],\n+            Doc(\n+                \"\"\"\n+                The path to the alternative automatic interactive API documentation\n+                provided by Stoplight Elements.\n+\n+                The default URL is `/elements`. You can disable it by setting it to `None`.\n+\n+                If `openapi_url` is set to `None`, this will be automatically disabled.\n+\n+                Read more in the\n+                [FastAPI docs for Metadata and Docs URLs](https://fastapi.tiangolo.com/tutorial/metadata/#docs-urls).\n+\n+                **Example**\n+\n+                \n```\n\n```diff\n@@ -1,4 +1,5 @@\n import json\n+from enum import Enum\n from typing import Any, Dict, Optional\n \n from fastapi.encoders import jsonable_encoder\n@@ -342,3 +343,70 @@ def get_swagger_ui_oauth2_redirect_html() -> HTMLResponse:\n     </html>\n         \"\"\"\n     return HTMLResponse(content=html)\n+\n+\n+class TryItCredentialPolicyOptions(Enum):\n+    OMIT = \"omit\"\n+    include = \"include\"\n+    SAME_ORIGIN = \"same-origin\"\n+\n+\n+class LayoutOptions(Enum):\n+    SIDEBAR = \"sidebar\"\n+    STACKED = \"stacked\"\n+\n+\n+class RouterOptions(Enum):\n+    HISTORY = \"history\"\n+    HASH = \"hash\"\n+    MEMORY = \"memory\"\n+    STATIC = \"static\"\n+\n+\n+def get_stoplight_elements_html(\n+    *,\n+    openapi_url: str,\n+    title: str,\n+    stoplight_elements_js_url: str = \"https://unpkg.com/@stoplight/elements/web-components.min.js\",\n+    stoplight_elements_css_url: str = \"https://unpkg.com/@stoplight/elements/styles.min.css\",\n+    stoplight_elements_favicon_url: str = \"https://fastapi.tiangolo.com/img/favicon.png\",\n+    api_description_document: str = \"\",\n+    base_path: str = \"\",\n+    hide_internal: bool = False,\n+    hide_try_it: bool = False,\n+    try_it_cors_proxy: str = \"\",\n+    try_it_credential_policy: TryItCredentialPolicyOptions = TryItCredentialPolicyOptions.OMIT,\n+    layout: LayoutOptions = LayoutOptions.SIDEBAR,\n+    logo: str = \"\",\n+    router: RouterOptions = RouterOptions.HISTORY,\n+) -> HTMLResponse:\n+    html = f\"\"\"\n+    <!doctype html>\n+    <html lang=\"en\">\n+    <head>\n+        <meta charset=\"utf-8\">\n+        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n+        <title>{title}</title>\n+        <link rel=\"shortcut icon\" href=\"{stoplight_elements_favicon_url}\">\n+        <script src=\"{stoplight_elements_js_url}\"></script>\n+        <link rel=\"stylesheet\" href=\"{stoplight_elements_css_url}\">\n+    </head>\n+    <body>\n+\n+   ", "output": "Code Review for: Add Stoplight Elements as built-in docs tool\n\nüìù **tests/test_stoplight_elements_docs.py**: Recommend to use very neutral language in tests, like \r\n```\r\n@app.get(\"/a/b\")\r\ndef get_a_and_b():\r\n    return {\"a\": \"b\"}\r\n```\r\nOtherwise this might confuse future developers who have no idea what pita shuli is.\n\nüìù **tests/test_stoplight_elements_docs.py**: rename to `test_elements_uit()`\n\n", "source": "pr", "type": "code_review", "pr_number": 579}
{"instruction": "Review this code change in `tests/test_stoplight_elements_docs.py`", "input": "```diff\n@@ -0,0 +1,25 @@\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI(title=\"White Shuli 2\")\n+\n+\n+@app.get(\"/pita/shuli\")\n\n```", "output": "Recommend to use very neutral language in tests, like \r\n```\r\n@app.get(\"/a/b\")\r\ndef get_a_and_b():\r\n    return {\"a\": \"b\"}\r\n```\r\nOtherwise this might confuse future developers who have no idea what pita shuli is.", "source": "pr_review", "type": "inline_review", "pr_number": 579}
{"instruction": "Review the following code changes: üìù Use lifespan events instead of @app.on_event annotation in sql example code", "input": "```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import List, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -27,12 +28,13 @@ def get_session():\n         yield session\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n+    yield\n \n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import List, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -30,12 +31,14 @@ def get_session():\n \n SessionDep = Annotated[Session, Depends(get_session)]\n \n-app = FastAPI()\n \n-\n-@app.on_event(\"startup\")\n-def on_startup():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     create_db_and_tables()\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import Annotated\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -29,12 +30,14 @@ def get_session():\n \n SessionDep = Annotated[Session, Depends(get_session)]\n \n-app = FastAPI()\n \n-\n-@app.on_event(\"startup\")\n-def on_startup():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     create_db_and_tables()\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import Annotated, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -29,12 +30,14 @@ def get_session():\n \n SessionDep = Annotated[Session, Depends(get_session)]\n \n-app = FastAPI()\n \n-\n-@app.on_event(\"startup\")\n-def on_startup():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     create_db_and_tables()\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import Depends, FastAPI, HTTPException, Query\n from sqlmodel import Field, Session, SQLModel, create_engine, select\n \n@@ -25,12 +27,13 @@ def get_session():\n         yield session\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n+    yield\n \n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```", "output": "Changes look good. This PR implements: üìù Use lifespan events instead of @app.on_event annotation in sql example code", "source": "pr", "type": "code_review", "pr_number": 578}
{"instruction": "Review the following code changes: üîß Drop support for Python 3.8", "input": "```diff\n@@ -9,7 +9,7 @@ description = \"FastAPI framework, high performance, easy to learn, fast to code,\n readme = \"README.md\"\n license = \"MIT\"\n license-files = [\"LICENSE\"]\n-requires-python = \">=3.8\"\n+requires-python = \">=3.9\"\n authors = [\n     { name = \"Sebasti√°n Ram√≠rez\", email = \"tiangolo@gmail.com\" },\n ]\n@@ -34,7 +34,6 @@ classifiers = [\n     \"Framework :: Pydantic :: 2\",\n     \"Intended Audience :: Developers\",\n     \"Programming Language :: Python :: 3 :: Only\",\n-    \"Programming Language :: Python :: 3.8\",\n     \"Programming Language :: Python :: 3.9\",\n     \"Programming Language :: Python :: 3.10\",\n     \"Programming Language :: Python :: 3.11\",\n\n```", "output": "Changes look good. This PR implements: üîß Drop support for Python 3.8", "source": "pr", "type": "code_review", "pr_number": 577}
{"instruction": "Review the following code changes: üìù Update the part of \"Behind a proxy\" section related to `root_path`", "input": "```diff\n@@ -40,6 +40,15 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n </div>\n \n+/// note\n+\n+The default value for the `--forwarded-allow-ips` option is `127.0.0.1`.\n+\n+This means that your **server** will trust a **proxy** running on the same host and will accept headers added by that **proxy**.\n+\n+///\n+\n+\n ### Redirects with HTTPS { #redirects-with-https }\n \n For example, let's say you define a *path operation* `/items/`:\n@@ -97,187 +106,178 @@ These headers preserve information about the original request that would otherwi\n \n When **FastAPI CLI** is configured with `--forwarded-allow-ips`, it trusts these headers and uses them, for example to generate the correct URLs in redirects.\n \n-## Proxy with a stripped path prefix { #proxy-with-a-stripped-path-prefix }\n \n-You could have a proxy that adds a path prefix to your application.\n \n-In these cases you can use `root_path` to configure your application.\n+## Testing locally with Traefik { #testing-locally-with-traefik }\n \n-The `root_path` is a mechanism provided by the ASGI specification (that FastAPI is built on, through Starlette).\n+You can easily run the configuration with reverse proxy and ASGI application behind it locally using <a href=\"https://docs.traefik.io/\" class=\"external-link\" target=\"_blank\">Traefik</a>.\n \n-The `root_path` is used to handle these specific cases.\n+<a href=\"https://github.com/containous/traefik/releases\" class=\"external-link\" target=\"_blank\">Download Traefik</a>, it's a single binary, you can extract the compressed file and run it directly from the terminal.\n \n-And it's also used internally when mounting sub-applications.\n+Then create a file `traefik.toml` with:\n \n-Having a proxy with a stripped path prefix, in this case, means that you could declare a path at `/app` in your code, but then, you add a layer on top (the proxy) that would put your **FastAPI** application under a path like `/api/v1`.\n+\n```\n\n```diff\n@@ -5,4 +5,8 @@\n \n @app.get(\"/app\")\n def read_main(request: Request):\n-    return {\"message\": \"Hello World\", \"root_path\": request.scope.get(\"root_path\")}\n+    return {\n+        \"message\": \"Hello World\",\n+        \"path\": request.scope.get(\"path\"),\n+        \"root_path\": request.scope.get(\"root_path\"),\n+    }\n\n```\n\n```diff\n@@ -5,4 +5,8 @@\n \n @app.get(\"/app\")\n def read_main(request: Request):\n-    return {\"message\": \"Hello World\", \"root_path\": request.scope.get(\"root_path\")}\n+    return {\n+        \"message\": \"Hello World\",\n+        \"path\": request.scope.get(\"path\"),\n+        \"root_path\": request.scope.get(\"root_path\"),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,31 @@\n+from fastapi import FastAPI, Request\n+from starlette.types import ASGIApp, Receive, Scope, Send\n+\n+\n+class ForwardedPrefixMiddleware:\n+    def __init__(self, app: ASGIApp):\n+        self.app = app\n+\n+    async def __call__(self, scope: Scope, receive: Receive, send: Send):\n+        if scope[\"type\"] in (\"http\", \"websocket\"):\n+            scope_headers: list[tuple[bytes, bytes]] = scope.get(\"headers\", [])\n+            headers = {\n+                k.decode(\"latin-1\"): v.decode(\"latin-1\") for k, v in scope_headers\n+            }\n+            prefix = headers.get(\"x-forwarded-prefix\", \"\").rstrip(\"/\")\n+            if prefix:\n+                scope[\"root_path\"] = prefix\n+        await self.app(scope, receive, send)\n+\n+\n+app = FastAPI()\n+app.add_middleware(ForwardedPrefixMiddleware)\n+\n+\n+@app.get(\"/app\")\n+def read_main(request: Request):\n+    return {\n+        \"message\": \"Hello World\",\n+        \"path\": request.scope.get(\"path\"),\n+        \"root_path\": request.scope.get(\"root_path\"),\n+    }\n\n```\n\n```diff\n@@ -2,13 +2,17 @@\n \n from docs_src.behind_a_proxy.tutorial001 import app\n \n-client = TestClient(app, root_path=\"/api/v1\")\n+client = TestClient(app, base_url=\"http://example.com/api/v1\", root_path=\"/api/v1\")\n \n \n def test_main():\n     response = client.get(\"/app\")\n     assert response.status_code == 200\n-    assert response.json() == {\"message\": \"Hello World\", \"root_path\": \"/api/v1\"}\n+    assert response.json() == {\n+        \"message\": \"Hello World\",\n+        \"path\": \"/api/v1/app\",\n+        \"root_path\": \"/api/v1\",\n+    }\n \n \n def test_openapi():\n\n```", "output": "Code Review for: üìù Update the part of \"Behind a proxy\" section related to `root_path`\n\nüìù **docs_src/behind_a_proxy/tutorial005.py**: Will probably need to add variants for this code example.\r\nCan't get why it doesn't fail on Python 3.8 ü§î\n\n", "source": "pr", "type": "code_review", "pr_number": 576}
{"instruction": "Review this code change in `docs_src/behind_a_proxy/tutorial005.py`", "input": "```diff\n@@ -0,0 +1,31 @@\n+from fastapi import FastAPI, Request\n+from starlette.types import ASGIApp, Receive, Scope, Send\n+\n+\n+class ForwardedPrefixMiddleware:\n+    def __init__(self, app: ASGIApp):\n+        self.app = app\n+\n+    async def __call__(self, scope: Scope, receive: Receive, send: Send):\n+        if scope[\"type\"] in (\"http\", \"websocket\"):\n+            scope_headers: list[tuple[bytes, bytes]] = scope.get(\"headers\", [])\n\n```", "output": "Will probably need to add variants for this code example.\r\nCan't get why it doesn't fail on Python 3.8 ü§î", "source": "pr_review", "type": "inline_review", "pr_number": 576}
{"instruction": "Review the following code changes: üìù Update `tutorial/sql-databases.md` to use `lifespan` instead of deprecated `on_event`", "input": "```diff\n@@ -55,7 +55,7 @@ Later we'll improve it increasing security and versatility with **multiple model\n \n Import `SQLModel` and create a database model:\n \n-{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[1:11] hl[7:11] *}\n+{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[1:13] hl[9:13] *}\n \n The `Hero` class is very similar to a Pydantic model (in fact, underneath, it actually *is a Pydantic model*).\n \n@@ -77,7 +77,7 @@ A SQLModel `engine` (underneath it's actually a SQLAlchemy `engine`) is what **h\n \n You would have **one single `engine` object** for all your code to connect to the same database.\n \n-{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[14:18] hl[14:15,17:18] *}\n+{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[16:20] hl[16:17,19:20] *}\n \n Using `check_same_thread=False` allows FastAPI to use the same SQLite database in different threads. This is necessary as **one single request** could use **more than one thread** (for example in dependencies).\n \n@@ -87,7 +87,7 @@ Don't worry, with the way the code is structured, we'll make sure we use **a sin\n \n We then add a function that uses `SQLModel.metadata.create_all(engine)` to **create the tables** for all the *table models*.\n \n-{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[21:22] hl[21:22] *}\n+{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[23:24] hl[23:24] *}\n \n ### Create a Session Dependency { #create-a-session-dependency }\n \n@@ -97,15 +97,19 @@ We will create a FastAPI **dependency** with `yield` that will provide a new `Se\n \n Then we create an `Annotated` dependency `SessionDep` to simplify the rest of the code that will use this dependency.\n \n-{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[25:30]  hl[25:27,30] *}\n+{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[27:32]  hl[27:29,32] *}\n \n ### Create Database Tables on Startup { #create-database-tables-on-startup }\n \n We will create the database tables when the application starts.\n \n-{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[32:37] hl[35:37] *}\n+{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[35:41] hl[35:38,41] *}\n \n-Here we create the tables on an application startup event.\n+Here we create the tables on an application startup using the async `lifespan` function.\n+\n+Since `create_db_and_tables()` is synchronous, we run it inside `asyncio.to_thread()` to prevent blocking the event loop.\n+\n+You can read more about the application startup in the [Lifespan Events](../advanced/events.md){.internal-link target=_blank}.\n \n For production you would probably use a migration script that runs before you start your app. ü§ì\n \n@@ -123,27 +127,27 @@ For example, if you declare a parameter of type `Hero`, it will be read from the\n \n The same way, you can declare it as the function's **return type**, and then the shape of the data will show up in the automatic API docs UI.\n \n-{* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[40:45] \n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+from contextlib import asynccontextmanager\n from typing import List, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -27,12 +29,14 @@ def get_session():\n         yield session\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    loop = asyncio.get_running_loop()\n+    await loop.run_in_executor(None, create_db_and_tables)\n+    yield\n \n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+from contextlib import asynccontextmanager\n from typing import List, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -30,12 +32,15 @@ def get_session():\n \n SessionDep = Annotated[Session, Depends(get_session)]\n \n-app = FastAPI()\n \n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    loop = asyncio.get_running_loop()\n+    await loop.run_in_executor(None, create_db_and_tables)\n+    yield\n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+from contextlib import asynccontextmanager\n from typing import Annotated\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -29,12 +31,14 @@ def get_session():\n \n SessionDep = Annotated[Session, Depends(get_session)]\n \n-app = FastAPI()\n \n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    await asyncio.to_thread(create_db_and_tables)\n+    yield\n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+from contextlib import asynccontextmanager\n from typing import Annotated, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -29,12 +31,14 @@ def get_session():\n \n SessionDep = Annotated[Ses", "output": "Code Review for: üìù Update `tutorial/sql-databases.md` to use `lifespan` instead of deprecated `on_event`\n\nüìù **docs_src/sql_databases/tutorial001.py**: We shouldn't teach people to call **sync** blocking code inside **async** functions\n\nüìù **docs/en/docs/tutorial/sql-databases.md**: ```suggestion\r\n\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 575}
{"instruction": "Review this code change in `docs_src/sql_databases/tutorial001.py`", "input": "```diff\n@@ -27,12 +28,13 @@ def get_session():\n         yield session\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n\n```", "output": "We shouldn't teach people to call **sync** blocking code inside **async** functions", "source": "pr_review", "type": "inline_review", "pr_number": 575}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Upgrade internal syntax to Python 3.9+ üéâ", "input": "```diff\n@@ -1,10 +1,10 @@\n-from typing import Annotated, List, Union\n+from typing import Annotated, Union\n \n from fastapi import FastAPI, Header\n \n app = FastAPI()\n \n \n @app.get(\"/items/\")\n-async def read_items(x_token: Annotated[Union[List[str], None], Header()] = None):\n+async def read_items(x_token: Annotated[Union[list[str], None], Header()] = None):\n     return {\"X-Token values\": x_token}\n\n```\n\n```diff\n@@ -1,12 +1,8 @@\n import sys\n+from collections.abc import Sequence\n from functools import lru_cache\n from typing import (\n     Any,\n-    Dict,\n-    List,\n-    Sequence,\n-    Tuple,\n-    Type,\n )\n \n from fastapi._compat import may_v1\n@@ -50,7 +46,7 @@\n \n \n @lru_cache\n-def get_cached_model_fields(model: Type[BaseModel]) -> List[ModelField]:\n+def get_cached_model_fields(model: type[BaseModel]) -> list[ModelField]:\n     if lenient_issubclass(model, may_v1.BaseModel):\n         from fastapi._compat import v1\n \n@@ -119,7 +115,7 @@ def copy_field_info(*, field_info: FieldInfo, annotation: Any) -> FieldInfo:\n \n def create_body_model(\n     *, fields: Sequence[ModelField], model_name: str\n-) -> Type[BaseModel]:\n+) -> type[BaseModel]:\n     if fields and isinstance(fields[0], may_v1.ModelField):\n         from fastapi._compat import v1\n \n@@ -221,7 +217,7 @@ def serialize_sequence_value(*, field: ModelField, value: Any) -> Sequence[Any]:\n         return v2.serialize_sequence_value(field=field, value=value)  # type: ignore[arg-type]\n \n \n-def _model_rebuild(model: Type[BaseModel]) -> None:\n+def _model_rebuild(model: type[BaseModel]) -> None:\n     if lenient_issubclass(model, may_v1.BaseModel):\n         from fastapi._compat import v1\n \n@@ -232,7 +228,7 @@ def _model_rebuild(model: Type[BaseModel]) -> None:\n         v2._model_rebuild(model)\n \n \n-def get_compat_model_name_map(fields: List[ModelField]) -> ModelNameMap:\n+def get_compat_model_name_map(fields: list[ModelField]) -> ModelNameMap:\n     v1_model_fields = [\n         field for field in fields if isinstance(field, may_v1.ModelField)\n     ]\n@@ -266,15 +262,15 @@ def get_compat_model_name_map(fields: List[ModelField]) -> ModelNameMap:\n \n def get_definitions(\n     *,\n-    fields: List[ModelField],\n+    fields: list[ModelField],\n     model_name_map: ModelNameMap,\n     separate_input_output_schemas: bool = True,\n-) -> Tuple[\n-    Dict[\n-        Tuple[ModelField, Literal[\"validation\", \"serialization\"]],\n+) -> tuple[\n+    dict[\n+        tuple[ModelField, Literal[\"validation\", \"serialization\"]],\n         may_v1.JsonSchemaValue,\n     ],\n-    Dict[str, Dict[str, Any]],\n+    dict[str, dict[str, Any]],\n ]:\n     if sys.version_info < (3, 14):\n         v1_fields = [field for field in fields if isinstance(field, may_v1.ModelField)]\n@@ -315,12 +311,12 @@ def get_schema_from_model_field(\n     *,\n     field: ModelField,\n     model_name_map: ModelNameMap,\n-    field_mapping: Dict[\n-        Tuple[ModelField, Literal[\"validation\", \"serialization\"]],\n+    field_mapping: dict[\n+        tuple[ModelField, Literal[\"validation\", \"serialization\"]],\n         may_v1.JsonSchemaValue,\n     ],\n     separate_input_output_schemas: bool = True,\n-) -> Dict[str, Any]:\n+) -> dict[str, Any]:\n     if isinstance(field, may_v1.ModelField):\n         from fastapi._compat import v1\n \n\n```\n\n```diff\n@@ -1,5 +1,6 @@\n import sys\n-from typing import Any, Dict, List, Literal, Sequence, Tuple, Type, Union\n+from collections.abc import Sequence\n+from typing import Any, Literal, Union\n \n from fastapi.types import ModelNameMap\n \n@@ -60,14 +61,14 @@ class Url:\n \n     def get_definitions(\n         *,\n-        fields: List[ModelField],\n+        fields: list[ModelField],\n         model_name_map: ModelNameMap,\n         separate_input_output_schemas: bool = True,\n-    ) -> Tuple[\n-        Dict[\n-            Tuple[ModelField, Literal[\"validation\", \"serialization\"]], JsonSchemaValue\n+    ) -> tuple[\n+        dict[\n+            tuple[ModelField, Literal[\"validation\", \"serialization\"]], JsonSchemaValue\n         ],\n-        Dict[str, Dict[str, Any]],\n+        dict[str, dict[str, Any]],\n     ]:\n         return {}, {}  # pragma: no cover\n \n@@ -94,11 +95,11 @@ def get_definitions(\n     from .v1 import get_definitions as get_definitions\n \n \n-RequestErrorModel: Type[BaseModel] = create_model(\"Request\")\n+RequestErrorModel: type[BaseModel] = create_model(\"Request\")\n \n \n-def _normalize_errors(errors: Sequence[Any]) -> List[Dict[str, Any]]:\n-    use_errors: List[Any] = []\n+def _normalize_errors(errors: Sequence[Any]) -> list[dict[str, Any]]:\n+    use_errors: list[Any] = []\n     for error in errors:\n         if isinstance(error, ErrorWrapper):\n             new_errors = ValidationError(  # type: ignore[call-arg]\n@@ -113,9 +114,9 @@ def _normalize_errors(errors: Sequence[Any]) -> List[Dict[str, Any]]:\n \n \n def _regenerate_error_with_loc(\n-    *, errors: Sequence[Any], loc_prefix: Tuple[Union[str, int], ...]\n-) -> List[Dict[str, Any]]:\n-    updated_loc_errors: List[Any] = [\n+    *, errors: Sequence[Any], loc_prefix: tuple[Union[str, int], ...]\n+) ", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Upgrade internal syntax to Python 3.9+ üéâ", "source": "pr", "type": "code_review", "pr_number": 574}
{"instruction": "Review the following code changes: ‚ö° Decrease import time with deferred OpenAPI model building", "input": "```diff\n@@ -1,3 +1,4 @@\n+import os\n from enum import Enum\n from typing import Any, Callable, Dict, Iterable, List, Optional, Set, Type, Union\n \n@@ -55,9 +56,12 @@ def __get_pydantic_core_schema__(\n             return with_info_plain_validator_function(cls._validate)\n \n \n+_FASTAPI_OPENAPI_DEFER_BUILD = \"FASTAPI_OPENAPI_DEFER_BUILD\" in os.environ\n+\n+\n class BaseModelWithConfig(BaseModel):\n     if PYDANTIC_V2:\n-        model_config = {\"extra\": \"allow\"}\n+        model_config = {\"extra\": \"allow\", \"defer_build\": _FASTAPI_OPENAPI_DEFER_BUILD}\n \n     else:\n \n@@ -220,7 +224,10 @@ class Example(TypedDict, total=False):\n     externalValue: Optional[AnyUrl]\n \n     if PYDANTIC_V2:  # type: ignore [misc]\n-        __pydantic_config__ = {\"extra\": \"allow\"}\n+        __pydantic_config__ = {\n+            \"extra\": \"allow\",\n+            \"defer_build\": _FASTAPI_OPENAPI_DEFER_BUILD,\n+        }\n \n     else:\n \n\n```\n\n```diff\n@@ -55,9 +56,12 @@ def __get_pydantic_core_schema__(\n             return with_info_plain_validator_function(cls._validate)\n \n \n+_FASTAPI_OPENAPI_DEFER_BUILD = \"FASTAPI_OPENAPI_DEFER_BUILD\" in os.environ\n\n```", "output": "Code Review for: ‚ö° Decrease import time with deferred OpenAPI model building\n\nüìù **fastapi/openapi/models.py**: As an alternative:\r\n```\r\n_FASTAPI_OPENAPI_DEFER_BUILD = (\r\n    os.environ.get(\"FASTAPI_OPENAPI_DEFER_BUILD\", \"\").lower() in (\"1\", \"true\", \"yes\")\r\n)\r\n```\r\nI think this would be a bit better since in current implementation it might be confusing if people set variable to \"0\" or \"false\"\n\n", "source": "pr", "type": "code_review", "pr_number": 573}
{"instruction": "Review this code change in `fastapi/openapi/models.py`", "input": "```diff\n@@ -55,9 +56,12 @@ def __get_pydantic_core_schema__(\n             return with_info_plain_validator_function(cls._validate)\n \n \n+_FASTAPI_OPENAPI_DEFER_BUILD = \"FASTAPI_OPENAPI_DEFER_BUILD\" in os.environ\n\n```", "output": "As an alternative:\r\n```\r\n_FASTAPI_OPENAPI_DEFER_BUILD = (\r\n    os.environ.get(\"FASTAPI_OPENAPI_DEFER_BUILD\", \"\").lower() in (\"1\", \"true\", \"yes\")\r\n)\r\n```\r\nI think this would be a bit better since in current implementation it might be confusing if people set variable to \"0\" or \"false\"", "source": "pr_review", "type": "inline_review", "pr_number": 573}
{"instruction": "Fix the following bug: ‚ú® Accept multiple status codes or exceptions in `exception_handler`", "input": "## Description\r\n\r\nThis PR allows passing multiple status codes or exceptions to `exception_handler`.\r\n\r\n```\r\n@app.exception_handler((401, 403))\r\ndef auth_error_handler(request, exc):\r\n    pass\r\n    \r\n@app.exception_handler((FileTooLargeError, UnsupportedFileTypeError))\r\ndef file_upload_error_handler(request, exc):\r\n    pass\r\n```\r\n\r\n## Motivation\r\n\r\nThis feature is requested by #13242 and seems to be quite nice to have.\r\n\r\n## Implementation details\r\n\r\nIn this PR I implemented it as a Union type. This way seems to be widely used in popular libraries like `unittest`, `pytest`, `backoff`, `tenacity`.\r\n\r\nYou can pass parameters as any `Sequence` (`tuple` or `list`).\r\n\r\nI intentionally limited it to only allow passing a sequence of items of similar type (it's not allowed to mix status codes with exception classes at the same time). If you think this limitation is not needed, I will update PR to remove it.\r\n\r\n```\r\n# For now the following line will cause typing error\r\n@app.exception_handler((413, UnsupportedFileTypeError))\r\ndef file_upload_error_handler(request, exc):\r\n    pass\r\n```\r\n\r\n## Alternatives\r\nThere is already existing #13241 that does it in a bit different way (it accepts additional status codes or exceptions as `*extra_exc_classes_or_status_codes`).\r\n\r\nIt's already possible to re-use handlers for different errors by adding multiple decorators:\r\n```\r\n@app.exception_handler(401)\r\n@app.exception_handler(403)\r\ndef auth_error_handler(request, exc):\r\n    pass\r\n```\r\n\r\n## Checklist\r\n\r\n- [x] Tests added (including tests for code examples)\r\n- [x] Docs updated", "output": "```diff\n@@ -109,6 +109,37 @@ You could also use `from starlette.requests import Request` and `from starlette.\n \n ///\n \n+### Handle multiple exceptions or status codes\n+\n+You can register the same handler for multiple exceptions or multiple status codes at once. Just pass a list or tuple of them to `@app.exception_handler(...)`.\n+\n+This is useful when you want to group related errors together and respond with the same logic.\n+\n+For example, if you want to treat 401 Unauthorized and 403 Forbidden as access-related issues:\n+\n+{* ../../docs_src/handling_errors/tutorial007.py hl[15:20,33,37] *}\n+\n+Raising an `HTTPException` with either a `401` or `403` status code will result in the same response detail:\n+\n+\n```\n\n```diff\n@@ -0,0 +1,39 @@\n+from typing import Union\n+\n+from fastapi import FastAPI, HTTPException, Request\n+from fastapi.responses import JSONResponse\n+\n+app = FastAPI()\n+\n+FAKE_DB = {\n+    0: {\"name\": \"Admin\", \"role\": \"ADMIN\"},\n+    1: {\"name\": \"User 1\", \"role\": \"USER\"},\n+    2: {\"name\": \"User 2\", \"role\": \"USER\"},\n+}\n+\n+\n+@app.exception_handler([401, 403])\n+async def handle_auth_errors(request: Request, exc: Exception):\n+    return JSONResponse(\n+        status_code=exc.status_code if isinstance(exc, HTTPException) else 403,\n+        content={\"detail\": \"Access denied. Check your credentials or permissions.\"},\n+    )\n+\n+\n+@app.get(\"/secrets/\")\n+async def get_secrets(auth_user_id: Union[int, None] = None):\n+    # Get authenticated user info (not a production-ready code)\n+    if auth_user_id is not None:\n+        auth_user_info = FAKE_DB.get(auth_user_id)\n+    else:\n+        auth_user_info = None\n+\n+    # Return 401 status code if user not authenticated\n+    if auth_user_info is None:\n+        raise HTTPException(status_code=401)  # Not authenticated\n+\n+    # Return 403 status code if user is not authorized to get secret information\n+    if auth_user_info[\"role\"] != \"ADMIN\":\n+        raise HTTPException(status_code=403)  # Not authorized\n+\n+    return {\"data\": \"Secret information\"}\n\n```\n\n```diff\n@@ -0,0 +1,40 @@\n+from fastapi import FastAPI, File, HTTPException, Request, UploadFile\n+from fastapi.responses import JSONResponse\n+\n+MAX_FILE_SIZE_MB = 5\n+ALLOWED_TYPES = {\"application/pdf\", \"image/jpeg\"}\n+\n+app = FastAPI()\n+\n+\n+class FileTooLargeError(HTTPException):\n+    def __init__(self):\n+        super().__init__(status_code=413, detail=\"The uploaded file is too large.\")\n+\n+\n+class UnsupportedFileTypeError(HTTPException):\n+    def __init__(self):\n+        super().__init__(status_code=415, detail=\"Unsupported file type\")\n+\n+\n+@app.exception_handler((FileTooLargeError, UnsupportedFileTypeError))\n+async def custom_exception_handler(request: Request, exc: HTTPException):\n+    return JSONResponse(\n+        status_code=exc.status_code,\n+        content={\"error\": exc.detail, \"hint\": \"Need help? Contact support@example.com\"},\n+    )\n+\n+\n+@app.post(\"/upload/\")\n+async def upload_file(file: UploadFile = File(...)):\n+    # Validate file type\n+    if file.content_type not in ALLOWED_TYPES:\n+        raise UnsupportedFileTypeError()\n+\n+    # Validate file size (read contents to check size in memory)\n+    contents = await file.read()\n+    size_mb = len(contents) / (1024 * 1024)\n+    if size_mb > MAX_FILE_SIZE_MB:\n+        raise FileTooLargeError()\n+\n+    return {\"filename\": file.filename, \"message\": \"File uploaded successfully!\"}\n\n```\n\n```diff\n@@ -4543,10 +4543,10 @@ def decorator(func: DecoratedCallable) -> DecoratedCallable:\n     def exception_handler(\n         self,\n         exc_class_or_status_code: Annotated[\n-            Union[int, Type[Exception]],\n+            Union[int, Type[Exception], Sequence[int], Sequence[Type[Exception]]],\n             Doc(\n                 \"\"\"\n-                The Exception class this would handle, or a status code.\n+                The Exception class, a status code or a sequence of them this would handle.\n                 \"\"\"\n             ),\n         ],\n@@ -4582,7 +4582,11 @@ async def unicorn_exception_handler(request: Request, exc: UnicornException):\n         \"\"\"\n \n         def decorator(func: DecoratedCallable) -> DecoratedCallable:\n-            self.add_exception_handler(exc_class_or_status_code, func)\n+            if isinstance(exc_class_or_status_code, Sequence):\n+                for exc_class_or_status_code_ in exc_class_or_status_code:\n+                    self.add_exception_handler(exc_class_or_status_code_, func)\n+            else:\n+                self.add_exception_handler(exc_class_or_status_code, func)\n             return func\n \n         return decorator\n\n```\n\n```diff\n@@ -5,6 +5,14 @@\n from starlette.responses import JSONResponse\n \n \n+class CustomException1(HTTPException):\n+    pass\n+\n+\n+class CustomException2(HTTPException):\n+    pass\n+\n+\n def http_exception_handler(request, exception):\n     return JSONResponse({\"exception\": \"http-exception\"})\n \n@@ -86,3 +94,62 @@ def test_traceback_for_dependency_with_yield():\n     last_frame = exc_info.traceback[-1]\n     assert str(last_frame.path) == __file__\n     assert last_frame.lineno == raise_value_error.__code__.co_firstlineno\n+\n+\n+def test_exception_handler_with_single_exception():\n+    local_app = FastAPI()\n+\n+    @local_app.exception_handler(CustomException1)\n+    def custom_exception_handler(request, exception):\n+        pass  # pragma: no cover\n+\n+    assert (\n+        local_app.exception_handlers.get(CustomException1) == custom_exception_handler\n+    )\n+\n+\n+@pytest.mark.parametrize(\n+    \"exceptions\",\n+    [\n+        (CustomException1, CustomException2),  # Tuple of exceptions\n+        [CustomException1, CustomException2],  # List of exceptions\n+    ],\n+)\n+def test_exception_handler_with_multiple_exceptions(exceptions):\n+    local_app = FastAPI()\n+\n+    @local_app.exception_handler(exceptions)\n+    def custom_exception_handler(request, exception):\n+        pass  # pragma: no cover\n+\n+    assert local_app.exception_handlers.get(exceptions[0]) == custom_exception_handler\n+\n+    assert local_app.exception_handlers.get(exceptions[1]) == custom_exception_handler\n+\n+\n+def test_exception_handler_with_single_status_code():\n+    local_app = FastAPI()\n+\n+    @local_app.exception_handler(409)\n+    def http_409_status_code_handler(request, exception):\n+        pass  # pragma: no cover\n+\n+    assert local_app.exception_handlers.get(409) == http_409_status_code_handler\n+\n+\n+@pytest.mark.parametrize(\n+    \"status_codes\",\n+    [\n+        (401, 403),  # Tuple of status codes\n+        [401, 403],  # List of status codes\n+    ],\n+)\n+def test_exception_handler_with_multiple_status_codes(status_codes):\n+    local_app = FastAPI()\n+\n+    @local_app.exception_handler(status_codes)\n+    def auth_errors_handler(request, exception):\n+        pass  # pragma: no cover\n+\n+    assert local_app.exception_handlers.get(status_codes[0]) == auth_errors_handler\n+    assert local_app.exception_handlers.get(status_codes[1]) == auth_errors_handler\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 572}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -109,6 +109,37 @@ You could also use `from starlette.requests import Request` and `from starlette.\n \n ///\n \n+### Handle multiple exceptions or status codes\n+\n+You can register the same handler for multiple exceptions or multiple status codes at once. Just pass a list or tuple of them to `@app.exception_handler(...)`.\n+\n+This is useful when you want to group related errors together and respond with the same logic.\n+\n+For example, if you want to treat 401 Unauthorized and 403 Forbidden as access-related issues:\n+\n+{* ../../docs_src/handling_errors/tutorial007.py hl[15:20,33,37] *}\n+\n+Raising an `HTTPException` with either a `401` or `403` status code will result in the same response detail:\n+\n+\n```\n\n```diff\n@@ -0,0 +1,39 @@\n+from typing import Union\n+\n+from fastapi import FastAPI, HTTPException, Request\n+from fastapi.responses import JSONResponse\n+\n+app = FastAPI()\n+\n+FAKE_DB = {\n+    0: {\"name\": \"Admin\", \"role\": \"ADMIN\"},\n+    1: {\"name\": \"User 1\", \"role\": \"USER\"},\n+    2: {\"name\": \"User 2\", \"role\": \"USER\"},\n+}\n+\n+\n+@app.exception_handler([401, 403])\n+async def handle_auth_errors(request: Request, exc: Exception):\n+    return JSONResponse(\n+        status_code=exc.status_code if isinstance(exc, HTTPException) else 403,\n+        content={\"detail\": \"Access denied. Check your credentials or permissions.\"},\n+    )\n+\n+\n+@app.get(\"/secrets/\")\n+async def get_secrets(auth_user_id: Union[int, None] = None):\n+    # Get authenticated user info (not a production-ready code)\n+    if auth_user_id is not None:\n+        auth_user_info = FAKE_DB.get(auth_user_id)\n+    else:\n+        auth_user_info = None\n+\n+    # Return 401 status code if user not authenticated\n+    if auth_user_info is None:\n+        raise HTTPException(status_code=401)  # Not authenticated\n+\n+    # Return 403 status code if user is not authorized to get secret information\n+    if auth_user_info[\"role\"] != \"ADMIN\":\n+        raise HTTPException(status_code=403)  # Not authorized\n+\n+    return {\"data\": \"Secret information\"}\n\n```\n\n```diff\n@@ -0,0 +1,40 @@\n+from fastapi import FastAPI, File, HTTPException, Request, UploadFile\n+from fastapi.responses import JSONResponse\n+\n+MAX_FILE_SIZE_MB = 5\n+ALLOWED_TYPES = {\"application/pdf\", \"image/jpeg\"}\n+\n+app = FastAPI()\n+\n+\n+class FileTooLargeError(HTTPException):\n+    def __init__(self):\n+        super().__init__(status_code=413, detail=\"The uploaded file is too large.\")\n+\n+\n+class UnsupportedFileTypeError(HTTPException):\n+    def __init__(self):\n+        super().__init__(status_code=415, detail=\"Unsupported file type\")\n+\n+\n+@app.exception_handler((FileTooLargeError, UnsupportedFileTypeError))\n+async def custom_exception_handler(request: Request, exc: HTTPException):\n+    return JSONResponse(\n+        status_code=exc.status_code,\n+        content={\"error\": exc.detail, \"hint\": \"Need help? Contact support@example.com\"},\n+    )\n+\n+\n+@app.post(\"/upload/\")\n+async def upload_file(file: UploadFile = File(...)):\n+    # Validate file type\n+    if file.content_type not in ALLOWED_TYPES:\n+        raise UnsupportedFileTypeError()\n+\n+    # Validate file size (read contents to check size in memory)\n+    contents = await file.read()\n+    size_mb = len(contents) / (1024 * 1024)\n+    if size_mb > MAX_FILE_SIZE_MB:\n+        raise FileTooLargeError()\n+\n+    return {\"filename\": file.filename, \"message\": \"File uploaded successfully!\"}\n\n```\n\n```diff\n@@ -4543,10 +4543,10 @@ def decorator(func: DecoratedCallable) -> DecoratedCallable:\n     def exception_handler(\n         self,\n         exc_class_or_status_code: Annotated[\n-            Union[int, Type[Exception]],\n+            Union[int, Type[Exception], Sequence[int], Sequence[Type[Exception]]],\n             Doc(\n                 \"\"\"\n-                The Exception class this would handle, or a status code.\n+                The Exception class, a status code or a sequence of them this would handle.\n                 \"\"\"\n             ),\n         ],\n@@ -4582,7 +4582,11 @@ async def unicorn_exception_handl", "output": "Bug: ‚ú® Accept multiple status codes or exceptions in `exception_handler`\n\n## Description\r\n\r\nThis PR allows passing multiple status codes or exceptions to `exception_handler`.\r\n\r\n```\r\n@app.exception_handler((401, 403))\r\ndef auth_error_handler(request, exc):\r\n    pass\r\n    \r\n@app.exception_handler((FileTooLargeError, UnsupportedFileTypeError))\r\ndef file_upload_error_handler(request, exc):\r\n    pass\r\n```\r\n\r\n## Motivation\r\n\r\nThis feature is requested by #13242 and seems to be quite nice to have.\r\n\r\n## Implementation details\r\n\r\nIn this PR I implemented it as a Union type. This way seems to be widely used in popular libraries like `unittest`, `pytest`, `backoff`, `tenacity`.\r\n\r\nYou can pass parameters as any `Sequence` (`tuple` or `list`).\r\n\r\nI intentionally limited it to only allow passing a sequence of items of similar type (it's not allowed to mix status codes with exception classes at the same time). If you think this limitation is not needed, I will update PR to remove it.\r\n\r\n```\r\n# For now the following line will cause typing error\r\n@app.exception_handler((413, UnsupportedFileTypeError))\r\ndef file_upload_error_handler(request, exc):\r\n    pass\r\n```\r\n\r\n## Alternatives\r\nThere is already existing #13241 that does it in a bit different way (it accepts additional status codes or exceptions as `*extra_exc_classes_or_status_codes`).\r\n\r\nIt's already possible to re-use handlers for different errors by adding multiple decorators:\r\n```\r\n@app.exception_handler(401)\r\n@app.exception_handler(403)\r\ndef auth_error_handler(request, exc):\r\n    pass\r\n```\r\n\r\n## Checklist\r\n\r\n- [x] Tests added (including tests for code examples)\r\n- [x] Docs updated", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 572}
{"instruction": "Review the following code changes: ‚ú® Accept multiple status codes or exceptions in `exception_handler`", "input": "```diff\n@@ -109,6 +109,37 @@ You could also use `from starlette.requests import Request` and `from starlette.\n \n ///\n \n+### Handle multiple exceptions or status codes\n+\n+You can register the same handler for multiple exceptions or multiple status codes at once. Just pass a list or tuple of them to `@app.exception_handler(...)`.\n+\n+This is useful when you want to group related errors together and respond with the same logic.\n+\n+For example, if you want to treat 401 Unauthorized and 403 Forbidden as access-related issues:\n+\n+{* ../../docs_src/handling_errors/tutorial007.py hl[15:20,33,37] *}\n+\n+Raising an `HTTPException` with either a `401` or `403` status code will result in the same response detail:\n+\n+\n```\n\n```diff\n@@ -0,0 +1,39 @@\n+from typing import Union\n+\n+from fastapi import FastAPI, HTTPException, Request\n+from fastapi.responses import JSONResponse\n+\n+app = FastAPI()\n+\n+FAKE_DB = {\n+    0: {\"name\": \"Admin\", \"role\": \"ADMIN\"},\n+    1: {\"name\": \"User 1\", \"role\": \"USER\"},\n+    2: {\"name\": \"User 2\", \"role\": \"USER\"},\n+}\n+\n+\n+@app.exception_handler([401, 403])\n+async def handle_auth_errors(request: Request, exc: Exception):\n+    return JSONResponse(\n+        status_code=exc.status_code if isinstance(exc, HTTPException) else 403,\n+        content={\"detail\": \"Access denied. Check your credentials or permissions.\"},\n+    )\n+\n+\n+@app.get(\"/secrets/\")\n+async def get_secrets(auth_user_id: Union[int, None] = None):\n+    # Get authenticated user info (not a production-ready code)\n+    if auth_user_id is not None:\n+        auth_user_info = FAKE_DB.get(auth_user_id)\n+    else:\n+        auth_user_info = None\n+\n+    # Return 401 status code if user not authenticated\n+    if auth_user_info is None:\n+        raise HTTPException(status_code=401)  # Not authenticated\n+\n+    # Return 403 status code if user is not authorized to get secret information\n+    if auth_user_info[\"role\"] != \"ADMIN\":\n+        raise HTTPException(status_code=403)  # Not authorized\n+\n+    return {\"data\": \"Secret information\"}\n\n```\n\n```diff\n@@ -0,0 +1,40 @@\n+from fastapi import FastAPI, File, HTTPException, Request, UploadFile\n+from fastapi.responses import JSONResponse\n+\n+MAX_FILE_SIZE_MB = 5\n+ALLOWED_TYPES = {\"application/pdf\", \"image/jpeg\"}\n+\n+app = FastAPI()\n+\n+\n+class FileTooLargeError(HTTPException):\n+    def __init__(self):\n+        super().__init__(status_code=413, detail=\"The uploaded file is too large.\")\n+\n+\n+class UnsupportedFileTypeError(HTTPException):\n+    def __init__(self):\n+        super().__init__(status_code=415, detail=\"Unsupported file type\")\n+\n+\n+@app.exception_handler((FileTooLargeError, UnsupportedFileTypeError))\n+async def custom_exception_handler(request: Request, exc: HTTPException):\n+    return JSONResponse(\n+        status_code=exc.status_code,\n+        content={\"error\": exc.detail, \"hint\": \"Need help? Contact support@example.com\"},\n+    )\n+\n+\n+@app.post(\"/upload/\")\n+async def upload_file(file: UploadFile = File(...)):\n+    # Validate file type\n+    if file.content_type not in ALLOWED_TYPES:\n+        raise UnsupportedFileTypeError()\n+\n+    # Validate file size (read contents to check size in memory)\n+    contents = await file.read()\n+    size_mb = len(contents) / (1024 * 1024)\n+    if size_mb > MAX_FILE_SIZE_MB:\n+        raise FileTooLargeError()\n+\n+    return {\"filename\": file.filename, \"message\": \"File uploaded successfully!\"}\n\n```\n\n```diff\n@@ -4543,10 +4543,10 @@ def decorator(func: DecoratedCallable) -> DecoratedCallable:\n     def exception_handler(\n         self,\n         exc_class_or_status_code: Annotated[\n-            Union[int, Type[Exception]],\n+            Union[int, Type[Exception], Sequence[int], Sequence[Type[Exception]]],\n             Doc(\n                 \"\"\"\n-                The Exception class this would handle, or a status code.\n+                The Exception class, a status code or a sequence of them this would handle.\n                 \"\"\"\n             ),\n         ],\n@@ -4582,7 +4582,11 @@ async def unicorn_exception_handler(request: Request, exc: UnicornException):\n         \"\"\"\n \n         def decorator(func: DecoratedCallable) -> DecoratedCallable:\n-            self.add_exception_handler(exc_class_or_status_code, func)\n+            if isinstance(exc_class_or_status_code, Sequence):\n+                for exc_class_or_status_code_ in exc_class_or_status_code:\n+                    self.add_exception_handler(exc_class_or_status_code_, func)\n+            else:\n+                self.add_exception_handler(exc_class_or_status_code, func)\n             return func\n \n         return decorator\n\n```\n\n```diff\n@@ -5,6 +5,14 @@\n from starlette.responses import JSONResponse\n \n \n+class CustomException1(HTTPException):\n+    pass\n+\n+\n+class CustomException2(HTTPException):\n+    pass\n+\n+\n def http_exception_handler(request, exception):\n     return JSONResponse({\"exception\": \"http-exception\"})\n \n@@ -86,3 +94,62 @@ def test_traceback_for_dependency_with_yield():\n     last_frame = exc_info.traceback[-1]\n     assert str(last_fr", "output": "Changes look good. This PR implements: ‚ú® Accept multiple status codes or exceptions in `exception_handler`", "source": "pr", "type": "code_review", "pr_number": 572}
{"instruction": "Review the following code changes: üêõ Don't pre-fill form parameters with default values in `_get_multidict_value`", "input": "```diff\n@@ -723,26 +723,33 @@ def _validate_value_with_model_field(\n \n \n def _get_multidict_value(\n-    field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n+    field: ModelField,\n+    values: Mapping[str, Any],\n+    alias: Union[str, None] = None,\n+    form_input: bool = False,\n ) -> Any:\n     alias = alias or field.alias\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n         value = values.get(alias, None)\n-    if (\n-        value is None\n-        or (\n-            isinstance(field.field_info, (params.Form, temp_pydantic_v1_params.Form))\n-            and isinstance(value, str)  # For type checks\n-            and value == \"\"\n-        )\n-        or (is_sequence_field(field) and len(value) == 0)\n-    ):\n-        if field.required:\n-            return\n-        else:\n-            return deepcopy(field.default)\n+\n+    if form_input:\n+        # Special handling for form inputs:\n+        # Treat empty strings or empty lists as missing values\n+        if (isinstance(value, str) and value == \"\") or (\n+            is_sequence_field(field) and len(value) == 0\n+        ):\n+            return None\n+    else:\n+        # For non-form inputs:\n+        # If value is None or an empty sequence, use the default (if not required) or\n+        # treat as missing (if required)\n+        if value is None or (is_sequence_field(field) and len(value) == 0):\n+            if field.required:\n+                return None\n+            else:\n+                return deepcopy(field.default)\n     return value\n \n \n@@ -881,7 +888,7 @@ async def _extract_form_body(\n     values = {}\n \n     for field in body_fields:\n-        value = _get_multidict_value(field, received_body)\n+        value = _get_multidict_value(field, received_body, form_input=True)\n         field_info = field.field_info\n         if (\n             isinstance(field_info, (params.File, temp_pydantic_v1_params.File))\n\n```\n\n```diff\n@@ -1,12 +1,73 @@\n-from typing import Optional\n+from typing import Any, List, Optional\n \n-from fastapi import FastAPI, File, Form\n-from starlette.testclient import TestClient\n+import pytest\n+from fastapi import FastAPI, File, Form, UploadFile\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n from typing_extensions import Annotated\n \n+from .utils import needs_pydanticv2\n+\n+\n+class FormParams(BaseModel):\n+    param_1: str = \"default\"\n+    param_2: Annotated[str, Field(alias=\"param_2_alias\")] = \"default\"\n+    param_3: Annotated[str, Form(alias=\"param_3_alias\")] = \"default\"\n+    upload_file: Optional[UploadFile] = None\n+    file: Annotated[Optional[bytes], File()] = None\n+\n+\n app = FastAPI()\n \n \n+@app.post(\"/form-param\")\n+def form_param(\n+    param_1: Annotated[str, Form()] = \"default\",\n+    param_2: Annotated[str, Form(alias=\"param_2_alias\")] = \"default\",\n+    upload_file: Optional[UploadFile] = None,\n+    file: Annotated[Optional[bytes], File()] = None,\n+):\n+    return {\n+        \"param_1\": param_1,\n+        \"param_2\": param_2,\n+        \"upload_file\": upload_file,\n+        \"file\": file,\n+    }\n+\n+\n+@app.post(\"/form-model\")\n+def form_model(params: Annotated[FormParams, Form()]):\n+    return {\n+        \"param_1\": params.param_1,\n+        \"param_2\": params.param_2,\n+        \"param_3\": params.param_3,\n+        \"upload_file\": params.upload_file,\n+        \"file\": params.file,\n+    }\n+\n+\n+@app.post(\"/form-param-list-with-default\")\n+def form_param_list_with_default(\n+    params: Annotated[\n+        List[str],\n+        Form(),\n+    ] = [],  # noqa: B006 (default_factory doesn't work with Pydantic V1)\n+):\n+    return {\"params\": params}\n+\n+\n+@app.post(\"/form-param-optional-list\")\n+def form_param_optional_list(\n+    params: Annotated[Optional[List[str]], Form()] = None,\n+):\n+    return {\"params\": params}\n+\n+\n+@app.post(\"/form-model-fields-set\")\n+def form_model_fields_set(params: Annotated[FormParams, Form()]):\n+    return {\"fields_set\": params.model_fields_set}\n+\n+\n @app.post(\"/urlencoded\")\n async def post_url_encoded(age: Annotated[Optional[int], Form()] = None):\n     return age\n@@ -20,16 +81,137 @@ async def post_multi_part(\n     return {\"file\": file, \"age\": age}\n \n \n-client = TestClient(app)\n+@pytest.fixture(scope=\"module\")\n+def client():\n+    with TestClient(app) as test_client:\n+        yield test_client\n+\n+\n+@pytest.mark.parametrize(\n+    \"data\",\n+    [\n+        pytest.param({}, id=\"no_data_sent\"),\n+        pytest.param(\n+            {\"param_1\": \"\", \"param_2_alias\": \"\", \"upload_file\": \"\", \"file\": \"\"},\n+            id=\"empty_strings_sent\",\n+        ),\n+    ],\n+)\n+def test_defaults_form_param(client: TestClient, data: dict):\n+    \"\"\"\n+    Empty string or no input data - default value is used.\n+    For parameters declared as single Form fields.\n+    \"\"\"\n+    response = client.post(\"/form-param\", data=data)\n+    assert response.json() == {\n+        \"param_1\": \"default\",\n+        \"param_2\": \"default\",\n+        \"upload_file", "output": "Changes look good. This PR implements: üêõ Don't pre-fill form parameters with default values in `_get_multidict_value`", "source": "pr", "type": "code_review", "pr_number": 571}
{"instruction": "Review the following code changes: üë∑ Add performance tests with CodSpeed", "input": "```diff\n@@ -66,6 +66,10 @@ jobs:\n             python-version: \"3.13\"\n             pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n+          - os: ubuntu-latest\n+            python-version: \"3.13\"\n+            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n+            coverage: coverage\n           - os: ubuntu-latest\n             python-version: \"3.14\"\n             pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n@@ -100,6 +104,15 @@ jobs:\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n+      - name: CodSpeed benchmarks\n+        if: matrix.os == 'ubuntu-latest' && matrix.python-version == '3.13' && matrix.pydantic-version == 'pydantic>=2.0.2,<3.0.0'\n+        uses: CodSpeedHQ/action@v4\n+        env:\n+            COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n+            CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n+        with:\n+          mode: simulation\n+          run: coverage run -m pytest tests/ --codspeed\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n\n```\n\n```diff\n@@ -31,3 +31,5 @@ archive.zip\n \n # Ignore while the setup still depends on requirements.txt files\n uv.lock\n+\n+.codspeed\n\n```\n\n```diff\n@@ -11,6 +11,7 @@ PyJWT==2.9.0\n pyyaml >=5.3.1,<7.0.0\n pwdlib[argon2] >=0.2.1\n inline-snapshot>=0.21.1\n+pytest-codspeed==4.2.0\n # types\n types-ujson ==5.10.0.20240515\n types-orjson ==3.6.2\n\n```\n\n```diff\n@@ -0,0 +1,396 @@\n+import json\n+import sys\n+from collections.abc import Iterator\n+from typing import Annotated, Any\n+\n+import pytest\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+if \"--codspeed\" not in sys.argv:\n+    pytest.skip(\n+        \"Benchmark tests are skipped by default; run with --codspeed.\",\n+        allow_module_level=True,\n+    )\n+\n+LARGE_ITEMS: list[dict[str, Any]] = [\n+    {\n+        \"id\": i,\n+        \"name\": f\"item-{i}\",\n+        \"values\": list(range(25)),\n+        \"meta\": {\n+            \"active\": True,\n+            \"group\": i % 10,\n+            \"tag\": f\"t{i % 5}\",\n+        },\n+    }\n+    for i in range(300)\n+]\n+\n+LARGE_METADATA: dict[str, Any] = {\n+    \"source\": \"benchmark\",\n+    \"version\": 1,\n+    \"flags\": {\"a\": True, \"b\": False, \"c\": True},\n+    \"notes\": [\"x\" * 50, \"y\" * 50, \"z\" * 50],\n+}\n+\n+LARGE_PAYLOAD: dict[str, Any] = {\"items\": LARGE_ITEMS, \"metadata\": LARGE_METADATA}\n+\n+\n+def dep_a():\n+    return 40\n+\n+\n+def dep_b(a: Annotated[int, Depends(dep_a)]):\n+    return a + 2\n+\n+\n+@pytest.fixture(\n+    scope=\"module\",\n+    params=[\n+        \"pydantic-v2\",\n+        \"pydantic-v1\",\n+    ],\n+)\n+def basemodel_class(request: pytest.FixtureRequest) -> type[Any]:\n+    if request.param == \"pydantic-v2\":\n+        from pydantic import BaseModel\n+\n+        return BaseModel\n+    else:\n+        from pydantic.v1 import BaseModel\n+\n+        return BaseModel\n+\n+\n+@pytest.fixture(scope=\"module\")\n+def app(basemodel_class: type[Any]) -> FastAPI:\n+    class ItemIn(basemodel_class):\n+        name: str\n+        value: int\n+\n+    class ItemOut(basemodel_class):\n+        name: str\n+        value: int\n+        dep: int\n+\n+    class LargeIn(basemodel_class):\n+        items: list[dict[str, Any]]\n+        metadata: dict[str, Any]\n+\n+    class LargeOut(basemodel_class):\n+        items: list[dict[str, Any]]\n+        metadata: dict[str, Any]\n+\n+    app = FastAPI()\n+\n+    @app.post(\"/sync/validated\", response_model=ItemOut)\n+    def sync_validated(item: ItemIn, dep: Annotated[int, Depends(dep_b)]):\n+        return ItemOut(name=item.name, value=item.value, dep=dep)\n+\n+    @app.get(\"/sync/dict-no-response-model\")\n+    def sync_dict_no_response_model():\n+        return {\"name\": \"foo\", \"value\": 123}\n+\n+    @app.get(\"/sync/dict-with-response-model\", response_model=ItemOut)\n+    def sync_dict_with_response_model(\n+        dep: Annotated[int, Depends(dep_b)],\n+    ):\n+        return {\"name\": \"foo\", \"value\": 123, \"dep\": dep}\n+\n+    @app.get(\"/sync/model-no-response-model\")\n+    def sync_model_no_response_model(dep: Annotated[int, Depends(dep_b)]):\n+        return ItemOut(name=\"foo\", value=123, dep=dep)\n+\n+    @app.get(\"/sync/model-with-response-model\", response_model=ItemOut)\n+    def sync_model_with_response_model(dep: Annotated[int, Depends(dep_b)]):\n+        return ItemOut(name=\"foo\", value=123, dep=dep)\n+\n+    @app.post(\"/async/validated\", response_model=ItemOut)\n+    async def async_validated(\n+        item: ItemIn,\n+        dep:\n\n```", "output": "Changes look good. This PR implements: üë∑ Add performance tests with CodSpeed", "source": "pr", "type": "code_review", "pr_number": 570}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è Use prek as a pre-commit alternative", "input": "```diff\n@@ -21,14 +21,21 @@ jobs:\n         name: Checkout PR for own repo\n         if: env.IS_FORK == 'false'\n         with:\n-          # To be able to commit it needs more than the last commit\n+          # To be able to commit it needs to fetch the head of the branch, not the\n+          # merge commit\n           ref: ${{ github.head_ref }}\n+          # And it needs the full history to be able to compute diffs\n+          fetch-depth: 0\n           # A token other than the default GITHUB_TOKEN is needed to be able to trigger CI\n           token: ${{ secrets.PRE_COMMIT }}\n       # pre-commit lite ci needs the default checkout configs to work\n       - uses: actions/checkout@v5\n         name: Checkout PR for fork\n         if: env.IS_FORK == 'true'\n+        with:\n+        # To be able to commit it needs the head branch of the PR, the remote one\n+          ref: ${{ github.event.pull_request.head.sha }}\n+          fetch-depth: 0\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n@@ -44,12 +51,9 @@ jobs:\n         run: |\n           uv venv\n           uv pip install -r requirements.txt\n-      - name: Run pre-commit\n+      - name: Run prek - pre-commit\n         id: precommit\n-        run: |\n-          # Fetch the base branch for comparison\n-          git fetch origin ${{ github.base_ref }}\n-          uvx pre-commit run --from-ref origin/${{ github.base_ref }} --to-ref HEAD --show-diff-on-failure\n+        run: uvx prek run --from-ref origin/${GITHUB_BASE_REF} --to-ref HEAD --show-diff-on-failure\n         continue-on-error: true\n       - name: Commit and push changes\n         if: env.IS_FORK == 'false'\n\n```\n\n```diff\n@@ -2,6 +2,6 @@\n -r requirements-tests.txt\n -r requirements-docs.txt\n -r requirements-translations.txt\n-pre-commit >=4.5.0,<5.0.0\n+prek==0.2.22\n # For generating screenshots\n playwright\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è Use prek as a pre-commit alternative", "source": "pr", "type": "code_review", "pr_number": 569}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for Ukrainian, generated from the existing translations", "input": "```diff\n@@ -0,0 +1,46 @@\n+### Target language\n+\n+Translate to Ukrainian (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞).\n+\n+Language code: uk.\n+\n+### Grammar and tone\n+\n+1) Use polite/formal address consistent with existing Ukrainian docs (use ‚Äú–≤–∏/–≤–∞—à‚Äù).\n+2) Keep the tone concise and technical.\n+\n+### Headings\n+\n+1) Follow existing Ukrainian heading style; keep headings short and instructional.\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes\n+\n+1) Prefer Ukrainian guillemets ¬´‚Ä¶¬ª for quoted terms in prose, matching existing Ukrainian docs.\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Ukrainian docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): –∑–∞–ø–∏—Ç\n+- response (HTTP): –≤—ñ–¥–ø–æ–≤—ñ–¥—å\n+- path operation: –æ–ø–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—É\n+- path operation function: —Ñ—É–Ω–∫—Ü—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles (choose one canonical form where variants exist):\n+\n+- `/// note | –ü—Ä–∏–º—ñ—Ç–∫–∞`\n+- `/// note | –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ`\n+- `/// tip | –ü–æ—Ä–∞–¥–∞`\n+- `/// warning | –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è`\n+- `/// info | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è`\n+- `/// danger | –û–±–µ—Ä–µ–∂–Ω–æ`\n\n```", "output": "Changes look good. This PR implements: üîß Add LLM prompt file for Ukrainian, generated from the existing translations", "source": "pr", "type": "code_review", "pr_number": 568}
{"instruction": "Fix the following bug: üìù Fix duplicated variable in `docs_src/python_types/tutorial005_py39.py`", "input": "This PR fixes a small bug in the Python Types ‚ÄúSimple types‚Äù example used in the docs.‚Äã\r\n\r\nThe return statement currently duplicates ```item_d``` and includes six values: \r\n```python\r\ndef get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\r\n    return item_a, item_b, item_c, item_d, item_d, item_e\r\n```\r\nThis change updates it to return each parameter once:\r\n```python\r\ndef get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\r\n    return item_a, item_b, item_c, item_d, item_e\r\n\r\n```\r\n\r\nNo existing issue was found for this; opening a direct docs/example fix PR.", "output": "```diff\n@@ -1,2 +1,2 @@\n def get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\n-    return item_a, item_b, item_c, item_d, item_d, item_e\n+    return item_a, item_b, item_c, item_d, item_e\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 567}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,2 +1,2 @@\n def get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\n-    return item_a, item_b, item_c, item_d, item_d, item_e\n+    return item_a, item_b, item_c, item_d, item_e\n\n```", "output": "Bug: üìù Fix duplicated variable in `docs_src/python_types/tutorial005_py39.py`\n\nThis PR fixes a small bug in the Python Types ‚ÄúSimple types‚Äù example used in the docs.‚Äã\r\n\r\nThe return statement currently duplicates ```item_d``` and includes six values: \r\n```python\r\ndef get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\r\n    return item_a, item_b, item_c, item_d, item_d, item_e\r\n```\r\nThis change updates it to return each parameter once:\r\n```python\r\ndef get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\r\n    return item_a, item_b, item_c, item_d, item_e\r\n\r\n```\r\n\r\nNo existing issue was found for this; opening a direct docs/example fix PR.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 567}
{"instruction": "Review the following code changes: üìù Fix duplicated variable in `docs_src/python_types/tutorial005_py39.py`", "input": "```diff\n@@ -1,2 +1,2 @@\n def get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\n-    return item_a, item_b, item_c, item_d, item_d, item_e\n+    return item_a, item_b, item_c, item_d, item_e\n\n```", "output": "Changes look good. This PR implements: üìù Fix duplicated variable in `docs_src/python_types/tutorial005_py39.py`", "source": "pr", "type": "code_review", "pr_number": 567}
{"instruction": "Review the following code changes: Improve quick start documentation and add health endpoint", "input": "```diff\n@@ -0,0 +1,31 @@\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI(\n+    title=\"FastAPI\",\n+    description=\"\"\"\n+## üöÄ Quick Start\n+\n+\n```", "output": "Changes look good. This PR implements: Improve quick start documentation and add health endpoint", "source": "pr", "type": "code_review", "pr_number": 566}
{"instruction": "Review the following code changes: üìù Swap install and run code sections order in `docs/tutorial/index.md`", "input": "```diff\n@@ -8,32 +8,6 @@ Au√üerdem dienen diese als zuk√ºnftige Referenz.\n \n Dadurch k√∂nnen Sie jederzeit  zur√ºckkommen und sehen genau das, was Sie ben√∂tigen.\n \n-## Den Code ausf√ºhren\n-\n-Alle Codebl√∂cke k√∂nnen kopiert und direkt verwendet werden (da es sich um getestete Python-Dateien handelt).\n-\n-Um eines der Beispiele auszuf√ºhren, kopieren Sie den Code in eine Datei `main.py`, und starten Sie `uvicorn` mit:\n-\n-<div class=\"termy\">\n-\n-\n```\n\n```diff\n@@ -6,33 +6,7 @@\n \n ‚ö´Ô∏è üèó üë∑ üîÆ üîó.\n \n-üëÜ üí™ üëü üîô &amp; üëÄ ‚ö´Ô∏è‚ùî ‚ö´Ô∏è‚ùî üëÜ üí™.\n-\n-## üèÉ üìü\n-\n-üåê üìü üç´ üí™ üìÅ &amp; ‚öôÔ∏è üîó (üë´ ü§ô üíØ üêç üìÅ).\n-\n-üèÉ üôÜ üñº, üìÅ üìü üìÅ `main.py`, &amp; ‚ñ∂Ô∏è `uvicorn` ‚èÆÔ∏è:\n-\n-<div class=\"termy\">\n-\n-\n```\n\n```diff\n@@ -6,6 +6,30 @@ Each section gradually builds on the previous ones, but it's structured to separ\n \n It is also built to work as a future reference so you can come back and see exactly what you need.\n \n+## Install FastAPI { #install-fastapi }\n+\n+The first step is to install FastAPI.\n+\n+Make sure you create a [virtual environment](../virtual-environments.md){.internal-link target=_blank}, activate it, and then **install FastAPI**:\n+\n+<div class=\"termy\">\n+\n+\n```\n\n```diff\n@@ -6,6 +6,30 @@ Cada secci√≥n se basa gradualmente en las anteriores, pero est√° estructurada pa\n \n Tambi√©n est√° dise√±ado para funcionar como una referencia futura para que puedas volver y ver exactamente lo que necesitas.\n \n+## Instalar FastAPI\n+\n+El primer paso es instalar FastAPI.\n+\n+Aseg√∫rate de crear un [entorno virtual](../virtual-environments.md){.internal-link target=_blank}, act√≠valo, y luego **instala FastAPI**:\n+\n+<div class=\"termy\">\n+\n+\n```\n\n```diff\n@@ -8,32 +8,6 @@ Il est √©galement con√ßu pour fonctionner comme une r√©f√©rence future.\n \n Vous pouvez donc revenir et voir exactement ce dont vous avez besoin.\n \n-## Ex√©cuter le code\n-\n-Tous les blocs de code peuvent √™tre copi√©s et utilis√©s directement (il s'agit en fait de fichiers Python test√©s).\n-\n-Pour ex√©cuter l'un de ces exemples, copiez le code dans un fichier `main.py`, et commencez `uvicorn` avec :\n-\n-<div class=\"termy\">\n-\n-\n```", "output": "Changes look good. This PR implements: üìù Swap install and run code sections order in `docs/tutorial/index.md`", "source": "pr", "type": "code_review", "pr_number": 565}
{"instruction": "Review the following code changes: Add SecretBytes and NewType support for File() parameter", "input": "```diff\n@@ -19,6 +19,7 @@\n from fastapi._compat import may_v1\n from fastapi.types import UnionType\n from pydantic import BaseModel\n+from pydantic.types import SecretBytes\n from pydantic.version import VERSION as PYDANTIC_VERSION\n from starlette.datastructures import UploadFile\n from typing_extensions import Annotated, get_args, get_origin\n@@ -144,13 +145,23 @@ def field_annotation_is_scalar_sequence(annotation: Union[Type[Any], None]) -> b\n     )\n \n \n+def unwrap_newtype(annotation: Any) -> Any:\n+    \"\"\"Unwrap NewType to get the underlying type.\"\"\"\n+    while (supertype := getattr(annotation, \"__supertype__\", None)) is not None:\n+        annotation = supertype\n+    return annotation\n+\n+\n def is_bytes_or_nonable_bytes_annotation(annotation: Any) -> bool:\n-    if lenient_issubclass(annotation, bytes):\n+    annotation = unwrap_newtype(annotation)\n+    if lenient_issubclass(annotation, (bytes, SecretBytes, may_v1.SecretBytes)):\n         return True\n     origin = get_origin(annotation)\n     if origin is Union or origin is UnionType:\n         for arg in get_args(annotation):\n-            if lenient_issubclass(arg, bytes):\n+            if lenient_issubclass(\n+                unwrap_newtype(arg), (bytes, SecretBytes, may_v1.SecretBytes)\n+            ):\n                 return True\n     return False\n \n\n```\n\n```diff\n@@ -278,11 +278,13 @@ def is_scalar_sequence_field(field: ModelField) -> bool:\n \n \n def is_bytes_field(field: ModelField) -> bool:\n-    return lenient_issubclass(field.type_, bytes)  # type: ignore[no-any-return]\n+    return lenient_issubclass(shared.unwrap_newtype(field.type_), (bytes, SecretBytes))  # type: ignore[no-any-return]\n \n \n def is_bytes_sequence_field(field: ModelField) -> bool:\n-    return field.shape in sequence_shapes and lenient_issubclass(field.type_, bytes)\n+    return field.shape in sequence_shapes and lenient_issubclass(\n+        shared.unwrap_newtype(field.type_), (bytes, SecretBytes)\n+    )\n \n \n def copy_field_info(*, field_info: FieldInfo, annotation: Any) -> FieldInfo:\n\n```\n\n```diff\n@@ -0,0 +1,182 @@\n+\"\"\"\n+Test support for SecretBytes type with File() parameter.\n+\n+This tests that SecretBytes can be used as a file upload type annotation,\n+similar to how bytes is used, with the content being read from the uploaded file.\n+Also tests NewType wrappers around bytes and SecretBytes.\n+\"\"\"\n+\n+from pathlib import Path\n+from typing import List, NewType, Union\n+\n+import pytest\n+from fastapi import FastAPI, File\n+from fastapi.testclient import TestClient\n+from pydantic import SecretBytes\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+# NewType wrappers for testing\n+SecretFileBytes = NewType(\"SecretFileBytes\", SecretBytes)\n+CustomBytes = NewType(\"CustomBytes\", bytes)\n+\n+\n+@app.post(\"/secret_file\")\n+def post_secret_file(data: Annotated[SecretBytes, File()]):\n+    # SecretBytes wraps bytes and provides a get_secret_value() method\n+    return {\"file_size\": len(data.get_secret_value())}\n+\n+\n+@app.post(\"/secret_file_optional\")\n+def post_secret_file_optional(data: Annotated[Union[SecretBytes, None], File()] = None):\n+    if data is None:\n+        return {\"file_size\": None}\n+    return {\"file_size\": len(data.get_secret_value())}\n+\n+\n+@app.post(\"/secret_file_default\")\n+def post_secret_file_default(data: SecretBytes = File(default=None)):\n+    if data is None:\n+        return {\"file_size\": None}\n+    return {\"file_size\": len(data.get_secret_value())}\n+\n+\n+@app.post(\"/secret_file_list\")\n+def post_secret_file_list(files: Annotated[List[SecretBytes], File()]):\n+    return {\"file_sizes\": [len(f.get_secret_value()) for f in files]}\n+\n+\n+@app.post(\"/newtype_secret_bytes\")\n+def post_newtype_secret_bytes(data: Annotated[SecretFileBytes, File()]):\n+    # NewType wrapper around SecretBytes\n+    return {\"file_size\": len(data.get_secret_value())}\n+\n+\n+@app.post(\"/newtype_bytes\")\n+def post_newtype_bytes(data: Annotated[CustomBytes, File()]):\n+    # NewType wrapper around bytes\n+    return {\"file_size\": len(data)}\n+\n+\n+client = TestClient(app)\n+\n+\n+@pytest.fixture\n+def tmp_file(tmp_path: Path) -> Path:\n+    f = tmp_path / \"secret.txt\"\n+    f.write_text(\"secret data content\")\n+    return f\n+\n+\n+@pytest.fixture\n+def tmp_file_2(tmp_path: Path) -> Path:\n+    f = tmp_path / \"secret2.txt\"\n+    f.write_text(\"more secret data\")\n+    return f\n+\n+\n+def test_secret_bytes_file(tmp_file: Path):\n+    \"\"\"Test that SecretBytes works with File() annotation.\"\"\"\n+    response = client.post(\n+        \"/secret_file\",\n+        files={\"data\": (tmp_file.name, tmp_file.read_bytes())},\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"file_size\": len(\"secret data content\")}\n+\n+\n+def test_secret_bytes_file_optional_with_file(tmp_file: Path):\n+    \"\"\"Test that SecretBytes | None works with File() annotation when file is provided.\"\"\"\n+    response = client.post(\n+        \"/secret_file_optional\",\n+        files={\"data\": (tmp_file.name, tmp_file.read_bytes())},\n+    )\n+    assert response", "output": "Changes look good. This PR implements: Add SecretBytes and NewType support for File() parameter", "source": "pr", "type": "code_review", "pr_number": 564}
{"instruction": "Review the following code changes: üîß Tweak pre-commit to allow committing release-notes", "input": "```diff\n@@ -5,6 +5,7 @@ repos:\n     rev: v6.0.0\n     hooks:\n       - id: check-added-large-files\n+        args: ['--maxkb=750']\n       - id: check-toml\n       - id: check-yaml\n         args:\n\n```", "output": "Changes look good. This PR implements: üîß Tweak pre-commit to allow committing release-notes", "source": "pr", "type": "code_review", "pr_number": 563}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for Japanese, generated from the existing translations", "input": "```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Japanese (Êó•Êú¨Ë™û).\n+\n+Language code: ja.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Japanese („Åß„Åô/„Åæ„ÅôË™ø).\n+2) Keep the tone concise and technical (match existing Japanese FastAPI docs).\n+\n+### Headings\n+\n+1) Follow the existing Japanese style: short, descriptive headings (often noun phrases), e.g. „Äå„ÉÅ„Çß„ÉÉ„ÇØ„Äç.\n+2) Do not add a trailing period at the end of headings.\n+\n+### Quotes\n+\n+1) Prefer Japanese corner brackets „Äå„Äç in normal prose when quoting a term.\n+2) Do not change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Japanese docs (commonly `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): „É™„ÇØ„Ç®„Çπ„Éà\n+- response (HTTP): „É¨„Çπ„Éù„É≥„Çπ\n+- path operation: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥\n+- path operation function: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥Èñ¢Êï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | ÂÇôËÄÉ`\n+- `/// note | ÊäÄË°ìË©≥Á¥∞`\n+- `/// tip | Ë±ÜÁü•Ë≠ò`\n+- `/// warning | Ê≥®ÊÑè`\n+- `/// info | ÊÉÖÂ†±`\n+- `/// check | Á¢∫Ë™ç`\n+- `/// danger | Ë≠¶Âëä`\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Japanese (Êó•Êú¨Ë™û).\n+\n+Language code: ja.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Japanese („Åß„Åô/„Åæ„ÅôË™ø).\n+2) Keep the tone concise and technical (match existing Japanese FastAPI docs).\n+\n+### Headings\n+\n+1) Follow the existing Japanese style: short, descriptive headings (often noun phrases), e.g. „Äå„ÉÅ„Çß„ÉÉ„ÇØ„Äç.\n+2) Do not add a trailing period at the end of headings.\n+\n+### Quotes\n+\n+1) Prefer Japanese corner brackets „Äå„Äç in normal prose when quoting a term.\n+2) Do not change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Japanese docs (commonly `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): „É™„ÇØ„Ç®„Çπ„Éà\n+- response (HTTP): „É¨„Çπ„Éù„É≥„Çπ\n+- path operation: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥\n+- path operation function: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥Èñ¢Êï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | ÂÇôËÄÉ`\n+- `/// note | ÊäÄË°ìË©≥Á¥∞`\n+- `/// tip | Ë±ÜÁü•Ë≠ò`\n+- `/// warning | Ê≥®ÊÑè`\n+- `/// info | ÊÉÖÂ†±`\n+- `/// check | Á¢∫Ë™ç`\n+- `/// danger | Âç±Èô∫`\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Japanese (Êó•Êú¨Ë™û).\n+\n+Language code: ja.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Japanese („Åß„Åô/„Åæ„ÅôË™ø).\n+2) Keep the tone concise and technical (match existing Japanese FastAPI docs).\n+\n+### Headings\n+\n+1) Follow the existing Japanese style: short, descriptive headings (often noun phrases), e.g. „Äå„ÉÅ„Çß„ÉÉ„ÇØ„Äç.\n+2) Do not add a trailing period at the end of headings.\n+\n+### Quotes\n+\n+1) Prefer Japanese corner brackets „Äå„Äç in normal prose when quoting a term.\n+2) Do not change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Japanese docs (commonly `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): „É™„ÇØ„Ç®„Çπ„Éà\n+- response (HTTP): „É¨„Çπ„Éù„É≥„Çπ\n+- path operation: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥\n+- path operation function: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥Èñ¢Êï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | ÂÇôËÄÉ`\n+- `/// note | ÊäÄË°ìË©≥Á¥∞`\n+- `/// tip | Ë±ÜÁü•Ë≠ò`\n+- `/// warning | Ê≥®ÊÑè`\n+- `/// info | ÊÉÖÂ†±`\n+- `/// check | Á¢∫Ë™ç`\n+- `/// danger | Âç±Èô∫`\n\n```", "output": "Code Review for: üîß Add LLM prompt file for Japanese, generated from the existing translations\n\nüìù **docs/ja/llm-prompt.md**: Perfect, thanks! :raised_hands: \n\n", "source": "pr", "type": "code_review", "pr_number": 562}
{"instruction": "Review this code change in `docs/ja/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Japanese (Êó•Êú¨Ë™û).\n+\n+Language code: ja.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Japanese („Åß„Åô/„Åæ„ÅôË™ø).\n+2) Keep the tone concise and technical (match existing Japanese FastAPI docs).\n+\n+### Headings\n+\n+1) Follow the existing Japanese style: short, descriptive headings (often noun phrases), e.g. „Äå„ÉÅ„Çß„ÉÉ„ÇØ„Äç.\n+2) Do not add a trailing period at the end of headings.\n+\n+### Quotes\n+\n+1) Prefer Japanese corner brackets „Äå„Äç in normal prose when quoting a term.\n+2) Do not change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Japanese docs (commonly `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): „É™„ÇØ„Ç®„Çπ„Éà\n+- response (HTTP): „É¨„Çπ„Éù„É≥„Çπ\n+- path operation: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥\n+- path operation function: „Éë„Çπ„Ç™„Éö„É¨„Éº„Ç∑„Éß„É≥Èñ¢Êï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | ÂÇôËÄÉ`\n+- `/// note | ÊäÄË°ìË©≥Á¥∞`\n+- `/// tip | Ë±ÜÁü•Ë≠ò`\n+- `/// warning | Ê≥®ÊÑè`\n+- `/// info | ÊÉÖÂ†±`\n+- `/// check | Á¢∫Ë™ç`\n+- `/// danger | Âç±Èô∫`\n\n```", "output": "Perfect, thanks! :raised_hands: ", "source": "pr_review", "type": "inline_review", "pr_number": 562}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for Korean, generated from the existing translations", "input": "```diff\n@@ -0,0 +1,51 @@\n+### Target language\n+\n+Translate to Korean (ÌïúÍµ≠Ïñ¥).\n+\n+Language code: ko.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n+2) Keep the tone consistent with the existing Korean FastAPI docs.\n+\n+### Headings\n+\n+1) Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Korean docs.\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Korean docs (often `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ÏöîÏ≤≠\n+- response (HTTP): ÏùëÎãµ\n+- path operation: Í≤ΩÎ°ú Ï≤òÎ¶¨\n+- path operation function: Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | Ï∞∏Í≥†`\n+- `/// tip | ÌåÅ`\n+- `/// warning | Í≤ΩÍ≥†`\n+- `/// info | Ï†ïÎ≥¥`\n+- `/// danger | ÏúÑÌóò`\n+- `/// note Technical Details | Í∏∞Ïà† ÏÑ∏Î∂ÄÏÇ¨Ìï≠`\n+- `/// check | ÌôïÏù∏`\n+Notes:\n+\n+- `details` blocks exist in Korean docs; keep `/// details` as-is and translate only the title after `|`.\n+- Example canonical title used: `/// details | ÏÉÅÏÑ∏ ÏÑ§Î™Ö`\n\n```\n\n```diff\n@@ -0,0 +1,50 @@\n+### Target language\n+\n+Translate to Korean (ÌïúÍµ≠Ïñ¥).\n+\n+Language code: ko.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n+2) Keep the tone consistent with the existing Korean FastAPI docs.\n+\n+### Headings\n+\n+1) Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Korean docs.\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Korean docs (often `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ÏöîÏ≤≠\n+- response (HTTP): ÏùëÎãµ\n+- path operation: Í≤ΩÎ°ú ÏûëÎèô\n+- path operation function: Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò\n\n```\n\n```diff\n@@ -0,0 +1,50 @@\n+### Target language\n+\n+Translate to Korean (ÌïúÍµ≠Ïñ¥).\n+\n+Language code: ko.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n+2) Keep the tone consistent with the existing Korean FastAPI docs.\n+\n+### Headings\n+\n+1) Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Korean docs.\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Korean docs (often `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ÏöîÏ≤≠\n+- response (HTTP): ÏùëÎãµ\n+- path operation: Í≤ΩÎ°ú ÏûëÎèô\n+- path operation function: Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | Ï∞∏Í≥†`\n+- `/// tip | ÌåÅ`\n+- `/// warning | Í≤ΩÍ≥†`\n+- `/// info | Ï†ïÎ≥¥`\n+- `/// danger | ÏúÑÌóò`\n+\n\n```\n\n```diff\n@@ -0,0 +1,50 @@\n+### Target language\n+\n+Translate to Korean (ÌïúÍµ≠Ïñ¥).\n+\n+Language code: ko.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n+2) Keep the tone consistent with the existing Korean FastAPI docs.\n+\n+### Headings\n+\n+1) Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Korean docs.\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Korean docs (often `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ÏöîÏ≤≠\n+- response (HTTP): ÏùëÎãµ\n+- path operation: Í≤ΩÎ°ú ÏûëÎèô\n+- path operation function: Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | Ï∞∏Í≥†`\n+- `/// tip | ÌåÅ`\n+- `/// warning | Í≤ΩÍ≥†`\n+- `/// info | Ï†ïÎ≥¥`\n+- `/// danger | ÏúÑÌóò`\n+\n+Notes:\n+\n+- `details` blocks exist in Korean docs; keep `/// details` as-is and translate only the title after `|`.\n+- Example canonical title used: `/// d", "output": "Code Review for: üîß Add LLM prompt file for Korean, generated from the existing translations\n\nüìù **docs/ko/llm-prompt.md**: Excellent, thank you! :raised_hands: \n\nüìù **docs/ko/llm-prompt.md**: Perfect, thank you! :raised_hands: \n\n", "source": "pr", "type": "code_review", "pr_number": 561}
{"instruction": "Review this code change in `docs/ko/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,50 @@\n+### Target language\n+\n+Translate to Korean (ÌïúÍµ≠Ïñ¥).\n+\n+Language code: ko.\n+\n+### Grammar and tone\n+\n+1) Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n+2) Keep the tone consistent with the existing Korean FastAPI docs.\n+\n+### Headings\n+\n+1) Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Korean docs.\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Korean docs (often `...`).\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ÏöîÏ≤≠\n+- response (HTTP): ÏùëÎãµ\n+- path operation: Í≤ΩÎ°ú ÏûëÎèô\n+- path operation function: Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò\n\n```", "output": "Excellent, thank you! :raised_hands: ", "source": "pr_review", "type": "inline_review", "pr_number": 561}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è Upgrade OpenAI model for translations to gpt-5.2", "input": "```diff\n@@ -727,7 +727,7 @@ def translate_page(\n         print(f\"Found existing translation: {out_path}\")\n         old_translation = out_path.read_text(encoding=\"utf-8\")\n     print(f\"Translating {en_path} to {language} ({language_name})\")\n-    agent = Agent(\"openai:gpt-5\")\n+    agent = Agent(\"openai:gpt-5.2\")\n \n     prompt_segments = [\n         general_prompt,\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è Upgrade OpenAI model for translations to gpt-5.2", "source": "pr", "type": "code_review", "pr_number": 560}
{"instruction": "Review the following code changes: üîä Add deprecation warnings when using `pydantic.v1`", "input": "```diff\n@@ -1,6 +1,7 @@\n import dataclasses\n import inspect\n import sys\n+import warnings\n from collections.abc import Coroutine, Mapping, Sequence\n from contextlib import AsyncExitStack, contextmanager\n from copy import copy, deepcopy\n@@ -322,6 +323,13 @@ def get_dependant(\n             )\n             continue\n         assert param_details.field is not None\n+        if isinstance(param_details.field, may_v1.ModelField):\n+            warnings.warn(\n+                \"pydantic.v1 is deprecated and will soon stop being supported by FastAPI.\"\n+                f\" Please update the param {param_name}: {param_details.type_annotation!r}.\",\n+                category=DeprecationWarning,\n+                stacklevel=5,\n+            )\n         if isinstance(\n             param_details.field.field_info, (params.Body, temp_pydantic_v1_params.Body)\n         ):\n\n```\n\n```diff\n@@ -2,6 +2,7 @@\n import functools\n import inspect\n import json\n+import warnings\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n@@ -28,6 +29,7 @@\n     _get_model_config,\n     _model_dump,\n     _normalize_errors,\n+    annotation_is_pydantic_v1,\n     lenient_issubclass,\n     may_v1,\n )\n@@ -634,6 +636,13 @@ def __init__(\n                 f\"Status code {status_code} must not have a response body\"\n             )\n             response_name = \"Response_\" + self.unique_id\n+            if annotation_is_pydantic_v1(self.response_model):\n+                warnings.warn(\n+                    \"pydantic.v1 is deprecated and will soon stop being supported by FastAPI.\"\n+                    f\" Please update the response model {self.response_model!r}.\",\n+                    category=DeprecationWarning,\n+                    stacklevel=4,\n+                )\n             self.response_field = create_model_field(\n                 name=response_name,\n                 type_=self.response_model,\n@@ -667,6 +676,13 @@ def __init__(\n                     f\"Status code {additional_status_code} must not have a response body\"\n                 )\n                 response_name = f\"Response_{additional_status_code}_{self.unique_id}\"\n+                if annotation_is_pydantic_v1(model):\n+                    warnings.warn(\n+                        \"pydantic.v1 is deprecated and will soon stop being supported by FastAPI.\"\n+                        f\" In responses={{}}, please update {model}.\",\n+                        category=DeprecationWarning,\n+                        stacklevel=4,\n+                    )\n                 response_field = create_model_field(\n                     name=response_name, type_=model, mode=\"serialization\"\n                 )\n\n```\n\n```diff\n@@ -1,5 +1,6 @@\n import json\n import sys\n+import warnings\n from collections.abc import Iterator\n from typing import Annotated, Any\n \n@@ -84,96 +85,103 @@ class LargeOut(basemodel_class):\n \n     app = FastAPI()\n \n-    @app.post(\"/sync/validated\", response_model=ItemOut)\n-    def sync_validated(item: ItemIn, dep: Annotated[int, Depends(dep_b)]):\n-        return ItemOut(name=item.name, value=item.value, dep=dep)\n-\n-    @app.get(\"/sync/dict-no-response-model\")\n-    def sync_dict_no_response_model():\n-        return {\"name\": \"foo\", \"value\": 123}\n-\n-    @app.get(\"/sync/dict-with-response-model\", response_model=ItemOut)\n-    def sync_dict_with_response_model(\n-        dep: Annotated[int, Depends(dep_b)],\n-    ):\n-        return {\"name\": \"foo\", \"value\": 123, \"dep\": dep}\n-\n-    @app.get(\"/sync/model-no-response-model\")\n-    def sync_model_no_response_model(dep: Annotated[int, Depends(dep_b)]):\n-        return ItemOut(name=\"foo\", value=123, dep=dep)\n-\n-    @app.get(\"/sync/model-with-response-model\", response_model=ItemOut)\n-    def sync_model_with_response_model(dep: Annotated[int, Depends(dep_b)]):\n-        return ItemOut(name=\"foo\", value=123, dep=dep)\n-\n-    @app.post(\"/async/validated\", response_model=ItemOut)\n-    async def async_validated(\n-        item: ItemIn,\n-        dep: Annotated[int, Depends(dep_b)],\n-    ):\n-        return ItemOut(name=item.name, value=item.value, dep=dep)\n-\n-    @app.post(\"/sync/large-receive\")\n-    def sync_large_receive(payload: LargeIn):\n-        return {\"received\": len(payload.items)}\n-\n-    @app.post(\"/async/large-receive\")\n-    async def async_large_receive(payload: LargeIn):\n-        return {\"received\": len(payload.items)}\n-\n-    @app.get(\"/sync/large-dict-no-response-model\")\n-    def sync_large_dict_no_response_model():\n-        return LARGE_PAYLOAD\n-\n-    @app.get(\"/sync/large-dict-with-response-model\", response_model=LargeOut)\n-    def sync_large_dict_with_response_model():\n-        return LARGE_PAYLOAD\n-\n-    @app.get(\"/sync/large-model-no-response-model\")\n-    def sync_large_model_no_response_model():\n-        return LargeOut(items=LARGE_ITEMS, metadata=LARGE_METADATA)\n-\n-    @app.get(\"/sync/large-model-with-response-model\", response_model=LargeOut)\n-    def sync_large_model_with_response_model():\n-        return LargeOut(items=LARGE_ITEMS, metadata=LARGE_METADATA)\n-\n-    @app.ge", "output": "Changes look good. This PR implements: üîä Add deprecation warnings when using `pydantic.v1`", "source": "pr", "type": "code_review", "pr_number": 559}
{"instruction": "Fix the following bug: üî® Update scripts and pre-commit to autofix files", "input": "üî® Update scripts and pre-commit to autofix files", "output": "```diff\n@@ -60,8 +60,6 @@ jobs:\n             pyproject.toml\n       - name: Install docs extras\n         run: uv pip install -r requirements-docs.txt\n-      - name: Verify Docs\n-        run: python ./scripts/docs.py verify-docs\n       - name: Export Language Codes\n         id: show-langs\n         run: |\n\n```\n\n```diff\n@@ -21,10 +21,28 @@ repos:\n       - id: ruff-format\n   - repo: local\n     hooks:\n-      - id: local-script\n+      - id: add-permalinks-pages\n         language: unsupported\n-        name: local script\n+        name: add-permalinks-pages\n         entry: uv run ./scripts/docs.py add-permalinks-pages\n         args:\n           - --update-existing\n         files: ^docs/en/docs/.*\\.md$\n+      - id: generate-readme\n+        language: unsupported\n+        name: generate README.md from index.md\n+        entry: uv run ./scripts/docs.py generate-readme\n+        files: ^docs/en/docs/index\\.md|docs/en/data/sponsors\\.yml|scripts/docs\\.py$\n+        pass_filenames: false\n+      - id: update-languages\n+        language: unsupported\n+        name: update languages\n+        entry: uv run ./scripts/docs.py update-languages\n+        files: ^docs/.*|scripts/docs\\.py$\n+        pass_filenames: false\n+      - id: ensure-non-translated\n+        language: unsupported\n+        name: ensure non-translated files are not modified\n+        entry: uv run ./scripts/docs.py ensure-non-translated\n+        files: ^docs/(?!en/).*|^scripts/docs\\.py$\n+        pass_filenames: false\n\n```\n\n```diff\n@@ -19,7 +19,13 @@\n \n logging.basicConfig(level=logging.INFO)\n \n-SUPPORTED_LANGS = {\"en\", \"de\", \"es\", \"pt\", \"ru\"}\n+SUPPORTED_LANGS = {\n+    \"en\",\n+    \"de\",\n+    \"es\",\n+    \"pt\",\n+    \"ru\",\n+}\n \n \n app = typer.Typer()\n@@ -232,27 +238,15 @@ def generate_readme() -> None:\n     \"\"\"\n     Generate README.md content from main index.md\n     \"\"\"\n-    typer.echo(\"Generating README\")\n     readme_path = Path(\"README.md\")\n+    old_content = readme_path.read_text()\n     new_content = generate_readme_content()\n-    readme_path.write_text(new_content, encoding=\"utf-8\")\n-\n-\n-@app.command()\n-def verify_readme() -> None:\n-    \"\"\"\n-    Verify README.md content from main index.md\n-    \"\"\"\n-    typer.echo(\"Verifying README\")\n-    readme_path = Path(\"README.md\")\n-    generated_content = generate_readme_content()\n-    readme_content = readme_path.read_text(\"utf-8\")\n-    if generated_content != readme_content:\n-        typer.secho(\n-            \"README.md outdated from the latest index.md\", color=typer.colors.RED\n-        )\n-        raise typer.Abort()\n-    typer.echo(\"Valid README ‚úÖ\")\n+    if new_content != old_content:\n+        print(\"README.md outdated from the latest index.md\")\n+        print(\"Updating README.md\")\n+        readme_path.write_text(new_content, encoding=\"utf-8\")\n+        raise typer.Exit(1)\n+    print(\"README.md is up to date ‚úÖ\")\n \n \n @app.command()\n@@ -280,7 +274,17 @@ def update_languages() -> None:\n     \"\"\"\n     Update the mkdocs.yml file Languages section including all the available languages.\n     \"\"\"\n-    update_config()\n+    old_config = get_en_config()\n+    updated_config = get_updated_config_content()\n+    if old_config != updated_config:\n+        print(\"docs/en/mkdocs.yml outdated\")\n+        print(\"Updating docs/en/mkdocs.yml\")\n+        en_config_path.write_text(\n+            yaml.dump(updated_config, sort_keys=False, width=200, allow_unicode=True),\n+            encoding=\"utf-8\",\n+        )\n+        raise typer.Exit(1)\n+    print(\"docs/en/mkdocs.yml is up to date ‚úÖ\")\n \n \n @app.command()\n@@ -367,39 +371,12 @@ def get_updated_config_content() -> dict[str, Any]:\n     return config\n \n \n-def update_config() -> None:\n-    config = get_updated_config_content()\n-    en_config_path.write_text(\n-        yaml.dump(config, sort_keys=False, width=200, allow_unicode=True),\n-        encoding=\"utf-8\",\n-    )\n-\n-\n @app.command()\n-def verify_config() -> None:\n+def ensure_non_translated() -> None:\n     \"\"\"\n-    Verify main mkdocs.yml content to make sure it uses the latest language names.\n+    Ensure there are no files in the non translatable pages.\n     \"\"\"\n-    typer.echo(\"Verifying mkdocs.yml\")\n-    config = get_en_config()\n-    updated_config = get_updated_config_content()\n-    if config != updated_config:\n-        typer.secho(\n-            \"docs/en/mkdocs.yml outdated from docs/language_names.yml, \"\n-            \"update language_names.yml and run \"\n-            \"python ./scripts/docs.py update-languages\",\n-            color=typer.colors.RED,\n-        )\n-  \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 558}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -60,8 +60,6 @@ jobs:\n             pyproject.toml\n       - name: Install docs extras\n         run: uv pip install -r requirements-docs.txt\n-      - name: Verify Docs\n-        run: python ./scripts/docs.py verify-docs\n       - name: Export Language Codes\n         id: show-langs\n         run: |\n\n```\n\n```diff\n@@ -21,10 +21,28 @@ repos:\n       - id: ruff-format\n   - repo: local\n     hooks:\n-      - id: local-script\n+      - id: add-permalinks-pages\n         language: unsupported\n-        name: local script\n+        name: add-permalinks-pages\n         entry: uv run ./scripts/docs.py add-permalinks-pages\n         args:\n           - --update-existing\n         files: ^docs/en/docs/.*\\.md$\n+      - id: generate-readme\n+        language: unsupported\n+        name: generate README.md from index.md\n+        entry: uv run ./scripts/docs.py generate-readme\n+        files: ^docs/en/docs/index\\.md|docs/en/data/sponsors\\.yml|scripts/docs\\.py$\n+        pass_filenames: false\n+      - id: update-languages\n+        language: unsupported\n+        name: update languages\n+        entry: uv run ./scripts/docs.py update-languages\n+        files: ^docs/.*|scripts/docs\\.py$\n+        pass_filenames: false\n+      - id: ensure-non-translated\n+        language: unsupported\n+        name: ensure non-translated files are not modified\n+        entry: uv run ./scripts/docs.py ensure-non-translated\n+        files: ^docs/(?!en/).*|^scripts/docs\\.py$\n+        pass_filenames: false\n\n```\n\n```diff\n@@ -19,7 +19,13 @@\n \n logging.basicConfig(level=logging.INFO)\n \n-SUPPORTED_LANGS = {\"en\", \"de\", \"es\", \"pt\", \"ru\"}\n+SUPPORTED_LANGS = {\n+    \"en\",\n+    \"de\",\n+    \"es\",\n+    \"pt\",\n+    \"ru\",\n+}\n \n \n app = typer.Typer()\n@@ -232,27 +238,15 @@ def generate_readme() -> None:\n     \"\"\"\n     Generate README.md content from main index.md\n     \"\"\"\n-    typer.echo(\"Generating README\")\n     readme_path = Path(\"README.md\")\n+    old_content = readme_path.read_text()\n     new_content = generate_readme_content()\n-    readme_path.write_text(new_content, encoding=\"utf-8\")\n-\n-\n-@app.command()\n-def verify_readme() -> None:\n-    \"\"\"\n-    Verify README.md content from main index.md\n-    \"\"\"\n-    typer.echo(\"Verifying README\")\n-    readme_path = Path(\"README.md\")\n-    generated_content = generate_readme_content()\n-    readme_content = readme_path.read_text(\"utf-8\")\n-    if generated_content != readme_content:\n-        typer.secho(\n-            \"README.md outdated from the latest index.md\", color=typer.colors.RED\n-        )\n-        raise typer.Abort()\n-    typer.echo(\"Valid README ‚úÖ\")\n+    if new_content != old_content:\n+        print(\"README.md outdated from the latest index.md\")\n+        print(\"Updating README.md\")\n+        readme_path.write_text(new_content, encoding=\"utf-8\")\n+        raise typer.Exit(1)\n+    print(\"README.md is up to date ‚úÖ\")\n \n \n @app.command()\n@@ -280,7 +274,17 @@ def update_languages() -> None:\n     \"\"\"\n     Update the mkdocs.yml file Languages section including all the available languages.\n     \"\"\"\n-    update_config()\n+    old_config = get_en_config()\n+    updated_config = get_updated_config_content()\n+    if old_config != updated_config:\n+        print(\"docs/en/mkdocs.yml outdated\")\n+        print(\"Updating docs/en/mkdocs.yml\")\n+        en_config_path.write_text(\n+            yaml.dump(updated_config, sort_keys=False, width=200, allow_unicode=True),\n+            encoding=\"utf-8\",\n+        )\n+        raise typer.Exit(1)\n+    print(\"docs/en/mkdocs.yml is up to date ‚úÖ\")\n \n \n @app.command()\n@@ -367,39 +371,12 @@ def get_updated_config_content() -> dict[str, Any]:\n     return config\n \n \n-def update_config() -> None:\n-    config = get_updated_config_content()\n-    en_config_path.write_text(\n-        yaml.dump(config, sort_keys=False, width=200, allow_unicode=True),\n-        encoding=\"utf-8\",\n-    )\n-\n-\n @app.command()\n-def verify_config() -> None:\n+def ensure_non_translated() -> None:\n     \"\"\"\n-    Verify main mkdocs.yml content to make sure it uses the latest langua", "output": "Bug: üî® Update scripts and pre-commit to autofix files\n\nüî® Update scripts and pre-commit to autofix files", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 558}
{"instruction": "Review the following code changes: üî® Update scripts and pre-commit to autofix files", "input": "```diff\n@@ -60,8 +60,6 @@ jobs:\n             pyproject.toml\n       - name: Install docs extras\n         run: uv pip install -r requirements-docs.txt\n-      - name: Verify Docs\n-        run: python ./scripts/docs.py verify-docs\n       - name: Export Language Codes\n         id: show-langs\n         run: |\n\n```\n\n```diff\n@@ -21,10 +21,28 @@ repos:\n       - id: ruff-format\n   - repo: local\n     hooks:\n-      - id: local-script\n+      - id: add-permalinks-pages\n         language: unsupported\n-        name: local script\n+        name: add-permalinks-pages\n         entry: uv run ./scripts/docs.py add-permalinks-pages\n         args:\n           - --update-existing\n         files: ^docs/en/docs/.*\\.md$\n+      - id: generate-readme\n+        language: unsupported\n+        name: generate README.md from index.md\n+        entry: uv run ./scripts/docs.py generate-readme\n+        files: ^docs/en/docs/index\\.md|docs/en/data/sponsors\\.yml|scripts/docs\\.py$\n+        pass_filenames: false\n+      - id: update-languages\n+        language: unsupported\n+        name: update languages\n+        entry: uv run ./scripts/docs.py update-languages\n+        files: ^docs/.*|scripts/docs\\.py$\n+        pass_filenames: false\n+      - id: ensure-non-translated\n+        language: unsupported\n+        name: ensure non-translated files are not modified\n+        entry: uv run ./scripts/docs.py ensure-non-translated\n+        files: ^docs/(?!en/).*|^scripts/docs\\.py$\n+        pass_filenames: false\n\n```\n\n```diff\n@@ -19,7 +19,13 @@\n \n logging.basicConfig(level=logging.INFO)\n \n-SUPPORTED_LANGS = {\"en\", \"de\", \"es\", \"pt\", \"ru\"}\n+SUPPORTED_LANGS = {\n+    \"en\",\n+    \"de\",\n+    \"es\",\n+    \"pt\",\n+    \"ru\",\n+}\n \n \n app = typer.Typer()\n@@ -232,27 +238,15 @@ def generate_readme() -> None:\n     \"\"\"\n     Generate README.md content from main index.md\n     \"\"\"\n-    typer.echo(\"Generating README\")\n     readme_path = Path(\"README.md\")\n+    old_content = readme_path.read_text()\n     new_content = generate_readme_content()\n-    readme_path.write_text(new_content, encoding=\"utf-8\")\n-\n-\n-@app.command()\n-def verify_readme() -> None:\n-    \"\"\"\n-    Verify README.md content from main index.md\n-    \"\"\"\n-    typer.echo(\"Verifying README\")\n-    readme_path = Path(\"README.md\")\n-    generated_content = generate_readme_content()\n-    readme_content = readme_path.read_text(\"utf-8\")\n-    if generated_content != readme_content:\n-        typer.secho(\n-            \"README.md outdated from the latest index.md\", color=typer.colors.RED\n-        )\n-        raise typer.Abort()\n-    typer.echo(\"Valid README ‚úÖ\")\n+    if new_content != old_content:\n+        print(\"README.md outdated from the latest index.md\")\n+        print(\"Updating README.md\")\n+        readme_path.write_text(new_content, encoding=\"utf-8\")\n+        raise typer.Exit(1)\n+    print(\"README.md is up to date ‚úÖ\")\n \n \n @app.command()\n@@ -280,7 +274,17 @@ def update_languages() -> None:\n     \"\"\"\n     Update the mkdocs.yml file Languages section including all the available languages.\n     \"\"\"\n-    update_config()\n+    old_config = get_en_config()\n+    updated_config = get_updated_config_content()\n+    if old_config != updated_config:\n+        print(\"docs/en/mkdocs.yml outdated\")\n+        print(\"Updating docs/en/mkdocs.yml\")\n+        en_config_path.write_text(\n+            yaml.dump(updated_config, sort_keys=False, width=200, allow_unicode=True),\n+            encoding=\"utf-8\",\n+        )\n+        raise typer.Exit(1)\n+    print(\"docs/en/mkdocs.yml is up to date ‚úÖ\")\n \n \n @app.command()\n@@ -367,39 +371,12 @@ def get_updated_config_content() -> dict[str, Any]:\n     return config\n \n \n-def update_config() -> None:\n-    config = get_updated_config_content()\n-    en_config_path.write_text(\n-        yaml.dump(config, sort_keys=False, width=200, allow_unicode=True),\n-        encoding=\"utf-8\",\n-    )\n-\n-\n @app.command()\n-def verify_config() -> None:\n+def ensure_non_translated() -> None:\n     \"\"\"\n-    Verify main mkdocs.yml content to make sure it uses the latest language names.\n+    Ensure there are no files in the non translatable pages.\n     \"\"\"\n-    typer.echo(\"Verifying mkdocs.yml\")\n-    config = get_en_config()\n-    updated_config = get_updated_config_content()\n-    if config != updated_config:\n-        typer.secho(\n-            \"docs/en/mkdocs.yml outdated from docs/language_names.yml, \"\n-            \"update language_names.yml and run \"\n-            \"python ./scripts/docs.py update-languages\",\n-            color=typer.colors.RED,\n-        )\n-  \n\n```", "output": "Changes look good. This PR implements: üî® Update scripts and pre-commit to autofix files", "source": "pr", "type": "code_review", "pr_number": 558}
{"instruction": "Review the following code changes: Update tutorials pydantic v1 to v2", "input": "```diff\n@@ -16,7 +16,7 @@ class Item(BaseModel):\n \n @app.post(\"/items/\")\n async def create_item(item: Item):\n-    item_dict = item.dict()\n+    item_dict = item.model_dump()\n     if item.tax:\n         price_with_tax = item.price + item.tax\n         item_dict.update({\"price_with_tax\": price_with_tax})\n\n```\n\n```diff\n@@ -14,7 +14,7 @@ class Item(BaseModel):\n \n @app.post(\"/items/\")\n async def create_item(item: Item):\n-    item_dict = item.dict()\n+    item_dict = item.model_dump()\n     if item.tax:\n         price_with_tax = item.price + item.tax\n         item_dict.update({\"price_with_tax\": price_with_tax})\n\n```\n\n```diff\n@@ -16,4 +16,4 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item):\n-    return {\"item_id\": item_id, **item.dict()}\n+    return {\"item_id\": item_id, **item.model_dump()}\n\n```\n\n```diff\n@@ -14,4 +14,4 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item):\n-    return {\"item_id\": item_id, **item.dict()}\n+    return {\"item_id\": item_id, **item.model_dump()}\n\n```\n\n```diff\n@@ -16,7 +16,7 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item, q: Union[str, None] = None):\n-    result = {\"item_id\": item_id, **item.dict()}\n+    result = {\"item_id\": item_id, **item.model_dump()}\n     if q:\n         result.update({\"q\": q})\n     return result\n\n```", "output": "Changes look good. This PR implements: Update tutorials pydantic v1 to v2", "source": "pr", "type": "code_review", "pr_number": 557}
{"instruction": "Review the following code changes: üë∑ Run CodSpeed tests in parallel to other tests to speed up CI", "input": "```diff\n@@ -54,10 +54,14 @@ jobs:\n           - os: windows-latest\n             python-version: \"3.12\"\n             coverage: coverage\n-          # Ubuntu with 3.13 needs coverage for CodSpeed benchmarks\n           - os: ubuntu-latest\n             python-version: \"3.13\"\n             coverage: coverage\n+            # Ubuntu with 3.13 needs coverage for CodSpeed benchmarks\n+          - os: ubuntu-latest\n+            python-version: \"3.13\"\n+            coverage: coverage\n+            codspeed: codspeed\n           - os: ubuntu-latest\n             python-version: \"3.14\"\n             coverage: coverage\n@@ -85,12 +89,13 @@ jobs:\n         run: uv pip install -r requirements-tests.txt\n       - run: mkdir coverage\n       - name: Test\n+        if: matrix.codspeed != 'codspeed'\n         run: bash scripts/test.sh\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n       - name: CodSpeed benchmarks\n-        if: matrix.os == 'ubuntu-latest' && matrix.python-version == '3.13'\n+        if: matrix.codspeed == 'codspeed'\n         uses: CodSpeedHQ/action@v4\n         env:\n             COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n\n```", "output": "Changes look good. This PR implements: üë∑ Run CodSpeed tests in parallel to other tests to speed up CI", "source": "pr", "type": "code_review", "pr_number": 556}
{"instruction": "Review the following code changes: Refactor Swagger UI parameter handling in docs.py", "input": "```diff\n@@ -133,22 +133,34 @@ def get_swagger_ui_html(\n     \"\"\"\n \n     for key, value in current_swagger_ui_parameters.items():\n-        html += f\"{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\\n\"\n+        encoded_value = jsonable_encoder(value)\n+        safe_value = json.dumps(encoded_value)\n+\n+        if (\n+            isinstance(value, str)\n+            and safe_value.startswith('\"')\n+            and safe_value.endswith('\"')\n+        ):\n+            safe_value = safe_value[1:-1]  # Remove aspas externas\n+\n+        html += f\"        {key}: {safe_value},\\n\"\n \n     if oauth2_redirect_url:\n-        html += f\"oauth2RedirectUrl: window.location.origin + '{oauth2_redirect_url}',\"\n+        html += (\n+            f\"oauth2RedirectUrl: window.location.origin + '{oauth2_redirect_url}',\\n\"\n+        )\n \n-    html += \"\"\"\n-    presets: [\n-        SwaggerUIBundle.presets.apis,\n-        SwaggerUIBundle.SwaggerUIStandalonePreset\n+    html += \"\"\" presets: [\n+            SwaggerUIBundle.presets.apis,\n+            SwaggerUIBundle.SwaggerUIStandalonePreset\n         ],\n-    })\"\"\"\n+    })\n+    \"\"\"\n \n     if init_oauth:\n+        init_oauth_json = json.dumps(jsonable_encoder(init_oauth))\n         html += f\"\"\"\n-        ui.initOAuth({json.dumps(jsonable_encoder(init_oauth))})\n-        \"\"\"\n+    ui.initOAuth({init_oauth_json})\"\"\"\n \n     html += \"\"\"\n     </script>\n\n```\n\n```diff\n@@ -133,22 +133,34 @@ def get_swagger_ui_html(\n     \"\"\"\n \n     for key, value in current_swagger_ui_parameters.items():\n-        html += f\"{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\\n\"\n+        encoded_value = jsonable_encoder(value)\n+        safe_value = json.dumps(encoded_value)\n+\n+        if (\n+            isinstance(value, str)\n+            and safe_value.startswith('\"')\n+            and safe_value.endswith('\"')\n+        ):\n+            safe_value = safe_value[1:-1]  # Remove aspas externas\n\n```", "output": "Code Review for: Refactor Swagger UI parameter handling in docs.py\n\nüìù **fastapi/openapi/docs.py**: Instead of producing output like:\r\n```javascript\r\n{\"key\": \"value\"}\r\n{\"key\": \"with \\\"quotes\\\"\"}\r\n```\r\nthis change produces output like this:\r\n```javascript\r\n{key: value}\r\n{key: with \\\"quotes\\\"}\r\n```\r\n\r\nThis is just wrong.\n\n", "source": "pr", "type": "code_review", "pr_number": 555}
{"instruction": "Review this code change in `fastapi/openapi/docs.py`", "input": "```diff\n@@ -133,22 +133,34 @@ def get_swagger_ui_html(\n     \"\"\"\n \n     for key, value in current_swagger_ui_parameters.items():\n-        html += f\"{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\\n\"\n+        encoded_value = jsonable_encoder(value)\n+        safe_value = json.dumps(encoded_value)\n+\n+        if (\n+            isinstance(value, str)\n+            and safe_value.startswith('\"')\n+            and safe_value.endswith('\"')\n+        ):\n+            safe_value = safe_value[1:-1]  # Remove aspas externas\n\n```", "output": "Instead of producing output like:\r\n```javascript\r\n{\"key\": \"value\"}\r\n{\"key\": \"with \\\"quotes\\\"\"}\r\n```\r\nthis change produces output like this:\r\n```javascript\r\n{key: value}\r\n{key: with \\\"quotes\\\"}\r\n```\r\n\r\nThis is just wrong.", "source": "pr_review", "type": "inline_review", "pr_number": 555}
{"instruction": "Review the following code changes: Also dump v2 models in `_prepare_response_content`", "input": "```diff\n@@ -58,6 +58,7 @@\n     get_value_or_default,\n     is_body_allowed_for_status_code,\n )\n+from pydantic import BaseModel\n from starlette import routing\n from starlette._exception_handler import wrap_app_handling_exceptions\n from starlette._utils import is_async_callable\n@@ -152,7 +153,7 @@ def _prepare_response_content(\n     exclude_defaults: bool = False,\n     exclude_none: bool = False,\n ) -> Any:\n-    if isinstance(res, may_v1.BaseModel):\n+    if isinstance(res, (may_v1.BaseModel, BaseModel)):\n         read_with_orm_mode = getattr(_get_model_config(res), \"read_with_orm_mode\", None)  # type: ignore[arg-type]\n         if read_with_orm_mode:\n             # Let from_orm extract the data from this model instead of converting\n\n```", "output": "Changes look good. This PR implements: Also dump v2 models in `_prepare_response_content`", "source": "pr", "type": "code_review", "pr_number": 554}
{"instruction": "Review the following code changes: üë∑ Update secrets check", "input": "```diff\n@@ -7,7 +7,8 @@ on:\n       - synchronize\n \n env:\n-  IS_FORK: ${{ github.event.pull_request.head.repo.full_name != github.repository }}\n+  # Forks and Dependabot don't have access to secrets\n+  HAS_SECRETS: ${{ secrets.PRE_COMMIT != '' }}\n \n jobs:\n   pre-commit:\n@@ -19,7 +20,7 @@ jobs:\n         run: echo \"$GITHUB_CONTEXT\"\n       - uses: actions/checkout@v5\n         name: Checkout PR for own repo\n-        if: env.IS_FORK == 'false'\n+        if: env.HAS_SECRETS == 'true'\n         with:\n           # To be able to commit it needs to fetch the head of the branch, not the\n           # merge commit\n@@ -31,7 +32,7 @@ jobs:\n       # pre-commit lite ci needs the default checkout configs to work\n       - uses: actions/checkout@v5\n         name: Checkout PR for fork\n-        if: env.IS_FORK == 'true'\n+        if: env.HAS_SECRETS == 'false'\n         with:\n         # To be able to commit it needs the head branch of the PR, the remote one\n           ref: ${{ github.event.pull_request.head.sha }}\n@@ -56,7 +57,7 @@ jobs:\n         run: uvx prek run --from-ref origin/${GITHUB_BASE_REF} --to-ref HEAD --show-diff-on-failure\n         continue-on-error: true\n       - name: Commit and push changes\n-        if: env.IS_FORK == 'false'\n+        if: env.HAS_SECRETS == 'true'\n         run: |\n           git config user.name \"github-actions[bot]\"\n           git config user.email \"github-actions[bot]@users.noreply.github.com\"\n@@ -68,7 +69,7 @@ jobs:\n             git push\n           fi\n       - uses: pre-commit-ci/lite-action@v1.1.0\n-        if: env.IS_FORK == 'true'\n+        if: env.HAS_SECRETS == 'false'\n         with:\n           msg: üé® Auto format\n       - name: Error out on pre-commit errors\n\n```", "output": "Changes look good. This PR implements: üë∑ Update secrets check", "source": "pr", "type": "code_review", "pr_number": 553}
{"instruction": "Review the following code changes: Improve quote formatting and language clarity", "input": "```diff\n@@ -35,19 +35,24 @@ See section `### Content of code snippets` in the general prompt in `scripts/tra\n \n //// tab | Test\n \n-Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\".\n+Yesterday, my friend wrote:\n+‚ÄúIf you spell incorrectly correctly, then you have spelled it incorrectly.‚Äù\n \n-/// note\n+I replied:\n+‚ÄúThat is correct, but the word incorrectly is spelled incorrectly if it is written as ‚Äò\"incorrectly\"‚Äô.‚Äù\n \n-The LLM will probably translate this wrong. Interesting is only if it keeps the fixed translation when retranslating.\n+/// note\n+A language model might translate this incorrectly.\n+It is only interesting if the model keeps the corrected version unchanged when translating it again.\n \n ///\n \n ////\n \n //// tab | Info\n \n-The prompt designer may choose if they want to convert neutral quotes to typographic quotes. It is okay to leave them as is.\n+The prompt designer can decide whether to convert straight (neutral) quotation marks into typographic (curly) quotes.\n+It is also acceptable to leave the quotation marks as they are.\n \n See for example section `### Quotes` in `docs/de/llm-prompt.md`.\n \n\n```", "output": "Changes look good. This PR implements: Improve quote formatting and language clarity", "source": "pr", "type": "code_review", "pr_number": 552}
{"instruction": "Fix the following bug: Fix broken anchor link in Japanese Docker deployment docs", "input": "", "output": "```diff\n@@ -8,7 +8,6 @@ Linux„Ç≥„É≥„ÉÜ„Éä„ÅÆ‰ΩøÁî®„Å´„ÅØ„ÄÅ**„Çª„Ç≠„É•„É™„ÉÜ„Ç£**„ÄÅ**ÂèçÂæ©ÂèØËÉΩÊÄßÔºà\n \n /// tip\n \n-TODO: „Å™„Åú„ÅãÈÅ∑Áßª„Åß„Åç„Å™„ÅÑ\n „ÅäÊÄ•„Åé„Åß„ÄÅ„Åô„Åß„Å´„Åì„Çå„Çâ„ÅÆÊÉÖÂ†±„Çí„ÅîÂ≠ò„Åò„Åß„Åô„ÅãÔºü [‰ª•‰∏ã„ÅÆ`Dockerfile`„ÅÆÁÆáÊâÄüëá](#build-a-docker-image-for-fastapi)„Å∏„Ç∏„É£„É≥„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n \n ///\n@@ -100,7 +99,7 @@ Docker Hub„ÅØ Â§ö„Åè„ÅÆ„ÉÑ„Éº„É´„ÇÑÁí∞Â¢É„ÄÅ„Éá„Éº„Çø„Éô„Éº„Çπ„ÄÅ„Ç¢„Éó„É™„Ç±„Éº\n \n „Åó„Åã„Åó„ÄÅ**Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆÂÆüË°å‰∏≠„ÅÆ„Éó„É≠„Çª„Çπ**„Åå„Å™„Åë„Çå„Å∞„ÄÅÂÆüË°å‰∏≠„ÅÆ„Ç≥„É≥„ÉÜ„Éä„ÇíÊåÅ„Å§„Åì„Å®„ÅØ„Åß„Åç„Å™„ÅÑ„Åß„Åô„ÄÇ„É°„Ç§„É≥„Éª„Éó„É≠„Çª„Çπ„ÅåÂÅúÊ≠¢„Åô„Çå„Å∞„ÄÅ„Ç≥„É≥„ÉÜ„Éä„ÇÇÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n \n-## Build a Docker Image for FastAPI\n+## Build a Docker Image for FastAPI { #build-a-docker-image-for-fastapi }\n \n „Å®„ÅÑ„ÅÜ„Åì„Å®„Åß„ÄÅ‰Ωï„Åã‰Ωú„Çä„Åæ„Åó„Çá„ÅÜÔºÅüöÄ\n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 551}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -8,7 +8,6 @@ Linux„Ç≥„É≥„ÉÜ„Éä„ÅÆ‰ΩøÁî®„Å´„ÅØ„ÄÅ**„Çª„Ç≠„É•„É™„ÉÜ„Ç£**„ÄÅ**ÂèçÂæ©ÂèØËÉΩÊÄßÔºà\n \n /// tip\n \n-TODO: „Å™„Åú„ÅãÈÅ∑Áßª„Åß„Åç„Å™„ÅÑ\n „ÅäÊÄ•„Åé„Åß„ÄÅ„Åô„Åß„Å´„Åì„Çå„Çâ„ÅÆÊÉÖÂ†±„Çí„ÅîÂ≠ò„Åò„Åß„Åô„ÅãÔºü [‰ª•‰∏ã„ÅÆ`Dockerfile`„ÅÆÁÆáÊâÄüëá](#build-a-docker-image-for-fastapi)„Å∏„Ç∏„É£„É≥„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n \n ///\n@@ -100,7 +99,7 @@ Docker Hub„ÅØ Â§ö„Åè„ÅÆ„ÉÑ„Éº„É´„ÇÑÁí∞Â¢É„ÄÅ„Éá„Éº„Çø„Éô„Éº„Çπ„ÄÅ„Ç¢„Éó„É™„Ç±„Éº\n \n „Åó„Åã„Åó„ÄÅ**Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆÂÆüË°å‰∏≠„ÅÆ„Éó„É≠„Çª„Çπ**„Åå„Å™„Åë„Çå„Å∞„ÄÅÂÆüË°å‰∏≠„ÅÆ„Ç≥„É≥„ÉÜ„Éä„ÇíÊåÅ„Å§„Åì„Å®„ÅØ„Åß„Åç„Å™„ÅÑ„Åß„Åô„ÄÇ„É°„Ç§„É≥„Éª„Éó„É≠„Çª„Çπ„ÅåÂÅúÊ≠¢„Åô„Çå„Å∞„ÄÅ„Ç≥„É≥„ÉÜ„Éä„ÇÇÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n \n-## Build a Docker Image for FastAPI\n+## Build a Docker Image for FastAPI { #build-a-docker-image-for-fastapi }\n \n „Å®„ÅÑ„ÅÜ„Åì„Å®„Åß„ÄÅ‰Ωï„Åã‰Ωú„Çä„Åæ„Åó„Çá„ÅÜÔºÅüöÄ\n \n\n```", "output": "Bug: Fix broken anchor link in Japanese Docker deployment docs\n\n", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 551}
{"instruction": "Review the following code changes: Fix broken anchor link in Japanese Docker deployment docs", "input": "```diff\n@@ -8,7 +8,6 @@ Linux„Ç≥„É≥„ÉÜ„Éä„ÅÆ‰ΩøÁî®„Å´„ÅØ„ÄÅ**„Çª„Ç≠„É•„É™„ÉÜ„Ç£**„ÄÅ**ÂèçÂæ©ÂèØËÉΩÊÄßÔºà\n \n /// tip\n \n-TODO: „Å™„Åú„ÅãÈÅ∑Áßª„Åß„Åç„Å™„ÅÑ\n „ÅäÊÄ•„Åé„Åß„ÄÅ„Åô„Åß„Å´„Åì„Çå„Çâ„ÅÆÊÉÖÂ†±„Çí„ÅîÂ≠ò„Åò„Åß„Åô„ÅãÔºü [‰ª•‰∏ã„ÅÆ`Dockerfile`„ÅÆÁÆáÊâÄüëá](#build-a-docker-image-for-fastapi)„Å∏„Ç∏„É£„É≥„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n \n ///\n@@ -100,7 +99,7 @@ Docker Hub„ÅØ Â§ö„Åè„ÅÆ„ÉÑ„Éº„É´„ÇÑÁí∞Â¢É„ÄÅ„Éá„Éº„Çø„Éô„Éº„Çπ„ÄÅ„Ç¢„Éó„É™„Ç±„Éº\n \n „Åó„Åã„Åó„ÄÅ**Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆÂÆüË°å‰∏≠„ÅÆ„Éó„É≠„Çª„Çπ**„Åå„Å™„Åë„Çå„Å∞„ÄÅÂÆüË°å‰∏≠„ÅÆ„Ç≥„É≥„ÉÜ„Éä„ÇíÊåÅ„Å§„Åì„Å®„ÅØ„Åß„Åç„Å™„ÅÑ„Åß„Åô„ÄÇ„É°„Ç§„É≥„Éª„Éó„É≠„Çª„Çπ„ÅåÂÅúÊ≠¢„Åô„Çå„Å∞„ÄÅ„Ç≥„É≥„ÉÜ„Éä„ÇÇÂÅúÊ≠¢„Åó„Åæ„Åô„ÄÇ\n \n-## Build a Docker Image for FastAPI\n+## Build a Docker Image for FastAPI { #build-a-docker-image-for-fastapi }\n \n „Å®„ÅÑ„ÅÜ„Åì„Å®„Åß„ÄÅ‰Ωï„Åã‰Ωú„Çä„Åæ„Åó„Çá„ÅÜÔºÅüöÄ\n \n\n```", "output": "Changes look good. This PR implements: Fix broken anchor link in Japanese Docker deployment docs", "source": "pr", "type": "code_review", "pr_number": 551}
{"instruction": "Fix the following bug: Fix endpoint context cache to avoid leaks and stale IDs", "input": "- Problem: __endpoint_context_cache used id(func)_ and never evicted. In long‚Äërunning or\r\n    hot‚Äëreload setups this can leak memory and, if an id is reused, report stale file/line/\r\n    function info.\r\n  - Fix: Use WeakKeyDictionary keyed by the callable itself, and skip caching for\r\n    non‚Äëweakrefable callables.\r\n  - Test: Added a GC-based test to ensure cache entries are released after endpoints are\r\n    garbage collected.\r\n\r\n  Tests\r\n  - bash scripts/test-cov-html.sh", "output": "```diff\n@@ -20,6 +20,7 @@\n     Optional,\n     Union,\n )\n+from weakref import WeakKeyDictionary\n \n from annotated_doc import Doc\n from fastapi import params, temp_pydantic_v1_params\n@@ -212,15 +213,17 @@ async def merged_lifespan(\n \n \n # Cache for endpoint context to avoid re-extracting on every request\n-_endpoint_context_cache: dict[int, EndpointContext] = {}\n+_endpoint_context_cache: WeakKeyDictionary[Any, EndpointContext] = WeakKeyDictionary()\n \n \n def _extract_endpoint_context(func: Any) -> EndpointContext:\n     \"\"\"Extract endpoint context with caching to avoid repeated file I/O.\"\"\"\n-    func_id = id(func)\n-\n-    if func_id in _endpoint_context_cache:\n-        return _endpoint_context_cache[func_id]\n+    try:\n+        cached = _endpoint_context_cache.get(func)\n+    except TypeError:\n+        cached = None\n+    if cached is not None:\n+        return cached\n \n     try:\n         ctx: EndpointContext = {}\n@@ -234,7 +237,10 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n     except Exception:\n         ctx = EndpointContext()\n \n-    _endpoint_context_cache[func_id] = ctx\n+    try:\n+        _endpoint_context_cache[func] = ctx\n+    except TypeError:\n+        pass\n     return ctx\n \n \n\n```\n\n```diff\n@@ -0,0 +1,25 @@\n+import gc\n+import weakref\n+\n+from fastapi.routing import _endpoint_context_cache, _extract_endpoint_context\n+\n+\n+def _make_endpoint():\n+    def endpoint():\n+        return None\n+\n+    return endpoint\n+\n+\n+def test_endpoint_context_cache_releases_endpoints():\n+    endpoint = _make_endpoint()\n+    _extract_endpoint_context(endpoint)\n+    assert endpoint in _endpoint_context_cache\n+\n+    ref = weakref.ref(endpoint)\n+    size_with_endpoint = len(_endpoint_context_cache)\n+    del endpoint\n+    gc.collect()\n+\n+    assert ref() is None\n+    assert len(_endpoint_context_cache) <= size_with_endpoint - 1\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 550}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -20,6 +20,7 @@\n     Optional,\n     Union,\n )\n+from weakref import WeakKeyDictionary\n \n from annotated_doc import Doc\n from fastapi import params, temp_pydantic_v1_params\n@@ -212,15 +213,17 @@ async def merged_lifespan(\n \n \n # Cache for endpoint context to avoid re-extracting on every request\n-_endpoint_context_cache: dict[int, EndpointContext] = {}\n+_endpoint_context_cache: WeakKeyDictionary[Any, EndpointContext] = WeakKeyDictionary()\n \n \n def _extract_endpoint_context(func: Any) -> EndpointContext:\n     \"\"\"Extract endpoint context with caching to avoid repeated file I/O.\"\"\"\n-    func_id = id(func)\n-\n-    if func_id in _endpoint_context_cache:\n-        return _endpoint_context_cache[func_id]\n+    try:\n+        cached = _endpoint_context_cache.get(func)\n+    except TypeError:\n+        cached = None\n+    if cached is not None:\n+        return cached\n \n     try:\n         ctx: EndpointContext = {}\n@@ -234,7 +237,10 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n     except Exception:\n         ctx = EndpointContext()\n \n-    _endpoint_context_cache[func_id] = ctx\n+    try:\n+        _endpoint_context_cache[func] = ctx\n+    except TypeError:\n+        pass\n     return ctx\n \n \n\n```\n\n```diff\n@@ -0,0 +1,25 @@\n+import gc\n+import weakref\n+\n+from fastapi.routing import _endpoint_context_cache, _extract_endpoint_context\n+\n+\n+def _make_endpoint():\n+    def endpoint():\n+        return None\n+\n+    return endpoint\n+\n+\n+def test_endpoint_context_cache_releases_endpoints():\n+    endpoint = _make_endpoint()\n+    _extract_endpoint_context(endpoint)\n+    assert endpoint in _endpoint_context_cache\n+\n+    ref = weakref.ref(endpoint)\n+    size_with_endpoint = len(_endpoint_context_cache)\n+    del endpoint\n+    gc.collect()\n+\n+    assert ref() is None\n+    assert len(_endpoint_context_cache) <= size_with_endpoint - 1\n\n```", "output": "Bug: Fix endpoint context cache to avoid leaks and stale IDs\n\n- Problem: __endpoint_context_cache used id(func)_ and never evicted. In long‚Äërunning or\r\n    hot‚Äëreload setups this can leak memory and, if an id is reused, report stale file/line/\r\n    function info.\r\n  - Fix: Use WeakKeyDictionary keyed by the callable itself, and skip caching for\r\n    non‚Äëweakrefable callables.\r\n  - Test: Added a GC-based test to ensure cache entries are released after endpoints are\r\n    garbage collected.\r\n\r\n  Tests\r\n  - bash scripts/test-cov-html.sh", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 550}
{"instruction": "Review the following code changes: Fix endpoint context cache to avoid leaks and stale IDs", "input": "```diff\n@@ -20,6 +20,7 @@\n     Optional,\n     Union,\n )\n+from weakref import WeakKeyDictionary\n \n from annotated_doc import Doc\n from fastapi import params, temp_pydantic_v1_params\n@@ -212,15 +213,17 @@ async def merged_lifespan(\n \n \n # Cache for endpoint context to avoid re-extracting on every request\n-_endpoint_context_cache: dict[int, EndpointContext] = {}\n+_endpoint_context_cache: WeakKeyDictionary[Any, EndpointContext] = WeakKeyDictionary()\n \n \n def _extract_endpoint_context(func: Any) -> EndpointContext:\n     \"\"\"Extract endpoint context with caching to avoid repeated file I/O.\"\"\"\n-    func_id = id(func)\n-\n-    if func_id in _endpoint_context_cache:\n-        return _endpoint_context_cache[func_id]\n+    try:\n+        cached = _endpoint_context_cache.get(func)\n+    except TypeError:\n+        cached = None\n+    if cached is not None:\n+        return cached\n \n     try:\n         ctx: EndpointContext = {}\n@@ -234,7 +237,10 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n     except Exception:\n         ctx = EndpointContext()\n \n-    _endpoint_context_cache[func_id] = ctx\n+    try:\n+        _endpoint_context_cache[func] = ctx\n+    except TypeError:\n+        pass\n     return ctx\n \n \n\n```\n\n```diff\n@@ -0,0 +1,25 @@\n+import gc\n+import weakref\n+\n+from fastapi.routing import _endpoint_context_cache, _extract_endpoint_context\n+\n+\n+def _make_endpoint():\n+    def endpoint():\n+        return None\n+\n+    return endpoint\n+\n+\n+def test_endpoint_context_cache_releases_endpoints():\n+    endpoint = _make_endpoint()\n+    _extract_endpoint_context(endpoint)\n+    assert endpoint in _endpoint_context_cache\n+\n+    ref = weakref.ref(endpoint)\n+    size_with_endpoint = len(_endpoint_context_cache)\n+    del endpoint\n+    gc.collect()\n+\n+    assert ref() is None\n+    assert len(_endpoint_context_cache) <= size_with_endpoint - 1\n\n```", "output": "Changes look good. This PR implements: Fix endpoint context cache to avoid leaks and stale IDs", "source": "pr", "type": "code_review", "pr_number": 550}
{"instruction": "Review the following code changes: Update .gitignore commands in virtual-environments.md", "input": "```diff\n@@ -261,7 +261,7 @@ Do this **once**, right after you create the virtual environment.\n <div class=\"termy\">\n \n \n```", "output": "Changes look good. This PR implements: Update .gitignore commands in virtual-environments.md", "source": "pr", "type": "code_review", "pr_number": 549}
{"instruction": "Review the following code changes: Update v2.py", "input": "```diff\n@@ -262,7 +262,18 @@ def _replace_refs(\n     new_schema = deepcopy(schema)\n     for key, value in new_schema.items():\n         if key == \"$ref\":\n-            ref_name = schema[\"$ref\"].split(\"/\")[-1]\n+            print(f\"schema:{schema}\")\n+            # ref_name = schema[\"$ref\"].split(\"/\")[-1]\n+            ref_name = schema[\"$ref\"]\n+            if isinstance(ref_value, str):\n+                # Normal case\n+                ref_name = ref_value.split(\"/\")[-1]\n+            elif isinstance(ref_value, dict):\n+                # Handle dict case\n+                ref_name = ref_value.get(\"title\") or \"unknown_ref\"\n+            else:\n+                # Unexpected type\n+                ref_name = \"invalid_ref\"\n             if ref_name in old_name_to_new_name_map:\n                 new_name = old_name_to_new_name_map[ref_name]\n                 new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n\n```", "output": "Changes look good. This PR implements: Update v2.py", "source": "pr", "type": "code_review", "pr_number": 548}
{"instruction": "Fix the following bug: üêõ Fix handling of JSON Schema attributes named \"$ref\"", "input": "Fix handling of JSON Schema attributes named \"$ref\"\r\n\r\nRelated to: https://github.com/fastapi/fastapi/issues/14344", "output": "```diff\n@@ -262,12 +262,12 @@ def _replace_refs(\n     new_schema = deepcopy(schema)\n     for key, value in new_schema.items():\n         if key == \"$ref\":\n-            ref_name = schema[\"$ref\"].split(\"/\")[-1]\n-            if ref_name in old_name_to_new_name_map:\n-                new_name = old_name_to_new_name_map[ref_name]\n-                new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n-            else:\n-                new_schema[\"$ref\"] = schema[\"$ref\"]\n+            value = schema[\"$ref\"]\n+            if isinstance(value, str):\n+                ref_name = schema[\"$ref\"].split(\"/\")[-1]\n+                if ref_name in old_name_to_new_name_map:\n+                    new_name = old_name_to_new_name_map[ref_name]\n+                    new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n             continue\n         if isinstance(value, dict):\n             new_schema[key] = _replace_refs(\n\n```\n\n```diff\n@@ -0,0 +1,72 @@\n+from typing import Any\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel, ConfigDict, Field\n+\n+from tests.utils import needs_pydanticv2\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client():\n+    app = FastAPI()\n+\n+    class ModelWithRef(BaseModel):\n+        ref: str = Field(validation_alias=\"$ref\", serialization_alias=\"$ref\")\n+        model_config = ConfigDict(validate_by_alias=True, serialize_by_alias=True)\n+\n+    @app.get(\"/\", response_model=ModelWithRef)\n+    async def read_root() -> Any:\n+        return {\"$ref\": \"some-ref\"}\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+@needs_pydanticv2\n+def test_get(client: TestClient):\n+    response = client.get(\"/\")\n+    assert response.json() == {\"$ref\": \"some-ref\"}\n+\n+\n+@needs_pydanticv2\n+def test_openapi_schema(client: TestClient):\n+    response = client.get(\"openapi.json\")\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"get\": {\n+                        \"summary\": \"Read Root\",\n+                        \"operationId\": \"read_root__get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/ModelWithRef\"\n+                                        }\n+                                    }\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+                    \"ModelWithRef\": {\n+                        \"properties\": {\"$ref\": {\"type\": \"string\", \"title\": \"$Ref\"}},\n+                        \"type\": \"object\",\n+                        \"required\": [\"$ref\"],\n+                        \"title\": \"ModelWithRef\",\n+                    }\n+                }\n+            },\n+        }\n+    )\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 547}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -262,12 +262,12 @@ def _replace_refs(\n     new_schema = deepcopy(schema)\n     for key, value in new_schema.items():\n         if key == \"$ref\":\n-            ref_name = schema[\"$ref\"].split(\"/\")[-1]\n-            if ref_name in old_name_to_new_name_map:\n-                new_name = old_name_to_new_name_map[ref_name]\n-                new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n-            else:\n-                new_schema[\"$ref\"] = schema[\"$ref\"]\n+            value = schema[\"$ref\"]\n+            if isinstance(value, str):\n+                ref_name = schema[\"$ref\"].split(\"/\")[-1]\n+                if ref_name in old_name_to_new_name_map:\n+                    new_name = old_name_to_new_name_map[ref_name]\n+                    new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n             continue\n         if isinstance(value, dict):\n             new_schema[key] = _replace_refs(\n\n```\n\n```diff\n@@ -0,0 +1,72 @@\n+from typing import Any\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel, ConfigDict, Field\n+\n+from tests.utils import needs_pydanticv2\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client():\n+    app = FastAPI()\n+\n+    class ModelWithRef(BaseModel):\n+        ref: str = Field(validation_alias=\"$ref\", serialization_alias=\"$ref\")\n+        model_config = ConfigDict(validate_by_alias=True, serialize_by_alias=True)\n+\n+    @app.get(\"/\", response_model=ModelWithRef)\n+    async def read_root() -> Any:\n+        return {\"$ref\": \"some-ref\"}\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+@needs_pydanticv2\n+def test_get(client: TestClient):\n+    response = client.get(\"/\")\n+    assert response.json() == {\"$ref\": \"some-ref\"}\n+\n+\n+@needs_pydanticv2\n+def test_openapi_schema(client: TestClient):\n+    response = client.get(\"openapi.json\")\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"get\": {\n+                        \"summary\": \"Read Root\",\n+                        \"operationId\": \"read_root__get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/ModelWithRef\"\n+                                        }\n+                                    }\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+                    \"ModelWithRef\": {\n+                        \"properties\": {\"$ref\": {\"type\": \"string\", \"title\": \"$Ref\"}},\n+                        \"type\": \"object\",\n+                        \"required\": [\"$ref\"],\n+                        \"title\": \"ModelWithRef\",\n+                    }\n+                }\n+            },\n+        }\n+    )\n\n```", "output": "Bug: üêõ Fix handling of JSON Schema attributes named \"$ref\"\n\nFix handling of JSON Schema attributes named \"$ref\"\r\n\r\nRelated to: https://github.com/fastapi/fastapi/issues/14344", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 547}
{"instruction": "Review the following code changes: üêõ Fix handling of JSON Schema attributes named \"$ref\"", "input": "```diff\n@@ -262,12 +262,12 @@ def _replace_refs(\n     new_schema = deepcopy(schema)\n     for key, value in new_schema.items():\n         if key == \"$ref\":\n-            ref_name = schema[\"$ref\"].split(\"/\")[-1]\n-            if ref_name in old_name_to_new_name_map:\n-                new_name = old_name_to_new_name_map[ref_name]\n-                new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n-            else:\n-                new_schema[\"$ref\"] = schema[\"$ref\"]\n+            value = schema[\"$ref\"]\n+            if isinstance(value, str):\n+                ref_name = schema[\"$ref\"].split(\"/\")[-1]\n+                if ref_name in old_name_to_new_name_map:\n+                    new_name = old_name_to_new_name_map[ref_name]\n+                    new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n             continue\n         if isinstance(value, dict):\n             new_schema[key] = _replace_refs(\n\n```\n\n```diff\n@@ -0,0 +1,72 @@\n+from typing import Any\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel, ConfigDict, Field\n+\n+from tests.utils import needs_pydanticv2\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client():\n+    app = FastAPI()\n+\n+    class ModelWithRef(BaseModel):\n+        ref: str = Field(validation_alias=\"$ref\", serialization_alias=\"$ref\")\n+        model_config = ConfigDict(validate_by_alias=True, serialize_by_alias=True)\n+\n+    @app.get(\"/\", response_model=ModelWithRef)\n+    async def read_root() -> Any:\n+        return {\"$ref\": \"some-ref\"}\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+@needs_pydanticv2\n+def test_get(client: TestClient):\n+    response = client.get(\"/\")\n+    assert response.json() == {\"$ref\": \"some-ref\"}\n+\n+\n+@needs_pydanticv2\n+def test_openapi_schema(client: TestClient):\n+    response = client.get(\"openapi.json\")\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"get\": {\n+                        \"summary\": \"Read Root\",\n+                        \"operationId\": \"read_root__get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/ModelWithRef\"\n+                                        }\n+                                    }\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+                    \"ModelWithRef\": {\n+                        \"properties\": {\"$ref\": {\"type\": \"string\", \"title\": \"$Ref\"}},\n+                        \"type\": \"object\",\n+                        \"required\": [\"$ref\"],\n+                        \"title\": \"ModelWithRef\",\n+                    }\n+                }\n+            },\n+        }\n+    )\n\n```", "output": "Changes look good. This PR implements: üêõ Fix handling of JSON Schema attributes named \"$ref\"", "source": "pr", "type": "code_review", "pr_number": 547}
{"instruction": "Review the following code changes: üîß Upgrade Material for MkDocs and remove insiders", "input": "```diff\n@@ -32,12 +32,9 @@ jobs:\n             - docs/**\n             - docs_src/**\n             - requirements-docs.txt\n-            - requirements-docs-insiders.txt\n             - pyproject.toml\n             - mkdocs.yml\n-            - mkdocs.insiders.yml\n-            - mkdocs.maybe-insiders.yml\n-            - mkdocs.no-insiders.yml\n+            - mkdocs.env.yml\n             - .github/workflows/build-docs.yml\n             - .github/workflows/deploy-docs.yml\n             - scripts/mkdocs_hooks.py\n@@ -63,12 +60,6 @@ jobs:\n             pyproject.toml\n       - name: Install docs extras\n         run: uv pip install -r requirements-docs.txt\n-      # Install MkDocs Material Insiders here just to put it in the cache for the rest of the steps\n-      - name: Install Material for MkDocs Insiders\n-        if: ( github.event_name != 'pull_request' || github.secret_source == 'Actions' )\n-        run: uv pip install -r requirements-docs-insiders.txt\n-        env:\n-          TOKEN: ${{ secrets.FASTAPI_MKDOCS_MATERIAL_INSIDERS }}\n       - name: Verify Docs\n         run: python ./scripts/docs.py verify-docs\n       - name: Export Language Codes\n@@ -105,11 +96,6 @@ jobs:\n             pyproject.toml\n       - name: Install docs extras\n         run: uv pip install -r requirements-docs.txt\n-      - name: Install Material for MkDocs Insiders\n-        if: ( github.event_name != 'pull_request' || github.secret_source == 'Actions' )\n-        run: uv pip install -r requirements-docs-insiders.txt\n-        env:\n-          TOKEN: ${{ secrets.FASTAPI_MKDOCS_MATERIAL_INSIDERS }}\n       - name: Update Languages\n         run: python ./scripts/docs.py update-languages\n       - uses: actions/cache@v4\n\n```\n\n```diff\n@@ -1,6 +1,5 @@\n # Define this here and not in the main mkdocs.yml file because that one is auto\n # updated and written, and the script would remove the env var\n-INHERIT: !ENV [INSIDERS_FILE, '../en/mkdocs.no-insiders.yml']\n markdown_extensions:\n   pymdownx.highlight:\n     linenums: !ENV [LINENUMS, false]\n\n```\n\n```diff\n@@ -1,10 +0,0 @@\n-plugins:\n-  social:\n-    cards_layout_options:\n-      logo: ../en/docs/img/icon-white.svg\n-  typeset:\n-markdown_extensions:\n-  material.extensions.preview:\n-    targets:\n-      include:\n-        - \"*\"\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-INHERIT: ../en/mkdocs.maybe-insiders.yml\n+INHERIT: ../en/mkdocs.env.yml\n site_name: FastAPI\n site_description: FastAPI framework, high performance, easy to learn, fast to code, ready for production\n site_url: https://fastapi.tiangolo.com/\n@@ -52,6 +52,10 @@ theme:\n repo_name: fastapi/fastapi\n repo_url: https://github.com/fastapi/fastapi\n plugins:\n+  social:\n+    cards_layout_options:\n+      logo: ../en/docs/img/icon-white.svg\n+  typeset:\n   search: null\n   macros:\n     include_yaml:\n@@ -253,6 +257,10 @@ nav:\n   - management.md\n - release-notes.md\n markdown_extensions:\n+  material.extensions.preview:\n+    targets:\n+      include:\n+        - \"*\"\n   abbr: null\n   attr_list: null\n   footnotes: null\n\n```\n\n```diff\n@@ -1,3 +0,0 @@\n-git+https://${TOKEN}@github.com/squidfunk/mkdocs-material-insiders.git@9.5.30-insiders-4.53.11\n-git+https://${TOKEN}@github.com/pawamoy-insiders/griffe-typing-deprecated.git\n-git+https://${TOKEN}@github.com/pawamoy-insiders/mkdocstrings-python.git\n\n```", "output": "Changes look good. This PR implements: üîß Upgrade Material for MkDocs and remove insiders", "source": "pr", "type": "code_review", "pr_number": 546}
{"instruction": "Review the following code changes: ‚úÖ Add set of tests for request parameters and alias", "input": "```diff\n@@ -0,0 +1,523 @@\n+from typing import List, Union\n+\n+import pytest\n+from dirty_equals import IsDict, IsOneOf, IsPartialDict\n+from fastapi import Body, FastAPI\n+from fastapi._compat import PYDANTIC_V2\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+from typing_extensions import Annotated\n+\n+from tests.utils import needs_pydanticv2\n+\n+from .utils import get_body_model_name\n+\n+app = FastAPI()\n+\n+# =====================================================================================\n+# Without aliases\n+\n+\n+@app.post(\"/required-list-str\", operation_id=\"required_list_str\")\n+async def read_required_list_str(p: Annotated[List[str], Body(embed=True)]):\n+    return {\"p\": p}\n+\n+\n+class BodyModelRequiredListStr(BaseModel):\n+    p: List[str]\n+\n+\n+@app.post(\"/model-required-list-str\", operation_id=\"model_required_list_str\")\n+def read_model_required_list_str(p: BodyModelRequiredListStr):\n+    return {\"p\": p.p}\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\"/required-list-str\", \"/model-required-list-str\"],\n+)\n+def test_required_list_str_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n+        \"properties\": {\n+            \"p\": {\n+                \"items\": {\"type\": \"string\"},\n+                \"title\": \"P\",\n+                \"type\": \"array\",\n+            },\n+        },\n+        \"required\": [\"p\"],\n+        \"title\": body_model_name,\n+        \"type\": \"object\",\n+    }\n+\n+\n+@pytest.mark.parametrize(\"json\", [None, {}])\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\"/required-list-str\", \"/model-required-list-str\"],\n+)\n+def test_required_list_str_missing(path: str, json: Union[dict, None]):\n+    client = TestClient(app)\n+    response = client.post(path, json=json)\n+    assert response.status_code == 422\n+    assert response.json() == IsDict(\n+        {\n+            \"detail\": [\n+                {\n+                    \"type\": \"missing\",\n+                    \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n+                    \"msg\": \"Field required\",\n+                    \"input\": IsOneOf(None, {}),\n+                }\n+            ]\n+        }\n+    ) | IsDict(\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n+                    \"msg\": \"field required\",\n+                    \"type\": \"value_error.missing\",\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\"/required-list-str\", \"/model-required-list-str\"],\n+)\n+def test_required_list_str(path: str):\n+    client = TestClient(app)\n+    response = client.post(path, json={\"p\": [\"hello\", \"world\"]})\n+    assert response.status_code == 200\n+    assert response.json() == {\"p\": [\"hello\", \"world\"]}\n+\n+\n+# =====================================================================================\n+# Alias\n+\n+\n+@app.post(\"/required-list-alias\", operation_id=\"required_lis\n\n```\n\n```diff\n@@ -0,0 +1,600 @@\n+from typing import List, Optional\n+\n+import pytest\n+from dirty_equals import IsDict\n+from fastapi import Body, FastAPI\n+from fastapi._compat import PYDANTIC_V2\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+from typing_extensions import Annotated\n+\n+from tests.utils import needs_pydanticv2\n+\n+from .utils import get_body_model_name\n+\n+app = FastAPI()\n+\n+# =====================================================================================\n+# Without aliases\n+\n+\n+@app.post(\"/optional-list-str\", operation_id=\"optional_list_str\")\n+async def read_optional_list_str(\n+    p: Annotated[Optional[List[str]], Body(embed=True)] = None,\n+):\n+    return {\"p\": p}\n+\n+\n+class BodyModelOptionalListStr(BaseModel):\n+    p: Optional[List[str]] = None\n+\n+\n+@app.post(\"/model-optional-list-str\", operation_id=\"model_optional_list_str\")\n+async def read_model_optional_list_str(p: BodyModelOptionalListStr):\n+    return {\"p\": p.p}\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\"/optional-list-str\", \"/model-optional-list-str\"],\n+)\n+def test_optional_list_str_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == IsDict(\n+        {\n+            \"properties\": {\n+                \"p\": {\n+                    \"anyOf\": [\n+                        {\"items\": {\"type\": \"string\"}, \"type\": \"array\"},\n+                        {\"type\": \"null\"},\n+                    ],\n+                    \"title\": \"P\",\n+                },\n+            },\n+            \"title\": body_model_name,\n+            \"type\": \"object\",\n+        }\n+    ) | IsDict(\n+        # TODO: remove when deprecating Pydantic v1\n+        {\n+            \"properties\": {\n+                \"p\": {\"items\": {\"type\": \"string\"}, \"type\": \"array\", \"title\": \"P\"},\n+            },\n+            \"title\": body_model_name,\n+            \"type\": \"object\",\n+        }\n+    )\n", "output": "Changes look good. This PR implements: ‚úÖ Add set of tests for request parameters and alias", "source": "pr", "type": "code_review", "pr_number": 545}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Make the result of `Depends()` and `Security()` hashable, as a workaround for other tools interacting with these internal parts", "input": "```diff\n@@ -1,3 +1,4 @@\n+import dataclasses\n import inspect\n from contextlib import AsyncExitStack, contextmanager\n from copy import copy, deepcopy\n@@ -428,7 +429,7 @@ def analyze_param(\n     if depends is not None and depends.dependency is None:\n         # Copy `depends` before mutating it\n         depends = copy(depends)\n-        depends.dependency = type_annotation\n+        depends = dataclasses.replace(depends, dependency=type_annotation)\n \n     # Handle non-param type annotations like Request\n     if lenient_issubclass(\n\n```\n\n```diff\n@@ -762,13 +762,13 @@ def __init__(\n         )\n \n \n-@dataclass\n+@dataclass(frozen=True)\n class Depends:\n     dependency: Optional[Callable[..., Any]] = None\n     use_cache: bool = True\n     scope: Union[Literal[\"function\", \"request\"], None] = None\n \n \n-@dataclass\n+@dataclass(frozen=True)\n class Security(Depends):\n     scopes: Optional[Sequence[str]] = None\n\n```\n\n```diff\n@@ -0,0 +1,25 @@\n+# This is more or less a workaround to make Depends and Security hashable\n+# as other tools that use them depend on that\n+# Ref: https://github.com/fastapi/fastapi/pull/14320\n+\n+from fastapi import Depends, Security\n+\n+\n+def dep():\n+    pass\n+\n+\n+def test_depends_hashable():\n+    dep()  # just for coverage\n+    d1 = Depends(dep)\n+    d2 = Depends(dep)\n+    d3 = Depends(dep, scope=\"function\")\n+    d4 = Depends(dep, scope=\"function\")\n+\n+    s1 = Security(dep)\n+    s2 = Security(dep)\n+\n+    assert hash(d1) == hash(d2)\n+    assert hash(s1) == hash(s2)\n+    assert hash(d1) != hash(d3)\n+    assert hash(d3) == hash(d4)\n\n```", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Make the result of `Depends()` and `Security()` hashable, as a workaround for other tools interacting with these internal parts", "source": "pr", "type": "code_review", "pr_number": 544}
{"instruction": "Review the following code changes: Replace `applications.py` asserts with if...raise", "input": "```diff\n@@ -908,8 +908,12 @@ class Item(BaseModel):\n         ] = \"3.1.0\"\n         self.openapi_schema: Optional[Dict[str, Any]] = None\n         if self.openapi_url:\n-            assert self.title, \"A title must be provided for OpenAPI, e.g.: 'My API'\"\n-            assert self.version, \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+            if not self.title:\n+                raise ValueError(\"A title must be provided for OpenAPI, e.g.: 'My API'\")\n+            if not self.version:\n+                raise ValueError(\n+                    \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+                )\n         # TODO: remove when discarding the openapi_prefix parameter\n         if openapi_prefix:\n             logger.warning(\n\n```\n\n```diff\n@@ -0,0 +1,21 @@\n+\"\"\"Tests for initialization of FastAPI app instance.\"\"\"\n+\n+import pytest\n+from fastapi import FastAPI\n+\n+\n+def test_open_api_url_no_title():\n+    \"\"\"An error should be raised if an openapi URL is provided without a title.\"\"\"\n+    with pytest.raises(ValueError):\n+        FastAPI(openapi_url=\"/openapi.json\", title=None)\n+\n+\n+def test_open_api_url_no_version():\n+    \"\"\"An error should be raised if an openapi URL is provided without a version.\"\"\"\n+    with pytest.raises(ValueError):\n+        FastAPI(openapi_url=\"/openapi.json\", version=None)\n+\n+\n+def test_open_api_url_title_and_version():\n+    \"\"\"No error should be raised if an openapi URL is provided with a title and version.\"\"\"\n+    FastAPI(openapi_url=\"/openapi.json\", title=\"Title\", version=\"0.1\")\n\n```", "output": "Changes look good. This PR implements: Replace `applications.py` asserts with if...raise", "source": "pr", "type": "code_review", "pr_number": 543}
{"instruction": "Review the following code changes: üëΩÔ∏è Address deprecation of `BaseModel.dict()` in Pydantic v2", "input": "```diff\n@@ -16,7 +16,7 @@ class Item(BaseModel):\n \n @app.post(\"/items/\")\n async def create_item(item: Item):\n-    item_dict = item.dict()\n+    item_dict = item.model_dump()\n     if item.tax is not None:\n         price_with_tax = item.price + item.tax\n         item_dict.update({\"price_with_tax\": price_with_tax})\n\n```\n\n```diff\n@@ -14,7 +14,7 @@ class Item(BaseModel):\n \n @app.post(\"/items/\")\n async def create_item(item: Item):\n-    item_dict = item.dict()\n+    item_dict = item.model_dump()\n     if item.tax is not None:\n         price_with_tax = item.price + item.tax\n         item_dict.update({\"price_with_tax\": price_with_tax})\n\n```\n\n```diff\n@@ -16,4 +16,4 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item):\n-    return {\"item_id\": item_id, **item.dict()}\n+    return {\"item_id\": item_id, **item.model_dump()}\n\n```\n\n```diff\n@@ -14,4 +14,4 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item):\n-    return {\"item_id\": item_id, **item.dict()}\n+    return {\"item_id\": item_id, **item.model_dump()}\n\n```\n\n```diff\n@@ -16,7 +16,7 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item, q: Union[str, None] = None):\n-    result = {\"item_id\": item_id, **item.dict()}\n+    result = {\"item_id\": item_id, **item.model_dump()}\n     if q:\n         result.update({\"q\": q})\n     return result\n\n```", "output": "Changes look good. This PR implements: üëΩÔ∏è Address deprecation of `BaseModel.dict()` in Pydantic v2", "source": "pr", "type": "code_review", "pr_number": 542}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor tests in `tests/test_tutorial/test_background_tasks`", "input": "```diff\n@@ -0,0 +1,12 @@\n+import os\n+from pathlib import Path\n+\n+import pytest\n+\n+\n+@pytest.fixture(name=\"path_to_log_file\")\n+def log_path():\n+    log = Path(\"log.txt\")\n+    yield log\n+    if log.is_file():\n+        os.remove(log)  # pragma: no cover\n\n```\n\n```diff\n@@ -1,17 +1,11 @@\n-import os\n-from pathlib import Path\n-\n from fastapi.testclient import TestClient\n \n from docs_src.background_tasks.tutorial001 import app\n \n client = TestClient(app)\n \n \n-def test():\n-    log = Path(\"log.txt\")\n-    if log.is_file():\n-        os.remove(log)  # pragma: no cover\n+def test(path_to_log_file):\n     response = client.post(\"/send-notification/foo@example.com\")\n     assert response.status_code == 200, response.text\n     assert response.json() == {\"message\": \"Notification sent in the background\"}\n\n```\n\n```diff\n@@ -1,6 +1,4 @@\n import importlib\n-import os\n-from pathlib import Path\n \n import pytest\n from fastapi.testclient import TestClient\n@@ -25,10 +23,7 @@ def get_client(request: pytest.FixtureRequest):\n     return client\n \n \n-def test(client: TestClient):\n-    log = Path(\"log.txt\")\n-    if log.is_file():\n-        os.remove(log)  # pragma: no cover\n+def test(client: TestClient, path_to_log_file):\n     response = client.post(\"/send-notification/foo@example.com?q=some-query\")\n     assert response.status_code == 200, response.text\n     assert response.json() == {\"message\": \"Message sent\"}\n\n```", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Refactor tests in `tests/test_tutorial/test_background_tasks`", "source": "pr", "type": "code_review", "pr_number": 541}
{"instruction": "Fix the following bug: üêõ Fix response status code which were misconfigured to show 403", "input": "Replaced 403 status code with 401 ; as 403 represents correct authentication but incorrect authorization. \r\n\r\nAnd the cases here are about missing creds in auth headers so 401 makes more sense. \r\n\r\nThe response body is displaying the correct message but the response status code was 403.", "output": "```diff\n@@ -4,7 +4,7 @@\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.status import HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -14,7 +14,7 @@ def check_api_key(api_key: Optional[str], auto_error: bool) -> Optional[str]:\n         if not api_key:\n             if auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             return None\n         return api_key\n\n```\n\n```diff\n@@ -9,7 +9,7 @@\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -87,7 +87,7 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n@@ -306,14 +306,14 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"bearer\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n                 )\n             else:\n@@ -408,14 +408,14 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"digest\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n                 )\n             else:\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n \n # TODO: import from typing when deprecating Python 3.9\n from typing_extensions import Annotated, Doc\n@@ -381,7 +381,7 @@ async def __call__(self, request: Request) -> Optional[str]:\n         if not authorization:\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.status import HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -77,7 +77,7 @@ async def __call__(self, request: Request) -> Optional[str]:\n         if not authorization:\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n\n```\n\n```diff\n@@ -32,7 +32,7 @@ def test_security_api_key():\n def test_security_api_key_no_key():\n     client = TestClient(app)\n     response = client.get(\"/users/me\")\n-    assert response.status_code == 403, response.text\n+    assert response.status_code == 401, response.text\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 540}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -4,7 +4,7 @@\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.status import HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -14,7 +14,7 @@ def check_api_key(api_key: Optional[str], auto_error: bool) -> Optional[str]:\n         if not api_key:\n             if auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             return None\n         return api_key\n\n```\n\n```diff\n@@ -9,7 +9,7 @@\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -87,7 +87,7 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n@@ -306,14 +306,14 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"bearer\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n                 )\n             else:\n@@ -408,14 +408,14 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"digest\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n                 )\n             else:\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n \n # TODO: import from typing when deprecating Python 3.9\n from typing_extensions import Annotated, Doc\n@@ -381,7 +381,7 @@ async def __call__(self, request: Request) -> Optional[str]:\n         if not authorization:\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.status import HTTP_403_FORBIDDEN\n+from starlette.status import HTTP", "output": "Bug: üêõ Fix response status code which were misconfigured to show 403\n\nReplaced 403 status code with 401 ; as 403 represents correct authentication but incorrect authorization. \r\n\r\nAnd the cases here are about missing creds in auth headers so 401 makes more sense. \r\n\r\nThe response body is displaying the correct message but the response status code was 403.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 540}
{"instruction": "Review the following code changes: üêõ Fix response status code which were misconfigured to show 403", "input": "```diff\n@@ -4,7 +4,7 @@\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.status import HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -14,7 +14,7 @@ def check_api_key(api_key: Optional[str], auto_error: bool) -> Optional[str]:\n         if not api_key:\n             if auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             return None\n         return api_key\n\n```\n\n```diff\n@@ -9,7 +9,7 @@\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -87,7 +87,7 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n@@ -306,14 +306,14 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"bearer\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n                 )\n             else:\n@@ -408,14 +408,14 @@ async def __call__(\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"digest\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n                 )\n             else:\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n \n # TODO: import from typing when deprecating Python 3.9\n from typing_extensions import Annotated, Doc\n@@ -381,7 +381,7 @@ async def __call__(self, request: Request) -> Optional[str]:\n         if not authorization:\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.status import HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n from typing_extensions import Annotated, Doc\n \n \n@@ -77,7 +77,7 @@ async def __call__(self, request: Request) -> Optional[str]:\n         if not authorization:\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED, detail=\"Not authenticated\"\n                 )\n             else:\n                 return None\n\n```\n\n```diff\n@@ -32,7 +32,7 @@ def test_security_api_key():\n def test_security_api_key_no_key():\n     client = TestClient(app)\n     response = client.get(\"/users/me\")\n-    assert response.status_code == 403, response.text\n+    assert response.status_code == 401, response.text\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n\n```", "output": "Changes look good. This PR implements: üêõ Fix response status code which were misconfigured to show 403", "source": "pr", "type": "code_review", "pr_number": 540}
{"instruction": "Fix the following bug: üêõ Fix support for unions when using `Form`", "input": "", "output": "```diff\n@@ -816,6 +816,25 @@ def request_params_to_args(\n     return values, errors\n \n \n+def is_union_of_base_models(field_type: Any) -> bool:\n+    \"\"\"Check if field type is a Union where all members are BaseModel subclasses.\"\"\"\n+    from fastapi.types import UnionType\n+\n+    origin = get_origin(field_type)\n+\n+    # Check if it's a Union type (covers both typing.Union and types.UnionType in Python 3.10+)\n+    if origin is not Union and origin is not UnionType:\n+        return False\n+\n+    union_args = get_args(field_type)\n+\n+    for arg in union_args:\n+        if not lenient_issubclass(arg, BaseModel):\n+            return False\n+\n+    return True\n+\n+\n def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n     if not fields:\n         return False\n@@ -829,10 +848,12 @@ def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n     # If it explicitly specifies it is embedded, it has to be embedded\n     if getattr(first_field.field_info, \"embed\", None):\n         return True\n-    # If it's a Form (or File) field, it has to be a BaseModel to be top level\n+    # If it's a Form (or File) field, it has to be a BaseModel (or a union of BaseModels) to be top level\n     # otherwise it has to be embedded, so that the key value pair can be extracted\n-    if isinstance(first_field.field_info, params.Form) and not lenient_issubclass(\n-        first_field.type_, BaseModel\n+    if (\n+        isinstance(first_field.field_info, params.Form)\n+        and not lenient_issubclass(first_field.type_, BaseModel)\n+        and not is_union_of_base_models(first_field.type_)\n     ):\n         return True\n     return False\n\n```\n\n```diff\n@@ -0,0 +1,156 @@\n+from typing import Union\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+\n+class UserForm(BaseModel):\n+    name: str\n+    email: str\n+\n+\n+class CompanyForm(BaseModel):\n+    company_name: str\n+    industry: str\n+\n+\n+@app.post(\"/form-union/\")\n+def post_union_form(data: Annotated[Union[UserForm, CompanyForm], Form()]):\n+    return {\"received\": data}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_post_user_form():\n+    response = client.post(\n+        \"/form-union/\", data={\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"received\": {\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n+    }\n+\n+\n+def test_post_company_form():\n+    response = client.post(\n+        \"/form-union/\", data={\"company_name\": \"Tech Corp\", \"industry\": \"Technology\"}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"received\": {\"company_name\": \"Tech Corp\", \"industry\": \"Technology\"}\n+    }\n+\n+\n+def test_invalid_form_data():\n+    response = client.post(\n+        \"/form-union/\",\n+        data={\"name\": \"John\", \"company_name\": \"Tech Corp\"},\n+    )\n+    assert response.status_code == 422, response.text\n+\n+\n+def test_empty_form():\n+    response = client.post(\"/form-union/\")\n+    assert response.status_code == 422, response.text\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+\n+    assert response.json() == {\n+        \"openapi\": \"3.1.0\",\n+        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+        \"paths\": {\n+            \"/form-union/\": {\n+                \"post\": {\n+                    \"summary\": \"Post Union Form\",\n+                    \"operationId\": \"post_union_form_form_union__post\",\n+                    \"requestBody\": {\n+                        \"content\": {\n+                            \"application/x-www-form-urlencoded\": {\n+                                \"schema\": {\n+                                    \"anyOf\": [\n+                                        {\"$ref\": \"#/components/schemas/UserForm\"},\n+                                        {\"$ref\": \"#/components/schemas/CompanyForm\"},\n+                                    ],\n+                                    \"title\": \"Data\",\n+                                }\n+                            }\n+                        },\n+                        \"required\": True,\n+                    },\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"422\": {\n+                            \"description\": \"Validation Error\",\n+                            \"cont\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 539}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -816,6 +816,25 @@ def request_params_to_args(\n     return values, errors\n \n \n+def is_union_of_base_models(field_type: Any) -> bool:\n+    \"\"\"Check if field type is a Union where all members are BaseModel subclasses.\"\"\"\n+    from fastapi.types import UnionType\n+\n+    origin = get_origin(field_type)\n+\n+    # Check if it's a Union type (covers both typing.Union and types.UnionType in Python 3.10+)\n+    if origin is not Union and origin is not UnionType:\n+        return False\n+\n+    union_args = get_args(field_type)\n+\n+    for arg in union_args:\n+        if not lenient_issubclass(arg, BaseModel):\n+            return False\n+\n+    return True\n+\n+\n def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n     if not fields:\n         return False\n@@ -829,10 +848,12 @@ def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n     # If it explicitly specifies it is embedded, it has to be embedded\n     if getattr(first_field.field_info, \"embed\", None):\n         return True\n-    # If it's a Form (or File) field, it has to be a BaseModel to be top level\n+    # If it's a Form (or File) field, it has to be a BaseModel (or a union of BaseModels) to be top level\n     # otherwise it has to be embedded, so that the key value pair can be extracted\n-    if isinstance(first_field.field_info, params.Form) and not lenient_issubclass(\n-        first_field.type_, BaseModel\n+    if (\n+        isinstance(first_field.field_info, params.Form)\n+        and not lenient_issubclass(first_field.type_, BaseModel)\n+        and not is_union_of_base_models(first_field.type_)\n     ):\n         return True\n     return False\n\n```\n\n```diff\n@@ -0,0 +1,156 @@\n+from typing import Union\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+\n+class UserForm(BaseModel):\n+    name: str\n+    email: str\n+\n+\n+class CompanyForm(BaseModel):\n+    company_name: str\n+    industry: str\n+\n+\n+@app.post(\"/form-union/\")\n+def post_union_form(data: Annotated[Union[UserForm, CompanyForm], Form()]):\n+    return {\"received\": data}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_post_user_form():\n+    response = client.post(\n+        \"/form-union/\", data={\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"received\": {\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n+    }\n+\n+\n+def test_post_company_form():\n+    response = client.post(\n+        \"/form-union/\", data={\"company_name\": \"Tech Corp\", \"industry\": \"Technology\"}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"received\": {\"company_name\": \"Tech Corp\", \"industry\": \"Technology\"}\n+    }\n+\n+\n+def test_invalid_form_data():\n+    response = client.post(\n+        \"/form-union/\",\n+        data={\"name\": \"John\", \"company_name\": \"Tech Corp\"},\n+    )\n+    assert response.status_code == 422, response.text\n+\n+\n+def test_empty_form():\n+    response = client.post(\"/form-union/\")\n+    assert response.status_code == 422, response.text\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+\n+    assert response.json() == {\n+        \"openapi\": \"3.1.0\",\n+        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+        \"paths\": {\n+            \"/form-union/\": {\n+                \"post\": {\n+                    \"summary\": \"Post Union Form\",\n+                    \"operationId\": \"post_union_form_form_union__post\",\n+                    \"requestBody\": {\n+                        \"content\": {\n+                            \"application/x-www-form-urlencoded\": {\n+                                \"schema\": {\n+                                    \"anyOf\": [\n+                                        {\"$ref\": \"#/components/schemas/UserForm\"},\n+                                        {\"$ref\": \"#/components/sch", "output": "Bug: üêõ Fix support for unions when using `Form`\n\n", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 539}
{"instruction": "Review the following code changes: üêõ Fix support for unions when using `Form`", "input": "```diff\n@@ -816,6 +816,25 @@ def request_params_to_args(\n     return values, errors\n \n \n+def is_union_of_base_models(field_type: Any) -> bool:\n+    \"\"\"Check if field type is a Union where all members are BaseModel subclasses.\"\"\"\n+    from fastapi.types import UnionType\n+\n+    origin = get_origin(field_type)\n+\n+    # Check if it's a Union type (covers both typing.Union and types.UnionType in Python 3.10+)\n+    if origin is not Union and origin is not UnionType:\n+        return False\n+\n+    union_args = get_args(field_type)\n+\n+    for arg in union_args:\n+        if not lenient_issubclass(arg, BaseModel):\n+            return False\n+\n+    return True\n+\n+\n def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n     if not fields:\n         return False\n@@ -829,10 +848,12 @@ def _should_embed_body_fields(fields: List[ModelField]) -> bool:\n     # If it explicitly specifies it is embedded, it has to be embedded\n     if getattr(first_field.field_info, \"embed\", None):\n         return True\n-    # If it's a Form (or File) field, it has to be a BaseModel to be top level\n+    # If it's a Form (or File) field, it has to be a BaseModel (or a union of BaseModels) to be top level\n     # otherwise it has to be embedded, so that the key value pair can be extracted\n-    if isinstance(first_field.field_info, params.Form) and not lenient_issubclass(\n-        first_field.type_, BaseModel\n+    if (\n+        isinstance(first_field.field_info, params.Form)\n+        and not lenient_issubclass(first_field.type_, BaseModel)\n+        and not is_union_of_base_models(first_field.type_)\n     ):\n         return True\n     return False\n\n```\n\n```diff\n@@ -0,0 +1,156 @@\n+from typing import Union\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+\n+class UserForm(BaseModel):\n+    name: str\n+    email: str\n+\n+\n+class CompanyForm(BaseModel):\n+    company_name: str\n+    industry: str\n+\n+\n+@app.post(\"/form-union/\")\n+def post_union_form(data: Annotated[Union[UserForm, CompanyForm], Form()]):\n+    return {\"received\": data}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_post_user_form():\n+    response = client.post(\n+        \"/form-union/\", data={\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"received\": {\"name\": \"John Doe\", \"email\": \"john@example.com\"}\n+    }\n+\n+\n+def test_post_company_form():\n+    response = client.post(\n+        \"/form-union/\", data={\"company_name\": \"Tech Corp\", \"industry\": \"Technology\"}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"received\": {\"company_name\": \"Tech Corp\", \"industry\": \"Technology\"}\n+    }\n+\n+\n+def test_invalid_form_data():\n+    response = client.post(\n+        \"/form-union/\",\n+        data={\"name\": \"John\", \"company_name\": \"Tech Corp\"},\n+    )\n+    assert response.status_code == 422, response.text\n+\n+\n+def test_empty_form():\n+    response = client.post(\"/form-union/\")\n+    assert response.status_code == 422, response.text\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+\n+    assert response.json() == {\n+        \"openapi\": \"3.1.0\",\n+        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+        \"paths\": {\n+            \"/form-union/\": {\n+                \"post\": {\n+                    \"summary\": \"Post Union Form\",\n+                    \"operationId\": \"post_union_form_form_union__post\",\n+                    \"requestBody\": {\n+                        \"content\": {\n+                            \"application/x-www-form-urlencoded\": {\n+                                \"schema\": {\n+                                    \"anyOf\": [\n+                                        {\"$ref\": \"#/components/schemas/UserForm\"},\n+                                        {\"$ref\": \"#/components/schemas/CompanyForm\"},\n+                                    ],\n+                                    \"title\": \"Data\",\n+                                }\n+                            }\n+                        },\n+                        \"required\": True,\n+                    },\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"422\": {\n+                            \"description\": \"Validation Error\",\n+                            \"cont\n\n```", "output": "Changes look good. This PR implements: üêõ Fix support for unions when using `Form`", "source": "pr", "type": "code_review", "pr_number": 539}
{"instruction": "Review the following code changes: Simplify tests for schema_extra_example #13150", "input": "```diff\n@@ -3,14 +3,16 @@\n import pytest\n from fastapi.testclient import TestClient\n \n-from ...utils import needs_py310, needs_pydanticv2\n+from ...utils import needs_py310, needs_pydanticv1, needs_pydanticv2\n \n \n @pytest.fixture(\n     name=\"client\",\n     params=[\n-        \"tutorial001\",\n-        pytest.param(\"tutorial001_py310\", marks=needs_py310),\n+        pytest.param(\"tutorial001\", marks=[needs_pydanticv2]),\n+        pytest.param(\"tutorial001_py310\", marks=[needs_py310, needs_pydanticv2]),\n+        pytest.param(\"tutorial001_pv1\", marks=[needs_pydanticv1]),\n+        pytest.param(\"tutorial001_pv1_py310\", marks=[needs_py310, needs_pydanticv1]),\n     ],\n )\n def get_client(request: pytest.FixtureRequest):\n@@ -20,7 +22,6 @@ def get_client(request: pytest.FixtureRequest):\n     return client\n \n \n-@needs_pydanticv2\n def test_post_body_example(client: TestClient):\n     response = client.put(\n         \"/items/5\",\n@@ -34,7 +35,6 @@ def test_post_body_example(client: TestClient):\n     assert response.status_code == 200\n \n \n-@needs_pydanticv2\n def test_openapi_schema(client: TestClient):\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n\n```\n\n```diff\n@@ -1,135 +0,0 @@\n-import importlib\n-\n-import pytest\n-from fastapi.testclient import TestClient\n-\n-from ...utils import needs_py310, needs_pydanticv1\n-\n-\n-@pytest.fixture(\n-    name=\"client\",\n-    params=[\n-        \"tutorial001_pv1\",\n-        pytest.param(\"tutorial001_pv1_py310\", marks=needs_py310),\n-    ],\n-)\n-def get_client(request: pytest.FixtureRequest):\n-    mod = importlib.import_module(f\"docs_src.schema_extra_example.{request.param}\")\n-\n-    client = TestClient(mod.app)\n-    return client\n-\n-\n-@needs_pydanticv1\n-def test_post_body_example(client: TestClient):\n-    response = client.put(\n-        \"/items/5\",\n-        json={\n-            \"name\": \"Foo\",\n-            \"description\": \"A very nice Item\",\n-            \"price\": 35.4,\n-            \"tax\": 3.2,\n-        },\n-    )\n-    assert response.status_code == 200\n-\n-\n-@needs_pydanticv1\n-def test_openapi_schema(client: TestClient):\n-    response = client.get(\"/openapi.json\")\n-    assert response.status_code == 200, response.text\n-    # insert_assert(response.json())\n-    assert response.json() == {\n-        \"openapi\": \"3.1.0\",\n-        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n-        \"paths\": {\n-            \"/items/{item_id}\": {\n-                \"put\": {\n-                    \"summary\": \"Update Item\",\n-                    \"operationId\": \"update_item_items__item_id__put\",\n-                    \"parameters\": [\n-                        {\n-                            \"required\": True,\n-                            \"schema\": {\"type\": \"integer\", \"title\": \"Item Id\"},\n-                            \"name\": \"item_id\",\n-                            \"in\": \"path\",\n-                        }\n-                    ],\n-                    \"requestBody\": {\n-                        \"content\": {\n-                            \"application/json\": {\n-                                \"schema\": {\"$ref\": \"#/components/schemas/Item\"}\n-                            }\n-                        },\n-                        \"required\": True,\n-                    },\n-                    \"responses\": {\n-                        \"200\": {\n-                            \"description\": \"Successful Response\",\n-                            \"content\": {\"application/json\": {\"schema\": {}}},\n-                        },\n-                        \"422\": {\n-                            \"description\": \"Validation Error\",\n-                            \"content\": {\n-                                \"application/json\": {\n-                                    \"schema\": {\n-                                        \"$ref\": \"#/components/schemas/HTTPValidationError\"\n-                                    }\n-                                }\n-                            },\n-                        },\n-                    },\n-                }\n-            }\n-        },\n-        \"components\": {\n-            \"schemas\": {\n-                \"HTTPValidationError\": {\n-                    \"properties\": {\n-                        \"detail\": {\n-                            \"i\n\n```", "output": "Changes look good. This PR implements: Simplify tests for schema_extra_example #13150", "source": "pr", "type": "code_review", "pr_number": 538}
{"instruction": "Review the following code changes: ‚ú® Add HEAD method on GET routes", "input": "```diff\n@@ -253,6 +253,8 @@ def get_openapi_path(\n     route_response_media_type: Optional[str] = current_response_class.media_type\n     if route.include_in_schema:\n         for method in route.methods:\n+            if method == \"HEAD\" and \"GET\" in route.methods:\n+                continue\n             operation = get_openapi_operation_metadata(\n                 route=route, method=method, operation_ids=operation_ids\n             )\n\n```\n\n```diff\n@@ -490,7 +490,9 @@ def __init__(\n         self.name = get_name(endpoint) if name is None else name\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         if methods is None:\n-            methods = [\"GET\"]\n+            methods = [\"GET\", \"HEAD\"]\n+        elif \"GET\" in methods:\n+            methods = set(methods).union({\"HEAD\"})\n         self.methods: Set[str] = {method.upper() for method in methods}\n         if isinstance(generate_unique_id_function, DefaultPlaceholder):\n             current_generate_unique_id: Callable[[APIRoute], str] = (\n@@ -1724,7 +1726,7 @@ def read_items():\n             response_description=response_description,\n             responses=responses,\n             deprecated=deprecated,\n-            methods=[\"GET\"],\n+            methods=[\"GET\", \"HEAD\"],\n             operation_id=operation_id,\n             response_model_include=response_model_include,\n             response_model_exclude=response_model_exclude,\n\n```\n\n```diff\n@@ -14,6 +14,11 @@ class Item(BaseModel):\n     price: Optional[float] = None\n \n \n+@app.head(\"/items/{item_id}\")\n+def head_item(item_id: str):\n+    return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})\n+\n+\n @app.api_route(\"/items/{item_id}\", methods=[\"GET\"])\n def get_items(item_id: str):\n     return {\"item_id\": item_id}\n@@ -31,11 +36,6 @@ def delete_item(item_id: str, item: Item):\n     return {\"item_id\": item_id, \"item\": item}\n \n \n-@app.head(\"/items/{item_id}\")\n-def head_item(item_id: str):\n-    return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})\n-\n-\n @app.options(\"/items/{item_id}\")\n def options_item(item_id: str):\n     return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})\n\n```\n\n```diff\n@@ -18,6 +18,9 @@ def test_get_path(path, expected_status, expected_response):\n     assert response.status_code == expected_status\n     assert response.json() == expected_response\n \n+    response = client.head(path)\n+    assert response.status_code == expected_status\n+\n \n def test_openapi_schema():\n     response = client.get(\"/openapi.json\")\n\n```\n\n```diff\n@@ -490,7 +490,9 @@ def __init__(\n         self.name = get_name(endpoint) if name is None else name\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         if methods is None:\n-            methods = [\"GET\"]\n+            methods = [\"GET\", \"HEAD\"]\n+        elif \"GET\" in methods:\n+            methods = set(methods).union({\"HEAD\"})\n\n```", "output": "Code Review for: ‚ú® Add HEAD method on GET routes\n\nüìù **fastapi/routing.py**: Mixing lists and sets doesn't look great ... I would prefer a consistent processing approach that uses sets.\r\n\r\nProbably `.add()` is a better choice than `union`.\n\nüìù **tests/test_tutorial/test_first_steps/test_tutorial001.py**: We also need to test:\r\n\r\na) Response to HEAD request does not contain body data\r\nb) The response headers to HEAD request are the same as the headers to GET request\n\nüìù **tests/test_tutorial/test_first_steps/test_tutorial001.py**: > Response to HEAD request does not contain body data\r\n\r\nWe don't. This is tested on the underneath packages.\r\n\nüìù **tests/test_tutorial/test_first_steps/test_tutorial001.py**: Why do we need this?\r\n\r\nThis is the tutorial tests, and in tutorial tests we want to demonstrate basic functionalities to package users. This is sort of a supplement to documentation, and from my perspective, this would be a nice to have.\n\n", "source": "pr", "type": "code_review", "pr_number": 537}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -490,7 +490,9 @@ def __init__(\n         self.name = get_name(endpoint) if name is None else name\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         if methods is None:\n-            methods = [\"GET\"]\n+            methods = [\"GET\", \"HEAD\"]\n+        elif \"GET\" in methods:\n+            methods = set(methods).union({\"HEAD\"})\n\n```", "output": "Mixing lists and sets doesn't look great ... I would prefer a consistent processing approach that uses sets.\r\n\r\nProbably `.add()` is a better choice than `union`.", "source": "pr_review", "type": "inline_review", "pr_number": 537}
{"instruction": "Review this code change in `tests/test_tutorial/test_first_steps/test_tutorial001.py`", "input": "```diff\n@@ -18,6 +18,9 @@ def test_get_path(path, expected_status, expected_response):\n     assert response.status_code == expected_status\n     assert response.json() == expected_response\n \n+    response = client.head(path)\n+    assert response.status_code == expected_status\n+\n\n```", "output": "We also need to test:\r\n\r\na) Response to HEAD request does not contain body data\r\nb) The response headers to HEAD request are the same as the headers to GET request", "source": "pr_review", "type": "inline_review", "pr_number": 537}
{"instruction": "Review the following code changes: üêõ Use 401 instead of 403 in security classes", "input": "```diff\n@@ -303,18 +303,23 @@ async def __call__(\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n+        # All fields besides the scheme are optional, as per https://www.rfc-editor.org/rfc/rfc6750.html#section-3.\n+        unauthorized_headers = {\"WWW-Authenticate\": \"Bearer\"}\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED,\n+                    detail=\"Not authenticated\",\n+                    headers=unauthorized_headers,\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"bearer\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n+                    headers=unauthorized_headers,\n                 )\n             else:\n                 return None\n@@ -405,18 +410,23 @@ async def __call__(\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n+        # All fields besides the scheme are optional, as per https://datatracker.ietf.org/doc/html/rfc7616#section-3.3.\n+        unauthorized_headers = {\"WWW-Authenticate\": \"Digest\"}\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED,\n+                    detail=\"Not authenticated\",\n+                    headers=unauthorized_headers,\n                 )\n             else:\n                 return None\n         if scheme.lower() != \"digest\":\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN,\n+                    status_code=HTTP_401_UNAUTHORIZED,\n                     detail=\"Invalid authentication credentials\",\n+                    headers=unauthorized_headers,\n                 )\n             else:\n                 return None\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from starlette.requests import Request\n-from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n+from starlette.status import HTTP_401_UNAUTHORIZED\n \n # TODO: import from typing when deprecating Python 3.9\n from typing_extensions import Annotated, Doc\n@@ -381,7 +381,9 @@ async def __call__(self, request: Request) -> Optional[str]:\n         if not authorization:\n             if self.auto_error:\n                 raise HTTPException(\n-                    status_code=HTTP_403_FORBIDDEN, detail=\"Not authenticated\"\n+                    status_code=HTTP_401_UNAUTHORIZED,\n+                    detail=\"Not authenticated\",\n+                    headers={\"WWW-Authenticate\": \"Bearer\"},\n                 )\n             else:\n                 return None\n\n```", "output": "Changes look good. This PR implements: üêõ Use 401 instead of 403 in security classes", "source": "pr", "type": "code_review", "pr_number": 536}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor tests in `tests/test_tutorial/test_path_params/`", "input": "```diff\n@@ -1,22 +1,23 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from docs_src.path_params.tutorial004 import app\n \n client = TestClient(app)\n \n \n-def test_file_path():\n-    response = client.get(\"/files/home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"home/johndoe/myfile.txt\"}\n+test_data = [\n+    (\"/files/data/monthly-2024.csv\", {\"file_path\": \"data/monthly-2024.csv\"}),\n+    (\"/files/home/johndoe/myfile.txt\", {\"file_path\": \"home/johndoe/myfile.txt\"}),\n+    (\"/files//home/johndoe/myfile.txt\", {\"file_path\": \"/home/johndoe/myfile.txt\"}),\n+]\n \n \n-def test_root_file_path():\n-    response = client.get(\"/files//home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"/home/johndoe/myfile.txt\"}\n+@pytest.mark.parametrize(\"url_path, expected_response\", test_data)\n+def test_file_paths(url_path, expected_response):\n+    response = client.get(url_path)\n+    assert response.status_code == 200\n+    assert response.json() == expected_response\n \n \n def test_openapi_schema():\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+import pytest\n from dirty_equals import IsDict\n from fastapi.testclient import TestClient\n \n@@ -6,22 +7,18 @@\n client = TestClient(app)\n \n \n-def test_get_enums_alexnet():\n-    response = client.get(\"/models/alexnet\")\n-    assert response.status_code == 200\n-    assert response.json() == {\"model_name\": \"alexnet\", \"message\": \"Deep Learning FTW!\"}\n-\n-\n-def test_get_enums_lenet():\n-    response = client.get(\"/models/lenet\")\n-    assert response.status_code == 200\n-    assert response.json() == {\"model_name\": \"lenet\", \"message\": \"LeCNN all the images\"}\n+test_data = [\n+    (\"/models/alexnet\", {\"model_name\": \"alexnet\", \"message\": \"Deep Learning FTW!\"}),\n+    (\"/models/lenet\", {\"model_name\": \"lenet\", \"message\": \"LeCNN all the images\"}),\n+    (\"/models/resnet\", {\"model_name\": \"resnet\", \"message\": \"Have some residuals\"}),\n+]\n \n \n-def test_get_enums_resnet():\n-    response = client.get(\"/models/resnet\")\n+@pytest.mark.parametrize(\"url_path, expected_response\", test_data)\n+def test_get_enums(url_path, expected_response):\n+    response = client.get(url_path)\n     assert response.status_code == 200\n-    assert response.json() == {\"model_name\": \"resnet\", \"message\": \"Have some residuals\"}\n+    assert response.json() == expected_response\n \n \n def test_get_enums_invalid():\n\n```\n\n```diff\n@@ -1,22 +1,23 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from docs_src.path_params.tutorial004 import app\n \n client = TestClient(app)\n \n \n-def test_file_path():\n-    response = client.get(\"/files/home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"home/johndoe/myfile.txt\"}\n+test_data = [\n+    (\"/files/data/monthly-2024.csv\", {\"file_path\": \"data/monthly-2024.csv\"}),\n+    (\"/files/home/johndoe/myfile.txt\", {\"file_path\": \"home/johndoe/myfile.txt\"}),\n+    (\"/files//home/johndoe/myfile.txt\", {\"file_path\": \"/home/johndoe/myfile.txt\"}),\n+]\n \n \n-def test_root_file_path():\n-    response = client.get(\"/files//home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"/home/johndoe/myfile.txt\"}\n+@pytest.mark.parametrize(\"url_path, expected_response\", test_data)\n\n```\n\n```diff\n@@ -1,22 +1,23 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from docs_src.path_params.tutorial004 import app\n \n client = TestClient(app)\n \n \n-def test_file_path():\n-    response = client.get(\"/files/home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"home/johndoe/myfile.txt\"}\n+test_data = [\n+    (\"/files/data/monthly-2024.csv\", {\"file_path\": \"data/monthly-2024.csv\"}),\n\n```\n\n```diff\n@@ -1,22 +1,23 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from docs_src.path_params.tutorial004 import app\n \n client = TestClient(app)\n \n \n-def test_file_path():\n-    response = client.get(\"/files/home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"home/johndoe/myfile.txt\"}\n+test_data = [\n+    (\"/files/data/monthly-2024.csv\", {\"file_path\": \"data/monthly-2024.csv\"}),\n+    (\"/files/home/johndoe/myfile.txt\", {\"file_path\": \"home/johndoe/myfile.txt\"}),\n+    (\"/files//home/johndoe/myfile.txt\", {\"file_path\": \"/home/johndoe/myfile.txt\"}),\n+]\n \n \n-def test_root_file_path():\n-    response = client.get(\"/files//home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"/home/johndoe/myfile.txt\"}\n+@pytest.mark.parametrize(\"url_path, expected_response\", ", "output": "Code Review for: ‚ôªÔ∏è Refactor tests in `tests/test_tutorial/test_path_params/`\n\nüìù **tests/test_tutorial/test_path_params/test_tutorial004.py**: great!\n\nüìù **tests/test_tutorial/test_path_params/test_tutorial004.py**: Could you explain what this additional test case gives us?\n\nüìù **tests/test_tutorial/test_path_params/test_tutorial004.py**: ```suggestion\r\n    assert response.status_code == 200, response.text\r\n```\r\nI would leave this and add `, response.text` to test in `test_tutorial005.py`\n\n", "source": "pr", "type": "code_review", "pr_number": 535}
{"instruction": "Review this code change in `tests/test_tutorial/test_path_params/test_tutorial004.py`", "input": "```diff\n@@ -1,22 +1,23 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from docs_src.path_params.tutorial004 import app\n \n client = TestClient(app)\n \n \n-def test_file_path():\n-    response = client.get(\"/files/home/johndoe/myfile.txt\")\n-    print(response.content)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"file_path\": \"home/johndoe/myfile.txt\"}\n+test_data = [\n+    (\"/files/data/monthly-2024.csv\", {\"file_path\": \"data/monthly-2024.csv\"}),\n\n```", "output": "Could you explain what this additional test case gives us?", "source": "pr_review", "type": "inline_review", "pr_number": 535}
{"instruction": "Review the following code changes: ‚ú® Relax HTTPBearer call requirement to support websockets", "input": "```diff\n@@ -8,7 +8,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection, Request\n from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n from typing_extensions import Annotated, Doc\n \n@@ -299,7 +299,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n\n```", "output": "Changes look good. This PR implements: ‚ú® Relax HTTPBearer call requirement to support websockets", "source": "pr", "type": "code_review", "pr_number": 534}
{"instruction": "Review the following code changes: ‚úÖ Simplify tests for websockets", "input": "```diff\n@@ -1,16 +1,33 @@\n+import importlib\n+\n+import pytest\n from fastapi.testclient import TestClient\n \n-from docs_src.websockets.tutorial003 import app, html\n+from docs_src.websockets.tutorial003 import html\n+\n+from ...utils import needs_py39\n+\n \n-client = TestClient(app)\n+@pytest.fixture(\n+    name=\"app\",\n+    params=[\n+        \"tutorial003\",\n+        pytest.param(\"tutorial003_py39\", marks=needs_py39),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.websockets.{request.param}\")\n+    return mod.app\n \n \n-def test_get():\n+def test_get(app):\n+    client = TestClient(app)\n     response = client.get(\"/\")\n     assert response.text == html\n \n \n-def test_websocket_handle_disconnection():\n+def test_websocket_handle_disconnection(app):\n+    client = TestClient(app)\n     with client.websocket_connect(\"/ws/1234\") as connection, client.websocket_connect(\n         \"/ws/5678\"\n     ) as connection_two:\n\n```\n\n```diff\n@@ -1,50 +0,0 @@\n-import pytest\n-from fastapi import FastAPI\n-from fastapi.testclient import TestClient\n-\n-from ...utils import needs_py39\n-\n-\n-@pytest.fixture(name=\"app\")\n-def get_app():\n-    from docs_src.websockets.tutorial003_py39 import app\n-\n-    return app\n-\n-\n-@pytest.fixture(name=\"html\")\n-def get_html():\n-    from docs_src.websockets.tutorial003_py39 import html\n-\n-    return html\n-\n-\n-@pytest.fixture(name=\"client\")\n-def get_client(app: FastAPI):\n-    client = TestClient(app)\n-\n-    return client\n-\n-\n-@needs_py39\n-def test_get(client: TestClient, html: str):\n-    response = client.get(\"/\")\n-    assert response.text == html\n-\n-\n-@needs_py39\n-def test_websocket_handle_disconnection(client: TestClient):\n-    with client.websocket_connect(\"/ws/1234\") as connection, client.websocket_connect(\n-        \"/ws/5678\"\n-    ) as connection_two:\n-        connection.send_text(\"Hello from 1234\")\n-        data1 = connection.receive_text()\n-        assert data1 == \"You wrote: Hello from 1234\"\n-        data2 = connection_two.receive_text()\n-        client1_says = \"Client #1234 says: Hello from 1234\"\n-        assert data2 == client1_says\n-        data1 = connection.receive_text()\n-        assert data1 == client1_says\n-        connection_two.close()\n-        data1 = connection.receive_text()\n-        assert data1 == \"Client #5678 left the chat\"\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Simplify tests for websockets", "source": "pr", "type": "code_review", "pr_number": 533}
{"instruction": "Review the following code changes: ‚úÖ Simplify tests for `settings`", "input": "```diff\n@@ -1,14 +1,26 @@\n+import importlib\n+\n+import pytest\n from fastapi.testclient import TestClient\n from pytest import MonkeyPatch\n \n-from ...utils import needs_pydanticv2\n+from ...utils import needs_pydanticv1, needs_pydanticv2\n \n \n-@needs_pydanticv2\n-def test_settings(monkeypatch: MonkeyPatch):\n+@pytest.fixture(\n+    name=\"app\",\n+    params=[\n+        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\n+        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest, monkeypatch: MonkeyPatch):\n     monkeypatch.setenv(\"ADMIN_EMAIL\", \"admin@example.com\")\n-    from docs_src.settings.tutorial001 import app\n+    mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\n+    return mod.app\n+\n \n+def test_settings(app):\n     client = TestClient(app)\n     response = client.get(\"/info\")\n     assert response.status_code == 200, response.text\n\n```\n\n```diff\n@@ -1,19 +0,0 @@\n-from fastapi.testclient import TestClient\n-from pytest import MonkeyPatch\n-\n-from ...utils import needs_pydanticv1\n-\n-\n-@needs_pydanticv1\n-def test_settings(monkeypatch: MonkeyPatch):\n-    monkeypatch.setenv(\"ADMIN_EMAIL\", \"admin@example.com\")\n-    from docs_src.settings.tutorial001_pv1 import app\n-\n-    client = TestClient(app)\n-    response = client.get(\"/info\")\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\n-        \"app_name\": \"Awesome API\",\n-        \"admin_email\": \"admin@example.com\",\n-        \"items_per_user\": 50,\n-    }\n\n```\n\n```diff\n@@ -1,14 +1,30 @@\n+import importlib\n+\n+import pytest\n from fastapi.testclient import TestClient\n from pytest import MonkeyPatch\n \n-from ...utils import needs_pydanticv2\n+from ...utils import needs_pydanticv1, needs_pydanticv2\n+\n+\n+@pytest.fixture(\n+    params=[\n+        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\n+        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    def app_wrapper():\n+        mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\n+        return mod.app\n+\n+    return app_wrapper\n\n```\n\n```diff\n@@ -1,14 +1,30 @@\n+import importlib\n+\n+import pytest\n from fastapi.testclient import TestClient\n from pytest import MonkeyPatch\n \n-from ...utils import needs_pydanticv2\n+from ...utils import needs_pydanticv1, needs_pydanticv2\n+\n+\n+@pytest.fixture(\n+    params=[\n+        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\n+        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    def app_wrapper():\n+        mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\n+        return mod.app\n+\n+    return app_wrapper\n\n```", "output": "Code Review for: ‚úÖ Simplify tests for `settings`\n\nüìù **tests/test_tutorial/test_settings/test_tutorial001.py**: I think that it is better to monkeypatch `get_app()`, instead of test_settings:\r\n\r\n```python\r\n\r\n@pytest.fixture(\r\n    name=\"app\",\r\n    params=[\r\n        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\r\n        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\r\n    ],\r\n)\r\ndef get_app(request: pytest.FixtureRequest, monkeypatch: MonkeyPatch):\r\n    monkeypatch.setenv(\"ADMIN_EMAIL\", \"admin@example.com\")\r\n    mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\r\n    return mod.app\r\n\r\n\r\ndef test_settings(app):\r\n    client = TestClient(app)\r\n    response = client.get(\"/info\")\r\n    assert response.status_code == 200, response.text\r\n    assert response.json() == {\r\n        \"app_name\": \"Awesome API\",\r\n        \"admin_email\": \"admin@example.com\",\r\n        \"items_per_user\": 50,\r\n    }\r\n\r\n```\n\nüìù **tests/test_tutorial/test_settings/test_tutorial001.py**: agree, fixed\n\n", "source": "pr", "type": "code_review", "pr_number": 532}
{"instruction": "Review this code change in `tests/test_tutorial/test_settings/test_tutorial001.py`", "input": "```diff\n@@ -1,14 +1,30 @@\n+import importlib\n+\n+import pytest\n from fastapi.testclient import TestClient\n from pytest import MonkeyPatch\n \n-from ...utils import needs_pydanticv2\n+from ...utils import needs_pydanticv1, needs_pydanticv2\n+\n+\n+@pytest.fixture(\n+    params=[\n+        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\n+        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    def app_wrapper():\n+        mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\n+        return mod.app\n+\n+    return app_wrapper\n\n```", "output": "I think that it is better to monkeypatch `get_app()`, instead of test_settings:\r\n\r\n```python\r\n\r\n@pytest.fixture(\r\n    name=\"app\",\r\n    params=[\r\n        pytest.param(\"tutorial001\", marks=needs_pydanticv2),\r\n        pytest.param(\"tutorial001_pv1\", marks=needs_pydanticv1),\r\n    ],\r\n)\r\ndef get_app(request: pytest.FixtureRequest, monkeypatch: MonkeyPatch):\r\n    monkeypatch.setenv(\"ADMIN_EMAIL\", \"admin@example.com\")\r\n    mod = importlib.import_module(f\"docs_src.settings.{request.param}\")\r\n    return mod.app\r\n\r\n\r\ndef test_settings(app):\r\n    client = TestClient(app)\r\n    response = client.get(\"/info\")\r\n    assert response.status_code == 200, response.text\r\n    assert response.json() == {\r\n        \"app_name\": \"Awesome API\",\r\n        \"admin_email\": \"admin@example.com\",\r\n        \"items_per_user\": 50,\r\n    }\r\n\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 532}
{"instruction": "Review the following code changes: ‚úÖ Simplify tests for `validate_response_recursive`", "input": "```diff\n@@ -1,6 +1,7 @@\n from typing import List\n \n from fastapi import FastAPI\n+from fastapi._compat import PYDANTIC_V2\n from pydantic import BaseModel\n \n app = FastAPI()\n@@ -11,9 +12,6 @@ class RecursiveItem(BaseModel):\n     name: str\n \n \n-RecursiveItem.update_forward_refs()\n-\n-\n class RecursiveSubitemInSubmodel(BaseModel):\n     sub_items2: List[\"RecursiveItemViaSubmodel\"] = []\n     name: str\n@@ -24,7 +22,13 @@ class RecursiveItemViaSubmodel(BaseModel):\n     name: str\n \n \n-RecursiveSubitemInSubmodel.update_forward_refs()\n+if PYDANTIC_V2:\n+    RecursiveItem.model_rebuild()\n+    RecursiveSubitemInSubmodel.model_rebuild()\n+    RecursiveItemViaSubmodel.model_rebuild()\n+else:\n+    RecursiveItem.update_forward_refs()\n+    RecursiveSubitemInSubmodel.update_forward_refs()\n \n \n @app.get(\"/items/recursive\", response_model=RecursiveItem)\n\n```\n\n```diff\n@@ -1,51 +0,0 @@\n-from typing import List\n-\n-from fastapi import FastAPI\n-from pydantic import BaseModel\n-\n-app = FastAPI()\n-\n-\n-class RecursiveItem(BaseModel):\n-    sub_items: List[\"RecursiveItem\"] = []\n-    name: str\n-\n-\n-RecursiveItem.model_rebuild()\n-\n-\n-class RecursiveSubitemInSubmodel(BaseModel):\n-    sub_items2: List[\"RecursiveItemViaSubmodel\"] = []\n-    name: str\n-\n-\n-class RecursiveItemViaSubmodel(BaseModel):\n-    sub_items1: List[RecursiveSubitemInSubmodel] = []\n-    name: str\n-\n-\n-RecursiveSubitemInSubmodel.model_rebuild()\n-RecursiveItemViaSubmodel.model_rebuild()\n-\n-\n-@app.get(\"/items/recursive\", response_model=RecursiveItem)\n-def get_recursive():\n-    return {\"name\": \"item\", \"sub_items\": [{\"name\": \"subitem\", \"sub_items\": []}]}\n-\n-\n-@app.get(\"/items/recursive-submodel\", response_model=RecursiveItemViaSubmodel)\n-def get_recursive_submodel():\n-    return {\n-        \"name\": \"item\",\n-        \"sub_items1\": [\n-            {\n-                \"name\": \"subitem\",\n-                \"sub_items2\": [\n-                    {\n-                        \"name\": \"subsubitem\",\n-                        \"sub_items1\": [{\"name\": \"subsubsubitem\", \"sub_items2\": []}],\n-                    }\n-                ],\n-            }\n-        ],\n-    }\n\n```\n\n```diff\n@@ -1,12 +1,9 @@\n from fastapi.testclient import TestClient\n \n-from ..utils import needs_pydanticv1\n+from .app import app\n \n \n-@needs_pydanticv1\n def test_recursive():\n-    from .app_pv1 import app\n-\n     client = TestClient(app)\n     response = client.get(\"/items/recursive\")\n     assert response.status_code == 200, response.text\n\n```\n\n```diff\n@@ -1,33 +0,0 @@\n-from fastapi.testclient import TestClient\n-\n-from ..utils import needs_pydanticv2\n-\n-\n-@needs_pydanticv2\n-def test_recursive():\n-    from .app_pv2 import app\n-\n-    client = TestClient(app)\n-    response = client.get(\"/items/recursive\")\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\n-        \"sub_items\": [{\"name\": \"subitem\", \"sub_items\": []}],\n-        \"name\": \"item\",\n-    }\n-\n-    response = client.get(\"/items/recursive-submodel\")\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\n-        \"name\": \"item\",\n-        \"sub_items1\": [\n-            {\n-                \"name\": \"subitem\",\n-                \"sub_items2\": [\n-                    {\n-                        \"name\": \"subsubitem\",\n-                        \"sub_items1\": [{\"name\": \"subsubsubitem\", \"sub_items2\": []}],\n-                    }\n-                ],\n-            }\n-        ],\n-    }\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Simplify tests for `validate_response_recursive`", "source": "pr", "type": "code_review", "pr_number": 531}
{"instruction": "Fix the following bug: üêõ Fix extraction of BaseModel fields for openapi", "input": "Fixes second half of issue #13400", "output": "```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n \n \n def get_flat_params(dependant: Dependant) -> List[ModelField]:\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 530}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n \n \n def get_flat_params(dependant: Dependant) -> List[ModelField]:\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```", "output": "Bug: üêõ Fix extraction of BaseModel fields for openapi\n\nFixes second half of issue #13400", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 530}
{"instruction": "Review the following code changes: üêõ Fix extraction of BaseModel fields for openapi", "input": "```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n \n \n def get_flat_params(dependant: Dependant) -> List[ModelField]:\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```\n\n```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```", "output": "Code Review for: üêõ Fix extraction of BaseModel fields for openapi\n\nüìù **fastapi/dependencies/utils.py**: I don't think you can't unpack an iterable object inside of a list comprehension like that...?\n\n", "source": "pr", "type": "code_review", "pr_number": 530}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -210,13 +210,16 @@ def get_flat_dependant(\n \n \n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n-    if not fields:\n-        return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+    extracted_fields = []\n+\n+    for field in fields:\n+        if lenient_issubclass(field.type_, BaseModel):\n+            model_fields = get_cached_model_fields(field.type_)\n+            extracted_fields.extend(model_fields)\n+        else:\n+            extracted_fields.append(field)\n+\n+    return extracted_fields\n\n```", "output": "I don't think you can't unpack an iterable object inside of a list comprehension like that...?", "source": "pr_review", "type": "inline_review", "pr_number": 530}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor tests in `tests/test_tutorial/test_cors/test_tutorial001.py`", "input": "```diff\n@@ -1,37 +1,113 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n-from docs_src.cors.tutorial001 import app\n-\n-\n-def test_cors():\n-    client = TestClient(app)\n-    # Test pre-flight response\n-    headers = {\n-        \"Origin\": \"https://localhost.tiangolo.com\",\n-        \"Access-Control-Request-Method\": \"GET\",\n-        \"Access-Control-Request-Headers\": \"X-Example\",\n-    }\n-    response = client.options(\"/\", headers=headers)\n-    assert response.status_code == 200, response.text\n-    assert response.text == \"OK\"\n-    assert (\n-        response.headers[\"access-control-allow-origin\"]\n-        == \"https://localhost.tiangolo.com\"\n-    )\n-    assert response.headers[\"access-control-allow-headers\"] == \"X-Example\"\n-\n-    # Test standard response\n-    headers = {\"Origin\": \"https://localhost.tiangolo.com\"}\n-    response = client.get(\"/\", headers=headers)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"message\": \"Hello World\"}\n-    assert (\n-        response.headers[\"access-control-allow-origin\"]\n-        == \"https://localhost.tiangolo.com\"\n-    )\n-\n-    # Test non-CORS response\n-    response = client.get(\"/\")\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"message\": \"Hello World\"}\n-    assert \"access-control-allow-origin\" not in response.headers\n+from docs_src.cors.tutorial001 import app, origins\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_test_client():\n+    return TestClient(app)\n+\n+\n+class TestCORS:\n+    allowed_origins = origins\n+\n+    @pytest.mark.parametrize(\"allowed_origin_url\", origins)\n+    def test_preflight_with_allowed_origin(self, client, allowed_origin_url):\n+        origin_url = allowed_origin_url\n+        headers = {\n+            \"Origin\": origin_url,\n+            \"Access-Control-Request-Method\": \"GET\",\n+            \"Access-Control-Request-Headers\": \"X-Example-1, X-Example-2\",\n+        }\n+        response = client.options(\"/\", headers=headers)\n+        assert origin_url in self.allowed_origins\n+        # response\n+        assert response.status_code == 200\n+        assert response.text == \"OK\"\n+        # response headers: cors\n+        assert \"access-control-allow-methods\" in response.headers\n+        assert \"access-control-allow-credentials\" in response.headers\n+        assert \"access-control-max-age\" in response.headers\n+        assert \"access-control-allow-headers\" in response.headers\n+        assert (\n+            response.headers[\"access-control-allow-headers\"]\n+            == \"X-Example-1, X-Example-2\"\n+        )\n+        # response headers: cors: origin\n+        assert \"access-control-allow-origin\" in response.headers\n+        assert response.headers[\"access-control-allow-origin\"] == origin_url\n+\n+    def test_preflight_with_not_allowed_origin(self, client):\n+        origin_url = \"https://www.example.com\"\n+        headers = {\n+            \"Origin\": origin_url,\n+            \"Access-Control-Request-Method\": \"GET\",\n+            \"Access-Control-\n\n```\n\n```diff\n@@ -1,37 +1,103 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n-from docs_src.cors.tutorial001 import app\n-\n-\n-def test_cors():\n-    client = TestClient(app)\n-    # Test pre-flight response\n-    headers = {\n-        \"Origin\": \"https://localhost.tiangolo.com\",\n-        \"Access-Control-Request-Method\": \"GET\",\n-        \"Access-Control-Request-Headers\": \"X-Example\",\n-    }\n-    response = client.options(\"/\", headers=headers)\n-    assert response.status_code == 200, response.text\n-    assert response.text == \"OK\"\n-    assert (\n-        response.headers[\"access-control-allow-origin\"]\n-        == \"https://localhost.tiangolo.com\"\n-    )\n-    assert response.headers[\"access-control-allow-headers\"] == \"X-Example\"\n-\n-    # Test standard response\n-    headers = {\"Origin\": \"https://localhost.tiangolo.com\"}\n-    response = client.get(\"/\", headers=headers)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"message\": \"Hello World\"}\n-    assert (\n-        response.headers[\"access-control-allow-origin\"]\n-        == \"https://localhost.tiangolo.com\"\n-    )\n-\n-    # Test non-CORS response\n-    response = client.get(\"/\")\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"message\": \"Hello World\"}\n-    assert \"access-control-allow-origin\" not in response.headers\n+from docs_src.cors.tutorial001 import app, origins\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_test_client():\n+    return TestClient(app)\n+\n+\n+class TestCORS:\n+    allowed_origins = origins\n+\n+    @pytest.mark.parametrize(\"allowed_origin_url\", origins)\n+    def test_preflight_with_allowed_origin(self, client, allowed_origin_url):\n+        origin_url = allowed_origin_url\n+        headers = {\n+            \"Origin\": origin_url,\n+            \"Access-Control-Request-Method\": \"GET\",\n+            \"Access-Control-Request-Headers\": \"X-Example\",\n+        }\n+        response = client.options(\"/\", headers=headers)\n+        assert ", "output": "Code Review for: ‚ôªÔ∏è Refactor tests in `tests/test_tutorial/test_cors/test_tutorial001.py`\n\nüìù **tests/test_tutorial/test_cors/test_tutorial001.py**: Don't see a point in this assertion. Do we need this?\n\nüìù **tests/test_tutorial/test_cors/test_tutorial001.py**: Could you please explain why you removed this line?\n\nüìù **tests/test_tutorial/test_cors/test_tutorial001.py**: ```suggestion\r\n        assert response.headers[\"access-control-allow-origin\"] == origin_url\r\n```\r\nI understand your point, but I think it's better to simplify such assertions\n\nüìù **tests/test_tutorial/test_cors/test_tutorial001.py**: ```suggestion\r\n        for header_key in MANDATORY_HEADERS:\r\n            assert header_key in response.headers\r\n```\r\nI think this will reduce code duplication and even make code more readable\n\n", "source": "pr", "type": "code_review", "pr_number": 529}
{"instruction": "Review this code change in `tests/test_tutorial/test_cors/test_tutorial001.py`", "input": "```diff\n@@ -1,37 +1,103 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n-from docs_src.cors.tutorial001 import app\n-\n-\n-def test_cors():\n-    client = TestClient(app)\n-    # Test pre-flight response\n-    headers = {\n-        \"Origin\": \"https://localhost.tiangolo.com\",\n-        \"Access-Control-Request-Method\": \"GET\",\n-        \"Access-Control-Request-Headers\": \"X-Example\",\n-    }\n-    response = client.options(\"/\", headers=headers)\n-    assert response.status_code == 200, response.text\n-    assert response.text == \"OK\"\n-    assert (\n-        response.headers[\"access-control-allow-origin\"]\n-        == \"https://localhost.tiangolo.com\"\n-    )\n-    assert response.headers[\"access-control-allow-headers\"] == \"X-Example\"\n-\n-    # Test standard response\n-    headers = {\"Origin\": \"https://localhost.tiangolo.com\"}\n-    response = client.get(\"/\", headers=headers)\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"message\": \"Hello World\"}\n-    assert (\n-        response.headers[\"access-control-allow-origin\"]\n-        == \"https://localhost.tiangolo.com\"\n-    )\n-\n-    # Test non-CORS response\n-    response = client.get(\"/\")\n-    assert response.status_code == 200, response.text\n-    assert response.json() == {\"message\": \"Hello World\"}\n-    assert \"access-control-allow-origin\" not in response.headers\n+from docs_src.cors.tutorial001 import app, origins\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_test_client():\n+    return TestClient(app)\n+\n+\n+class TestCORS:\n+    allowed_origins = origins\n+\n+    @pytest.mark.parametrize(\"allowed_origin_url\", origins)\n+    def test_preflight_with_allowed_origin(self, client, allowed_origin_url):\n+        origin_url = allowed_origin_url\n+        headers = {\n+            \"Origin\": origin_url,\n+            \"Access-Control-Request-Method\": \"GET\",\n+            \"Access-Control-Request-Headers\": \"X-Example\",\n+        }\n+        response = client.options(\"/\", headers=headers)\n+        assert origin_url in self.allowed_origins\n\n```", "output": "Don't see a point in this assertion. Do we need this?", "source": "pr_review", "type": "inline_review", "pr_number": 529}
{"instruction": "Review the following code changes: ‚úÖ Simplify tests for request_forms_and_files", "input": "```diff\n@@ -1,14 +1,25 @@\n+import importlib\n+\n import pytest\n from dirty_equals import IsDict\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n+from ...utils import needs_py39\n+\n \n-@pytest.fixture(name=\"app\")\n-def get_app():\n-    from docs_src.request_forms_and_files.tutorial001 import app\n+@pytest.fixture(\n+    name=\"app\",\n+    params=[\n+        \"tutorial001\",\n+        \"tutorial001_an\",\n+        pytest.param(\"tutorial001_an_py39\", marks=needs_py39),\n+    ],\n+)\n+def get_app(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.request_forms_and_files.{request.param}\")\n \n-    return app\n+    return mod.app\n \n \n @pytest.fixture(name=\"client\")\n\n```\n\n```diff\n@@ -1,309 +0,0 @@\n-import pytest\n-from dirty_equals import IsDict\n-from fastapi import FastAPI\n-from fastapi.testclient import TestClient\n-\n-\n-@pytest.fixture(name=\"app\")\n-def get_app():\n-    from docs_src.request_forms_and_files.tutorial001_an import app\n-\n-    return app\n-\n-\n-@pytest.fixture(name=\"client\")\n-def get_client(app: FastAPI):\n-    client = TestClient(app)\n-    return client\n-\n-\n-def test_post_form_no_body(client: TestClient):\n-    response = client.post(\"/files/\")\n-    assert response.status_code == 422, response.text\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"file\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"fileb\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"token\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-            ]\n-        }\n-    ) | IsDict(\n-        # TODO: remove when deprecating Pydantic v1\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": [\"body\", \"file\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                },\n-                {\n-                    \"loc\": [\"body\", \"fileb\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                },\n-                {\n-                    \"loc\": [\"body\", \"token\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                },\n-            ]\n-        }\n-    )\n-\n-\n-def test_post_form_no_file(client: TestClient):\n-    response = client.post(\"/files/\", data={\"token\": \"foo\"})\n-    assert response.status_code == 422, response.text\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"file\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"fileb\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-            ]\n-        }\n-    ) | IsDict(\n-        # TODO: remove when deprecating Pydantic v1\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": [\"body\", \"file\"],\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                },\n-                {\n-                    \"loc\": [\"body\", \"fileb\"],\n-       \n\n```\n\n```diff\n@@ -1,317 +0,0 @@\n-import pytest\n-from dirty_equals import IsDict\n-from fastapi import FastAPI\n-from fastapi.testclient import TestClient\n-\n-from ...utils import needs_py39\n-\n-\n-@pytest.fixture(name=\"app\")\n-def get_app():\n-    from docs_src.request_forms_and_files.tutorial001_an_py39 import app\n-\n-    return app\n-\n-\n-@pytest.fixture(name=\"client\")\n-def get_client(app: FastAPI):\n-    client = TestClient(app)\n-    return client\n-\n-\n-@needs_py39\n-def test_post_form_no_body(client: TestClient):\n-    response = client.post(\"/files/\")\n-    assert response.status_code == 422, response.text\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"file\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"fileb\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-                },\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": [\"body\", \"token\"],\n-                    \"msg\": \"Field required\",\n-                    \"input\": None,\n-   ", "output": "Changes look good. This PR implements: ‚úÖ Simplify tests for request_forms_and_files", "source": "pr", "type": "code_review", "pr_number": 528}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor tests in `tests/test_openapi_separate_input_output_schemas.py`", "input": "```diff\n@@ -1,5 +1,6 @@\n from typing import List, Optional\n \n+import pytest\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n from pydantic import BaseModel\n@@ -23,7 +24,8 @@ class Item(BaseModel):\n         model_config = {\"json_schema_serialization_defaults_required\": True}\n \n \n-def get_app_client(separate_input_output_schemas: bool = True) -> TestClient:\n+@pytest.fixture(name=\"app\")\n+def custom_app(separate_input_output_schemas: bool) -> FastAPI:\n     app = FastAPI(separate_input_output_schemas=separate_input_output_schemas)\n \n     @app.post(\"/items/\", responses={402: {\"model\": Item}})\n@@ -45,47 +47,40 @@ def read_items() -> List[Item]:\n             Item(name=\"Plumbus\"),\n         ]\n \n-    client = TestClient(app)\n-    return client\n+    return app\n \n \n-def test_create_item():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True, False])\n+def test_create_item(app: FastAPI, separate_input_output_schemas: bool):\n+    client = TestClient(app)\n     response = client.post(\"/items/\", json={\"name\": \"Plumbus\"})\n-    response2 = client_no.post(\"/items/\", json={\"name\": \"Plumbus\"})\n-    assert response.status_code == response2.status_code == 200, response.text\n-    assert (\n-        response.json()\n-        == response2.json()\n-        == {\"name\": \"Plumbus\", \"description\": None, \"sub\": None}\n-    )\n \n+    assert app.separate_input_output_schemas == separate_input_output_schemas\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"name\": \"Plumbus\", \"description\": None, \"sub\": None}\n \n-def test_create_item_with_sub():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True, False])\n+def test_create_item_with_sub(app: FastAPI, separate_input_output_schemas: bool):\n+    client = TestClient(app)\n     data = {\n         \"name\": \"Plumbus\",\n         \"sub\": {\"subname\": \"SubPlumbus\", \"sub_description\": \"Sub WTF\"},\n     }\n     response = client.post(\"/items/\", json=data)\n-    response2 = client_no.post(\"/items/\", json=data)\n-    assert response.status_code == response2.status_code == 200, response.text\n-    assert (\n-        response.json()\n-        == response2.json()\n-        == {\n-            \"name\": \"Plumbus\",\n-            \"description\": None,\n-            \"sub\": {\"subname\": \"SubPlumbus\", \"sub_description\": \"Sub WTF\", \"tags\": []},\n-        }\n-    )\n \n+    assert app.separate_input_output_schemas == separate_input_output_schemas\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"name\": \"Plumbus\",\n+        \"description\": None,\n+        \"sub\": {\"subname\": \"SubPlumbus\", \"sub_description\": \"Sub WTF\", \"tags\": []},\n+    }\n \n-def test_create_item_list():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+\n+@p\n\n```\n\n```diff\n@@ -45,47 +47,40 @@ def read_items() -> List[Item]:\n             Item(name=\"Plumbus\"),\n         ]\n \n-    client = TestClient(app)\n-    return client\n+    return app\n \n \n-def test_create_item():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True, False])\n+def test_create_item(app: FastAPI, separate_input_output_schemas: bool):\n\n```\n\n```diff\n@@ -94,46 +89,44 @@ def test_create_item_list():\n         },\n     ]\n     response = client.post(\"/items-list/\", json=data)\n-    response2 = client_no.post(\"/items-list/\", json=data)\n-    assert response.status_code == response2.status_code == 200, response.text\n-    assert (\n-        response.json()\n-        == response2.json()\n-        == [\n-            {\"name\": \"Plumbus\", \"description\": None, \"sub\": None},\n-            {\n-                \"name\": \"Portal Gun\",\n-                \"description\": \"Device to travel through the multi-rick-verse\",\n-                \"sub\": None,\n-            },\n-        ]\n-    )\n+\n+    assert app.separate_input_output_schemas == separate_input_output_schemas\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\n+        {\"name\": \"Plumbus\", \"description\": None, \"sub\": None},\n+        {\n+            \"name\": \"Portal Gun\",\n+            \"description\": \"Device to travel through the multi-rick-verse\",\n+            \"sub\": None,\n+        },\n+    ]\n \n \n-def test_read_items():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True, False])\n+def test_read_items(app: FastAPI, separate_input_output_schemas: bool):\n+    client = TestClient(app)\n     response = client.get(\"/items/\")\n-    response2 = client_no.get(\"/items/\")\n-    assert response.status_code == response2.status_code == 200, response.text\n-    assert (\n-        response.json()\n-    ", "output": "Code Review for: ‚ôªÔ∏è Refactor tests in `tests/test_openapi_separate_input_output_schemas.py`\n\nüìù **tests/test_openapi_separate_input_output_schemas.py**: I would rename the testcase to be smt like: `test_create_item_when_separate_input_output_schemas_is`.\r\nIn that case we will have the clearer log output.\n\nüìù **tests/test_openapi_separate_input_output_schemas.py**: Can we join 2 test cases `test_openapi_schema` and `test_openapi_schema_no_separate` into one with parameterized (`True, False`)? The logic in both test cases are the same.\n\nüìù **tests/test_openapi_separate_input_output_schemas.py**: I do not agree with that:\r\n1) This was the initial name of the test. The renaming of tests is not the goal of this PR. \r\n\r\n2) Moreover, we already see the information on what do we test from the name of the test, and if we use the verbosity option -v, we will also see what value is set on the parameter in each of the tests. Hence there is no need to add an extra information to the name of the test.\n\nüìù **tests/test_openapi_separate_input_output_schemas.py**: I do not think so, the output schemas are different for `test_openapi_schema` and `test_openapi_schema_no_separate`\r\n\r\nThis is the excerpt from the code:\r\n\r\n```python\r\n        separate_input_output_schemas: Annotated[\r\n            bool,\r\n            Doc(\r\n                \"\"\"\r\n                Whether to generate separate OpenAPI schemas for request body and\r\n                response body when the results would be more precise.\r\n\r\n                This is particularly useful when automatically generating clients.\r\n\r\n                For example, if you have a model like:\r\n\r\n                ```python\r\n                from pydantic import BaseModel\r\n\r\n                class Item(BaseModel):\r\n                    name: str\r\n                    tags: list[str] = []\r\n                ```\r\n\r\n                When `Item` is used for input, a request body, `tags` is not required,\r\n                the client doesn't have to provide it.\r\n\r\n                But when using `Item` for output, for a response body, `tags` is always\r\n                available because it has a default value, even if it's just an empty\r\n                list. So, the client should be able to always expect it.\r\n\r\n                In this case, there would be two different schemas, one for input and\r\n                another one for output.\r\n                \"\"\"\r\n            ),\r\n        ] = True,\r\n```\n\nüìù **tests/test_openapi_separate_input_output_schemas.py**: That's what you actually see with your change and `-v` option activated:\r\n```\r\npytest tests/test_openapi_separate_input_output_schemas.py -v\r\n===================================================================== test session starts ======================================================================                                                                                                                                 \r\n\r\ntests/test_openapi_separate_input_output_schemas.py::test_create_item[True] PASSED                                                                       [ 10%]\r\ntests/test_openapi_separate_input_output_schemas.py::test_create_item[False] PASSED                                                                      [ 20%]\r\n```\r\n\r\nAnd that's how it will be after the change:\r\n```\r\npytest tests/test_openapi_separate_input_output_schemas.py -v\r\n===================================================================== test session starts ======================================================================                                                                                                                                 \r\n\r\ntests/test_openapi_separate_input_output_schemas.py::test_create_item_when_separate_input_output_schemas_is[True] PASSED                                 [ 10%]\r\ntests/test_openapi_separate_input_output_schemas.py::test_create_item_when_separate_input_output_schemas_is[False] PASSED                                [ 20%]    \r\n```\r\n\r\nSo right now it requires me to take a look into the testcase to understand what exactly is broken. But with more precise naming you get more info even when take a look on the test log. \r\nOverall that's not a big deal, as I said. Just a recommendation. Feel free to leave it as it is.\n\n", "source": "pr", "type": "code_review", "pr_number": 527}
{"instruction": "Review this code change in `tests/test_openapi_separate_input_output_schemas.py`", "input": "```diff\n@@ -45,47 +47,40 @@ def read_items() -> List[Item]:\n             Item(name=\"Plumbus\"),\n         ]\n \n-    client = TestClient(app)\n-    return client\n+    return app\n \n \n-def test_create_item():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True, False])\n+def test_create_item(app: FastAPI, separate_input_output_schemas: bool):\n\n```", "output": "I would rename the testcase to be smt like: `test_create_item_when_separate_input_output_schemas_is`.\r\nIn that case we will have the clearer log output.", "source": "pr_review", "type": "inline_review", "pr_number": 527}
{"instruction": "Review this code change in `tests/test_openapi_separate_input_output_schemas.py`", "input": "```diff\n@@ -94,46 +89,44 @@ def test_create_item_list():\n         },\n     ]\n     response = client.post(\"/items-list/\", json=data)\n-    response2 = client_no.post(\"/items-list/\", json=data)\n-    assert response.status_code == response2.status_code == 200, response.text\n-    assert (\n-        response.json()\n-        == response2.json()\n-        == [\n-            {\"name\": \"Plumbus\", \"description\": None, \"sub\": None},\n-            {\n-                \"name\": \"Portal Gun\",\n-                \"description\": \"Device to travel through the multi-rick-verse\",\n-                \"sub\": None,\n-            },\n-        ]\n-    )\n+\n+    assert app.separate_input_output_schemas == separate_input_output_schemas\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\n+        {\"name\": \"Plumbus\", \"description\": None, \"sub\": None},\n+        {\n+            \"name\": \"Portal Gun\",\n+            \"description\": \"Device to travel through the multi-rick-verse\",\n+            \"sub\": None,\n+        },\n+    ]\n \n \n-def test_read_items():\n-    client = get_app_client()\n-    client_no = get_app_client(separate_input_output_schemas=False)\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True, False])\n+def test_read_items(app: FastAPI, separate_input_output_schemas: bool):\n+    client = TestClient(app)\n     response = client.get(\"/items/\")\n-    response2 = client_no.get(\"/items/\")\n-    assert response.status_code == response2.status_code == 200, response.text\n-    assert (\n-        response.json()\n-        == response2.json()\n-        == [\n-            {\n-                \"name\": \"Portal Gun\",\n-                \"description\": \"Device to travel through the multi-rick-verse\",\n-                \"sub\": {\"subname\": \"subname\", \"sub_description\": None, \"tags\": []},\n-            },\n-            {\"name\": \"Plumbus\", \"description\": None, \"sub\": None},\n-        ]\n-    )\n+\n+    assert hasattr(app, \"separate_input_output_schemas\")\n+    assert app.separate_input_output_schemas == separate_input_output_schemas\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\n+        {\n+            \"name\": \"Portal Gun\",\n+            \"description\": \"Device to travel through the multi-rick-verse\",\n+            \"sub\": {\"subname\": \"subname\", \"sub_description\": None, \"tags\": []},\n+        },\n+        {\"name\": \"Plumbus\", \"description\": None, \"sub\": None},\n+    ]\n \n \n @needs_pydanticv2\n-def test_openapi_schema():\n-    client = get_app_client()\n+@pytest.mark.parametrize(\"separate_input_output_schemas\", [True])\n\n```", "output": "Can we join 2 test cases `test_openapi_schema` and `test_openapi_schema_no_separate` into one with parameterized (`True, False`)? The logic in both test cases are the same.", "source": "pr_review", "type": "inline_review", "pr_number": 527}
{"instruction": "Fix the following bug: ‚úÖ Fix a minor bug in the test `tests/test_modules_same_name_body/test_main.py`", "input": "Description: \r\n1.\r\n```\r\ndata = response.json()\r\n```\r\nhas been replaced with the assertion statement\r\n```\r\nassert data == response.json()\r\n```\r\n\r\n2.\r\nTests parametrization applied to reduce the duplicated code", "output": "```diff\n@@ -1,33 +1,27 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from .app.main import app\n \n client = TestClient(app)\n \n \n-def test_post_a():\n+@pytest.mark.parametrize(\n+    \"path\", [\"/a/compute\", \"/a/compute/\", \"/b/compute\", \"/b/compute/\"]\n+)\n+def test_post(path):\n     data = {\"a\": 2, \"b\": \"foo\"}\n-    response = client.post(\"/a/compute\", json=data)\n+    response = client.post(path, json=data)\n     assert response.status_code == 200, response.text\n-    data = response.json()\n+    assert data == response.json()\n \n \n-def test_post_a_invalid():\n+@pytest.mark.parametrize(\n+    \"path\", [\"/a/compute\", \"/a/compute/\", \"/b/compute\", \"/b/compute/\"]\n+)\n+def test_post_invalid(path):\n     data = {\"a\": \"bar\", \"b\": \"foo\"}\n-    response = client.post(\"/a/compute\", json=data)\n-    assert response.status_code == 422, response.text\n-\n-\n-def test_post_b():\n-    data = {\"a\": 2, \"b\": \"foo\"}\n-    response = client.post(\"/b/compute/\", json=data)\n-    assert response.status_code == 200, response.text\n-    data = response.json()\n-\n-\n-def test_post_b_invalid():\n-    data = {\"a\": \"bar\", \"b\": \"foo\"}\n-    response = client.post(\"/b/compute/\", json=data)\n+    response = client.post(path, json=data)\n     assert response.status_code == 422, response.text\n \n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 526}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,33 +1,27 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from .app.main import app\n \n client = TestClient(app)\n \n \n-def test_post_a():\n+@pytest.mark.parametrize(\n+    \"path\", [\"/a/compute\", \"/a/compute/\", \"/b/compute\", \"/b/compute/\"]\n+)\n+def test_post(path):\n     data = {\"a\": 2, \"b\": \"foo\"}\n-    response = client.post(\"/a/compute\", json=data)\n+    response = client.post(path, json=data)\n     assert response.status_code == 200, response.text\n-    data = response.json()\n+    assert data == response.json()\n \n \n-def test_post_a_invalid():\n+@pytest.mark.parametrize(\n+    \"path\", [\"/a/compute\", \"/a/compute/\", \"/b/compute\", \"/b/compute/\"]\n+)\n+def test_post_invalid(path):\n     data = {\"a\": \"bar\", \"b\": \"foo\"}\n-    response = client.post(\"/a/compute\", json=data)\n-    assert response.status_code == 422, response.text\n-\n-\n-def test_post_b():\n-    data = {\"a\": 2, \"b\": \"foo\"}\n-    response = client.post(\"/b/compute/\", json=data)\n-    assert response.status_code == 200, response.text\n-    data = response.json()\n-\n-\n-def test_post_b_invalid():\n-    data = {\"a\": \"bar\", \"b\": \"foo\"}\n-    response = client.post(\"/b/compute/\", json=data)\n+    response = client.post(path, json=data)\n     assert response.status_code == 422, response.text\n \n \n\n```", "output": "Bug: ‚úÖ Fix a minor bug in the test `tests/test_modules_same_name_body/test_main.py`\n\nDescription: \r\n1.\r\n```\r\ndata = response.json()\r\n```\r\nhas been replaced with the assertion statement\r\n```\r\nassert data == response.json()\r\n```\r\n\r\n2.\r\nTests parametrization applied to reduce the duplicated code", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 526}
{"instruction": "Review the following code changes: ‚úÖ Fix a minor bug in the test `tests/test_modules_same_name_body/test_main.py`", "input": "```diff\n@@ -1,33 +1,27 @@\n+import pytest\n from fastapi.testclient import TestClient\n \n from .app.main import app\n \n client = TestClient(app)\n \n \n-def test_post_a():\n+@pytest.mark.parametrize(\n+    \"path\", [\"/a/compute\", \"/a/compute/\", \"/b/compute\", \"/b/compute/\"]\n+)\n+def test_post(path):\n     data = {\"a\": 2, \"b\": \"foo\"}\n-    response = client.post(\"/a/compute\", json=data)\n+    response = client.post(path, json=data)\n     assert response.status_code == 200, response.text\n-    data = response.json()\n+    assert data == response.json()\n \n \n-def test_post_a_invalid():\n+@pytest.mark.parametrize(\n+    \"path\", [\"/a/compute\", \"/a/compute/\", \"/b/compute\", \"/b/compute/\"]\n+)\n+def test_post_invalid(path):\n     data = {\"a\": \"bar\", \"b\": \"foo\"}\n-    response = client.post(\"/a/compute\", json=data)\n-    assert response.status_code == 422, response.text\n-\n-\n-def test_post_b():\n-    data = {\"a\": 2, \"b\": \"foo\"}\n-    response = client.post(\"/b/compute/\", json=data)\n-    assert response.status_code == 200, response.text\n-    data = response.json()\n-\n-\n-def test_post_b_invalid():\n-    data = {\"a\": \"bar\", \"b\": \"foo\"}\n-    response = client.post(\"/b/compute/\", json=data)\n+    response = client.post(path, json=data)\n     assert response.status_code == 422, response.text\n \n \n\n```", "output": "Changes look good. This PR implements: ‚úÖ Fix a minor bug in the test `tests/test_modules_same_name_body/test_main.py`", "source": "pr", "type": "code_review", "pr_number": 526}
{"instruction": "Fix the following bug: ‚úÖ Fix `test_exception_handler_body_access`", "input": "Im honestly not certain what has changed, but in a recent Debian system, this tests fails.\n\nthe changes are minor, but given it's a string, space characters matter.", "output": "```diff\n@@ -27,6 +27,20 @@ def test_exception_handler_body_access():\n                 \"body\": '{\"numbers\": [1, 2, 3]}',\n             }\n         }\n+    ) | IsDict(\n+        {\n+            \"detail\": {\n+                \"errors\": [\n+                    {\n+                        \"type\": \"list_type\",\n+                        \"loc\": [\"body\"],\n+                        \"msg\": \"Input should be a valid list\",\n+                        \"input\": {\"numbers\": [1, 2, 3]},\n+                    }\n+                ],\n+                \"body\": '{\"numbers\":[1,2,3]}',\n+            }\n+        }\n     ) | IsDict(\n         # TODO: remove when deprecating Pydantic v1\n         {\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 525}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -27,6 +27,20 @@ def test_exception_handler_body_access():\n                 \"body\": '{\"numbers\": [1, 2, 3]}',\n             }\n         }\n+    ) | IsDict(\n+        {\n+            \"detail\": {\n+                \"errors\": [\n+                    {\n+                        \"type\": \"list_type\",\n+                        \"loc\": [\"body\"],\n+                        \"msg\": \"Input should be a valid list\",\n+                        \"input\": {\"numbers\": [1, 2, 3]},\n+                    }\n+                ],\n+                \"body\": '{\"numbers\":[1,2,3]}',\n+            }\n+        }\n     ) | IsDict(\n         # TODO: remove when deprecating Pydantic v1\n         {\n\n```", "output": "Bug: ‚úÖ Fix `test_exception_handler_body_access`\n\nIm honestly not certain what has changed, but in a recent Debian system, this tests fails.\n\nthe changes are minor, but given it's a string, space characters matter.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 525}
{"instruction": "Review the following code changes: ‚úÖ Fix `test_exception_handler_body_access`", "input": "```diff\n@@ -27,6 +27,20 @@ def test_exception_handler_body_access():\n                 \"body\": '{\"numbers\": [1, 2, 3]}',\n             }\n         }\n+    ) | IsDict(\n+        {\n+            \"detail\": {\n+                \"errors\": [\n+                    {\n+                        \"type\": \"list_type\",\n+                        \"loc\": [\"body\"],\n+                        \"msg\": \"Input should be a valid list\",\n+                        \"input\": {\"numbers\": [1, 2, 3]},\n+                    }\n+                ],\n+                \"body\": '{\"numbers\":[1,2,3]}',\n+            }\n+        }\n     ) | IsDict(\n         # TODO: remove when deprecating Pydantic v1\n         {\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Fix `test_exception_handler_body_access`", "source": "pr", "type": "code_review", "pr_number": 525}
{"instruction": "Review the following code changes: üìù Add documentary to website", "input": "```diff\n@@ -120,6 +120,12 @@ The key features are:\n \n ---\n \n+## FastAPI mini documentary\n+\n+There's a <a href=\"https://www.youtube.com/watch?v=mpR8ngthqiE\" class=\"external-link\" target=\"_blank\">FastAPI mini documentary</a> released at the end of 2025, you can watch it online:\n+\n+<a href=\"https://www.youtube.com/watch?v=mpR8ngthqiE\" target=\"_blank\"><img src=\"https://fastapi.tiangolo.com/img/fastapi-documentary.jpg\" alt=\"FastAPI Mini Documentary\"></a>\n+\n ## **Typer**, the FastAPI of CLIs\n \n <a href=\"https://typer.tiangolo.com\" target=\"_blank\"><img src=\"https://typer.tiangolo.com/img/logo-margin/logo-margin-vector.svg\" style=\"width: 20%;\"></a>\n\n```\n\n```diff\n@@ -117,6 +117,12 @@ The key features are:\n \n ---\n \n+## FastAPI mini documentary { #fastapi-mini-documentary }\n+\n+There's a <a href=\"https://www.youtube.com/watch?v=mpR8ngthqiE\" class=\"external-link\" target=\"_blank\">FastAPI mini documentary</a> released at the end of 2025, you can watch it online:\n+\n+<a href=\"https://www.youtube.com/watch?v=mpR8ngthqiE\" target=\"_blank\"><img src=\"https://fastapi.tiangolo.com/img/fastapi-documentary.jpg\" alt=\"FastAPI Mini Documentary\"></a>\n+\n ## **Typer**, the FastAPI of CLIs { #typer-the-fastapi-of-clis }\n \n <a href=\"https://typer.tiangolo.com\" target=\"_blank\"><img src=\"https://typer.tiangolo.com/img/logo-margin/logo-margin-vector.svg\" style=\"width: 20%;\"></a>\n\n```", "output": "Changes look good. This PR implements: üìù Add documentary to website", "source": "pr", "type": "code_review", "pr_number": 524}
{"instruction": "Fix the following bug: Fix consider alias in form", "input": "Addresses [#10024](https://github.com/tiangolo/fastapi/discussions/10024) and [#10286](https://github.com/tiangolo/fastapi/issues/10286)\r\nNow, alias is considered in swagger and redoc docs", "output": "```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```\n\n```diff\n@@ -93,7 +93,10 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            a = (\n+                isinstance(self.field_info.validation_alias, str)\n+                and self.field_info.validation_alias\n+            ) or self.field_info.alias\n             return a if a is not None else self.name\n \n         @property\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n+            f\"{f.alias}\": (f.field_info.annotation, f.field_info) for f in fields\n+        }\n         BodyModel: Type[BaseModel] = create_model(model_name, **field_params)  # type: ignore[call-overload]\n         return BodyModel\n \n\n```\n\n```diff\n@@ -0,0 +1,58 @@\n+\"\"\"\n+testing to fix incompatibility with alias and validation_alias between fastapi and PYDANTIC_V2\n+\"\"\"\n+\n+from fastapi import FastAPI, Form\n+from fastapi._compat import PYDANTIC_V2\n+from starlette.testclient import TestClient\n+\n+app: FastAPI = FastAPI()\n+\n+\n+@app.post(\"/testing_alias\")\n+async def check_alias(id_test: int = Form(alias=\"otherId\")):\n+    return {\"other_id\": id_test}\n+\n+\n+@app.post(\"/testing_validation_alias\")\n+async def check_validation_alias(id_test: int = Form(validation_alias=\"otherId\")):\n+    return {\"other_id\": id_test}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_get_alias():\n+    response = client.post(\"/testing_alias\", data={\"otherId\": \"1\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"other_id\": 1}\n+\n+\n+def test_get_validation_alias():\n+    if PYDANTIC_V2:\n+        data = {\"otherId\": \"1\"}\n+    else:\n+        data = {\"id_test\": \"1\"}\n+    response = client.post(\"/testing_validation_alias\", data=data)\n+    assert response.status_code == 200\n+    assert response.json() == {\"other_id\": 1}\n+\n+\n+def test_file_alias_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    if PYDANTIC_V2:\n+        schema = response.json()\n+        assert (\n+            \"otherId\"\n+            in schema[\"components\"][\"schemas\"][\"Body_check_alias_testing_alias_post\"][\n+                \"properties\"\n+            ]\n+        )\n+\n+        assert (\n+            \"otherId\"\n+            in schema[\"components\"][\"schemas\"][\n+                \"Body_check_validation_alias_testing_validation_alias_post\"\n+            ][\"properties\"]\n+        )\n\n```\n\n```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```\n\n```diff\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 523}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```\n\n```diff\n@@ -93,7 +93,10 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            a = (\n+                isinstance(self.field_info.validation_alias, str)\n+                and self.field_info.validation_alias\n+            ) or self.field_info.alias\n             return a if a is not None else self.name\n \n         @property\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n+            f\"{f.alias}\": (f.field_info.annotation, f.field_info) for f in fields\n+        }\n         BodyModel: Type[BaseModel] = create_model(model_name, **field_params)  # type: ignore[call-overload]\n         return BodyModel\n \n\n```\n\n```diff\n@@ -0,0 +1,58 @@\n+\"\"\"\n+testing to fix incompatibility with alias and validation_alias between fastapi and PYDANTIC_V2\n+\"\"\"\n+\n+from fastapi import FastAPI, Form\n+from fastapi._compat import PYDANTIC_V2\n+from starlette.testclient import TestClient\n+\n+app: FastAPI = FastAPI()\n+\n+\n+@app.post(\"/testing_alias\")\n+async def check_alias(id_test: int = Form(alias=\"otherId\")):\n+    return {\"other_id\": id_test}\n+\n+\n+@app.post(\"/testing_validation_alias\")\n+async def check_validation_alias(id_test: int = Form(validation_alias=\"otherId\")):\n+    return {\"other_id\": id_test}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_get_alias():\n+    response = client.post(\"/testing_alias\", data={\"otherId\": \"1\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"other_id\": 1}\n+\n+\n+def test_get_validation_alias():\n+    if PYDANTIC_V2:\n+        data = {\"otherId\": \"1\"}\n+    else:\n+        data = {\"id_test\": \"1\"}\n+    response = client.post(\"/testing_validation_alias\", data=data)\n+    assert response.status_code == 200\n+    assert response.json() == {\"other_id\": 1}\n+\n+\n+def test_file_alias_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    if PYDANTIC_V2:\n+        schema = response.json()\n+        assert (\n+            \"otherId\"\n+            in schema[\"components\"][\"schemas\"][\"Body_check_alias_testing_alias_post\"][\n+                \"properties\"\n+            ]\n+        )\n+\n+        assert (\n+            \"otherId\"\n+            in schema[\"components\"][\"schemas\"][\n+                \"Body_check_validation_alias_testing_validation_alias_post\"\n+            ][\"properties\"]\n+        )\n\n```\n\n```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```\n\n```diff\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n\n```", "output": "Bug: Fix consider alias in form\n\nAddresses [#10024](https://github.com/tiangolo/fastapi/discussions/10024) and [#10286](https://github.com/tiangolo/fastapi/issues/10286)\r\nNow, alias is considered in swagger and redoc docs", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 523}
{"instruction": "Review the following code changes: Fix consider alias in form", "input": "```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```\n\n```diff\n@@ -93,7 +93,10 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            a = (\n+                isinstance(self.field_info.validation_alias, str)\n+                and self.field_info.validation_alias\n+            ) or self.field_info.alias\n             return a if a is not None else self.name\n \n         @property\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n+            f\"{f.alias}\": (f.field_info.annotation, f.field_info) for f in fields\n+        }\n         BodyModel: Type[BaseModel] = create_model(model_name, **field_params)  # type: ignore[call-overload]\n         return BodyModel\n \n\n```\n\n```diff\n@@ -0,0 +1,58 @@\n+\"\"\"\n+testing to fix incompatibility with alias and validation_alias between fastapi and PYDANTIC_V2\n+\"\"\"\n+\n+from fastapi import FastAPI, Form\n+from fastapi._compat import PYDANTIC_V2\n+from starlette.testclient import TestClient\n+\n+app: FastAPI = FastAPI()\n+\n+\n+@app.post(\"/testing_alias\")\n+async def check_alias(id_test: int = Form(alias=\"otherId\")):\n+    return {\"other_id\": id_test}\n+\n+\n+@app.post(\"/testing_validation_alias\")\n+async def check_validation_alias(id_test: int = Form(validation_alias=\"otherId\")):\n+    return {\"other_id\": id_test}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_get_alias():\n+    response = client.post(\"/testing_alias\", data={\"otherId\": \"1\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"other_id\": 1}\n+\n+\n+def test_get_validation_alias():\n+    if PYDANTIC_V2:\n+        data = {\"otherId\": \"1\"}\n+    else:\n+        data = {\"id_test\": \"1\"}\n+    response = client.post(\"/testing_validation_alias\", data=data)\n+    assert response.status_code == 200\n+    assert response.json() == {\"other_id\": 1}\n+\n+\n+def test_file_alias_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    if PYDANTIC_V2:\n+        schema = response.json()\n+        assert (\n+            \"otherId\"\n+            in schema[\"components\"][\"schemas\"][\"Body_check_alias_testing_alias_post\"][\n+                \"properties\"\n+            ]\n+        )\n+\n+        assert (\n+            \"otherId\"\n+            in schema[\"components\"][\"schemas\"][\n+                \"Body_check_validation_alias_testing_validation_alias_post\"\n+            ][\"properties\"]\n+        )\n\n```\n\n```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```\n\n```diff\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n\n```", "output": "Code Review for: Fix consider alias in form\n\nüìù **.gitignore**: ```suggestion\r\n```\r\nAvoid adding unnecessary changes\n\nüìù **fastapi/_compat.py**: I think this is incorrect. We should solve this the way it's done in #10257 (by fixing `serialization_alias` in `field_info`)\n\nüìù **fastapi/_compat.py**: ```suggestion\r\n        va = self.field_info.validation_alias\r\n        if isinstance(va, str) and va:\r\n            return va\r\n        a = self.field_info.alias\r\n```\r\nI think this way it's easier to read\n\nüìù **fastapi/_compat.py**: Hello @YuriiMotov . I would have to review what has changed in the latest versions of FastAPI and verify that the error persists. I will close this PR since I believe it has been too long since it was opened, and if I find that this error persists, I will open a new one.\n\n", "source": "pr", "type": "code_review", "pr_number": 523}
{"instruction": "Review this code change in `.gitignore`", "input": "```diff\n@@ -28,3 +28,4 @@ archive.zip\n \n # macOS\n .DS_Store\n+.python-version\n\n```", "output": "```suggestion\r\n```\r\nAvoid adding unnecessary changes", "source": "pr_review", "type": "inline_review", "pr_number": 523}
{"instruction": "Review this code change in `fastapi/_compat.py`", "input": "```diff\n@@ -282,7 +285,9 @@ def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n     def create_body_model(\n         *, fields: Sequence[ModelField], model_name: str\n     ) -> Type[BaseModel]:\n-        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}\n+        field_params = {\n\n```", "output": "I think this is incorrect. We should solve this the way it's done in #10257 (by fixing `serialization_alias` in `field_info`)", "source": "pr_review", "type": "inline_review", "pr_number": 523}
{"instruction": "Review this code change in `fastapi/_compat.py`", "input": "```diff\n@@ -93,7 +93,10 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            a = (\n+                isinstance(self.field_info.validation_alias, str)\n+                and self.field_info.validation_alias\n+            ) or self.field_info.alias\n\n```", "output": "```suggestion\r\n        va = self.field_info.validation_alias\r\n        if isinstance(va, str) and va:\r\n            return va\r\n        a = self.field_info.alias\r\n```\r\nI think this way it's easier to read", "source": "pr_review", "type": "inline_review", "pr_number": 523}
{"instruction": "Fix the following bug: Fix Annotated with ForwardRef when using future annotations", "input": "## Summary\n- Fixes issue where `Annotated[SomeClass, Depends()]` with forward references failed when using `from __future__ import annotations`\n- Adds partial resolution of Annotated string annotations to extract metadata (Depends, Query, etc.) even when the inner type cannot be fully resolved\n- Uses `get_type_hints()` with `include_extras=True` for better forward reference resolution\n\n## Test plan\n- [x] New test case `test_annotated_forward_ref.py` that reproduces issue #13056\n- [x] Existing dependency-related tests pass\n\nFixes #13056", "output": "```diff\n@@ -221,6 +221,22 @@ def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n     signature = _get_signature(call)\n     unwrapped = inspect.unwrap(call)\n     globalns = getattr(unwrapped, \"__globals__\", {})\n+\n+    # Get updated globalns from the module (in case classes were defined after the function)\n+    # This is needed for forward references when using `from __future__ import annotations`\n+    module_name = getattr(unwrapped, \"__module__\", None)\n+    if module_name:\n+        import importlib\n+\n+        try:\n+            module = importlib.import_module(module_name)\n+            # Merge module namespace with function's globalns\n+            # Function's globalns takes precedence for imports made in the function's scope\n+            updated_globalns = {**vars(module), **globalns}\n+            globalns = updated_globalns\n+        except Exception:\n+            pass\n+\n     typed_params = [\n         inspect.Parameter(\n             name=param.name,\n@@ -236,13 +252,119 @@ def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n \n def get_typed_annotation(annotation: Any, globalns: dict[str, Any]) -> Any:\n     if isinstance(annotation, str):\n+        # Special handling for Annotated types with forward references\n+        # When using `from __future__ import annotations`, the entire annotation\n+        # becomes a string like \"Annotated[SomeClass, Depends(func)]\"\n+        # We try to partially resolve it to preserve the Annotated structure\n+        if annotation.startswith(\"Annotated[\"):\n+            try:\n+                # Try to evaluate the full annotation with available globalns\n+                evaluated = evaluate_forwardref(\n+                    ForwardRef(annotation), globalns, globalns\n+                )\n+                # If evaluation succeeds and it's an Annotated type, return it\n+                if get_origin(evaluated) is Annotated:\n+                    return evaluated\n+                # If evaluation returns a ForwardRef, try partial resolution\n+                if isinstance(evaluated, ForwardRef) or (\n+                    hasattr(evaluated, \"__forward_arg__\")\n+                ):\n+                    # Try to parse and construct Annotated manually\n+                    partial = _try_resolve_annotated_string(annotation, globalns)\n+                    if partial is not None:\n+                        return partial\n+            except Exception:\n+                # Try partial resolution as fallback\n+                partial = _try_resolve_annotated_string(annotation, globalns)\n+                if partial is not None:\n+                    return partial\n+\n         annotation = ForwardRef(annotation)\n         annotation = evaluate_forwardref(annotation, globalns, globalns)\n         if annotation is type(None):\n             return None\n     return annotation\n \n \n+def _try_resolve_annotated_string(annotation_str: str, globalns: dict[str, Any]) -> Any:\n+    \"\"\"\n+    Try to partially resolve an Annotated string an\n\n```\n\n```diff\n@@ -0,0 +1,238 @@\n+\"\"\"Test case for issue #13056: Can't use `Annotated` with `ForwardRef`\"\"\"\n+\n+from __future__ import annotations\n+\n+from dataclasses import dataclass\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+def get_potato() -> Potato:\n+    return Potato(color=\"red\", size=10)\n+\n+\n+@app.get(\"/\")\n+async def read_root(potato: Annotated[Potato, Depends(get_potato)]):\n+    return {\"color\": potato.color, \"size\": potato.size}\n+\n+\n+@dataclass\n+class Potato:\n+    color: str\n+    size: int\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_annotated_forward_ref():\n+    \"\"\"Test that forward references work correctly with Annotated dependencies.\"\"\"\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data == {\"color\": \"red\", \"size\": 10}\n+\n+\n+def test_openapi_schema():\n+    \"\"\"Test that OpenAPI schema is generated correctly.\"\"\"\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200\n+    schema = response.json()\n+    # The root path should NOT have query parameters for potato\n+    # It should only be a dependency\n+    root_path = schema[\"paths\"][\"/\"][\"get\"]\n+    # Check that potato is not a query parameter\n+    parameters = root_path.get(\"parameters\", [])\n+    potato_params = [p for p in parameters if \"potato\" in p.get(\"name\", \"\").lower()]\n+    assert len(potato_params) == 0, (\n+        f\"Potato should not appear as a query parameter: {potato_params}\"\n+    )\n+\n+\n+def test_try_resolve_annotated_string_invalid_format():\n+    \"\"\"Test _try_resolve_annotated_string with invalid annotation formats.\"\"\"\n+    from fastapi.dependencies.utils import _try_resolve_annotated_string\n+\n+    # Test with annotation that doesn't start with \"Annotated[\"\n+    result = _try_resolve_annotated_string(\"str\", {})\n+    assert result is None\n+\n+    # Test with annotation that doesn't end with \"]\"\n+    result = _try_resolve_annotated_string(\"Annotated[str\", {})\n+    assert result is None\n+\n+    # Test with annotation without comma (no metadata)\n+    result = _try_resolve_annotated_string(\"Annotated[str]\", {})\n+    assert result is None\n+\n+\n+def test_try_resolve_annotated_string_non_depends_metadata():\n+    \"\"\"Test _try_resolve_annotated_string returns None for non-Depends metadata.\"\"\"\n+    from fastapi import Query\n+    from fastapi.dependencies.utils import _try_resolve_annotated_string\n+\n+    # Query metadata should return None (we need actual type for Query)\n+    globalns = {\"Query\": Query}\n+    result = _try_resolve_annotated_string(\"Annotated[str, Query()]\", globalns)\n+    assert result is None\n+\n+\n+def test_try_resolve_annotated_string_eval_failure():\n+    \"\"\"Test _try_resolve_annotated_string handles eval failures.\"\"\"\n+    from fastapi.dependencies.utils import _try_resolve_annotated_string\n+\n+    # Invalid metadata expression that can't be evaluated\n+    result = _try_resolve_annotated_string(\"Annotated[st\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 522}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -221,6 +221,22 @@ def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n     signature = _get_signature(call)\n     unwrapped = inspect.unwrap(call)\n     globalns = getattr(unwrapped, \"__globals__\", {})\n+\n+    # Get updated globalns from the module (in case classes were defined after the function)\n+    # This is needed for forward references when using `from __future__ import annotations`\n+    module_name = getattr(unwrapped, \"__module__\", None)\n+    if module_name:\n+        import importlib\n+\n+        try:\n+            module = importlib.import_module(module_name)\n+            # Merge module namespace with function's globalns\n+            # Function's globalns takes precedence for imports made in the function's scope\n+            updated_globalns = {**vars(module), **globalns}\n+            globalns = updated_globalns\n+        except Exception:\n+            pass\n+\n     typed_params = [\n         inspect.Parameter(\n             name=param.name,\n@@ -236,13 +252,119 @@ def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n \n def get_typed_annotation(annotation: Any, globalns: dict[str, Any]) -> Any:\n     if isinstance(annotation, str):\n+        # Special handling for Annotated types with forward references\n+        # When using `from __future__ import annotations`, the entire annotation\n+        # becomes a string like \"Annotated[SomeClass, Depends(func)]\"\n+        # We try to partially resolve it to preserve the Annotated structure\n+        if annotation.startswith(\"Annotated[\"):\n+            try:\n+                # Try to evaluate the full annotation with available globalns\n+                evaluated = evaluate_forwardref(\n+                    ForwardRef(annotation), globalns, globalns\n+                )\n+                # If evaluation succeeds and it's an Annotated type, return it\n+                if get_origin(evaluated) is Annotated:\n+                    return evaluated\n+                # If evaluation returns a ForwardRef, try partial resolution\n+                if isinstance(evaluated, ForwardRef) or (\n+                    hasattr(evaluated, \"__forward_arg__\")\n+                ):\n+                    # Try to parse and construct Annotated manually\n+                    partial = _try_resolve_annotated_string(annotation, globalns)\n+                    if partial is not None:\n+                        return partial\n+            except Exception:\n+                # Try partial resolution as fallback\n+                partial = _try_resolve_annotated_string(annotation, globalns)\n+                if partial is not None:\n+                    return partial\n+\n         annotation = ForwardRef(annotation)\n         annotation = evaluate_forwardref(annotation, globalns, globalns)\n         if annotation is type(None):\n             return None\n     return annotation\n \n \n+def _try_resolve_annotated_string(annotation_str: str, globalns: dict[str, Any]) -> Any:\n+    \"\"\"\n+    Try to partially resolve an Annotated string an\n\n```\n\n```diff\n@@ -0,0 +1,238 @@\n+\"\"\"Test case for issue #13056: Can't use `Annotated` with `ForwardRef`\"\"\"\n+\n+from __future__ import annotations\n+\n+from dataclasses import dataclass\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+def get_potato() -> Potato:\n+    return Potato(color=\"red\", size=10)\n+\n+\n+@app.get(\"/\")\n+async def read_root(potato: Annotated[Potato, Depends(get_potato)]):\n+    return {\"color\": potato.color, \"size\": potato.size}\n+\n+\n+@dataclass\n+class Potato:\n+    color: str\n+    size: int\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_annotated_forward_ref():\n+    \"\"\"Test that forward references work correctly with Annotated dependencies.\"\"\"\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data == {\"color\": \"red\", \"size\": 10}\n+\n+\n+def test_openapi_schema():\n+    \"\"\"Test that OpenAPI schema is generated correctly.\"\"\"\n+", "output": "Bug: Fix Annotated with ForwardRef when using future annotations\n\n## Summary\n- Fixes issue where `Annotated[SomeClass, Depends()]` with forward references failed when using `from __future__ import annotations`\n- Adds partial resolution of Annotated string annotations to extract metadata (Depends, Query, etc.) even when the inner type cannot be fully resolved\n- Uses `get_type_hints()` with `include_extras=True` for better forward reference resolution\n\n## Test plan\n- [x] New test case `test_annotated_forward_ref.py` that reproduces issue #13056\n- [x] Existing dependency-related tests pass\n\nFixes #13056", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 522}
{"instruction": "Review the following code changes: Fix Annotated with ForwardRef when using future annotations", "input": "```diff\n@@ -221,6 +221,22 @@ def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n     signature = _get_signature(call)\n     unwrapped = inspect.unwrap(call)\n     globalns = getattr(unwrapped, \"__globals__\", {})\n+\n+    # Get updated globalns from the module (in case classes were defined after the function)\n+    # This is needed for forward references when using `from __future__ import annotations`\n+    module_name = getattr(unwrapped, \"__module__\", None)\n+    if module_name:\n+        import importlib\n+\n+        try:\n+            module = importlib.import_module(module_name)\n+            # Merge module namespace with function's globalns\n+            # Function's globalns takes precedence for imports made in the function's scope\n+            updated_globalns = {**vars(module), **globalns}\n+            globalns = updated_globalns\n+        except Exception:\n+            pass\n+\n     typed_params = [\n         inspect.Parameter(\n             name=param.name,\n@@ -236,13 +252,119 @@ def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n \n def get_typed_annotation(annotation: Any, globalns: dict[str, Any]) -> Any:\n     if isinstance(annotation, str):\n+        # Special handling for Annotated types with forward references\n+        # When using `from __future__ import annotations`, the entire annotation\n+        # becomes a string like \"Annotated[SomeClass, Depends(func)]\"\n+        # We try to partially resolve it to preserve the Annotated structure\n+        if annotation.startswith(\"Annotated[\"):\n+            try:\n+                # Try to evaluate the full annotation with available globalns\n+                evaluated = evaluate_forwardref(\n+                    ForwardRef(annotation), globalns, globalns\n+                )\n+                # If evaluation succeeds and it's an Annotated type, return it\n+                if get_origin(evaluated) is Annotated:\n+                    return evaluated\n+                # If evaluation returns a ForwardRef, try partial resolution\n+                if isinstance(evaluated, ForwardRef) or (\n+                    hasattr(evaluated, \"__forward_arg__\")\n+                ):\n+                    # Try to parse and construct Annotated manually\n+                    partial = _try_resolve_annotated_string(annotation, globalns)\n+                    if partial is not None:\n+                        return partial\n+            except Exception:\n+                # Try partial resolution as fallback\n+                partial = _try_resolve_annotated_string(annotation, globalns)\n+                if partial is not None:\n+                    return partial\n+\n         annotation = ForwardRef(annotation)\n         annotation = evaluate_forwardref(annotation, globalns, globalns)\n         if annotation is type(None):\n             return None\n     return annotation\n \n \n+def _try_resolve_annotated_string(annotation_str: str, globalns: dict[str, Any]) -> Any:\n+    \"\"\"\n+    Try to partially resolve an Annotated string an\n\n```\n\n```diff\n@@ -0,0 +1,238 @@\n+\"\"\"Test case for issue #13056: Can't use `Annotated` with `ForwardRef`\"\"\"\n+\n+from __future__ import annotations\n+\n+from dataclasses import dataclass\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+def get_potato() -> Potato:\n+    return Potato(color=\"red\", size=10)\n+\n+\n+@app.get(\"/\")\n+async def read_root(potato: Annotated[Potato, Depends(get_potato)]):\n+    return {\"color\": potato.color, \"size\": potato.size}\n+\n+\n+@dataclass\n+class Potato:\n+    color: str\n+    size: int\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_annotated_forward_ref():\n+    \"\"\"Test that forward references work correctly with Annotated dependencies.\"\"\"\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data == {\"color\": \"red\", \"size\": 10}\n+\n+\n+def test_openapi_schema():\n+    \"\"\"Test that OpenAPI schema is generated correctly.\"\"\"\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200\n+    schema = response.json()\n+    # The root path should NOT have query parameters for potato\n+    # It should only be a dependency\n+    root_path = schema[\"paths\"][\"/\"][\"get\"]\n+    # Check that potato is not a query parameter\n+    parameters = root_path.get(\"parameters\", [])\n+    potato_params = [p for p in parameters if \"potato\" in p.get(\"name\", \"\").lower()]\n+    assert len(potato_params) == 0, (\n+        f\"Potato should not appear as a query parameter: {potato_params}\"\n+    )\n+\n+\n+def test_try_resolve_annotated_string_invalid_format():\n+    \"\"\"Test _try_resolve_annotated_string with invalid annotation formats.\"\"\"\n+    from fastapi.dependencies.utils import _try_resolve_annotated_string\n+\n+    # Test with annotation that doesn't start with \"Annotated[\"\n+    result = _try_resolve_annotated_string(\"str\", {})\n+    assert result is None\n+\n+    # Test with annotation that doesn't end with \"]\"\n+    result =", "output": "Changes look good. This PR implements: Fix Annotated with ForwardRef when using future annotations", "source": "pr", "type": "code_review", "pr_number": 522}
{"instruction": "Review the following code changes: üåê Update translations for de (update-outdated)", "input": "```diff\n@@ -48,7 +48,7 @@ Sie k√∂nnen die verwendeten Zeilen aus dem Docstring einer *Pfadoperation-Funkti\n \n Das Hinzuf√ºgen eines `\\f` (ein maskiertes ‚ÄûForm Feed‚Äú-Zeichen) f√ºhrt dazu, dass **FastAPI** die f√ºr OpenAPI verwendete Ausgabe an dieser Stelle abschneidet.\n \n-Sie wird nicht in der Dokumentation angezeigt, aber andere Tools (z. B. Sphinx) k√∂nnen den Rest verwenden.\n+Sie wird nicht in der Dokumentation angezeigt, aber andere Tools (wie z. B. Sphinx) k√∂nnen den Rest verwenden.\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial004_py310.py hl[17:27] *}\n \n@@ -153,48 +153,16 @@ Und Sie k√∂nnten dies auch tun, wenn der Datentyp im Request nicht JSON ist.\n \n In der folgenden Anwendung verwenden wir beispielsweise weder die integrierte Funktionalit√§t von FastAPI zum Extrahieren des JSON-Schemas aus Pydantic-Modellen noch die automatische Validierung f√ºr JSON. Tats√§chlich deklarieren wir den Request-Content-Type als YAML und nicht als JSON:\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/path_operation_advanced_configuration/tutorial007_py39.py hl[15:20, 22] *}\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-{* ../../docs_src/path_operation_advanced_configuration/tutorial007_pv1_py39.py hl[15:20, 22] *}\n-\n-////\n-\n-/// info | Info\n-\n-In Pydantic Version 1 hie√ü die Methode zum Abrufen des JSON-Schemas f√ºr ein Modell `Item.schema()`, in Pydantic Version 2 hei√üt die Methode `Item.model_json_schema()`.\n-\n-///\n-\n Obwohl wir nicht die standardm√§√üig integrierte Funktionalit√§t verwenden, verwenden wir dennoch ein Pydantic-Modell, um das JSON-Schema f√ºr die Daten, die wir in YAML empfangen m√∂chten, manuell zu generieren.\n \n-Dann verwenden wir den Request direkt und extrahieren den Body als `bytes`. Das bedeutet, dass FastAPI nicht einmal versucht, den Request-Payload als JSON zu parsen.\n+Dann verwenden wir den Request direkt und extrahieren den Body als `bytes`. Das bedeutet, dass FastAPI nicht einmal versucht, die Request-Payload als JSON zu parsen.\n \n Und dann parsen wir in unserem Code diesen YAML-Inhalt direkt und verwenden dann wieder dasselbe Pydantic-Modell, um den YAML-Inhalt zu validieren:\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/path_operation_advanced_configuration/tutorial007_py39.py hl[24:31] *}\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-{* ../../docs_src/path_operation_advanced_configuration/tutorial007_pv1_py39.py hl[24:31] *}\n-\n-////\n-\n-/// info | Info\n-\n-In Pydantic Version 1 war die Methode zum Parsen und Validieren eines Objekts `Item.parse_obj()`, in Pydantic Version 2 hei√üt die Methode `Item.model_validate()`.\n-\n-///\n-\n /// tip | Tipp\n \n Hier verwenden wir dasselbe Pydantic-Modell wieder.\n\n```\n\n```diff\n@@ -60,24 +60,8 @@ Auf die gleiche Weise wie bei Pydantic-Modellen deklarieren Sie Klassenattribute\n \n Sie k√∂nnen dieselben Validierungs-Funktionen und -Tools verwenden, die Sie f√ºr Pydantic-Modelle verwenden, z. B. verschiedene Datentypen und zus√§tzliche Validierungen mit `Field()`.\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/settings/tutorial001_py39.py hl[2,5:8,11] *}\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-/// info | Info\n-\n-In Pydantic v1 w√ºrden Sie `BaseSettings` direkt von `pydantic` statt von `pydantic_settings` importieren.\n-\n-///\n-\n-{* ../../docs_src/settings/tutorial001_pv1_py39.py hl[2,5:8,11] *}\n-\n-////\n-\n /// tip | Tipp\n \n F√ºr ein schnelles Copy-and-paste verwenden Sie nicht dieses Beispiel, sondern das letzte unten.\n@@ -215,8 +199,6 @@ APP_NAME=\"ChimichangApp\"\n \n Und dann aktualisieren Sie Ihre `config.py` mit:\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/settings/app03_an_py39/config.py hl[9] *}\n \n /// tip | Tipp\n@@ -225,26 +207,6 @@ Das Attribut `model_config` wird nur f√ºr die Pydantic-Konfiguration verwendet.\n \n ///\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-{* ../../docs_src/settings/app03_an_py39/config_pv1.py hl[9:10] *}\n-\n-/// tip | Tipp\n-\n-Die Klasse `Config` wird nur f√ºr die Pydantic-Konfiguration verwendet. Weitere Informationen finden Sie unter <a href=\"https://docs.pydantic.dev/1.10/usage/model_config/\" class=\"external-link\" target=\"_blank\">Pydantic Model Config</a>.\n-\n-///\n-\n-////\n-\n-/// info | Info\n-\n-In Pydantic Version 1 erfolgte die Konfiguration in einer internen Klasse `Config`, in Pydantic Version 2 erfolgt sie in einem Attribut `model_config`. Dieses Attribut akzeptiert ein <abbr title=\"Dictionary ‚Äì Zuordnungstabelle: In anderen Sprachen auch Hash, Map, Objekt, Assoziatives Array genannt\">`dict`</abbr>. Um automatische Codevervollst√§ndigung und Inline-Fehlerberichte zu erhalten, k√∂nnen Sie `SettingsConfigDict` importieren und verwenden, um dieses `dict` zu definieren.\n-\n-///\n-\n Hier definieren wir die Konfiguration `env_file` innerhalb Ihrer Pydantic-`Settings`-Klasse und setzen den Wert auf den Dateinamen mit der dotenv-Datei, die wir verwenden m√∂chten.\n \n ### Die `Settings` nur einmal laden mittels `lru_cache` { #creating-the-settings-only-once-with-lru-cache }\n\n```\n\n```diff\n@@ -2,21 +2,23 @@\n \n Wenn Sie eine √§ltere FastAPI-App haben, nutzen Sie m√∂glicherweise P", "output": "Changes look good. This PR implements: üåê Update translations for de (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 521}
{"instruction": "Fix the following bug: Fix: Require realm in HTTPBasic to comply with RFC 7617", "input": "### Description\n\nThis PR fixes issue #13471 where `HTTPBasic` authentication allowed instantiation without a `realm` parameter. According to [RFC 7617 Section 2](https://datatracker.ietf.org/doc/html/rfc7617#section-2), the `realm` parameter is **REQUIRED** for Basic authentication.\n\nThis change:\n1.  Modifies `HTTPBasic.__init__` to make `realm` a required argument (removing the default `None`).\n2.  Updates `make_authenticate_headers` to always include the `realm` in the `WWW-Authenticate` header.\n\n### Breaking Change :warning:\n\nThis is a **BREAKING CHANGE**.\nExisting code dealing with security like:\n```python\nsecurity = HTTPBasic()\n```\nwill now raise a `TypeError`. Users must update their code to provide a realm:\n```python\nsecurity = HTTPBasic(realm='my-realm')\n```\n\n### Verification\n\n- Created a reproduction script (`reproduce_issue_13471.py`, not included in PR) confirming failure before fix and success after.\n- Updated existing tutorials (`docs_src/security/tutorial00[67]*.py`) to use `realm='simple'`.\n- Updated existing tests (`tests/test_tutorial/test_security/test_tutorial006.py`, `tests/test_security_http_basic_optional.py`) to match the new behavior.\n- Ran specific security tests (`tests/test_security_http_basic_realm.py`, `tests/test_security_http_basic_optional.py`) and tutorials tests.\n- Ran `ruff format` and `ruff check`.", "output": "```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -6,7 +6,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n def get_current_username(\n@@ -26,7 +26,7 @@ def get_current_username(\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers={\"WWW-Authenticate\": 'Basic realm=\"simple\"'},\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n@@ -23,7 +23,7 @@ def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers={\"WWW-Authenticate\": 'Basic realm=\"simple\"'},\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -153,13 +153,13 @@ def __init__(\n             ),\n         ] = None,\n         realm: Annotated[\n-            Optional[str],\n+            str,\n             Doc(\n                 \"\"\"\n                 HTTP Basic authentication realm.\n                 \"\"\"\n             ),\n-        ] = None,\n+        ],\n         description: Annotated[\n             Optional[str],\n             Doc(\n@@ -197,9 +197,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 520}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -6,7 +6,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n def get_current_username(\n@@ -26,7 +26,7 @@ def get_current_username(\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers={\"WWW-Authenticate\": 'Basic realm=\"simple\"'},\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n@@ -23,7 +23,7 @@ def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers={\"WWW-Authenticate\": 'Basic realm=\"simple\"'},\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -153,13 +153,13 @@ def __init__(\n             ),\n         ] = None,\n         realm: Annotated[\n-            Optional[str],\n+            str,\n             Doc(\n                 \"\"\"\n                 HTTP Basic authentication realm.\n                 \"\"\"\n             ),\n-        ] = None,\n+        ],\n         description: Annotated[\n             Optional[str],\n             Doc(\n@@ -197,9 +197,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```", "output": "Bug: Fix: Require realm in HTTPBasic to comply with RFC 7617\n\n### Description\n\nThis PR fixes issue #13471 where `HTTPBasic` authentication allowed instantiation without a `realm` parameter. According to [RFC 7617 Section 2](https://datatracker.ietf.org/doc/html/rfc7617#section-2), the `realm` parameter is **REQUIRED** for Basic authentication.\n\nThis change:\n1.  Modifies `HTTPBasic.__init__` to make `realm` a required argument (removing the default `None`).\n2.  Updates `make_authenticate_headers` to always include the `realm` in the `WWW-Authenticate` header.\n\n### Breaking Change :warning:\n\nThis is a **BREAKING CHANGE**.\nExisting code dealing with security like:\n```python\nsecurity = HTTPBasic()\n```\nwill now raise a `TypeError`. Users must update their code to provide a realm:\n```python\nsecurity = HTTPBasic(realm='my-realm')\n```\n\n### Verification\n\n- Created a reproduction script (`reproduce_issue_13471.py`, not included in PR) confirming failure before fix and success after.\n- Updated existing tutorials (`docs_src/security/tutorial00[67]*.py`) to use `realm='simple'`.\n- Updated existing tests (`tests/test_tutorial/test_security/test_tutorial006.py`, `tests/test_security_http_basic_optional.py`) to match the new behavior.\n- Ran specific security tests (`tests/test_security_http_basic_realm.py`, `tests/test_security_http_basic_optional.py`) and tutorials tests.\n- Ran `ruff format` and `ruff check`.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 520}
{"instruction": "Review the following code changes: Fix: Require realm in HTTPBasic to comply with RFC 7617", "input": "```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -6,7 +6,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n def get_current_username(\n@@ -26,7 +26,7 @@ def get_current_username(\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers={\"WWW-Authenticate\": 'Basic realm=\"simple\"'},\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n@@ -23,7 +23,7 @@ def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers={\"WWW-Authenticate\": 'Basic realm=\"simple\"'},\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -153,13 +153,13 @@ def __init__(\n             ),\n         ] = None,\n         realm: Annotated[\n-            Optional[str],\n+            str,\n             Doc(\n                 \"\"\"\n                 HTTP Basic authentication realm.\n                 \"\"\"\n             ),\n-        ] = None,\n+        ],\n         description: Annotated[\n             Optional[str],\n             Doc(\n@@ -197,9 +197,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```", "output": "Changes look good. This PR implements: Fix: Require realm in HTTPBasic to comply with RFC 7617", "source": "pr", "type": "code_review", "pr_number": 520}
{"instruction": "Review the following code changes: ‚ûñ Drop support for Pydantic v1, keeping short temporary support for Pydantic v2's `pydantic.v1`", "input": "```diff\n@@ -44,35 +44,22 @@ jobs:\n       matrix:\n         os: [ windows-latest, macos-latest ]\n         python-version: [ \"3.14\" ]\n-        pydantic-version: [ \"pydantic>=2.0.2,<3.0.0\" ]\n         include:\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n-            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n             coverage: coverage\n           - os: macos-latest\n             python-version: \"3.10\"\n-            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n+            coverage: coverage\n           - os: windows-latest\n-            python-version: \"3.11\"\n-            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n-          - os: ubuntu-latest\n             python-version: \"3.12\"\n-            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n-          - os: macos-latest\n-            python-version: \"3.13\"\n-            pydantic-version: \"pydantic>=1.10.0,<2.0.0\"\n-          - os: windows-latest\n-            python-version: \"3.13\"\n-            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n+          # Ubuntu with 3.13 needs coverage for CodSpeed benchmarks\n           - os: ubuntu-latest\n             python-version: \"3.13\"\n-            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n           - os: ubuntu-latest\n             python-version: \"3.14\"\n-            pydantic-version: \"pydantic>=2.0.2,<3.0.0\"\n             coverage: coverage\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n@@ -96,16 +83,14 @@ jobs:\n             pyproject.toml\n       - name: Install Dependencies\n         run: uv pip install -r requirements-tests.txt\n-      - name: Install Pydantic\n-        run: uv pip install \"${{ matrix.pydantic-version }}\"\n       - run: mkdir coverage\n       - name: Test\n         run: bash scripts/test.sh\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n       - name: CodSpeed benchmarks\n-        if: matrix.os == 'ubuntu-latest' && matrix.python-version == '3.13' && matrix.pydantic-version == 'pydantic>=2.0.2,<3.0.0'\n+        if: matrix.os == 'ubuntu-latest' && matrix.python-version == '3.13'\n         uses: CodSpeedHQ/action@v4\n         env:\n             COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n\n```\n\n```diff\n@@ -153,48 +153,16 @@ And you could do this even if the data type in the request is not JSON.\n \n For example, in this application we don't use FastAPI's integrated functionality to extract the JSON Schema from Pydantic models nor the automatic validation for JSON. In fact, we are declaring the request content type as YAML, not JSON:\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/path_operation_advanced_configuration/tutorial007_py39.py hl[15:20, 22] *}\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-{* ../../docs_src/path_operation_advanced_configuration/tutorial007_pv1_py39.py hl[15:20, 22] *}\n-\n-////\n-\n-/// info\n-\n-In Pydantic version 1 the method to get the JSON Schema for a model was called `Item.schema()`, in Pydantic version 2, the method is called `Item.model_json_schema()`.\n-\n-///\n-\n Nevertheless, although we are not using the default integrated functionality, we are still using a Pydantic model to manually generate the JSON Schema for the data that we want to receive in YAML.\n \n Then we use the request directly, and extract the body as `bytes`. This means that FastAPI won't even try to parse the request payload as JSON.\n \n And then in our code, we parse that YAML content directly, and then we are again using the same Pydantic model to validate the YAML content:\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/path_operation_advanced_configuration/tutorial007_py39.py hl[24:31] *}\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-{* ../../docs_src/path_operation_advanced_configuration/tutorial007_pv1_py39.py hl[24:31] *}\n-\n-////\n-\n-/// info\n-\n-In Pydantic version 1 the method to parse and validate an object was `Item.parse_obj()`, in Pydantic version 2, the method is called `Item.model_validate()`.\n-\n-///\n-\n /// tip\n \n Here we reuse the same Pydantic model.\n\n```\n\n```diff\n@@ -46,12 +46,6 @@ $ pip install \"fastapi[all]\"\n \n </div>\n \n-/// info\n-\n-In Pydantic v1 it came included with the main package. Now it is distributed as this independent package so that you can choose to install it or not if you don't need that functionality.\n-\n-///\n-\n ### Create the `Settings` object { #create-the-settings-object }\n \n Import `BaseSettings` from Pydantic and create a sub-class, very much like with a Pydantic model.\n@@ -60,24 +54,8 @@ The same way as with Pydantic models, you declare class attributes with type ann\n \n You can use all the same validation features and tools you use for Pydantic models, like different data types and additional validations with `Field()`.\n \n-//// tab | Pydantic v2\n-\n {* ../../docs_src/settings/tutorial001_py39.py hl[2,5:8,11] *}\n \n-////\n-\n-//// tab | Pydantic v1\n-\n-/// info\n-\n-In Pydan", "output": "Code Review for: ‚ûñ Drop support for Pydantic v1, keeping short temporary support for Pydantic v2's `pydantic.v1`\n\nüìù **fastapi/routing.py**: This isn't quite the same. It causes v2 models to never be dumped to dicts, causing round-trips to error when using FastAPI with some other magical libraries that are quite popular.\r\n\r\nIt caused the regression described in https://github.com/fastapi/fastapi/pull/14575#issuecomment-3678630709.\r\n\r\nIn this particular case:\r\n- Cadwyn deeply copies the model class `ConnectionResponse` internally\r\n- The response from the endpoint is no longer a dict, but an instance of the original class `ConnectionResponse`\r\n- The validation fails because pydantic doesn't validate an instance of the copied class, but an instance of the original `ConnectionResponse` (but Cadwyn replaced type adapter's type with the copied class!)\r\n\r\n@tiangolo, was this intended to start dumping v1 models *only*, without v2 models, in `_prepare_response_content` since this change?\n\nüìù **fastapi/routing.py**: Patch in #14582.\n\n", "source": "pr", "type": "code_review", "pr_number": 519}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -153,16 +152,16 @@ def _prepare_response_content(\n     exclude_defaults: bool = False,\n     exclude_none: bool = False,\n ) -> Any:\n-    if isinstance(res, BaseModel):\n-        read_with_orm_mode = getattr(_get_model_config(res), \"read_with_orm_mode\", None)\n+    if isinstance(res, may_v1.BaseModel):\n\n```", "output": "This isn't quite the same. It causes v2 models to never be dumped to dicts, causing round-trips to error when using FastAPI with some other magical libraries that are quite popular.\r\n\r\nIt caused the regression described in https://github.com/fastapi/fastapi/pull/14575#issuecomment-3678630709.\r\n\r\nIn this particular case:\r\n- Cadwyn deeply copies the model class `ConnectionResponse` internally\r\n- The response from the endpoint is no longer a dict, but an instance of the original class `ConnectionResponse`\r\n- The validation fails because pydantic doesn't validate an instance of the copied class, but an instance of the original `ConnectionResponse` (but Cadwyn replaced type adapter's type with the copied class!)\r\n\r\n@tiangolo, was this intended to start dumping v1 models *only*, without v2 models, in `_prepare_response_content` since this change?", "source": "pr_review", "type": "inline_review", "pr_number": 519}
{"instruction": "Review the following code changes: üë∑ Remove `lint` job from `test` CI workflow", "input": "```diff\n@@ -16,29 +16,6 @@ env:\n   UV_SYSTEM_PYTHON: 1\n \n jobs:\n-  lint:\n-    runs-on: ubuntu-latest\n-    steps:\n-      - name: Dump GitHub context\n-        env:\n-          GITHUB_CONTEXT: ${{ toJson(github) }}\n-        run: echo \"$GITHUB_CONTEXT\"\n-      - uses: actions/checkout@v6\n-      - name: Set up Python\n-        uses: actions/setup-python@v6\n-        with:\n-          python-version: \"3.11\"\n-      - name: Setup uv\n-        uses: astral-sh/setup-uv@v7\n-        with:\n-          cache-dependency-glob: |\n-            requirements**.txt\n-            pyproject.toml\n-      - name: Install Dependencies\n-        run: uv pip install -r requirements-tests.txt\n-      - name: Lint\n-        run: bash scripts/lint.sh\n-\n   test:\n     strategy:\n       matrix:\n\n```", "output": "Changes look good. This PR implements: üë∑ Remove `lint` job from `test` CI workflow", "source": "pr", "type": "code_review", "pr_number": 518}
{"instruction": "Review the following code changes: ‚úÖ Add missing tests for code examples", "input": "```diff\n@@ -4,7 +4,7 @@ FastAPI basiert auf **Pydantic**, und ich habe Ihnen gezeigt, wie Sie Pydantic-M\n \n Aber FastAPI unterst√ºtzt auf die gleiche Weise auch die Verwendung von <a href=\"https://docs.python.org/3/library/dataclasses.html\" class=\"external-link\" target=\"_blank\">`dataclasses`</a>:\n \n-{* ../../docs_src/dataclasses/tutorial001_py310.py hl[1,6:11,18:19] *}\n+{* ../../docs_src/dataclasses_/tutorial001_py310.py hl[1,6:11,18:19] *}\n \n Das ist dank **Pydantic** ebenfalls m√∂glich, da es <a href=\"https://docs.pydantic.dev/latest/concepts/dataclasses/#use-of-stdlib-dataclasses-with-basemodel\" class=\"external-link\" target=\"_blank\">`dataclasses` intern unterst√ºtzt</a>.\n \n@@ -32,7 +32,7 @@ Wenn Sie jedoch eine Menge Datenklassen herumliegen haben, ist dies ein guter Tr\n \n Sie k√∂nnen `dataclasses` auch im Parameter `response_model` verwenden:\n \n-{* ../../docs_src/dataclasses/tutorial002_py310.py hl[1,6:12,18] *}\n+{* ../../docs_src/dataclasses_/tutorial002_py310.py hl[1,6:12,18] *}\n \n Die Datenklasse wird automatisch in eine Pydantic-Datenklasse konvertiert.\n \n@@ -48,7 +48,7 @@ In einigen F√§llen m√ºssen Sie m√∂glicherweise immer noch Pydantics Version von\n \n In diesem Fall k√∂nnen Sie einfach die Standard-`dataclasses` durch `pydantic.dataclasses` ersetzen, was einen direkten Ersatz darstellt:\n \n-{* ../../docs_src/dataclasses/tutorial003_py310.py hl[1,4,7:10,13:16,22:24,27] *}\n+{* ../../docs_src/dataclasses_/tutorial003_py310.py hl[1,4,7:10,13:16,22:24,27] *}\n \n 1. Wir importieren `field` weiterhin von Standard-`dataclasses`.\n \n\n```\n\n```diff\n@@ -35,7 +35,7 @@ Abh√§ngig von Ihrem Anwendungsfall k√∂nnten Sie eine andere Bibliothek vorziehen\n \n Hier ist eine kleine Vorschau, wie Sie Strawberry mit FastAPI integrieren k√∂nnen:\n \n-{* ../../docs_src/graphql/tutorial001_py39.py hl[3,22,25] *}\n+{* ../../docs_src/graphql_/tutorial001_py39.py hl[3,22,25] *}\n \n Weitere Informationen zu Strawberry finden Sie in der <a href=\"https://strawberry.rocks/\" class=\"external-link\" target=\"_blank\">Strawberry-Dokumentation</a>.\n \n\n```\n\n```diff\n@@ -4,7 +4,7 @@ FastAPI is built on top of **Pydantic**, and I have been showing you how to use\n \n But FastAPI also supports using <a href=\"https://docs.python.org/3/library/dataclasses.html\" class=\"external-link\" target=\"_blank\">`dataclasses`</a> the same way:\n \n-{* ../../docs_src/dataclasses/tutorial001_py310.py hl[1,6:11,18:19] *}\n+{* ../../docs_src/dataclasses_/tutorial001_py310.py hl[1,6:11,18:19] *}\n \n This is still supported thanks to **Pydantic**, as it has <a href=\"https://docs.pydantic.dev/latest/concepts/dataclasses/#use-of-stdlib-dataclasses-with-basemodel\" class=\"external-link\" target=\"_blank\">internal support for `dataclasses`</a>.\n \n@@ -32,7 +32,7 @@ But if you have a bunch of dataclasses laying around, this is a nice trick to us\n \n You can also use `dataclasses` in the `response_model` parameter:\n \n-{* ../../docs_src/dataclasses/tutorial002_py310.py hl[1,6:12,18] *}\n+{* ../../docs_src/dataclasses_/tutorial002_py310.py hl[1,6:12,18] *}\n \n The dataclass will be automatically converted to a Pydantic dataclass.\n \n@@ -48,7 +48,7 @@ In some cases, you might still have to use Pydantic's version of `dataclasses`.\n \n In that case, you can simply swap the standard `dataclasses` with `pydantic.dataclasses`, which is a drop-in replacement:\n \n-{* ../../docs_src/dataclasses/tutorial003_py310.py hl[1,4,7:10,13:16,22:24,27] *}\n+{* ../../docs_src/dataclasses_/tutorial003_py310.py hl[1,4,7:10,13:16,22:24,27] *}\n \n 1. We still import `field` from standard `dataclasses`.\n \n\n```\n\n```diff\n@@ -35,7 +35,7 @@ Depending on your use case, you might prefer to use a different library, but if\n \n Here's a small preview of how you could integrate Strawberry with FastAPI:\n \n-{* ../../docs_src/graphql/tutorial001_py39.py hl[3,22,25] *}\n+{* ../../docs_src/graphql_/tutorial001_py39.py hl[3,22,25] *}\n \n You can learn more about Strawberry in the <a href=\"https://strawberry.rocks/\" class=\"external-link\" target=\"_blank\">Strawberry documentation</a>.\n \n\n```\n\n```diff\n@@ -4,7 +4,7 @@ FastAPI est√° construido sobre **Pydantic**, y te he estado mostrando c√≥mo usar\n \n Pero FastAPI tambi√©n soporta el uso de <a href=\"https://docs.python.org/3/library/dataclasses.html\" class=\"external-link\" target=\"_blank\">`dataclasses`</a> de la misma manera:\n \n-{* ../../docs_src/dataclasses/tutorial001_py310.py hl[1,6:11,18:19] *}\n+{* ../../docs_src/dataclasses_/tutorial001_py310.py hl[1,6:11,18:19] *}\n \n Esto sigue siendo soportado gracias a **Pydantic**, ya que tiene <a href=\"https://docs.pydantic.dev/latest/concepts/dataclasses/#use-of-stdlib-dataclasses-with-basemodel\" class=\"external-link\" target=\"_blank\">soporte interno para `dataclasses`</a>.\n \n@@ -32,7 +32,7 @@ Pero si tienes un mont√≥n de dataclasses por ah√≠, este es un buen truco para us\n \n Tambi√©n puedes usar `dataclasses` en el par√°metro `response_model`:\n \n-{* ../../docs_src/dataclasses/tutorial002_py310.py hl[1,6:12,18] *}\n+{* ../../docs_src/dataclasses_/tutorial002_py310.py hl[1,6", "output": "Changes look good. This PR implements: ‚úÖ Add missing tests for code examples", "source": "pr", "type": "code_review", "pr_number": 517}
{"instruction": "Review the following code changes: üîß Update pre-commit to use local Ruff instead of hook", "input": "```diff\n@@ -12,34 +12,45 @@ repos:\n         - --unsafe\n       - id: end-of-file-fixer\n       - id: trailing-whitespace\n-  - repo: https://github.com/astral-sh/ruff-pre-commit\n-    rev: v0.14.3\n-    hooks:\n-      - id: ruff\n-        args:\n-        - --fix\n-      - id: ruff-format\n+\n   - repo: local\n     hooks:\n+      - id: local-ruff-check\n+        name: ruff check\n+        entry: uv run ruff check --force-exclude --fix --exit-non-zero-on-fix\n+        require_serial: true\n+        language: unsupported\n+        types: [python]\n+\n+      - id: local-ruff-format\n+        name: ruff format\n+        entry: uv run ruff format --force-exclude --exit-non-zero-on-format\n+        require_serial: true\n+        language: unsupported\n+        types: [python]\n+\n       - id: add-permalinks-pages\n         language: unsupported\n         name: add-permalinks-pages\n         entry: uv run ./scripts/docs.py add-permalinks-pages\n         args:\n           - --update-existing\n         files: ^docs/en/docs/.*\\.md$\n+\n       - id: generate-readme\n         language: unsupported\n         name: generate README.md from index.md\n         entry: uv run ./scripts/docs.py generate-readme\n         files: ^docs/en/docs/index\\.md|docs/en/data/sponsors\\.yml|scripts/docs\\.py$\n         pass_filenames: false\n+\n       - id: update-languages\n         language: unsupported\n         name: update languages\n         entry: uv run ./scripts/docs.py update-languages\n         files: ^docs/.*|scripts/docs\\.py$\n         pass_filenames: false\n+\n       - id: ensure-non-translated\n         language: unsupported\n         name: ensure non-translated files are not modified\n\n```", "output": "Changes look good. This PR implements: üîß Update pre-commit to use local Ruff instead of hook", "source": "pr", "type": "code_review", "pr_number": 516}
{"instruction": "Fix the following bug: üìù Fix grammar in `docs/en/docs/tutorial/body.md`", "input": "## Description\r\nFixed grammar issue in the tutorial documentation.\r\n\r\n## Changes\r\n- Changed \"and that function parameters that are declared\" to \"and those function parameters that are declared\" for better grammar and readability.\r\n\r\n## Location\r\nFile: `docs/en/docs/tutorial/body.md`\r\nSection: \"Request body + path parameters\"", "output": "```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n \n {* ../../docs_src/body/tutorial003_py310.py hl[15:16] *}\n \n\n```\n\n```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 515}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n \n {* ../../docs_src/body/tutorial003_py310.py hl[15:16] *}\n \n\n```\n\n```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n\n```", "output": "Bug: üìù Fix grammar in `docs/en/docs/tutorial/body.md`\n\n## Description\r\nFixed grammar issue in the tutorial documentation.\r\n\r\n## Changes\r\n- Changed \"and that function parameters that are declared\" to \"and those function parameters that are declared\" for better grammar and readability.\r\n\r\n## Location\r\nFile: `docs/en/docs/tutorial/body.md`\r\nSection: \"Request body + path parameters\"", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 515}
{"instruction": "Review the following code changes: üìù Fix grammar in `docs/en/docs/tutorial/body.md`", "input": "```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n \n {* ../../docs_src/body/tutorial003_py310.py hl[15:16] *}\n \n\n```\n\n```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n\n```", "output": "Code Review for: üìù Fix grammar in `docs/en/docs/tutorial/body.md`\n\nüìù **docs/en/docs/tutorial/body.md**: Sorry, I approved this by mistake üòÖ. This is actually written as intended.\r\n\r\nThe word \"that\" here isn‚Äôt pointing to the parameters like \"those\" would, but instead, is connecting two ideas, basically saying:\r\n\r\n**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and _will recognize_ that function parameters that are declared to be Pydantic models should be **taken from the request body**\r\n\r\nSo \"that\" is just linking what FastAPI will recognize in each case.\r\n\r\nHope this clarify this! I'll close this PR but thank you for the effort.\n\n", "source": "pr", "type": "code_review", "pr_number": 515}
{"instruction": "Review this code change in `docs/en/docs/tutorial/body.md`", "input": "```diff\n@@ -132,7 +132,7 @@ Inside of the function, you can access all the attributes of the model object di\n \n You can declare path parameters and request body at the same time.\n \n-**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and that function parameters that are declared to be Pydantic models should be **taken from the request body**.\n+**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and those function parameters that are declared to be Pydantic models should be **taken from the request body**.\n\n```", "output": "Sorry, I approved this by mistake üòÖ. This is actually written as intended.\r\n\r\nThe word \"that\" here isn‚Äôt pointing to the parameters like \"those\" would, but instead, is connecting two ideas, basically saying:\r\n\r\n**FastAPI** will recognize that the function parameters that match path parameters should be **taken from the path**, and _will recognize_ that function parameters that are declared to be Pydantic models should be **taken from the request body**\r\n\r\nSo \"that\" is just linking what FastAPI will recognize in each case.\r\n\r\nHope this clarify this! I'll close this PR but thank you for the effort.", "source": "pr_review", "type": "inline_review", "pr_number": 515}
{"instruction": "Review the following code changes: ‚úÖ Run performance tests only on Pydantic v2", "input": "```diff\n@@ -1,13 +1,12 @@\n import json\n import sys\n-import warnings\n from collections.abc import Iterator\n from typing import Annotated, Any\n \n import pytest\n from fastapi import Depends, FastAPI\n-from fastapi.exceptions import FastAPIDeprecationWarning\n from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n \n if \"--codspeed\" not in sys.argv:\n     pytest.skip(\n@@ -47,148 +46,143 @@ def dep_b(a: Annotated[int, Depends(dep_a)]):\n     return a + 2\n \n \n-@pytest.fixture(\n-    scope=\"module\",\n-    params=[\n-        \"pydantic-v2\",\n-        \"pydantic-v1\",\n-    ],\n-)\n-def basemodel_class(request: pytest.FixtureRequest) -> type[Any]:\n-    if request.param == \"pydantic-v2\":\n-        from pydantic import BaseModel\n+class ItemIn(BaseModel):\n+    name: str\n+    value: int\n \n-        return BaseModel\n-    else:\n-        from pydantic.v1 import BaseModel\n \n-        return BaseModel\n+class ItemOut(BaseModel):\n+    name: str\n+    value: int\n+    dep: int\n \n \n-@pytest.fixture(scope=\"module\")\n-def app(basemodel_class: type[Any]) -> FastAPI:\n-    class ItemIn(basemodel_class):\n-        name: str\n-        value: int\n-\n-    class ItemOut(basemodel_class):\n-        name: str\n-        value: int\n-        dep: int\n-\n-    class LargeIn(basemodel_class):\n-        items: list[dict[str, Any]]\n-        metadata: dict[str, Any]\n-\n-    class LargeOut(basemodel_class):\n-        items: list[dict[str, Any]]\n-        metadata: dict[str, Any]\n-\n-    app = FastAPI()\n-\n-    with warnings.catch_warnings(record=True):\n-        warnings.filterwarnings(\n-            \"ignore\",\n-            message=r\"pydantic\\.v1 is deprecated and will soon stop being supported by FastAPI\\..*\",\n-            category=FastAPIDeprecationWarning,\n-        )\n-\n-        @app.post(\"/sync/validated\", response_model=ItemOut)\n-        def sync_validated(item: ItemIn, dep: Annotated[int, Depends(dep_b)]):\n-            return ItemOut(name=item.name, value=item.value, dep=dep)\n-\n-        @app.get(\"/sync/dict-no-response-model\")\n-        def sync_dict_no_response_model():\n-            return {\"name\": \"foo\", \"value\": 123}\n-\n-        @app.get(\"/sync/dict-with-response-model\", response_model=ItemOut)\n-        def sync_dict_with_response_model(\n-            dep: Annotated[int, Depends(dep_b)],\n-        ):\n-            return {\"name\": \"foo\", \"value\": 123, \"dep\": dep}\n-\n-        @app.get(\"/sync/model-no-response-model\")\n-        def sync_model_no_response_model(dep: Annotated[int, Depends(dep_b)]):\n-            return ItemOut(name=\"foo\", value=123, dep=dep)\n-\n-        @app.get(\"/sync/model-with-response-model\", response_model=ItemOut)\n-        def sync_model_with_response_model(dep: Annotated[int, Depends(dep_b)]):\n-            return ItemOut(name=\"foo\", value=123, dep=dep)\n-\n-        @app.post(\"/async/validated\", response_model=ItemOut)\n-        async def async_validated(\n-            item: ItemIn,\n-            dep: Annotated[int, Depends(dep_b)],\n-        ):\n-            return ItemOut(name=item.name, value=item.v\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Run performance tests only on Pydantic v2", "source": "pr", "type": "code_review", "pr_number": 514}
{"instruction": "Review the following code changes: üîä Add a custom `FastAPIDeprecationWarning`", "input": "```diff\n@@ -51,7 +51,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIDeprecationWarning\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -327,7 +327,7 @@ def get_dependant(\n             warnings.warn(\n                 \"pydantic.v1 is deprecated and will soon stop being supported by FastAPI.\"\n                 f\" Please update the param {param_name}: {param_details.type_annotation!r}.\",\n-                category=DeprecationWarning,\n+                category=FastAPIDeprecationWarning,\n                 stacklevel=5,\n             )\n         if isinstance(\n\n```\n\n```diff\n@@ -231,3 +231,10 @@ def __init__(\n     ) -> None:\n         super().__init__(errors, endpoint_ctx=endpoint_ctx)\n         self.body = body\n+\n+\n+class FastAPIDeprecationWarning(UserWarning):\n+    \"\"\"\n+    A custom deprecation warning as DeprecationWarning is ignored\n+    Ref: https://sethmlarson.dev/deprecations-via-warnings-dont-work-for-python-libraries\n+    \"\"\"\n\n```\n\n```diff\n@@ -23,6 +23,7 @@\n     get_validation_alias,\n )\n from fastapi.encoders import jsonable_encoder\n+from fastapi.exceptions import FastAPIDeprecationWarning\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n from fastapi.params import Body, ParamTypes\n@@ -215,9 +216,9 @@ def generate_operation_id(\n     *, route: routing.APIRoute, method: str\n ) -> str:  # pragma: nocover\n     warnings.warn(\n-        \"fastapi.openapi.utils.generate_operation_id() was deprecated, \"\n+        message=\"fastapi.openapi.utils.generate_operation_id() was deprecated, \"\n         \"it is not used internally, and will be removed soon\",\n-        DeprecationWarning,\n+        category=FastAPIDeprecationWarning,\n         stacklevel=2,\n     )\n     if route.operation_id:\n\n```\n\n```diff\n@@ -4,6 +4,7 @@\n from enum import Enum\n from typing import Annotated, Any, Callable, Optional, Union\n \n+from fastapi.exceptions import FastAPIDeprecationWarning\n from fastapi.openapi.models import Example\n from pydantic.fields import FieldInfo\n from typing_extensions import Literal, deprecated\n@@ -75,7 +76,7 @@ def __init__(\n         if example is not _Unset:\n             warnings.warn(\n                 \"`example` has been deprecated, please use `examples` instead\",\n-                category=DeprecationWarning,\n+                category=FastAPIDeprecationWarning,\n                 stacklevel=4,\n             )\n         self.example = example\n@@ -105,7 +106,7 @@ def __init__(\n         if regex is not None:\n             warnings.warn(\n                 \"`regex` has been deprecated, please use `pattern` instead\",\n-                category=DeprecationWarning,\n+                category=FastAPIDeprecationWarning,\n                 stacklevel=4,\n             )\n         current_json_schema_extra = json_schema_extra or extra\n@@ -530,7 +531,7 @@ def __init__(\n         if example is not _Unset:\n             warnings.warn(\n                 \"`example` has been deprecated, please use `examples` instead\",\n-                category=DeprecationWarning,\n+                category=FastAPIDeprecationWarning,\n                 stacklevel=4,\n             )\n         self.example = example\n@@ -560,7 +561,7 @@ def __init__(\n         if regex is not None:\n             warnings.warn(\n                 \"`regex` has been deprecated, please use `pattern` instead\",\n-                category=DeprecationWarning,\n+                category=FastAPIDeprecationWarning,\n                 stacklevel=4,\n             )\n         current_json_schema_extra = json_schema_extra or extra\n\n```\n\n```diff\n@@ -47,6 +47,7 @@\n from fastapi.encoders import jsonable_encoder\n from fastapi.exceptions import (\n     EndpointContext,\n+    FastAPIDeprecationWarning,\n     FastAPIError,\n     RequestValidationError,\n     ResponseValidationError,\n@@ -640,7 +641,7 @@ def __init__(\n                 warnings.warn(\n                     \"pydantic.v1 is deprecated and will soon stop being supported by FastAPI.\"\n                     f\" Please update the response model {self.response_model!r}.\",\n-                    category=DeprecationWarning,\n+                    category=FastAPIDeprecationWarning,\n                     stacklevel=4,\n                 )\n             self.response_field = create_model_field(\n@@ -680,7 +681,7 @@ def __init__(\n                     warnings.warn(\n                         \"pydantic.v1 is deprecated and will soon stop being supported by FastAPI.\"\n                         f\" In responses={{}}, please update {model}.\",\n-                        category=DeprecationWarning,\n+                        category=FastAPIDeprecationWarning,\n                         stacklevel=4,\n                     )\n                 response_field = create_model_field(\n\n```", "output": "Changes look good. This PR implements: üîä Add a custom `FastAPIDeprecationWarning`", "source": "pr", "type": "code_review", "pr_number": 513}
{"instruction": "Review the following code changes: üî• Remove Pydantic v1  specific test variants", "input": "```diff\n@@ -1,6 +1,5 @@\n from typing import Union\n \n-from dirty_equals import IsDict\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, ConfigDict\n@@ -52,19 +51,13 @@ def test_openapi_schema():\n                     \"requestBody\": {\n                         \"content\": {\n                             \"application/json\": {\n-                                \"schema\": IsDict(\n-                                    {\n-                                        \"anyOf\": [\n-                                            {\"$ref\": \"#/components/schemas/Foo\"},\n-                                            {\"type\": \"null\"},\n-                                        ],\n-                                        \"title\": \"Foo\",\n-                                    }\n-                                )\n-                                | IsDict(\n-                                    # TODO: remove when deprecating Pydantic v1\n-                                    {\"$ref\": \"#/components/schemas/Foo\"}\n-                                )\n+                                \"schema\": {\n+                                    \"anyOf\": [\n+                                        {\"$ref\": \"#/components/schemas/Foo\"},\n+                                        {\"type\": \"null\"},\n+                                    ],\n+                                    \"title\": \"Foo\",\n+                                }\n                             }\n                         }\n                     },\n\n```\n\n```diff\n@@ -1,6 +1,6 @@\n-from dirty_equals import IsDict\n from fastapi import APIRouter, FastAPI\n from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n from pydantic import BaseModel, HttpUrl\n from starlette.responses import JSONResponse\n \n@@ -32,121 +32,114 @@ def main_route(callback_url: HttpUrl):\n def test_openapi_schema():\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n-    assert response.json() == {\n-        \"openapi\": \"3.1.0\",\n-        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n-        \"paths\": {\n-            \"/\": {\n-                \"post\": {\n-                    \"summary\": \"Main Route\",\n-                    \"operationId\": \"main_route__post\",\n-                    \"parameters\": [\n-                        {\n-                            \"required\": True,\n-                            \"schema\": IsDict(\n-                                {\n-                                    \"title\": \"Callback Url\",\n-                                    \"minLength\": 1,\n-                                    \"type\": \"string\",\n-                                    \"format\": \"uri\",\n-                                }\n-                            )\n-                            # TODO: remove when deprecating Pydantic v1\n-                            | IsDict(\n-                                {\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"post\": {\n+                        \"summary\": \"Main Route\",\n+                        \"operationId\": \"main_route__post\",\n+                        \"parameters\": [\n+                            {\n+                                \"required\": True,\n+                                \"schema\": {\n                                     \"title\": \"Callback Url\",\n                                     \"maxLength\": 2083,\n                                     \"minLength\": 1,\n                                     \"type\": \"string\",\n                                     \"format\": \"uri\",\n-                                }\n-                            ),\n-                            \"name\": \"callback_url\",\n-                            \"in\": \"query\",\n-                        }\n-                    ],\n-                    \"responses\": {\n-                        \"200\": {\n-                            \"description\": \"Successful Response\",\n-                            \"content\": {\"application/json\": {\"schema\": {}}},\n-                        },\n-                        \"422\": {\n-                            \"description\": \"Validation Error\",\n-                            \"content\": {\n-                                \"application/json\": {\n-                                    \"schema\": {\n-                                        \"$ref\": \"#/components/schemas/HTTPValidationError\"\n+                                },\n+                 \n\n```\n\n```diff\n@@ -1,7 +1,6 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import IsDict\n from fastapi import APIRouter, FastAPI, Query\n from fastapi.testclient import TestClient\n \n@@ -32,44 +31,23 @@ async def unrelated(foo: Annotated[str, object()]):\n \n foo_is_missing = {\n     \"detail\": [\n-        IsDict(\n-            {\n-                \"loc\": [\"query\", \"foo\"],\n-                \"msg\": \"Field required\",\n-                \"type\": \"missing\",\n-       ", "output": "Changes look good. This PR implements: üî• Remove Pydantic v1  specific test variants", "source": "pr", "type": "code_review", "pr_number": 512}
{"instruction": "Review the following code changes: üî• Remove test variants for Pydantic v1 in test_request_params", "input": "```diff\n@@ -1,7 +1,7 @@\n from typing import Annotated, Union\n \n import pytest\n-from dirty_equals import IsDict, IsOneOf, IsPartialDict\n+from dirty_equals import IsOneOf, IsPartialDict\n from fastapi import Body, FastAPI\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n@@ -59,28 +59,16 @@ def test_required_list_str_missing(path: str, json: Union[dict, None]):\n     client = TestClient(app)\n     response = client.post(path, json=json)\n     assert response.status_code == 422\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"type\": \"missing\",\n-                    \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n-                    \"msg\": \"Field required\",\n-                    \"input\": IsOneOf(None, {}),\n-                }\n-            ]\n-        }\n-    ) | IsDict(\n-        {\n-            \"detail\": [\n-                {\n-                    \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n-                    \"msg\": \"field required\",\n-                    \"type\": \"value_error.missing\",\n-                }\n-            ]\n-        }\n-    )\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": IsOneOf([\"body\", \"p\"], [\"body\"]),\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n+            }\n+        ]\n+    }\n \n \n @pytest.mark.parametrize(\n\n```\n\n```diff\n@@ -1,7 +1,6 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import IsDict\n from fastapi import FastAPI, File, UploadFile\n from fastapi.testclient import TestClient\n \n@@ -36,27 +35,11 @@ def test_list_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-                        ],\n-                        \"title\": \"P\",\n-                    },\n-                )\n-                | IsDict(\n-                    {\n-                        \"type\": \"array\",\n-                        \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                        \"title\": \"P\",\n-                    },\n-                )\n-            )\n+            \"p\": {\n+                \"type\": \"array\",\n+                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n+                \"title\": \"P\",\n+            },\n         },\n         \"required\": [\"p\"],\n         \"title\": body_model_name,\n@@ -130,27 +113,11 @@ def test_list_alias_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p_alias\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-                        ],\n-                        \"title\": \"P Alias\",\n-                    },\n-                )\n-                | IsDict(\n-                    {\n-                        \"type\": \"array\",\n-                        \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                        \"title\": \"P Alias\",\n-                    },\n-                )\n-            )\n+            \"p_alias\": {\n+                \"type\": \"array\",\n+                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n+                \"title\": \"P Alias\",\n+            },\n         },\n         \"required\": [\"p_alias\"],\n         \"title\": body_model_name,\n@@ -252,27 +219,11 @@ def test_list_validation_alias_schema(path: str):\n \n     assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n         \"properties\": {\n-            \"p_val_alias\": (\n-                IsDict(\n-                    {\n-                        \"anyOf\": [\n-                            {\n-                                \"type\": \"array\",\n-                                \"items\": {\"type\": \"string\", \"format\": \"binary\"},\n-                            },\n-                            {\"type\": \"null\"},\n-           \n\n```\n\n```diff\n@@ -1,7 +1,7 @@\n from typing import Annotated\n \n import pytest\n-from dirty_equals import IsDict, IsOneOf, IsPartialDict\n+from dirty_equals import IsOneOf, IsPartialDict\n from fastapi import FastAPI, Form\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n@@ -58,28 +58,16 @@ def test_required_list_str_missing(path: str):\n     client = TestClient(app)\n     response = client.post(path)\n     assert response.status_code == 422\n-    assert response.json() == IsDict(\n-        {\n-            \"detail\":", "output": "Changes look good. This PR implements: üî• Remove test variants for Pydantic v1 in test_request_params", "source": "pr", "type": "code_review", "pr_number": 511}
{"instruction": "Review the following code changes: üë∑ Do not run translations on cron while finishing updating existing languages", "input": "```diff\n@@ -1,8 +1,8 @@\n name: Translate\n \n on:\n-  schedule:\n-    - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n+  # schedule:\n+  #   - cron: \"0 5 15 * *\"  # Run at 05:00 on the 15 of every month\n \n   workflow_dispatch:\n     inputs:\n\n```", "output": "Changes look good. This PR implements: üë∑ Do not run translations on cron while finishing updating existing languages", "source": "pr", "type": "code_review", "pr_number": 510}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for Simplified Chinese, generated from the existing translations", "input": "```diff\n@@ -0,0 +1,46 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+3) If a heading contains only the name of a FastAPI feature, do not translate it.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Simplified Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over  `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ËØ∑Ê±Ç\n+- response (HTTP): ÂìçÂ∫î\n+- path operation: Ë∑ØÂæÑÊìç‰Ωú\n+- path operation function: Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// tip | ÊèêÁ§∫`\n+- `/// note | Ê≥®ÊÑè`\n+- `/// warning | Ë≠¶Âëä`\n+- `/// info | ‰ø°ÊÅØ`\n+- `/// danger | Âç±Èô©`\n\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n\n```\n\n```diff\n@@ -0,0 +1,46 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+3) If a heading contains only the name of a FastAPI feature, do not translate it.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Simplified Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over  `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ËØ∑Ê±Ç\n+- response (HTTP): ÂìçÂ∫î\n+- path operation: Ë∑ØÂæÑÊìç‰Ωú\n+- path operation function: Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// tip | ÊèêÁ§∫`\n+- `/// note | ÊäÄÊúØÁªÜËäÇ`\n\n```\n\n```diff\n@@ -0,0 +1,46 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+3) If a heading contains only the name of a FastAPI feature, do not translate it.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Simplified Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over  `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ËØ∑Ê±Ç\n+- response (HTTP): ÂìçÂ∫î\n+- path operation: Ë∑ØÂæÑÊìç‰Ωú\n+- path operation function: Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// tip | ÊèêÁ§∫`\n+- `/// note | ÊäÄÊúØÁªÜËäÇ`\n\n```", "output": "Code Review for: üîß Add LLM prompt file for Simplified Chinese, generated from the existing translations\n\nüìù **docs/zh/llm-prompt.md**: When translating English technical documentation into Chinese, LLMs often translate headings that consist entirely of program keywords, class names, function names, and similar identifiers into Chinese. Given the popularity of FastAPI and the fact that current LLM models already have knowledge of it, one can consider explicitly instructing the model, for example:\r\n\r\n```suggestion\r\n3) If a heading contains only the name of a FastAPI feature, do not translate it.\r\n\r\n```\n\nüìù **docs/zh/llm-prompt.md**: Awesome, thanks for the feedback! I just added it.\n\nüìù **docs/zh/llm-prompt.md**: I think it's:\r\n```\r\n- `/// note | Ê≥®`\r\n```\n\nüìù **docs/zh/llm-prompt.md**: How About:\r\n\r\n```\r\n- `/// note | Ê≥®ÊÑè`\r\n```\r\n\r\nAlthough this is not its full literal meaning, it works in most contexts and reads more elegantly.  \r\nËôΩÁÑ∂Â≠óÈù¢ÊÑèÊÄùÂπ∂‰∏çÊ≠¢Â¶ÇÊ≠§Ôºå‰ΩÜËøôÂú®Â§ßÂ§öÊï∞ËØ≠Â¢É‰∏ãÊàêÁ´ãÂπ∂‰∏îÊõ¥Âä†‰ºòÈõÖ„ÄÇ\n\nüìù **docs/zh/llm-prompt.md**: Thank you! I updated it this way. :raised_hands: \n\n", "source": "pr", "type": "code_review", "pr_number": 509}
{"instruction": "Review this code change in `docs/zh/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,45 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n\n```", "output": "When translating English technical documentation into Chinese, LLMs often translate headings that consist entirely of program keywords, class names, function names, and similar identifiers into Chinese. Given the popularity of FastAPI and the fact that current LLM models already have knowledge of it, one can consider explicitly instructing the model, for example:\r\n\r\n```suggestion\r\n3) If a heading contains only the name of a FastAPI feature, do not translate it.\r\n\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 509}
{"instruction": "Review this code change in `docs/zh/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,46 @@\n+### Target language\n+\n+Translate to Simplified Chinese (ÁÆÄ‰Ωì‰∏≠Êñá).\n+\n+Language code: zh.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Simplified Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+3) If a heading contains only the name of a FastAPI feature, do not translate it.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Simplified Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over  `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): ËØ∑Ê±Ç\n+- response (HTTP): ÂìçÂ∫î\n+- path operation: Ë∑ØÂæÑÊìç‰Ωú\n+- path operation function: Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// tip | ÊèêÁ§∫`\n+- `/// note | ÊäÄÊúØÁªÜËäÇ`\n\n```", "output": "I think it's:\r\n```\r\n- `/// note | Ê≥®`\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 509}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for Traditional Chinese, generated from the existing translations", "input": "```diff\n@@ -0,0 +1,54 @@\n+### Target language\n+\n+Translate to Traditional Chinese (ÁπÅÈ´î‰∏≠Êñá).\n+\n+Language code: zh-hant.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Traditional Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Traditional Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Traditional Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+3) For more details, please follow the [Chinese Copywriting Guidelines](https://github.com/sparanoid/chinese-copywriting-guidelines).\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+1. Should avoid using simplified Chinese characters and terms. Always examine if the translation can be easily comprehended by the Traditional Chinese readers.\n+2. For some Python-specific terms like \"pickle\", \"list\", \"dict\" etc, we don't have to translate them.\n+3. Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): Ë´ãÊ±Ç\n+- response (HTTP): ÂõûÊáâ\n+- path operation: Ë∑ØÂæëÊìç‰Ωú\n+- path operation function: Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè\n+\n+The translation can optionally include the original English text only in the first occurrence of each page (e.g. \"Ë∑ØÂæëÊìç‰Ωú (path operation)\") if the translation is hard to be comprehended by most of the Chinese readers.\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) Many Traditional Chinese docs currently omit titles in `///` blocks; that is OK.\n+3) If a generic title is present, prefer these canonical titles:\n+\n+- `/// note | Ê≥®ÊÑè`\n+\n+Notes:\n+\n+- `details` blocks exist; keep `/// details` as-is and translate only the title after `|`.\n+- Example canonical titles used in existing docs:\n+  - `/// details | ‰∏äËø∞Êåá‰ª§ÁöÑÂê´Áæ©`\n+  - `/// details | ÈóúÊñº `requirements.txt``\n\n```\n\n```diff\n@@ -0,0 +1,49 @@\n+### Target language\n+\n+Translate to Traditional Chinese (ÁπÅÈ´î‰∏≠Êñá).\n+\n+Language code: zh-hant.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Traditional Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Traditional Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Traditional Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n\n```\n\n```diff\n@@ -0,0 +1,49 @@\n+### Target language\n+\n+Translate to Traditional Chinese (ÁπÅÈ´î‰∏≠Êñá).\n+\n+Language code: zh-hant.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Traditional Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Traditional Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Traditional Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n\n```\n\n```diff\n@@ -0,0 +1,49 @@\n+### Target language\n+\n+Translate to Traditional Chinese (ÁπÅÈ´î‰∏≠Êñá).\n+\n+Language code: zh-hant.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Traditional Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Traditional Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Traditional Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n+\n+- request (HTTP): Ë´ãÊ±Ç\n+- response (HTTP): ÂõûÊáâ\n+- path operation: Ë∑ØÂæëÊìç‰Ωú\n+- path operation function: Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè\n\n```\n\n```diff\n@@ -0,0 +1,49 @@\n+### Targ", "output": "Code Review for: üîß Add LLM prompt file for Traditional Chinese, generated from the existing translations\n\nüìù **docs/zh-hant/llm-prompt.md**: ```suggestion\r\n### Preferred translations / glossary\r\n\r\n1. Should avoid using simplified Chinese characters and terms. Always examine if the translation can be easily comprehended by the Traditional Chinese readers.\r\n2. For some Python-specific terms like \"pickle\", \"list\", \"dict\" etc, we don't have to translate them.\r\n3. Use the following preferred translations when they apply in documentation prose:\r\n```\n\nüìù **docs/zh-hant/llm-prompt.md**: ```suggestion\r\n3) For more details, please follow the [Chinese Copywriting Guidelines](https://github.com/sparanoid/chinese-copywriting-guidelines).\r\n\r\n```\n\nüìù **docs/zh-hant/llm-prompt.md**: ```suggestion\r\n- path operation function: Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè\r\n\r\nThe translation can optinoally includes the original English text only in the first occurence of each page (e.g. \"Ë∑ØÂæëÊìç‰Ωú (path operation)\") if the translation is hard to be comprehended by most of the Chinese readers.\r\n```\n\nüìù **docs/zh-hant/llm-prompt.md**: Perfect, I added this as well :raised_hands: \n\n", "source": "pr", "type": "code_review", "pr_number": 508}
{"instruction": "Review this code change in `docs/zh-hant/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,49 @@\n+### Target language\n+\n+Translate to Traditional Chinese (ÁπÅÈ´î‰∏≠Êñá).\n+\n+Language code: zh-hant.\n+\n+### Grammar and tone\n+\n+1) Use clear, concise technical Traditional Chinese consistent with existing docs.\n+2) Address the reader naturally (commonly using ‚Äú‰Ω†/‰Ω†ÁöÑ‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Traditional Chinese heading style (short and descriptive).\n+2) Do not add trailing punctuation to headings.\n+\n+### Quotes and punctuation\n+\n+1) Keep punctuation style consistent with existing Traditional Chinese docs (they often mix English terms like ‚ÄúFastAPI‚Äù with Chinese text).\n+2) Never change punctuation inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent within each document, prefer `...` over `‚Ä¶‚Ä¶`.\n+2) Never change ellipsis in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Use the following preferred translations when they apply in documentation prose:\n\n```", "output": "```suggestion\r\n### Preferred translations / glossary\r\n\r\n1. Should avoid using simplified Chinese characters and terms. Always examine if the translation can be easily comprehended by the Traditional Chinese readers.\r\n2. For some Python-specific terms like \"pickle\", \"list\", \"dict\" etc, we don't have to translate them.\r\n3. Use the following preferred translations when they apply in documentation prose:\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 508}
{"instruction": "Review the following code changes: üî® Update LLM translation script to guide reviewers to change the prompt", "input": "```diff\n@@ -1036,9 +1036,13 @@ def make_pr(\n     print(\"Creating PR\")\n     g = Github(github_token)\n     gh_repo = g.get_repo(github_repository)\n-    pr = gh_repo.create_pull(\n-        title=message, body=message, base=\"master\", head=branch_name\n+    body = (\n+        message\n+        + \"\\n\\nThis PR was created automatically using LLMs.\"\n+        + f\"\\n\\nIt uses the prompt file https://github.com/fastapi/fastapi/blob/master/docs/{language}/llm-prompt.md.\"\n+        + \"\\n\\nIn most cases, it's better to make PRs updating that file so that the LLM can do a better job generating the translations than suggesting changes in this PR.\"\n     )\n+    pr = gh_repo.create_pull(title=message, body=body, base=\"master\", head=branch_name)\n     print(f\"Created PR: {pr.number}\")\n     print(\"Finished\")\n \n\n```", "output": "Changes look good. This PR implements: üî® Update LLM translation script to guide reviewers to change the prompt", "source": "pr", "type": "code_review", "pr_number": 507}
{"instruction": "Review the following code changes: ‚ûñ Drop support for `pydantic.v1`", "input": "```diff\n@@ -1,20 +0,0 @@\n-from typing import Annotated\n-\n-from fastapi import FastAPI\n-from fastapi.temp_pydantic_v1_params import Form\n-from pydantic.v1 import BaseModel\n-\n-app = FastAPI()\n-\n-\n-class FormData(BaseModel):\n-    username: str\n-    password: str\n-\n-    class Config:\n-        extra = \"forbid\"\n-\n-\n-@app.post(\"/login/\")\n-async def login(data: Annotated[FormData, Form()]):\n-    return data\n\n```\n\n```diff\n@@ -1,18 +0,0 @@\n-from fastapi import FastAPI\n-from fastapi.temp_pydantic_v1_params import Form\n-from pydantic.v1 import BaseModel\n-\n-app = FastAPI()\n-\n-\n-class FormData(BaseModel):\n-    username: str\n-    password: str\n-\n-    class Config:\n-        extra = \"forbid\"\n-\n-\n-@app.post(\"/login/\")\n-async def login(data: FormData = Form()):\n-    return data\n\n```\n\n```diff\n@@ -1,43 +1,9 @@\n-from .main import BaseConfig as BaseConfig\n-from .main import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n-from .main import RequiredParam as RequiredParam\n-from .main import Undefined as Undefined\n-from .main import UndefinedType as UndefinedType\n-from .main import Url as Url\n-from .main import Validator as Validator\n-from .main import _get_model_config as _get_model_config\n-from .main import _is_error_wrapper as _is_error_wrapper\n-from .main import _is_model_class as _is_model_class\n-from .main import _is_model_field as _is_model_field\n-from .main import _is_undefined as _is_undefined\n-from .main import _model_dump as _model_dump\n-from .main import copy_field_info as copy_field_info\n-from .main import create_body_model as create_body_model\n-from .main import evaluate_forwardref as evaluate_forwardref\n-from .main import get_annotation_from_field_info as get_annotation_from_field_info\n-from .main import get_cached_model_fields as get_cached_model_fields\n-from .main import get_compat_model_name_map as get_compat_model_name_map\n-from .main import get_definitions as get_definitions\n-from .main import get_missing_field_error as get_missing_field_error\n-from .main import get_schema_from_model_field as get_schema_from_model_field\n-from .main import is_bytes_field as is_bytes_field\n-from .main import is_bytes_sequence_field as is_bytes_sequence_field\n-from .main import is_scalar_field as is_scalar_field\n-from .main import is_scalar_sequence_field as is_scalar_sequence_field\n-from .main import is_sequence_field as is_sequence_field\n-from .main import serialize_sequence_value as serialize_sequence_value\n-from .main import (\n-    with_info_plain_validator_function as with_info_plain_validator_function,\n-)\n-from .may_v1 import CoreSchema as CoreSchema\n-from .may_v1 import GetJsonSchemaHandler as GetJsonSchemaHandler\n-from .may_v1 import JsonSchemaValue as JsonSchemaValue\n-from .may_v1 import _normalize_errors as _normalize_errors\n-from .model_field import ModelField as ModelField\n from .shared import PYDANTIC_V2 as PYDANTIC_V2\n from .shared import PYDANTIC_VERSION_MINOR_TUPLE as PYDANTIC_VERSION_MINOR_TUPLE\n from .shared import annotation_is_pydantic_v1 as annotation_is_pydantic_v1\n from .shared import field_annotation_is_scalar as field_annotation_is_scalar\n+from .shared import is_pydantic_v1_model_class as is_pydantic_v1_model_class\n+from .shared import is_pydantic_v1_model_instance as is_pydantic_v1_model_instance\n from .shared import (\n     is_uploadfile_or_nonable_uploadfile_annotation as is_uploadfile_or_nonable_uploadfile_annotation,\n )\n@@ -47,3 +13,29 @@\n from .shared import lenient_issubclass as lenient_issubclass\n from .shared import sequence_types as sequence_types\n from .shared import value_is_sequence as value_is_sequence\n+from .v2 import BaseConfig as BaseConfig\n+from .v2 import ModelField as ModelField\n+from .v2 import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n+from .v2 import Required\n\n```\n\n```diff\n@@ -1,264 +0,0 @@\n-import sys\n-from collections.abc import Sequence\n-from functools import lru_cache\n-from typing import (\n-    Any,\n-)\n-\n-from fastapi._compat import may_v1\n-from fastapi._compat.shared import lenient_issubclass\n-from fastapi.types import ModelNameMap\n-from pydantic import BaseModel\n-from typing_extensions import Literal\n-\n-from . import v2\n-from .model_field import ModelField\n-from .v2 import BaseConfig as BaseConfig\n-from .v2 import FieldInfo as FieldInfo\n-from .v2 import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n-from .v2 import RequiredParam as RequiredParam\n-from .v2 import Undefined as Undefined\n-from .v2 import UndefinedType as UndefinedType\n-from .v2 import Url as Url\n-from .v2 import Validator as Validator\n-from .v2 import evaluate_forwardref as evaluate_forwardref\n-from .v2 import get_missing_field_error as get_missing_field_error\n-from .v2 import (\n-    with_info_plain_validator_function as with_info_plain_validator_function,\n-)\n-\n-\n-@lru_cache\n-def get_cached_model_fields(model: type[BaseModel]) -> list[ModelField]:\n-    if lenient_issubclass(model, may_v1.BaseModel):\n-        from fastapi._compat import v1\n-\n-        return v1.get_m", "output": "Changes look good. This PR implements: ‚ûñ Drop support for `pydantic.v1`", "source": "pr", "type": "code_review", "pr_number": 506}
{"instruction": "Review the following code changes: üë∑ Add new GitHub Action to update contributors, translators, and translation reviewers", "input": "```diff\n@@ -0,0 +1,53 @@\n+name: FastAPI People Contributors\n+\n+on:\n+  schedule:\n+    - cron: \"0 3 1 * *\"\n+  workflow_dispatch:\n+    inputs:\n+      debug_enabled:\n+        description: \"Run the build with tmate debugging enabled (https://github.com/marketplace/actions/debugging-with-tmate)\"\n+        required: false\n+        default: \"false\"\n+\n+env:\n+  UV_SYSTEM_PYTHON: 1\n+\n+jobs:\n+  job:\n+    if: github.repository_owner == 'fastapi'\n+    runs-on: ubuntu-latest\n+    permissions:\n+      contents: write\n+    steps:\n+      - name: Dump GitHub context\n+        env:\n+          GITHUB_CONTEXT: ${{ toJson(github) }}\n+        run: echo \"$GITHUB_CONTEXT\"\n+      - uses: actions/checkout@v4\n+      - name: Set up Python\n+        uses: actions/setup-python@v5\n+        with:\n+          python-version: \"3.11\"\n+      - name: Setup uv\n+        uses: astral-sh/setup-uv@v5\n+        with:\n+          version: \"0.4.15\"\n+          enable-cache: true\n+          cache-dependency-glob: |\n+            requirements**.txt\n+            pyproject.toml\n+      - name: Install Dependencies\n+        run: uv pip install -r requirements-github-actions.txt\n+      # Allow debugging with tmate\n+      - name: Setup tmate session\n+        uses: mxschmitt/action-tmate@v3\n+        if: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.debug_enabled == 'true' }}\n+        with:\n+          limit-access-to-actor: true\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n+      - name: FastAPI People Contributors\n+        run: python ./scripts/contributors.py\n+        env:\n+          GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+- tiangolo\n+- codecov\n+- github-actions\n+- pre-commit-ci\n+- dependabot\n\n```\n\n```diff\n@@ -13,15 +13,13 @@ Hey! üëã\n \n This is me:\n \n-{% if people %}\n <div class=\"user-list user-list-center\">\n {% for user in people.maintainers %}\n \n-<div class=\"user\"><a href=\"{{ user.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ user.avatarUrl }}\"/></div><div class=\"title\">@{{ user.login }}</div></a> <div class=\"count\">Answers: {{ user.answers }}</div><div class=\"count\">Pull Requests: {{ user.prs }}</div></div>\n+<div class=\"user\"><a href=\"{{ contributors.tiangolo.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ contributors.tiangolo.avatarUrl }}\"/></div><div class=\"title\">@{{ contributors.tiangolo.login }}</div></a> <div class=\"count\">Answers: {{ user.answers }}</div><div class=\"count\">Pull Requests: {{ contributors.tiangolo.count }}</div></div>\n {% endfor %}\n \n </div>\n-{% endif %}\n \n I'm the creator of **FastAPI**. You can read more about that in [Help FastAPI - Get Help - Connect with the author](help-fastapi.md#connect-with-the-author){.internal-link target=_blank}.\n \n@@ -84,109 +82,125 @@ You can see the **FastAPI Experts** for:\n \n These are the users that have been [helping others the most with questions in GitHub](help-fastapi.md#help-others-with-questions-in-github){.internal-link target=_blank} during the last month. ü§ì\n \n-{% if people %}\n <div class=\"user-list user-list-center\">\n {% for user in people.last_month_experts[:10] %}\n \n <div class=\"user\"><a href=\"{{ user.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ user.avatarUrl }}\"/></div><div class=\"title\">@{{ user.login }}</div></a> <div class=\"count\">Questions replied: {{ user.count }}</div></div>\n {% endfor %}\n \n </div>\n-{% endif %}\n \n ### FastAPI Experts - 3 Months\n \n These are the users that have been [helping others the most with questions in GitHub](help-fastapi.md#help-others-with-questions-in-github){.internal-link target=_blank} during the last 3 months. üòé\n \n-{% if people %}\n <div class=\"user-list user-list-center\">\n {% for user in people.three_months_experts[:10] %}\n \n <div class=\"user\"><a href=\"{{ user.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ user.avatarUrl }}\"/></div><div class=\"title\">@{{ user.login }}</div></a> <div class=\"count\">Questions replied: {{ user.count }}</div></div>\n {% endfor %}\n \n </div>\n-{% endif %}\n \n ### FastAPI Experts - 6 Months\n \n These are the users that have been [helping others the most with questions in GitHub](help-fastapi.md#help-others-with-questions-in-github){.internal-link target=_blank} during the last 6 months. üßê\n \n-{% if people %}\n <div class=\"user-list user-list-center\">\n {% for user in people.six_months_experts[:10] %}\n \n <div class=\"user\"><a href=\"{{ user.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ user.avatarUrl }}\"/></div><div class=\"title\">@{{ user.login }}</div></a> <div class=\"count\">Questions replied: {{ user.count }}</div></div>\n {% endfor %}\n \n </div>\n-{% endif %}\n \n ### FastAPI Experts - 1 Year\n \n These are the users that have been [helpin\n\n```\n\n```diff\n@@ -65,6 +65,10 @@ plugins:\n     - external_links: ../en/data/external_links.yml\n     - github_sponsors: ../en/data/github_sponsors.yml\n     - people: ../en/data/people.yml\n+    - contributors: ../en/data/contributors.yml\n+    -", "output": "Changes look good. This PR implements: üë∑ Add new GitHub Action to update contributors, translators, and translation reviewers", "source": "pr", "type": "code_review", "pr_number": 505}
{"instruction": "Review the following code changes: Implement OAuth2 authorization_code integration", "input": "```diff\n@@ -8,6 +8,7 @@\n )\n from .oauth2 import (\n     OAuth2,\n+    OAuth2AuthorizationCodeBearer,\n     OAuth2PasswordBearer,\n     OAuth2PasswordRequestForm,\n     SecurityScopes,\n\n```\n\n```diff\n@@ -163,6 +163,43 @@ async def __call__(self, request: Request) -> Optional[str]:\n         return param\n \n \n+class OAuth2AuthorizationCodeBearer(OAuth2):\n+    def __init__(\n+        self,\n+        authorizationUrl: str,\n+        tokenUrl: str,\n+        refreshUrl: str = None,\n+        scheme_name: str = None,\n+        scopes: dict = None,\n+        auto_error: bool = True,\n+    ):\n+        if not scopes:\n+            scopes = {}\n+        flows = OAuthFlowsModel(\n+            authorizationCode={\n+                \"authorizationUrl\": authorizationUrl,\n+                \"tokenUrl\": tokenUrl,\n+                \"refreshUrl\": refreshUrl,\n+                \"scopes\": scopes,\n+            }\n+        )\n+        super().__init__(flows=flows, scheme_name=scheme_name, auto_error=auto_error)\n+\n+    async def __call__(self, request: Request) -> Optional[str]:\n+        authorization: str = request.headers.get(\"Authorization\")\n+        scheme, param = get_authorization_scheme_param(authorization)\n+        if not authorization or scheme.lower() != \"bearer\":\n+            if self.auto_error:\n+                raise HTTPException(\n+                    status_code=HTTP_401_UNAUTHORIZED,\n+                    detail=\"Not authenticated\",\n+                    headers={\"WWW-Authenticate\": \"Bearer\"},\n+                )\n+            else:\n+                return None  # pragma: nocover\n+        return param\n+\n+\n class SecurityScopes:\n     def __init__(self, scopes: List[str] = None):\n         self.scopes = scopes or []\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Optional\n+\n+from fastapi import FastAPI, Security\n+from fastapi.security import OAuth2AuthorizationCodeBearer\n+from starlette.testclient import TestClient\n+\n+app = FastAPI()\n+\n+oauth2_scheme = OAuth2AuthorizationCodeBearer(\n+    authorizationUrl=\"/authorize\", tokenUrl=\"/token\", auto_error=True\n+)\n+\n+\n+@app.get(\"/items/\")\n+async def read_items(token: Optional[str] = Security(oauth2_scheme)):\n+    return {\"token\": token}\n+\n+\n+client = TestClient(app)\n+\n+openapi_schema = {\n+    \"openapi\": \"3.0.2\",\n+    \"info\": {\"title\": \"Fast API\", \"version\": \"0.1.0\"},\n+    \"paths\": {\n+        \"/items/\": {\n+            \"get\": {\n+                \"responses\": {\n+                    \"200\": {\n+                        \"description\": \"Successful Response\",\n+                        \"content\": {\"application/json\": {\"schema\": {}}},\n+                    }\n+                },\n+                \"summary\": \"Read Items\",\n+                \"operationId\": \"read_items_items__get\",\n+                \"security\": [{\"OAuth2AuthorizationCodeBearer\": []}],\n+            }\n+        }\n+    },\n+    \"components\": {\n+        \"securitySchemes\": {\n+            \"OAuth2AuthorizationCodeBearer\": {\n+                \"type\": \"oauth2\",\n+                \"flows\": {\n+                    \"authorizationCode\": {\n+                        \"authorizationUrl\": \"/authorize\",\n+                        \"tokenUrl\": \"/token\",\n+                        \"scopes\": {},\n+                    }\n+                },\n+            }\n+        }\n+    },\n+}\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200\n+    assert response.json() == openapi_schema\n+\n+\n+def test_no_token():\n+    response = client.get(\"/items\")\n+    assert response.status_code == 401\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+\n+def test_incorrect_token():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Non-existent testtoken\"})\n+    assert response.status_code == 401\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+\n+def test_token():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Bearer testtoken\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"token\": \"testtoken\"}\n\n```\n\n```diff\n@@ -163,6 +163,45 @@ def __init__(\n         return param\n \n \n+class OAuth2AuthorizationCodeBearer(OAuth2):\n+    def __init__(\n+        self,\n+        authorizationUrl: str,\n+        tokenUrl: str,\n+        refreshUrl: str = None,\n+        scopes: dict = None,\n+        scheme_name: str = None,\n+        auto_error: bool = True,\n+    ):\n+        if not scopes:\n+            scopes = {}\n+        flows = OAuthFlowsModel(\n+            authorizationCode={\n+                \"authorizationUrl\": authorizationUrl,\n+                \"tokenUrl\": tokenUrl,\n+                \"refreshUrl\": refreshUrl,\n+                \"scopes\": scopes,\n+            })\n+        super().__init__(\n+            flows=flows, scheme_name=scheme_name, auto_error=auto_error\n+        )\n+\n+    async def __call__(self, request: Request) -> Optional[str]:\n+        authorization: str = request.headers.get(\"Authorization\")\n+        print(authorization)\n\n```\n\n```diff\n@@ -163,6 +163,45 @@ def __init__(\n         return para", "output": "Code Review for: Implement OAuth2 authorization_code integration\n\nüìù **fastapi/security/oauth2.py**: Presumably you didn't mean to keep this print statement there?\n\nüìù **fastapi/security/oauth2.py**: Thanks, just removed it.\n\nüìù **Pipfile**: Is this change necessary? If not, probably better to remove it if only for the sake of clarity of what's changing. (It could go in a separate PR.)\n\nüìù **Pipfile**: Understood.\n\n", "source": "pr", "type": "code_review", "pr_number": 504}
{"instruction": "Review this code change in `fastapi/security/oauth2.py`", "input": "```diff\n@@ -163,6 +163,45 @@ def __init__(\n         return param\n \n \n+class OAuth2AuthorizationCodeBearer(OAuth2):\n+    def __init__(\n+        self,\n+        authorizationUrl: str,\n+        tokenUrl: str,\n+        refreshUrl: str = None,\n+        scopes: dict = None,\n+        scheme_name: str = None,\n+        auto_error: bool = True,\n+    ):\n+        if not scopes:\n+            scopes = {}\n+        flows = OAuthFlowsModel(\n+            authorizationCode={\n+                \"authorizationUrl\": authorizationUrl,\n+                \"tokenUrl\": tokenUrl,\n+                \"refreshUrl\": refreshUrl,\n+                \"scopes\": scopes,\n+            })\n+        super().__init__(\n+            flows=flows, scheme_name=scheme_name, auto_error=auto_error\n+        )\n+\n+    async def __call__(self, request: Request) -> Optional[str]:\n+        authorization: str = request.headers.get(\"Authorization\")\n+        print(authorization)\n\n```", "output": "Presumably you didn't mean to keep this print statement there?", "source": "pr_review", "type": "inline_review", "pr_number": 504}
{"instruction": "Review this code change in `Pipfile`", "input": "```diff\n@@ -26,7 +26,7 @@ uvicorn = \"*\"\n \n [packages]\n starlette = \"==0.12.9\"\n-pydantic = \"==1.0.0\"\n+pydantic = \"==1.2\"\n\n```", "output": "Is this change necessary? If not, probably better to remove it if only for the sake of clarity of what's changing. (It could go in a separate PR.)", "source": "pr_review", "type": "inline_review", "pr_number": 504}
{"instruction": "Review the following code changes: üîß Add LLM prompt file for Turkish, generated from the existing translations", "input": "```diff\n@@ -0,0 +1,52 @@\n+### Target language\n+\n+Translate to Turkish (T√ºrk√ße).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Turkish docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n+\n+Do not translate technical terms like path, route, request, response, query, body, cookie, and header, keep them as is.\n+\n+- Suffixing is very important, when adding Turkish suffixes to the English words, do that based on the pronunciation of the word and with an apostrophe.\n+\n+- Suffixes also changes based on what word comes next in Turkish too, here is an example:\n+\n+\"Server'a gelen request'leri intercept... \" or this could have been \"request'e\", \"request'i\" etc.\n+\n+- Some words are tricky like \"path'e\" can't be used like \"path'a\" but it could have been \"path'i\" \"path'leri\" etc.\n+\n+- You can use a more instructional style, that is consistent with the document, you can add the Turkish version of the term in parenthesis if it is not something very obvious, or an advanced concept, but do not over do it, do it only the first time it is mentioned, but keep the English term as the primary word.\n+\n+### `///` admonitions\n+\n+1) Keep the admonition keyword in English (do not translate `note`, `tip`, etc.).\n+2) If a title is present, prefer these canonical titles:\n+\n+- `/// note | Not`\n+- `/// note | Teknik Detaylar`\n+- `/// tip | ƒ∞pucu`\n+- `/// warning | Uyarƒ±`\n+- `/// info | Bilgi`\n+- `/// check | Ek bilgi`\n+\n+Prefer `ƒ∞pucu` over `Ipucu`.\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Turkish (T√ºrk√ße).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Turkish docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Turkish (T√ºrk√ße).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Turkish docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Turkish (T√ºrk√ße).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Turkish docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Turkish (T√ºrk√ße).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) K", "output": "Code Review for: üîß Add LLM prompt file for Turkish, generated from the existing translations\n\nüìù **docs/tr/llm-prompt.md**: I think this is a great opportunity to rewrite these, like I never heard anyone using these terms IRL, but if we prefer to convert like this for other languages too, then it's completely fine!\n\nüìù **docs/tr/llm-prompt.md**: Ah, then actually it's probably better to explicitly instruct the LLM to _not_ convert them if those are not used IRL. ü§î \n\nüìù **docs/tr/llm-prompt.md**: Yeah, that would be better IMO, even I got confused with \"yol operasyonu fonksiyonu\" üòÇ\r\n\r\nI agree, we should explicitly state this, we can add something like this to the prompt:\r\n\r\n\r\n```txt\r\n- Do not translate the terms like path, route, request, response, query, body, cookie, and header, keep them as it is. \r\n- Suffixing is very important, when adding Turkish suffixes to the English words, do that based on the pronunciation of the word and with an apostrophe.  \r\n    - Suffixes also changes based on what word comes next in Turkish too, here is an example: \"Server'a gelen request'leri intercept... \" or this could have been \"request'e\", \"request'i\" etc. \r\n    - Some words are tricky like \"path'e\" can't be used like \"path'a\" but it could have been \"path'i\" \"path'leri\" etc. \r\n- You can use a more instructional style, that is consistent with the document, you can add the the Turkish version of the term in parenthesis if it is not something very obvious, or an advanced concept, but do not over do it, do it only the first time it is mentioned, but keep the English term as the primary word. \r\n```\r\n\r\nThese are the probably most tricky and important parts, when keeping the term(s) English.\r\n\r\n Also [Turkish](https://news.ycombinator.com/item?id=42343920) is weird and [known](https://blog.codinghorror.com/whats-wrong-with-turkey/) to be quite [problematic](https://news.ycombinator.com/item?id=45559767) too. üò≠\r\n \r\n\r\n\r\n\r\n\r\n\nüìù **docs/tr/llm-prompt.md**: Perfect, thank you! I added your suggestions, replacing the old ones.\r\n\r\nDo you think this looks good as it is?\n\nüìù **docs/tr/llm-prompt.md**: Yeah, it looks looks good now, thank you!\r\n\r\n\r\nI'm excited for the PR üôÇ\n\n", "source": "pr", "type": "code_review", "pr_number": 503}
{"instruction": "Review this code change in `docs/tr/llm-prompt.md`", "input": "```diff\n@@ -0,0 +1,47 @@\n+### Target language\n+\n+Translate to Turkish (T√ºrk√ße).\n+\n+Language code: tr.\n+\n+### Grammar and tone\n+\n+1) Use instructional Turkish, consistent with existing Turkish docs.\n+2) Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+\n+### Headings\n+\n+1) Follow existing Turkish heading style (Title Case where used; no trailing period).\n+\n+### Quotes\n+\n+1) Keep quote style consistent with the existing Turkish docs (they frequently use ASCII quotes in prose).\n+2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+\n+### Ellipsis\n+\n+1) Keep ellipsis style consistent with existing Turkish docs.\n+2) Never change `...` in code, URLs, or CLI examples.\n+\n+### Preferred translations / glossary\n\n```", "output": "I think this is a great opportunity to rewrite these, like I never heard anyone using these terms IRL, but if we prefer to convert like this for other languages too, then it's completely fine!", "source": "pr_review", "type": "inline_review", "pr_number": 503}
{"instruction": "Review the following code changes: refactor - replaced deprecated on_event with lifespan in SQL tutorials", "input": "```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import Annotated\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -27,14 +28,16 @@ def get_session():\n         yield session\n \n \n-SessionDep = Annotated[Session, Depends(get_session)]\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n+    yield\n+    # will leave this as is for now\n \n-app = FastAPI()\n \n+SessionDep = Annotated[Session, Depends(get_session)]\n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import Annotated, Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -27,14 +28,16 @@ def get_session():\n         yield session\n \n \n-SessionDep = Annotated[Session, Depends(get_session)]\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n+    yield\n+    # will leave this as is for now\n \n-app = FastAPI()\n \n+SessionDep = Annotated[Session, Depends(get_session)]\n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import Depends, FastAPI, HTTPException, Query\n from sqlmodel import Field, Session, SQLModel, create_engine, select\n \n@@ -25,12 +27,14 @@ def get_session():\n         yield session\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n+    yield\n+    # will leave this as is for now\n \n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import Union\n \n from fastapi import Depends, FastAPI, HTTPException, Query\n@@ -27,12 +28,14 @@ def get_session():\n         yield session\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    create_db_and_tables()\n+    yield\n+    # will leave this as is for now\n \n \n-@app.on_event(\"startup\")\n-def on_startup():\n-    create_db_and_tables()\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/heroes/\")\n\n```\n\n```diff\n@@ -30,8 +30,7 @@ def clear_sqlmodel():\n )\n def get_client(request: pytest.FixtureRequest):\n     clear_sqlmodel()\n-    # TODO: remove when updating SQL tutorial to use new lifespan API\n-    with warnings.catch_warnings(record=True):\n+    with warnings.catch_warnings():\n         warnings.simplefilter(\"always\")\n         mod = importlib.import_module(f\"docs_src.sql_databases.{request.param}\")\n         clear_sqlmodel()\n@@ -50,7 +49,7 @@ def get_client(request: pytest.FixtureRequest):\n def test_crud_app(client: TestClient):\n     # TODO: this warns that SQLModel.from_orm is deprecated in Pydantic v1, refactor\n     # this if using obj.model_validate becomes independent of Pydantic v2\n-    with warnings.catch_warnings(record=True):\n+    with warnings.catch_warnings():\n         warnings.simplefilter(\"always\")\n         # No heroes before creating\n         response = client.get(\"heroes/\")\n\n```", "output": "Changes look good. This PR implements: refactor - replaced deprecated on_event with lifespan in SQL tutorials", "source": "pr", "type": "code_review", "pr_number": 502}
{"instruction": "Review the following code changes: Docs: Update outdated Pydantic v1 example in tutorial to Pydantic v2", "input": "```diff\n@@ -14,7 +14,7 @@ class Item(BaseModel):\n \n @app.post(\"/items/\")\n async def create_item(item: Item):\n-    item_dict = item.dict()\n+    item_dict = item.model_dump()\n     if item.tax is not None:\n         price_with_tax = item.price + item.tax\n         item_dict.update({\"price_with_tax\": price_with_tax})\n\n```\n\n```diff\n@@ -14,4 +14,4 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item):\n-    return {\"item_id\": item_id, **item.dict()}\n+    return {\"item_id\": item_id, **item.model_dump()}\n\n```\n\n```diff\n@@ -14,7 +14,7 @@ class Item(BaseModel):\n \n @app.put(\"/items/{item_id}\")\n async def update_item(item_id: int, item: Item, q: str | None = None):\n-    result = {\"item_id\": item_id, **item.dict()}\n+    result = {\"item_id\": item_id, **item.model_dump()}\n     if q:\n         result.update({\"q\": q})\n     return result\n\n```", "output": "Changes look good. This PR implements: Docs: Update outdated Pydantic v1 example in tutorial to Pydantic v2", "source": "pr", "type": "code_review", "pr_number": 501}
{"instruction": "Review the following code changes: üë• Update FastAPI People - Contributors and Translators", "input": "```diff\n@@ -1,6 +1,6 @@\n tiangolo:\n   login: tiangolo\n-  count: 808\n+  count: 857\n   avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n   url: https://github.com/tiangolo\n dependabot:\n@@ -10,14 +10,19 @@ dependabot:\n   url: https://github.com/apps/dependabot\n alejsdev:\n   login: alejsdev\n-  count: 52\n+  count: 53\n   avatarUrl: https://avatars.githubusercontent.com/u/90076947?u=85ceac49fb87138aebe8d663912e359447329090&v=4\n   url: https://github.com/alejsdev\n pre-commit-ci:\n   login: pre-commit-ci\n   count: 50\n   avatarUrl: https://avatars.githubusercontent.com/in/68672?v=4\n   url: https://github.com/apps/pre-commit-ci\n+YuriiMotov:\n+  login: YuriiMotov\n+  count: 36\n+  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n+  url: https://github.com/YuriiMotov\n github-actions:\n   login: github-actions\n   count: 26\n@@ -28,26 +33,21 @@ Kludex:\n   count: 25\n   avatarUrl: https://avatars.githubusercontent.com/u/7353520?u=df8a3f06ba8f55ae1967a3e2d5ed882903a4e330&v=4\n   url: https://github.com/Kludex\n-YuriiMotov:\n-  login: YuriiMotov\n-  count: 20\n-  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n-  url: https://github.com/YuriiMotov\n dmontagu:\n   login: dmontagu\n   count: 17\n   avatarUrl: https://avatars.githubusercontent.com/u/35119617?u=540f30c937a6450812628b9592a1dfe91bbe148e&v=4\n   url: https://github.com/dmontagu\n+svlandeg:\n+  login: svlandeg\n+  count: 16\n+  avatarUrl: https://avatars.githubusercontent.com/u/8796347?u=556c97650c27021911b0b9447ec55e75987b0e8a&v=4\n+  url: https://github.com/svlandeg\n nilslindemann:\n   login: nilslindemann\n   count: 15\n   avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n   url: https://github.com/nilslindemann\n-svlandeg:\n-  login: svlandeg\n-  count: 14\n-  avatarUrl: https://avatars.githubusercontent.com/u/8796347?u=556c97650c27021911b0b9447ec55e75987b0e8a&v=4\n-  url: https://github.com/svlandeg\n euri10:\n   login: euri10\n   count: 13\n@@ -553,6 +553,11 @@ DanielKusyDev:\n   count: 2\n   avatarUrl: https://avatars.githubusercontent.com/u/36250676?u=2ea6114ff751fc48b55f231987a0e2582c6b1bd2&v=4\n   url: https://github.com/DanielKusyDev\n+Viicos:\n+  login: Viicos\n+  count: 2\n+  avatarUrl: https://avatars.githubusercontent.com/u/65306057?u=fcd677dc1b9bef12aa103613e5ccb3f8ce305af9&v=4\n+  url: https://github.com/Viicos\n DanielYang59:\n   login: DanielYang59\n   count: 2\n\n```\n\n```diff\n@@ -15,39 +15,44 @@ sodaMelon:\n   url: https://github.com/sodaMelon\n ceb10n:\n   login: ceb10n\n-  count: 116\n+  count: 117\n   avatarUrl: https://avatars.githubusercontent.com/u/235213?u=edcce471814a1eba9f0cdaa4cd0de18921a940a6&v=4\n   url: https://github.com/ceb10n\n tokusumi:\n   login: tokusumi\n   count: 104\n   avatarUrl: https://avatars.githubusercontent.com/u/41147016?u=55010621aece725aa702270b54fed829b6a1fe60&v=4\n   url: https://github.com/tokusumi\n+hard-coders:\n+  login: hard-coders\n+  count: 96\n+  avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=78d12d1acdf853c817700145e73de7fd9e5d068b&v=4\n+  url: https://github.com/hard-coders\n hasansezertasan:\n   login: hasansezertasan\n   count: 95\n   avatarUrl: https://avatars.githubusercontent.com/u/13135006?u=99f0b0f0fc47e88e8abb337b4447357939ef93e7&v=4\n   url: https://github.com/hasansezertasan\n-hard-coders:\n-  login: hard-coders\n-  count: 93\n-  avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=95db33927bbff1ed1c07efddeb97ac2ff33068ed&v=4\n-  url: https://github.com/hard-coders\n alv2017:\n   login: alv2017\n   count: 88\n   avatarUrl: https://avatars.githubusercontent.com/u/31544722?v=4\n   url: https://github.com/alv2017\n nazarepiedady:\n   login: nazarepiedady\n-  count: 86\n+  count: 87\n   avatarUrl: https://avatars.githubusercontent.com/u/31008635?u=f69ddc4ea8bda3bdfac7aa0e2ea38de282e6ee2d&v=4\n   url: https://github.com/nazarepiedady\n AlertRED:\n   login: AlertRED\n   count: 81\n   avatarUrl: https://avatars.githubusercontent.com/u/15695000?u=f5a4944c6df443030409c88da7d7fa0b7ead985c&v=4\n   url: https://github.com/AlertRED\n+tiangolo:\n+  login: tiangolo\n+  count: 73\n+  avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n+  url: https://github.com/tiangolo\n Alexandrhub:\n   login: Alexandrhub\n   count: 68\n@@ -63,21 +68,16 @@ cassiobotaro:\n   count: 62\n   avatarUrl: https://avatars.githubusercontent.com/u/3127847?u=a08022b191ddbd0a6159b2981d9d878b6d5bb71f&v=4\n   url: https://github.com/cassiobotaro\n+mattwang44:\n+  login: mattwang44\n+  count: 61\n+  avatarUrl: https://avatars.githubusercontent.com/u/24987826?u=58e37fb3927b9124b458945ac4c97aa0f1062d85&v=4\n+  url: https://github.com/mattwang44\n nilslindemann:\n   login: nilslindemann\n   count: 59\n   avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n   url: https://github.com/nilslindeman", "output": "Changes look good. This PR implements: üë• Update FastAPI People - Contributors and Translators", "source": "pr", "type": "code_review", "pr_number": 500}
{"instruction": "Review the following code changes: üë• Update FastAPI GitHub topic repositories", "input": "```diff\n@@ -1,495 +1,495 @@\n - name: full-stack-fastapi-template\n   html_url: https://github.com/fastapi/full-stack-fastapi-template\n-  stars: 39475\n+  stars: 40334\n   owner_login: fastapi\n   owner_html_url: https://github.com/fastapi\n - name: Hello-Python\n   html_url: https://github.com/mouredev/Hello-Python\n-  stars: 33090\n+  stars: 33628\n   owner_login: mouredev\n   owner_html_url: https://github.com/mouredev\n - name: serve\n   html_url: https://github.com/jina-ai/serve\n-  stars: 21798\n+  stars: 21817\n   owner_login: jina-ai\n   owner_html_url: https://github.com/jina-ai\n - name: HivisionIDPhotos\n   html_url: https://github.com/Zeyi-Lin/HivisionIDPhotos\n-  stars: 20258\n+  stars: 20409\n   owner_login: Zeyi-Lin\n   owner_html_url: https://github.com/Zeyi-Lin\n - name: sqlmodel\n   html_url: https://github.com/fastapi/sqlmodel\n-  stars: 17212\n+  stars: 17415\n   owner_login: fastapi\n   owner_html_url: https://github.com/fastapi\n-- name: Douyin_TikTok_Download_API\n-  html_url: https://github.com/Evil0ctal/Douyin_TikTok_Download_API\n-  stars: 15145\n-  owner_login: Evil0ctal\n-  owner_html_url: https://github.com/Evil0ctal\n - name: fastapi-best-practices\n   html_url: https://github.com/zhanymkanov/fastapi-best-practices\n-  stars: 14644\n+  stars: 15776\n   owner_login: zhanymkanov\n   owner_html_url: https://github.com/zhanymkanov\n+- name: Douyin_TikTok_Download_API\n+  html_url: https://github.com/Evil0ctal/Douyin_TikTok_Download_API\n+  stars: 15588\n+  owner_login: Evil0ctal\n+  owner_html_url: https://github.com/Evil0ctal\n - name: machine-learning-zoomcamp\n   html_url: https://github.com/DataTalksClub/machine-learning-zoomcamp\n-  stars: 12320\n+  stars: 12447\n   owner_login: DataTalksClub\n   owner_html_url: https://github.com/DataTalksClub\n-- name: fastapi_mcp\n-  html_url: https://github.com/tadata-org/fastapi_mcp\n-  stars: 11174\n-  owner_login: tadata-org\n-  owner_html_url: https://github.com/tadata-org\n - name: SurfSense\n   html_url: https://github.com/MODSetter/SurfSense\n-  stars: 10858\n+  stars: 12128\n   owner_login: MODSetter\n   owner_html_url: https://github.com/MODSetter\n+- name: fastapi_mcp\n+  html_url: https://github.com/tadata-org/fastapi_mcp\n+  stars: 11326\n+  owner_login: tadata-org\n+  owner_html_url: https://github.com/tadata-org\n - name: awesome-fastapi\n   html_url: https://github.com/mjhea0/awesome-fastapi\n-  stars: 10758\n+  stars: 10901\n   owner_login: mjhea0\n   owner_html_url: https://github.com/mjhea0\n - name: XHS-Downloader\n   html_url: https://github.com/JoeanAmier/XHS-Downloader\n-  stars: 9313\n+  stars: 9584\n   owner_login: JoeanAmier\n   owner_html_url: https://github.com/JoeanAmier\n-- name: FastUI\n-  html_url: https://github.com/pydantic/FastUI\n-  stars: 8915\n-  owner_login: pydantic\n-  owner_html_url: https://github.com/pydantic\n - name: polar\n   html_url: https://github.com/polarsource/polar\n-  stars: 8339\n+  stars: 8951\n   owner_login: polarsource\n   owner_html_url: https://github.com/polarsource\n+- name: FastUI\n+  html_url: https://github.com/\n\n```", "output": "Changes look good. This PR implements: üë• Update FastAPI GitHub topic repositories", "source": "pr", "type": "code_review", "pr_number": 499}
{"instruction": "Review the following code changes: üë• Update FastAPI People - Sponsors", "input": "```diff\n@@ -2,57 +2,51 @@ sponsors:\n - - login: renderinc\n     avatarUrl: https://avatars.githubusercontent.com/u/36424661?v=4\n     url: https://github.com/renderinc\n-  - login: andrew-propelauth\n-    avatarUrl: https://avatars.githubusercontent.com/u/89474256?u=c98993dec8553c09d424ede67bbe86e5c35f48c9&v=4\n-    url: https://github.com/andrew-propelauth\n-  - login: blockbee-io\n-    avatarUrl: https://avatars.githubusercontent.com/u/115143449?u=1b8620c2d6567c4df2111a371b85a51f448f9b85&v=4\n-    url: https://github.com/blockbee-io\n-  - login: zuplo\n-    avatarUrl: https://avatars.githubusercontent.com/u/85497839?v=4\n-    url: https://github.com/zuplo\n-  - login: coderabbitai\n-    avatarUrl: https://avatars.githubusercontent.com/u/132028505?v=4\n-    url: https://github.com/coderabbitai\n-  - login: greptileai\n-    avatarUrl: https://avatars.githubusercontent.com/u/140149887?v=4\n-    url: https://github.com/greptileai\n   - login: subtotal\n     avatarUrl: https://avatars.githubusercontent.com/u/176449348?v=4\n     url: https://github.com/subtotal\n+  - login: greptileai\n+    avatarUrl: https://avatars.githubusercontent.com/u/140149887?v=4\n+    url: https://github.com/greptileai\n+  - login: coderabbitai\n+    avatarUrl: https://avatars.githubusercontent.com/u/132028505?v=4\n+    url: https://github.com/coderabbitai\n+  - login: zuplo\n+    avatarUrl: https://avatars.githubusercontent.com/u/85497839?v=4\n+    url: https://github.com/zuplo\n+  - login: blockbee-io\n+    avatarUrl: https://avatars.githubusercontent.com/u/115143449?u=1b8620c2d6567c4df2111a371b85a51f448f9b85&v=4\n+    url: https://github.com/blockbee-io\n+  - login: andrew-propelauth\n+    avatarUrl: https://avatars.githubusercontent.com/u/89474256?u=c98993dec8553c09d424ede67bbe86e5c35f48c9&v=4\n+    url: https://github.com/andrew-propelauth\n   - login: railwayapp\n     avatarUrl: https://avatars.githubusercontent.com/u/66716858?v=4\n     url: https://github.com/railwayapp\n-- - login: dribia\n-    avatarUrl: https://avatars.githubusercontent.com/u/41189616?v=4\n-    url: https://github.com/dribia\n-  - login: svix\n-    avatarUrl: https://avatars.githubusercontent.com/u/80175132?v=4\n-    url: https://github.com/svix\n+- - login: speakeasy-api\n+    avatarUrl: https://avatars.githubusercontent.com/u/91446104?v=4\n+    url: https://github.com/speakeasy-api\n   - login: stainless-api\n     avatarUrl: https://avatars.githubusercontent.com/u/88061651?v=4\n     url: https://github.com/stainless-api\n-  - login: speakeasy-api\n-    avatarUrl: https://avatars.githubusercontent.com/u/91446104?v=4\n-    url: https://github.com/speakeasy-api\n-  - login: databento\n-    avatarUrl: https://avatars.githubusercontent.com/u/64141749?v=4\n-    url: https://github.com/databento\n+  - login: svix\n+    avatarUrl: https://avatars.githubusercontent.com/u/80175132?v=4\n+    url: https://github.com/svix\n   - login: permitio\n     avatarUrl: https://avatars.githubusercontent.com/u/71775833?v=4\n     url: https://github.com/permitio\n-- - login: Ponte-Energy-Pa\n\n```", "output": "Changes look good. This PR implements: üë• Update FastAPI People - Sponsors", "source": "pr", "type": "code_review", "pr_number": 498}
{"instruction": "Fix the following bug: Fix security issues via contrib", "input": "Automated security fixes generated by contrib autonomous agent.", "output": "```diff\n@@ -24,7 +24,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/cookie_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/cookie_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -23,7 +23,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/header_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/header_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -26,7 +26,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/query_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/query_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -22,7 +22,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial001.py\"],\n+    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -22,7 +22,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"],\n+    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 497}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -24,7 +24,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/cookie_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/cookie_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -23,7 +23,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/header_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/header_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -26,7 +26,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/query_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/query_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -22,7 +22,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial001.py\"],\n+    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -22,7 +22,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"],\n+    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```", "output": "Bug: Fix security issues via contrib\n\nAutomated security fixes generated by contrib autonomous agent.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 497}
{"instruction": "Review the following code changes: Fix security issues via contrib", "input": "```diff\n@@ -24,7 +24,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/cookie_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/cookie_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -23,7 +23,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/header_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/header_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -26,7 +26,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/query_param_models/tutorial001.py\"]\n+    [\"fastapi\", \"run\", \"docs_src/query_param_models/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -22,7 +22,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial001.py\"],\n+    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial001.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```\n\n```diff\n@@ -22,7 +22,7 @@ def run(playwright: Playwright) -> None:\n \n \n process = subprocess.Popen(\n-    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"],\n+    [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"], shell=False\n )\n try:\n     for _ in range(3):\n\n```", "output": "Changes look good. This PR implements: Fix security issues via contrib", "source": "pr", "type": "code_review", "pr_number": 497}
{"instruction": "Fix the following bug: üìù Add tip on how to install `pip` in case of `No module named pip` error in `virtual-environments.md`", "input": "Fix for \"No module named pip error\"", "output": "```diff\n@@ -242,6 +242,26 @@ $ python -m pip install --upgrade pip\n \n </div>\n \n+/// tip\n+\n+Sometimes, you might get a **`No module named pip`** error when trying to upgrade pip.\n+\n+If this happens, install and upgrade pip using the command below:\n+\n+<div class=\"termy\">\n+\n+\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 496}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -242,6 +242,26 @@ $ python -m pip install --upgrade pip\n \n </div>\n \n+/// tip\n+\n+Sometimes, you might get a **`No module named pip`** error when trying to upgrade pip.\n+\n+If this happens, install and upgrade pip using the command below:\n+\n+<div class=\"termy\">\n+\n+\n```", "output": "Bug: üìù Add tip on how to install `pip` in case of `No module named pip` error in `virtual-environments.md`\n\nFix for \"No module named pip error\"", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 496}
{"instruction": "Review the following code changes: üìù Add tip on how to install `pip` in case of `No module named pip` error in `virtual-environments.md`", "input": "```diff\n@@ -242,6 +242,26 @@ $ python -m pip install --upgrade pip\n \n </div>\n \n+/// tip\n+\n+Sometimes, you might get a **`No module named pip`** error when trying to upgrade pip.\n+\n+If this happens, install and upgrade pip using the command below:\n+\n+<div class=\"termy\">\n+\n+\n```", "output": "Changes look good. This PR implements: üìù Add tip on how to install `pip` in case of `No module named pip` error in `virtual-environments.md`", "source": "pr", "type": "code_review", "pr_number": 496}
{"instruction": "Fix the following bug: üêõ Fix support for `StreamingResponse`s with dependencies with `yield` or `UploadFile`s, close after the response is done", "input": "üêõ Fix support for `StreamingResponse`s with dependencies with `yield` or `UploadFile`s, close after the response is done\r\n\r\n---\r\n\r\nThere's (again) an `AsyncExitStack` middleware, now used mainly to close objects after the response is done.\r\n\r\nThere's also a new wrapper duplicating some logic in Starlette but creating an `AsyncExitStack` for the exit code in dependencies with `yield`, for regular responses and WebSockets as well.\r\n\r\nThe exit code of dependencies with `yield` is now executed after the response is done.", "output": "```diff\n@@ -63,3 +63,91 @@ In the chapters about security, there are utility functions that are implemented\n If you understood all this, you already know how those utility tools for security work underneath.\n \n ///\n+\n+## Dependencies with `yield`, `HTTPException`, `except` and Background Tasks { #dependencies-with-yield-httpexception-except-and-background-tasks }\n+\n+/// warning\n+\n+You most probably don't need these technical details.\n+\n+These details are useful mainly if you had a FastAPI application older than 0.118.0 and you are facing issues with dependencies with `yield`.\n+\n+///\n+\n+Dependencies with `yield` have evolved over time to account for the different use cases and to fix some issues, here's a summary of what has changed.\n+\n+### Dependencies with `yield` and `StreamingResponse`, Technical Details { #dependencies-with-yield-and-streamingresponse-technical-details }\n+\n+Before FastAPI 0.118.0, if you used a dependency with `yield`, it would run the exit code after the *path operation function* returned but right before sending the response.\n+\n+The intention was to avoid holding resources for longer than necessary, waiting for the response to travel through the network.\n+\n+This change also meant that if you returned a `StreamingResponse`, the exit code of the dependency with `yield` would have been already run.\n+\n+For example, if you had a database session in a dependency with `yield`, the `StreamingResponse` would not be able to use that session while streaming data because the session would have already been closed in the exit code after `yield`.\n+\n+This behavior was reverted in 0.118.0, to make the exit code after `yield` be executed after the response is sent.\n+\n+/// info\n+\n+As you will see below, this is very similar to the behavior before version 0.106.0, but with several improvements and bug fixes for corner cases.\n+\n+///\n+\n+#### Use Cases with Early Exit Code { #use-cases-with-early-exit-code }\n+\n+There are some use cases with specific conditions that could benefit from the old behavior of running the exit code of dependencies with `yield` before sending the response.\n+\n+For example, imagine you have code that uses a database session in a dependency with `yield` only to verify a user, but the database session is never used again in the *path operation function*, only in the dependency, **and** the response takes a long time to be sent, like a `StreamingResponse` that sends data slowly, but for some reason doesn't use the database.\n+\n+In this case, the database session would be held until the response is finished being sent, but if you don't use it, then it wouldn't be necessary to hold it.\n+\n+Here's how it could look like:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.py *}\n+\n+The exit code, the automatic closing of the `Session` in:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.py ln[19:21] *}\n+\n+...would be run after the the response finishes sending the slow data:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.\n\n```\n\n```diff\n@@ -35,7 +35,7 @@ The yielded value is what is injected into *path operations* and other dependenc\n \n {* ../../docs_src/dependencies/tutorial007.py hl[4] *}\n \n-The code following the `yield` statement is executed after creating the response but before sending it:\n+The code following the `yield` statement is executed after the response:\n \n {* ../../docs_src/dependencies/tutorial007.py hl[5:6] *}\n \n@@ -51,7 +51,7 @@ You can use `async` or regular functions.\n \n If you use a `try` block in a dependency with `yield`, you'll receive any exception that was thrown when using the dependency.\n \n-For example, if some code at some point in the middle, in another dependency or in a *path operation*, made a database transaction \"rollback\" or create any other error, you will receive the exception in your dependency.\n+For example, if some code at some point in the middle, in another dependency or in a *path operation*, made a database transaction \"rollback\" or created any other exception, you would receive the exception in your dependency.\n \n So, you can look for that specific exception inside the dependency with `except SomeException`.\n \n@@ -95,9 +95,11 @@ This works thanks to Python's <a href=\"https://docs.python.org/3/library/context\n \n ## Dependencies with `yield` and `HTTPException` { #dependencies-with-yield-and-httpexception }\n \n-You saw that you can use dependencies with `yield` and have `try` blocks that catch exceptions.\n+You saw that you can use dependencies with `yield` and have `try` blocks that try to execute some code and then run some exit code after `finally`.\n \n-The same way, you could raise an `HTTPException` or similar in the exit code, after the `yield`.\n+You can also use `except` to catch the exception that was raised and do something with it.\n+\n+For example, you can raise a different exception, like `HTTPException`.\n \n /// tip\n \n@@ -109,7 +111,7 @@ But it's there for you if you need it. ü§ì\n \n {* ../../docs_src/dependencies/tutorial008b_an_py39.py hl[18:22,31] *}\n \n-An alternative you could use to catch exceptions (and possibly also raise another `HTTPException`) is to create a [Custom Exception Handler](../handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank}.\n+If you want to catch exceptions and create a custom response based on that, create a [Custom Exception Handler](../handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank}.\n \n ## Dependencies with `yield` and `except` { #dependencies-with-yield-and-except }\n \n@@ -121,7 +123,7 @@ In this case, the client will see an *HTTP 500 Internal Server Error* response a\n \n ### Always `raise` in Dependencies with `yield` and `except` { #always-raise-in-dependencies-with-yield-and-except }\n \n-If you catch an exception in a dependency with `yield`, unless you are raising another `HTTPException` or similar, you should re-raise the original exception.\n+If you catch an exception in a dependency with `yield`, unless you are raising another `HTTPE\n\n```\n\n```diff\n@@ -0,0 +1,38 @@\n+import time\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI, HTTPException\n+from fastapi.responses import StreamingResponse\n+from sqlmodel import Field, Session, SQLModel, create_engine\n+\n+engine = create_engine(\"postgresql+psycopg://postgres:postgres@localhost/db\")\n+\n+\n+class User(SQLModel, table=True):\n+    id: int | None = Field(default=None, primary_key=True)\n+    name: str\n+\n+\n+app = FastAPI()\n+\n+\n+def get_session():\n+    with Session(engine) as session:\n+        yield session\n+\n+\n+def get_user(user_id: int, session: Annotated[Session, Depends(get_session)]):\n+    user = session.get(User, user_id)\n+    if not user:\n+        raise HTTPException(status_code=403, detail=\"Not authorized\")\n+\n+\n+def generate_stream(query: str):\n+    for ch in query:\n+        yield ch\n+        time.sleep(0.1)\n+\n+\n+@app.get(\"/generate\", dependencies=[Depends(get_user)])\n+def generate(query: str):\n+    return StreamingResponse(content=generate_stream(query))\n\n```\n\n```diff\n@@ -0,0 +1,39 @@\n+import time\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI, HTTPException\n+from fastapi.responses import StreamingResponse\n+from sqlmodel import Field, Session, SQLModel, create_engine\n+\n+engine = create_engine(\"postgresql+psycopg://postgres:postgres@localhost/db\")\n+\n+\n+class User(SQLModel, table=True):\n+    id: int | None = Field(default=None, primary_key=True)\n+    name: str\n+\n+\n+app = FastAPI()\n+\n+\n+def get_session():\n+    with Session(engine) as session:\n+        yield session\n+\n+\n+def get_user(user_id: int, session: Annotated[Session, Depends(get_session)]):\n+    user = session.get(User, user_id)\n+    if not user:\n+        raise HTTPException(status_code=403, detail=\"Not authorized\")\n+    session.close()\n+\n+\n+def generate_stream(query: str):\n+    for ch in query:\n+        yield ch\n+        time.sleep(0.1)\n+\n+\n+@app.get(\"/generate\", dependencies=[Depends(get_user)])\n+def generate(query: str):\n+    \n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 495}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -63,3 +63,91 @@ In the chapters about security, there are utility functions that are implemented\n If you understood all this, you already know how those utility tools for security work underneath.\n \n ///\n+\n+## Dependencies with `yield`, `HTTPException`, `except` and Background Tasks { #dependencies-with-yield-httpexception-except-and-background-tasks }\n+\n+/// warning\n+\n+You most probably don't need these technical details.\n+\n+These details are useful mainly if you had a FastAPI application older than 0.118.0 and you are facing issues with dependencies with `yield`.\n+\n+///\n+\n+Dependencies with `yield` have evolved over time to account for the different use cases and to fix some issues, here's a summary of what has changed.\n+\n+### Dependencies with `yield` and `StreamingResponse`, Technical Details { #dependencies-with-yield-and-streamingresponse-technical-details }\n+\n+Before FastAPI 0.118.0, if you used a dependency with `yield`, it would run the exit code after the *path operation function* returned but right before sending the response.\n+\n+The intention was to avoid holding resources for longer than necessary, waiting for the response to travel through the network.\n+\n+This change also meant that if you returned a `StreamingResponse`, the exit code of the dependency with `yield` would have been already run.\n+\n+For example, if you had a database session in a dependency with `yield`, the `StreamingResponse` would not be able to use that session while streaming data because the session would have already been closed in the exit code after `yield`.\n+\n+This behavior was reverted in 0.118.0, to make the exit code after `yield` be executed after the response is sent.\n+\n+/// info\n+\n+As you will see below, this is very similar to the behavior before version 0.106.0, but with several improvements and bug fixes for corner cases.\n+\n+///\n+\n+#### Use Cases with Early Exit Code { #use-cases-with-early-exit-code }\n+\n+There are some use cases with specific conditions that could benefit from the old behavior of running the exit code of dependencies with `yield` before sending the response.\n+\n+For example, imagine you have code that uses a database session in a dependency with `yield` only to verify a user, but the database session is never used again in the *path operation function*, only in the dependency, **and** the response takes a long time to be sent, like a `StreamingResponse` that sends data slowly, but for some reason doesn't use the database.\n+\n+In this case, the database session would be held until the response is finished being sent, but if you don't use it, then it wouldn't be necessary to hold it.\n+\n+Here's how it could look like:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.py *}\n+\n+The exit code, the automatic closing of the `Session` in:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.py ln[19:21] *}\n+\n+...would be run after the the response finishes sending the slow data:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.\n\n```\n\n```diff\n@@ -35,7 +35,7 @@ The yielded value is what is injected into *path operations* and other dependenc\n \n {* ../../docs_src/dependencies/tutorial007.py hl[4] *}\n \n-The code following the `yield` statement is executed after creating the response but before sending it:\n+The code following the `yield` statement is executed after the response:\n \n {* ../../docs_src/dependencies/tutorial007.py hl[5:6] *}\n \n@@ -51,7 +51,7 @@ You can use `async` or regular functions.\n \n If you use a `try` block in a dependency with `yield`, you'll receive any exception that was thrown when using the dependency.\n \n-For example, if some code at some point in the middle, in another dependency or in a *path operation*, made a database transaction \"rollback\" or create any other error, you will receive the exception in your dependency.\n+For example, if some code at some point in the middle, in another dependency or in a *path operation*, made a database transaction \"rollback\" or created any other ", "output": "Bug: üêõ Fix support for `StreamingResponse`s with dependencies with `yield` or `UploadFile`s, close after the response is done\n\nüêõ Fix support for `StreamingResponse`s with dependencies with `yield` or `UploadFile`s, close after the response is done\r\n\r\n---\r\n\r\nThere's (again) an `AsyncExitStack` middleware, now used mainly to close objects after the response is done.\r\n\r\nThere's also a new wrapper duplicating some logic in Starlette but creating an `AsyncExitStack` for the exit code in dependencies with `yield`, for regular responses and WebSockets as well.\r\n\r\nThe exit code of dependencies with `yield` is now executed after the response is done.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 495}
{"instruction": "Review the following code changes: üêõ Fix support for `StreamingResponse`s with dependencies with `yield` or `UploadFile`s, close after the response is done", "input": "```diff\n@@ -63,3 +63,91 @@ In the chapters about security, there are utility functions that are implemented\n If you understood all this, you already know how those utility tools for security work underneath.\n \n ///\n+\n+## Dependencies with `yield`, `HTTPException`, `except` and Background Tasks { #dependencies-with-yield-httpexception-except-and-background-tasks }\n+\n+/// warning\n+\n+You most probably don't need these technical details.\n+\n+These details are useful mainly if you had a FastAPI application older than 0.118.0 and you are facing issues with dependencies with `yield`.\n+\n+///\n+\n+Dependencies with `yield` have evolved over time to account for the different use cases and to fix some issues, here's a summary of what has changed.\n+\n+### Dependencies with `yield` and `StreamingResponse`, Technical Details { #dependencies-with-yield-and-streamingresponse-technical-details }\n+\n+Before FastAPI 0.118.0, if you used a dependency with `yield`, it would run the exit code after the *path operation function* returned but right before sending the response.\n+\n+The intention was to avoid holding resources for longer than necessary, waiting for the response to travel through the network.\n+\n+This change also meant that if you returned a `StreamingResponse`, the exit code of the dependency with `yield` would have been already run.\n+\n+For example, if you had a database session in a dependency with `yield`, the `StreamingResponse` would not be able to use that session while streaming data because the session would have already been closed in the exit code after `yield`.\n+\n+This behavior was reverted in 0.118.0, to make the exit code after `yield` be executed after the response is sent.\n+\n+/// info\n+\n+As you will see below, this is very similar to the behavior before version 0.106.0, but with several improvements and bug fixes for corner cases.\n+\n+///\n+\n+#### Use Cases with Early Exit Code { #use-cases-with-early-exit-code }\n+\n+There are some use cases with specific conditions that could benefit from the old behavior of running the exit code of dependencies with `yield` before sending the response.\n+\n+For example, imagine you have code that uses a database session in a dependency with `yield` only to verify a user, but the database session is never used again in the *path operation function*, only in the dependency, **and** the response takes a long time to be sent, like a `StreamingResponse` that sends data slowly, but for some reason doesn't use the database.\n+\n+In this case, the database session would be held until the response is finished being sent, but if you don't use it, then it wouldn't be necessary to hold it.\n+\n+Here's how it could look like:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.py *}\n+\n+The exit code, the automatic closing of the `Session` in:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.py ln[19:21] *}\n+\n+...would be run after the the response finishes sending the slow data:\n+\n+{* ../../docs_src/dependencies/tutorial013_an_py310.\n\n```\n\n```diff\n@@ -35,7 +35,7 @@ The yielded value is what is injected into *path operations* and other dependenc\n \n {* ../../docs_src/dependencies/tutorial007.py hl[4] *}\n \n-The code following the `yield` statement is executed after creating the response but before sending it:\n+The code following the `yield` statement is executed after the response:\n \n {* ../../docs_src/dependencies/tutorial007.py hl[5:6] *}\n \n@@ -51,7 +51,7 @@ You can use `async` or regular functions.\n \n If you use a `try` block in a dependency with `yield`, you'll receive any exception that was thrown when using the dependency.\n \n-For example, if some code at some point in the middle, in another dependency or in a *path operation*, made a database transaction \"rollback\" or create any other error, you will receive the exception in your dependency.\n+For example, if some code at some point in the middle, in another dependency or in a *path operation*, made a database transaction \"rollback\" or created any other exception, you would receive the exception in your dependency.\n \n So, you can look for that specific exception inside the dependency with `except SomeException`.\n \n@@ -95,9 +95,11 @@ This works thanks to Python's <a href=\"https://docs.python.org/3/library/context\n \n ## Dependencies with `yield` and `HTTPException` { #dependencies-with-yield-and-httpexception }\n \n-You saw that you can use dependencies with `yield` and have `try` blocks that catch exceptions.\n+You saw that you can use dependencies with `yield` and have `try` blocks that try to execute some code and then run some exit code after `finally`.\n \n-The same way, you could raise an `HTTPException` or similar in the exit code, after the `yield`.\n+You can also use `except` to catch the exception that was raised and do something with it.\n+\n+For example, you can raise a different exception, like `HTTPException`.\n \n /// tip\n \n@@ -109,7 +111,7 @@ But it's there for you if you need it. ü§ì\n \n {* ../../docs_src/dependencies/tutorial008b_a", "output": "Changes look good. This PR implements: üêõ Fix support for `StreamingResponse`s with dependencies with `yield` or `UploadFile`s, close after the response is done", "source": "pr", "type": "code_review", "pr_number": 495}
{"instruction": "Fix the following bug: Fix same function names in different modules with composite bodies", "input": "Fix same function names in different modules with composite bodies.\r\n\r\nCurrently, if two *path operation functions* are named the same, in two separate modules, and receive several body parameters, they are converted into a composite body JSON Schema for OpenAPI.\r\n\r\nBut the names are generated based on the *path operation* name, and if the name is not assigned but autogenerated (based on the function name), two JSON Schemas could have the same name, breaking the OpenAPI generation.\r\n\r\nThis PR re-implements the name generation for composite bodies and response JSON Schemas in OpenAPI.\r\n\r\nAn explicit example can be found in the added tests.\r\n\r\nThis also means that it's now possible to use `.include_router` multiple times with the *same* router, under different `prefix`es, and it will work. For example, it can be used to expose the same router under different API prefixes (e.g. `/api/v2` and `/api/latest`).\r\n\r\nThis fixes #284", "output": "```diff\n@@ -8,7 +8,11 @@\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n from fastapi.params import Body, Param\n-from fastapi.utils import get_flat_models_from_routes, get_model_definitions\n+from fastapi.utils import (\n+    generate_operation_id_for_path,\n+    get_flat_models_from_routes,\n+    get_model_definitions,\n+)\n from pydantic.fields import Field\n from pydantic.schema import field_schema, get_model_name_map\n from pydantic.utils import lenient_issubclass\n@@ -113,10 +117,7 @@ def generate_operation_id(*, route: routing.APIRoute, method: str) -> str:\n     if route.operation_id:\n         return route.operation_id\n     path: str = route.path_format\n-    operation_id = route.name + path\n-    operation_id = operation_id.replace(\"{\", \"_\").replace(\"}\", \"_\").replace(\"/\", \"_\")\n-    operation_id = operation_id + \"_\" + method.lower()\n-    return operation_id\n+    return generate_operation_id_for_path(name=route.name, path=path, method=method)\n \n \n def generate_operation_summary(*, route: routing.APIRoute, method: str) -> str:\n\n```\n\n```diff\n@@ -13,7 +13,7 @@\n )\n from fastapi.encoders import jsonable_encoder\n from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n-from fastapi.utils import create_cloned_field\n+from fastapi.utils import create_cloned_field, generate_operation_id_for_path\n from pydantic import BaseConfig, BaseModel, Schema\n from pydantic.error_wrappers import ErrorWrapper, ValidationError\n from pydantic.fields import Field\n@@ -205,12 +205,19 @@ def __init__(\n         self.path = path\n         self.endpoint = endpoint\n         self.name = get_name(endpoint) if name is None else name\n+        self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n+        if methods is None:\n+            methods = [\"GET\"]\n+        self.methods = set([method.upper() for method in methods])\n+        self.unique_id = generate_operation_id_for_path(\n+            name=self.name, path=self.path_format, method=list(methods)[0]\n+        )\n         self.response_model = response_model\n         if self.response_model:\n             assert lenient_issubclass(\n                 response_class, JSONResponse\n             ), \"To declare a type the response must be a JSON response\"\n-            response_name = \"Response_\" + self.name\n+            response_name = \"Response_\" + self.unique_id\n             self.response_field: Optional[Field] = Field(\n                 name=response_name,\n                 type_=self.response_model,\n@@ -251,7 +258,7 @@ def __init__(\n                 assert lenient_issubclass(\n                     model, BaseModel\n                 ), \"A response model must be a Pydantic model\"\n-                response_name = f\"Response_{additional_status_code}_{self.name}\"\n+                response_name = f\"Response_{additional_status_code}_{self.unique_id}\"\n                 response_field = Field(\n                     name=response_name,\n                     type_=model,\n@@ -267,9 +274,6 @@ def __init__(\n         else:\n             self.response_fields = {}\n         self.deprecated = deprecated\n-        if methods is None:\n-            methods = [\"GET\"]\n-        self.methods = set([method.upper() for method in methods])\n         self.operation_id = operation_id\n         self.response_model_include = response_model_include\n         self.response_model_exclude = response_model_exclude\n@@ -278,7 +282,6 @@ def __init__(\n         self.include_in_schema = include_in_schema\n         self.response_class = response_class\n \n-        self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         assert inspect.isfunction(endpoint) or inspect.ismethod(\n             endpoint\n         ), f\"An endpoint must be a function or method\"\n@@ -288,7 +291,7 @@ def __init__(\n                 0,\n                 get_parameterless_sub_dependant(depends=depends, path=self.path_format),\n             )\n-        self.body_field = get_body_field(dependant=self.dependant, name=self.name)\n+        self.body_field = get_body_field(dependant=self.dep\n\n```\n\n```diff\n@@ -93,3 +93,10 @@ def create_cloned_field(field: Field) -> Field:\n     new_field.shape = field.shape\n     new_field._populate_validators()\n     return new_field\n+\n+\n+def generate_operation_id_for_path(*, name: str, path: str, method: str) -> str:\n+    operation_id = name + path\n+    operation_id = operation_id.replace(\"{\", \"_\").replace(\"}\", \"_\").replace(\"/\", \"_\")\n+    operation_id = operation_id + \"_\" + method.lower()\n+    return operation_id\n\n```\n\n```diff\n@@ -0,0 +1,8 @@\n+from fastapi import APIRouter, Body\n+\n+router = APIRouter()\n+\n+\n+@router.post(\"/compute\")\n+def compute(a: int = Body(...), b: str = Body(...)):\n+    return {\"a\": a, \"b\": b}\n\n```\n\n```diff\n@@ -0,0 +1,8 @@\n+from fastapi import APIRouter, Body\n+\n+router = APIRouter()\n+\n+\n+@router.post(\"/compute/\")\n+def compute(a: int = Body(...), b: str = Body(...)):\n+    return {\"a\": a, \"b\": b}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 494}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -8,7 +8,11 @@\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n from fastapi.params import Body, Param\n-from fastapi.utils import get_flat_models_from_routes, get_model_definitions\n+from fastapi.utils import (\n+    generate_operation_id_for_path,\n+    get_flat_models_from_routes,\n+    get_model_definitions,\n+)\n from pydantic.fields import Field\n from pydantic.schema import field_schema, get_model_name_map\n from pydantic.utils import lenient_issubclass\n@@ -113,10 +117,7 @@ def generate_operation_id(*, route: routing.APIRoute, method: str) -> str:\n     if route.operation_id:\n         return route.operation_id\n     path: str = route.path_format\n-    operation_id = route.name + path\n-    operation_id = operation_id.replace(\"{\", \"_\").replace(\"}\", \"_\").replace(\"/\", \"_\")\n-    operation_id = operation_id + \"_\" + method.lower()\n-    return operation_id\n+    return generate_operation_id_for_path(name=route.name, path=path, method=method)\n \n \n def generate_operation_summary(*, route: routing.APIRoute, method: str) -> str:\n\n```\n\n```diff\n@@ -13,7 +13,7 @@\n )\n from fastapi.encoders import jsonable_encoder\n from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n-from fastapi.utils import create_cloned_field\n+from fastapi.utils import create_cloned_field, generate_operation_id_for_path\n from pydantic import BaseConfig, BaseModel, Schema\n from pydantic.error_wrappers import ErrorWrapper, ValidationError\n from pydantic.fields import Field\n@@ -205,12 +205,19 @@ def __init__(\n         self.path = path\n         self.endpoint = endpoint\n         self.name = get_name(endpoint) if name is None else name\n+        self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n+        if methods is None:\n+            methods = [\"GET\"]\n+        self.methods = set([method.upper() for method in methods])\n+        self.unique_id = generate_operation_id_for_path(\n+            name=self.name, path=self.path_format, method=list(methods)[0]\n+        )\n         self.response_model = response_model\n         if self.response_model:\n             assert lenient_issubclass(\n                 response_class, JSONResponse\n             ), \"To declare a type the response must be a JSON response\"\n-            response_name = \"Response_\" + self.name\n+            response_name = \"Response_\" + self.unique_id\n             self.response_field: Optional[Field] = Field(\n                 name=response_name,\n                 type_=self.response_model,\n@@ -251,7 +258,7 @@ def __init__(\n                 assert lenient_issubclass(\n                     model, BaseModel\n                 ), \"A response model must be a Pydantic model\"\n-                response_name = f\"Response_{additional_status_code}_{self.name}\"\n+                response_name = f\"Response_{additional_status_code}_{self.unique_id}\"\n                 response_field = Field(\n                     name=response_name,\n                     type_=model,\n@@ -267,9 +274,6 @@ def __init__(\n         else:\n             self.response_fields = {}\n         self.deprecated = deprecated\n-        if methods is None:\n-            methods = [\"GET\"]\n-        self.methods = set([method.upper() for method in methods])\n         self.operation_id = operation_id\n         self.response_model_include = response_model_include\n         self.response_model_exclude = response_model_exclude\n@@ -278,7 +282,6 @@ def __init__(\n         self.include_in_schema = include_in_schema\n         self.response_class = response_class\n \n-        self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         assert inspect.isfunction(endpoint) or inspect.ismethod(\n             endpoint\n         ), f\"An endpoint must be a function or method\"\n@@ -288,7 +291,7 @@ def __init__(\n                 0,\n                 get_parameterless_sub_dependant(depends=depends, path=self.path_format),\n             )\n-        self.body_field = g", "output": "Bug: Fix same function names in different modules with composite bodies\n\nFix same function names in different modules with composite bodies.\r\n\r\nCurrently, if two *path operation functions* are named the same, in two separate modules, and receive several body parameters, they are converted into a composite body JSON Schema for OpenAPI.\r\n\r\nBut the names are generated based on the *path operation* name, and if the name is not assigned but autogenerated (based on the function name), two JSON Schemas could have the same name, breaking the OpenAPI generation.\r\n\r\nThis PR re-implements the name generation for composite bodies and response JSON Schemas in OpenAPI.\r\n\r\nAn explicit example can be found in the added tests.\r\n\r\nThis also means that it's now possible to use `.include_router` multiple times with the *same* router, under different `prefix`es, and it will work. For example, it can be used to expose the same router under different API prefixes (e.g. `/api/v2` and `/api/latest`).\r\n\r\nThis fixes #284", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 494}
{"instruction": "Review the following code changes: Fix same function names in different modules with composite bodies", "input": "```diff\n@@ -8,7 +8,11 @@\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n from fastapi.openapi.models import OpenAPI\n from fastapi.params import Body, Param\n-from fastapi.utils import get_flat_models_from_routes, get_model_definitions\n+from fastapi.utils import (\n+    generate_operation_id_for_path,\n+    get_flat_models_from_routes,\n+    get_model_definitions,\n+)\n from pydantic.fields import Field\n from pydantic.schema import field_schema, get_model_name_map\n from pydantic.utils import lenient_issubclass\n@@ -113,10 +117,7 @@ def generate_operation_id(*, route: routing.APIRoute, method: str) -> str:\n     if route.operation_id:\n         return route.operation_id\n     path: str = route.path_format\n-    operation_id = route.name + path\n-    operation_id = operation_id.replace(\"{\", \"_\").replace(\"}\", \"_\").replace(\"/\", \"_\")\n-    operation_id = operation_id + \"_\" + method.lower()\n-    return operation_id\n+    return generate_operation_id_for_path(name=route.name, path=path, method=method)\n \n \n def generate_operation_summary(*, route: routing.APIRoute, method: str) -> str:\n\n```\n\n```diff\n@@ -13,7 +13,7 @@\n )\n from fastapi.encoders import jsonable_encoder\n from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n-from fastapi.utils import create_cloned_field\n+from fastapi.utils import create_cloned_field, generate_operation_id_for_path\n from pydantic import BaseConfig, BaseModel, Schema\n from pydantic.error_wrappers import ErrorWrapper, ValidationError\n from pydantic.fields import Field\n@@ -205,12 +205,19 @@ def __init__(\n         self.path = path\n         self.endpoint = endpoint\n         self.name = get_name(endpoint) if name is None else name\n+        self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n+        if methods is None:\n+            methods = [\"GET\"]\n+        self.methods = set([method.upper() for method in methods])\n+        self.unique_id = generate_operation_id_for_path(\n+            name=self.name, path=self.path_format, method=list(methods)[0]\n+        )\n         self.response_model = response_model\n         if self.response_model:\n             assert lenient_issubclass(\n                 response_class, JSONResponse\n             ), \"To declare a type the response must be a JSON response\"\n-            response_name = \"Response_\" + self.name\n+            response_name = \"Response_\" + self.unique_id\n             self.response_field: Optional[Field] = Field(\n                 name=response_name,\n                 type_=self.response_model,\n@@ -251,7 +258,7 @@ def __init__(\n                 assert lenient_issubclass(\n                     model, BaseModel\n                 ), \"A response model must be a Pydantic model\"\n-                response_name = f\"Response_{additional_status_code}_{self.name}\"\n+                response_name = f\"Response_{additional_status_code}_{self.unique_id}\"\n                 response_field = Field(\n                     name=response_name,\n                     type_=model,\n@@ -267,9 +274,6 @@ def __init__(\n         else:\n             self.response_fields = {}\n         self.deprecated = deprecated\n-        if methods is None:\n-            methods = [\"GET\"]\n-        self.methods = set([method.upper() for method in methods])\n         self.operation_id = operation_id\n         self.response_model_include = response_model_include\n         self.response_model_exclude = response_model_exclude\n@@ -278,7 +282,6 @@ def __init__(\n         self.include_in_schema = include_in_schema\n         self.response_class = response_class\n \n-        self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         assert inspect.isfunction(endpoint) or inspect.ismethod(\n             endpoint\n         ), f\"An endpoint must be a function or method\"\n@@ -288,7 +291,7 @@ def __init__(\n                 0,\n                 get_parameterless_sub_dependant(depends=depends, path=self.path_format),\n             )\n-        self.body_field = get_body_field(dependant=self.dependant, name=self.name)\n+        self.body_field = get_body_field(dependant=self.dep\n\n```\n\n```diff\n@@ -93,3 +93,10 @@ def create_cloned_field(field: Field) -> Field:\n     new_field.shape = field.shape\n     new_field._populate_validators()\n     return new_field\n+\n+\n+def generate_operation_id_for_path(*, name: str, path: str, method: str) -> str:\n+    operation_id = name + path\n+    operation_id = operation_id.replace(\"{\", \"_\").replace(\"}\", \"_\").replace(\"/\", \"_\")\n+    operation_id = operation_id + \"_\" + method.lower()\n+    return operation_id\n\n```\n\n```diff\n@@ -0,0 +1,8 @@\n+from fastapi import APIRouter, Body\n+\n+router = APIRouter()\n+\n+\n+@router.post(\"/compute\")\n+def compute(a: int = Body(...), b: str = Body(...)):\n+    return {\"a\": a, \"b\": b}\n\n```\n\n```diff\n@@ -0,0 +1,8 @@\n+from fastapi import APIRouter, Body\n+\n+router = APIRouter()\n+\n+\n+@router.post(\"/compute/\")\n+def compute(a: int = Body(...), b: str = Body(...)):\n+    return {\"a\": a, \"b\": b}\n\n```", "output": "Changes look good. This PR implements: Fix same function names in different modules with composite bodies", "source": "pr", "type": "code_review", "pr_number": 494}
{"instruction": "Fix the following bug: üêõ Ensure that dependencies can always catch validation errors", "input": "Hello everyone,\r\n\r\nAccording to the [documentation](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield/#dependencies-with-yield-and-httpexception) dependencies should be able to catch and handle (postprocess, ignore, overwrite, ‚Ä¶) exceptions.\r\n\r\nIn fact that works for almost all cases, but not for pydantic validation errors for input parameters. It looks to me that the code block was just accidentally deindented and was placed after `async with`-block not inside.\r\n\r\nFirst commit adds new tests where 2 of 6 are failing. The second fixes the issue.", "output": "```diff\n@@ -2,7 +2,7 @@\n from typing import Dict\n \n import pytest\n-from fastapi import BackgroundTasks, Depends, FastAPI\n+from fastapi import BackgroundTasks, Depends, FastAPI, Query\n from fastapi.responses import StreamingResponse\n from fastapi.testclient import TestClient\n \n@@ -12,6 +12,8 @@\n     \"/sync\": \"generator not started\",\n     \"/async_raise\": \"asyncgen raise not started\",\n     \"/sync_raise\": \"generator raise not started\",\n+    \"/async_rewrite_exception\": \"asyncgen rewrite exception not started\",\n+    \"/sync_rewrite_exception\": \"generator rewrite exception not started\",\n     \"context_a\": \"not started a\",\n     \"context_b\": \"not started b\",\n     \"bg\": \"not set\",\n@@ -71,6 +73,28 @@ def generator_state_try(state: Dict[str, str] = Depends(get_state)):\n         state[\"/sync_raise\"] = \"generator raise finalized\"\n \n \n+async def asyncgen_state_rewrite_exception(state: Dict[str, str] = Depends(get_state)):\n+    state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception started\"\n+    try:\n+        yield state[\"/async_rewrite_exception\"]\n+    except Exception as error:\n+        errors.append(\"/async_rewrite_exception\")\n+        raise OtherDependencyError() from error\n+    finally:\n+        state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception finalized\"\n+\n+\n+def generator_state_rewrite_exception(state: Dict[str, str] = Depends(get_state)):\n+    state[\"/sync_rewrite_exception\"] = \"generator rewrite exception started\"\n+    try:\n+        yield state[\"/sync_rewrite_exception\"]\n+    except Exception as error:\n+        errors.append(\"/sync_rewrite_exception\")\n+        raise OtherDependencyError() from error\n+    finally:\n+        state[\"/sync_rewrite_exception\"] = \"generator rewrite exception finalized\"\n+\n+\n async def context_a(state: dict = Depends(get_state)):\n     state[\"context_a\"] = \"started a\"\n     try:\n@@ -121,6 +145,26 @@ async def get_sync_raise_other(state: str = Depends(generator_state_try)):\n     raise OtherDependencyError()\n \n \n+@app.get(\"/async_rewrite_exception\")\n+async def get_async_rewrite_exception(\n+    state: str = Depends(asyncgen_state_rewrite_exception),\n+    do_raise: bool = Query(),\n+):\n+    assert state == \"asyncgen rewrite exception started\"\n+    if do_raise:\n+        raise AsyncDependencyError()\n+\n+\n+@app.get(\"/sync_rewrite_exception\")\n+def get_sync_rewrite_exception(\n+    state: str = Depends(generator_state_rewrite_exception),\n+    do_raise: bool = Query(),\n+):\n+    assert state == \"generator rewrite exception started\"\n+    if do_raise:\n+        raise SyncDependencyError()\n+\n+\n @app.get(\"/context_b\")\n async def get_context_b(state: dict = Depends(context_b)):\n     return state\n@@ -263,6 +307,58 @@ def test_async_raise_server_error():\n     errors.clear()\n \n \n+def test_async_rewrite_exception_no_raise():\n+    state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception not started\"\n+    client.get(\"/async_rewrite_exception?do_raise=false\")\n+    assert state[\"/async_rewrite_exception\"] == \"asyncgen rewrite exception fi\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 493}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -2,7 +2,7 @@\n from typing import Dict\n \n import pytest\n-from fastapi import BackgroundTasks, Depends, FastAPI\n+from fastapi import BackgroundTasks, Depends, FastAPI, Query\n from fastapi.responses import StreamingResponse\n from fastapi.testclient import TestClient\n \n@@ -12,6 +12,8 @@\n     \"/sync\": \"generator not started\",\n     \"/async_raise\": \"asyncgen raise not started\",\n     \"/sync_raise\": \"generator raise not started\",\n+    \"/async_rewrite_exception\": \"asyncgen rewrite exception not started\",\n+    \"/sync_rewrite_exception\": \"generator rewrite exception not started\",\n     \"context_a\": \"not started a\",\n     \"context_b\": \"not started b\",\n     \"bg\": \"not set\",\n@@ -71,6 +73,28 @@ def generator_state_try(state: Dict[str, str] = Depends(get_state)):\n         state[\"/sync_raise\"] = \"generator raise finalized\"\n \n \n+async def asyncgen_state_rewrite_exception(state: Dict[str, str] = Depends(get_state)):\n+    state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception started\"\n+    try:\n+        yield state[\"/async_rewrite_exception\"]\n+    except Exception as error:\n+        errors.append(\"/async_rewrite_exception\")\n+        raise OtherDependencyError() from error\n+    finally:\n+        state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception finalized\"\n+\n+\n+def generator_state_rewrite_exception(state: Dict[str, str] = Depends(get_state)):\n+    state[\"/sync_rewrite_exception\"] = \"generator rewrite exception started\"\n+    try:\n+        yield state[\"/sync_rewrite_exception\"]\n+    except Exception as error:\n+        errors.append(\"/sync_rewrite_exception\")\n+        raise OtherDependencyError() from error\n+    finally:\n+        state[\"/sync_rewrite_exception\"] = \"generator rewrite exception finalized\"\n+\n+\n async def context_a(state: dict = Depends(get_state)):\n     state[\"context_a\"] = \"started a\"\n     try:\n@@ -121,6 +145,26 @@ async def get_sync_raise_other(state: str = Depends(generator_state_try)):\n     raise OtherDependencyError()\n \n \n+@app.get(\"/async_rewrite_exception\")\n+async def get_async_rewrite_exception(\n+    state: str = Depends(asyncgen_state_rewrite_exception),\n+    do_raise: bool = Query(),\n+):\n+    assert state == \"asyncgen rewrite exception started\"\n+    if do_raise:\n+        raise AsyncDependencyError()\n+\n+\n+@app.get(\"/sync_rewrite_exception\")\n+def get_sync_rewrite_exception(\n+    state: str = Depends(generator_state_rewrite_exception),\n+    do_raise: bool = Query(),\n+):\n+    assert state == \"generator rewrite exception started\"\n+    if do_raise:\n+        raise SyncDependencyError()\n+\n+\n @app.get(\"/context_b\")\n async def get_context_b(state: dict = Depends(context_b)):\n     return state\n@@ -263,6 +307,58 @@ def test_async_raise_server_error():\n     errors.clear()\n \n \n+def test_async_rewrite_exception_no_raise():\n+    state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception not started\"\n+    client.get(\"/async_rewrite_exception?do_raise=false\")\n+    assert state[\"/async_rewrite_exception\"] == \"asyncgen rewrite exception fi\n\n```", "output": "Bug: üêõ Ensure that dependencies can always catch validation errors\n\nHello everyone,\r\n\r\nAccording to the [documentation](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield/#dependencies-with-yield-and-httpexception) dependencies should be able to catch and handle (postprocess, ignore, overwrite, ‚Ä¶) exceptions.\r\n\r\nIn fact that works for almost all cases, but not for pydantic validation errors for input parameters. It looks to me that the code block was just accidentally deindented and was placed after `async with`-block not inside.\r\n\r\nFirst commit adds new tests where 2 of 6 are failing. The second fixes the issue.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 493}
{"instruction": "Review the following code changes: üêõ Ensure that dependencies can always catch validation errors", "input": "```diff\n@@ -2,7 +2,7 @@\n from typing import Dict\n \n import pytest\n-from fastapi import BackgroundTasks, Depends, FastAPI\n+from fastapi import BackgroundTasks, Depends, FastAPI, Query\n from fastapi.responses import StreamingResponse\n from fastapi.testclient import TestClient\n \n@@ -12,6 +12,8 @@\n     \"/sync\": \"generator not started\",\n     \"/async_raise\": \"asyncgen raise not started\",\n     \"/sync_raise\": \"generator raise not started\",\n+    \"/async_rewrite_exception\": \"asyncgen rewrite exception not started\",\n+    \"/sync_rewrite_exception\": \"generator rewrite exception not started\",\n     \"context_a\": \"not started a\",\n     \"context_b\": \"not started b\",\n     \"bg\": \"not set\",\n@@ -71,6 +73,28 @@ def generator_state_try(state: Dict[str, str] = Depends(get_state)):\n         state[\"/sync_raise\"] = \"generator raise finalized\"\n \n \n+async def asyncgen_state_rewrite_exception(state: Dict[str, str] = Depends(get_state)):\n+    state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception started\"\n+    try:\n+        yield state[\"/async_rewrite_exception\"]\n+    except Exception as error:\n+        errors.append(\"/async_rewrite_exception\")\n+        raise OtherDependencyError() from error\n+    finally:\n+        state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception finalized\"\n+\n+\n+def generator_state_rewrite_exception(state: Dict[str, str] = Depends(get_state)):\n+    state[\"/sync_rewrite_exception\"] = \"generator rewrite exception started\"\n+    try:\n+        yield state[\"/sync_rewrite_exception\"]\n+    except Exception as error:\n+        errors.append(\"/sync_rewrite_exception\")\n+        raise OtherDependencyError() from error\n+    finally:\n+        state[\"/sync_rewrite_exception\"] = \"generator rewrite exception finalized\"\n+\n+\n async def context_a(state: dict = Depends(get_state)):\n     state[\"context_a\"] = \"started a\"\n     try:\n@@ -121,6 +145,26 @@ async def get_sync_raise_other(state: str = Depends(generator_state_try)):\n     raise OtherDependencyError()\n \n \n+@app.get(\"/async_rewrite_exception\")\n+async def get_async_rewrite_exception(\n+    state: str = Depends(asyncgen_state_rewrite_exception),\n+    do_raise: bool = Query(),\n+):\n+    assert state == \"asyncgen rewrite exception started\"\n+    if do_raise:\n+        raise AsyncDependencyError()\n+\n+\n+@app.get(\"/sync_rewrite_exception\")\n+def get_sync_rewrite_exception(\n+    state: str = Depends(generator_state_rewrite_exception),\n+    do_raise: bool = Query(),\n+):\n+    assert state == \"generator rewrite exception started\"\n+    if do_raise:\n+        raise SyncDependencyError()\n+\n+\n @app.get(\"/context_b\")\n async def get_context_b(state: dict = Depends(context_b)):\n     return state\n@@ -263,6 +307,58 @@ def test_async_raise_server_error():\n     errors.clear()\n \n \n+def test_async_rewrite_exception_no_raise():\n+    state[\"/async_rewrite_exception\"] = \"asyncgen rewrite exception not started\"\n+    client.get(\"/async_rewrite_exception?do_raise=false\")\n+    assert state[\"/async_rewrite_exception\"] == \"asyncgen rewrite exception fi\n\n```", "output": "Changes look good. This PR implements: üêõ Ensure that dependencies can always catch validation errors", "source": "pr", "type": "code_review", "pr_number": 493}
{"instruction": "Fix the following bug: üêõ Fix parameter aliases", "input": "This PR fixes the rest of failing tests in #14358.\r\n\r\n---\r\n\r\n**Note:** for `validation_aliases` only string value is currently supported. We can later think of supporting `AliasPath` and `AliasChoices`\r\n\r\n\r\n**Will also fix issues:**\r\n\r\n<details>\r\n\r\n* https://github.com/fastapi/fastapi/discussions/8535\r\n* https://github.com/fastapi/fastapi/discussions/10014\r\n\r\n</details>", "output": "```diff\n@@ -110,6 +110,18 @@ def alias(self) -> str:\n         a = self.field_info.alias\n         return a if a is not None else self.name\n \n+    @property\n+    def validation_alias(self) -> Union[str, None]:\n+        va = self.field_info.validation_alias\n+        if isinstance(va, str) and va:\n+            return va\n+        return None\n+\n+    @property\n+    def serialization_alias(self) -> Union[str, None]:\n+        sa = self.field_info.serialization_alias\n+        return sa or None\n+\n     @property\n     def required(self) -> bool:\n         return self.field_info.is_required()\n@@ -243,12 +255,18 @@ def get_schema_from_model_field(\n         if (separate_input_output_schemas or _has_computed_fields(field))\n         else \"validation\"\n     )\n+    field_alias = (\n+        (field.validation_alias or field.alias)\n+        if field.mode == \"validation\"\n+        else (field.serialization_alias or field.alias)\n+    )\n+\n     # This expects that GenerateJsonSchema was already used to generate the definitions\n     json_schema = field_mapping[(field, override_mode or field.mode)]\n     if \"$ref\" not in json_schema:\n         # TODO remove when deprecating Pydantic v1\n         # Ref: https://github.com/pydantic/pydantic/blob/d61792cc42c80b13b23e3ffa74bc37ec7c77f7d1/pydantic/schema.py#L207\n-        json_schema[\"title\"] = field.field_info.title or field.alias.title().replace(\n+        json_schema[\"title\"] = field.field_info.title or field_alias.title().replace(\n             \"_\", \" \"\n         )\n     return json_schema\n\n```\n\n```diff\n@@ -752,7 +752,7 @@ def _validate_value_with_model_field(\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n-    alias = alias or field.alias\n+    alias = alias or get_validation_alias(field)\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n@@ -809,15 +809,13 @@ def request_params_to_args(\n                 field.field_info, \"convert_underscores\", default_convert_underscores\n             )\n             if convert_underscores:\n-                alias = (\n-                    field.alias\n-                    if field.alias != field.name\n-                    else field.name.replace(\"_\", \"-\")\n-                )\n+                alias = get_validation_alias(field)\n+                if alias == field.name:\n+                    alias = alias.replace(\"_\", \"-\")\n         value = _get_multidict_value(field, received_params, alias=alias)\n         if value is not None:\n-            params_to_process[field.alias] = value\n-        processed_keys.add(alias or field.alias)\n+            params_to_process[get_validation_alias(field)] = value\n+        processed_keys.add(alias or get_validation_alias(field))\n \n     for key in received_params.keys():\n         if key not in processed_keys:\n@@ -847,7 +845,7 @@ def request_params_to_args(\n         assert isinstance(field_info, (params.Param, temp_pydantic_v1_params.Param)), (\n             \"Params must be subclasses of Param\"\n         )\n-        loc = (field_info.in_.value, field.alias)\n+        loc = (field_info.in_.value, get_validation_alias(field))\n         v_, errors_ = _validate_value_with_model_field(\n             field=field, value=value, values=values, loc=loc\n         )\n@@ -936,8 +934,8 @@ async def process_fn(\n                     tg.start_soon(process_fn, sub_value.read)\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n-            values[field.alias] = value\n-    field_aliases = {field.alias for field in body_fields}\n+            values[get_validation_alias(field)] = value\n+    field_aliases = {get_validation_alias(field) for field in body_fields}\n     for key in received_body.keys():\n         if key not in field_aliases:\n             param_values = received_body.getlist(key)\n@@ -979,11 +977,11 @@ async def request_body_to_args(\n         )\n         return {first_field.name: v_}, errors_\n     for field in body_fields:\n-        loc = (\"body\", field.alias)\n+        loc = (\"body\", get_validation_alias(field))\n         value: Optional[Any] = None\n         if body_to_process is not None:\n             try:\n-                value = body_to_process.get(field.alias)\n+                value = body_to_process.get(get_validation_alias(field))\n             # If the received body is a list, not a dict\n             except AttributeError:\n                 errors.append(get_missing_field_error(loc))\n@@ -1062,3 +1060,8 @\n\n```\n\n```diff\n@@ -19,6 +19,7 @@\n     _get_flat_fields_from_params,\n     get_flat_dependant,\n     get_flat_params,\n+    get_validation_alias,\n )\n from fastapi.encoders import jsonable_encoder\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n@@ -141,15 +142,15 @@ def _get_openapi_operation_parameters(\n                 field_mapping=field_mapping,\n                 separate_input_output_schemas=separate_input_output_schemas,\n             )\n-            name = param.alias\n+            name = get_validation_alias(param)\n             convert_underscores = getattr(\n                 param.field_info,\n                 \"convert_underscores\",\n                 default_convert_underscores,\n             )\n             if (\n                 param_type == ParamTypes.header\n-                and param.alias == param.name\n+                and name == param.name\n                 and convert_underscores\n             ):\n                 name = param.name.replace(\"_\", \"-\")\n\n```\n\n```diff\n@@ -115,6 +115,10 @@ def __init__(\n         else:\n             kwargs[\"deprecated\"] = deprecated\n         if PYDANTIC_V2:\n+            if serialization_alias in (_Unset, None) and isinstance(alias, str):\n+                serialization_alias = alias\n+            if validation_alias in (_Unset, None):\n+                validation_alias = alias\n             kwargs.update(\n                 {\n                     \"annotation\": annotation,\n@@ -571,6 +575,10 @@ def __init__(\n         else:\n             kwargs[\"deprecated\"] = deprecated\n         if PYDANTIC_V2:\n+            if serialization_alias in (_Unset, None) and isinstance(alias, str):\n+                serialization_alias = alias\n+            if validation_alias in (_Unset, None):\n+                validation_alias = alias\n             kwargs.update(\n                 {\n                     \"annotation\": annotation,\n\n```\n\n```diff\n@@ -3,7 +3,6 @@\n import pytest\n from dirty_equals import IsDict, IsOneOf, IsPartialDict\n from fastapi import Body, FastAPI\n-from fastapi._compat import PYDANTIC_V2\n from fastapi.testclient import TestClient\n from pydantic import BaseModel, Field\n from typing_extensions import Annotated\n@@ -115,21 +114,13 @@ class BodyModelRequiredListAlias(BaseModel):\n \n @app.post(\"/model-required-list-alias\", operation_id=\"model_required_list_alias\")\n async def read_model_required_list_alias(p: BodyModelRequiredListAlias):\n-    return {\"p\": p.p}  # pragma: no cover\n+    return {\"p\": p.p}\n \n \n @pytest.mark.parametrize(\n     \"path\",\n     [\n-        pytest.param(\n-            \"/required-list-alias\",\n-            marks=pytest.mark.xfail(\n-                raises=AssertionError,\n-                condition=PYDANTIC_V2,\n-                reason=\"Fails only with PDv2 models\",\n-                strict=False,\n-            ),\n-        ),\n+        \"/required-list-alias\",\n         \"/model-required-list-alias\",\n     ],\n )\n@@ -253,7 +244,7 @@ class BodyModelRequiredListValidationAlias(BaseModel):\n async def read_model_required_list_validation_alias(\n     p: BodyModelRequiredListValidationAlias,\n ):\n-    return {\"p\": p.p}  # pragma: no cover\n+    return {\"p\": p.p}\n \n \n @needs_pydanticv2\n@@ -284,10 +275,7 @@ def test_required_list_validation_alias_schema(path: str):\n @pytest.mark.parametrize(\n     \"path\",\n     [\n-        pytest.param(\n-            \"/required-list-validation-alias\",\n-            marks=pytest.mark.xfail(raises=AssertionError, strict=False),\n-        ),\n+        \"/requi\n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 492}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -110,6 +110,18 @@ def alias(self) -> str:\n         a = self.field_info.alias\n         return a if a is not None else self.name\n \n+    @property\n+    def validation_alias(self) -> Union[str, None]:\n+        va = self.field_info.validation_alias\n+        if isinstance(va, str) and va:\n+            return va\n+        return None\n+\n+    @property\n+    def serialization_alias(self) -> Union[str, None]:\n+        sa = self.field_info.serialization_alias\n+        return sa or None\n+\n     @property\n     def required(self) -> bool:\n         return self.field_info.is_required()\n@@ -243,12 +255,18 @@ def get_schema_from_model_field(\n         if (separate_input_output_schemas or _has_computed_fields(field))\n         else \"validation\"\n     )\n+    field_alias = (\n+        (field.validation_alias or field.alias)\n+        if field.mode == \"validation\"\n+        else (field.serialization_alias or field.alias)\n+    )\n+\n     # This expects that GenerateJsonSchema was already used to generate the definitions\n     json_schema = field_mapping[(field, override_mode or field.mode)]\n     if \"$ref\" not in json_schema:\n         # TODO remove when deprecating Pydantic v1\n         # Ref: https://github.com/pydantic/pydantic/blob/d61792cc42c80b13b23e3ffa74bc37ec7c77f7d1/pydantic/schema.py#L207\n-        json_schema[\"title\"] = field.field_info.title or field.alias.title().replace(\n+        json_schema[\"title\"] = field.field_info.title or field_alias.title().replace(\n             \"_\", \" \"\n         )\n     return json_schema\n\n```\n\n```diff\n@@ -752,7 +752,7 @@ def _validate_value_with_model_field(\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n-    alias = alias or field.alias\n+    alias = alias or get_validation_alias(field)\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n@@ -809,15 +809,13 @@ def request_params_to_args(\n                 field.field_info, \"convert_underscores\", default_convert_underscores\n             )\n             if convert_underscores:\n-                alias = (\n-                    field.alias\n-                    if field.alias != field.name\n-                    else field.name.replace(\"_\", \"-\")\n-                )\n+                alias = get_validation_alias(field)\n+                if alias == field.name:\n+                    alias = alias.replace(\"_\", \"-\")\n         value = _get_multidict_value(field, received_params, alias=alias)\n         if value is not None:\n-            params_to_process[field.alias] = value\n-        processed_keys.add(alias or field.alias)\n+            params_to_process[get_validation_alias(field)] = value\n+        processed_keys.add(alias or get_validation_alias(field))\n \n     for key in received_params.keys():\n         if key not in processed_keys:\n@@ -847,7 +845,7 @@ def request_params_to_args(\n         assert isinstance(field_info, (params.Param, temp_pydantic_v1_params.Param)), (\n             \"Params must be subclasses of Param\"\n         )\n-        loc = (field_info.in_.value, field.alias)\n+        loc = (field_info.in_.value, get_validation_alias(field))\n         v_, errors_ = _validate_value_with_model_field(\n             field=field, value=value, values=values, loc=loc\n         )\n@@ -936,8 +934,8 @@ async def process_fn(\n                     tg.start_soon(process_fn, sub_value.read)\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n-            values[field.alias] = value\n-    field_aliases = {field.alias for field in body_fields}\n+            values[get_validation_alias(field)] = value\n+    field_aliases = {get_validation_alias(field) for field in body_fields}\n     for key in received_body.keys():\n         if key not in field_aliases:\n             param_values = received_body.getlist(key)\n@@ -979,11 +977,11 @@ async def request_body_to_args(\n         )\n         return {first_field.name", "output": "Bug: üêõ Fix parameter aliases\n\nThis PR fixes the rest of failing tests in #14358.\r\n\r\n---\r\n\r\n**Note:** for `validation_aliases` only string value is currently supported. We can later think of supporting `AliasPath` and `AliasChoices`\r\n\r\n\r\n**Will also fix issues:**\r\n\r\n<details>\r\n\r\n* https://github.com/fastapi/fastapi/discussions/8535\r\n* https://github.com/fastapi/fastapi/discussions/10014\r\n\r\n</details>", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 492}
{"instruction": "Review the following code changes: üêõ Fix parameter aliases", "input": "```diff\n@@ -110,6 +110,18 @@ def alias(self) -> str:\n         a = self.field_info.alias\n         return a if a is not None else self.name\n \n+    @property\n+    def validation_alias(self) -> Union[str, None]:\n+        va = self.field_info.validation_alias\n+        if isinstance(va, str) and va:\n+            return va\n+        return None\n+\n+    @property\n+    def serialization_alias(self) -> Union[str, None]:\n+        sa = self.field_info.serialization_alias\n+        return sa or None\n+\n     @property\n     def required(self) -> bool:\n         return self.field_info.is_required()\n@@ -243,12 +255,18 @@ def get_schema_from_model_field(\n         if (separate_input_output_schemas or _has_computed_fields(field))\n         else \"validation\"\n     )\n+    field_alias = (\n+        (field.validation_alias or field.alias)\n+        if field.mode == \"validation\"\n+        else (field.serialization_alias or field.alias)\n+    )\n+\n     # This expects that GenerateJsonSchema was already used to generate the definitions\n     json_schema = field_mapping[(field, override_mode or field.mode)]\n     if \"$ref\" not in json_schema:\n         # TODO remove when deprecating Pydantic v1\n         # Ref: https://github.com/pydantic/pydantic/blob/d61792cc42c80b13b23e3ffa74bc37ec7c77f7d1/pydantic/schema.py#L207\n-        json_schema[\"title\"] = field.field_info.title or field.alias.title().replace(\n+        json_schema[\"title\"] = field.field_info.title or field_alias.title().replace(\n             \"_\", \" \"\n         )\n     return json_schema\n\n```\n\n```diff\n@@ -752,7 +752,7 @@ def _validate_value_with_model_field(\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n-    alias = alias or field.alias\n+    alias = alias or get_validation_alias(field)\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n@@ -809,15 +809,13 @@ def request_params_to_args(\n                 field.field_info, \"convert_underscores\", default_convert_underscores\n             )\n             if convert_underscores:\n-                alias = (\n-                    field.alias\n-                    if field.alias != field.name\n-                    else field.name.replace(\"_\", \"-\")\n-                )\n+                alias = get_validation_alias(field)\n+                if alias == field.name:\n+                    alias = alias.replace(\"_\", \"-\")\n         value = _get_multidict_value(field, received_params, alias=alias)\n         if value is not None:\n-            params_to_process[field.alias] = value\n-        processed_keys.add(alias or field.alias)\n+            params_to_process[get_validation_alias(field)] = value\n+        processed_keys.add(alias or get_validation_alias(field))\n \n     for key in received_params.keys():\n         if key not in processed_keys:\n@@ -847,7 +845,7 @@ def request_params_to_args(\n         assert isinstance(field_info, (params.Param, temp_pydantic_v1_params.Param)), (\n             \"Params must be subclasses of Param\"\n         )\n-        loc = (field_info.in_.value, field.alias)\n+        loc = (field_info.in_.value, get_validation_alias(field))\n         v_, errors_ = _validate_value_with_model_field(\n             field=field, value=value, values=values, loc=loc\n         )\n@@ -936,8 +934,8 @@ async def process_fn(\n                     tg.start_soon(process_fn, sub_value.read)\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n-            values[field.alias] = value\n-    field_aliases = {field.alias for field in body_fields}\n+            values[get_validation_alias(field)] = value\n+    field_aliases = {get_validation_alias(field) for field in body_fields}\n     for key in received_body.keys():\n         if key not in field_aliases:\n             param_values = received_body.getlist(key)\n@@ -979,11 +977,11 @@ async def request_body_to_args(\n         )\n         return {first_field.name: v_}, errors_\n     for field in body_fields:\n-        loc = (\"body\", field.alias)\n+        loc = (\"body\", get_validation_alias(field))\n         value: Optional[Any] = None\n         if body_to_process is not None:\n             try:\n-                value = body_to_process.get(field.alias)\n+                value = body_to_process.get(get_validation_alias(field))\n             # If the received body is a list, not a dict\n             except AttributeError:\n                 errors.append(get_missing_field_error(loc))\n@@ -1062,3 +1060,8 @\n\n```\n\n```diff\n@@ -19,6 +19,7 @@\n     _get_flat_fields_from_params,\n     get_flat_dependant,\n     get_flat_params,\n+    get_validation_alias,\n )\n from fastapi.encoders import jsonable_encoder\n from fastapi.openapi.constants import METHODS_WITH_BODY, REF_PREFIX\n@@ -141,15 +142,15 @@ def _get_openapi_operation_parameters(\n                 field_mapping=field_mapping,\n                 separate_input_output_schemas=separate_input_output_schemas,\n             )\n", "output": "Changes look good. This PR implements: üêõ Fix parameter aliases", "source": "pr", "type": "code_review", "pr_number": 492}
{"instruction": "Fix the following bug: Fix HTTPBasic to always include realm in WWW-Authenticate", "input": "Fixes fastapi/fastapi#13471\r\n\r\nFastAPI previously returned `WWW-Authenticate: Basic` when HTTPBasic was used\r\nwithout an explicit realm. Some clients expect a realm per RFC 7617 and may\r\nfail without it.\r\n\r\nThis change ensures HTTPBasic always includes a realm (defaulting to \"FastAPI\")\r\nand adds a regression test. Existing tests were updated accordingly.\r\n\r\nTests:\r\npython -m pytest -q tests/test_security_http_basic_default_realm.py tests/test_security_http_basic_realm.py tests/test_security_http_basic_optional.py", "output": "```diff\n@@ -26,7 +26,7 @@ def get_current_username(\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers=security.make_authenticate_headers(),\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -23,7 +23,7 @@ def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers=security.make_authenticate_headers(),\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -197,9 +197,8 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        realm = self.realm or \"FastAPI\"\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```\n\n```diff\n@@ -0,0 +1,27 @@\n+from fastapi import Depends, FastAPI\n+from fastapi.security import HTTPBasic, HTTPBasicCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+security = HTTPBasic()\n+\n+\n+@app.get(\"/users/me\")\n+def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):\n+    return {\"username\": credentials.username, \"password\": credentials.password}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_security_http_basic_default_realm():\n+    # 401 branch: should include default realm\n+    response = client.get(\"/users/me\")\n+    assert response.status_code == 401, response.text\n+    assert response.headers[\"WWW-Authenticate\"] == 'Basic realm=\"FastAPI\"'\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+    # 200 branch: execute the return line to satisfy 100% coverage\n+    ok = client.get(\"/users/me\", auth=(\"john\", \"secret\"))\n+    assert ok.status_code == 200, ok.text\n+    assert ok.json() == {\"username\": \"john\", \"password\": \"secret\"}\n\n```\n\n```diff\n@@ -36,17 +36,22 @@ def test_security_http_basic_invalid_credentials():\n     response = client.get(\n         \"/users/me\", headers={\"Authorization\": \"Basic notabase64token\"}\n     )\n+    www_auth = response.headers[\"WWW-Authenticate\"]\n     assert response.status_code == 401, response.text\n-    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert www_auth.lower().startswith(\"basic\")\n+    assert 'realm=\"' in www_auth.lower()\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n def test_security_http_basic_non_basic_credentials():\n     payload = b64encode(b\"johnsecret\").decode(\"ascii\")\n     auth_header = f\"Basic {payload}\"\n     response = client.get(\"/users/me\", headers={\"Authorization\": auth_header})\n+    www_auth = response.headers[\"WWW-Authenticate\"]\n     assert response.status_code == 401, response.text\n-    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert www_auth.lower().startswith(\"basic\")\n+    assert 'realm=\"' in www_auth.lower()\n+\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 491}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -26,7 +26,7 @@ def get_current_username(\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers=security.make_authenticate_headers(),\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -23,7 +23,7 @@ def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers=security.make_authenticate_headers(),\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -197,9 +197,8 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        realm = self.realm or \"FastAPI\"\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```\n\n```diff\n@@ -0,0 +1,27 @@\n+from fastapi import Depends, FastAPI\n+from fastapi.security import HTTPBasic, HTTPBasicCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+security = HTTPBasic()\n+\n+\n+@app.get(\"/users/me\")\n+def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):\n+    return {\"username\": credentials.username, \"password\": credentials.password}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_security_http_basic_default_realm():\n+    # 401 branch: should include default realm\n+    response = client.get(\"/users/me\")\n+    assert response.status_code == 401, response.text\n+    assert response.headers[\"WWW-Authenticate\"] == 'Basic realm=\"FastAPI\"'\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+    # 200 branch: execute the return line to satisfy 100% coverage\n+    ok = client.get(\"/users/me\", auth=(\"john\", \"secret\"))\n+    assert ok.status_code == 200, ok.text\n+    assert ok.json() == {\"username\": \"john\", \"password\": \"secret\"}\n\n```\n\n```diff\n@@ -36,17 +36,22 @@ def test_security_http_basic_invalid_credentials():\n     response = client.get(\n         \"/users/me\", headers={\"Authorization\": \"Basic notabase64token\"}\n     )\n+    www_auth = response.headers[\"WWW-Authenticate\"]\n     assert response.status_code == 401, response.text\n-    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert www_auth.lower().startswith(\"basic\")\n+    assert 'realm=\"' in www_auth.lower()\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n def test_security_http_basic_non_basic_credentials():\n     payload = b64encode(b\"johnsecret\").decode(\"ascii\")\n     auth_header = f\"Basic {payload}\"\n     response = client.get(\"/users/me\", headers={\"Authorization\": auth_header})\n+    www_auth = response.headers[\"WWW-Authenticate\"]\n     assert response.status_code == 401, response.text\n-    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert www_auth.lower().startswith(\"basic\")\n+    assert 'realm=\"' in www_auth.lower()\n+\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n\n```", "output": "Bug: Fix HTTPBasic to always include realm in WWW-Authenticate\n\nFixes fastapi/fastapi#13471\r\n\r\nFastAPI previously returned `WWW-Authenticate: Basic` when HTTPBasic was used\r\nwithout an explicit realm. Some clients expect a realm per RFC 7617 and may\r\nfail without it.\r\n\r\nThis change ensures HTTPBasic always includes a realm (defaulting to \"FastAPI\")\r\nand adds a regression test. Existing tests were updated accordingly.\r\n\r\nTests:\r\npython -m pytest -q tests/test_security_http_basic_default_realm.py tests/test_security_http_basic_realm.py tests/test_security_http_basic_optional.py", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 491}
{"instruction": "Review the following code changes: Fix HTTPBasic to always include realm in WWW-Authenticate", "input": "```diff\n@@ -26,7 +26,7 @@ def get_current_username(\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers=security.make_authenticate_headers(),\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -23,7 +23,7 @@ def get_current_username(credentials: HTTPBasicCredentials = Depends(security)):\n         raise HTTPException(\n             status_code=status.HTTP_401_UNAUTHORIZED,\n             detail=\"Incorrect username or password\",\n-            headers={\"WWW-Authenticate\": \"Basic\"},\n+            headers=security.make_authenticate_headers(),\n         )\n     return credentials.username\n \n\n```\n\n```diff\n@@ -197,9 +197,8 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        realm = self.realm or \"FastAPI\"\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```\n\n```diff\n@@ -0,0 +1,27 @@\n+from fastapi import Depends, FastAPI\n+from fastapi.security import HTTPBasic, HTTPBasicCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+security = HTTPBasic()\n+\n+\n+@app.get(\"/users/me\")\n+def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):\n+    return {\"username\": credentials.username, \"password\": credentials.password}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_security_http_basic_default_realm():\n+    # 401 branch: should include default realm\n+    response = client.get(\"/users/me\")\n+    assert response.status_code == 401, response.text\n+    assert response.headers[\"WWW-Authenticate\"] == 'Basic realm=\"FastAPI\"'\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+    # 200 branch: execute the return line to satisfy 100% coverage\n+    ok = client.get(\"/users/me\", auth=(\"john\", \"secret\"))\n+    assert ok.status_code == 200, ok.text\n+    assert ok.json() == {\"username\": \"john\", \"password\": \"secret\"}\n\n```\n\n```diff\n@@ -36,17 +36,22 @@ def test_security_http_basic_invalid_credentials():\n     response = client.get(\n         \"/users/me\", headers={\"Authorization\": \"Basic notabase64token\"}\n     )\n+    www_auth = response.headers[\"WWW-Authenticate\"]\n     assert response.status_code == 401, response.text\n-    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert www_auth.lower().startswith(\"basic\")\n+    assert 'realm=\"' in www_auth.lower()\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n def test_security_http_basic_non_basic_credentials():\n     payload = b64encode(b\"johnsecret\").decode(\"ascii\")\n     auth_header = f\"Basic {payload}\"\n     response = client.get(\"/users/me\", headers={\"Authorization\": auth_header})\n+    www_auth = response.headers[\"WWW-Authenticate\"]\n     assert response.status_code == 401, response.text\n-    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert www_auth.lower().startswith(\"basic\")\n+    assert 'realm=\"' in www_auth.lower()\n+\n     assert response.json() == {\"detail\": \"Not authenticated\"}\n \n \n\n```", "output": "Changes look good. This PR implements: Fix HTTPBasic to always include realm in WWW-Authenticate", "source": "pr", "type": "code_review", "pr_number": 491}
{"instruction": "Review the following code changes: Docs: clarify response_model filtering behavior", "input": "```diff\n@@ -48,6 +48,8 @@ Notice that `response_model` is a parameter of the \"decorator\" method (`get`, `p\n `response_model` receives the same type you would declare for a Pydantic model field, so, it can be a Pydantic model, but it can also be, e.g. a `list` of Pydantic models, like `List[Item]`.\n \n FastAPI will use this `response_model` to do all the data documentation, validation, etc. and also to **convert and filter the output data** to its type declaration.\n+Note that this filtering applies only to the response sent to the client.\n+The object returned inside the path operation function is not modified.\n \n /// tip\n \n\n```", "output": "Changes look good. This PR implements: Docs: clarify response_model filtering behavior", "source": "pr", "type": "code_review", "pr_number": 490}
{"instruction": "Fix the following bug: docs: Basic auth `realm` is REQUIRED but handled as optional", "input": "## Description\n\nAccording to https://datatracker.ietf.org/doc/html/rfc7617#autoid-3 , specification of the `realm` parameter is REQUIRED, so making `realm` optional here\n\nhttps://github.com/fastapi/fastapi/blob/643d2\n\n## Changes Made\n\n- docs: Added contributing section\n\nFixes #13471", "output": "```diff\n@@ -560,3 +560,8 @@ Additional optional FastAPI dependencies:\n ## License\n \n This project is licensed under the terms of the MIT license.\n+\n+\n+## Contributing\n+\n+Contributions are welcome! Please feel free to submit a Pull Request.\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 489}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -560,3 +560,8 @@ Additional optional FastAPI dependencies:\n ## License\n \n This project is licensed under the terms of the MIT license.\n+\n+\n+## Contributing\n+\n+Contributions are welcome! Please feel free to submit a Pull Request.\n\n```", "output": "Bug: docs: Basic auth `realm` is REQUIRED but handled as optional\n\n## Description\n\nAccording to https://datatracker.ietf.org/doc/html/rfc7617#autoid-3 , specification of the `realm` parameter is REQUIRED, so making `realm` optional here\n\nhttps://github.com/fastapi/fastapi/blob/643d2\n\n## Changes Made\n\n- docs: Added contributing section\n\nFixes #13471", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 489}
{"instruction": "Review the following code changes: docs: Basic auth `realm` is REQUIRED but handled as optional", "input": "```diff\n@@ -560,3 +560,8 @@ Additional optional FastAPI dependencies:\n ## License\n \n This project is licensed under the terms of the MIT license.\n+\n+\n+## Contributing\n+\n+Contributions are welcome! Please feel free to submit a Pull Request.\n\n```", "output": "Changes look good. This PR implements: docs: Basic auth `realm` is REQUIRED but handled as optional", "source": "pr", "type": "code_review", "pr_number": 489}
{"instruction": "Review the following code changes: Require realm for HTTPBasic as per RFC 7617", "input": "```diff\n@@ -5,7 +5,6 @@\n from annotated_doc import Doc\n from fastapi.exceptions import HTTPException\n from fastapi.openapi.models import HTTPBase as HTTPBaseModel\n-from fastapi.openapi.models import HTTPBearer as HTTPBearerModel\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n@@ -298,8 +297,14 @@ def __init__(\n             ),\n         ] = True,\n     ):\n-        self.model = HTTPBearerModel(bearerFormat=bearerFormat, description=description)\n+        if realm is None:\n+            raise ValueError(\n+                \"HTTP Basic authentication requires a realm as per RFC 7617\"\n+            )\n+\n+        self.model = HTTPBaseModel(scheme=\"basic\", description=description)\n         self.scheme_name = scheme_name or self.__class__.__name__\n+        self.realm = realm\n         self.auto_error = auto_error\n \n     async def __call__(\n\n```", "output": "Changes look good. This PR implements: Require realm for HTTPBasic as per RFC 7617", "source": "pr", "type": "code_review", "pr_number": 487}
{"instruction": "Review the following code changes: Add support for Sentinel values", "input": "```diff\n@@ -67,6 +67,15 @@\n from starlette.websockets import WebSocket\n from typing_extensions import Literal, get_args, get_origin\n \n+try:\n+    # This was added in 4.14.0 (June 2, 2025) We want to be able to support older versions\n+    from typing_extensions import Sentinel\n+except ImportError:\n+\n+    class Sentinel:\n+        pass\n+\n+\n multipart_not_installed_error = (\n     'Form data requires \"python-multipart\" to be installed. \\n'\n     'You can install \"python-multipart\" with: \\n\\n'\n@@ -736,7 +745,11 @@ def _get_multidict_value(\n         if field.required:\n             return\n         else:\n-            return deepcopy(field.default)\n+            return (\n+                field.default\n+                if isinstance(field.default, Sentinel)\n+                else deepcopy(field.default)\n+            )\n     return value\n \n \n\n```\n\n```diff\n@@ -0,0 +1,271 @@\n+from typing import Union\n+\n+import pydantic_core\n+import pytest\n+from fastapi import Body, Cookie, FastAPI, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+try:\n+    # We support older pydantic versions, so do a safe import\n+    from pydantic_core import MISSING\n+except ImportError:\n+\n+    class MISSING:\n+        pass\n+\n+\n+def create_app():\n+    app = FastAPI()\n+\n+    class Item(BaseModel):\n+        data: Union[str, MISSING, None] = MISSING  # pyright: ignore[reportInvalidTypeForm] - requires pyright option: enableExperimentalFeatures = true\n+        # see https://docs.pydantic.dev/latest/concepts/experimental/#missing-sentinel\n+\n+    @app.post(\"/sentinel/\")\n+    def sentinel(\n+        item: Item = Body(),\n+    ):\n+        return item\n+\n+    @app.get(\"/query_sentinel/\")\n+    def query_sentinel(\n+        data: Union[str, MISSING, None] = Query(default=MISSING),  # pyright: ignore[reportInvalidTypeForm]\n+    ):\n+        return data\n+\n+    @app.get(\"/header_sentinel/\")\n+    def header_sentinel(\n+        data: Union[str, MISSING, None] = Header(default=MISSING),  # pyright: ignore[reportInvalidTypeForm]\n+    ):\n+        return data\n+\n+    @app.get(\"/cookie_sentinel/\")\n+    def cookie_sentinel(\n+        data: Union[str, MISSING, None] = Cookie(default=MISSING),  # pyright: ignore[reportInvalidTypeForm]\n+    ):\n+        return data\n+\n+    return app\n+\n+\n+@pytest.mark.skipif(\n+    pydantic_core.__version__ < \"2.37.0\",\n+    reason=\"This pydantic_core version doesn't support MISSING\",\n+)\n+def test_call_api():\n+    app = create_app()\n+    client = TestClient(app)\n+    response = client.post(\"/sentinel/\", json={})\n+    assert response.status_code == 200, response.text\n+    response = client.post(\"/sentinel/\", json={\"data\": \"Foo\"})\n+    assert response.status_code == 200, response.text\n+    response = client.get(\"/query_sentinel/\")\n+    assert response.status_code == 200, response.text\n+    response = client.get(\"/query_sentinel/\", params={\"data\": \"Foo\"})\n+    assert response.status_code == 200, response.text\n+    response = client.get(\"/header_sentinel/\")\n+    assert response.status_code == 200, response.text\n+    response = client.get(\"/header_sentinel/\", headers={\"data\": \"Foo\"})\n+    assert response.status_code == 200, response.text\n+    response = client.get(\"/cookie_sentinel/\")\n+    assert response.status_code == 200, response.text\n+    client.cookies = {\"data\": \"Foo\"}\n+    response = client.get(\"/cookie_sentinel/\")\n+    assert response.status_code == 200, response.text\n+\n+\n+@pytest.mark.skipif(\n+    pydantic_core.__version__ < \"2.37.0\",\n+    reason=\"This pydantic_core version doesn't support MISSING\",\n+)\n+def test_openapi_schema():\n+    \"\"\"\n+    Test that example overrides work:\n+\n+    * pydantic model schema_extra is included\n+    * Body(example={}) overrides schema_extra in pydantic model\n+    * Body(examples{}) overrides Body(example={}) and schema_extra in pydantic model\n+    \"\"\"\n+    a\n\n```\n\n```diff\n@@ -67,6 +67,15 @@\n from starlette.websockets import WebSocket\n from typing_extensions import Literal, get_args, get_origin\n \n+try:\n+    # This was added in 4.14.0 (June 2, 2025) We want to be able to support older versions\n+    from typing_extensions import Sentinel\n\n```", "output": "Code Review for: Add support for Sentinel values\n\nüìù **fastapi/dependencies/utils.py**: Note that this will need to be updated whenever sentinels gets added in the stdlib, to take both variants into account.\n\n", "source": "pr", "type": "code_review", "pr_number": 486}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -67,6 +67,15 @@\n from starlette.websockets import WebSocket\n from typing_extensions import Literal, get_args, get_origin\n \n+try:\n+    # This was added in 4.14.0 (June 2, 2025) We want to be able to support older versions\n+    from typing_extensions import Sentinel\n\n```", "output": "Note that this will need to be updated whenever sentinels gets added in the stdlib, to take both variants into account.", "source": "pr_review", "type": "inline_review", "pr_number": 486}
{"instruction": "Review the following code changes: ‚ö°Ô∏è Skip doing any work when sub dependant is already cached", "input": "```diff\n@@ -592,6 +592,17 @@ async def solve_dependencies(\n         dependency_cache = {}\n     for sub_dependant in dependant.dependencies:\n         sub_dependant.call = cast(Callable[..., Any], sub_dependant.call)\n+\n+        if sub_dependant.use_cache:\n+            # Use a unique object to compare against in case the cached value is None\n+            cache_miss = object()\n+            cached_value = dependency_cache.get(sub_dependant.cache_key, cache_miss)\n+            # If the sub dependant is already cached, skip doing any more work\n+            if cached_value is not cache_miss:\n+                if sub_dependant.name is not None:\n+                    values[sub_dependant.name] = cached_value\n+                continue\n+\n         call = sub_dependant.call\n         use_sub_dependant = sub_dependant\n         if (\n@@ -626,11 +637,7 @@ async def solve_dependencies(\n         if solved_result.errors:\n             errors.extend(solved_result.errors)\n             continue\n-        if sub_dependant.use_cache and sub_dependant.cache_key in dependency_cache:\n-            solved = dependency_cache[sub_dependant.cache_key]\n-        elif (\n-            use_sub_dependant.is_gen_callable or use_sub_dependant.is_async_gen_callable\n-        ):\n+        if use_sub_dependant.is_gen_callable or use_sub_dependant.is_async_gen_callable:\n             use_astack = request_astack\n             if sub_dependant.scope == \"function\":\n                 use_astack = function_astack\n\n```\n\n```diff\n@@ -1,9 +1,17 @@\n from fastapi import Depends, FastAPI, Security\n from fastapi.testclient import TestClient\n+from pydantic import BaseModel, model_validator\n \n app = FastAPI()\n \n-counter_holder = {\"counter\": 0}\n+counter_holder = {\"counter\": 0, \"parsing_counter\": 0}\n+\n+\n+class Model(BaseModel):\n+    @model_validator(mode=\"before\")\n+    def __validate__(cls, _):\n+        counter_holder[\"parsing_counter\"] += 1\n+        return {}\n \n \n async def dep_counter():\n@@ -15,6 +23,10 @@ async def super_dep(count: int = Depends(dep_counter)):\n     return count\n \n \n+async def model_dep(model: Model) -> Model:\n+    return model\n+\n+\n @app.get(\"/counter/\")\n async def get_counter(count: int = Depends(dep_counter)):\n     return {\"counter\": count}\n@@ -35,6 +47,15 @@ async def get_sub_counter_no_cache(\n     return {\"counter\": count, \"subcounter\": subcount}\n \n \n+@app.post(\"/sub-model-parsing/\")\n+async def get_double_model_parsing(\n+    a: Model = Depends(model_dep),\n+    b: Model = Depends(model_dep),\n+):\n+    assert a is b\n+    return {\"parsing_counter\": counter_holder[\"parsing_counter\"]}\n+\n+\n @app.get(\"/scope-counter\")\n async def get_scope_counter(\n     count: int = Security(dep_counter),\n@@ -81,6 +102,13 @@ def test_sub_counter_no_cache():\n     assert response.json() == {\"counter\": 4, \"subcounter\": 3}\n \n \n+def test_sub_model_parsing_no_repeatable_parsing():\n+    counter_holder[\"parsing_counter\"] = 0\n+    response = client.post(\"/sub-model-parsing/\", json={})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"parsing_counter\": 1}\n+\n+\n def test_security_cache():\n     counter_holder[\"counter\"] = 0\n     response = client.get(\"/scope-counter/\")\n\n```\n\n```diff\n@@ -549,6 +549,16 @@ async def solve_dependencies(\n         sub_dependant.cache_key = cast(\n             Tuple[Callable[..., Any], Tuple[str]], sub_dependant.cache_key\n         )\n+\n+        # If the dependant is already cached, skip doing any work here\n+        if (\n+            sub_dependant.use_cache\n+            and sub_dependant.cache_key in dependency_cache\n+            and sub_dependant.name is not None\n+        ):\n+            values[sub_dependant.name] = dependency_cache[sub_dependant.cache_key]\n+            continue\n\n```\n\n```diff\n@@ -549,6 +549,16 @@ async def solve_dependencies(\n         sub_dependant.cache_key = cast(\n             Tuple[Callable[..., Any], Tuple[str]], sub_dependant.cache_key\n         )\n+\n+        # If the dependant is already cached, skip doing any work here\n+        if (\n+            sub_dependant.use_cache\n+            and sub_dependant.cache_key in dependency_cache\n+            and sub_dependant.name is not None\n+        ):\n+            values[sub_dependant.name] = dependency_cache[sub_dependant.cache_key]\n+            continue\n\n```\n\n```diff\n@@ -587,13 +587,25 @@ async def solve_dependencies(\n         response = Response()\n         del response.headers[\"content-length\"]\n         response.status_code = None  # type: ignore\n-    dependency_cache = dependency_cache or {}\n+    if dependency_cache is None:\n+        dependency_cache = {}\n     sub_dependant: Dependant\n     for sub_dependant in dependant.dependencies:\n         sub_dependant.call = cast(Callable[..., Any], sub_dependant.call)\n         sub_dependant.cache_key = cast(\n             Tuple[Callable[..., Any], Tuple[str]], sub_dependant.cache_key\n         )\n+\n+        if sub_dependant.use_cache:\n+            # Use a unique object to compare against in case the cached value is None\n+            cac", "output": "Code Review for: ‚ö°Ô∏è Skip doing any work when sub dependant is already cached\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n        if (\r\n            sub_dependant.use_cache\r\n            and sub_dependant.cache_key in dependency_cache\r\n        ):\r\n            if sub_dependant.name is not None:\r\n                values[sub_dependant.name] = dependency_cache[sub_dependant.cache_key]\r\n            continue\r\n```\r\nTo skip solving dependencies without name, that were already cached.\n\nüìù **fastapi/dependencies/utils.py**: That makes sense üëç \r\n\r\nIn which cases will a sub_dependant not have a name?\n\nüìù **fastapi/dependencies/utils.py**: If I understand this right, nothing will happen in the end if `sub_dependant.name is None`, right? So maybe when that is the case we shouldn't even check the cache? I'm thinking we could change the `if` on L599 to include the `if` from L605, if you see what I mean:\r\n\r\n```suggestion\r\n        if sub_dependant.use_cache and sub_dependant.name is not None:\r\n            # Use a unique object to compare against in case the cached value is None\r\n            cache_miss = object()\r\n            cached_value = dependency_cache.get(sub_dependant.cache_key, cache_miss)\r\n            # If the sub dependant is already cached, skip doing any more work\r\n            if cached_value is not cache_miss:\r\n                values[sub_dependant.name] = cached_value\r\n                continue\r\n```\n\nüìù **fastapi/dependencies/utils.py**: Hm, not exactly _nothing_, since it will still hit that `continue` and skip doing any work here the value was cached. I'm not sure if this is a real thing that can happen though. Do you know of any cases where there would not be a `sub_dependant.name`?\n\nüìù **fastapi/dependencies/utils.py**: So from reading a bit of the code it seems like dependencies that are added to an api route directly won't have a name. So it's a real thing that happens, and I think we should skip calculating the dependency again if it's in the cache.\r\n\r\nhttps://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/#add-dependencies-to-the-path-operation-decorator\n\n", "source": "pr", "type": "code_review", "pr_number": 485}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -549,6 +549,16 @@ async def solve_dependencies(\n         sub_dependant.cache_key = cast(\n             Tuple[Callable[..., Any], Tuple[str]], sub_dependant.cache_key\n         )\n+\n+        # If the dependant is already cached, skip doing any work here\n+        if (\n+            sub_dependant.use_cache\n+            and sub_dependant.cache_key in dependency_cache\n+            and sub_dependant.name is not None\n+        ):\n+            values[sub_dependant.name] = dependency_cache[sub_dependant.cache_key]\n+            continue\n\n```", "output": "```suggestion\r\n        if (\r\n            sub_dependant.use_cache\r\n            and sub_dependant.cache_key in dependency_cache\r\n        ):\r\n            if sub_dependant.name is not None:\r\n                values[sub_dependant.name] = dependency_cache[sub_dependant.cache_key]\r\n            continue\r\n```\r\nTo skip solving dependencies without name, that were already cached.", "source": "pr_review", "type": "inline_review", "pr_number": 485}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -587,13 +587,25 @@ async def solve_dependencies(\n         response = Response()\n         del response.headers[\"content-length\"]\n         response.status_code = None  # type: ignore\n-    dependency_cache = dependency_cache or {}\n+    if dependency_cache is None:\n+        dependency_cache = {}\n     sub_dependant: Dependant\n     for sub_dependant in dependant.dependencies:\n         sub_dependant.call = cast(Callable[..., Any], sub_dependant.call)\n         sub_dependant.cache_key = cast(\n             Tuple[Callable[..., Any], Tuple[str]], sub_dependant.cache_key\n         )\n+\n+        if sub_dependant.use_cache:\n+            # Use a unique object to compare against in case the cached value is None\n+            cache_miss = object()\n+            cached_value = dependency_cache.get(sub_dependant.cache_key, cache_miss)\n+            # If the sub dependant is already cached, skip doing any more work\n+            if cached_value is not cache_miss:\n+                if sub_dependant.name is not None:\n+                    values[sub_dependant.name] = cached_value\n+                continue\n\n```", "output": "If I understand this right, nothing will happen in the end if `sub_dependant.name is None`, right? So maybe when that is the case we shouldn't even check the cache? I'm thinking we could change the `if` on L599 to include the `if` from L605, if you see what I mean:\r\n\r\n```suggestion\r\n        if sub_dependant.use_cache and sub_dependant.name is not None:\r\n            # Use a unique object to compare against in case the cached value is None\r\n            cache_miss = object()\r\n            cached_value = dependency_cache.get(sub_dependant.cache_key, cache_miss)\r\n            # If the sub dependant is already cached, skip doing any more work\r\n            if cached_value is not cache_miss:\r\n                values[sub_dependant.name] = cached_value\r\n                continue\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 485}
{"instruction": "Review the following code changes: test", "input": "```diff\n@@ -0,0 +1,82 @@\n+# CLAUDE.md\n+\n+This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\n+\n+## Build and Development Commands\n+\n+**Install dependencies:**\n+\n```", "output": "Changes look good. This PR implements: test", "source": "pr", "type": "code_review", "pr_number": 484}
{"instruction": "Review the following code changes: üë• Update FastAPI People - Contributors and Translators", "input": "```diff\n@@ -8,7 +8,7 @@ updates:\n     commit-message:\n       prefix: ‚¨Ü\n   # Python\n-  - package-ecosystem: \"pip\"\n+  - package-ecosystem: \"uv\"\n     directory: \"/\"\n     schedule:\n       interval: \"monthly\"\n\n```\n\n```diff\n@@ -8,9 +8,6 @@ on:\n       - opened\n       - synchronize\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   changes:\n     runs-on: ubuntu-latest\n@@ -31,8 +28,8 @@ jobs:\n             - README.md\n             - docs/**\n             - docs_src/**\n-            - requirements-docs.txt\n             - pyproject.toml\n+            - uv.lock\n             - mkdocs.yml\n             - mkdocs.env.yml\n             - .github/workflows/build-docs.yml\n@@ -49,21 +46,20 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install docs extras\n-        run: uv pip install -r requirements-docs.txt\n+        run: uv sync --locked --no-dev --group docs\n       - name: Export Language Codes\n         id: show-langs\n         run: |\n-          echo \"langs=$(python ./scripts/docs.py langs-json)\" >> $GITHUB_OUTPUT\n+          echo \"langs=$(uv run ./scripts/docs.py langs-json)\" >> $GITHUB_OUTPUT\n \n   build-docs:\n     needs:\n@@ -83,25 +79,24 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install docs extras\n-        run: uv pip install -r requirements-docs.txt\n+        run: uv sync --locked --no-dev --group docs\n       - name: Update Languages\n-        run: python ./scripts/docs.py update-languages\n+        run: uv run ./scripts/docs.py update-languages\n       - uses: actions/cache@v4\n         with:\n           key: mkdocs-cards-${{ matrix.lang }}-${{ github.ref }}\n           path: docs/${{ matrix.lang }}/.cache\n       - name: Build Docs\n-        run: python ./scripts/docs.py build-lang ${{ matrix.lang }}\n+        run: uv run ./scripts/docs.py build-lang ${{ matrix.lang }}\n       - uses: actions/upload-artifact@v5\n         with:\n           name: docs-site-${{ matrix.lang }}\n\n```\n\n```diff\n@@ -10,9 +10,6 @@ on:\n         required: false\n         default: \"false\"\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   job:\n     if: github.repository_owner == 'fastapi'\n@@ -28,17 +25,16 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install Dependencies\n-        run: uv pip install -r requirements-github-actions.txt\n+        run: uv sync --locked --no-dev --group github-actions\n       # Allow debugging with tmate\n       - name: Setup tmate session\n         uses: mxschmitt/action-tmate@v3\n@@ -48,6 +44,6 @@ jobs:\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n       - name: FastAPI People Contributors\n-        run: python ./scripts/contributors.py\n+        run: uv run ./scripts/contributors.py\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n\n```\n\n```diff\n@@ -12,9 +12,6 @@ permissions:\n   pull-requests: write\n   statuses: write\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   deploy-docs:\n     runs-on: ubuntu-latest\n@@ -27,19 +24,18 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install GitHub Actions dependencies\n-        run: uv pip install -r requirements-github-actions.txt\n+        run: uv sync --locked --no-dev --group github-actions\n       - name: Deploy Docs Status Pending\n-        run: python ./scripts/deploy_docs_status.py\n+        run: uv run ./scripts/deploy_docs_status.py\n         env:\n           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n           COMMIT_SHA: ${{ github.event.workflow_run.head_sha }}\n@@ -70,14 +66,14 @@ jobs:\n           command: pages deploy ", "output": "Changes look good. This PR implements: üë• Update FastAPI People - Contributors and Translators", "source": "pr", "type": "code_review", "pr_number": 483}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è  Migrate to uv", "input": "```diff\n@@ -8,7 +8,7 @@ updates:\n     commit-message:\n       prefix: ‚¨Ü\n   # Python\n-  - package-ecosystem: \"pip\"\n+  - package-ecosystem: \"uv\"\n     directory: \"/\"\n     schedule:\n       interval: \"monthly\"\n\n```\n\n```diff\n@@ -8,9 +8,6 @@ on:\n       - opened\n       - synchronize\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   changes:\n     runs-on: ubuntu-latest\n@@ -31,8 +28,8 @@ jobs:\n             - README.md\n             - docs/**\n             - docs_src/**\n-            - requirements-docs.txt\n             - pyproject.toml\n+            - uv.lock\n             - mkdocs.yml\n             - mkdocs.env.yml\n             - .github/workflows/build-docs.yml\n@@ -49,21 +46,20 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install docs extras\n-        run: uv pip install -r requirements-docs.txt\n+        run: uv sync --locked --no-dev --group docs\n       - name: Export Language Codes\n         id: show-langs\n         run: |\n-          echo \"langs=$(python ./scripts/docs.py langs-json)\" >> $GITHUB_OUTPUT\n+          echo \"langs=$(uv run ./scripts/docs.py langs-json)\" >> $GITHUB_OUTPUT\n \n   build-docs:\n     needs:\n@@ -83,25 +79,24 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install docs extras\n-        run: uv pip install -r requirements-docs.txt\n+        run: uv sync --locked --no-dev --group docs\n       - name: Update Languages\n-        run: python ./scripts/docs.py update-languages\n+        run: uv run ./scripts/docs.py update-languages\n       - uses: actions/cache@v4\n         with:\n           key: mkdocs-cards-${{ matrix.lang }}-${{ github.ref }}\n           path: docs/${{ matrix.lang }}/.cache\n       - name: Build Docs\n-        run: python ./scripts/docs.py build-lang ${{ matrix.lang }}\n+        run: uv run ./scripts/docs.py build-lang ${{ matrix.lang }}\n       - uses: actions/upload-artifact@v5\n         with:\n           name: docs-site-${{ matrix.lang }}\n\n```\n\n```diff\n@@ -10,9 +10,6 @@ on:\n         required: false\n         default: \"false\"\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   job:\n     if: github.repository_owner == 'fastapi'\n@@ -28,17 +25,16 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install Dependencies\n-        run: uv pip install -r requirements-github-actions.txt\n+        run: uv sync --locked --no-dev --group github-actions\n       # Allow debugging with tmate\n       - name: Setup tmate session\n         uses: mxschmitt/action-tmate@v3\n@@ -48,6 +44,6 @@ jobs:\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n       - name: FastAPI People Contributors\n-        run: python ./scripts/contributors.py\n+        run: uv run ./scripts/contributors.py\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n\n```\n\n```diff\n@@ -12,9 +12,6 @@ permissions:\n   pull-requests: write\n   statuses: write\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   deploy-docs:\n     runs-on: ubuntu-latest\n@@ -27,19 +24,18 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install GitHub Actions dependencies\n-        run: uv pip install -r requirements-github-actions.txt\n+        run: uv sync --locked --no-dev --group github-actions\n       - name: Deploy Docs Status Pending\n-        run: python ./scripts/deploy_docs_status.py\n+        run: uv run ./scripts/deploy_docs_status.py\n         env:\n           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n           COMMIT_SHA: ${{ github.event.workflow_run.head_sha }}\n@@ -70,14 +66,14 @@ jobs:\n           command: pages deploy ", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è  Migrate to uv", "source": "pr", "type": "code_review", "pr_number": 482}
{"instruction": "Review the following code changes: üë• Update FastAPI GitHub topic repositories", "input": "```diff\n@@ -8,7 +8,7 @@ updates:\n     commit-message:\n       prefix: ‚¨Ü\n   # Python\n-  - package-ecosystem: \"pip\"\n+  - package-ecosystem: \"uv\"\n     directory: \"/\"\n     schedule:\n       interval: \"monthly\"\n\n```\n\n```diff\n@@ -8,9 +8,6 @@ on:\n       - opened\n       - synchronize\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   changes:\n     runs-on: ubuntu-latest\n@@ -31,8 +28,8 @@ jobs:\n             - README.md\n             - docs/**\n             - docs_src/**\n-            - requirements-docs.txt\n             - pyproject.toml\n+            - uv.lock\n             - mkdocs.yml\n             - mkdocs.env.yml\n             - .github/workflows/build-docs.yml\n@@ -49,21 +46,20 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install docs extras\n-        run: uv pip install -r requirements-docs.txt\n+        run: uv sync --locked --no-dev --group docs\n       - name: Export Language Codes\n         id: show-langs\n         run: |\n-          echo \"langs=$(python ./scripts/docs.py langs-json)\" >> $GITHUB_OUTPUT\n+          echo \"langs=$(uv run ./scripts/docs.py langs-json)\" >> $GITHUB_OUTPUT\n \n   build-docs:\n     needs:\n@@ -83,25 +79,24 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install docs extras\n-        run: uv pip install -r requirements-docs.txt\n+        run: uv sync --locked --no-dev --group docs\n       - name: Update Languages\n-        run: python ./scripts/docs.py update-languages\n+        run: uv run ./scripts/docs.py update-languages\n       - uses: actions/cache@v4\n         with:\n           key: mkdocs-cards-${{ matrix.lang }}-${{ github.ref }}\n           path: docs/${{ matrix.lang }}/.cache\n       - name: Build Docs\n-        run: python ./scripts/docs.py build-lang ${{ matrix.lang }}\n+        run: uv run ./scripts/docs.py build-lang ${{ matrix.lang }}\n       - uses: actions/upload-artifact@v5\n         with:\n           name: docs-site-${{ matrix.lang }}\n\n```\n\n```diff\n@@ -10,9 +10,6 @@ on:\n         required: false\n         default: \"false\"\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   job:\n     if: github.repository_owner == 'fastapi'\n@@ -28,17 +25,16 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install Dependencies\n-        run: uv pip install -r requirements-github-actions.txt\n+        run: uv sync --locked --no-dev --group github-actions\n       # Allow debugging with tmate\n       - name: Setup tmate session\n         uses: mxschmitt/action-tmate@v3\n@@ -48,6 +44,6 @@ jobs:\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n       - name: FastAPI People Contributors\n-        run: python ./scripts/contributors.py\n+        run: uv run ./scripts/contributors.py\n         env:\n           GITHUB_TOKEN: ${{ secrets.FASTAPI_PR_TOKEN }}\n\n```\n\n```diff\n@@ -12,9 +12,6 @@ permissions:\n   pull-requests: write\n   statuses: write\n \n-env:\n-  UV_SYSTEM_PYTHON: 1\n-\n jobs:\n   deploy-docs:\n     runs-on: ubuntu-latest\n@@ -27,19 +24,18 @@ jobs:\n       - name: Set up Python\n         uses: actions/setup-python@v6\n         with:\n-          python-version: \"3.11\"\n+          python-version-file: \".python-version\"\n       - name: Setup uv\n         uses: astral-sh/setup-uv@v7\n         with:\n-          version: \"0.4.15\"\n           enable-cache: true\n           cache-dependency-glob: |\n-            requirements**.txt\n             pyproject.toml\n+            uv.lock\n       - name: Install GitHub Actions dependencies\n-        run: uv pip install -r requirements-github-actions.txt\n+        run: uv sync --locked --no-dev --group github-actions\n       - name: Deploy Docs Status Pending\n-        run: python ./scripts/deploy_docs_status.py\n+        run: uv run ./scripts/deploy_docs_status.py\n         env:\n           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n           COMMIT_SHA: ${{ github.event.workflow_run.head_sha }}\n@@ -70,14 +66,14 @@ jobs:\n           command: pages deploy ", "output": "Changes look good. This PR implements: üë• Update FastAPI GitHub topic repositories", "source": "pr", "type": "code_review", "pr_number": 481}
{"instruction": "Review the following code changes: 'internal': added test cases for invalid data formats", "input": "```diff\n@@ -47,6 +47,22 @@ def get_invalidlist():\n     ]\n \n \n+# edge cases\n+@app.get(\"/items/invalidDict\", response_model=Item)\n+def get_invalidDict():\n+    return {\"name\": \"invalid\", \"owner_ids\": {\"id\": 1}}\n+\n+\n+@app.get(\"/items/invalidtype\", response_model=Item)\n+def get_invalidtype():\n+    return {\"name\": 3, \"price\": 2.7}\n+\n+\n+@app.get(\"/items/invalidtuple\", response_model=Item)\n+def get_invalid_typle():\n+    return {\"name\": \"invalid\", \"price\": (2.5, 3.5)}\n+\n+\n client = TestClient(app)\n \n \n@@ -82,3 +98,18 @@ def test_double_invalid():\n def test_invalid_list():\n     with pytest.raises(ResponseValidationError):\n         client.get(\"/items/invalidlist\")\n+\n+\n+def test_invalid_dict():\n+    with pytest.raises(ResponseValidationError):\n+        client.get(\"/items/invalidDict\")\n+\n+\n+def test_invalid_type():\n+    with pytest.raises(ResponseValidationError):\n+        client.get(\"/items/invalidtype\")\n+\n+\n+def test_invalid_tuple():\n+    with pytest.raises(ResponseValidationError):\n+        client.get(\"/items/invalidtuple\")\n\n```", "output": "Changes look good. This PR implements: 'internal': added test cases for invalid data formats", "source": "pr", "type": "code_review", "pr_number": 480}
{"instruction": "Fix the following bug: üêõ Fix tagged discriminated union not recognized as body field", "input": "## Problem\r\n\r\nWhen using a union type models with a tagged discriminator as an endpoint parameter, like the following:\r\n\r\n```py\r\nclass Pie(BaseModel):\r\n    time_to_cook: int\r\n    num_ingredients: int\r\n\r\n\r\nclass ApplePie(Pie):\r\n    fruit: Literal[\"apple\"] = \"apple\"\r\n\r\n\r\nclass PumpkinPie(Pie):\r\n    filling: Literal[\"pumpkin\"] = \"pumpkin\"\r\n\r\n\r\ndef get_discriminator_value(v: Any) -> str:\r\n    if isinstance(v, dict):\r\n        return v.get(\"fruit\", v.get(\"filling\"))\r\n    return getattr(v, \"fruit\", getattr(v, \"filling\", None))\r\n\r\n\r\nDessert = Annotated[\r\n    Annotated[ApplePie, Tag(\"apple\")] | Annotated[PumpkinPie, Tag(\"pumpkin\")],\r\n    Discriminator(get_discriminator_value),\r\n]\r\n\r\n\r\napp = FastAPI()\r\n@app.post(\"/dessert\")\r\nasync def dinner(dessert: Dessert) -> dict[str, Any]:\r\n    return dessert.model_dump()\r\n```\r\n\r\nFastAPI fails to identify it correctly as **body** payload. It incorrectly considers it's a query parameter, which then causes a validation error. The workaround currently is to explicitly tell FastAPI it's a body parameter using `dessert: Annotated[Dessert, Body()]`\r\n\r\n## Fix\r\n\r\nThe solution is to improve the function handling type annotations by handling the case where we can have `Annotated`\r\n types inside an `Annotated` type.\r\n\r\n---\r\n\r\nDiscussed in https://github.com/fastapi/fastapi/discussions/12941", "output": "```diff\n@@ -590,6 +590,9 @@ def field_annotation_is_complex(annotation: Union[Type[Any], None]) -> bool:\n     if origin is Union or origin is UnionType:\n         return any(field_annotation_is_complex(arg) for arg in get_args(annotation))\n \n+    if origin is Annotated:\n+        return field_annotation_is_complex(get_args(annotation)[0])\n+\n     return (\n         _annotation_is_complex(annotation)\n         or _annotation_is_complex(origin)\n\n```\n\n```diff\n@@ -0,0 +1,188 @@\n+from typing import Any, Dict, Union\n+\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel, Field\n+from typing_extensions import Annotated, Literal\n+\n+from .utils import needs_pydanticv2\n+\n+\n+@needs_pydanticv2\n+def test_discriminator_pydantic_v2() -> None:\n+    from pydantic import Tag\n+\n+    app = FastAPI()\n+\n+    class FirstItem(BaseModel):\n+        value: Literal[\"first\"]\n+        price: int\n+\n+    class OtherItem(BaseModel):\n+        value: Literal[\"other\"]\n+        price: float\n+\n+    Item = Annotated[\n+        Union[Annotated[FirstItem, Tag(\"first\")], Annotated[OtherItem, Tag(\"other\")]],\n+        Field(discriminator=\"value\"),\n+    ]\n+\n+    @app.post(\"/items/\")\n+    def save_union_body_discriminator(\n+        item: Item, q: Annotated[str, Field(description=\"Query string\")]\n+    ) -> Dict[str, Any]:\n+        return {\"item\": item}\n+\n+    client = TestClient(app)\n+    response = client.post(\"/items/?q=first\", json={\"value\": \"first\", \"price\": 100})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"item\": {\"value\": \"first\", \"price\": 100}}\n+\n+    response = client.post(\"/items/?q=other\", json={\"value\": \"other\", \"price\": 100.5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"item\": {\"value\": \"other\", \"price\": 100.5}}\n+\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/items/\": {\n+                    \"post\": {\n+                        \"summary\": \"Save Union Body Discriminator\",\n+                        \"operationId\": \"save_union_body_discriminator_items__post\",\n+                        \"parameters\": [\n+                            {\n+                                \"name\": \"q\",\n+                                \"in\": \"query\",\n+                                \"required\": True,\n+                                \"schema\": {\n+                                    \"type\": \"string\",\n+                                    \"description\": \"Query string\",\n+                                    \"title\": \"Q\",\n+                                },\n+                            }\n+                        ],\n+                        \"requestBody\": {\n+                            \"required\": True,\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"oneOf\": [\n+                                            {\"$ref\": \"#/components/schemas/FirstItem\"},\n+                                            {\"$ref\": \"#/components/schemas/OtherItem\"},\n+                                        ],\n+                \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 479}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -590,6 +590,9 @@ def field_annotation_is_complex(annotation: Union[Type[Any], None]) -> bool:\n     if origin is Union or origin is UnionType:\n         return any(field_annotation_is_complex(arg) for arg in get_args(annotation))\n \n+    if origin is Annotated:\n+        return field_annotation_is_complex(get_args(annotation)[0])\n+\n     return (\n         _annotation_is_complex(annotation)\n         or _annotation_is_complex(origin)\n\n```\n\n```diff\n@@ -0,0 +1,188 @@\n+from typing import Any, Dict, Union\n+\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel, Field\n+from typing_extensions import Annotated, Literal\n+\n+from .utils import needs_pydanticv2\n+\n+\n+@needs_pydanticv2\n+def test_discriminator_pydantic_v2() -> None:\n+    from pydantic import Tag\n+\n+    app = FastAPI()\n+\n+    class FirstItem(BaseModel):\n+        value: Literal[\"first\"]\n+        price: int\n+\n+    class OtherItem(BaseModel):\n+        value: Literal[\"other\"]\n+        price: float\n+\n+    Item = Annotated[\n+        Union[Annotated[FirstItem, Tag(\"first\")], Annotated[OtherItem, Tag(\"other\")]],\n+        Field(discriminator=\"value\"),\n+    ]\n+\n+    @app.post(\"/items/\")\n+    def save_union_body_discriminator(\n+        item: Item, q: Annotated[str, Field(description=\"Query string\")]\n+    ) -> Dict[str, Any]:\n+        return {\"item\": item}\n+\n+    client = TestClient(app)\n+    response = client.post(\"/items/?q=first\", json={\"value\": \"first\", \"price\": 100})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"item\": {\"value\": \"first\", \"price\": 100}}\n+\n+    response = client.post(\"/items/?q=other\", json={\"value\": \"other\", \"price\": 100.5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"item\": {\"value\": \"other\", \"price\": 100.5}}\n+\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/items/\": {\n+                    \"post\": {\n+                        \"summary\": \"Save Union Body Discriminator\",\n+                        \"operationId\": \"save_union_body_discriminator_items__post\",\n+                        \"parameters\": [\n+                            {\n+                                \"name\": \"q\",\n+                                \"in\": \"query\",\n+                                \"required\": True,\n+                                \"schema\": {\n+                                    \"type\": \"string\",\n+                                    \"description\": \"Query string\",\n+                                    \"title\": \"Q\",\n+                                },\n+                            }\n+                        ],\n+                        \"requestBody\": {\n+                            \"required\": True,\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"oneOf\": [\n+                                            {\"$ref\": \"#/components/schemas/FirstItem\"},\n+                                            {\"$ref\": \"#/components/schemas/OtherItem\"},\n+                                        ],\n+                \n\n```", "output": "Bug: üêõ Fix tagged discriminated union not recognized as body field\n\n## Problem\r\n\r\nWhen using a union type models with a tagged discriminator as an endpoint parameter, like the following:\r\n\r\n```py\r\nclass Pie(BaseModel):\r\n    time_to_cook: int\r\n    num_ingredients: int\r\n\r\n\r\nclass ApplePie(Pie):\r\n    fruit: Literal[\"apple\"] = \"apple\"\r\n\r\n\r\nclass PumpkinPie(Pie):\r\n    filling: Literal[\"pumpkin\"] = \"pumpkin\"\r\n\r\n\r\ndef get_discriminator_value(v: Any) -> str:\r\n    if isinstance(v, dict):\r\n        return v.get(\"fruit\", v.get(\"filling\"))\r\n    return getattr(v, \"fruit\", getattr(v, \"filling\", None))\r\n\r\n\r\nDessert = Annotated[\r\n    Annotated[ApplePie, Tag(\"apple\")] | Annotated[PumpkinPie, Tag(\"pumpkin\")],\r\n    Discriminator(get_discriminator_value),\r\n]\r\n\r\n\r\napp = FastAPI()\r\n@app.post(\"/dessert\")\r\nasync def dinner(dessert: Dessert) -> dict[str, Any]:\r\n    return dessert.model_dump()\r\n```\r\n\r\nFastAPI fails to identify it correctly as **body** payload. It incorrectly considers it's a query parameter, which then causes a validation error. The workaround currently is to explicitly tell FastAPI it's a body parameter using `dessert: Annotated[Dessert, Body()]`\r\n\r\n## Fix\r\n\r\nThe solution is to improve the function handling type annotations by handling the case where we can have `Annotated`\r\n types inside an `Annotated` type.\r\n\r\n---\r\n\r\nDiscussed in https://github.com/fastapi/fastapi/discussions/12941", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 479}
{"instruction": "Review the following code changes: üêõ Fix tagged discriminated union not recognized as body field", "input": "```diff\n@@ -590,6 +590,9 @@ def field_annotation_is_complex(annotation: Union[Type[Any], None]) -> bool:\n     if origin is Union or origin is UnionType:\n         return any(field_annotation_is_complex(arg) for arg in get_args(annotation))\n \n+    if origin is Annotated:\n+        return field_annotation_is_complex(get_args(annotation)[0])\n+\n     return (\n         _annotation_is_complex(annotation)\n         or _annotation_is_complex(origin)\n\n```\n\n```diff\n@@ -0,0 +1,188 @@\n+from typing import Any, Dict, Union\n+\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import BaseModel, Field\n+from typing_extensions import Annotated, Literal\n+\n+from .utils import needs_pydanticv2\n+\n+\n+@needs_pydanticv2\n+def test_discriminator_pydantic_v2() -> None:\n+    from pydantic import Tag\n+\n+    app = FastAPI()\n+\n+    class FirstItem(BaseModel):\n+        value: Literal[\"first\"]\n+        price: int\n+\n+    class OtherItem(BaseModel):\n+        value: Literal[\"other\"]\n+        price: float\n+\n+    Item = Annotated[\n+        Union[Annotated[FirstItem, Tag(\"first\")], Annotated[OtherItem, Tag(\"other\")]],\n+        Field(discriminator=\"value\"),\n+    ]\n+\n+    @app.post(\"/items/\")\n+    def save_union_body_discriminator(\n+        item: Item, q: Annotated[str, Field(description=\"Query string\")]\n+    ) -> Dict[str, Any]:\n+        return {\"item\": item}\n+\n+    client = TestClient(app)\n+    response = client.post(\"/items/?q=first\", json={\"value\": \"first\", \"price\": 100})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"item\": {\"value\": \"first\", \"price\": 100}}\n+\n+    response = client.post(\"/items/?q=other\", json={\"value\": \"other\", \"price\": 100.5})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"item\": {\"value\": \"other\", \"price\": 100.5}}\n+\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/items/\": {\n+                    \"post\": {\n+                        \"summary\": \"Save Union Body Discriminator\",\n+                        \"operationId\": \"save_union_body_discriminator_items__post\",\n+                        \"parameters\": [\n+                            {\n+                                \"name\": \"q\",\n+                                \"in\": \"query\",\n+                                \"required\": True,\n+                                \"schema\": {\n+                                    \"type\": \"string\",\n+                                    \"description\": \"Query string\",\n+                                    \"title\": \"Q\",\n+                                },\n+                            }\n+                        ],\n+                        \"requestBody\": {\n+                            \"required\": True,\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"oneOf\": [\n+                                            {\"$ref\": \"#/components/schemas/FirstItem\"},\n+                                            {\"$ref\": \"#/components/schemas/OtherItem\"},\n+                                        ],\n+                \n\n```", "output": "Changes look good. This PR implements: üêõ Fix tagged discriminated union not recognized as body field", "source": "pr", "type": "code_review", "pr_number": 479}
{"instruction": "Review the following code changes: üìù Specify language code for code block", "input": "```diff\n@@ -56,7 +56,7 @@ from app.routers import items\n \n The same file structure with comments:\n \n-\n```", "output": "Changes look good. This PR implements: üìù Specify language code for code block", "source": "pr", "type": "code_review", "pr_number": 478}
{"instruction": "Fix the following bug: üî® Add LLM translations tool fixer", "input": "This PR adds script that can be used to automatically check and fix some errors in translated pages.\r\n\r\nI added some tests to prevent breaking something in the future. They are currently placed in `scripts/tests` and are not run in CI with other tests. I don't know if we need to move them to `tests/` or keep as it is and run manually when we need to modify this script", "output": "```diff\n@@ -0,0 +1,729 @@\n+import re\n+from typing import TypedDict\n+\n+CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n+CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n+\n+HEADER_WITH_PERMALINK_RE = re.compile(r\"^(#{1,6}) (.+?)(\\s*\\{\\s*#.*\\s*\\})?\\s*$\")\n+HEADER_LINE_RE = re.compile(r\"^(#{1,6}) (.+?)(?:\\s*\\{\\s*(#.*)\\s*\\})?\\s*$\")\n+\n+TIANGOLO_COM = \"https://fastapi.tiangolo.com\"\n+ASSETS_URL_PREFIXES = (\"/img/\", \"/css/\", \"/js/\")\n+\n+MARKDOWN_LINK_RE = re.compile(\n+    r\"(?<!\\\\)(?<!\\!)\"  # not an image ![...] and not escaped \\[...]\n+    r\"\\[(?P<text>.*?)\\]\"  # link text (non-greedy)\n+    r\"\\(\"\n+    r\"(?P<url>[^)\\s]+)\"  # url (no spaces and `)`)\n+    r'(?:\\s+[\"\\'](?P<title>.*?)[\"\\'])?'  # optional title in \"\" or ''\n+    r\"\\)\"\n+    r\"(?:\\s*\\{(?P<attrs>[^}]*)\\})?\"  # optional attributes in {}\n+)\n+\n+HTML_LINK_RE = re.compile(r\"<a\\s+[^>]*>.*?</a>\")\n+HTML_LINK_TEXT_RE = re.compile(r\"<a\\b([^>]*)>(.*?)</a>\")\n+HTML_LINK_OPEN_TAG_RE = re.compile(r\"<a\\b([^>]*)>\")\n+HTML_ATTR_RE = re.compile(r'(\\w+)\\s*=\\s*([\\'\"])(.*?)\\2')\n+\n+CODE_BLOCK_LANG_RE = re.compile(r\"^`{3,4}([\\w-]*)\", re.MULTILINE)\n+\n+SLASHES_COMMENT_RE = re.compile(\n+    r\"^(?P<code>.*?)(?P<comment>(?:(?<= )// .*)|(?:^// .*))?$\"\n+)\n+\n+HASH_COMMENT_RE = re.compile(r\"^(?P<code>.*?)(?P<comment>(?:(?<= )# .*)|(?:^# .*))?$\")\n+\n+\n+class CodeIncludeInfo(TypedDict):\n+    line_no: int\n+    line: str\n+\n+\n+class HeaderPermalinkInfo(TypedDict):\n+    line_no: int\n+    hashes: str\n+    title: str\n+    permalink: str\n+\n+\n+class MarkdownLinkInfo(TypedDict):\n+    line_no: int\n+    url: str\n+    text: str\n+    title: str | None\n+    attributes: str | None\n+    full_match: str\n+\n+\n+class HTMLLinkAttribute(TypedDict):\n+    name: str\n+    quote: str\n+    value: str\n+\n+\n+class HtmlLinkInfo(TypedDict):\n+    line_no: int\n+    full_tag: str\n+    attributes: list[HTMLLinkAttribute]\n+    text: str\n+\n+\n+class MultilineCodeBlockInfo(TypedDict):\n+    lang: str\n+    start_line_no: int\n+    content: list[str]\n+\n+\n+# Code includes\n+# --------------------------------------------------------------------------------------\n+\n+\n+def extract_code_includes(lines: list[str]) -> list[CodeIncludeInfo]:\n+    \"\"\"\n+    Extract lines that contain code includes.\n+\n+    Return list of CodeIncludeInfo, where each dict contains:\n+    - `line_no` - line number (1-based)\n+    - `line` - text of the line\n+    \"\"\"\n+\n+    includes: list[CodeIncludeInfo] = []\n+    for line_no, line in enumerate(lines, start=1):\n+        if CODE_INCLUDE_RE.match(line):\n+            includes.append(CodeIncludeInfo(line_no=line_no, line=line))\n+    return includes\n+\n+\n+def replace_code_includes_with_placeholders(text: list[str]) -> list[str]:\n+    \"\"\"\n+    Replace code includes with placeholders.\n+    \"\"\"\n+\n+    modified_text = text.copy()\n+    includes = extract_code_includes(text)\n+    for include in includes:\n+        modified_text[include[\"line_no\"] - 1] = CODE_INCLUDE_PLACEHOLDER\n+    return modified_text\n+\n+\n+def replace_placeholders_with_code_includes(\n+    text: list[str], orig\n\n```\n\n```diff\n@@ -0,0 +1,32 @@\n+import shutil\n+from pathlib import Path\n+\n+import pytest\n+from typer.testing import CliRunner\n+\n+\n+@pytest.fixture(name=\"runner\")\n+def get_runner():\n+    runner = CliRunner()\n+    with runner.isolated_filesystem():\n+        yield runner\n+\n+\n+@pytest.fixture(name=\"root_dir\")\n+def prepare_paths(runner):\n+    docs_dir = Path(\"docs\")\n+    en_docs_dir = docs_dir / \"en\" / \"docs\"\n+    lang_docs_dir = docs_dir / \"lang\" / \"docs\"\n+    en_docs_dir.mkdir(parents=True, exist_ok=True)\n+    lang_docs_dir.mkdir(parents=True, exist_ok=True)\n+    yield Path.cwd()\n+\n+\n+@pytest.fixture\n+def copy_test_files(root_dir: Path, request: pytest.FixtureRequest):\n+    en_file_path = Path(request.param[0])\n+    translation_file_path = Path(request.param[1])\n+    shutil.copy(str(en_file_path), str(root_dir / \"docs\" / \"en\" / \"docs\" / \"doc.md\"))\n+    shutil.copy(\n+        str(translation_file_path), str(root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\")\n+    )\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 477}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -0,0 +1,729 @@\n+import re\n+from typing import TypedDict\n+\n+CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n+CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n+\n+HEADER_WITH_PERMALINK_RE = re.compile(r\"^(#{1,6}) (.+?)(\\s*\\{\\s*#.*\\s*\\})?\\s*$\")\n+HEADER_LINE_RE = re.compile(r\"^(#{1,6}) (.+?)(?:\\s*\\{\\s*(#.*)\\s*\\})?\\s*$\")\n+\n+TIANGOLO_COM = \"https://fastapi.tiangolo.com\"\n+ASSETS_URL_PREFIXES = (\"/img/\", \"/css/\", \"/js/\")\n+\n+MARKDOWN_LINK_RE = re.compile(\n+    r\"(?<!\\\\)(?<!\\!)\"  # not an image ![...] and not escaped \\[...]\n+    r\"\\[(?P<text>.*?)\\]\"  # link text (non-greedy)\n+    r\"\\(\"\n+    r\"(?P<url>[^)\\s]+)\"  # url (no spaces and `)`)\n+    r'(?:\\s+[\"\\'](?P<title>.*?)[\"\\'])?'  # optional title in \"\" or ''\n+    r\"\\)\"\n+    r\"(?:\\s*\\{(?P<attrs>[^}]*)\\})?\"  # optional attributes in {}\n+)\n+\n+HTML_LINK_RE = re.compile(r\"<a\\s+[^>]*>.*?</a>\")\n+HTML_LINK_TEXT_RE = re.compile(r\"<a\\b([^>]*)>(.*?)</a>\")\n+HTML_LINK_OPEN_TAG_RE = re.compile(r\"<a\\b([^>]*)>\")\n+HTML_ATTR_RE = re.compile(r'(\\w+)\\s*=\\s*([\\'\"])(.*?)\\2')\n+\n+CODE_BLOCK_LANG_RE = re.compile(r\"^`{3,4}([\\w-]*)\", re.MULTILINE)\n+\n+SLASHES_COMMENT_RE = re.compile(\n+    r\"^(?P<code>.*?)(?P<comment>(?:(?<= )// .*)|(?:^// .*))?$\"\n+)\n+\n+HASH_COMMENT_RE = re.compile(r\"^(?P<code>.*?)(?P<comment>(?:(?<= )# .*)|(?:^# .*))?$\")\n+\n+\n+class CodeIncludeInfo(TypedDict):\n+    line_no: int\n+    line: str\n+\n+\n+class HeaderPermalinkInfo(TypedDict):\n+    line_no: int\n+    hashes: str\n+    title: str\n+    permalink: str\n+\n+\n+class MarkdownLinkInfo(TypedDict):\n+    line_no: int\n+    url: str\n+    text: str\n+    title: str | None\n+    attributes: str | None\n+    full_match: str\n+\n+\n+class HTMLLinkAttribute(TypedDict):\n+    name: str\n+    quote: str\n+    value: str\n+\n+\n+class HtmlLinkInfo(TypedDict):\n+    line_no: int\n+    full_tag: str\n+    attributes: list[HTMLLinkAttribute]\n+    text: str\n+\n+\n+class MultilineCodeBlockInfo(TypedDict):\n+    lang: str\n+    start_line_no: int\n+    content: list[str]\n+\n+\n+# Code includes\n+# --------------------------------------------------------------------------------------\n+\n+\n+def extract_code_includes(lines: list[str]) -> list[CodeIncludeInfo]:\n+    \"\"\"\n+    Extract lines that contain code includes.\n+\n+    Return list of CodeIncludeInfo, where each dict contains:\n+    - `line_no` - line number (1-based)\n+    - `line` - text of the line\n+    \"\"\"\n+\n+    includes: list[CodeIncludeInfo] = []\n+    for line_no, line in enumerate(lines, start=1):\n+        if CODE_INCLUDE_RE.match(line):\n+            includes.append(CodeIncludeInfo(line_no=line_no, line=line))\n+    return includes\n+\n+\n+def replace_code_includes_with_placeholders(text: list[str]) -> list[str]:\n+    \"\"\"\n+    Replace code includes with placeholders.\n+    \"\"\"\n+\n+    modified_text = text.copy()\n+    includes = extract_code_includes(text)\n+    for include in includes:\n+        modified_text[include[\"line_no\"] - 1] = CODE_INCLUDE_PLACEHOLDER\n+    return modified_text\n+\n+\n+def replace_placeholders_with_code_includes(\n+    text: list[str], orig\n\n```\n\n```diff\n@@ -0,0 +1,32 @@\n+import shutil\n+from pathlib import Path\n+\n+import pytest\n+from typer.testing import CliRunner\n+\n+\n+@pytest.fixture(name=\"runner\")\n+def get_runner():\n+    runner = CliRunner()\n+    with runner.isolated_filesystem():\n+        yield runner\n+\n+\n+@pytest.fixture(name=\"root_dir\")\n+def prepare_paths(runner):\n+    docs_dir = Path(\"docs\")\n+    en_docs_dir = docs_dir / \"en\" / \"docs\"\n+    lang_docs_dir = docs_dir / \"lang\" / \"docs\"\n+    en_docs_dir.mkdir(parents=True, exist_ok=True)\n+    lang_docs_dir.mkdir(parents=True, exist_ok=True)\n+    yield Path.cwd()\n+\n+\n+@pytest.fixture\n+def copy_test_files(root_dir: Path, request: pytest.FixtureRequest):\n+    en_file_path = Path(request.param[0])\n+    translation_file_path = Path(request.param[1])\n+    shutil.copy(str(en_file_path), str(root_dir / \"docs\" / \"en\" / \"docs\" / \"doc.md\"))\n+    shutil.copy(\n+        str(translation_file_path), str(root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\")\n+    )\n\n```\n\n```diff\n@@ -0,", "output": "Bug: üî® Add LLM translations tool fixer\n\nThis PR adds script that can be used to automatically check and fix some errors in translated pages.\r\n\r\nI added some tests to prevent breaking something in the future. They are currently placed in `scripts/tests` and are not run in CI with other tests. I don't know if we need to move them to `tests/` or keep as it is and run manually when we need to modify this script", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 477}
{"instruction": "Review the following code changes: üî® Add LLM translations tool fixer", "input": "```diff\n@@ -0,0 +1,729 @@\n+import re\n+from typing import TypedDict\n+\n+CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n+CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n+\n+HEADER_WITH_PERMALINK_RE = re.compile(r\"^(#{1,6}) (.+?)(\\s*\\{\\s*#.*\\s*\\})?\\s*$\")\n+HEADER_LINE_RE = re.compile(r\"^(#{1,6}) (.+?)(?:\\s*\\{\\s*(#.*)\\s*\\})?\\s*$\")\n+\n+TIANGOLO_COM = \"https://fastapi.tiangolo.com\"\n+ASSETS_URL_PREFIXES = (\"/img/\", \"/css/\", \"/js/\")\n+\n+MARKDOWN_LINK_RE = re.compile(\n+    r\"(?<!\\\\)(?<!\\!)\"  # not an image ![...] and not escaped \\[...]\n+    r\"\\[(?P<text>.*?)\\]\"  # link text (non-greedy)\n+    r\"\\(\"\n+    r\"(?P<url>[^)\\s]+)\"  # url (no spaces and `)`)\n+    r'(?:\\s+[\"\\'](?P<title>.*?)[\"\\'])?'  # optional title in \"\" or ''\n+    r\"\\)\"\n+    r\"(?:\\s*\\{(?P<attrs>[^}]*)\\})?\"  # optional attributes in {}\n+)\n+\n+HTML_LINK_RE = re.compile(r\"<a\\s+[^>]*>.*?</a>\")\n+HTML_LINK_TEXT_RE = re.compile(r\"<a\\b([^>]*)>(.*?)</a>\")\n+HTML_LINK_OPEN_TAG_RE = re.compile(r\"<a\\b([^>]*)>\")\n+HTML_ATTR_RE = re.compile(r'(\\w+)\\s*=\\s*([\\'\"])(.*?)\\2')\n+\n+CODE_BLOCK_LANG_RE = re.compile(r\"^`{3,4}([\\w-]*)\", re.MULTILINE)\n+\n+SLASHES_COMMENT_RE = re.compile(\n+    r\"^(?P<code>.*?)(?P<comment>(?:(?<= )// .*)|(?:^// .*))?$\"\n+)\n+\n+HASH_COMMENT_RE = re.compile(r\"^(?P<code>.*?)(?P<comment>(?:(?<= )# .*)|(?:^# .*))?$\")\n+\n+\n+class CodeIncludeInfo(TypedDict):\n+    line_no: int\n+    line: str\n+\n+\n+class HeaderPermalinkInfo(TypedDict):\n+    line_no: int\n+    hashes: str\n+    title: str\n+    permalink: str\n+\n+\n+class MarkdownLinkInfo(TypedDict):\n+    line_no: int\n+    url: str\n+    text: str\n+    title: str | None\n+    attributes: str | None\n+    full_match: str\n+\n+\n+class HTMLLinkAttribute(TypedDict):\n+    name: str\n+    quote: str\n+    value: str\n+\n+\n+class HtmlLinkInfo(TypedDict):\n+    line_no: int\n+    full_tag: str\n+    attributes: list[HTMLLinkAttribute]\n+    text: str\n+\n+\n+class MultilineCodeBlockInfo(TypedDict):\n+    lang: str\n+    start_line_no: int\n+    content: list[str]\n+\n+\n+# Code includes\n+# --------------------------------------------------------------------------------------\n+\n+\n+def extract_code_includes(lines: list[str]) -> list[CodeIncludeInfo]:\n+    \"\"\"\n+    Extract lines that contain code includes.\n+\n+    Return list of CodeIncludeInfo, where each dict contains:\n+    - `line_no` - line number (1-based)\n+    - `line` - text of the line\n+    \"\"\"\n+\n+    includes: list[CodeIncludeInfo] = []\n+    for line_no, line in enumerate(lines, start=1):\n+        if CODE_INCLUDE_RE.match(line):\n+            includes.append(CodeIncludeInfo(line_no=line_no, line=line))\n+    return includes\n+\n+\n+def replace_code_includes_with_placeholders(text: list[str]) -> list[str]:\n+    \"\"\"\n+    Replace code includes with placeholders.\n+    \"\"\"\n+\n+    modified_text = text.copy()\n+    includes = extract_code_includes(text)\n+    for include in includes:\n+        modified_text[include[\"line_no\"] - 1] = CODE_INCLUDE_PLACEHOLDER\n+    return modified_text\n+\n+\n+def replace_placeholders_with_code_includes(\n+    text: list[str], orig\n\n```\n\n```diff\n@@ -0,0 +1,32 @@\n+import shutil\n+from pathlib import Path\n+\n+import pytest\n+from typer.testing import CliRunner\n+\n+\n+@pytest.fixture(name=\"runner\")\n+def get_runner():\n+    runner = CliRunner()\n+    with runner.isolated_filesystem():\n+        yield runner\n+\n+\n+@pytest.fixture(name=\"root_dir\")\n+def prepare_paths(runner):\n+    docs_dir = Path(\"docs\")\n+    en_docs_dir = docs_dir / \"en\" / \"docs\"\n+    lang_docs_dir = docs_dir / \"lang\" / \"docs\"\n+    en_docs_dir.mkdir(parents=True, exist_ok=True)\n+    lang_docs_dir.mkdir(parents=True, exist_ok=True)\n+    yield Path.cwd()\n+\n+\n+@pytest.fixture\n+def copy_test_files(root_dir: Path, request: pytest.FixtureRequest):\n+    en_file_path = Path(request.param[0])\n+    translation_file_path = Path(request.param[1])\n+    shutil.copy(str(en_file_path), str(root_dir / \"docs\" / \"en\" / \"docs\" / \"doc.md\"))\n+    shutil.copy(\n+        str(translation_file_path), str(root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\")\n+    )\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```", "output": "Changes look good. This PR implements: üî® Add LLM translations tool fixer", "source": "pr", "type": "code_review", "pr_number": 477}
{"instruction": "Review the following code changes: ‚ú® Add Django middleware", "input": "```diff\n@@ -0,0 +1,82 @@\n+from contextvars import ContextVar\n+from typing import Annotated\n+\n+from django.core.asgi import ASGIHandler\n+from django.http import HttpRequest, HttpResponse, StreamingHttpResponse\n+from fastapi import Depends, Request, Response\n+from fastapi.responses import StreamingResponse\n+from starlette.middleware.base import BaseHTTPMiddleware\n+\n+_django_request = ContextVar[HttpRequest | None](\"fastapi_django_request\", default=None)\n+\n+\n+def get_django_request():\n+    django_request = _django_request.get()\n+\n+    if not django_request:\n+        raise ValueError(\n+            \"Django Request not found, did you forget to add the Django Middleware?\"\n+        )\n+\n+    return django_request\n+\n+\n+DjangoRequestDep = Annotated[HttpRequest, Depends(get_django_request)]\n+\n+\n+class DjangoMiddleware(BaseHTTPMiddleware, ASGIHandler):\n+    \"\"\"A FastAPI Middleware that runs the Django HTTP Request lifecycle.\n+\n+    This middleware is responsible for running the Django HTTP Request lifecycle\n+    in the FastAPI application. It is useful when you want to use Django's\n+    authentication system, or any other Django feature that requires the\n+    Django Request object to be available.\"\"\"\n+\n+    def __init__(self, *args, **kwargs):\n+        ASGIHandler.__init__(self)\n+\n+        super().__init__(*args, **kwargs)\n+\n+    async def _get_response_async(self, request):\n+        fastapi_response = await self._call_next(request)\n+\n+        assert isinstance(fastapi_response, StreamingResponse)\n+\n+        return StreamingHttpResponse(\n+            streaming_content=fastapi_response.body_iterator,\n+            headers=fastapi_response.headers,\n+            status=fastapi_response.status_code,\n+        )\n+\n+    async def __call__(self, scope, receive, send):\n+        self._django_request, _ = self.create_request(scope, \"\")\n+\n+        _django_request.set(self._django_request)\n+\n+        await BaseHTTPMiddleware.__call__(self, scope, receive, send)\n+\n+    async def dispatch(self, request: Request, call_next):\n+        self._call_next = call_next\n+\n+        django_response = await self.get_response_async(self._django_request)\n+\n+        if isinstance(django_response, HttpResponse):\n+            return Response(\n+                status_code=django_response.status_code,\n+                content=django_response.content,\n+                headers=django_response.headers,\n+            )\n+\n+        if isinstance(django_response, StreamingHttpResponse):\n+\n+            async def streaming():\n+                async for chunk in django_response.streaming_content:\n+                    yield chunk\n+\n+            return StreamingResponse(\n+                status_code=django_response.status_code,\n+                content=streaming(),\n+                headers=django_response.headers,\n+            )\n+\n+        return Response(status_code=500)\n\n```\n\n```diff\n@@ -18,3 +18,6 @@ passlib[bcrypt] >=1.7.2,<2.0.0\n # types\n types-ujson ==5.7.0.1\n types-orjson ==3.6.2\n+\n+# django\n+django ==5.0.6\n\n```\n\n```diff\n@@ -0,0 +1,55 @@\n+import django\n+import pytest\n+from django.conf import settings\n+from django.core.management.color import no_style\n+from django.core.management.sql import sql_flush\n+from django.db import connection\n+\n+settings.configure(\n+    SECRET_KEY=\"not_very\",\n+    ROOT_URLCONF=\"tests.django.proj.urls\",\n+    INSTALLED_APPS=[\n+        \"django.contrib.auth\",\n+        \"django.contrib.contenttypes\",\n+        \"django.contrib.sessions\",\n+    ],\n+    MIDDLEWARE=[\n+        \"django.contrib.sessions.middleware.SessionMiddleware\",\n+        \"django.contrib.auth.middleware.AuthenticationMiddleware\",\n+    ],\n+    DATABASES={\n+        \"default\": {\n+            \"ENGINE\": \"django.db.backends.sqlite3\",\n+            \"NAME\": \":memory:\",\n+        }\n+    },\n+)\n+\n+django.setup()\n+\n+\n+@pytest.fixture(scope=\"session\", autouse=True)\n+def django_db_setup():\n+    connection.creation.create_test_db(verbosity=0, autoclobber=True)\n+\n+    yield\n+\n+    connection.creation.destroy_test_db(\"default\", verbosity=0)\n+\n+\n+@pytest.fixture(autouse=True)\n+def flush_db():\n+    sql_list = sql_flush(no_style(), connection, allow_cascade=False)\n+\n+    connection.ops.execute_sql_flush(sql_list)\n+\n+\n+@pytest.fixture\n+def authenticated_session_id():\n+    from django.contrib.auth.models import User\n+\n+    from tests.django.utils import create_authenticated_session\n+\n+    user = User.objects.create_user(username=\"test\", password=\"test\")\n+\n+    return create_authenticated_session(user)\n\n```\n\n```diff\n@@ -0,0 +1 @@\n+urlpatterns = []\n\n```\n\n```diff\n@@ -0,0 +1,51 @@\n+from django.contrib.auth import aget_user\n+from fastapi import FastAPI\n+from fastapi.django import DjangoMiddleware, DjangoRequestDep\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+app.add_middleware(DjangoMiddleware)\n+\n+\n+@app.get(\"/\")\n+async def root():\n+    return {\"message\": \"Hello World\"}\n+\n+\n+@app.get(\"/current-user\")\n+async def django_user(django_request: DjangoRequestDep):\n+    user = await aget_user(django_", "output": "Code Review for: ‚ú® Add Django middleware\n\nüìù **tests/django/conftest.py**: Same as https://github.com/tiangolo/fastapi/pull/11782\n\nüìù **tests/django/conftest.py**: Django needs settings to be configured, this is the simplest way to configure django (we also add the required apps to get auth and sessions working)\n\nüìù **tests/django/conftest.py**: this creates an authenticated session, so we can test if the user is logged in or not.\r\n\r\nThe reason why the import is here is mostly because we need Django to be configured before importing any model üòä\n\nüìù **tests/django/test_django_request_no_middleware.py**: I wanted to give a hint if the user forgot to add the middleware, not sure if this is the best way though üòä\n\nüìù **fastapi/django/__init__.py**: Some of this code can be abstracted, I'll do so in future üòä\n\n", "source": "pr", "type": "code_review", "pr_number": 475}
{"instruction": "Review this code change in `tests/django/conftest.py`", "input": "```diff\n@@ -0,0 +1,55 @@\n+import django\n+import pytest\n+from django.conf import settings\n+from django.core.management.color import no_style\n+from django.core.management.sql import sql_flush\n+from django.db import connection\n+\n+settings.configure(\n+    SECRET_KEY=\"not_very\",\n+    ROOT_URLCONF=\"tests.django.proj.urls\",\n+    INSTALLED_APPS=[\n+        \"django.contrib.auth\",\n+        \"django.contrib.contenttypes\",\n+        \"django.contrib.sessions\",\n+    ],\n+    MIDDLEWARE=[\n+        \"django.contrib.sessions.middleware.SessionMiddleware\",\n+        \"django.contrib.auth.middleware.AuthenticationMiddleware\",\n+    ],\n+    DATABASES={\n+        \"default\": {\n+            \"ENGINE\": \"django.db.backends.sqlite3\",\n+            \"NAME\": \":memory:\",\n+        }\n+    },\n+)\n+\n+django.setup()\n+\n+\n+@pytest.fixture(scope=\"session\", autouse=True)\n+def django_db_setup():\n+    connection.creation.create_test_db(verbosity=0, autoclobber=True)\n+\n+    yield\n+\n+    connection.creation.destroy_test_db(\"default\", verbosity=0)\n+\n+\n+@pytest.fixture(autouse=True)\n+def flush_db():\n+    sql_list = sql_flush(no_style(), connection, allow_cascade=False)\n+\n+    connection.ops.execute_sql_flush(sql_list)\n\n```", "output": "Same as https://github.com/tiangolo/fastapi/pull/11782", "source": "pr_review", "type": "inline_review", "pr_number": 475}
{"instruction": "Review this code change in `tests/django/test_django_request_no_middleware.py`", "input": "```diff\n@@ -0,0 +1,24 @@\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.django import DjangoRequestDep\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+async def django_user(django_request: DjangoRequestDep):\n+    user = django_request.user\n+\n+    if not user.is_authenticated:\n+        return {\"error\": \"User not authenticated\"}\n+\n+    return {\"username\": user.username}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_returns_an_error():\n+    with pytest.raises(ValueError, match=\"Django Request not found\"):\n+        client.get(\"/\")\n\n```", "output": "I wanted to give a hint if the user forgot to add the middleware, not sure if this is the best way though üòä", "source": "pr_review", "type": "inline_review", "pr_number": 475}
{"instruction": "Review this code change in `fastapi/django/__init__.py`", "input": "```diff\n@@ -0,0 +1,82 @@\n+from contextvars import ContextVar\n+from typing import Annotated\n+\n+from django.core.asgi import ASGIHandler\n+from django.http import HttpRequest, HttpResponse, StreamingHttpResponse\n+from fastapi import Depends, Request, Response\n+from fastapi.responses import StreamingResponse\n+from starlette.middleware.base import BaseHTTPMiddleware\n+\n+_django_request = ContextVar[HttpRequest | None](\"fastapi_django_request\", default=None)\n+\n+\n+def get_django_request():\n+    django_request = _django_request.get()\n+\n+    if not django_request:\n+        raise ValueError(\n+            \"Django Request not found, did you forget to add the Django Middleware?\"\n+        )\n+\n+    return django_request\n+\n+\n+DjangoRequestDep = Annotated[HttpRequest, Depends(get_django_request)]\n+\n+\n+class DjangoMiddleware(BaseHTTPMiddleware, ASGIHandler):\n+    \"\"\"A FastAPI Middleware that runs the Django HTTP Request lifecycle.\n+\n+    This middleware is responsible for running the Django HTTP Request lifecycle\n+    in the FastAPI application. It is useful when you want to use Django's\n+    authentication system, or any other Django feature that requires the\n+    Django Request object to be available.\"\"\"\n+\n+    def __init__(self, *args, **kwargs):\n+        ASGIHandler.__init__(self)\n+\n+        super().__init__(*args, **kwargs)\n+\n+    async def _get_response_async(self, request):\n+        fastapi_response = await self._call_next(request)\n+\n+        assert isinstance(fastapi_response, StreamingResponse)\n+\n+        return StreamingHttpResponse(\n+            streaming_content=fastapi_response.body_iterator,\n+            headers=fastapi_response.headers,\n+            status=fastapi_response.status_code,\n+        )\n+\n+    async def __call__(self, scope, receive, send):\n+        self._django_request, _ = self.create_request(scope, \"\")\n+\n+        _django_request.set(self._django_request)\n+\n+        await BaseHTTPMiddleware.__call__(self, scope, receive, send)\n+\n+    async def dispatch(self, request: Request, call_next):\n+        self._call_next = call_next\n+\n+        django_response = await self.get_response_async(self._django_request)\n+\n+        if isinstance(django_response, HttpResponse):\n+            return Response(\n+                status_code=django_response.status_code,\n+                content=django_response.content,\n+                headers=django_response.headers,\n+            )\n+\n+        if isinstance(django_response, StreamingHttpResponse):\n+\n+            async def streaming():\n+                async for chunk in django_response.streaming_content:\n+                    yield chunk\n+\n+            return StreamingResponse(\n+                status_code=django_response.status_code,\n+                content=streaming(),\n+                headers=django_response.headers,\n+            )\n\n```", "output": "Some of this code can be abstracted, I'll do so in future üòä", "source": "pr_review", "type": "inline_review", "pr_number": 475}
{"instruction": "Fix the following bug: üîß Add pre-commit local script to fix language translations", "input": "üîß Add pre-commit local script to fix language translations", "output": "```diff\n@@ -58,3 +58,9 @@ repos:\n         entry: uv run ./scripts/docs.py ensure-non-translated\n         files: ^docs/(?!en/).*|^scripts/docs\\.py$\n         pass_filenames: false\n+\n+      - id: fix-translations\n+        language: unsupported\n+        name: fix translations\n+        entry: uv run ./scripts/translation_fixer.py fix-pages\n+        files: ^docs/(?!en/).*/docs/.*\\.md$\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 474}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -58,3 +58,9 @@ repos:\n         entry: uv run ./scripts/docs.py ensure-non-translated\n         files: ^docs/(?!en/).*|^scripts/docs\\.py$\n         pass_filenames: false\n+\n+      - id: fix-translations\n+        language: unsupported\n+        name: fix translations\n+        entry: uv run ./scripts/translation_fixer.py fix-pages\n+        files: ^docs/(?!en/).*/docs/.*\\.md$\n\n```", "output": "Bug: üîß Add pre-commit local script to fix language translations\n\nüîß Add pre-commit local script to fix language translations", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 474}
{"instruction": "Review the following code changes: üîß Add pre-commit local script to fix language translations", "input": "```diff\n@@ -58,3 +58,9 @@ repos:\n         entry: uv run ./scripts/docs.py ensure-non-translated\n         files: ^docs/(?!en/).*|^scripts/docs\\.py$\n         pass_filenames: false\n+\n+      - id: fix-translations\n+        language: unsupported\n+        name: fix translations\n+        entry: uv run ./scripts/translation_fixer.py fix-pages\n+        files: ^docs/(?!en/).*/docs/.*\\.md$\n\n```", "output": "Changes look good. This PR implements: üîß Add pre-commit local script to fix language translations", "source": "pr", "type": "code_review", "pr_number": 474}
{"instruction": "Review the following code changes: ‚úÖ Enable tests in CI for scripts", "input": "```diff\n@@ -1,5 +1,5 @@\n import re\n-from typing import TypedDict\n+from typing import TypedDict, Union\n \n CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n@@ -50,8 +50,8 @@ class MarkdownLinkInfo(TypedDict):\n     line_no: int\n     url: str\n     text: str\n-    title: str | None\n-    attributes: str | None\n+    title: Union[str, None]\n+    attributes: Union[str, None]\n     full_match: str\n \n \n@@ -285,7 +285,11 @@ def _add_lang_code_to_url(url: str, lang_code: str) -> str:\n \n \n def _construct_markdown_link(\n-    url: str, text: str, title: str | None, attributes: str | None, lang_code: str\n+    url: str,\n+    text: str,\n+    title: Union[str, None],\n+    attributes: Union[str, None],\n+    lang_code: str,\n ) -> str:\n     \"\"\"\n     Construct a markdown link, adjusting the URL for the given language code if needed.\n@@ -545,7 +549,7 @@ def extract_multiline_code_blocks(text: list[str]) -> list[MultilineCodeBlockInf\n     return blocks\n \n \n-def _split_hash_comment(line: str) -> tuple[str, str | None]:\n+def _split_hash_comment(line: str) -> tuple[str, Union[str, None]]:\n     match = HASH_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -554,7 +558,7 @@ def _split_hash_comment(line: str) -> tuple[str, str | None]:\n     return line.rstrip(), None\n \n \n-def _split_slashes_comment(line: str) -> tuple[str, str | None]:\n+def _split_slashes_comment(line: str) -> tuple[str, Union[str, None]]:\n     match = SLASHES_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -600,8 +604,8 @@ def replace_multiline_code_block(\n \n     code_block: list[str] = []\n     for line_a, line_b in zip(block_a[\"content\"], block_b[\"content\"]):\n-        line_a_comment: str | None = None\n-        line_b_comment: str | None = None\n+        line_a_comment: Union[str, None] = None\n+        line_b_comment: Union[str, None] = None\n \n         # Handle comments based on language\n         if block_language in {\n\n```\n\n```diff\n@@ -239,7 +239,7 @@ def generate_readme() -> None:\n     Generate README.md content from main index.md\n     \"\"\"\n     readme_path = Path(\"README.md\")\n-    old_content = readme_path.read_text()\n+    old_content = readme_path.read_text(\"utf-8\")\n     new_content = generate_readme_content()\n     if new_content != old_content:\n         print(\"README.md outdated from the latest index.md\")\n\n```\n\n```diff\n@@ -316,7 +316,7 @@ def main() -> None:\n         raise RuntimeError(\n             f\"No github event file available at: {settings.github_event_path}\"\n         )\n-    contents = settings.github_event_path.read_text()\n+    contents = settings.github_event_path.read_text(\"utf-8\")\n     github_event = PartialGitHubEvent.model_validate_json(contents)\n     logging.info(f\"Using GitHub event: {github_event}\")\n     number = (\n\n```\n\n```diff\n@@ -4,4 +4,4 @@ set -e\n set -x\n \n export PYTHONPATH=./docs_src\n-coverage run -m pytest tests ${@}\n+coverage run -m pytest tests scripts/tests/ ${@}\n\n```\n\n```diff\n@@ -1,9 +1,19 @@\n import shutil\n+import sys\n from pathlib import Path\n \n import pytest\n from typer.testing import CliRunner\n \n+skip_on_windows = pytest.mark.skipif(\n+    sys.platform == \"win32\", reason=\"Skipping on Windows\"\n+)\n+\n+\n+def pytest_collection_modifyitems(items: list[pytest.Item]) -> None:\n+    for item in items:\n+        item.add_marker(skip_on_windows)\n+\n \n @pytest.fixture(name=\"runner\")\n def get_runner():\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Enable tests in CI for scripts", "source": "pr", "type": "code_review", "pr_number": 473}
{"instruction": "Fix the following bug: üêõ Fix translation script path", "input": "üêõ Fix translation script path", "output": "```diff\n@@ -25,7 +25,7 @@\n     \"contributing.md\",\n )\n \n-general_prompt_path = Path(__file__).absolute().parent / \"llm-general-prompt.md\"\n+general_prompt_path = Path(__file__).absolute().parent / \"general-llm-prompt.md\"\n general_prompt = general_prompt_path.read_text(encoding=\"utf-8\")\n \n app = typer.Typer()\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 472}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -25,7 +25,7 @@\n     \"contributing.md\",\n )\n \n-general_prompt_path = Path(__file__).absolute().parent / \"llm-general-prompt.md\"\n+general_prompt_path = Path(__file__).absolute().parent / \"general-llm-prompt.md\"\n general_prompt = general_prompt_path.read_text(encoding=\"utf-8\")\n \n app = typer.Typer()\n\n```", "output": "Bug: üêõ Fix translation script path\n\nüêõ Fix translation script path", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 472}
{"instruction": "Review the following code changes: üêõ Fix translation script path", "input": "```diff\n@@ -25,7 +25,7 @@\n     \"contributing.md\",\n )\n \n-general_prompt_path = Path(__file__).absolute().parent / \"llm-general-prompt.md\"\n+general_prompt_path = Path(__file__).absolute().parent / \"general-llm-prompt.md\"\n general_prompt = general_prompt_path.read_text(encoding=\"utf-8\")\n \n app = typer.Typer()\n\n```", "output": "Changes look good. This PR implements: üêõ Fix translation script path", "source": "pr", "type": "code_review", "pr_number": 472}
{"instruction": "Review the following code changes: üåê Update translations for es (update-outdated)", "input": "```diff\n@@ -1,17 +1,17 @@\n # Archivo de prueba de LLM { #llm-test-file }\n \n-Este documento prueba si el <abbr title=\"Large Language Model ‚Äì Modelo de lenguaje grande\">LLM</abbr>, que traduce la documentaci√≥n, entiende el `general_prompt` en `scripts/translate.py` y el prompt espec√≠fico del idioma en `docs/{language code}/llm-prompt.md`. El prompt espec√≠fico del idioma se agrega al final de `general_prompt`.\n+Este documento prueba si el <abbr title=\"Large Language Model - Modelo de lenguaje grande\">LLM</abbr>, que traduce la documentaci√≥n, entiende el `general_prompt` en `scripts/translate.py` y el prompt espec√≠fico del idioma en `docs/{language code}/llm-prompt.md`. El prompt espec√≠fico del idioma se agrega al final de `general_prompt`.\n \n Las pruebas a√±adidas aqu√≠ ser√°n vistas por todas las personas que dise√±an prompts espec√≠ficos del idioma.\n \n √ösalo de la siguiente manera:\n \n-* Ten un prompt espec√≠fico del idioma ‚Äì `docs/{language code}/llm-prompt.md`.\n+* Ten un prompt espec√≠fico del idioma - `docs/{language code}/llm-prompt.md`.\n * Haz una traducci√≥n fresca de este documento a tu idioma destino (mira, por ejemplo, el comando `translate-page` de `translate.py`). Esto crear√° la traducci√≥n en `docs/{language code}/docs/_llm-test.md`.\n-* Comprueba si todo est√° bien en la traducci√≥n.\n+* Revisa si las cosas est√°n bien en la traducci√≥n.\n * Si es necesario, mejora tu prompt espec√≠fico del idioma, el prompt general, o el documento en ingl√©s.\n * Luego corrige manualmente los problemas restantes en la traducci√≥n para que sea una buena traducci√≥n.\n-* Vuelve a traducir, teniendo la buena traducci√≥n en su lugar. El resultado ideal ser√≠a que el LLM ya no hiciera cambios a la traducci√≥n. Eso significa que el prompt general y tu prompt espec√≠fico del idioma est√°n tan bien como pueden estar (a veces har√° algunos cambios aparentemente aleatorios; la raz√≥n es que <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">los LLMs no son algoritmos deterministas</a>).\n+* Vuelve a traducir, teniendo la buena traducci√≥n en su lugar. El resultado ideal ser√≠a que el LLM ya no hiciera cambios a la traducci√≥n. Eso significa que el prompt general y tu prompt espec√≠fico del idioma est√°n tan bien como pueden estar (A veces har√° algunos cambios aparentemente aleatorios; la raz√≥n es que <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">los LLMs no son algoritmos deterministas</a>).\n \n Las pruebas:\n \n@@ -23,7 +23,7 @@ Este es un fragmento de c√≥digo: `foo`. Y este es otro fragmento de c√≥digo: `ba\n \n ////\n \n-//// tab | Informaci√≥n\n+//// tab | Info\n \n El contenido de los fragmentos de c√≥digo debe dejarse tal cual.\n \n@@ -45,7 +45,7 @@ El LLM probablemente traducir√° esto mal. Lo interesante es si mantiene la tradu\n \n ////\n \n-//// tab | Informaci√≥n\n+//// tab | Info\n \n La persona que dise√±a el prompt puede elegir si quiere convertir comillas neutras a comillas tipogr√°ficas. Tambi√©n est√° bie\n\n```\n\n```diff\n@@ -10,7 +10,7 @@ Si no eres un \"experto\" en OpenAPI, probablemente no necesites esto.\n \n Puedes establecer el `operationId` de OpenAPI para ser usado en tu *path operation* con el par√°metro `operation_id`.\n \n-Tienes que asegurarte de que sea √∫nico para cada operaci√≥n.\n+Tendr√≠as que asegurarte de que sea √∫nico para cada operaci√≥n.\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial001_py39.py hl[6] *}\n \n@@ -46,7 +46,7 @@ Para excluir una *path operation* del esquema OpenAPI generado (y por lo tanto,\n \n Puedes limitar las l√≠neas usadas del docstring de una *path operation function* para OpenAPI.\n \n-A√±adir un `\\f` (un car√°cter de separaci√≥n de p√°gina escapado) hace que **FastAPI** trunque la salida usada para OpenAPI en este punto.\n+A√±adir un `\\f` (un car√°cter \"form feed\" escapado) hace que **FastAPI** trunque la salida usada para OpenAPI en este punto.\n \n No aparecer√° en la documentaci√≥n, pero otras herramientas (como Sphinx) podr√°n usar el resto.\n \n@@ -141,9 +141,9 @@ Podr√≠as hacer eso con `openapi_extra`:\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial006_py39.py hl[19:36, 39:40] *}\n \n-En este ejemplo, no declaramos ning√∫n modelo Pydantic. De hecho, el cuerpo del request ni siquiera se <abbr title=\"convertido de alg√∫n formato plano, como bytes, a objetos de Python\">parse</abbr> como JSON, se lee directamente como `bytes`, y la funci√≥n `magic_data_reader()` ser√≠a la encargada de parsearlo de alguna manera.\n+En este ejemplo, no declaramos ning√∫n modelo Pydantic. De hecho, el request body ni siquiera se <abbr title=\"converted from some plain format, like bytes, into Python objects - convertido de alg√∫n formato plano, como bytes, a objetos de Python\">parse</abbr> como JSON, se lee directamente como `bytes`, y la funci√≥n `magic_data_reader()` ser√≠a la encargada de parsearlo de alguna manera.\n \n-Sin embargo, podemos declarar el esquema esperado para el cuerpo del request.\n+Sin embargo, podemos declarar el esquema", "output": "Changes look good. This PR implements: üåê Update translations for es (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 471}
{"instruction": "Review the following code changes: üî® Refactor translation script to allow committing in place", "input": "```diff\n@@ -30,6 +30,11 @@ on:\n         type: string\n         required: false\n         default: \"\"\n+      commit_in_place:\n+        description: Whether to commit changes directly instead of making a PR\n+        type: boolean\n+        required: false\n+        default: false\n \n jobs:\n   langs:\n@@ -109,3 +114,4 @@ jobs:\n           LANGUAGE: ${{ matrix.lang }}\n           EN_PATH: ${{ github.event.inputs.en_path }}\n           COMMAND: ${{ matrix.command }}\n+          COMMIT_IN_PLACE: ${{ github.event.inputs.commit_in_place }}\n\n```\n\n```diff\n@@ -360,6 +360,9 @@ def make_pr(\n     command: Annotated[str | None, typer.Option(envvar=\"COMMAND\")] = None,\n     github_token: Annotated[str, typer.Option(envvar=\"GITHUB_TOKEN\")],\n     github_repository: Annotated[str, typer.Option(envvar=\"GITHUB_REPOSITORY\")],\n+    commit_in_place: Annotated[\n+        bool, typer.Option(envvar=\"COMMIT_IN_PLACE\", show_default=True)\n+    ] = False,\n ) -> None:\n     print(\"Setting up GitHub Actions git user\")\n     repo = git.Repo(Path(__file__).absolute().parent.parent)\n@@ -371,14 +374,22 @@ def make_pr(\n         [\"git\", \"config\", \"user.email\", \"github-actions[bot]@users.noreply.github.com\"],\n         check=True,\n     )\n-    branch_name = \"translate\"\n-    if language:\n-        branch_name += f\"-{language}\"\n-    if command:\n-        branch_name += f\"-{command}\"\n-    branch_name += f\"-{secrets.token_hex(4)}\"\n-    print(f\"Creating a new branch {branch_name}\")\n-    subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n+    current_branch = repo.active_branch.name\n+    if current_branch == \"master\" and commit_in_place:\n+        print(\"Can't commit directly to master\")\n+        raise typer.Exit(code=1)\n+\n+    if not commit_in_place:\n+        branch_name = \"translate\"\n+        if language:\n+            branch_name += f\"-{language}\"\n+        if command:\n+            branch_name += f\"-{command}\"\n+        branch_name += f\"-{secrets.token_hex(4)}\"\n+        print(f\"Creating a new branch {branch_name}\")\n+        subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n+    else:\n+        print(f\"Committing in place on branch {current_branch}\")\n     print(\"Adding updated files\")\n     git_path = Path(\"docs\")\n     subprocess.run([\"git\", \"add\", str(git_path)], check=True)\n@@ -391,17 +402,20 @@ def make_pr(\n     subprocess.run([\"git\", \"commit\", \"-m\", message], check=True)\n     print(\"Pushing branch\")\n     subprocess.run([\"git\", \"push\", \"origin\", branch_name], check=True)\n-    print(\"Creating PR\")\n-    g = Github(github_token)\n-    gh_repo = g.get_repo(github_repository)\n-    body = (\n-        message\n-        + \"\\n\\nThis PR was created automatically using LLMs.\"\n-        + f\"\\n\\nIt uses the prompt file https://github.com/fastapi/fastapi/blob/master/docs/{language}/llm-prompt.md.\"\n-        + \"\\n\\nIn most cases, it's better to make PRs updating that file so that the LLM can do a better job generating the translations than suggesting changes in this PR.\"\n-    )\n-    pr = gh_repo.create_pull(title=message, body=body, base=\"master\", head=branch_name)\n-    print(f\"Created PR: {pr.number}\")\n+    if not commit_in_place:\n+        print(\"Creating PR\")\n+        g = Github(github_token)\n+        gh_repo = g.get_repo(github_repository)\n+        body = (\n+            message\n+            + \"\\n\\nThis PR was created automatically using LLMs.\"\n+            + f\"\\n\\nIt uses the prompt file https://github.com/fastapi/fastapi/blob/master/docs/{language}/llm-prompt.md.\"\n+            + \"\\n\\nIn most cases, it's better to make PRs up\n\n```", "output": "Changes look good. This PR implements: üî® Refactor translation script to allow committing in place", "source": "pr", "type": "code_review", "pr_number": 470}
{"instruction": "Review the following code changes: üåê Update translations for uk (update-outdated)", "input": "```diff\n@@ -321,6 +321,8 @@ extra:\n     name: pt - portugu√™s\n   - link: /ru/\n     name: ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫\n+  - link: /uk/\n+    name: uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞\n extra_css:\n - css/termynal.css\n - css/custom.css\n\n```\n\n```diff\n@@ -1,8 +1,14 @@\n+# FastAPI { #fastapi }\n+\n+<style>\n+.md-content .md-typeset h1 { display: none; }\n+</style>\n+\n <p align=\"center\">\n-  <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n+  <a href=\"https://fastapi.tiangolo.com/uk\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>–ì–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É, –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π, –ø—Ä–æ—Å—Ç–∏–π —É –≤–∏–≤—á–µ–Ω–Ω—ñ —Ç–∞ —à–≤–∏–¥–∫–∏–π –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫</em>\n+    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI: –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -21,46 +27,51 @@\n \n ---\n \n-**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: <a href=\"https://fastapi.tiangolo.com\" target=\"_blank\">https://fastapi.tiangolo.com</a>\n+**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: <a href=\"https://fastapi.tiangolo.com/uk\" target=\"_blank\">https://fastapi.tiangolo.com</a>\n \n-**–ü—Ä–æ–≥—Ä–∞–º–Ω–∏–π –∫–æ–¥**: <a href=\"https://github.com/fastapi/fastapi\" target=\"_blank\">https://github.com/fastapi/fastapi</a>\n+**–í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥**: <a href=\"https://github.com/fastapi/fastapi\" target=\"_blank\">https://github.com/fastapi/fastapi</a>\n \n ---\n \n-FastAPI - —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π), –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python,–≤ –æ—Å–Ω–æ–≤—ñ —è–∫–æ–≥–æ –ª–µ–∂–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –∞–Ω–æ—Ç–∞—Ü—ñ—è —Ç–∏–ø—ñ–≤ Python.\n+FastAPI ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n \n –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:\n \n-* **–®–≤–∏–¥–∫–∏–π**: –î—É–∂–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —Ç–∞ **Go** (–∑–∞–≤–¥—è–∫–∏ Starlette —Ç–∞ Pydantic). [–û–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤](#performance).\n-\n-* **–®–≤–∏–¥–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É**: –ü—Ä–∏—à–≤–∏–¥—à—É—î —Ä–æ–∑—Ä–æ–±–∫—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 200%-300%. *\n-* **–ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫**: –ó–º–µ–Ω—à–∏—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–∏—Ö –ª—é–¥–∏–Ω–æ—é (—Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º) –Ω–∞ 40%. *\n-* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: –ß—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"–¢–∞–∫–æ–∂ –≤—ñ–¥–æ–º–µ —è–∫ auto-complete, autocompletion, IntelliSense.\">–î–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ó–º–µ–Ω—à—Ç–µ —á–∞—Å –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n-* **–ü—Ä–æ—Å—Ç–∏–π**: –°–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–∏–π, –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ –Ω–∞–≤—á–∞–Ω–Ω—è. –ó–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –º–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó.\n-* **–ö–æ—Ä–æ—Ç–∫–∏–π**: –ó–≤–µ–¥–µ –¥–æ –º—ñ–Ω—ñ–º—É–º—É –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É. –ö–æ–∂–µ–Ω –æ–≥–æ–ª–æ—à–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π.\n-* **–ù–∞–¥—ñ–π–Ω–∏–π**: –í–∏ –º–∞—Ç–∏–º–µ—Ç–µ —Å—Ç–∞–±—ñ–ª—å–Ω–∏–π –∫–æ–¥ –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é.\n-* **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–∏–π**: –û—Å–Ω–æ–≤–∞–Ω–∏–π —Ç–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω–∏–π –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏ –¥–ª—è API: <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\">OpenAPI</a> (–ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –≤—ñ–¥–æ–º–∏–π —è–∫ Swagger) —Ç–∞ <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\">JSON Schema</a>.\n+* **–®–≤–∏–¥–∫–∏–π**: –¥—É–∂–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —Ç–∞ **Go** (–∑–∞–≤–¥—è–∫–∏ Starlette —Ç–∞ Pydantic). [–û–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö Python-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤](#performance).\n+* **–®–≤–∏–¥–∫–µ –Ω–∞–ø–∏\n\n```\n\n```diff\n@@ -1,5 +1,5 @@\n-# –ù–∞–≤—á–∞–Ω–Ω—è\n+# –ù–∞–≤—á–∞–Ω–Ω—è { #learn }\n \n-–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –Ω–∞–¥–∞–Ω—ñ –≤—Å—Ç—É–ø–Ω—ñ —Ç–∞ –Ω–∞–≤—á–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è FastAPI.\n+–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –Ω–∞–¥–∞–Ω—ñ –≤—Å—Ç—É–ø–Ω—ñ —Ä–æ–∑–¥—ñ–ª–∏ —Ç–∞ –Ω–∞–≤—á–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è **FastAPI**.\n \n –¶–µ –º–æ–∂–Ω–∞ —Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏ —è–∫ **–∫–Ω–∏–≥—É**, **–∫—É—Ä—Å**, –∞–±–æ **–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π** —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π —Å–ø–æ—Å—ñ–± –æ—Å–≤–æ—ó—Ç–∏ FastAPI. üòé\n\n```\n\n```diff\n@@ -1,29 +1,28 @@\n-# –í—Å—Ç—É–ø –¥–æ —Ç–∏–ø—ñ–≤ Python\n+# –í—Å—Ç—É–ø –¥–æ —Ç–∏–ø—ñ–≤ Python { #python-types-intro }\n \n-Python –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–æ–¥–∞—Ç–∫–æ–≤—ñ \"–ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—É\" (\"type hints\") (—Ç–∞–∫–æ–∂ –∑–≤–∞–Ω—ñ \"–∞–Ω–æ—Ç–∞—Ü—ñ—è–º–∏ —Ç–∏–ø—É\" (\"type annotations\")).\n+Python –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–æ–¥–∞—Ç–∫–æ–≤—ñ ¬´–ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—ñ–≤¬ª (—Ç–∞–∫–æ–∂ –∑–≤–∞–Ω—ñ ¬´–∞–Ω–æ—Ç–∞—Ü—ñ—è–º–∏ —Ç–∏–ø—ñ–≤¬ª).\n \n-–¶—ñ **\"type hints\"** —î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º, —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ <abbr title=\"–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: str, int, float, bool\">—Ç–∏–ø</abbr> –∑–º—ñ–Ω–Ω–æ—ó.\n+–¶—ñ **¬´–ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—ñ–≤¬ª** –∞–±–æ –∞–Ω–æ—Ç–∞—Ü—ñ—ó ‚Äî —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ <abbr title=\"–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: str, int, float, bool\">—Ç–∏–ø</abbr> –∑–º—ñ–Ω–Ω–æ—ó.\n \n-–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤ –¥–ª—è –≤–∞—à–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö, —Ä–µ–¥–∞–∫—Ç–æ—Ä–∏ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –º–æ–∂—É—Ç—å –Ω–∞–¥–∞—Ç–∏ –≤–∞–º –∫—Ä–∞—â—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É.\n+–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç–∏–ø—ñ–≤ –¥–ª—è –≤–∞—à–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∏ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –º–æ–∂—É—Ç—å –Ω–∞–¥–∞—Ç–∏ –≤–∞–º –∫—Ä–∞—â—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É.\n \n-–¶–µ –ø—Ä–æ—Å—Ç–æ **—à–≤–∏–¥–∫–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ / –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è** –ø—Ä–æ –∞–Ω–æ—Ç–∞—Ü—ñ—ó —Ç–∏–ø—ñ–≤ —É Python. –í—ñ–Ω –ø–æ–∫—Ä–∏–≤–∞—î –ª–∏—à–µ –º—ñ–Ω—ñ–º—É–º, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö –∑ **FastAPI**... —â–æ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –¥—É–∂–µ –º–∞–ª–æ.\n+–¶–µ –ª–∏—à–µ **—à–≤–∏–¥–∫–∏–π —Ç—É—Ç–æ—Ä—ñ–∞–ª / –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è** –ø—Ä–æ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—ñ–≤ —É Python. –í—ñ–Ω –ø–æ–∫—Ä–∏–≤–∞—î –ª–∏—à–µ –º—ñ–Ω—ñ–º—É–º, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π —â–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö –∑ **FastAPI**... —â–æ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –¥—É–∂–µ –º–∞–ª–æ.\n \n-**FastAPI** –ø–æ–≤–Ω—ñ—Å—Ç—é –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Ü–∏—Ö –∞–Ω–æ—Ç–∞—Ü—ñ—è—Ö —Ç–∏–ø—ñ–≤, –≤–æ–Ω–∏ –¥–∞—é—Ç—å –π–æ–º—É –±–∞–≥–∞—Ç–æ –ø–µ—Ä–µ–≤–∞–≥.\n+**FastAPI** –ø–æ–≤–Ω—ñ—Å—Ç—é –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Ü–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤, –≤–æ–Ω–∏ –¥–∞—é—Ç—å –π–æ–º—É –±–∞–≥–∞—Ç–æ –ø–µ—Ä–µ–≤–∞–≥ —ñ –∫–æ—Ä–∏—Å—Ç—ñ.\n \n –ê–ª–µ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î—Ç–µ **FastAPI**, –≤–∞–º –±—É–¥–µ –∫–æ—Ä–∏—Å–Ω–æ –¥—ñ–∑", "output": "Changes look good. This PR implements: üåê Update translations for uk (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 469}
{"instruction": "Review the following code changes: üåê Update translations for ko (update-outdated)", "input": "```diff\n@@ -317,6 +317,8 @@ extra:\n     name: de - Deutsch\n   - link: /es/\n     name: es - espa√±ol\n+  - link: /ko/\n+    name: ko - ÌïúÍµ≠Ïñ¥\n   - link: /pt/\n     name: pt - portugu√™s\n   - link: /ru/\n\n```\n\n```diff\n@@ -1,3 +1,3 @@\n-# ÏÜåÍ∞ú\n+# ÏÜåÍ∞ú { #about }\n \n-FastAPIÏóê ÎåÄÌïú ÎîîÏûêÏù∏, ÏòÅÍ∞ê Îì±Ïóê ÎåÄÌï¥ ü§ì\n+FastAPI, Í∑∏ ÎîîÏûêÏù∏, ÏòÅÍ∞ê Îì±Ïóê ÎåÄÌï¥ ü§ì\n\n```\n\n```diff\n@@ -1,16 +1,16 @@\n-# Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú\n+# Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú { #additional-status-codes }\n \n Í∏∞Î≥∏Ï†ÅÏúºÎ°ú **FastAPI**Îäî ÏùëÎãµÏùÑ `JSONResponse`Î•º ÏÇ¨Ïö©ÌïòÏó¨ Î∞òÌôòÌïòÎ©∞, *Í≤ΩÎ°ú ÏûëÏóÖ(path operation)*ÏóêÏÑú Î∞òÌôòÌïú ÎÇ¥Ïö©ÏùÑ Ìï¥Îãπ `JSONResponse` ÏïàÏóê ÎÑ£Ïñ¥ Î∞òÌôòÌï©ÎãàÎã§.\n \n Í∏∞Î≥∏ ÏÉÅÌÉú ÏΩîÎìú ÎòêÎäî *Í≤ΩÎ°ú ÏûëÏóÖ*ÏóêÏÑú ÏÑ§Ï†ïÌïú ÏÉÅÌÉú ÏΩîÎìúÎ•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.\n \n-## Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú\n+## Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú { #additional-status-codes_1 }\n \n Í∏∞Î≥∏ ÏÉÅÌÉú ÏΩîÎìúÏôÄ Î≥ÑÎèÑÎ°ú Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìúÎ•º Î∞òÌôòÌïòÎ†§Î©¥ `JSONResponse`ÏôÄ Í∞ôÏù¥ `Response`Î•º ÏßÅÏ†ë Î∞òÌôòÌïòÍ≥† Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìúÎ•º ÏßÅÏ†ë ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.\n \n ÏòàÎ•º Îì§Ïñ¥ Ìï≠Î™©ÏùÑ ÏóÖÎç∞Ïù¥Ìä∏Ìï† Ïàò ÏûàÎäî *Í≤ΩÎ°ú ÏûëÏóÖ*Ïù¥ ÏûàÍ≥† ÏÑ±Í≥µ Ïãú 200 ‚ÄúOK‚ÄùÏùò HTTP ÏÉÅÌÉú ÏΩîÎìúÎ•º Î∞òÌôòÌïúÎã§Í≥† Í∞ÄÏ†ïÌï¥ Î≥¥Í≤†ÏäµÎãàÎã§.\n \n-ÌïòÏßÄÎßå ÏÉàÎ°úÏö¥ Ìï≠Î™©ÏùÑ ÌóàÏö©ÌïòÍ∏∞Î•º ÏõêÌï† Í≤ÉÏûÖÎãàÎã§. Ìï≠Î™©Ïù¥ Ïù¥Ï†ÑÏóê Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏïòÎã§Î©¥ Ïù¥Î•º ÏÉùÏÑ±ÌïòÍ≥† HTTP ÏÉÅÌÉú ÏΩîÎìú 201 \"Created\"Î•º Î∞òÌôòÌï©ÎãàÎã§.\n+ÌïòÏßÄÎßå ÏÉàÎ°úÏö¥ Ìï≠Î™©ÏùÑ ÌóàÏö©ÌïòÍ∏∞Î•º ÏõêÌï† Í≤ÉÏûÖÎãàÎã§. Í∑∏Î¶¨Í≥† Ìï≠Î™©Ïù¥ Ïù¥Ï†ÑÏóê Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏïòÎã§Î©¥ Ïù¥Î•º ÏÉùÏÑ±ÌïòÍ≥† HTTP ÏÉÅÌÉú ÏΩîÎìú 201 \"Created\"Î•º Î∞òÌôòÌï©ÎãàÎã§.\n \n Ïù¥Î•º ÏúÑÌï¥ÏÑúÎäî `JSONResponse`Î•º Í∞ÄÏ†∏ÏôÄÏÑú ÏõêÌïòÎäî `status_code`Î•º ÏÑ§Ï†ïÌïòÏó¨ ÏΩòÌÖêÏ∏†Î•º ÏßÅÏ†ë Î∞òÌôòÌï©ÎãàÎã§:\n \n@@ -26,15 +26,15 @@\n \n ///\n \n-/// note | Í∏∞Ïà†Ï†Å ÏÑ∏Î∂Ä Ï†ïÎ≥¥\n+/// note | Í∏∞Ïà† ÏÑ∏Î∂ÄÏÇ¨Ìï≠\n \n `from starlette.responses import JSONResponse`Î•º ÏÇ¨Ïö©Ìï† ÏàòÎèÑ ÏûàÏäµÎãàÎã§.\n \n **FastAPI**Îäî Í∞úÎ∞úÏûê Ïó¨Îü¨Î∂ÑÏùÑ ÏúÑÌïú Ìé∏ÏùòÏÑ±ÏúºÎ°ú `fastapi.responses`ÏôÄ ÎèôÏùºÌïú `starlette.responses`Î•º Ï†úÍ≥µÌï©ÎãàÎã§. Í∑∏Îü¨ÎÇò ÏÇ¨Ïö© Í∞ÄÎä•Ìïú ÏùëÎãµÏùò ÎåÄÎ∂ÄÎ∂ÑÏùÄ StarletteÏóêÏÑú ÏßÅÏ†ë Ï†úÍ≥µÎê©ÎãàÎã§. `status` ÎòêÌïú ÎßàÏ∞¨Í∞ÄÏßÄÏûÖÎãàÎã§.\n \n ///\n \n-## OpenAPI Î∞è API Î¨∏ÏÑú\n+## OpenAPI Î∞è API Î¨∏ÏÑú { #openapi-and-api-docs }\n \n Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìúÏôÄ ÏùëÎãµÏùÑ ÏßÅÏ†ë Î∞òÌôòÌïòÎäî Í≤ΩÏö∞, FastAPIÎäî Î∞òÌôòÌï† ÎÇ¥Ïö©ÏùÑ ÎØ∏Î¶¨ Ïïå Ïàò ÏûàÎäî Î∞©Î≤ïÏù¥ ÏóÜÍ∏∞ ÎïåÎ¨∏Ïóê OpenAPI Ïä§ÌÇ§Îßà(API Î¨∏ÏÑú)Ïóê Ìè¨Ìï®ÎêòÏßÄ ÏïäÏäµÎãàÎã§.\n \n\n```\n\n```diff\n@@ -1,6 +1,6 @@\n-# Í≥†Í∏â ÏùòÏ°¥ÏÑ±\n+# Í≥†Í∏â ÏùòÏ°¥ÏÑ± { #advanced-dependencies }\n \n-## Îß§Í∞úÎ≥ÄÏàòÌôîÎêú ÏùòÏ°¥ÏÑ±\n+## Îß§Í∞úÎ≥ÄÏàòÌôîÎêú ÏùòÏ°¥ÏÑ± { #parameterized-dependencies }\n \n ÏßÄÍ∏àÍπåÏßÄ Î≥∏ Î™®Îì† ÏùòÏ°¥ÏÑ±ÏùÄ Í≥†Ï†ïÎêú Ìï®Ïàò ÎòêÎäî ÌÅ¥ÎûòÏä§ÏûÖÎãàÎã§.\n \n@@ -10,7 +10,7 @@\n \n Ïù¥Îïå Ìï¥Îãπ Í≥†Ï†ïÎêú ÎÇ¥Ïö©ÏùÑ Îß§Í∞úÎ≥ÄÏàòÌôîÌï† Ïàò ÏûàÍ∏∏ Î∞îÎûçÎãàÎã§.\n \n-## \"Ìò∏Ï∂ú Í∞ÄÎä•Ìïú\" Ïù∏Ïä§ÌÑ¥Ïä§\n+## \"Ìò∏Ï∂ú Í∞ÄÎä•Ìïú\" Ïù∏Ïä§ÌÑ¥Ïä§ { #a-callable-instance }\n \n PythonÏóêÎäî ÌÅ¥ÎûòÏä§Ïùò Ïù∏Ïä§ÌÑ¥Ïä§Î•º \"Ìò∏Ï∂ú Í∞ÄÎä•\"ÌïòÍ≤å ÎßåÎìúÎäî Î∞©Î≤ïÏù¥ ÏûàÏäµÎãàÎã§.\n \n@@ -21,47 +21,144 @@ PythonÏóêÎäî ÌÅ¥ÎûòÏä§Ïùò Ïù∏Ïä§ÌÑ¥Ïä§Î•º \"Ìò∏Ï∂ú Í∞ÄÎä•\"ÌïòÍ≤å ÎßåÎìúÎäî Î∞©Î≤ï\n {* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n \n Ïù¥ Í≤ΩÏö∞, **FastAPI**Îäî Ï∂îÍ∞Ä Îß§Í∞úÎ≥ÄÏàòÏôÄ ÌïòÏúÑ ÏùòÏ°¥ÏÑ±ÏùÑ ÌôïÏù∏ÌïòÍ∏∞ ÏúÑÌï¥ `__call__`ÏùÑ ÏÇ¨Ïö©ÌïòÍ≤å ÎêòÎ©∞,\n-ÎÇòÏ§ëÏóê *Í≤ΩÎ°ú Ïó∞ÏÇ∞ Ìï®Ïàò*ÏóêÏÑú Îß§Í∞úÎ≥ÄÏàòÏóê Í∞íÏùÑ Ï†ÑÎã¨Ìï† Îïå Ïù¥Î•º Ìò∏Ï∂úÌïòÍ≤å Îê©ÎãàÎã§.\n+ÎÇòÏ§ëÏóê *Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*ÏóêÏÑú Îß§Í∞úÎ≥ÄÏàòÏóê Í∞íÏùÑ Ï†ÑÎã¨Ìï† Îïå Ïù¥Î•º Ìò∏Ï∂úÌïòÍ≤å Îê©ÎãàÎã§.\n \n-## Ïù∏Ïä§ÌÑ¥Ïä§ Îß§Í∞úÎ≥ÄÏàòÌôîÌïòÍ∏∞\n+## Ïù∏Ïä§ÌÑ¥Ïä§ Îß§Í∞úÎ≥ÄÏàòÌôîÌïòÍ∏∞ { #parameterize-the-instance }\n \n Ïù¥Ï†ú `__init__`ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏùòÏ°¥ÏÑ±ÏùÑ \"Îß§Í∞úÎ≥ÄÏàòÌôî\"Ìï† Ïàò ÏûàÎäî Ïù∏Ïä§ÌÑ¥Ïä§Ïùò Îß§Í∞úÎ≥ÄÏàòÎ•º ÏÑ†Ïñ∏Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n {* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n \n Ïù¥ Í≤ΩÏö∞, **FastAPI**Îäî `__init__`Ïóê Ï†ÑÌòÄ Í¥ÄÏó¨ÌïòÏßÄ ÏïäÏúºÎ©∞, Ïö∞Î¶¨Îäî Ïù¥ Î©îÏÑúÎìúÎ•º ÏΩîÎìúÏóêÏÑú ÏßÅÏ†ë ÏÇ¨Ïö©ÌïòÍ≤å Îê©ÎãàÎã§.\n \n-## Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±ÌïòÍ∏∞\n+## Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±ÌïòÍ∏∞ { #create-an-instance }\n \n Îã§ÏùåÍ≥º Í∞ôÏù¥ Ïù¥ ÌÅ¥ÎûòÏä§Ïùò Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n {* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n \n Ïù¥Î†áÍ≤å ÌïòÎ©¥ `checker.fixed_content` ÏÜçÏÑ±Ïóê `\"bar\"`ÎùºÎäî Í∞íÏùÑ Îã¥ÏïÑ ÏùòÏ°¥ÏÑ±ÏùÑ \"Îß§Í∞úÎ≥ÄÏàòÌôî\"Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n-## Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏùòÏ°¥ÏÑ±ÏúºÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞\n+## Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏùòÏ°¥ÏÑ±ÏúºÎ°ú ÏÇ¨Ïö©ÌïòÍ∏∞ { #use-the-instance-as-a-dependency }\n \n-Í∑∏Îü∞ Îã§Ïùå, `Depends(FixedContentQueryChecker)` ÎåÄÏã† `Depends(checker)`ÏóêÏÑú Ïù¥ `checker` Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏúºÎ©∞,\n-ÌÅ¥ÎûòÏä§ ÏûêÏ≤¥Í∞Ä ÏïÑÎãå Ïù∏Ïä§ÌÑ¥Ïä§ `checker`Í∞Ä ÏùòÏ°¥ÏÑ±Ïù¥ Îê©ÎãàÎã§.\n+Í∑∏Îü∞ Îã§Ïùå, ÌÅ¥ÎûòÏä§ ÏûêÏ≤¥Í∞Ä ÏïÑÎãå Ïù∏Ïä§ÌÑ¥Ïä§ `checker`Í∞Ä ÏùòÏ°¥ÏÑ±Ïù¥ ÎêòÎØÄÎ°ú, `Depends(FixedContentQueryChecker)` ÎåÄÏã† `Depends(checker)`ÏóêÏÑú Ïù¥ `checker` Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n ÏùòÏ°¥ÏÑ±ÏùÑ Ìï¥Í≤∞Ìï† Îïå **FastAPI**Îäî Ïù¥ `checker`Î•º Îã§ÏùåÍ≥º Í∞ôÏù¥ Ìò∏Ï∂úÌï©ÎãàÎã§:\n \n \n```\n\n```diff\n@@ -1,31 +1,26 @@\n-# ÎπÑÎèôÍ∏∞ ÌÖåÏä§Ìä∏ ÏΩîÎìú ÏûëÏÑ±\n+# ÎπÑÎèôÍ∏∞ ÌÖåÏä§Ìä∏ { #async-tests }\n \n-Ïù¥Ï†Ñ Ïû•ÏóêÏÑú  `TestClient` Î•º Ïù¥Ïö©Ìï¥ **FastAPI** Ïñ¥ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÌÖåÏä§Ìä∏Î•º ÏûëÏÑ±ÌïòÎäî Î≤ïÏùÑ Î∞∞Ïö∞ÏÖ®ÏùÑÌÖêÎç∞Ïöî.\n-ÏßÄÍ∏àÍπåÏßÄÎäî `async` ÌÇ§ÏõåÎìú ÏÇ¨Ïö©ÏóÜÏù¥ ÎèôÍ∏∞ Ìï®ÏàòÏùò ÌÖåÏä§Ìä∏ ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎäî Î≤ïÎßå ÏùµÌòîÏäµÎãàÎã§.\n+Ï†úÍ≥µÎêú `TestClient`Î•º ÏÇ¨Ïö©ÌïòÏó¨ **FastAPI** Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÌÖåÏä§Ìä∏ÌïòÎäî Î∞©Î≤ïÏùÑ Ïù¥ÎØ∏ ÏÇ¥Ìé¥Î≥¥ÏïòÏäµÎãàÎã§. ÏßÄÍ∏àÍπåÏßÄÎäî `async` Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÍ≥†, ÎèôÍ∏∞ ÌÖåÏä§Ìä∏Î•º ÏûëÏÑ±ÌïòÎäî Î∞©Î≤ïÎßå Î≥¥ÏïòÏäµÎãàÎã§.\n \n-ÌïòÏßÄÎßå ÎπÑÎèôÍ∏∞ Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÌÖåÏä§Ìä∏ ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÎäî Í≤ÉÏùÄ Îß§Ïö∞ Ïú†Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n-ÏòàÎ•º Îì§Î©¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê ÎπÑÎèôÍ∏∞Î°ú ÏøºÎ¶¨ÌïòÎäî Í≤ΩÏö∞Î•º ÏÉùÍ∞ÅÌï¥Î¥ÖÏãúÎã§.\n-FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Í≥†, ÎπÑÎèôÍ∏∞ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÏó¨ Î∞±ÏóîÎìúÍ∞Ä Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Ïò¨Î∞îÎ•¥Í≤å Îç∞Ïù¥ÌÑ∞Î•º Í∏∞Î°ùÌñàÎäîÏßÄ ÌôïÏù∏ÌïòÍ≥† Ïã∂ÏùÑ ÎïåÍ∞Ä ÏûàÏùÑ Í≤ÅÎãàÎã§.\n+ÌÖåÏä§Ìä∏ÏóêÏÑú ÎπÑÎèôÍ∏∞ Ìï®ÏàòÎ•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏúºÎ©¥ Ïú†Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§. ÏòàÎ•º Îì§Ïñ¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º ÎπÑÎèôÍ∏∞Î°ú ÏøºÎ¶¨ÌïòÎäî Í≤ΩÏö∞Î•º ÏÉùÍ∞ÅÌï¥ Î≥¥ÏÑ∏Ïöî. FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóê ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ∏ Îã§Ïùå, async Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎ©¥ÏÑú Î∞±ÏóîÎìúÍ∞Ä Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê Ïò¨Î∞îÎ•∏ Îç∞Ïù¥ÌÑ∞Î•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∏∞Î°ùÌñàÎäîÏßÄ Í≤ÄÏ¶ùÌïòÍ≥† Ïã∂ÏùÑ Ïàò ÏûàÏäµÎãàÎã§.\n \n-Ïù¥Îü∞ Í≤ΩÏö∞Ïùò ÌÖåÏä§Ìä∏ ÏΩîÎìúÎ•º Ïñ¥ÎñªÍ≤å ÎπÑÎèôÍ∏∞Î°ú ÏûëÏÑ±ÌïòÎäîÏßÄ ÏïåÏïÑÎ¥ÖÏãúÎã§.\n+Ïñ¥ÎñªÍ≤å ÎèôÏûëÌïòÍ≤å ÎßåÎì§ Ïàò ÏûàÎäîÏßÄ ÏÇ¥Ìé¥Î≥¥Í≤†ÏäµÎãàÎã§.\n \n-## pytest.mark.anyio\n+## pytest.mark.anyio { #pytest-mark-anyio }\n \n-ÏïûÏóêÏÑú ÏûëÏÑ±Ìïú ÌÖåÏä§Ìä∏ Ìï®ÏàòÏóêÏÑú ÎπÑÎèôÍ∏∞ Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïòÍ≥† Ïã∂Îã§Î©¥, ÌÖåÏä§Ìä∏ ÏΩîÎìúÎèÑ ÎπÑÎèôÍ∏∞ Ìï®ÏàòÏó¨ÏïºÌï©ÎãàÎã§.\n-AnyIOÎäî ÌäπÏ†ï ÌÖåÏä§Ìä∏ Ìï®ÏàòÎ•º ÎπÑÎèôÍ∏∞ Ìï®ÏàòÎ°ú Ìò∏Ï∂ú Ìï† Ïàò ÏûàÎäî ÍπîÎÅîÌïú ÌîåÎü¨Í∑∏Ïù∏ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.\n+ÌÖåÏä§Ìä∏ÏóêÏÑú ÎπÑÎèôÍ∏∞ Ìï®ÏàòÎ•º Ìò∏Ï∂úÌïòÎ†§Î©¥, ÌÖåÏä§Ìä∏ Ìï®ÏàòÎèÑ ÎπÑÎèôÍ∏∞Ïó¨Ïïº Ìï©ÎãàÎã§. AnyIOÎäî Ïù¥Î•º ÏúÑÌïú ÍπîÎÅîÌïú ÌîåÎü¨Í∑∏Ïù∏ÏùÑ Ï†úÍ≥µÌïòÎ©∞, ÏùºÎ∂Ä ÌÖåÏä§Ìä∏ Ìï®ÏàòÎ•º ÎπÑÎèôÍ∏∞Î°ú Ìò∏Ï∂úÌïòÎèÑÎ°ù ÏßÄÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.\n \n+## HTTPX { #httpx }\n \n-## HTTPX\n+**FastAPI** Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥ `async def` ÎåÄÏã† ÏùºÎ∞ò `def` Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÎçîÎùºÎèÑ, ÎÇ¥Î∂ÄÏ†ÅÏúºÎ°úÎäî Ïó¨Ï†ÑÌûà `async` Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏûÖÎãàÎã§.\n \n-**FastAPI** Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥  `async def` ÎåÄÏã† `def` ÌÇ§ÏõåÎìúÎ°ú ÏÑ†Ïñ∏Îêú Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÎçîÎùºÎèÑ, ÎÇ¥Î∂ÄÏ†ÅÏúºÎ°úÎäî Ïó¨Ï†ÑÌûà `ÎπÑÎèôÍ∏∞` Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏûÖÎãàÎã§.\n+`TestClient`Îäî ÌëúÏ§Ä pytestÎ•º ÏÇ¨Ïö©ÌïòÏó¨, ÏùºÎ∞ò `def` ÌÖåÏä§Ìä∏ Ìï®Ïàò ÏïàÏóêÏÑú ÎπÑÎèôÍ∏∞ FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ìò∏Ï∂úÌïòÎèÑÎ°ù ÎÇ¥Î∂ÄÏóêÏÑú ÎßàÎ≤ï Í∞ôÏùÄ Ï≤òÎ¶¨Î•º Ìï©ÎãàÎã§. ÌïòÏßÄÎßå ÎπÑÎèôÍ∏∞ Ìï®Ïàò ÏïàÏóêÏÑú Ïù¥Î•º ÏÇ¨Ïö©ÌïòÎ©¥ Í∑∏ ÎßàÎ≤ïÏùÄ Îçî Ïù¥ÏÉÅ ÎèôÏûëÌïòÏßÄ ÏïäÏäµÎãàÎã§. ÌÖåÏä§Ìä∏Î•º ÎπÑÎèôÍ∏∞Î°ú Ïã§ÌñâÌïòÎ©¥, ÌÖåÏä§Ìä∏ Ìï®Ïàò ÏïàÏóêÏÑú `TestClient`Î•º Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\n \n-`TestClient`Îäî pytest ÌëúÏ§ÄÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÎπÑÎèôÍ∏∞ FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÏùºÎ∞òÏ†ÅÏù∏ `def` ÌÖåÏä§Ìä∏ Ìï®Ïàò ÎÇ¥ÏóêÏÑú Ìò∏Ï∂úÌï† Ïàò ÏûàÎèÑÎ°ù ÎÇ¥Î∂ÄÏóêÏÑú ÎßàÏà†ÏùÑ Î∂ÄÎ¶ΩÎãàÎã§. ÌïòÏßÄÎßå Ïù¥ ÎßàÏà†ÏùÄ ÎπÑÎèôÍ∏∞ Ìï®Ïàò ÎÇ¥Î∂ÄÏóêÏÑú ÏÇ¨Ïö©Ìï† ÎïåÎäî Îçî Ïù¥ÏÉÅ ÏûëÎèôÌïòÏßÄ ÏïäÏäµÎãàÎã§. ÌÖåÏä§Ìä∏Î•º ÎπÑÎèôÍ∏∞Î°ú Ïã§ÌñâÌïòÎ©¥, Îçî Ïù¥ÏÉÅ ÌÖåÏä§Ìä∏ Ìï®Ïàò ÎÇ¥Î∂ÄÏóêÏÑú `TestClient`Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.\n+`TestClient`Îäî <a href=\"https://www.python-httpx.org\" class=\"external-link\" target=\"_blank\">HTTPX</a>Î•º Í∏∞Î∞òÏúºÎ°ú ÌïòÎ©∞, Îã§ÌñâÌûà HTTPXÎ•º ÏßÅÏ†ë ÏÇ¨Ïö©Ìï¥ APIÎ•º ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n-`TestClient`Îäî <a href=\"https://www.python-httpx.org\" class=\"external-link\" target=\"_blank\">HTTPX</a>Î•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ≥† ÏûàÏúºÎ©∞, Îã§ÌñâÌûà Ïù¥Î•º ÏßÅÏ†ë ÏÇ¨Ïö©ÌïòÏó¨ APIÎ•º ÌÖåÏä§Ìä∏Ìï† Ïàò Ïûà", "output": "Changes look good. This PR implements: üåê Update translations for ko (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 468}
{"instruction": "Review the following code changes: Clarify \"Required, can be None\" section in query params docs", "input": "```diff\n@@ -244,6 +244,24 @@ Wenn Sie einen Wert als erforderlich deklarieren m√ºssen, w√§hrend Sie `Query` v\n {* ../../docs_src/query_params_str_validations/tutorial006_an_py39.py hl[9] *}\n \n ### Erforderlich, kann `None` sein { #required-can-be-none }\n+Even though a query parameter is required, it can still accept `None` if handled correctly in the code.\n+For example:\n+\n+\n```", "output": "Changes look good. This PR implements: Clarify \"Required, can be None\" section in query params docs", "source": "pr", "type": "code_review", "pr_number": 466}
{"instruction": "Review the following code changes: üë∑ Tweak CI input names", "input": "```diff\n@@ -31,7 +31,7 @@ on:\n         required: false\n         default: \"\"\n       commit_in_place:\n-        description: Whether to commit changes directly instead of making a PR\n+        description: Commit changes directly instead of making a PR\n         type: boolean\n         required: false\n         default: false\n\n```", "output": "Changes look good. This PR implements: üë∑ Tweak CI input names", "source": "pr", "type": "code_review", "pr_number": 465}
{"instruction": "Review the following code changes: 'internal': Added edge cases for validate response", "input": "```diff\n@@ -47,6 +47,22 @@ def get_invalidlist():\n     ]\n \n \n+# edge cases\n+@app.get(\"/items/invalidDict\", response_model=Item)\n+def get_invalidDict():\n+    return {\"name\": \"invalid\", \"owner_ids\": {\"id\": 1}}\n+\n+\n+@app.get(\"/items/invalidtype\", response_model=Item)\n+def get_invalidtype():\n+    return {\"name\": 3, \"price\": 2.7}\n+\n+\n+@app.get(\"/items/invalidtuple\", response_model=Item)\n+def get_invalid_tuple():\n+    return {\"name\": \"invalid\", \"price\": (2.5, 3.5)}\n+\n+\n client = TestClient(app)\n \n \n@@ -82,3 +98,18 @@ def test_double_invalid():\n def test_invalid_list():\n     with pytest.raises(ResponseValidationError):\n         client.get(\"/items/invalidlist\")\n+\n+\n+def test_invalid_dict():\n+    with pytest.raises(ResponseValidationError):\n+        client.get(\"/items/invalidDict\")\n+\n+\n+def test_invalid_type():\n+    with pytest.raises(ResponseValidationError):\n+        client.get(\"/items/invalidtype\")\n+\n+\n+def test_invalid_tuple():\n+    with pytest.raises(ResponseValidationError):\n+        client.get(\"/items/invalidtuple\")\n\n```", "output": "Changes look good. This PR implements: 'internal': Added edge cases for validate response", "source": "pr", "type": "code_review", "pr_number": 464}
{"instruction": "Review the following code changes: docs: improve wording in README", "input": "```diff\n@@ -27,13 +27,14 @@\n \n ---\n \n-FastAPI is a modern, fast (high-performance), web framework for building APIs with Python based on standard Python type hints.\n+FastAPI is a modern, fast (high-performance) web framework for building APIs with Python, based on standard Python type hints.\n+\n \n The key features are:\n \n * **Fast**: Very high performance, on par with **NodeJS** and **Go** (thanks to Starlette and Pydantic). [One of the fastest Python frameworks available](#performance).\n-* **Fast to code**: Increase the speed to develop features by about 200% to 300%. *\n-* **Fewer bugs**: Reduce about 40% of human (developer) induced errors. *\n+* **Fast to code**: Increase the speed of developing features by about 200% to 300%. *\n+* **Fewer bugs**: Reduce about 40% of human (developer)-induced errors. *\n * **Intuitive**: Great editor support. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">Completion</abbr> everywhere. Less time debugging.\n * **Easy**: Designed to be easy to use and learn. Less time reading docs.\n * **Short**: Minimize code duplication. Multiple features from each parameter declaration. Fewer bugs.\n\n```", "output": "Changes look good. This PR implements: docs: improve wording in README", "source": "pr", "type": "code_review", "pr_number": 463}
{"instruction": "Review the following code changes: docs: improve README clarity for new users", "input": "```diff\n@@ -35,7 +35,7 @@ The key features are:\n * **Fast to code**: Increase the speed to develop features by about 200% to 300%. *\n * **Fewer bugs**: Reduce about 40% of human (developer) induced errors. *\n * **Intuitive**: Great editor support. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">Completion</abbr> everywhere. Less time debugging.\n-* **Easy**: Designed to be easy to use and learn. Less time reading docs.\n+* **Easy**: Designed to be easy to use and learn. Spend less time reading docs.\n * **Short**: Minimize code duplication. Multiple features from each parameter declaration. Fewer bugs.\n * **Robust**: Get production-ready code. With automatic interactive documentation.\n * **Standards-based**: Based on (and fully compatible with) the open standards for APIs: <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\">OpenAPI</a> (previously known as Swagger) and <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\">JSON Schema</a>.\n\n```", "output": "Changes look good. This PR implements: docs: improve README clarity for new users", "source": "pr", "type": "code_review", "pr_number": 462}
{"instruction": "Review the following code changes: Add documentation for Full Stack FastAPI + Next.js AI/LLM Template", "input": "```diff\n@@ -0,0 +1,254 @@\n+# Full Stack FastAPI + Next.js Template for AI/LLM Applications\n+\n+A production-ready project generator specifically designed for AI and LLM applications. It provides everything you need to build professional AI-powered products with 20+ enterprise integrations.\n+\n+This template is ideal for building AI chatbots, ML applications, enterprise SaaS, or any project that needs type-safe AI agents with real-time streaming responses.\n+\n+GitHub Repository: <a href=\"https://github.com/vstorm-co/full-stack-fastapi-nextjs-llm-template\" class=\"external-link\" target=\"_blank\">Full Stack FastAPI + Next.js LLM Template</a>\n+\n+## Why This Template\n+\n+Building AI/LLM applications requires more than just an API wrapper. You need:\n+\n+- **Type-safe AI agents** with tool/function calling\n+- **Real-time streaming** responses via WebSocket\n+- **Conversation persistence** and history management\n+- **Production infrastructure** - auth, rate limiting, observability\n+- **Enterprise integrations** - background tasks, webhooks, admin panels\n+\n+This template gives you all of that out of the box, with **20+ configurable integrations** so you can focus on building your AI product, not boilerplate.\n+\n+### Perfect For\n+\n+- ü§ñ **AI Chatbots & Assistants** - PydanticAI or LangChain agents with streaming responses\n+- üìä **ML Applications** - Background task processing with Celery/Taskiq\n+- üè¢ **Enterprise SaaS** - Full auth, admin panel, webhooks, and more\n+- üöÄ **Startups** - Ship fast with production-ready infrastructure\n+\n+### AI-Agent Friendly\n+\n+Generated projects include **CLAUDE.md** and **AGENTS.md** files optimized for AI coding assistants (Claude Code, Codex, Copilot, Cursor, Zed). Following progressive disclosure best practices - concise project overview with pointers to detailed docs when needed.\n+\n+## Technology Stack and Features\n+\n+- **AI/LLM First**\n+    - ü§ñ <a href=\"https://ai.pydantic.dev\" class=\"external-link\" target=\"_blank\">**PydanticAI**</a> or <a href=\"https://python.langchain.com\" class=\"external-link\" target=\"_blank\">**LangChain**</a> with <a href=\"https://langchain-ai.github.io/langgraph/\" class=\"external-link\" target=\"_blank\">**LangGraph**</a> - Choose your preferred AI framework.\n+    - üåä **WebSocket Streaming** - Real-time responses with full event access.\n+    - üí¨ **Conversation Persistence** - Save chat history to database.\n+    - üîß **Custom Tools** - Easily extend agent capabilities.\n+    - üîå **Multi-provider Support** - OpenAI, Anthropic, OpenRouter.\n+    - üìä **Observability** - Logfire for PydanticAI, LangSmith for LangChain.\n+- ‚ö° <a href=\"https://fastapi.tiangolo.com\" class=\"external-link\" target=\"_blank\">**FastAPI**</a> for the Python backend API.\n+    - üîç <a href=\"https://docs.pydantic.dev\" class=\"external-link\" target=\"_blank\">**Pydantic v2**</a> for data validation and settings management.\n+    - üß∞ <a href=\"https://sqlmodel.tiangolo.com\" class=\"external-link\" target=\"_blank\">**SQLModel**</a> or **SQLAlchemy** for Python SQL databa\n\n```\n\n```diff\n@@ -246,6 +246,7 @@ nav:\n   - help-fastapi.md\n   - contributing.md\n   - project-generation.md\n+  - project-generation-ai.md\n   - external-links.md\n   - newsletter.md\n   - management-tasks.md\n\n```", "output": "Changes look good. This PR implements: Add documentation for Full Stack FastAPI + Next.js AI/LLM Template", "source": "pr", "type": "code_review", "pr_number": 461}
{"instruction": "Review the following code changes: docs: add cross-reference for async usage explanationDocs async cross reference", "input": "```diff\n@@ -2,7 +2,7 @@\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+   <em>FastAPI framework: high performance, easy to learn, fast to code, and ready for production</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -126,7 +126,9 @@ The key features are:\n \n If you are building a <abbr title=\"Command Line Interface\">CLI</abbr> app to be used in the terminal instead of a web API, check out <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n \n-**Typer** is FastAPI's little sibling. And it's intended to be the **FastAPI of CLIs**. ‚å®Ô∏è üöÄ\n+**Typer** is FastAPI's little sibling, intended to be the **FastAPI of CLIs**.\n+\n+üöÄ\n \n ## Requirements\n \n@@ -178,7 +180,11 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    Use `async def` only when your code performs non-blocking I/O,\n+    such as database queries or external API calls.\n+\n+\n \n \n```\n\n```diff\n@@ -8,7 +8,7 @@\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+   <em>FastAPI framework: high performance, easy to learn, fast to code, and ready for production</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -123,7 +123,9 @@ The key features are:\n \n If you are building a <abbr title=\"Command Line Interface\">CLI</abbr> app to be used in the terminal instead of a web API, check out <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n \n-**Typer** is FastAPI's little sibling. And it's intended to be the **FastAPI of CLIs**. ‚å®Ô∏è üöÄ\n+**Typer** is FastAPI's little sibling, intended to be the **FastAPI of CLIs**.\n+\n+üöÄ\n \n ## Requirements { #requirements }\n \n@@ -175,7 +177,10 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    To learn more about when to use `async def`, check the Async and await documentation.\n+\n+\n \n \n```\n\n```diff\n@@ -407,7 +407,7 @@ async def app(request: Request) -> Response:\n             raise\n         except Exception as e:\n             http_error = HTTPException(\n-                status_code=400, detail=\"There was an error parsing the body\"\n+                status_code=400, detail=\"An error occurred while parsing the body\"\n             )\n             raise http_error from e\n \n\n```", "output": "Changes look good. This PR implements: docs: add cross-reference for async usage explanationDocs async cross reference", "source": "pr", "type": "code_review", "pr_number": 460}
{"instruction": "Review the following code changes: docs: clarify async usage in example section", "input": "```diff\n@@ -2,7 +2,7 @@\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+   <em>FastAPI framework: high performance, easy to learn, fast to code, and ready for production</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -126,7 +126,9 @@ The key features are:\n \n If you are building a <abbr title=\"Command Line Interface\">CLI</abbr> app to be used in the terminal instead of a web API, check out <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n \n-**Typer** is FastAPI's little sibling. And it's intended to be the **FastAPI of CLIs**. ‚å®Ô∏è üöÄ\n+**Typer** is FastAPI's little sibling, intended to be the **FastAPI of CLIs**.\n+\n+üöÄ\n \n ## Requirements\n \n@@ -178,7 +180,11 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    Use `async def` only when your code performs non-blocking I/O,\n+    such as database queries or external API calls.\n+\n+\n \n \n```\n\n```diff\n@@ -8,7 +8,7 @@\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+   <em>FastAPI framework: high performance, easy to learn, fast to code, and ready for production</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -123,7 +123,9 @@ The key features are:\n \n If you are building a <abbr title=\"Command Line Interface\">CLI</abbr> app to be used in the terminal instead of a web API, check out <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n \n-**Typer** is FastAPI's little sibling. And it's intended to be the **FastAPI of CLIs**. ‚å®Ô∏è üöÄ\n+**Typer** is FastAPI's little sibling, intended to be the **FastAPI of CLIs**.\n+\n+üöÄ\n \n ## Requirements { #requirements }\n \n@@ -175,7 +177,11 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    Use `async def` only when your code performs non-blocking I/O,\n+    such as database queries or external API calls.\n+\n+\n \n \n```\n\n```diff\n@@ -178,7 +180,11 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    Use `async def` only when your code performs non-blocking I/O,\n+    such as database queries or external API calls.\n\n```\n\n```diff\n@@ -178,7 +180,11 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    Use `async def` only when your code performs non-blocking I/O,\n+    such as database queries or external API calls.\n\n```", "output": "Code Review for: docs: clarify async usage in example section\n\nüìù **README.md**: I don't think this clarifies things..\r\nThe term `non-blocking I/O` is not described here and it may be even more confusing.\r\nI think the original version is simpler for newcomers\n\n", "source": "pr", "type": "code_review", "pr_number": 459}
{"instruction": "Review this code change in `README.md`", "input": "```diff\n@@ -178,7 +180,11 @@ def read_item(item_id: int, q: Union[str, None] = None):\n <details markdown=\"1\">\n <summary>Or use <code>async def</code>...</summary>\n \n-If your code uses `async` / `await`, use `async def`:\n+!!! tip\n+    Use `async def` only when your code performs non-blocking I/O,\n+    such as database queries or external API calls.\n\n```", "output": "I don't think this clarifies things..\r\nThe term `non-blocking I/O` is not described here and it may be even more confusing.\r\nI think the original version is simpler for newcomers", "source": "pr_review", "type": "inline_review", "pr_number": 459}
{"instruction": "Review the following code changes: docs: improve wording in documentation tagline", "input": "```diff\n@@ -8,7 +8,7 @@\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+   <em>FastAPI framework: high performance, easy to learn, fast to code, and ready for production</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n\n```", "output": "Changes look good. This PR implements: docs: improve wording in documentation tagline", "source": "pr", "type": "code_review", "pr_number": 458}
{"instruction": "Review the following code changes: ‚¨Ü Bump actions/download-artifact from 6 to 7", "input": "```diff\n@@ -45,7 +45,7 @@ jobs:\n         run: |\n           rm -rf ./site\n           mkdir ./site\n-      - uses: actions/download-artifact@v6\n+      - uses: actions/download-artifact@v7\n         with:\n           path: ./site/\n           pattern: docs-site-*\n\n```\n\n```diff\n@@ -28,7 +28,7 @@ jobs:\n             pyproject.toml\n             uv.lock\n       - run: uv sync --locked --no-dev --group github-actions\n-      - uses: actions/download-artifact@v6\n+      - uses: actions/download-artifact@v7\n         with:\n           name: coverage-html\n           path: htmlcov\n\n```\n\n```diff\n@@ -112,7 +112,7 @@ jobs:\n       - name: Install Dependencies\n         run: uv sync --locked --no-dev --group tests --extra all\n       - name: Get coverage files\n-        uses: actions/download-artifact@v6\n+        uses: actions/download-artifact@v7\n         with:\n           pattern: coverage-*\n           path: coverage\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump actions/download-artifact from 6 to 7", "source": "pr", "type": "code_review", "pr_number": 457}
{"instruction": "Review the following code changes: ‚¨Ü Bump actions/upload-artifact from 5 to 6", "input": "```diff\n@@ -97,7 +97,7 @@ jobs:\n           path: docs/${{ matrix.lang }}/.cache\n       - name: Build Docs\n         run: uv run ./scripts/docs.py build-lang ${{ matrix.lang }}\n-      - uses: actions/upload-artifact@v5\n+      - uses: actions/upload-artifact@v6\n         with:\n           name: docs-site-${{ matrix.lang }}\n           path: ./site/**\n\n```\n\n```diff\n@@ -84,7 +84,7 @@ jobs:\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n-        uses: actions/upload-artifact@v5\n+        uses: actions/upload-artifact@v6\n         with:\n           name: coverage-${{ runner.os }}-${{ matrix.python-version }}-${{ hashFiles('**/coverage/.coverage.*') }}\n           path: coverage\n@@ -121,7 +121,7 @@ jobs:\n       - run: uv run coverage combine coverage\n       - run: uv run coverage html --title \"Coverage for ${{ github.sha }}\"\n       - name: Store coverage HTML\n-        uses: actions/upload-artifact@v5\n+        uses: actions/upload-artifact@v6\n         with:\n           name: coverage-html\n           path: htmlcov\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump actions/upload-artifact from 5 to 6", "source": "pr", "type": "code_review", "pr_number": 456}
{"instruction": "Review the following code changes: ‚¨Ü Bump actions/cache from 4 to 5", "input": "```diff\n@@ -91,7 +91,7 @@ jobs:\n         run: uv sync --locked --no-dev --group docs\n       - name: Update Languages\n         run: uv run ./scripts/docs.py update-languages\n-      - uses: actions/cache@v4\n+      - uses: actions/cache@v5\n         with:\n           key: mkdocs-cards-${{ matrix.lang }}-${{ github.ref }}\n           path: docs/${{ matrix.lang }}/.cache\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump actions/cache from 4 to 5", "source": "pr", "type": "code_review", "pr_number": 455}
{"instruction": "Review the following code changes: üìù Improve wording in background tasks documentation", "input": "```diff\n@@ -1,8 +1,8 @@\n # Background Tasks { #background-tasks }\n \n-You can define background tasks to be run *after* returning a response.\n+You can define background tasks to be run after a response has been returned.\n \n-This is useful for operations that need to happen after a request, but that the client doesn't really have to be waiting for the operation to complete before receiving the response.\n+This is useful for operations that need to happen after a request, when the client does not need to wait for the operation to complete before receiving the response.\n \n This includes, for example:\n \n\n```\n\n```diff\n@@ -1,8 +1,8 @@\n # Background Tasks { #background-tasks }\n \n-You can define background tasks to be run *after* returning a response.\n+You can define background tasks to be run after a response has been returned.\n\n```", "output": "Code Review for: üìù Improve wording in background tasks documentation\n\nüìù **docs/en/docs/tutorial/background-tasks.md**: I think original version is better here\n\n", "source": "pr", "type": "code_review", "pr_number": 454}
{"instruction": "Review this code change in `docs/en/docs/tutorial/background-tasks.md`", "input": "```diff\n@@ -1,8 +1,8 @@\n # Background Tasks { #background-tasks }\n \n-You can define background tasks to be run *after* returning a response.\n+You can define background tasks to be run after a response has been returned.\n\n```", "output": "I think original version is better here", "source": "pr_review", "type": "inline_review", "pr_number": 454}
{"instruction": "Review the following code changes: üìù Update docs for contributing with translations", "input": "```diff\n@@ -177,252 +177,45 @@ as Uvicorn by default will use the port `8000`, the documentation on port `8008`\n \n ### Translations\n \n-/// warning | Attention\n-\n-**Update on Translations**\n-\n-We're updating the way we handle documentation translations.\n-\n-Until now, we invited community members to translate pages via pull requests, which were then reviewed by at least two native speakers. While this has helped bring FastAPI to many more users, we‚Äôve also run into several challenges - some languages have only a few translated pages, others are outdated and hard to maintain over time.\n-To improve this, we‚Äôre working on automation tools ü§ñ to manage translations more efficiently. Once ready, documentation will be machine-translated and still reviewed by at least two native speakers ‚úÖ before publishing. This will allow us to keep translations up-to-date while reducing the review burden on maintainers.\n-\n-What‚Äôs changing now:\n-\n-* üö´ We‚Äôre no longer accepting new community-submitted translation PRs.\n-\n-* ‚è≥ Existing open PRs will be reviewed and can still be merged if completed within the next 3 weeks (since July 11 2025).\n-\n-* üåê In the future, we will only support languages where at least three active native speakers are available to review and maintain translations.\n-\n-This transition will help us keep translations more consistent and timely while better supporting our contributors üôå. Thank you to everyone who has contributed so far ‚Äî your help has been invaluable! üíñ\n-\n-///\n-\n-\n Help with translations is VERY MUCH appreciated! And it can't be done without the help from the community. üåé üöÄ\n \n Here are the steps to help with translations.\n \n-#### Tips and guidelines\n-\n-* Check the currently <a href=\"https://github.com/fastapi/fastapi/pulls\" class=\"external-link\" target=\"_blank\">existing pull requests</a> for your language. You can filter the pull requests by the ones with the label for your language. For example, for Spanish, the label is <a href=\"https://github.com/fastapi/fastapi/pulls?q=is%3Aopen+sort%3Aupdated-desc+label%3Alang-es+label%3Aawaiting-review\" class=\"external-link\" target=\"_blank\">`lang-es`</a>.\n-\n-* Review those pull requests, requesting changes or approving them. For the languages I don't speak, I'll wait for several others to review the translation before merging.\n-\n-/// tip\n-\n-You can <a href=\"https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/commenting-on-a-pull-request\" class=\"external-link\" target=\"_blank\">add comments with change suggestions</a> to existing pull requests.\n-\n-Check the docs about <a href=\"https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/about-pull-request-reviews\" class=\"external-link\" target=\"_blank\">adding a pull request review</a> to approve it or request changes.\n-\n-///\n+#### Review Translation PRs\n \n-* Check if there's a <a href=\"https://github.com/fastapi/fastapi/discussions/categories/translations\" class=\"external-link\" target=\"_blank\">GitHub Discussion</a> to \n\n```\n\n```diff\n@@ -130,14 +130,9 @@ def new_lang(lang: str = typer.Argument(..., callback=lang_callback)):\n     new_path.mkdir()\n     new_config_path: Path = Path(new_path) / mkdocs_name\n     new_config_path.write_text(\"INHERIT: ../en/mkdocs.yml\\n\", encoding=\"utf-8\")\n-    new_config_docs_path: Path = new_path / \"docs\"\n-    new_config_docs_path.mkdir()\n-    en_index_path: Path = en_docs_path / \"docs\" / \"index.md\"\n-    new_index_path: Path = new_config_docs_path / \"index.md\"\n-    en_index_content = en_index_path.read_text(encoding=\"utf-8\")\n-    new_index_content = f\"{missing_translation_snippet}\\n\\n{en_index_content}\"\n-    new_index_path.write_text(new_index_content, encoding=\"utf-8\")\n-    typer.secho(f\"Successfully initialized: {new_path}\", color=typer.colors.GREEN)\n+    new_llm_prompt_path: Path = new_path / \"llm-prompt.md\"\n+    new_llm_prompt_path.write_text(\"\", encoding=\"utf-8\")\n+    print(f\"Successfully initialized: {new_path}\")\n     update_languages()\n \n \n\n```", "output": "Changes look good. This PR implements: üìù Update docs for contributing with translations", "source": "pr", "type": "code_review", "pr_number": 453}
{"instruction": "Review the following code changes: üìù Update docs about managing translations", "input": "```diff\n@@ -196,31 +196,11 @@ They have contributed source code, documentation, etc. üì¶\n \n There are hundreds of other contributors, you can see them all in the <a href=\"https://github.com/fastapi/fastapi/graphs/contributors\" class=\"external-link\" target=\"_blank\">FastAPI GitHub Contributors page</a>. üë∑\n \n-## Top Translators\n-\n-These are the **Top Translators**. üåê\n-\n-These users have created the most Pull Requests with [translations to other languages](contributing.md#translations){.internal-link target=_blank} that have been *merged*.\n-\n-<div class=\"user-list user-list-center\">\n-\n-{% for user in (translators.values() | list)[:50] %}\n-\n-{% if user.login not in skip_users %}\n-\n-<div class=\"user\"><a href=\"{{ user.url }}\" target=\"_blank\"><div class=\"avatar-wrapper\"><img src=\"{{ user.avatarUrl }}\"/></div><div class=\"title\">@{{ user.login }}</div></a> <div class=\"count\">Translations: {{ user.count }}</div></div>\n-\n-{% endif %}\n-\n-{% endfor %}\n-\n-</div>\n-\n ## Top Translation Reviewers\n \n These users are the **Top Translation Reviewers**. üïµÔ∏è\n \n-I only speak a few languages (and not very well üòÖ). So, the reviewers are the ones that have the [**power to approve translations**](contributing.md#translations){.internal-link target=_blank} of the documentation. Without them, there wouldn't be documentation in several other languages.\n+Translation reviewers have the [**power to approve translations**](contributing.md#translations){.internal-link target=_blank} of the documentation. Without them, there wouldn't be documentation in several other languages.\n \n <div class=\"user-list user-list-center\">\n {% for user in (translation_reviewers.values() | list)[:50] %}\n\n```\n\n```diff\n@@ -106,129 +106,15 @@ This way, we can notice when there are new translations ready, because they have\n \n ## Merge Translation PRs\n \n-For Spanish, as I'm a native speaker and it's a language close to me, I will give it a final review myself and in most cases tweak the PR a bit before merging it.\n+Translations are generated automatically with LLMs and scripts.\n \n-For the other languages, confirm that:\n+There's one GitHub Action that can be manually run to add or update translations for a language: <a href=\"https://github.com/fastapi/fastapi/actions/workflows/translate.yml\" class=\"external-link\" target=\"_blank\">`translate.yml`</a>.\n \n-* The title is correct following the instructions above.\n-* It has the labels `lang-all` and `lang-{lang code}`.\n-* The PR changes only one Markdown file adding a translation.\n-    * Or in some cases, at most two files, if they are small, for the same language, and people reviewed them.\n-    * If it's the first translation for that language, it will have additional `mkdocs.yml` files, for those cases follow the instructions below.\n-* The PR doesn't add any additional or extraneous files.\n-* The translation seems to have a similar structure as the original English file.\n-* The translation doesn't seem to change the original content, for example with obvious additional documentation sections.\n-* The translation doesn't use different Markdown structures, for example adding HTML tags when the original didn't have them.\n-* The \"admonition\" sections, like `tip`, `info`, etc. are not changed or translated. For example:\n-\n-\n```", "output": "Changes look good. This PR implements: üìù Update docs about managing translations", "source": "pr", "type": "code_review", "pr_number": 452}
{"instruction": "Review the following code changes: üåê Update translations for de (update-outdated)", "input": "```diff\n@@ -117,6 +117,12 @@ Seine Schl√ºssel-Merkmale sind:\n \n ---\n \n+## FastAPI Mini-Dokumentarfilm { #fastapi-mini-documentary }\n+\n+Es gibt einen <a href=\"https://www.youtube.com/watch?v=mpR8ngthqiE\" class=\"external-link\" target=\"_blank\">FastAPI-Mini-Dokumentarfilm</a>, ver√∂ffentlicht Ende 2025, Sie k√∂nnen ihn online ansehen:\n+\n+<a href=\"https://www.youtube.com/watch?v=mpR8ngthqiE\" target=\"_blank\"><img src=\"https://fastapi.tiangolo.com/img/fastapi-documentary.jpg\" alt=\"FastAPI Mini-Dokumentarfilm\"></a>\n+\n ## **Typer**, das FastAPI der CLIs { #typer-the-fastapi-of-clis }\n \n <a href=\"https://typer.tiangolo.com\" target=\"_blank\"><img src=\"https://typer.tiangolo.com/img/logo-margin/logo-margin-vector.svg\" style=\"width: 20%;\"></a>\n@@ -233,7 +239,7 @@ INFO:     Application startup complete.\n </div>\n \n <details markdown=\"1\">\n-<summary>Was der Befehl <code>fastapi dev main.py</code> macht ...</summary>\n+<summary>√úber den Befehl <code>fastapi dev main.py</code> ...</summary>\n \n Der Befehl `fastapi dev` liest Ihre `main.py`-Datei, erkennt die **FastAPI**-App darin und startet einen Server mit <a href=\"https://www.uvicorn.dev\" class=\"external-link\" target=\"_blank\">Uvicorn</a>.\n \n@@ -276,7 +282,7 @@ Sie sehen die alternative automatische Dokumentation (bereitgestellt von <a href\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-02-redoc-simple.png)\n \n-## Beispiel Aktualisierung { #example-upgrade }\n+## Beispielaktualisierung { #example-upgrade }\n \n √Ñndern Sie jetzt die Datei `main.py`, um den <abbr title=\"Body ‚Äì K√∂rper, Inhalt: Der eigentliche Inhalt einer Nachricht, nicht die Metadaten\">Body</abbr> eines `PUT`-Requests zu empfangen.\n \n@@ -326,7 +332,7 @@ Gehen Sie jetzt auf <a href=\"http://127.0.0.1:8000/docs\" class=\"external-link\" t\n \n ![Swagger UI Interaktion](https://fastapi.tiangolo.com/img/index/index-04-swagger-03.png)\n \n-* Klicken Sie dann auf den Button ‚ÄûExecute‚Äú, die Benutzeroberfl√§che wird mit Ihrer API kommunizieren, sendet die Parameter, holt die Ergebnisse und zeigt sie auf dem Bildschirm an:\n+* Klicken Sie dann auf den Button ‚ÄûExecute‚Äú, die Benutzeroberfl√§che wird mit Ihrer API kommunizieren, die Parameter senden, die Ergebnisse erhalten und sie auf dem Bildschirm anzeigen:\n \n ![Swagger UI Interaktion](https://fastapi.tiangolo.com/img/index/index-05-swagger-04.png)\n \n@@ -439,7 +445,7 @@ F√ºr ein vollst√§ndigeres Beispiel, mit weiteren Funktionen, siehe das <a href=\"\n \n * Deklaration von **Parametern** von anderen verschiedenen Stellen wie: **Header**, **Cookies**, **Formularfelder** und **Dateien**.\n * Wie man **Validierungs-Constraints** wie `maximum_length` oder `regex` setzt.\n-* Ein sehr leistungsf√§higes und einfach zu bedienendes System f√ºr **<abbr title=\"Dependency Injection ‚Äì Einbringen von Abh√§ngigkeiten: Auch bekannt als Komponenten, Ressourcen, Provider, Services, Injectables\">Dependency Injection</abbr>**.\n+* Ein sehr leistungsf√§higes und einfach zu bedienendes System f√ºr **<abbr title=\"auch bekannt als Komponenten, Ressourcen, Provide\n\n```\n\n```diff\n@@ -251,6 +251,7 @@ Below is a list of English terms and their preferred German translations, separa\n * ¬´the button¬ª: ¬´der Button¬ª\n * ¬´the cloud provider¬ª: ¬´der Cloudanbieter¬ª\n * ¬´the CLI¬ª: ¬´Das CLI¬ª\n+* ¬´the coverage¬ª: ¬´Die Testabdeckung¬ª\n * ¬´the command line interface¬ª: ¬´Das Kommandozeileninterface¬ª\n * ¬´the default value¬ª: ¬´der Defaultwert¬ª\n * ¬´the default value¬ª: NOT ¬´der Standardwert¬ª\n\n```", "output": "Changes look good. This PR implements: üåê Update translations for de (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 451}
{"instruction": "Review the following code changes: üìù Update docs for management tasks", "input": "```diff\n@@ -74,7 +74,7 @@ Make sure you use a supported label from the <a href=\"https://github.com/tiangol\n * `refactor`: Refactors\n     * This is normally for changes to the internal code that don't change the behavior. Normally it improves maintainability, or enables future features, etc.\n * `upgrade`: Upgrades\n-    * This is for upgrades to direct dependencies from the project, or extra optional dependencies, normally in `pyproject.toml`. So, things that would affect final users, they would end up receiving the upgrade in their code base once they update. But this is not for upgrades to internal dependencies used for development, testing, docs, etc. Those internal dependencies, normally in `requirements.txt` files or GitHub Action versions should be marked as `internal`, not `upgrade`.\n+    * This is for upgrades to direct dependencies from the project, or extra optional dependencies, normally in `pyproject.toml`. So, things that would affect final users, they would end up receiving the upgrade in their code base once they update. But this is not for upgrades to internal dependencies used for development, testing, docs, etc. Those internal dependencies or GitHub Action versions should be marked as `internal`, not `upgrade`.\n * `docs`: Docs\n     * Changes in docs. This includes updating the docs, fixing typos. But it doesn't include changes to translations.\n     * You can normally quickly detect it by going to the \"Files changed\" tab in the PR and checking if the updated file(s) starts with `docs/en/docs`. The original version of the docs is always in English, so in `docs/en/docs`.\n@@ -118,9 +118,11 @@ For these language translation PRs, confirm that:\n \n ## Review PRs\n \n-If a PR doesn't explain what it does or why, ask for more information.\n+* If a PR doesn't explain what it does or why, if it seems like it could be useful, ask for more information. Otherwise, feel free to close it.\n \n-A PR should have a specific use case that it is solving.\n+* If a PR seems to be spam, meaningless, only to change statistics (to appear as \"contributor\") or similar, you can simply mark it as `invalid`, and it will be automatically closed.\n+\n+* A PR should have a specific use case that it is solving.\n \n * If the PR is for a feature, it should have docs.\n     * Unless it's a feature we want to discourage, like support for a corner case that we don't want users to use.\n@@ -140,27 +142,12 @@ Every month, a GitHub Action updates the FastAPI People data. Those PRs look lik\n \n If the tests are passing, you can merge it right away.\n \n-## External Links PRs\n-\n-When people add external links they edit this file <a href=\"https://github.com/fastapi/fastapi/blob/master/docs/en/data/external_links.yml\" class=\"external-link\" target=\"_blank\">external_links.yml</a>.\n-\n-* Make sure the new link is in the correct category (e.g. \"Podcasts\") and language (e.g. \"Japanese\").\n-* A new link should be at the top of its list.\n-* The link URL should work (it should not return a 404).\n-* The conten\n\n```", "output": "Changes look good. This PR implements: üìù Update docs for management tasks", "source": "pr", "type": "code_review", "pr_number": 450}
{"instruction": "Review the following code changes: üåê Update translation prompts", "input": "```diff\n@@ -4,213 +4,197 @@ Translate to German (Deutsch).\n \n Language code: de.\n \n-\n-### Definitions\n-\n-\"hyphen\"\n-    The character ¬´-¬ª\n-    Unicode U+002D (HYPHEN-MINUS)\n-    Alternative names: hyphen, dash, minus sign\n-\n-\"dash\"\n-    The character ¬´‚Äì¬ª\n-    Unicode U+2013 (EN DASH)\n-    German name: Halbgeviertstrich\n-\n-\n ### Grammar to use when talking to the reader\n \n-Use the formal grammar (use ¬´Sie¬ª instead of ¬´Du¬ª).\n-\n+Use the formal grammar (use `Sie` instead of `Du`).\n \n ### Quotes\n \n-1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to German double typographic quotes (¬´‚Äû¬ª and ¬´‚Äú¬ª). Convert neutral single quotes (¬´'¬ª) and English single typographic quotes (¬´‚Äò¬ª and ¬´‚Äô¬ª) to German single typographic quotes (¬´‚Äö¬ª and ¬´‚Äò¬ª). Do NOT convert ¬´`\"¬ª to ¬´‚Äû¬ª, do NOT convert ¬´\"`¬ª to ¬´‚Äú¬ª.\n+1) Convert neutral double quotes (`\"`) to German double typographic quotes (`‚Äû` and `‚Äú`). Convert neutral single quotes (`'`) to German single typographic quotes (`‚Äö` and `‚Äò`).\n \n-Examples:\n+Do NOT convert quotes in code snippets and code blocks to their German typographic equivalents.\n \n-    Source (English):\n+Examples:\n \n-        ¬´¬´¬´\n-        \"Hello world\"\n-        ‚ÄúHello Universe‚Äù\n-        \"He said: 'Hello'\"\n-        ‚Äúmy name is ‚ÄòNils‚Äô‚Äù\n-        `\"__main__\"`\n-        `\"items\"`\n-        ¬ª¬ª¬ª\n+Source (English):\n \n-    Result (German):\n+\n```\n\n```diff\n@@ -6,7 +6,7 @@ Tests added here will be seen by all designers of language specific prompts.\n \n Use as follows:\n \n-* Have a language specific prompt ‚Äì `docs/{language code}/llm-prompt.md`.\n+* Have a language specific prompt - `docs/{language code}/llm-prompt.md`.\n * Do a fresh translation of this document into your desired target language (see e.g. the `translate-page` command of the `translate.py`). This will create the translation under `docs/{language code}/docs/_llm-test.md`.\n * Check if things are okay in the translation.\n * If necessary, improve your language specific prompt, the general prompt, or the English document.\n\n```\n\n```diff\n@@ -6,23 +6,23 @@ Language code: ja.\n \n ### Grammar and tone\n \n-1) Use polite, instructional Japanese („Åß„Åô/„Åæ„ÅôË™ø).\n-2) Keep the tone concise and technical (match existing Japanese FastAPI docs).\n+- Use polite, instructional Japanese („Åß„Åô/„Åæ„ÅôË™ø).\n+- Keep the tone concise and technical (match existing Japanese FastAPI docs).\n \n ### Headings\n \n-1) Follow the existing Japanese style: short, descriptive headings (often noun phrases), e.g. „Äå„ÉÅ„Çß„ÉÉ„ÇØ„Äç.\n-2) Do not add a trailing period at the end of headings.\n+- Follow the existing Japanese style: short, descriptive headings (often noun phrases), e.g. „Äå„ÉÅ„Çß„ÉÉ„ÇØ„Äç.\n+- Do not add a trailing period at the end of headings.\n \n ### Quotes\n \n-1) Prefer Japanese corner brackets „Äå„Äç in normal prose when quoting a term.\n-2) Do not change quotes inside inline code, code blocks, URLs, or file paths.\n+- Prefer Japanese corner brackets „Äå„Äç in normal prose when quoting a term.\n+- Do not change quotes inside inline code, code blocks, URLs, or file paths.\n \n ### Ellipsis\n \n-1) Keep ellipsis style consistent with existing Japanese docs (commonly `...`).\n-2) Never change `...` in code, URLs, or CLI examples.\n+- Keep ellipsis style consistent with existing Japanese docs (commonly `...`).\n+- Never change `...` in code, URLs, or CLI examples.\n \n ### Preferred translations / glossary\n \n\n```\n\n```diff\n@@ -6,23 +6,23 @@ Language code: ko.\n \n ### Grammar and tone\n \n-1) Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n-2) Keep the tone consistent with the existing Korean FastAPI docs.\n+- Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n+- Keep the tone consistent with the existing Korean FastAPI docs.\n \n ### Headings\n \n-1) Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n-2) Do not add trailing punctuation to headings.\n+- Follow existing Korean heading style (short, action-oriented headings like ‚ÄúÌôïÏù∏ÌïòÍ∏∞‚Äù).\n+- Do not add trailing punctuation to headings.\n \n ### Quotes\n \n-1) Keep quote style consistent with the existing Korean docs.\n-2) Never change quotes inside inline code, code blocks, URLs, or file paths.\n+- Keep quote style consistent with the existing Korean docs.\n+- Never change quotes inside inline code, code blocks, URLs, or file paths.\n \n ### Ellipsis\n \n-1) Keep ellipsis style consistent with existing Korean docs (often `...`).\n-2) Never change `...` in code, URLs, or CLI examples.\n+- Keep ellipsis style consistent with existing Korean docs (often `...`).\n+- Never change `...` in code, URLs, or CLI examples.\n \n ### Preferred translations / glossary\n \n\n```\n\n```diff\n@@ -4,6 +4,6 @@ This page hasn‚Äôt been translated into your language yet. üåç\n \n We‚Äôre currently switching to an automated translation system ü§ñ, which will help keep all translations complete and up to date.\n \n-Learn more: [Contributing ‚Äì Translations](https://fastapi.tiangolo.com/contributing/#translations){.internal-link target=_blank}\n+Learn more: [Contributing - Translations](https://fastapi.tian", "output": "Code Review for: üåê Update translation prompts\n\nüìù **scripts/translate.py**: There appears to be a typo. The filename should be `general-llm-prompt.md`.\n\n", "source": "pr", "type": "code_review", "pr_number": 449}
{"instruction": "Review this code change in `scripts/translate.py`", "input": "```diff\n@@ -25,650 +25,8 @@\n     \"contributing.md\",\n )\n \n-\n-general_prompt = \"\"\"\n-### About literal text in this prompt\n-\n-1) In the following instructions (after I say: `The above rules are in effect now`) the two characters `¬´` and `¬ª` will be used to surround LITERAL TEXT, which is text or characters you shall interpret literally. The `¬´` and the `¬ª` are not part of the literal text, they are the meta characters denoting it.\n-\n-2) Furthermore, text surrounded by `¬´¬´¬´` and `¬ª¬ª¬ª` is a BLOCK OF LITERAL TEXT which spans multiple lines. To get its content, dedent all lines of the block until the `¬´¬´¬´` and `¬ª¬ª¬ª` are at column zero, then remove the newline (`\\n`) after the `¬´¬´¬´` and the newline before the `¬ª¬ª¬ª`. The `¬´¬´¬´` and the `¬ª¬ª¬ª` are not part of the literal text block, they are the meta characters denoting it.\n-\n-3) If you see backticks or any other quotes inside literal text ‚Äì inside `¬´` and `¬ª` ‚Äì  or inside blocks of literal text ‚Äì inside `¬´¬´¬´` and `¬ª¬ª¬ª` ‚Äì then interpret them as literal characters, do NOT interpret them as meta characters.\n-\n-The above rules are in effect now.\n-\n-\n-### Definitions of terms used in this prompt\n-\n-\"backtick\"\n-\n-    The character ¬´`¬ª\n-    Unicode U+0060 (GRAVE ACCENT)\n-\n-\"single backtick\"\n-\n-    A single backtick ‚Äì ¬´`¬ª\n-\n-\"triple backticks\"\n-\n-    Three backticks in a row ‚Äì ¬´```¬ª\n-\n-\"neutral double quote\"\n-\n-    The character ¬´\"¬ª\n-    Unicode U+0022 (QUOTATION MARK)\n-\n-\"neutral single quote\"\n-\n-    The character ¬´'¬ª\n-    Unicode U+0027 (APOSTROPHE)\n-\n-\"English double typographic quotes\"\n-\n-    The characters ¬´‚Äú¬ª and ¬´‚Äù¬ª\n-    Unicode U+201C (LEFT DOUBLE QUOTATION MARK) and Unicode U+201D (RIGHT DOUBLE QUOTATION MARK)\n-\n-\"English single typographic quotes\"\n-\n-    The characters ¬´‚Äò¬ª and ¬´‚Äô¬ª\n-    Unicode U+2018 (LEFT SINGLE QUOTATION MARK) and Unicode U+2019 (RIGHT SINGLE QUOTATION MARK)\n-\n-\"code snippet\"\n-\n-    Also called \"inline code\". Text in a Markdown document which is surrounded by single backticks. A paragraph in a Markdown document can have a more than one code snippet.\n-\n-    Example:\n-\n-        ¬´¬´¬´\n-        `i am a code snippet`\n-        ¬ª¬ª¬ª\n-\n-    Example:\n-\n-        ¬´¬´¬´\n-        `first code snippet` `second code snippet` `third code snippet`\n-        ¬ª¬ª¬ª\n-\n-\"code block\"\n-\n-    Text in a Markdown document which is surrounded by triple backticks. Spreads multiple lines.\n-\n-    Example:\n-\n-        ¬´¬´¬´\n-        ```\n-        Hello\n-        World\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Example:\n-\n-        ¬´¬´¬´\n-        ```python\n-        print(\"hello World\")\n-        ```\n-        ¬ª¬ª¬ª\n-\n-\"HTML element\"\n-\n-    a HTML opening tag ‚Äì e.g. ¬´<div>¬ª ‚Äì and a HTML closing tag ‚Äì e.g. ¬´</div>¬ª ‚Äì surrounding text or other HTML elements.\n-\n-\n-### Your task\n-\n-Translate an English text ‚Äì the original content ‚Äì to a target language.\n-\n-The original content is written in Markdown, write the translation in Markdown as well.\n-\n-The original content will be surrounded by triple percentage signs (¬´%%%¬ª). Do not include the triple percentage signs in the translation.\n-\n-\n-### Technical terms in English\n-\n-For technical terms in English that don't have a common translation term, use the original term in English.\n-\n-\n-### Content of code snippets\n-\n-Do not translate the content of code snippets, keep the original in English. For example, ¬´`list`¬ª, ¬´`dict`¬ª, keep them as is.\n-\n-\n-### Content of code blocks\n-\n-Do not translate the content of code blocks, except for comments in the language which the code block uses.\n-\n-Examples:\n-\n-    Source (English) ‚Äì The code block is a bash code example with one comment:\n-\n-        ¬´¬´¬´\n-        ```bash\n-        # Print greeting\n-        echo \"Hello, World!\"\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        ```bash\n-        # Gru√ü ausgeben\n-        echo \"Hello, World!\"\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Source (English) ‚Äì The code block is a console example containing HTML tags. No comments, so nothing to change here:\n-\n-        ¬´¬´¬´\n-        ```console\n-        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n-        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n-                Searching for package file structure\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        ```console\n-        $ <font color=\"#4E9A06\">fastapi</font> run <u style=\"text-decoration-style:solid\">main.py</u>\n-        <span style=\"background-color:#009485\"><font color=\"#D3D7CF\"> FastAPI </font></span>  Starting server\n-                Searching for package file structure\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Source (English) ‚Äì The code block is a console example containing 5 comments:\n-\n-        ¬´¬´¬´\n-        ```console\n-        // Go to the home directory\n-        $ cd\n-        // Create a directory for all your code projects\n-        $ mkdir code\n-        // Enter into that code directory\n-        $ cd code\n-        // Create a directory for this project\n-        $ mkdir awesome-project\n-        // Enter into that project directory\n-        $ cd awesome-project\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        ```console\n-        // Gehe zum Home-Verzeichnis\n-        $ cd\n-        // Erstelle ein Verzeichnis f√ºr alle Ihre Code-Projekte\n-        $ mkdir code\n-        // Gehe in dieses Code-Verzeichnis\n-        $ cd code\n-        // Erstelle ein Verzeichnis f√ºr dieses Projekt\n-        $ mkdir awesome-project\n-        // Gehe in dieses Projektverzeichnis\n-        $ cd awesome-project\n-        ```\n-        ¬ª¬ª¬ª\n-\n-If there is an existing translation and its Mermaid diagram is in sync with the Mermaid diagram in the English source, except a few translated words, then use the Mermaid diagram of the existing translation. The human editor of the translation translated these words in the Mermaid diagram. Keep these translations, do not revert them back to the English source.\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        ```mermaid\n-        flowchart LR\n-            subgraph global[global env]\n-                harry-1[harry v1]\n-            end\n-            subgraph stone-project[philosophers-stone project]\n-                stone(philosophers-stone) -->|requires| harry-1\n-            end\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Existing translation (German) ‚Äì has three translations:\n-\n-        ¬´¬´¬´\n-        ```mermaid\n-        flowchart LR\n-            subgraph global[globale Umgebung]\n-                harry-1[harry v1]\n-            end\n-            subgraph stone-project[philosophers-stone-Projekt]\n-                stone(philosophers-stone) -->|ben√∂tigt| harry-1\n-            end\n-        ```\n-        ¬ª¬ª¬ª\n-\n-    Result (German) ‚Äì you change nothing:\n-\n-        ¬´¬´¬´\n-        ```mermaid\n-        flowchart LR\n-            subgraph global[globale Umgebung]\n-                harry-1[harry v1]\n-            end\n-            subgraph stone-project[philosophers-stone-Projekt]\n-                stone(philosophers-stone) -->|ben√∂tigt| harry-1\n-            end\n-        ```\n-        ¬ª¬ª¬ª\n-\n-\n-### Special blocks\n-\n-There are special blocks of notes, tips and others that look like:\n-\n-    ¬´¬´¬´\n-    /// note\n-    ¬ª¬ª¬ª\n-\n-To translate it, keep the same line and add the translation after a vertical bar.\n-\n-For example, if you were translating to Spanish, you would write:\n-\n-    ¬´¬´¬´\n-    /// note | Nota\n-    ¬ª¬ª¬ª\n-\n-Some examples in Spanish:\n-\n-    Source:\n-\n-        ¬´¬´¬´\n-        /// tip\n-        ¬ª¬ª¬ª\n-\n-    Result:\n-\n-        ¬´¬´¬´\n-        /// tip | Consejo\n-        ¬ª¬ª¬ª\n-\n-    Source:\n-\n-        ¬´¬´¬´\n-        /// details | Preview\n-        ¬ª¬ª¬ª\n-\n-    Result:\n-\n-        ¬´¬´¬´\n-        /// details | Vista previa\n-        ¬ª¬ª¬ª\n-\n-\n-### Tab blocks\n-\n-There are special blocks surrounded by four slashes (¬´////¬ª). They mark text, which will be rendered as part of a tab in the final document. The scheme is:\n-\n-    //// tab | {tab title}\n-    {tab content, may span many lines}\n-    ////\n-\n-Keep everything before the vertical bar (¬´|¬ª) as is, including the vertical bar. Translate the tab title. Translate the tab content, applying the rules you know. Keep the four block closing slashes as is.\n-\n-Examples:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        //// tab | Python 3.8+ non-Annotated\n-        Hello\n-        ////\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        //// tab | Python 3.8+ nicht annotiert\n-        Hallo\n-        ////\n-        ¬ª¬ª¬ª\n-\n-    Source (English) ‚Äì Here there is nothing to translate in the tab title:\n-\n-        ¬´¬´¬´\n-        //// tab | Linux, macOS, Windows Bash\n-        Hello again\n-        ////\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        //// tab | Linux, macOS, Windows Bash\n-        Hallo wieder\n-        ////\n-        ¬ª¬ª¬ª\n-\n-\n-### Headings\n-\n-Every Markdown heading in the English text (all levels) ends with a part inside curly brackets. This part denotes the hash of this heading, which is used in links to this heading. In translations, translate the heading, but do not translate this hash part, so that links do not break.\n-\n-Examples of how to translate a heading:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        ## Alternative API docs { #alternative-api-docs }\n-        ¬ª¬ª¬ª\n-\n-    Result (Spanish):\n-\n-        ¬´¬´¬´\n-        ## Documentaci√≥n de la API alternativa { #alternative-api-docs }\n-        ¬ª¬ª¬ª\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        ### Example { #example }\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        ### Beispiel { #example }\n-        ¬ª¬ª¬ª\n-\n-\n-### Links\n-\n-Use the following rules for links (apply both to Markdown-style links ([text](url)) and to HTML-style <a> tags):\n-\n-1) For relative URLs, only translate link text. Do not translate the URL or its parts\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        [One of the fastest Python frameworks available](#performance)\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        [Eines der schnellsten verf√ºgbaren Python-Frameworks](#performance)\n-        ¬ª¬ª¬ª\n-\n-2) For absolute URLs which DO NOT start EXACTLY with ¬´https://fastapi.tiangolo.com¬ª, only translate link text and leave the URL unchanged.\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel docs</a>\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel-Dokumentation</a>\n-        ¬ª¬ª¬ª\n-\n-3) For absolute URLs which DO start EXACTLY with ¬´https://fastapi.tiangolo.com¬ª, only translate link text and change the URL by adding language code (¬´https://fastapi.tiangolo.com/{language_code}[rest part of the url]¬ª).\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <a href=\"https://fastapi.tiangolo.com/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentation</a>\n-        ¬ª¬ª¬ª\n-\n-    Result (Spanish):\n-\n-        ¬´¬´¬´\n-        <a href=\"https://fastapi.tiangolo.com/es/tutorial/path-params/#documentation\" class=\"external-link\" target=\"_blank\">Documentaci√≥n</a>\n-        ¬ª¬ª¬ª\n-\n-3.1) Do not add language codes for URLs that point to static assets (e.g., images, CSS, JavaScript).\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Something</a>\n-        ¬ª¬ª¬ª\n-\n-    Result (Spanish):\n-\n-        ¬´¬´¬´\n-        <a href=\"https://fastapi.tiangolo.com/img/something.jpg\" class=\"external-link\" target=\"_blank\">Algo</a>\n-        ¬ª¬ª¬ª\n-\n-4) For internal links, only translate link text.\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        [Create Pull Requests](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        [Pull Requests erzeugen](help-fastapi.md#create-a-pull-request){.internal-link target=_blank}\n-        ¬ª¬ª¬ª\n-\n-5) Do not translate anchor fragments in links (the part after ¬´#¬ª), as they must remain the same to work correctly.\n-\n-5.1) If an existing translation has a link with an anchor fragment different to the anchor fragment in the English source, then this is an error. Fix this by using the anchor fragment of the English source.\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        [Body - Multiple Parameters: Singular values in body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}\n-        ¬ª¬ª¬ª\n-\n-    Existing wrong translation (German) ‚Äì notice the wrongly translated anchor fragment:\n-\n-        ¬´¬´¬´\n-        [Body ‚Äì Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#einzelne-werte-im-body){.internal-link target=_blank}.\n-        ¬ª¬ª¬ª\n-\n-    Result (German) ‚Äì you fix the anchor fragment:\n-\n-        ¬´¬´¬´\n-        [Body ‚Äì Mehrere Parameter: Einfache Werte im Body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\n-        ¬ª¬ª¬ª\n-\n-5.2) Do not add anchor fragments at will, even if this makes sense. If the English source has no anchor, don't add one.\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        Create a [virtual environment](../virtual-environments.md){.internal-link target=_blank}\n-        ¬ª¬ª¬ª\n-\n-    Wrong translation (German) ‚Äì Anchor added to the URL.\n-\n-        ¬´¬´¬´\n-        Erstelle eine [virtuelle Umgebung](../virtual-environments.md#create-a-virtual-environment){.internal-link target=_blank}\n-        ¬ª¬ª¬ª\n-\n-    Good translation (German) ‚Äì URL stays like in the English source.\n-\n-        ¬´¬´¬´\n-        Erstelle eine [Virtuelle Umgebung](../virtual-environments.md){.internal-link target=_blank}\n-        ¬ª¬ª¬ª\n-\n-\n-### HTML abbr elements\n-\n-Translate HTML abbr elements (¬´<abbr title=\"description\">text</abbr>¬ª) as follows:\n-\n-1) If the text surrounded by the abbr element is an abbreviation (the text may be surrounded by further HTML or Markdown markup or quotes, for example ¬´<code>text</code>¬ª or ¬´`text`¬ª or ¬´\"text\"¬ª, ignore that further markup when deciding if the text is an abbreviation), and if the description (the text inside the title attribute) contains the full phrase for this abbreviation, then append a dash (¬´‚Äì¬ª) to the full phrase, followed by the translation of the full phrase.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{full phrase} ‚Äì {translation of full phrase}\">{abbreviation}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"Internet of Things\">IoT</abbr>\n-        <abbr title=\"Central Processing Unit\">CPU</abbr>\n-        <abbr title=\"too long; didn't read\"><strong>TL;DR:</strong></abbr>\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"Internet of Things ‚Äì Internet der Dinge\">IoT</abbr>\n-        <abbr title=\"Central Processing Unit ‚Äì Zentrale Verarbeitungseinheit\">CPU</abbr>\n-        <abbr title=\"too long; didn't read ‚Äì zu lang; hab's nicht gelesen\"><strong>TL;DR:</strong></abbr>\n-        ¬ª¬ª¬ª\n-\n-1.1) If the language to which you translate mostly uses the letters of the ASCII char set (for example Spanish, French, German, but not Russian, Chinese) and if the translation of the full phrase is identical to, or starts with the same letters as the original full phrase, then only give the translation of the full phrase.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{translation of full phrase}\">{abbreviation}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"JSON Web Tokens\">JWT</abbr>\n-        <abbr title=\"Enumeration\">Enum</abbr>\n-        <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr>\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"JSON Web Tokens\">JWT</abbr>\n-        <abbr title=\"Enumeration\">Enum</abbr>\n-        <abbr title=\"Asynchrones Server-Gateway-Interface\">ASGI</abbr>\n-        ¬ª¬ª¬ª\n-\n-2) If the description is not a full phrase for an abbreviation which the abbr element surrounds, but some other information, then just translate the description.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{description}\">{text}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{translation of description}\">{translation of text}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"also known as: endpoints, routes\">path</abbr>\n-        <abbr title=\"a program that checks for code errors\">linter</abbr>\n-        <abbr title=\"converting the string that comes from an HTTP request into Python data\">parsing</abbr>\n-        <abbr title=\"before 2023-03\">0.95.0</abbr>\n-        <abbr title=\"2023-08-26\">at the time of writing this</abbr>\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"auch bekannt als: Endpunkte, Routen\">Pfad</abbr>\n-        <abbr title=\"Programm das auf Fehler im Code pr√ºft\">Linter</abbr>\n-        <abbr title=\"Konvertieren des Strings eines HTTP-Requests in Python-Daten\">Parsen</abbr>\n-        <abbr title=\"vor 2023-03\">0.95.0</abbr>\n-        <abbr title=\"2023-08-26\">zum Zeitpunkt als das hier geschrieben wurde</abbr>\n-        ¬ª¬ª¬ª\n-\n-\n-3) If the text surrounded by the abbr element is an abbreviation and the description contains both the full phrase for that abbreviation, and other information, separated by a colon (¬´:¬ª), then append a dash (¬´‚Äì¬ª) and the translation of the full phrase to the original full phrase and translate the other information.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}: {other information}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{full phrase} ‚Äì {translation of full phrase}: {translation of other information}\">{abbreviation}</abbr>\n-\n-Examples:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"Input/Output: disk reading or writing, network communication.\">I/O</abbr>\n-        <abbr title=\"Content Delivery Network: service, that provides static files.\">CDN</abbr>\n-        <abbr title=\"Integrated Development Environment: similar to a code editor\">IDE</abbr>\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"Input/Output ‚Äì Eingabe/Ausgabe: Lesen oder Schreiben auf der Festplatte, Netzwerkkommunikation.\">I/O</abbr>\n-        <abbr title=\"Content Delivery Network ‚Äì Inhalte auslieferndes Netzwerk: Dienst, der statische Dateien bereitstellt.\">CDN</abbr>\n-        <abbr title=\"Integrated Development Environment ‚Äì Integrierte Entwicklungsumgebung: √Ñhnlich einem Code-Editor\">IDE</abbr>\n-        ¬ª¬ª¬ª\n-\n-3.1) Like in rule 2.1, you can leave the original full phrase away, if the translated full phrase is identical or starts with the same letters as the original full phrase.\n-\n-Conversion scheme:\n-\n-    Source (English):\n-\n-        <abbr title=\"{full phrase}: {information}\">{abbreviation}</abbr>\n-\n-    Result:\n-\n-        <abbr title=\"{translation of full phrase}: {translation of information}\">{abbreviation}</abbr>\n-\n-Example:\n-\n-    Source (English):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"Object Relational Mapper: a fancy term for a library where some classes represent SQL tables and instances represent rows in those tables\">ORM</abbr>\n-        ¬ª¬ª¬ª\n-\n-    Result (German):\n-\n-        ¬´¬´¬´\n-        <abbr title=\"Objektrelationaler Mapper: Ein Fachbegriff f√ºr eine Bibliothek, in der einige Klassen SQL-Tabellen und Instanzen Zeilen in diesen Tabellen darstellen\">ORM</abbr>\n-        ¬ª¬ª¬ª\n-\n-4) If there is an existing translation, and it has ADDITIONAL abbr elements in a sentence, and these additional abbr elements do not exist in the related sentence in the English text, then KEEP those additional abbr elements in the translation. Do not remove them. Except when you remove the whole sentence from the translation, because the whole sentence was removed from the English text, then also remove the abbr element. The reasoning for this rule is, that such additional abbr elements are manually added by the human editor of the translation, in order to translate or explain an English word to the human readers of the translation. These additional abbr elements would not make sense in the English text, but they do make sense in the translation. So keep them in the translation, even though they are not part of the English text. This rule only applies to abbr elements.\n-\n-5) Apply above rules also when there is an existing translation! Make sure that all title attributes in abbr elements get properly translated or updated, using the schemes given above. However, leave the ADDITIONAL abbr's from rule 4 alone. Do not change their formatting or content.\n-\n-\"\"\"\n+general_prompt_path = Path(__file__).absolute().parent / \"llm-general-prompt.md\"\n\n```", "output": "There appears to be a typo. The filename should be `general-llm-prompt.md`.", "source": "pr_review", "type": "inline_review", "pr_number": 449}
{"instruction": "Review the following code changes: üìù Add contribution instructions about LLM generated code and comments and automated tools for PRs", "input": "```diff\n@@ -41,11 +41,15 @@ jobs:\n                 \"message\": \"As this PR has been waiting for the original user for a while but seems to be inactive, it's now going to be closed. But if there's anyone interested, feel free to create a new PR.\",\n                 \"reminder\": {\n                     \"before\": \"P3D\",\n-                    \"message\": \"Heads-up: this will be closed in 3 days unless there‚Äôs new activity.\"\n+                    \"message\": \"Heads-up: this will be closed in 3 days unless there's new activity.\"\n                 }\n               },\n               \"invalid\": {\n                 \"delay\": 0,\n                 \"message\": \"This was marked as invalid and will be closed now. If this is an error, please provide additional details.\"\n+              },\n+              \"maybe-ai\": {\n+                \"delay\": 0,\n+                \"message\": \"This was marked as potentially AI generated and will be closed now. If this is an error, please provide additional details, make sure to read the docs about contributing and AI.\"\n               }\n             }\n\n```\n\n```diff\n@@ -219,3 +219,39 @@ Once there are several people in the discussion, the FastAPI team can evaluate i\n Then the docs will be automatically translated using LLMs, and the team of native speakers can review the translation, and help tweak the LLM prompts.\n \n Once there's a new translation, for example if docs are updated or there's a new section, there will be a comment in the same discussion with the link to the new translation to review.\n+\n+## Automated Code and AI\n+\n+You are encouraged to use all the tools you want to do your work and contribute as efficiently as possible, this includes AI (LLM) tools, etc. Nevertheless, contributions should have meaningful human intervention, judgement, context, etc.\n+\n+If the **human effort** put in a PR, e.g. writing LLM prompts, is **less** than the **effort we would need to put** to **review it**, please **don't** submit the PR.\n+\n+Think of it this way: we can already write LLM prompts or run automated tools ourselves, and that would be faster than reviewing external PRs.\n+\n+### Closing Automated and AI PRs\n+\n+If we see PRs that seem AI generated or automated in similar ways, we'll flag them and close them.\n+\n+The same applies to comments and descriptions, please don't copy paste the content generated by an LLM.\n+\n+### Human Effort Denial of Service\n+\n+Using automated tools and AI to submit PRs or comments that we have to carefully review and handle would be the equivalent of a <a href=\"https://en.wikipedia.org/wiki/Denial-of-service_attack\" class=\"external-link\" target=\"_blank\">Denial-of-service attack</a> on our human effort.\n+\n+It would be very little effort from the person submitting the PR (an LLM prompt) that generates a large amount of effort on our side (carefully reviewing code).\n+\n+Please don't do that.\n+\n+We'll need to block accounts that spam us with repeated automated PRs or comments.\n+\n+### Use Tools Wisely\n+\n+As Uncle Ben said:\n+\n+<blockquote>\n+With great <strike>power</strike> <strong>tools</strong> comes great responsibility.\n+</blockquote>\n+\n+Avoid inadvertently doing harm.\n+\n+You have amazing tools at hand, use them wisely to help effectively.\n\n```\n\n```diff\n@@ -122,6 +122,8 @@ For these language translation PRs, confirm that:\n \n * If a PR seems to be spam, meaningless, only to change statistics (to appear as \"contributor\") or similar, you can simply mark it as `invalid`, and it will be automatically closed.\n \n+* If a PR seems to be AI generated, and seems like reviewing it would take more time from you than the time it took to write the prompt, mark it as `maybe-ai`, and it will be automatically closed.\n+\n * A PR should have a specific use case that it is solving.\n \n * If the PR is for a feature, it should have docs.\n\n```", "output": "Changes look good. This PR implements: üìù Add contribution instructions about LLM generated code and comments and automated tools for PRs", "source": "pr", "type": "code_review", "pr_number": 448}
{"instruction": "Review the following code changes: Add example for API Key header configuration", "input": "```diff\n@@ -0,0 +1,14 @@\n+from fastapi import FastAPI, Header, HTTPException, Depends\n+\n+app = FastAPI()\n+\n+API_KEY = \"mysecretapikey\"\n+\n+def get_api_key(x_api_key: str = Header(...)):\n+    if x_api_key != API_KEY:\n+        raise HTTPException(status_code=401, detail=\"Invalid API Key\")\n+    return x_api_key\n+\n+@app.get(\"/secure-data\")\n+def read_secure_data(api_key: str = Depends(get_api_key)):\n+    return {\"message\": \"This is secure data\"}\n\n```", "output": "Changes look good. This PR implements: Add example for API Key header configuration", "source": "pr", "type": "code_review", "pr_number": 447}
{"instruction": "Review the following code changes: ‚¨Ü Bump ruff from 0.14.3 to 0.14.10", "input": "```diff\n@@ -1,4 +1,4 @@\n # For mkdocstrings and tests\n httpx >=0.23.0,<1.0.0\n # For linting and generating docs versions\n-ruff ==0.14.3\n+ruff ==0.14.10\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump ruff from 0.14.3 to 0.14.10", "source": "pr", "type": "code_review", "pr_number": 446}
{"instruction": "Review the following code changes: ‚¨Ü Bump mkdocs-material from 9.7.0 to 9.7.1", "input": "```diff\n@@ -1,6 +1,6 @@\n -e .\n -r requirements-docs-tests.txt\n-mkdocs-material==9.7.0\n+mkdocs-material==9.7.1\n mdx-include >=1.4.1,<2.0.0\n mkdocs-redirects>=1.2.1,<1.3.0\n typer == 0.16.0\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump mkdocs-material from 9.7.0 to 9.7.1", "source": "pr", "type": "code_review", "pr_number": 445}
{"instruction": "Review the following code changes: ‚¨Ü Bump sqlmodel from 0.0.27 to 0.0.31", "input": "```diff\n@@ -4,7 +4,7 @@ pytest >=7.1.3,<9.0.0\n coverage[toml] >= 6.5.0,< 8.0\n mypy ==1.14.1\n dirty-equals ==0.9.0\n-sqlmodel==0.0.27\n+sqlmodel==0.0.31\n flask >=1.1.2,<4.0.0\n strawberry-graphql >=0.200.0,< 1.0.0\n anyio[trio] >=3.2.1,<5.0.0\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump sqlmodel from 0.0.27 to 0.0.31", "source": "pr", "type": "code_review", "pr_number": 444}
{"instruction": "Fix the following bug: docs: fix incorrect description of Header parameter conversion", "input": "Corrected the explanation of how Header converts parameter names.", "output": "```diff\n@@ -38,7 +38,7 @@ Most of the standard headers are separated by a \"hyphen\" character, also known a\n \n But a variable like `user-agent` is invalid in Python.\n \n-So, by default, `Header` will convert the parameter names characters from underscore (`_`) to hyphen (`-`) to extract and document the headers.\n+So, by default, `Header` will convert the parameter names characters from hyphen (`-`) to underscore (`_`) to extract and document the headers.\n \n Also, HTTP headers are case-insensitive, so, you can declare them with standard Python style (also known as \"snake_case\").\n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 443}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -38,7 +38,7 @@ Most of the standard headers are separated by a \"hyphen\" character, also known a\n \n But a variable like `user-agent` is invalid in Python.\n \n-So, by default, `Header` will convert the parameter names characters from underscore (`_`) to hyphen (`-`) to extract and document the headers.\n+So, by default, `Header` will convert the parameter names characters from hyphen (`-`) to underscore (`_`) to extract and document the headers.\n \n Also, HTTP headers are case-insensitive, so, you can declare them with standard Python style (also known as \"snake_case\").\n \n\n```", "output": "Bug: docs: fix incorrect description of Header parameter conversion\n\nCorrected the explanation of how Header converts parameter names.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 443}
{"instruction": "Review the following code changes: docs: fix incorrect description of Header parameter conversion", "input": "```diff\n@@ -38,7 +38,7 @@ Most of the standard headers are separated by a \"hyphen\" character, also known a\n \n But a variable like `user-agent` is invalid in Python.\n \n-So, by default, `Header` will convert the parameter names characters from underscore (`_`) to hyphen (`-`) to extract and document the headers.\n+So, by default, `Header` will convert the parameter names characters from hyphen (`-`) to underscore (`_`) to extract and document the headers.\n \n Also, HTTP headers are case-insensitive, so, you can declare them with standard Python style (also known as \"snake_case\").\n \n\n```", "output": "Changes look good. This PR implements: docs: fix incorrect description of Header parameter conversion", "source": "pr", "type": "code_review", "pr_number": 443}
{"instruction": "Review the following code changes: feature: Infer response model from function return AST", "input": "```diff\n@@ -21,6 +21,7 @@\n     Tuple,\n     Type,\n     Union,\n+    get_args,\n )\n \n from annotated_doc import Doc\n@@ -57,6 +58,7 @@\n     create_model_field,\n     generate_unique_id,\n     get_value_or_default,\n+    infer_response_model_from_ast,\n     is_body_allowed_for_status_code,\n )\n from pydantic import BaseModel\n@@ -121,6 +123,18 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n     return app\n \n \n+def _contains_response(annotation: Any) -> bool:\n+    if lenient_issubclass(annotation, Response):\n+        return True\n+\n+    args = get_args(annotation)\n+    for arg in args:\n+        if _contains_response(arg):\n+            return True\n+\n+    return False\n+\n+\n # Copy of starlette.routing.websocket_session modified to include the\n # dependencies' AsyncExitStack\n def websocket_session(\n@@ -544,6 +558,17 @@ def __init__(\n                 response_model = None\n             else:\n                 response_model = return_annotation\n+                if response_model is None or (\n+                    not lenient_issubclass(response_model, BaseModel)\n+                    and not dataclasses.is_dataclass(response_model)\n+                ):\n+                    if return_annotation is not None and not _contains_response(\n+                        return_annotation\n+                    ):\n+                        inferred = infer_response_model_from_ast(endpoint)\n+                        if inferred:\n+                            response_model = inferred\n+\n         self.response_model = response_model\n         self.summary = summary\n         self.response_description = response_description\n\n```\n\n```diff\n@@ -1,10 +1,13 @@\n+import ast\n+import inspect\n import re\n import warnings\n from dataclasses import is_dataclass\n from typing import (\n     TYPE_CHECKING,\n     Any,\n     Dict,\n+    List,\n     MutableMapping,\n     Optional,\n     Set,\n@@ -28,6 +31,7 @@\n     may_v1,\n )\n from fastapi.datastructures import DefaultPlaceholder, DefaultType\n+from fastapi.logger import logger\n from pydantic import BaseModel\n from pydantic.fields import FieldInfo\n from typing_extensions import Literal\n@@ -258,3 +262,233 @@ def get_value_or_default(\n         if not isinstance(item, DefaultPlaceholder):\n             return item\n     return first_item\n+\n+\n+def _infer_type_from_ast(\n+    node: ast.AST,\n+    func_def: Union[ast.FunctionDef, ast.AsyncFunctionDef],\n+    context_name: str,\n+) -> Any:\n+    if isinstance(node, ast.Constant):\n+        return type(node.value)\n+\n+    if isinstance(node, ast.List):\n+        if not node.elts:\n+            return List[Any]\n+\n+        first_type = _infer_type_from_ast(node.elts[0], func_def, context_name + \"Item\")\n+\n+        for elt in node.elts[1:]:\n+            current_type = _infer_type_from_ast(elt, func_def, context_name + \"Item\")\n+            if current_type != first_type:\n+                return List[Any]\n+\n+        if first_type is not Any:\n+            return List[first_type]  # type: ignore\n+        return List[Any]\n+\n+    if isinstance(node, ast.BinOp):\n+        left_type = _infer_type_from_ast(node.left, func_def, context_name)\n+        right_type = _infer_type_from_ast(node.right, func_def, context_name)\n+        if left_type == right_type and left_type in (int, float, str):\n+            return left_type\n+        if {left_type, right_type} == {int, float}:\n+            return float\n+\n+    if isinstance(node, ast.Compare):\n+        return bool\n+\n+    if isinstance(node, ast.Dict):\n+        fields = {}\n+        for key, value in zip(node.keys, node.values):\n+            if not isinstance(key, ast.Constant):\n+                continue\n+            field_name = key.value\n+            field_type = _infer_type_from_ast(\n+                value, func_def, context_name + \"_\" + str(field_name)\n+            )\n+            fields[field_name] = (field_type, ...)\n+\n+        if not fields:\n+            return Dict[str, Any]\n+\n+        if PYDANTIC_V2:\n+            from pydantic import create_model\n+        else:\n+            from fastapi._compat.v1 import create_model\n+\n+        return create_model(f\"Model_{context_name}\", **fields)  # type: ignore[call-overload]\n+\n+    if isinstance(node, ast.Name):\n+        arg_name = node.id\n+        for arg in func_def.args.args:\n+            if arg.arg != arg_name:\n+                continue\n+\n+            if not arg.annotation:\n+                continue\n+\n+            if not isinstance(arg.annotation, ast.Name):\n+                continue\n+\n+            annotation_id = arg.annotation.id\n+            if annotation_id == \"int\":\n+                return int\n+            if annotation_id == \"str\":\n+             \n\n```\n\n```diff\n@@ -0,0 +1,522 @@\n+from typing import Any, Dict, List, Union\n+from unittest.mock import patch\n+\n+import pytest\n+from fastapi import FastAPI, Response\n+from fastapi.responses import JSONResponse\n+from fastapi.testclient import TestClient\n+from fastapi.utils import infer_response_model_from_ast\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/users/{user_id}\")", "output": "Code Review for: feature: Infer response model from function return AST\n\nüìù **fastapi/utils.py**: This case (and quite a few other cases) makes use of the [Arrow Anti Pattern](https://wiki.c2.com/?ArrowAntiPattern), which renders the code quite a bit less readable! In this case, it'd be better to replace these nested conditionals with guard clauses. For example, at `if isinstance(node, ast.Name)`:\n\nüìù **tests/test_ast_inference.py**: I note that in some of these tests, you have a single test function for a single case, but in some functions such as this, you group them all together. Why the disparity?\n\nüìù **fastapi/utils.py**: Updated the code and rewrote this part using guard clauses - it‚Äôs much cleaner now. Thanks for the Arrow Anti-Pattern link, that was really helpful!\r\n```Python\r\n    if isinstance(node, ast.Name):\r\n        arg_name = node.id\r\n        for arg in func_def.args.args:\r\n            if arg.arg != arg_name:\r\n                continue\r\n\r\n            if not arg.annotation:\r\n                continue\r\n\r\n            if not isinstance(arg.annotation, ast.Name):\r\n                continue\r\n\r\n            annotation_id = arg.annotation.id\r\n            if annotation_id == \"int\":\r\n                return int\r\n            if annotation_id == \"str\":\r\n                return str\r\n            if annotation_id == \"bool\":\r\n                return bool\r\n            if annotation_id == \"float\":\r\n                return float\r\n            if annotation_id == \"list\":\r\n                return List[Any]\r\n            if annotation_id == \"dict\":\r\n                return Dict[str, Any]\r\n\r\n    return Any\r\n```\n\nüìù **tests/test_ast_inference.py**: The code has been fixed. The edge cases are now split into separate parameterized tests:\r\n\r\ntest_infer_response_model_returns_none - for cases returning None\r\ntest_infer_response_model_success - for successful cases with field validation\r\n\r\nThe concern is no longer applicable. Thanks for pointing this out - the test structure has been improved.\n\n", "source": "pr", "type": "code_review", "pr_number": 442}
{"instruction": "Review this code change in `fastapi/utils.py`", "input": "```diff\n@@ -258,3 +261,189 @@ def get_value_or_default(\n         if not isinstance(item, DefaultPlaceholder):\n             return item\n     return first_item\n+\n+\n+def _infer_type_from_ast(\n+    node: ast.AST,\n+    func_def: Union[ast.FunctionDef, ast.AsyncFunctionDef],\n+    context_name: str,\n+) -> Any:\n+    if isinstance(node, ast.Constant):\n+        return type(node.value)\n+\n+    if isinstance(node, ast.List):\n+        if not node.elts:\n+            return List[Any]\n+\n+        first_type = _infer_type_from_ast(node.elts[0], func_def, context_name + \"Item\")\n+\n+        for elt in node.elts[1:]:\n+            current_type = _infer_type_from_ast(elt, func_def, context_name + \"Item\")\n+            if current_type != first_type:\n+                return List[Any]\n+\n+        if first_type is not Any:\n+            return List[first_type]  # type: ignore\n+        return List[Any]\n+\n+    if isinstance(node, ast.BinOp):\n+        left_type = _infer_type_from_ast(node.left, func_def, context_name)\n+        right_type = _infer_type_from_ast(node.right, func_def, context_name)\n+        if left_type == right_type and left_type in (int, float, str):\n+            return left_type\n+        if {left_type, right_type} == {int, float}:\n+            return float\n+\n+    if isinstance(node, ast.Compare):\n+        return bool\n+\n+    if isinstance(node, ast.Dict):\n+        fields = {}\n+        for key, value in zip(node.keys, node.values):\n+            if not isinstance(key, ast.Constant):\n+                continue\n+            field_name = key.value\n+            field_type = _infer_type_from_ast(\n+                value, func_def, context_name + \"_\" + str(field_name)\n+            )\n+            fields[field_name] = (field_type, ...)\n+\n+        if not fields:\n+            return Dict[str, Any]\n+\n+        if PYDANTIC_V2:\n+            from pydantic import create_model\n+        else:\n+            from pydantic import create_model\n+\n+        return create_model(f\"Model_{context_name}\", **fields)  # type: ignore[call-overload]\n+\n+    if isinstance(node, ast.Name):\n+        arg_name = node.id\n+        for arg in func_def.args.args:\n+            if arg.arg == arg_name and arg.annotation:\n+                if isinstance(arg.annotation, ast.Name):\n+                    if arg.annotation.id == \"int\":\n\n```", "output": "This case (and quite a few other cases) makes use of the [Arrow Anti Pattern](https://wiki.c2.com/?ArrowAntiPattern), which renders the code quite a bit less readable! In this case, it'd be better to replace these nested conditionals with guard clauses. For example, at `if isinstance(node, ast.Name)`:", "source": "pr_review", "type": "inline_review", "pr_number": 442}
{"instruction": "Review this code change in `tests/test_ast_inference.py`", "input": "```diff\n@@ -0,0 +1,441 @@\n+from typing import Any, Dict, List, Union\n+\n+from fastapi import FastAPI, Response\n+from fastapi.responses import JSONResponse\n+from fastapi.testclient import TestClient\n+from fastapi.utils import infer_response_model_from_ast\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/users/{user_id}\")\n+async def get_user(user_id: int) -> Dict[str, Any]:\n+    user: Dict[str, Any] = {\n+        \"id\": user_id,\n+        \"username\": \"example\",\n+        \"email\": \"user@example.com\",\n+        \"age\": 25,\n+        \"is_active\": True,\n+    }\n+    return user\n+\n+\n+@app.get(\"/orders/{order_id}\")\n+async def get_order_details(order_id: str) -> Dict[str, Any]:\n+    order_data: Dict[str, Any] = {\n+        \"order_id\": order_id,\n+        \"status\": \"processing\",\n+        \"total_amount\": 150.50,\n+        \"tags\": [\"urgent\", \"new_customer\"],\n+        \"customer_info\": {\n+            \"name\": \"John Doe\",\n+            \"vip_status\": False,\n+            \"preferences\": {\"notifications\": True, \"theme\": \"dark\"},\n+        },\n+        \"items\": [\n+            {\n+                \"item_id\": 1,\n+                \"name\": \"Laptop Stand\",\n+                \"price\": 45.00,\n+                \"in_stock\": True,\n+            },\n+        ],\n+        \"metadata\": None,\n+    }\n+    return order_data\n+\n+\n+@app.get(\"/edge_cases/mixed_types\")\n+async def get_mixed_types() -> Dict[str, Any]:\n+    return {\"mixed_list\": [1, \"two\", 3.0], \"description\": \"List starting with int\"}\n+\n+\n+@app.get(\"/edge_cases/expressions\")\n+async def get_expressions() -> Dict[str, Any]:\n+    return {\"calc_int\": 10 + 5, \"calc_str\": \"foo\" + \"bar\", \"calc_bool\": 5 > 3}\n+\n+\n+@app.get(\"/edge_cases/empty_structures\")\n+async def get_empty_structures() -> Dict[str, Any]:\n+    return {\"empty_list\": [], \"empty_dict\": {}}\n+\n+\n+@app.get(\"/edge_cases/local_variable\")\n+async def get_local_variable() -> Dict[str, Any]:\n+    response_data = {\"status\": \"ok\", \"nested\": {\"check\": True}}\n+    return response_data\n+\n+\n+@app.get(\"/edge_cases/explicit_response\")\n+def get_explicit_response() -> JSONResponse:\n+    return JSONResponse({\"should_not_be_inferred\": True})\n+\n+\n+@app.get(\"/edge_cases/nested_function\")\n+async def get_nested_function() -> Dict[str, Any]:\n+    def inner_function():\n+        return {\"inner\": \"value\"}\n+\n+    return {\"outer\": \"value\"}\n+\n+\n+@app.get(\"/edge_cases/invalid_keys\")\n+def get_invalid_keys() -> Dict[Any, Any]:\n+    return {1: \"value\", \"valid\": \"key\"}\n+\n+\n+class FakeDB:\n+    def get_user(self) -> Dict[str, Any]:\n+        return {\"id\": 1, \"username\": \"db_user\"}\n+\n+\n+fake_db = FakeDB()\n+\n+\n+@app.get(\"/db/direct_return\")\n+def get_db_direct() -> Dict[str, Any]:\n+    return fake_db.get_user()\n+\n+\n+@app.get(\"/db/dict_construction\")\n+def get_db_constructed() -> Dict[str, Any]:\n+    data = fake_db.get_user()\n+    return {\"db_id\": data[\"id\"], \"source\": \"database\"}\n+\n+\n+# Test for homogeneous list type inference\n+@app.get(\"/edge_cases/homogeneous_list\")\n+def get_homogeneous_list() -> Dict[str, Any]:\n+    return {\"numbers\": [1, 2, 3], \"strings\": [\"a\", \"b\", \"c\"]}\n+\n+\n+# Test for int/float binary operation\n+@app.get(\"/edge_cases/int_float_binop\")\n+def get_int_float_binop() -> Dict[str, Any]:\n+    return {\"result\": 10 + 5.5, \"int_result\": 10 + 5}\n+\n+\n+# Test for argument with different type annotations\n+@app.get(\"/edge_cases/arg_types/{a}\")\n+def get_arg_types(a: int, b: str, c: bool, d: float) -> Dict[str, Any]:\n+    return {\"int_val\": a, \"str_val\": b, \"bool_val\": c, \"float_val\": d}\n+\n+\n+client = TestClient(app)\n+\n+\n+# Module-level functions for testing infer_response_model_from_ast\n+# (nested functions don't work with inspect.getsource)\n+def _test_no_return_func() -> Dict[str, Any]:\n+    x = {\"a\": 1}  # noqa: F841\n+\n+\n+def _test_returns_call() -> Dict[str, Any]:\n+    return dict(a=1)\n+\n+\n+def _test_returns_empty_dict() -> Dict[str, Any]:\n+    return {}\n+\n+\n+def _test_returns_dict_literal() -> Dict[str, Any]:\n+    return {\"name\": \"test\", \"value\": 123}\n+\n+\n+def _test_returns_variable() -> Dict[str, Any]:\n+    data = {\"status\": \"ok\"}\n+    return data\n+\n+\n+def _test_returns_annotated_var() -> Dict[str, Any]:\n+    data: Dict[str, Any] = {\"status\": \"ok\", \"count\": 42}\n+    return data\n+\n+\n+def _test_func_mixed(item: int) -> Dict[str, Any]:\n+    return {\"typed_field\": item, \"literal_field\": \"hello\"}\n+\n+\n+def _test_list_with_any_elements(x: Any) -> Dict[str, Any]:\n+    return {\"items\": [x]}\n+\n+\n+def _test_non_constant_key() -> Dict[str, Any]:\n+    key = \"dynamic\"\n+    return {key: \"value\", \"static\": \"ok\"}\n+\n+\n+def _test_list_arg(items: list) -> Dict[str, Any]:\n+    return {\"items_val\": items}\n+\n+\n+def _test_dict_arg(data: dict) -> Dict[str, Any]:\n+    return {\"data_val\": data}\n+\n+\n+def _test_nested_dict() -> Dict[str, Any]:\n+    return {\"nested\": {\"inner\": \"value\"}}\n+\n+\n+# Nested dict with variable key - should trigger line 304 in _infer_type_from_ast\n+def _test_nested_dict_with_var_key() -> Dict[str, Any]:\n+    key = \"dynamic\"\n+    return {\"nested\": {key: \"value\", \"static\": \"ok\"}}\n+\n+\n+# Test function where all returned dict values are unannotated variables (resolve to Any)\n+some_global_var = \"global\"\n+another_global = 123\n+\n+\n+def _test_all_any_fields() -> Dict[str, Any]:\n+    local_var = \"local\"\n+    return {\"field1\": local_var, \"field2\": some_global_var, \"field3\": another_global}\n+\n+\n+# Test function with field name that could cause model creation issues\n+def _test_invalid_field_name() -> Dict[str, Any]:\n+    return {\"__class__\": \"invalid\", \"normal\": \"ok\"}\n+\n+\n+def test_openapi_schema_ast_inference():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200\n+    schema = response.json()\n+    paths = schema[\"paths\"]\n+\n+    user_schema = paths[\"/users/{user_id}\"][\"get\"][\"responses\"][\"200\"][\"content\"][\n+        \"application/json\"\n+    ][\"schema\"]\n+    assert \"$ref\" in user_schema\n+    ref_name = user_schema[\"$ref\"].split(\"/\")[-1]\n+    user_props = schema[\"components\"][\"schemas\"][ref_name][\"properties\"]\n+\n+    assert user_props[\"id\"][\"type\"] == \"integer\"\n+    assert user_props[\"username\"][\"type\"] == \"string\"\n+    assert user_props[\"is_active\"][\"type\"] == \"boolean\"\n+\n+    order_schema = paths[\"/orders/{order_id}\"][\"get\"][\"responses\"][\"200\"][\"content\"][\n+        \"application/json\"\n+    ][\"schema\"]\n+    assert \"$ref\" in order_schema\n+    order_ref = order_schema[\"$ref\"].split(\"/\")[-1]\n+    order_props = schema[\"components\"][\"schemas\"][order_ref][\"properties\"]\n+\n+    items_prop = order_props[\"items\"]\n+    assert items_prop[\"type\"] == \"array\"\n+    assert \"$ref\" in items_prop[\"items\"]\n+\n+    customer_prop = order_props[\"customer_info\"]\n+    assert \"$ref\" in customer_prop\n+\n+    mixed_schema = paths[\"/edge_cases/mixed_types\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    mixed_ref = mixed_schema[\"$ref\"].split(\"/\")[-1]\n+    mixed_props = schema[\"components\"][\"schemas\"][mixed_ref][\"properties\"]\n+    assert mixed_props[\"mixed_list\"][\"type\"] == \"array\"\n+\n+    expr_schema = paths[\"/edge_cases/expressions\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    expr_ref = expr_schema[\"$ref\"].split(\"/\")[-1]\n+    expr_props = schema[\"components\"][\"schemas\"][expr_ref][\"properties\"]\n+\n+    assert expr_props[\"calc_int\"][\"type\"] == \"integer\"\n+    assert expr_props[\"calc_bool\"][\"type\"] == \"boolean\"\n+\n+    explicit_schema = paths[\"/edge_cases/explicit_response\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    assert \"$ref\" not in explicit_schema\n+\n+    nested_schema = paths[\"/edge_cases/nested_function\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    assert \"$ref\" in nested_schema\n+    nested_ref = nested_schema[\"$ref\"].split(\"/\")[-1]\n+    nested_props = schema[\"components\"][\"schemas\"][nested_ref][\"properties\"]\n+    assert \"outer\" in nested_props\n+    assert \"inner\" not in nested_props\n+\n+    invalid_keys_schema = paths[\"/edge_cases/invalid_keys\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    assert \"$ref\" not in invalid_keys_schema\n+\n+    db_direct_schema = paths[\"/db/direct_return\"][\"get\"][\"responses\"][\"200\"][\"content\"][\n+        \"application/json\"\n+    ][\"schema\"]\n+    assert \"$ref\" not in db_direct_schema\n+\n+    db_constructed_schema = paths[\"/db/dict_construction\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    assert \"$ref\" in db_constructed_schema\n+    db_constructed_ref = db_constructed_schema[\"$ref\"].split(\"/\")[-1]\n+    db_constructed_props = schema[\"components\"][\"schemas\"][db_constructed_ref][\n+        \"properties\"\n+    ]\n+\n+    assert db_constructed_props[\"source\"][\"type\"] == \"string\"\n+    assert (\n+        \"type\" not in db_constructed_props[\"db_id\"]\n+        or db_constructed_props[\"db_id\"] == {}\n+    )\n+\n+    # Test homogeneous list inference\n+    homogeneous_schema = paths[\"/edge_cases/homogeneous_list\"][\"get\"][\"responses\"][\n+        \"200\"\n+    ][\"content\"][\"application/json\"][\"schema\"]\n+    assert \"$ref\" in homogeneous_schema\n+    homogeneous_ref = homogeneous_schema[\"$ref\"].split(\"/\")[-1]\n+    homogeneous_props = schema[\"components\"][\"schemas\"][homogeneous_ref][\"properties\"]\n+    assert homogeneous_props[\"numbers\"][\"type\"] == \"array\"\n+    assert homogeneous_props[\"strings\"][\"type\"] == \"array\"\n+\n+    # Test int/float binary operation\n+    binop_schema = paths[\"/edge_cases/int_float_binop\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    assert \"$ref\" in binop_schema\n+    binop_ref = binop_schema[\"$ref\"].split(\"/\")[-1]\n+    binop_props = schema[\"components\"][\"schemas\"][binop_ref][\"properties\"]\n+    assert binop_props[\"result\"][\"type\"] == \"number\"\n+    assert binop_props[\"int_result\"][\"type\"] == \"integer\"\n+\n+    # Test argument type annotations\n+    arg_types_schema = paths[\"/edge_cases/arg_types/{a}\"][\"get\"][\"responses\"][\"200\"][\n+        \"content\"\n+    ][\"application/json\"][\"schema\"]\n+    assert \"$ref\" in arg_types_schema\n+    arg_types_ref = arg_types_schema[\"$ref\"].split(\"/\")[-1]\n+    arg_types_props = schema[\"components\"][\"schemas\"][arg_types_ref][\"properties\"]\n+    assert arg_types_props[\"int_val\"][\"type\"] == \"integer\"\n+    assert arg_types_props[\"str_val\"][\"type\"] == \"string\"\n+    assert arg_types_props[\"bool_val\"][\"type\"] == \"boolean\"\n+    assert arg_types_props[\"float_val\"][\"type\"] == \"number\"\n+\n+\n+def test_infer_response_model_edge_cases() -> None:\n+    \"\"\"Test edge cases for infer_response_model_from_ast function.\"\"\"\n+\n+    # Test function without return statement\n+    result = infer_response_model_from_ast(_test_no_return_func)\n+    assert result is None\n+\n+    # Test function returning a function call (not dict literal)\n+    result = infer_response_model_from_ast(_test_returns_call)\n+    assert result is None\n+\n+    # Test function with empty dict\n+    result = infer_response_model_from_ast(_test_returns_empty_dict)\n+    assert result is None\n+\n+    # Test function with dict literal\n+    result = infer_response_model_from_ast(_test_returns_dict_literal)\n+    assert result is not None\n+    assert \"name\" in result.__annotations__\n+    assert \"value\" in result.__annotations__\n+\n+    # Test lambda (cannot get source)\n+    result = infer_response_model_from_ast(lambda: {\"a\": 1})\n+    assert result is None\n+\n+    # Test built-in function (cannot get source)\n+    result = infer_response_model_from_ast(len)\n+    assert result is None\n+\n+    # Test function with variable return\n+    result = infer_response_model_from_ast(_test_returns_variable)\n+    assert result is not None\n+    assert \"status\" in result.__annotations__\n+\n+    # Test function with annotated assignment\n+    result = infer_response_model_from_ast(_test_returns_annotated_var)\n+    assert result is not None\n+    assert \"status\" in result.__annotations__\n+    assert \"count\" in result.__annotations__\n+\n+\n+def test_infer_response_model_all_any_fields() -> None:\n+    \"\"\"Test that model is NOT created when all fields are Any.\"\"\"\n+    # Use module-level function where all values are unannotated variables\n+    # This should result in all fields being Any\n+    result = infer_response_model_from_ast(_test_all_any_fields)\n+    # Should return None because all fields are Any\n+    assert result is None\n+\n+\n+def test_infer_response_model_mixed_any_and_typed() -> None:\n+    \"\"\"Test that model IS created when some fields have types.\"\"\"\n+    result = infer_response_model_from_ast(_test_func_mixed)\n+    # Should create model because \"literal_field\" is str, not Any\n+    assert result is not None\n+    assert \"typed_field\" in result.__annotations__\n+    assert \"literal_field\" in result.__annotations__\n+\n+\n+def test_infer_type_from_ast_edge_cases() -> None:\n+    \"\"\"Test edge cases for _infer_type_from_ast function.\"\"\"\n\n```", "output": "I note that in some of these tests, you have a single test function for a single case, but in some functions such as this, you group them all together. Why the disparity?", "source": "pr_review", "type": "inline_review", "pr_number": 442}
{"instruction": "Fix the following bug: Fix: Make Basic Auth realm required per RFC 7235", "input": "Fixes #13471", "output": "```diff\n@@ -3,7 +3,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -154,13 +154,13 @@ def __init__(\n             ),\n         ] = None,\n         realm: Annotated[\n-            Optional[str],\n+            str,\n             Doc(\n                 \"\"\"\n                 HTTP Basic authentication realm.\n                 \"\"\"\n             ),\n-        ] = None,\n+        ],\n         description: Annotated[\n             Optional[str],\n             Doc(\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from fastapi import Depends, FastAPI\n+from fastapi.security import HTTPBasic, HTTPBasicCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+security = HTTPBasic(realm=\"\")\n+\n+\n+@app.get(\"/users/me\")\n+def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):\n+    return {\"username\": credentials.username, \"password\": credentials.password}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_security_http_basic_empty_realm():\n+    response = client.get(\"/users/me\", auth=(\"john\", \"secret\"))\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"username\": \"john\", \"password\": \"secret\"}\n+\n+\n+def test_security_http_basic_invalid_credentials_empty_realm():\n+    response = client.get(\n+        \"/users/me\", headers={\"Authorization\": \"Basic notabase64token\"}\n+    )\n+    assert response.status_code == 401, response.text\n+    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert response.json() == {\"detail\": \"Invalid authentication credentials\"}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 441}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -3,7 +3,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -154,13 +154,13 @@ def __init__(\n             ),\n         ] = None,\n         realm: Annotated[\n-            Optional[str],\n+            str,\n             Doc(\n                 \"\"\"\n                 HTTP Basic authentication realm.\n                 \"\"\"\n             ),\n-        ] = None,\n+        ],\n         description: Annotated[\n             Optional[str],\n             Doc(\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from fastapi import Depends, FastAPI\n+from fastapi.security import HTTPBasic, HTTPBasicCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+security = HTTPBasic(realm=\"\")\n+\n+\n+@app.get(\"/users/me\")\n+def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):\n+    return {\"username\": credentials.username, \"password\": credentials.password}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_security_http_basic_empty_realm():\n+    response = client.get(\"/users/me\", auth=(\"john\", \"secret\"))\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"username\": \"john\", \"password\": \"secret\"}\n+\n+\n+def test_security_http_basic_invalid_credentials_empty_realm():\n+    response = client.get(\n+        \"/users/me\", headers={\"Authorization\": \"Basic notabase64token\"}\n+    )\n+    assert response.status_code == 401, response.text\n+    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert response.json() == {\"detail\": \"Invalid authentication credentials\"}\n\n```", "output": "Bug: Fix: Make Basic Auth realm required per RFC 7235\n\nFixes #13471", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 441}
{"instruction": "Review the following code changes: Fix: Make Basic Auth realm required per RFC 7235", "input": "```diff\n@@ -3,7 +3,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -5,7 +5,7 @@\n \n app = FastAPI()\n \n-security = HTTPBasic()\n+security = HTTPBasic(realm=\"simple\")\n \n \n @app.get(\"/users/me\")\n\n```\n\n```diff\n@@ -154,13 +154,13 @@ def __init__(\n             ),\n         ] = None,\n         realm: Annotated[\n-            Optional[str],\n+            str,\n             Doc(\n                 \"\"\"\n                 HTTP Basic authentication realm.\n                 \"\"\"\n             ),\n-        ] = None,\n+        ],\n         description: Annotated[\n             Optional[str],\n             Doc(\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from fastapi import Depends, FastAPI\n+from fastapi.security import HTTPBasic, HTTPBasicCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+security = HTTPBasic(realm=\"\")\n+\n+\n+@app.get(\"/users/me\")\n+def read_current_user(credentials: HTTPBasicCredentials = Depends(security)):\n+    return {\"username\": credentials.username, \"password\": credentials.password}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_security_http_basic_empty_realm():\n+    response = client.get(\"/users/me\", auth=(\"john\", \"secret\"))\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"username\": \"john\", \"password\": \"secret\"}\n+\n+\n+def test_security_http_basic_invalid_credentials_empty_realm():\n+    response = client.get(\n+        \"/users/me\", headers={\"Authorization\": \"Basic notabase64token\"}\n+    )\n+    assert response.status_code == 401, response.text\n+    assert response.headers[\"WWW-Authenticate\"] == \"Basic\"\n+    assert response.json() == {\"detail\": \"Invalid authentication credentials\"}\n\n```", "output": "Changes look good. This PR implements: Fix: Make Basic Auth realm required per RFC 7235", "source": "pr", "type": "code_review", "pr_number": 441}
{"instruction": "Fix the following bug: Fix HTTP Basic realm handling (RFC 7617)", "input": "Per RFC 7617, the realm parameter is required for HTTP Basic authentication.\r\nThis PR makes realm mandatory and ensures the WWW-Authenticate header\r\nalways includes it.\r\n\r\nFixes #13471", "output": "```diff\n@@ -152,14 +152,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-        realm: Annotated[\n-            Optional[str],\n-            Doc(\n-                \"\"\"\n-                HTTP Basic authentication realm.\n-                \"\"\"\n-            ),\n-        ] = None,\n+        realm: Annotated[str, Doc(\"HTTP Basic authentication realm.\")] = \"fastapi\",\n         description: Annotated[\n             Optional[str],\n             Doc(\n@@ -197,9 +190,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```\n\n```diff\n@@ -1,4 +1,5 @@\n-from fastapi import FastAPI, Security\n+from fastapi import Depends, FastAPI, Security\n+from fastapi.security import HTTPBasic\n from fastapi.security.http import HTTPAuthorizationCredentials, HTTPBase\n from fastapi.testclient import TestClient\n \n@@ -53,3 +54,18 @@ def test_openapi_schema():\n             \"securitySchemes\": {\"HTTPBase\": {\"type\": \"http\", \"scheme\": \"Other\"}}\n         },\n     }\n+\n+\n+def test_http_basic_includes_realm():\n+    app = FastAPI()\n+    security = HTTPBasic(realm=\"MyRealm\")\n+\n+    @app.get(\"/\")\n+    def read_root(credentials=Depends(security)):\n+        return {\"ok\": True}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 401\n+    assert response.headers[\"WWW-Authenticate\"] == 'Basic realm=\"MyRealm\"'\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 440}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -152,14 +152,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-        realm: Annotated[\n-            Optional[str],\n-            Doc(\n-                \"\"\"\n-                HTTP Basic authentication realm.\n-                \"\"\"\n-            ),\n-        ] = None,\n+        realm: Annotated[str, Doc(\"HTTP Basic authentication realm.\")] = \"fastapi\",\n         description: Annotated[\n             Optional[str],\n             Doc(\n@@ -197,9 +190,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```\n\n```diff\n@@ -1,4 +1,5 @@\n-from fastapi import FastAPI, Security\n+from fastapi import Depends, FastAPI, Security\n+from fastapi.security import HTTPBasic\n from fastapi.security.http import HTTPAuthorizationCredentials, HTTPBase\n from fastapi.testclient import TestClient\n \n@@ -53,3 +54,18 @@ def test_openapi_schema():\n             \"securitySchemes\": {\"HTTPBase\": {\"type\": \"http\", \"scheme\": \"Other\"}}\n         },\n     }\n+\n+\n+def test_http_basic_includes_realm():\n+    app = FastAPI()\n+    security = HTTPBasic(realm=\"MyRealm\")\n+\n+    @app.get(\"/\")\n+    def read_root(credentials=Depends(security)):\n+        return {\"ok\": True}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 401\n+    assert response.headers[\"WWW-Authenticate\"] == 'Basic realm=\"MyRealm\"'\n\n```", "output": "Bug: Fix HTTP Basic realm handling (RFC 7617)\n\nPer RFC 7617, the realm parameter is required for HTTP Basic authentication.\r\nThis PR makes realm mandatory and ensures the WWW-Authenticate header\r\nalways includes it.\r\n\r\nFixes #13471", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 440}
{"instruction": "Review the following code changes: Fix HTTP Basic realm handling (RFC 7617)", "input": "```diff\n@@ -152,14 +152,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-        realm: Annotated[\n-            Optional[str],\n-            Doc(\n-                \"\"\"\n-                HTTP Basic authentication realm.\n-                \"\"\"\n-            ),\n-        ] = None,\n+        realm: Annotated[str, Doc(\"HTTP Basic authentication realm.\")] = \"fastapi\",\n         description: Annotated[\n             Optional[str],\n             Doc(\n@@ -197,9 +190,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     def make_authenticate_headers(self) -> dict[str, str]:\n-        if self.realm:\n-            return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n-        return {\"WWW-Authenticate\": \"Basic\"}\n+        return {\"WWW-Authenticate\": f'Basic realm=\"{self.realm}\"'}\n \n     async def __call__(  # type: ignore\n         self, request: Request\n\n```\n\n```diff\n@@ -1,4 +1,5 @@\n-from fastapi import FastAPI, Security\n+from fastapi import Depends, FastAPI, Security\n+from fastapi.security import HTTPBasic\n from fastapi.security.http import HTTPAuthorizationCredentials, HTTPBase\n from fastapi.testclient import TestClient\n \n@@ -53,3 +54,18 @@ def test_openapi_schema():\n             \"securitySchemes\": {\"HTTPBase\": {\"type\": \"http\", \"scheme\": \"Other\"}}\n         },\n     }\n+\n+\n+def test_http_basic_includes_realm():\n+    app = FastAPI()\n+    security = HTTPBasic(realm=\"MyRealm\")\n+\n+    @app.get(\"/\")\n+    def read_root(credentials=Depends(security)):\n+        return {\"ok\": True}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 401\n+    assert response.headers[\"WWW-Authenticate\"] == 'Basic realm=\"MyRealm\"'\n\n```", "output": "Changes look good. This PR implements: Fix HTTP Basic realm handling (RFC 7617)", "source": "pr", "type": "code_review", "pr_number": 440}
{"instruction": "Review the following code changes: ‚¨Ü [pre-commit.ci] pre-commit autoupdate", "input": "```diff\n@@ -14,7 +14,7 @@ repos:\n     -   id: end-of-file-fixer\n     -   id: trailing-whitespace\n -   repo: https://github.com/astral-sh/ruff-pre-commit\n-    rev: v0.14.3\n+    rev: v0.14.5\n     hooks:\n     -   id: ruff\n         args:\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü [pre-commit.ci] pre-commit autoupdate", "source": "pr", "type": "code_review", "pr_number": 439}
{"instruction": "Review the following code changes: ‚¨Ü Bump pyjwt from 2.9.0 to 2.10.1", "input": "```diff\n@@ -7,7 +7,7 @@ dirty-equals ==0.9.0\n sqlmodel==0.0.27\n flask >=1.1.2,<4.0.0\n anyio[trio] >=3.2.1,<5.0.0\n-PyJWT==2.9.0\n+PyJWT==2.10.1\n pyyaml >=5.3.1,<7.0.0\n pwdlib[argon2] >=0.2.1\n inline-snapshot>=0.21.1\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump pyjwt from 2.9.0 to 2.10.1", "source": "pr", "type": "code_review", "pr_number": 438}
{"instruction": "Review the following code changes: ‚¨Ü Bump types-ujson from 5.10.0.20240515 to 5.10.0.20250822", "input": "```diff\n@@ -12,5 +12,5 @@ pyyaml >=5.3.1,<7.0.0\n pwdlib[argon2] >=0.2.1\n inline-snapshot>=0.21.1\n # types\n-types-ujson ==5.10.0.20240515\n+types-ujson ==5.10.0.20250822\n types-orjson ==3.6.2\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump types-ujson from 5.10.0.20240515 to 5.10.0.20250822", "source": "pr", "type": "code_review", "pr_number": 437}
{"instruction": "Review the following code changes: üìù Update note with implementation details of `response_model_exclude_unset`", "input": "```diff\n@@ -252,15 +252,7 @@ So, if you send a request to that *path operation* for the item with ID `foo`, t\n \n /// info\n \n-In Pydantic v1 the method was called `.dict()`, it was deprecated (but still supported) in Pydantic v2, and renamed to `.model_dump()`.\n-\n-The examples here use `.dict()` for compatibility with Pydantic v1, but you should use `.model_dump()` instead if you can use Pydantic v2.\n-\n-///\n-\n-/// info\n-\n-FastAPI uses Pydantic model's `.dict()` with <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">its `exclude_unset` parameter</a> to achieve this.\n+Depending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`.model_dump()` (v2)</a> with the `exclude_unset` parameter to achieve this.\n \n ///\n \n\n```\n\n```diff\n@@ -252,15 +252,7 @@ So, if you send a request to that *path operation* for the item with ID `foo`, t\n \n /// info\n \n-In Pydantic v1 the method was called `.dict()`, it was deprecated (but still supported) in Pydantic v2, and renamed to `.model_dump()`.\n-\n-The examples here use `.dict()` for compatibility with Pydantic v1, but you should use `.model_dump()` instead if you can use Pydantic v2.\n-\n-///\n-\n-/// info\n-\n-FastAPI uses Pydantic model's `.dict()` with <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">its `exclude_unset` parameter</a> to achieve this.\n+Depending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`model_dump` (v2)</a> with the `exclude_unset` parameter to achieve this.\n\n```\n\n```diff\n@@ -252,15 +252,7 @@ So, if you send a request to that *path operation* for the item with ID `foo`, t\n \n /// info\n \n-In Pydantic v1 the method was called `.dict()`, it was deprecated (but still supported) in Pydantic v2, and renamed to `.model_dump()`.\n-\n-The examples here use `.dict()` for compatibility with Pydantic v1, but you should use `.model_dump()` instead if you can use Pydantic v2.\n-\n-///\n-\n-/// info\n-\n-FastAPI uses Pydantic model's `.dict()` with <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">its `exclude_unset` parameter</a> to achieve this.\n+Depending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`.model_dump()` (v2)</a> with the `exclude_unset` parameter to achieve this.\n \n ///\n \n\n```\n\n```diff\n@@ -252,15 +252,7 @@ So, if you send a request to that *path operation* for the item with ID `foo`, t\n \n /// info\n \n-In Pydantic v1 the method was called `.dict()`, it was deprecated (but still supported) in Pydantic v2, and renamed to `.model_dump()`.\n-\n-The examples here use `.dict()` for compatibility with Pydantic v1, but you should use `.model_dump()` instead if you can use Pydantic v2.\n-\n-///\n-\n-/// info\n-\n-FastAPI uses Pydantic model's `.dict()` with <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">its `exclude_unset` parameter</a> to achieve this.\n+Depending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`.model_dump()` (v2)</a> with the `exclude_unset` parameter to achieve this.\n\n```", "output": "Code Review for: üìù Update note with implementation details of `response_model_exclude_unset`\n\nüìù **docs/en/docs/tutorial/response-model.md**: ```suggestion\r\nDepending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`.model_dump()` (v2)</a> with the `exclude_unset` parameter to achieve this.\r\n```\n\nüìù **docs/en/docs/tutorial/response-model.md**: Below, at L266, the Pydantic docs are referenced again, using 1.10: https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\r\n\r\nHere, we should probably (only) have the newer 2.x docs: https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\n\nüìù **docs/en/docs/tutorial/response-model.md**: Which 2.x version do we want to link? Currently this PR has 2.0, but we could also do 2.11: https://docs.pydantic.dev/2.11/api/base_model/#pydantic.main.BaseModel.model_dump. But it will feel arbitrary when more releases are made for Pydantic 2.x, and updating the link each time is also tedious.\n\n", "source": "pr", "type": "code_review", "pr_number": 436}
{"instruction": "Review this code change in `docs/en/docs/tutorial/response-model.md`", "input": "```diff\n@@ -252,15 +252,7 @@ So, if you send a request to that *path operation* for the item with ID `foo`, t\n \n /// info\n \n-In Pydantic v1 the method was called `.dict()`, it was deprecated (but still supported) in Pydantic v2, and renamed to `.model_dump()`.\n-\n-The examples here use `.dict()` for compatibility with Pydantic v1, but you should use `.model_dump()` instead if you can use Pydantic v2.\n-\n-///\n-\n-/// info\n-\n-FastAPI uses Pydantic model's `.dict()` with <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">its `exclude_unset` parameter</a> to achieve this.\n+Depending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`model_dump` (v2)</a> with the `exclude_unset` parameter to achieve this.\n\n```", "output": "```suggestion\r\nDepending on the installed version, FastAPI uses Pydantic model's <a href=\"https://docs.pydantic.dev/1.10/usage/exporting_models/#modeldict\" class=\"external-link\" target=\"_blank\">`.dict()` (v1)</a> (v1) or <a href=\"https://docs.pydantic.dev/2.0/api/main/#pydantic.main.BaseModel.model_dump\" class=\"external-link\" target=\"_blank\">`.model_dump()` (v2)</a> with the `exclude_unset` parameter to achieve this.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 436}
{"instruction": "Review the following code changes: ‚ú® Allow custom `JsonSchemaGenerator` for OpenAPI generation", "input": "```diff\n@@ -3,6 +3,7 @@\n     Any,\n     Dict,\n     List,\n+    Optional,\n     Sequence,\n     Tuple,\n     Type,\n@@ -19,6 +20,7 @@\n if PYDANTIC_V2:\n     from .v2 import BaseConfig as BaseConfig\n     from .v2 import FieldInfo as FieldInfo\n+    from .v2 import GenerateJsonSchema as GenerateJsonSchema\n     from .v2 import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n     from .v2 import RequiredParam as RequiredParam\n     from .v2 import Undefined as Undefined\n@@ -33,6 +35,7 @@\n else:\n     from .v1 import BaseConfig as BaseConfig  # type: ignore[assignment]\n     from .v1 import FieldInfo as FieldInfo\n+    from .v1 import GenerateJsonSchema as GenerateJsonSchema  # type: ignore[assignment]\n     from .v1 import (  # type: ignore[assignment]\n         PydanticSchemaGenerationError as PydanticSchemaGenerationError,\n     )\n@@ -231,6 +234,7 @@ def get_definitions(\n     fields: List[ModelField],\n     model_name_map: ModelNameMap,\n     separate_input_output_schemas: bool = True,\n+    schema_generator: Optional[GenerateJsonSchema] = None,\n ) -> Tuple[\n     Dict[Tuple[ModelField, Literal[\"validation\", \"serialization\"]], v1.JsonSchemaValue],\n     Dict[str, Dict[str, Any]],\n@@ -251,6 +255,7 @@ def get_definitions(\n             fields=v2_fields,\n             model_name_map=model_name_map,\n             separate_input_output_schemas=separate_input_output_schemas,\n+            schema_generator=schema_generator,\n         )\n         all_definitions = {**v1_definitions, **v2_definitions}\n         all_field_maps = {**v1_field_maps, **v2_field_maps}\n\n```\n\n```diff\n@@ -7,6 +7,7 @@\n     Any,\n     Dict,\n     List,\n+    Optional,\n     Sequence,\n     Set,\n     Tuple,\n@@ -199,11 +200,12 @@ def get_definitions(\n     fields: Sequence[ModelField],\n     model_name_map: ModelNameMap,\n     separate_input_output_schemas: bool = True,\n+    schema_generator: Optional[GenerateJsonSchema] = None,\n ) -> Tuple[\n     Dict[Tuple[ModelField, Literal[\"validation\", \"serialization\"]], JsonSchemaValue],\n     Dict[str, Dict[str, Any]],\n ]:\n-    schema_generator = GenerateJsonSchema(ref_template=REF_TEMPLATE)\n+    schema_generator = schema_generator or GenerateJsonSchema(ref_template=REF_TEMPLATE)\n     override_mode: Union[Literal[\"validation\"], None] = (\n         None if separate_input_output_schemas else \"validation\"\n     )\n\n```\n\n```diff\n@@ -5,6 +5,7 @@\n \n from fastapi import routing\n from fastapi._compat import (\n+    PYDANTIC_V2,\n     JsonSchemaValue,\n     ModelField,\n     Undefined,\n@@ -38,6 +39,13 @@\n \n from .._compat import _is_model_field\n \n+if PYDANTIC_V2:\n+    from .._compat.v2 import GenerateJsonSchema as GenerateJsonSchema\n+else:\n+    from .._compat.v1 import (  # type: ignore[assignment]\n+        GenerateJsonSchema as GenerateJsonSchema,\n+    )\n+\n validation_error_definition = {\n     \"title\": \"ValidationError\",\n     \"type\": \"object\",\n@@ -480,6 +488,7 @@ def get_openapi(\n     license_info: Optional[Dict[str, Union[str, Any]]] = None,\n     separate_input_output_schemas: bool = True,\n     external_docs: Optional[Dict[str, Any]] = None,\n+    schema_generator: Optional[GenerateJsonSchema] = None,\n ) -> Dict[str, Any]:\n     info: Dict[str, Any] = {\"title\": title, \"version\": version}\n     if summary:\n@@ -505,6 +514,7 @@ def get_openapi(\n         fields=all_fields,\n         model_name_map=model_name_map,\n         separate_input_output_schemas=separate_input_output_schemas,\n+        schema_generator=schema_generator,\n     )\n     for route in routes or []:\n         if isinstance(route, routing.APIRoute):\n\n```\n\n```diff\n@@ -0,0 +1,88 @@\n+import pytest\n+from fastapi import FastAPI\n+from fastapi._compat import PYDANTIC_V2\n+from fastapi.openapi.constants import REF_TEMPLATE\n+from fastapi.openapi.utils import get_openapi\n+\n+if PYDANTIC_V2:\n+    from fastapi._compat.v2 import GenerateJsonSchema\n+else:\n+    from fastapi._compat.v1 import GenerateJsonSchema  # type: ignore[assignment]\n+\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root():\n+    pass  # pragma: no cover\n+\n+\n+# Custom schema generator that does nothing but tracks if it was called\n+class CustomJsonSchemaGenerator(GenerateJsonSchema):\n+    def __init__(self):\n+        super().__init__(ref_template=REF_TEMPLATE)\n+        self.called = False\n+\n+    def generate_definitions(self, *args, **kwargs):\n+        self.called = True\n+        return super().generate_definitions(*args, **kwargs)\n+\n+\n+def test_custom_schema_generator_called():\n+    custom_schema_generator = CustomJsonSchemaGenerator()\n+    get_openapi(\n+        title=app.title,\n+        version=app.version,\n+        routes=app.routes,\n+        schema_generator=custom_schema_generator,\n+    )\n+\n+    if PYDANTIC_V2:\n+        assert custom_schema_generator.called is True\n+    else:\n+        assert (  # Pydantic v1 does not use custom schema generators\n+            custom_schema_generator.called is False\n+        )\n+\n+\n+@pytest.mark.parametrize(\"use_custom_schema_generator\", [True, False])\n+def test_custom_schema_generator_openapi(use_cus", "output": "Changes look good. This PR implements: ‚ú® Allow custom `JsonSchemaGenerator` for OpenAPI generation", "source": "pr", "type": "code_review", "pr_number": 435}
{"instruction": "Fix the following bug: ‚ôªÔ∏è Convert all instances of assert for safer error handling", "input": "", "output": "```diff\n@@ -264,7 +264,10 @@ def serialize_sequence_value(*, field: ModelField, value: Any) -> Sequence[Any]:\n         origin_type = (\n             get_origin(field.field_info.annotation) or field.field_info.annotation\n         )\n-        assert issubclass(origin_type, sequence_types)  # type: ignore[arg-type]\n+        if not issubclass(origin_type, sequence_types) or not isinstance(\n+            origin_type, type\n+        ):\n+            raise TypeError(f\"Field {field.name} is not a supported sequence type\")\n         return sequence_annotation_to_type[origin_type](value)  # type: ignore[no-any-return]\n \n     def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n\n```\n\n```diff\n@@ -872,8 +872,12 @@ class Item(BaseModel):\n         ] = \"3.1.0\"\n         self.openapi_schema: Optional[Dict[str, Any]] = None\n         if self.openapi_url:\n-            assert self.title, \"A title must be provided for OpenAPI, e.g.: 'My API'\"\n-            assert self.version, \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+            if not self.title:\n+                raise ValueError(\"A title must be provided for OpenAPI, e.g.: 'My API'\")\n+            if not self.version:\n+                raise ValueError(\n+                    \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+                )\n         # TODO: remove when discarding the openapi_prefix parameter\n         if openapi_prefix:\n             logger.warning(\n\n```\n\n```diff\n@@ -90,29 +90,42 @@\n \n def ensure_multipart_is_installed() -> None:\n     try:\n-        from python_multipart import __version__\n+        from python_multipart import __version__ as python_multipart_version\n \n         # Import an attribute that can be mocked/deleted in testing\n-        assert __version__ > \"0.0.12\"\n-    except (ImportError, AssertionError):\n-        try:\n-            # __version__ is available in both multiparts, and can be mocked\n-            from multipart import __version__  # type: ignore[no-redef,import-untyped]\n+        if python_multipart_version <= \"0.0.12\":\n+            raise RuntimeError(\n+                f\"Incompatible 'python-multipart' version: {python_multipart_version}. \"\n+                \"Please upgrade to a version > 0.0.12\"\n+            )\n+        return\n \n-            assert __version__\n-            try:\n-                # parse_options_header is only available in the right multipart\n-                from multipart.multipart import (  # type: ignore[import-untyped]\n-                    parse_options_header,\n-                )\n+    except ImportError:\n+        pass  # fallback to trying multipart\n+    except Exception as e:\n+        logger.error(\"Error checking 'python-multipart' version: %s\", e)\n+        raise\n+\n+    try:\n+        # __version__ is available in both multiparts, and can be mocked\n+        from multipart import (\n+            __version__ as multipart_version,  # type: ignore[no-redef,import-untyped]\n+        )\n+    except ImportError:\n+        logger.error(multipart_not_installed_error)\n+        raise RuntimeError(multipart_not_installed_error) from None\n \n-                assert parse_options_header\n-            except ImportError:\n-                logger.error(multipart_incorrect_install_error)\n-                raise RuntimeError(multipart_incorrect_install_error) from None\n-        except ImportError:\n-            logger.error(multipart_not_installed_error)\n-            raise RuntimeError(multipart_not_installed_error) from None\n+    if not multipart_version:\n+        logger.error(multipart_incorrect_install_error)\n+        raise RuntimeError(multipart_incorrect_install_error)\n+\n+    try:\n+        from multipart.multipart import (\n+            parse_options_header,  # type: ignore[import-untyped]\n+        )\n+    except ImportError:\n+        logger.error(multipart_incorrect_install_error)\n+        raise RuntimeError(multipart_incorrect_install_error) from None\n \n \n def get_param_sub_dependant(\n@@ -122,7 +135,11 @@ def get_param_sub_dependant(\n     path: str,\n     security_scopes: Optional[List[str]] = None,\n ) -> Dependant:\n-    assert depends.dependency\n+    if depends.dependency is None:\n+        raise ValueError(\n+            f\"`depends.dependency` must be set for parameter '{param_name}'\"\n+        )\n+\n     return get_sub_dependant(\n         depends=depends,\n         dependency=depends.dependency,\n@@ -133,9 +150,9 @@ def get_param_sub_dependant(\n \n \n def get_parameterless_sub_dependant(*, depe\n\n```\n\n```diff\n@@ -15,9 +15,7 @@\n from typing_extensions import deprecated as typing_deprecated\n \n try:\n-    import email_validator\n-\n-    assert email_validator  # make autoflake ignore the unused import\n+    import email_validator  # noqa: F401\n     from pydantic import EmailStr\n except ImportError:  # pragma: no cover\n \n\n```\n\n```diff\n@@ -179,7 +179,12 @@ def get_openapi_operation_request_body(\n ) -> Optional[Dict[str, Any]]:\n     if not body_field:\n         return None\n-    assert isinstance(body_field, ModelField)\n+\n+    if not isinstance(body_field, ModelField):\n+        raise TypeError(\n+            f\"Expected body_field to be a ModelField, got {type(body_field).__name__}\"\n+        )\n+\n     body_schema = get_schema_from_model_field(\n         field=body_field,\n         schema_generator=schema_generator,\n@@ -265,12 +270,18 @@ def get_openapi_path(\n     path = {}\n     security_schemes: Dict[str, Any] = {}\n     definitions: Dict[str, Any] = {}\n-    assert route.methods is not None, \"Methods must be a list\"\n+\n+    if route.methods is None:\n+        raise ValueError(\"Route methods must be defined as a list of HTTP methods\")\n+\n     if isinstance(route.response_class, DefaultPlaceholder):\n         current_response_class: Type[Response] = route.response_class.value\n     else:\n         current_response_class = route.response_class\n-    assert current_response_class, \"A response class is needed to generate OpenAPI\"\n+\n+    if not current_response_class:\n+        raise ValueError(\"A response class is needed to generate OpenAPI\")\n+\n     route_response_media_type: Optional[str] = current_response_class.media_type\n     if route.include_in_schema:\n         for method in route.methods:\n@@ -385,9 +396,10 @@ def get_openapi_path(\n                     openapi_response = operation_responses.setdefault(\n                         status_code_key, {}\n                     )\n-                    assert isinstance(process_response, dict), (\n-                        \"An additional response must be a dict\"\n-                    )\n+\n+                    if not isinstance(process_response, dict):\n+                        raise TypeError(\"An additional response must be a dict\")\n+\n                     field = route.response_fields.get(additional_status_code)\n                     additional_field_schema: Optional[Dict[str, Any]] = None\n                     if field:\n@@ -455,9 +467,11 @@ def get_fields_from_routes(\n             route, routing.APIRoute\n         ):\n             if route.body_field:\n-                assert isinstance(route.body_field, ModelField), (\n-                    \"A request body must be a Pydantic Field\"\n-                )\n+                if not isinstance(route.body_field, ModelField):\n+                    raise TypeError(\n+                        \"A request body must be a Pydantic ModelField instance\"\n+                    )\n+\n                 body_fields_from_routes.append(route.body_field)\n             if route.response_field:\n                 responses_from_routes.append(route.response_field)\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 434}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -264,7 +264,10 @@ def serialize_sequence_value(*, field: ModelField, value: Any) -> Sequence[Any]:\n         origin_type = (\n             get_origin(field.field_info.annotation) or field.field_info.annotation\n         )\n-        assert issubclass(origin_type, sequence_types)  # type: ignore[arg-type]\n+        if not issubclass(origin_type, sequence_types) or not isinstance(\n+            origin_type, type\n+        ):\n+            raise TypeError(f\"Field {field.name} is not a supported sequence type\")\n         return sequence_annotation_to_type[origin_type](value)  # type: ignore[no-any-return]\n \n     def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n\n```\n\n```diff\n@@ -872,8 +872,12 @@ class Item(BaseModel):\n         ] = \"3.1.0\"\n         self.openapi_schema: Optional[Dict[str, Any]] = None\n         if self.openapi_url:\n-            assert self.title, \"A title must be provided for OpenAPI, e.g.: 'My API'\"\n-            assert self.version, \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+            if not self.title:\n+                raise ValueError(\"A title must be provided for OpenAPI, e.g.: 'My API'\")\n+            if not self.version:\n+                raise ValueError(\n+                    \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+                )\n         # TODO: remove when discarding the openapi_prefix parameter\n         if openapi_prefix:\n             logger.warning(\n\n```\n\n```diff\n@@ -90,29 +90,42 @@\n \n def ensure_multipart_is_installed() -> None:\n     try:\n-        from python_multipart import __version__\n+        from python_multipart import __version__ as python_multipart_version\n \n         # Import an attribute that can be mocked/deleted in testing\n-        assert __version__ > \"0.0.12\"\n-    except (ImportError, AssertionError):\n-        try:\n-            # __version__ is available in both multiparts, and can be mocked\n-            from multipart import __version__  # type: ignore[no-redef,import-untyped]\n+        if python_multipart_version <= \"0.0.12\":\n+            raise RuntimeError(\n+                f\"Incompatible 'python-multipart' version: {python_multipart_version}. \"\n+                \"Please upgrade to a version > 0.0.12\"\n+            )\n+        return\n \n-            assert __version__\n-            try:\n-                # parse_options_header is only available in the right multipart\n-                from multipart.multipart import (  # type: ignore[import-untyped]\n-                    parse_options_header,\n-                )\n+    except ImportError:\n+        pass  # fallback to trying multipart\n+    except Exception as e:\n+        logger.error(\"Error checking 'python-multipart' version: %s\", e)\n+        raise\n+\n+    try:\n+        # __version__ is available in both multiparts, and can be mocked\n+        from multipart import (\n+            __version__ as multipart_version,  # type: ignore[no-redef,import-untyped]\n+        )\n+    except ImportError:\n+        logger.error(multipart_not_installed_error)\n+        raise RuntimeError(multipart_not_installed_error) from None\n \n-                assert parse_options_header\n-            except ImportError:\n-                logger.error(multipart_incorrect_install_error)\n-                raise RuntimeError(multipart_incorrect_install_error) from None\n-        except ImportError:\n-            logger.error(multipart_not_installed_error)\n-            raise RuntimeError(multipart_not_installed_error) from None\n+    if not multipart_version:\n+        logger.error(multipart_incorrect_install_error)\n+        raise RuntimeError(multipart_incorrect_install_error)\n+\n+    try:\n+        from multipart.multipart import (\n+            parse_options_header,  # type: ignore[import-untyped]\n+        )\n+    except ImportError:\n+        logger.error(multipart_incorrect_install_error)\n+        raise RuntimeError(multipart_incorrect_install_error) from None\n \n \n def get_param_sub_dependant(\n@@ -122,7 +135,11 @@ def get_param_sub_dependant(\n ", "output": "Bug: ‚ôªÔ∏è Convert all instances of assert for safer error handling\n\n", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 434}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Convert all instances of assert for safer error handling", "input": "```diff\n@@ -264,7 +264,10 @@ def serialize_sequence_value(*, field: ModelField, value: Any) -> Sequence[Any]:\n         origin_type = (\n             get_origin(field.field_info.annotation) or field.field_info.annotation\n         )\n-        assert issubclass(origin_type, sequence_types)  # type: ignore[arg-type]\n+        if not issubclass(origin_type, sequence_types) or not isinstance(\n+            origin_type, type\n+        ):\n+            raise TypeError(f\"Field {field.name} is not a supported sequence type\")\n         return sequence_annotation_to_type[origin_type](value)  # type: ignore[no-any-return]\n \n     def get_missing_field_error(loc: Tuple[str, ...]) -> Dict[str, Any]:\n\n```\n\n```diff\n@@ -872,8 +872,12 @@ class Item(BaseModel):\n         ] = \"3.1.0\"\n         self.openapi_schema: Optional[Dict[str, Any]] = None\n         if self.openapi_url:\n-            assert self.title, \"A title must be provided for OpenAPI, e.g.: 'My API'\"\n-            assert self.version, \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+            if not self.title:\n+                raise ValueError(\"A title must be provided for OpenAPI, e.g.: 'My API'\")\n+            if not self.version:\n+                raise ValueError(\n+                    \"A version must be provided for OpenAPI, e.g.: '2.1.0'\"\n+                )\n         # TODO: remove when discarding the openapi_prefix parameter\n         if openapi_prefix:\n             logger.warning(\n\n```\n\n```diff\n@@ -90,29 +90,42 @@\n \n def ensure_multipart_is_installed() -> None:\n     try:\n-        from python_multipart import __version__\n+        from python_multipart import __version__ as python_multipart_version\n \n         # Import an attribute that can be mocked/deleted in testing\n-        assert __version__ > \"0.0.12\"\n-    except (ImportError, AssertionError):\n-        try:\n-            # __version__ is available in both multiparts, and can be mocked\n-            from multipart import __version__  # type: ignore[no-redef,import-untyped]\n+        if python_multipart_version <= \"0.0.12\":\n+            raise RuntimeError(\n+                f\"Incompatible 'python-multipart' version: {python_multipart_version}. \"\n+                \"Please upgrade to a version > 0.0.12\"\n+            )\n+        return\n \n-            assert __version__\n-            try:\n-                # parse_options_header is only available in the right multipart\n-                from multipart.multipart import (  # type: ignore[import-untyped]\n-                    parse_options_header,\n-                )\n+    except ImportError:\n+        pass  # fallback to trying multipart\n+    except Exception as e:\n+        logger.error(\"Error checking 'python-multipart' version: %s\", e)\n+        raise\n+\n+    try:\n+        # __version__ is available in both multiparts, and can be mocked\n+        from multipart import (\n+            __version__ as multipart_version,  # type: ignore[no-redef,import-untyped]\n+        )\n+    except ImportError:\n+        logger.error(multipart_not_installed_error)\n+        raise RuntimeError(multipart_not_installed_error) from None\n \n-                assert parse_options_header\n-            except ImportError:\n-                logger.error(multipart_incorrect_install_error)\n-                raise RuntimeError(multipart_incorrect_install_error) from None\n-        except ImportError:\n-            logger.error(multipart_not_installed_error)\n-            raise RuntimeError(multipart_not_installed_error) from None\n+    if not multipart_version:\n+        logger.error(multipart_incorrect_install_error)\n+        raise RuntimeError(multipart_incorrect_install_error)\n+\n+    try:\n+        from multipart.multipart import (\n+            parse_options_header,  # type: ignore[import-untyped]\n+        )\n+    except ImportError:\n+        logger.error(multipart_incorrect_install_error)\n+        raise RuntimeError(multipart_incorrect_install_error) from None\n \n \n def get_param_sub_dependant(\n@@ -122,7 +135,11 @@ def get_param_sub_dependant(\n     path: str,\n     security_scopes: Optional[List[str]] = None,\n ) -> Dependant:\n-    assert depends.dependency\n+    if depends.dependency is None:\n+        raise ValueError(\n+            f\"`depends.dependency` must be set for parameter '{param_name}'\"\n+        )\n+\n     return get_sub_dependant(\n         depends=depends,\n         dependency=depends.dependency,\n@@ -133,9 +150,9 @@ def get_param_sub_dependant(\n \n \n def get_parameterless_sub_dependant(*, depe\n\n```\n\n```diff\n@@ -15,9 +15,7 @@\n from typing_extensions import deprecated as typing_deprecated\n \n try:\n-    import email_validator\n-\n-    assert email_validator  # make autoflake ignore the unused import\n+    import email_validator  # noqa: F401\n     from pydantic import EmailStr\n except ImportError:  # pragma: no cover\n \n\n```\n\n```diff\n@@ -179,7 +179,12 @@ def get_openapi_operation_request_body(\n ) -> Optional[Dict[str, Any]]:\n     if not body_field:\n         return None\n-    assert isinstance(body_field, ModelField)\n+\n+    if not i", "output": "Code Review for: ‚ôªÔ∏è Convert all instances of assert for safer error handling\n\nüìù **fastapi/params.py**: I think you need to fix this.\n\n", "source": "pr", "type": "code_review", "pr_number": 434}
{"instruction": "Review this code change in `fastapi/params.py`", "input": "```diff\n@@ -186,7 +186,9 @@ def __init__(\n         json_schema_extra: Union[Dict[str, Any], None] = None,\n         **extra: Any,\n     ):\n-        assert default is ..., \"Path parameters cannot have a default value\"\n+        if default is ...:\n+            raise ValueError(\"Path parameters cannot have a default value\")\n\n```", "output": "I think you need to fix this.", "source": "pr_review", "type": "inline_review", "pr_number": 434}
{"instruction": "Fix the following bug: ‚ú® Add descriptions for ValidationError and HTTPValidationError in OpenAPI", "input": "Descriptions for ValidationError and HTTPValidationError in OpenAPI schema.\r\n\r\nWhen schemata are used for codegen downstream, this alleviates the need to modify the `ValidationError` and `HTTPValidationError` models to satisfy linters that require descriptions on modules/classes.\r\n\r\nI'm not sure the descriptions here are necessarily the best, but it would be really nice to have *a* description. Suggestions for improvements very welcome. :-)", "output": "```diff\n@@ -41,21 +41,27 @@\n validation_error_definition = {\n     \"title\": \"ValidationError\",\n     \"type\": \"object\",\n+    \"description\": \"A message detailing how and where the input diverges from the schema.\",\n     \"properties\": {\n         \"loc\": {\n             \"title\": \"Location\",\n             \"type\": \"array\",\n             \"items\": {\"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]},\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n-        \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"type\": {\n+            \"title\": \"Error Type\",\n+            \"type\": \"string\",\n+            \"description\": \"Free-form; when type is 'missing', it pertains to absent required fields.\",\n+        },\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n \n validation_error_response_definition = {\n     \"title\": \"HTTPValidationError\",\n     \"type\": \"object\",\n+    \"description\": \"A collection of messages detailing errors in the input.\",\n     \"properties\": {\n         \"detail\": {\n             \"title\": \"Detail\",\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 433}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -41,21 +41,27 @@\n validation_error_definition = {\n     \"title\": \"ValidationError\",\n     \"type\": \"object\",\n+    \"description\": \"A message detailing how and where the input diverges from the schema.\",\n     \"properties\": {\n         \"loc\": {\n             \"title\": \"Location\",\n             \"type\": \"array\",\n             \"items\": {\"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]},\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n-        \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"type\": {\n+            \"title\": \"Error Type\",\n+            \"type\": \"string\",\n+            \"description\": \"Free-form; when type is 'missing', it pertains to absent required fields.\",\n+        },\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n \n validation_error_response_definition = {\n     \"title\": \"HTTPValidationError\",\n     \"type\": \"object\",\n+    \"description\": \"A collection of messages detailing errors in the input.\",\n     \"properties\": {\n         \"detail\": {\n             \"title\": \"Detail\",\n\n```", "output": "Bug: ‚ú® Add descriptions for ValidationError and HTTPValidationError in OpenAPI\n\nDescriptions for ValidationError and HTTPValidationError in OpenAPI schema.\r\n\r\nWhen schemata are used for codegen downstream, this alleviates the need to modify the `ValidationError` and `HTTPValidationError` models to satisfy linters that require descriptions on modules/classes.\r\n\r\nI'm not sure the descriptions here are necessarily the best, but it would be really nice to have *a* description. Suggestions for improvements very welcome. :-)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 433}
{"instruction": "Review the following code changes: ‚ú® Add descriptions for ValidationError and HTTPValidationError in OpenAPI", "input": "```diff\n@@ -41,21 +41,27 @@\n validation_error_definition = {\n     \"title\": \"ValidationError\",\n     \"type\": \"object\",\n+    \"description\": \"A message detailing how and where the input diverges from the schema.\",\n     \"properties\": {\n         \"loc\": {\n             \"title\": \"Location\",\n             \"type\": \"array\",\n             \"items\": {\"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]},\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n-        \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"type\": {\n+            \"title\": \"Error Type\",\n+            \"type\": \"string\",\n+            \"description\": \"Free-form; when type is 'missing', it pertains to absent required fields.\",\n+        },\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n \n validation_error_response_definition = {\n     \"title\": \"HTTPValidationError\",\n     \"type\": \"object\",\n+    \"description\": \"A collection of messages detailing errors in the input.\",\n     \"properties\": {\n         \"detail\": {\n             \"title\": \"Detail\",\n\n```", "output": "Changes look good. This PR implements: ‚ú® Add descriptions for ValidationError and HTTPValidationError in OpenAPI", "source": "pr", "type": "code_review", "pr_number": 433}
{"instruction": "Review the following code changes: ‚ú® Support QUERY method", "input": "```diff\n@@ -1830,6 +1830,382 @@ def read_items():\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self,\n+        path: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL path to be used for this *path operation*.\n+\n+                For example, in `http://example.com/items`, the path is `/items`.\n+                \"\"\"\n+            ),\n+        ],\n+        *,\n+        response_model: Annotated[\n+            Any,\n+            Doc(\n+                \"\"\"\n+                The type to use for the response.\n+\n+                It could be any valid Pydantic *field* type. So, it doesn't have to\n+                be a Pydantic model, it could be other things, like a `list`, `dict`,\n+                etc.\n+\n+                It will be used for:\n+\n+                * Documentation: the generated OpenAPI (and the UI at `/docs`) will\n+                    show it as the response (JSON Schema).\n+                * Serialization: you could return an arbitrary object and the\n+                    `response_model` would be used to serialize that object into the\n+                    corresponding JSON.\n+                * Filtering: the JSON sent to the client will only contain the data\n+                    (fields) defined in the `response_model`. If you returned an object\n+                    that contains an attribute `password` but the `response_model` does\n+                    not include that field, the JSON sent to the client would not have\n+                    that `password`.\n+                * Validation: whatever you return will be serialized with the\n+                    `response_model`, converting any data as necessary to generate the\n+                    corresponding JSON. But if the data in the object returned is not\n+                    valid, that would mean a violation of the contract with the client,\n+                    so it's an error from the API developer. So, FastAPI will raise an\n+                    error and return a 500 error code (Internal Server Error).\n+\n+                Read more about it in the\n+                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).\n+                \"\"\"\n+            ),\n+        ] = Default(None),\n+        status_code: Annotated[\n+            Optional[int],\n+            Doc(\n+                \"\"\"\n+                The default status code to be used for the response.\n+\n+                You could override the status code by returning a response directly.\n+\n+                Read more about it in the\n+                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).\n+                \"\"\"\n+            ),\n+        ] = None,\n+        tags: Annotated[\n+            Optional[List[Union[str, Enum]]],\n+            Doc(\n+                \"\"\"\n+                A list of tags to be applied to the *path operation*.\n+\n+                It will be added \n\n```\n\n```diff\n@@ -1,3 +1,3 @@\n-METHODS_WITH_BODY = {\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"}\n+METHODS_WITH_BODY = {\"GET\", \"QUERY\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"}\n REF_PREFIX = \"#/components/schemas/\"\n REF_TEMPLATE = \"#/components/schemas/{model}\"\n\n```\n\n```diff\n@@ -1740,6 +1740,386 @@ def read_items():\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self,\n+        path: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL path to be used for this *path operation*.\n+\n+                For example, in `http://example.com/items`, the path is `/items`.\n+                \"\"\"\n+            ),\n+        ],\n+        *,\n+        response_model: Annotated[\n+            Any,\n+            Doc(\n+                \"\"\"\n+                The type to use for the response.\n+\n+                It could be any valid Pydantic *field* type. So, it doesn't have to\n+                be a Pydantic model, it could be other things, like a `list`, `dict`,\n+                etc.\n+\n+                It will be used for:\n+\n+                * Documentation: the generated OpenAPI (and the UI at `/docs`) will\n+                    show it as the response (JSON Schema).\n+                * Serialization: you could return an arbitrary object and the\n+                    `response_model` would be used to serialize that object into the\n+                    corresponding JSON.\n+                * Filtering: the JSON sent to the client will only contain the data\n+                    (fields) defined in the `response_model`. If you returned an object\n+                    that contains an attribute `password` but the `response_model` does\n+                    not include that field, the JSON sent to the client would not have\n+                    that `password`.\n+                * Validation: whatever you return will be serialized with the\n+                    `response_model`, converting any dat", "output": "Changes look good. This PR implements: ‚ú® Support QUERY method", "source": "pr", "type": "code_review", "pr_number": 432}
{"instruction": "Review the following code changes: ‚ú® Add a new class `ConsolidatedOpenAPI` for generating a consolidated OpenAPI schema", "input": "```diff\n@@ -3,7 +3,7 @@\n import warnings\n from typing import Any, Dict, List, Optional, Sequence, Set, Tuple, Type, Union, cast\n \n-from fastapi import routing\n+from fastapi import FastAPI, routing\n from fastapi._compat import (\n     GenerateJsonSchema,\n     JsonSchemaValue,\n@@ -546,3 +546,100 @@ def get_openapi(\n     if tags:\n         output[\"tags\"] = tags\n     return jsonable_encoder(OpenAPI(**output), by_alias=True, exclude_none=True)  # type: ignore\n+\n+\n+class ConsolidatedOpenAPI:\n+    \"\"\"\n+    ConsolidatedOpenAPI is a utility class for combining the OpenAPI schemas of a main FastAPI application and multiple sub-applications.\n+    It generates a consolidated OpenAPI schema that includes the routes of both the main app and the sub-apps.\n+\n+    Usage:\n+        \n```", "output": "Changes look good. This PR implements: ‚ú® Add a new class `ConsolidatedOpenAPI` for generating a consolidated OpenAPI schema", "source": "pr", "type": "code_review", "pr_number": 431}
{"instruction": "Fix the following bug: Fix Annotated forward reference dependencies and HTTPBasic header regression", "input": "## Fix Annotated ForwardRef dependencies and HTTPBasic header regression\r\n\r\n### Bug fixes\r\n\r\nThis PR fixes two regressions:\r\n\r\n1. **Annotated ForwardRef dependencies**\r\n   - Restores correct dependency injection for:\r\n     ```python\r\n     def read(item: Annotated[Item, Depends(get_item)]):\r\n     ```\r\n   - Fixes `422 Unprocessable Entity` caused by unresolved forward references.\r\n\r\n2. **HTTPBasic WWW-Authenticate header**\r\n   - Restores FastAPI's expected behavior:\r\n     ```\r\n     WWW-Authenticate: Basic\r\n     ```\r\n   - Removes unintended `realm=\"fastapi\"` injection that broke OpenAPI clients and tests.\r\n\r\n### Tests\r\n- Fixes `test_annotated_forwardref_dependency`\r\n- Fixes all `test_security_http_basic_*` failures\r\n\r\n### Backwards compatibility\r\n- Restores FastAPI's original behavior for HTTPBasic authentication\r\n- Maintains OpenAPI and Swagger UI compatibility", "output": "```diff\n@@ -1,4 +1,4 @@\n-# Renvoyer directement une r√©ponse\n+# Renvoyer directement une r√©ponse { #return-a-response-directly }\n \n Lorsque vous cr√©ez une *op√©ration de chemins* **FastAPI**, vous pouvez normalement retourner n'importe quelle donn√©e : un `dict`, une `list`, un mod√®le Pydantic, un mod√®le de base de donn√©es, etc.\n \n@@ -10,7 +10,7 @@ Mais vous pouvez retourner une `JSONResponse` directement √† partir de vos *op√©\n \n Cela peut √™tre utile, par exemple, pour retourner des en-t√™tes personnalis√©s ou des cookies.\n \n-## Renvoyer une `Response`\n+## Renvoyer une `Response` { #return-a-response }\n \n En fait, vous pouvez retourner n'importe quelle `Response` ou n'importe quelle sous-classe de celle-ci.\n \n@@ -26,15 +26,15 @@ Elle ne fera aucune conversion de donn√©es avec les mod√®les Pydantic, elle ne c\n \n Cela vous donne beaucoup de flexibilit√©. Vous pouvez retourner n'importe quel type de donn√©es, surcharger n'importe quelle d√©claration ou validation de donn√©es.\n \n-## Utiliser le `jsonable_encoder` dans une `Response`\n+## Utiliser le `jsonable_encoder` dans une `Response` { #using-the-jsonable-encoder-in-a-response }\n \n Parce que **FastAPI** n'apporte aucune modification √† une `Response` que vous retournez, vous devez vous assurer que son contenu est pr√™t √† √™tre utilis√© (s√©rialisable).\n \n Par exemple, vous ne pouvez pas mettre un mod√®le Pydantic dans une `JSONResponse` sans d'abord le convertir en un `dict` avec tous les types de donn√©es (comme `datetime`, `UUID`, etc.) convertis en types compatibles avec JSON.\n \n Pour ces cas, vous pouvez sp√©cifier un appel √† `jsonable_encoder` pour convertir vos donn√©es avant de les passer √† une r√©ponse :\n \n-{* ../../docs_src/response_directly/tutorial001.py hl[6:7,21:22] *}\n+{* ../../docs_src/response_directly/tutorial001_py310.py hl[5:6,20:21] *}\n \n /// note | D√©tails techniques\n \n@@ -44,7 +44,7 @@ Vous pouvez aussi utiliser `from starlette.responses import JSONResponse`.\n \n ///\n \n-## Renvoyer une `Response` personnalis√©e\n+## Renvoyer une `Response` personnalis√©e { #returning-a-custom-response }\n \n L'exemple ci-dessus montre toutes les parties dont vous avez besoin, mais il n'est pas encore tr√®s utile, car vous auriez pu retourner l'`item` directement, et **FastAPI** l'aurait mis dans une `JSONResponse` pour vous, en le convertissant en `dict`, etc. Tout cela par d√©faut.\n \n@@ -54,9 +54,9 @@ Disons que vous voulez retourner une r√©ponse <a href=\"https://en.wikipedia.org/\n \n Vous pouvez mettre votre contenu XML dans une cha√Æne de caract√®res, la placer dans une `Response`, et la retourner :\n \n-{* ../../docs_src/response_directly/tutorial002.py hl[1,18] *}\n+{* ../../docs_src/response_directly/tutorial002_py39.py hl[1,18] *}\n \n-## Notes\n+## Notes { #notes }\n \n Lorsque vous renvoyez une `Response` directement, ses donn√©es ne sont pas valid√©es, converties (s√©rialis√©es), ni document√©es automatiquement.\n \n\n```\n\n```diff\n@@ -1,8 +1,8 @@\n-# Alternatives, inspiration et comparaisons\n+# Alternatives, inspiration et comparaisons { #alternatives-inspiration-and-comparisons }\n \n Ce qui a inspir√© **FastAPI**, comment il se compare √† d'autres solutions et ce qu'il en a appris.\n \n-## Intro\n+## Intro { #intro }\n \n **FastAPI** n'existerait pas sans les pr√©c√©dentes contributions d'autres projets.\n \n@@ -15,9 +15,9 @@ Mais √† un moment donn√© il n'y avait pas d'autre option que de cr√©er quelque c\n fonctionnalit√©s, en reprenant et en combinant de la meilleure fa√ßon possible les meilleures id√©es des outils\n pr√©c√©dents, en utilisant des fonctionnalit√©s du langage qui n'√©taient m√™me pas disponibles auparavant (type hints depuis Python 3.6+).\n \n-## Outils pr√©c√©dents\n+## Outils pr√©c√©dents { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n C'est le framework Python le plus populaire et il b√©n√©ficie d'une grande confiance. Il est utilis√© pour construire\n des syst√®mes tel qu'Instagram.\n@@ -28,7 +28,7 @@ stockage.\n \n Il a √©t√© cr√©√© pour g√©n√©rer le HTML en backend, pas pour cr√©er des API consomm√©es par un frontend moderne (comme React, Vue.js et Angular) ou par d'autres syst√®mes (comme les appareils <abbr title=\"Internet of Things\">IoT</abbr>) communiquant avec lui.\n \n-### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a>\n+### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a> { #django-rest-framework }\n \n Django REST framework a √©t√© con√ßu comme une bo√Æte √† outils flexible permettant de construire des API Web √† partir de Django, afin d'am√©liorer ses capacit√©s en mati√®re d'API.\n \n@@ -49,7 +49,7 @@ Avoir une interface de documentation automatique de l'API.\n \n ///\n \n-### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a>\n+### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a> { #flask }\n \n Flask est un \"micro-framework\", il ne comprend pas d'int√©grations de bases de donn√©es ni beaucoup de choses qui sont fournies par d√©faut dans Django.\n \n@@ -73,7 +73,7 @@ Proposer un syst√®me de routage simple et facile √† utiliser.\n \n ///\n \n-### <a href=\"https://requests.readthedocs.io\" class=\"external-link\" target=\"_blank\">Requests</a>\n+### <a href=\"https://requests.readthedocs.io\" class=\"external-link\" target=\"_blank\">Requests</a> { #requests }\n \n **FastAPI** n'est pas r√©ellement une alternative √† **Requests**. Leur cadre est tr√®s diff√©rent.\n \n@@ -115,7 +115,7 @@ Utiliser les noms de m√©thodes HTTP (op√©rations) directement, de mani√®re simpl\n \n ///\n \n-### <a href=\"https://swagger.io/\" class=\"external-link\" target=\"_blank\">Swagger</a> / <a href=\"https://github.com/OAI/OpenAPI-Specification/\" class=\"external-link\" target=\"_blank\">OpenAP\n\n```\n\n```diff\n@@ -1,10 +1,10 @@\n-# Test de performance\n+# Test de performance { #benchmarks }\n \n Les tests de performance de TechEmpower montrent que les applications **FastAPI** tournant sous Uvicorn comme <a href=\"https://www.techempower.com/benchmarks/#section=test&runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&hw=ph&test=query&l=zijzen-7\" class=\"external-link\" target=\"_blank\">√©tant l'un des frameworks Python les plus rapides disponibles</a>, seulement inf√©rieur √† Starlette et Uvicorn (tous deux utilis√©s au c≈ìur de FastAPI). (*)\n \n Mais en pr√™tant attention aux tests de performance et aux comparaisons, il faut tenir compte de ce qu'il suit.\n \n-## Tests de performance et rapidit√©\n+## Tests de performance et rapidit√© { #benchmarks-and-speed }\n \n Lorsque vous v√©rifiez les tests de performance, il est commun de voir plusieurs outils de diff√©rents types compar√©s comme √©quivalents.\n \n\n```\n\n```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n **FastAPI** vous offre ceci:\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticu\n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 430}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,4 +1,4 @@\n-# Renvoyer directement une r√©ponse\n+# Renvoyer directement une r√©ponse { #return-a-response-directly }\n \n Lorsque vous cr√©ez une *op√©ration de chemins* **FastAPI**, vous pouvez normalement retourner n'importe quelle donn√©e : un `dict`, une `list`, un mod√®le Pydantic, un mod√®le de base de donn√©es, etc.\n \n@@ -10,7 +10,7 @@ Mais vous pouvez retourner une `JSONResponse` directement √† partir de vos *op√©\n \n Cela peut √™tre utile, par exemple, pour retourner des en-t√™tes personnalis√©s ou des cookies.\n \n-## Renvoyer une `Response`\n+## Renvoyer une `Response` { #return-a-response }\n \n En fait, vous pouvez retourner n'importe quelle `Response` ou n'importe quelle sous-classe de celle-ci.\n \n@@ -26,15 +26,15 @@ Elle ne fera aucune conversion de donn√©es avec les mod√®les Pydantic, elle ne c\n \n Cela vous donne beaucoup de flexibilit√©. Vous pouvez retourner n'importe quel type de donn√©es, surcharger n'importe quelle d√©claration ou validation de donn√©es.\n \n-## Utiliser le `jsonable_encoder` dans une `Response`\n+## Utiliser le `jsonable_encoder` dans une `Response` { #using-the-jsonable-encoder-in-a-response }\n \n Parce que **FastAPI** n'apporte aucune modification √† une `Response` que vous retournez, vous devez vous assurer que son contenu est pr√™t √† √™tre utilis√© (s√©rialisable).\n \n Par exemple, vous ne pouvez pas mettre un mod√®le Pydantic dans une `JSONResponse` sans d'abord le convertir en un `dict` avec tous les types de donn√©es (comme `datetime`, `UUID`, etc.) convertis en types compatibles avec JSON.\n \n Pour ces cas, vous pouvez sp√©cifier un appel √† `jsonable_encoder` pour convertir vos donn√©es avant de les passer √† une r√©ponse :\n \n-{* ../../docs_src/response_directly/tutorial001.py hl[6:7,21:22] *}\n+{* ../../docs_src/response_directly/tutorial001_py310.py hl[5:6,20:21] *}\n \n /// note | D√©tails techniques\n \n@@ -44,7 +44,7 @@ Vous pouvez aussi utiliser `from starlette.responses import JSONResponse`.\n \n ///\n \n-## Renvoyer une `Response` personnalis√©e\n+## Renvoyer une `Response` personnalis√©e { #returning-a-custom-response }\n \n L'exemple ci-dessus montre toutes les parties dont vous avez besoin, mais il n'est pas encore tr√®s utile, car vous auriez pu retourner l'`item` directement, et **FastAPI** l'aurait mis dans une `JSONResponse` pour vous, en le convertissant en `dict`, etc. Tout cela par d√©faut.\n \n@@ -54,9 +54,9 @@ Disons que vous voulez retourner une r√©ponse <a href=\"https://en.wikipedia.org/\n \n Vous pouvez mettre votre contenu XML dans une cha√Æne de caract√®res, la placer dans une `Response`, et la retourner :\n \n-{* ../../docs_src/response_directly/tutorial002.py hl[1,18] *}\n+{* ../../docs_src/response_directly/tutorial002_py39.py hl[1,18] *}\n \n-## Notes\n+## Notes { #notes }\n \n Lorsque vous renvoyez une `Response` directement, ses donn√©es ne sont pas valid√©es, converties (s√©rialis√©es), ni document√©es automatiquement.\n \n\n```\n\n```diff\n@@ -1,8 +1,8 @@\n-# Alternatives, inspiration et comparaisons\n+# Alternatives, inspiration et comparaisons { #alternatives-inspiration-and-comparisons }\n \n Ce qui a inspir√© **FastAPI**, comment il se compare √† d'autres solutions et ce qu'il en a appris.\n \n-## Intro\n+## Intro { #intro }\n \n **FastAPI** n'existerait pas sans les pr√©c√©dentes contributions d'autres projets.\n \n@@ -15,9 +15,9 @@ Mais √† un moment donn√© il n'y avait pas d'autre option que de cr√©er quelque c\n fonctionnalit√©s, en reprenant et en combinant de la meilleure fa√ßon possible les meilleures id√©es des outils\n pr√©c√©dents, en utilisant des fonctionnalit√©s du langage qui n'√©taient m√™me pas disponibles auparavant (type hints depuis Python 3.6+).\n \n-## Outils pr√©c√©dents\n+## Outils pr√©c√©dents { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n C'est le framework Python le plus populaire et il b√©n√©ficie d'une grande confiance. Il est utilis√© pour construire", "output": "Bug: Fix Annotated forward reference dependencies and HTTPBasic header regression\n\n## Fix Annotated ForwardRef dependencies and HTTPBasic header regression\r\n\r\n### Bug fixes\r\n\r\nThis PR fixes two regressions:\r\n\r\n1. **Annotated ForwardRef dependencies**\r\n   - Restores correct dependency injection for:\r\n     ```python\r\n     def read(item: Annotated[Item, Depends(get_item)]):\r\n     ```\r\n   - Fixes `422 Unprocessable Entity` caused by unresolved forward references.\r\n\r\n2. **HTTPBasic WWW-Authenticate header**\r\n   - Restores FastAPI's expected behavior:\r\n     ```\r\n     WWW-Authenticate: Basic\r\n     ```\r\n   - Removes unintended `realm=\"fastapi\"` injection that broke OpenAPI clients and tests.\r\n\r\n### Tests\r\n- Fixes `test_annotated_forwardref_dependency`\r\n- Fixes all `test_security_http_basic_*` failures\r\n\r\n### Backwards compatibility\r\n- Restores FastAPI's original behavior for HTTPBasic authentication\r\n- Maintains OpenAPI and Swagger UI compatibility", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 430}
{"instruction": "Review the following code changes: Fix Annotated forward reference dependencies and HTTPBasic header regression", "input": "```diff\n@@ -1,4 +1,4 @@\n-# Renvoyer directement une r√©ponse\n+# Renvoyer directement une r√©ponse { #return-a-response-directly }\n \n Lorsque vous cr√©ez une *op√©ration de chemins* **FastAPI**, vous pouvez normalement retourner n'importe quelle donn√©e : un `dict`, une `list`, un mod√®le Pydantic, un mod√®le de base de donn√©es, etc.\n \n@@ -10,7 +10,7 @@ Mais vous pouvez retourner une `JSONResponse` directement √† partir de vos *op√©\n \n Cela peut √™tre utile, par exemple, pour retourner des en-t√™tes personnalis√©s ou des cookies.\n \n-## Renvoyer une `Response`\n+## Renvoyer une `Response` { #return-a-response }\n \n En fait, vous pouvez retourner n'importe quelle `Response` ou n'importe quelle sous-classe de celle-ci.\n \n@@ -26,15 +26,15 @@ Elle ne fera aucune conversion de donn√©es avec les mod√®les Pydantic, elle ne c\n \n Cela vous donne beaucoup de flexibilit√©. Vous pouvez retourner n'importe quel type de donn√©es, surcharger n'importe quelle d√©claration ou validation de donn√©es.\n \n-## Utiliser le `jsonable_encoder` dans une `Response`\n+## Utiliser le `jsonable_encoder` dans une `Response` { #using-the-jsonable-encoder-in-a-response }\n \n Parce que **FastAPI** n'apporte aucune modification √† une `Response` que vous retournez, vous devez vous assurer que son contenu est pr√™t √† √™tre utilis√© (s√©rialisable).\n \n Par exemple, vous ne pouvez pas mettre un mod√®le Pydantic dans une `JSONResponse` sans d'abord le convertir en un `dict` avec tous les types de donn√©es (comme `datetime`, `UUID`, etc.) convertis en types compatibles avec JSON.\n \n Pour ces cas, vous pouvez sp√©cifier un appel √† `jsonable_encoder` pour convertir vos donn√©es avant de les passer √† une r√©ponse :\n \n-{* ../../docs_src/response_directly/tutorial001.py hl[6:7,21:22] *}\n+{* ../../docs_src/response_directly/tutorial001_py310.py hl[5:6,20:21] *}\n \n /// note | D√©tails techniques\n \n@@ -44,7 +44,7 @@ Vous pouvez aussi utiliser `from starlette.responses import JSONResponse`.\n \n ///\n \n-## Renvoyer une `Response` personnalis√©e\n+## Renvoyer une `Response` personnalis√©e { #returning-a-custom-response }\n \n L'exemple ci-dessus montre toutes les parties dont vous avez besoin, mais il n'est pas encore tr√®s utile, car vous auriez pu retourner l'`item` directement, et **FastAPI** l'aurait mis dans une `JSONResponse` pour vous, en le convertissant en `dict`, etc. Tout cela par d√©faut.\n \n@@ -54,9 +54,9 @@ Disons que vous voulez retourner une r√©ponse <a href=\"https://en.wikipedia.org/\n \n Vous pouvez mettre votre contenu XML dans une cha√Æne de caract√®res, la placer dans une `Response`, et la retourner :\n \n-{* ../../docs_src/response_directly/tutorial002.py hl[1,18] *}\n+{* ../../docs_src/response_directly/tutorial002_py39.py hl[1,18] *}\n \n-## Notes\n+## Notes { #notes }\n \n Lorsque vous renvoyez une `Response` directement, ses donn√©es ne sont pas valid√©es, converties (s√©rialis√©es), ni document√©es automatiquement.\n \n\n```\n\n```diff\n@@ -1,8 +1,8 @@\n-# Alternatives, inspiration et comparaisons\n+# Alternatives, inspiration et comparaisons { #alternatives-inspiration-and-comparisons }\n \n Ce qui a inspir√© **FastAPI**, comment il se compare √† d'autres solutions et ce qu'il en a appris.\n \n-## Intro\n+## Intro { #intro }\n \n **FastAPI** n'existerait pas sans les pr√©c√©dentes contributions d'autres projets.\n \n@@ -15,9 +15,9 @@ Mais √† un moment donn√© il n'y avait pas d'autre option que de cr√©er quelque c\n fonctionnalit√©s, en reprenant et en combinant de la meilleure fa√ßon possible les meilleures id√©es des outils\n pr√©c√©dents, en utilisant des fonctionnalit√©s du langage qui n'√©taient m√™me pas disponibles auparavant (type hints depuis Python 3.6+).\n \n-## Outils pr√©c√©dents\n+## Outils pr√©c√©dents { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n C'est le framework Python le plus populaire et il b√©n√©ficie d'une grande confiance. Il est utilis√© pour construire\n des syst√®mes tel qu'Instagram.\n@@ -28,7 +28,7 @@ stockage.\n \n Il a √©t√© cr√©√© pour g√©n√©rer le HTML en backend, pas pour cr√©er des API consomm√©es par un frontend moderne (comme React, Vue.js et Angular) ou par d'autres syst√®mes (comme les appareils <abbr title=\"Internet of Things\">IoT</abbr>) communiquant avec lui.\n \n-### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a>\n+### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a> { #django-rest-framework }\n \n Django REST framework a √©t√© con√ßu comme une bo√Æte √† outils flexible permettant de construire des API Web √† partir de Django, afin d'am√©liorer ses capacit√©s en mati√®re d'API.\n \n@@ -49,7 +49,7 @@ Avoir une interface de documentation automatique de l'API.\n \n ///\n \n-### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a>\n+### <a href=\"https://flask.palletsprojects.com\" class=\"e", "output": "Changes look good. This PR implements: Fix Annotated forward reference dependencies and HTTPBasic header regression", "source": "pr", "type": "code_review", "pr_number": 430}
{"instruction": "Review the following code changes: Translation workflow", "input": "```diff\n@@ -0,0 +1,729 @@\n+import re\n+from typing import TypedDict\n+\n+CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n+CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n+\n+HEADER_WITH_PERMALINK_RE = re.compile(r\"^(#{1,6}) (.+?)(\\s*\\{\\s*#.*\\s*\\})?\\s*$\")\n+HEADER_LINE_RE = re.compile(r\"^(#{1,6}) (.+?)(?:\\s*\\{\\s*(#.*)\\s*\\})?\\s*$\")\n+\n+TIANGOLO_COM = \"https://fastapi.tiangolo.com\"\n+ASSETS_URL_PREFIXES = (\"/img/\", \"/css/\", \"/js/\")\n+\n+MARKDOWN_LINK_RE = re.compile(\n+    r\"(?<!\\\\)(?<!\\!)\"  # not an image ![...] and not escaped \\[...]\n+    r\"\\[(?P<text>.*?)\\]\"  # link text (non-greedy)\n+    r\"\\(\"\n+    r\"(?P<url>[^)\\s]+)\"  # url (no spaces and `)`)\n+    r'(?:\\s+[\"\\'](?P<title>.*?)[\"\\'])?'  # optional title in \"\" or ''\n+    r\"\\)\"\n+    r\"(?:\\s*\\{(?P<attrs>[^}]*)\\})?\"  # optional attributes in {}\n+)\n+\n+HTML_LINK_RE = re.compile(r\"<a\\s+[^>]*>.*?</a>\")\n+HTML_LINK_TEXT_RE = re.compile(r\"<a\\b([^>]*)>(.*?)</a>\")\n+HTML_LINK_OPEN_TAG_RE = re.compile(r\"<a\\b([^>]*)>\")\n+HTML_ATTR_RE = re.compile(r'(\\w+)\\s*=\\s*([\\'\"])(.*?)\\2')\n+\n+CODE_BLOCK_LANG_RE = re.compile(r\"^`{3,4}([\\w-]*)\", re.MULTILINE)\n+\n+SLASHES_COMMENT_RE = re.compile(\n+    r\"^(?P<code>.*?)(?P<comment>(?:(?<= )// .*)|(?:^// .*))?$\"\n+)\n+\n+HASH_COMMENT_RE = re.compile(r\"^(?P<code>.*?)(?P<comment>(?:(?<= )# .*)|(?:^# .*))?$\")\n+\n+\n+class CodeIncludeInfo(TypedDict):\n+    line_no: int\n+    line: str\n+\n+\n+class HeaderPermalinkInfo(TypedDict):\n+    line_no: int\n+    hashes: str\n+    title: str\n+    permalink: str\n+\n+\n+class MarkdownLinkInfo(TypedDict):\n+    line_no: int\n+    url: str\n+    text: str\n+    title: str | None\n+    attributes: str | None\n+    full_match: str\n+\n+\n+class HTMLLinkAttribute(TypedDict):\n+    name: str\n+    quote: str\n+    value: str\n+\n+\n+class HtmlLinkInfo(TypedDict):\n+    line_no: int\n+    full_tag: str\n+    attributes: list[HTMLLinkAttribute]\n+    text: str\n+\n+\n+class MultilineCodeBlockInfo(TypedDict):\n+    lang: str\n+    start_line_no: int\n+    content: list[str]\n+\n+\n+# Code includes\n+# -----------------------------------------------------------------------------------------\n+\n+\n+def extract_code_includes(lines: list[str]) -> list[CodeIncludeInfo]:\n+    \"\"\"\n+    Exctract lines that contain code includes.\n+\n+    Return list of CodeIncludeInfo namedtuples, where each tuple contains:\n+    - `line_no` - line number (1-based)\n+    - `line` - text of the line\n+    \"\"\"\n+\n+    includes: list[CodeIncludeInfo] = []\n+    for line_no, line in enumerate(lines, start=1):\n+        if CODE_INCLUDE_RE.match(line):\n+            includes.append(CodeIncludeInfo(line_no=line_no, line=line))\n+    return includes\n+\n+\n+def replace_code_includes_with_placeholders(text: list[str]) -> list[str]:\n+    \"\"\"\n+    Replace code includes with placeholders.\n+    \"\"\"\n+\n+    modified_text = text.copy()\n+    includes = extract_code_includes(text)\n+    for include in includes:\n+        modified_text[include[\"line_no\"] - 1] = CODE_INCLUDE_PLACEHOLDER\n+    return modified_text\n+\n+\n+def replace_placeholders_with_code_includes(\n+    text\n\n```\n\n```diff\n@@ -0,0 +1,32 @@\n+import shutil\n+from pathlib import Path\n+\n+import pytest\n+from typer.testing import CliRunner\n+\n+\n+@pytest.fixture(name=\"runner\")\n+def get_runner():\n+    runner = CliRunner()\n+    with runner.isolated_filesystem():\n+        yield runner\n+\n+\n+@pytest.fixture(name=\"root_dir\")\n+def prepare_paths(runner):\n+    docs_dir = Path(\"docs\")\n+    en_docs_dir = docs_dir / \"en\" / \"docs\"\n+    lang_docs_dir = docs_dir / \"lang\" / \"docs\"\n+    en_docs_dir.mkdir(parents=True, exist_ok=True)\n+    lang_docs_dir.mkdir(parents=True, exist_ok=True)\n+    yield Path.cwd()\n+\n+\n+@pytest.fixture\n+def copy_test_files(root_dir: Path, request: pytest.FixtureRequest):\n+    en_file_path = Path(request.param[0])\n+    translation_file_path = Path(request.param[1])\n+    shutil.copy(str(en_file_path), str(root_dir / \"docs\" / \"en\" / \"docs\" / \"doc.md\"))\n+    shutil.copy(\n+        str(translation_file_path), str(root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\")\n+    )\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```", "output": "Changes look good. This PR implements: Translation workflow", "source": "pr", "type": "code_review", "pr_number": 429}
{"instruction": "Review the following code changes: Docs/add dutch translations", "input": "```diff\n@@ -319,6 +319,8 @@ extra:\n     name: es - espa√±ol\n   - link: /ko/\n     name: ko - ÌïúÍµ≠Ïñ¥\n+  - link: /nl/\n+    name: nl - Nederlands\n   - link: /pt/\n     name: pt - portugu√™s\n   - link: /ru/\n\n```\n\n```diff\n@@ -0,0 +1,503 @@\n+# LLM Testbestand { #llm-test-file }\n+\n+Dit document test of de <abbr title=\"Large Language Model - Groot taalmodel\">LLM</abbr>, die de documentatie vertaalt, de `general_prompt` in `scripts/translate.py` en de taalspecifieke prompt in `docs/{language code}/llm-prompt.md` begrijpt. De taalspecifieke prompt wordt toegevoegd aan het einde van `general_prompt`.\n+\n+De tests die hier worden toegevoegd zullen worden gezien door alle mensen die taalspecifieke prompts ontwerpen.\n+\n+Gebruik het als volgt:\n+\n+* Heb een taalspecifieke prompt - `docs/{language code}/llm-prompt.md`.\n+* Maak een nieuwe vertaling van dit document naar je doeltaal (zie bijvoorbeeld het `translate-page` commando van `translate.py`). Dit zal de vertaling aanmaken in `docs/{language code}/docs/_llm-test.md`.\n+* Controleer of de dingen goed zijn in de vertaling.\n+* Indien nodig, verbeter je taalspecifieke prompt, de algemene prompt, of het Engelse document.\n+* Corrigeer vervolgens handmatig de resterende problemen in de vertaling zodat het een goede vertaling is.\n+* Vertaal opnieuw, met de goede vertaling op zijn plaats. Het ideale resultaat zou zijn dat de LLM geen wijzigingen meer aanbrengt in de vertaling. Dat betekent dat de algemene prompt en je taalspecifieke prompt zo goed zijn als ze kunnen zijn (Soms zal het enkele schijnbaar willekeurige wijzigingen maken; de reden is dat <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM's geen deterministische algoritmes zijn</a>).\n+\n+De tests:\n+\n+## Code snippets { #code-snippets }\n+\n+//// tab | Test\n+\n+Dit is een code snippet: `foo`. En dit is een ander code snippet: `bar`. En nog een: `baz quux`.\n+\n+////\n+\n+//// tab | Info\n+\n+De inhoud van code snippets moet onveranderd worden gelaten.\n+\n+Zie de sectie `### Content of code snippets` in de algemene prompt in `scripts/translate.py`.\n+\n+////\n+\n+## Aanhalingstekens { #quotes }\n+\n+//// tab | Test\n+\n+Gisteren schreef mijn vriend: \"Als je 'incorrectly' correct schrijft, heb je het incorrect geschreven\". Waarop ik antwoordde: \"Correct, maar 'incorrectly' is incorrect, niet '\"incorrectly\"'\".\n+\n+/// note | Opmerking\n+\n+De LLM zal dit waarschijnlijk verkeerd vertalen. Wat interessant is, is of het de gecorrigeerde vertaling behoudt bij het opnieuw vertalen.\n+\n+///\n+\n+////\n+\n+//// tab | Info\n+\n+De persoon die de prompt ontwerpt kan kiezen of hij neutrale aanhalingstekens wil omzetten naar typografische aanhalingstekens. Het is ook prima om ze te laten zoals ze zijn.\n+\n+Zie bijvoorbeeld de sectie `### Quotes` in `docs/de/llm-prompt.md`.\n+\n+////\n+\n+## Aanhalingstekens in code snippets { #quotes-in-code-snippets }\n+\n+//// tab | Test\n+\n+`pip install \"foo[bar]\"`\n+\n+Voorbeelden van string literals in code snippets: `\"this\"`, `'that'`.\n+\n+Een moeilijk voorbeeld van string literals in code snippets: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+Hardcore: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you \n\n```\n\n```diff\n@@ -0,0 +1,565 @@\n+# FastAPI { #fastapi }\n+\n+<style>\n+.md-content .md-typeset h1 { display: none; }\n+</style>\n+\n+<p align=\"center\">\n+  <a href=\"https://fastapi.tiangolo.com/nl\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n+</p>\n+<p align=\"center\">\n+    <em>Het FastAPI-framework, hoge prestaties, makkelijk te leren, snel te coderen, klaar voor productie</em>\n+</p>\n+<p align=\"center\">\n+<a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n+    <img src=\"https://github.com/fastapi/fastapi/actions/workflows/test.yml/badge.svg?event=push&branch=master\" alt=\"Test\">\n+</a>\n+<a href=\"https://coverage-badge.samuelcolvin.workers.dev/redirect/fastapi/fastapi\" target=\"_blank\">\n+    <img src=\"https://coverage-badge.samuelcolvin.workers.dev/fastapi/fastapi.svg\" alt=\"Coverage\">\n+</a>\n+<a href=\"https://pypi.org/project/fastapi\" target=\"_blank\">\n+    <img src=\"https://img.shields.io/pypi/v/fastapi?color=%2334D058&label=pypi%20package\" alt=\"Package version\">\n+</a>\n+<a href=\"https://pypi.org/project/fastapi\" target=\"_blank\">\n+    <img src=\"https://img.shields.io/pypi/pyversions/fastapi.svg?color=%2334D058\" alt=\"Supported Python versions\">\n+</a>\n+</p>\n+\n+---\n+\n+**Documentatie**: <a href=\"https://fastapi.tiangolo.com/nl\" target=\"_blank\">https://fastapi.tiangolo.com</a>\n+\n+**Broncode**: <a href=\"https://github.com/fastapi/fastapi\" target=\"_blank\">https://github.com/fastapi/fastapi</a>\n+\n+---\n+\n+FastAPI is een modern, snel (high-performance) webframework voor het bouwen van API's met Python, gebaseerd op standaard Python type hints.\n+\n+De belangrijkste kenmerken zijn:\n+\n+* **Snel**: Zeer hoge prestaties, vergelijkbaar met **NodeJS** en **Go** (dankzij Starlett", "output": "Changes look good. This PR implements: Docs/add dutch translations", "source": "pr", "type": "code_review", "pr_number": 428}
{"instruction": "Review the following code changes: docs: Update outdated GitHub Actions version", "input": "```diff\n@@ -26,7 +26,7 @@ jobs:\n         run: echo \"$GITHUB_CONTEXT\"\n       # pin to actions/checkout@v5 for compatibility with latest-changes\n       # Ref: https://github.com/actions/checkout/issues/2313\n-      - uses: actions/checkout@v5\n+      - uses: actions/checkout@v6\n         with:\n           # To allow latest-changes to commit to the main branch\n           token: ${{ secrets.FASTAPI_LATEST_CHANGES }}\n\n```", "output": "Changes look good. This PR implements: docs: Update outdated GitHub Actions version", "source": "pr", "type": "code_review", "pr_number": 427}
{"instruction": "Review the following code changes: Replace deprecated pydantic.color with pydantic-extra-types", "input": "```diff\n@@ -21,10 +21,10 @@\n from fastapi.exceptions import PydanticV1NotSupportedError\n from fastapi.types import IncEx\n from pydantic import BaseModel\n-from pydantic.color import Color\n from pydantic.networks import AnyUrl, NameEmail\n from pydantic.types import SecretBytes, SecretStr\n from pydantic_core import PydanticUndefinedType\n+from pydantic_extra_types.color import Color\n \n from ._compat import (\n     Url,\n\n```", "output": "Changes look good. This PR implements: Replace deprecated pydantic.color with pydantic-extra-types", "source": "pr", "type": "code_review", "pr_number": 426}
{"instruction": "Review the following code changes: Overhaul `solve_dependencies()` for performance", "input": "```diff\n@@ -18,7 +18,7 @@ For those cases, you can use a `Response` parameter.\n \n You can declare a parameter of type `Response` in your *path operation function* (as you can do for cookies and headers).\n \n-And then you can set the `status_code` in that *temporal* response object.\n+And then you can set the `status_code` in that *temporary* response object.\n \n \n```\n\n```diff\n@@ -4,7 +4,7 @@\n \n You can declare a parameter of type `Response` in your *path operation function*.\n \n-And then you can set cookies in that *temporal* response object.\n+And then you can set cookies in that *temporary* response object.\n \n \n```\n\n```diff\n@@ -56,3 +56,6 @@ def __init__(\n         self.path = path\n         # Save the cache key at creation to optimize performance\n         self.cache_key = (self.call, tuple(sorted(set(self.security_scopes or []))))\n+        # callables which get any built-in dependencies\n+        self.dependency_getters: Optional[List[Any]] = None\n+        self.async_dependency_getters: Optional[List[Any]] = None\n\n```\n\n```diff\n@@ -4,14 +4,14 @@\n from copy import deepcopy\n from typing import (\n     Any,\n+    Awaitable,\n     Callable,\n     Coroutine,\n     Dict,\n     ForwardRef,\n     List,\n     Mapping,\n     Optional,\n-    Sequence,\n     Tuple,\n     Type,\n     Union,\n@@ -334,6 +334,17 @@ def get_dependant(\n                 field_info, params.Body\n             ), f\"Param: {param_field.name} can only be a request body, using Body()\"\n             dependant.body_params.append(param_field)\n+\n+    #  Get built-in dependenencies\n+    dependency_getters = get_dependent_dependency_getters(dependant)\n+    dependant.dependency_getters = (\n+        list(filter(lambda f: not inspect.iscoroutinefunction(f), dependency_getters))\n+        or None\n+    )\n+    dependant.async_dependency_getters = (\n+        list(filter(lambda f: inspect.iscoroutinefunction(f), dependency_getters))\n+        or None\n+    )\n     return dependant\n \n \n@@ -464,77 +475,76 @@ async def solve_generator(\n     return await stack.enter_async_context(cm)\n \n \n+@dataclasses.dataclass\n+class DependencySolverContext:\n+    request: Union[Request, WebSocket]\n+    body: Optional[Union[Dict[str, Any], FormData]] = None\n+    dependency_overrides_provider: dataclasses.InitVar[Optional[Any]] = None\n+    dependency_overrides: Optional[Dict[Any, Any]] = dataclasses.field(init=False)\n+    response: Optional[Response] = None\n+    background_tasks: Optional[BackgroundTasks] = None\n+    dependency_cache: Dict[\n+        Tuple[Callable[..., Any], Tuple[str]], Any\n+    ] = dataclasses.field(default_factory=dict)\n+    values: Dict[str, Any] = dataclasses.field(default_factory=dict)\n+    errors: List[ErrorWrapper] = dataclasses.field(default_factory=list)\n+\n+    def __post_init__(self, dependency_overrides_provider: Optional[Any]) -> None:\n+        self.dependency_overrides = (\n+            getattr(dependency_overrides_provider, \"dependency_overrides\", None) or None\n+        )\n+\n+\n+DependencyGetter = Union[\n+    Callable[[DependencySolverContext], None],\n+    Callable[[DependencySolverContext], Awaitable[None]],\n+]\n+\n+\n async def solve_dependencies(\n     *,\n-    request: Union[Request, WebSocket],\n+    context: DependencySolverContext,\n     dependant: Dependant,\n-    body: Optional[Union[Dict[str, Any], FormData]] = None,\n-    background_tasks: Optional[BackgroundTasks] = None,\n-    response: Optional[Response] = None,\n-    dependency_overrides_provider: Optional[Any] = None,\n-    dependency_cache: Optional[Dict[Tuple[Callable[..., Any], Tuple[str]], Any]] = None,\n-) -> Tuple[\n-    Dict[str, Any],\n-    List[ErrorWrapper],\n-    Optional[BackgroundTasks],\n-    Response,\n-    Dict[Tuple[Callable[..., Any], Tuple[str]], Any],\n-]:\n+) -> Tuple[Dict[str, Any], List[ErrorWrapper]]:\n     values: Dict[str, Any] = {}\n     errors: List[ErrorWrapper] = []\n-    if response is None:\n-        response = Response()\n-        del response.headers[\"content-length\"]\n-        response.status_code = None  # type: ignore\n-    dependency_cache = dependency_cache or\n\n```\n\n```diff\n@@ -23,6 +23,7 @@\n from fastapi.datastructures import Default, DefaultPlaceholder\n from fastapi.dependencies.models import Dependant\n from fastapi.dependencies.utils import (\n+    DependencySolverContext,\n     get_body_field,\n     get_dependant,\n     get_parameterless_sub_dependant,\n@@ -224,13 +225,15 @@ async def app(request: Request) -> Response:\n             raise HTTPException(\n                 status_code=400, detail=\"There was an error parsing the body\"\n             ) from e\n-        solved_result = await solve_dependencies(\n+        context = DependencySolverContext(\n             request=request,\n-            dependant=dependant,\n             body=body,\n             dependency_overrides_provider=dependency_overrides_provider,\n         )\n-        values, errors, background_tasks, sub_response, _ = solved_result\n+        values, errors = await solve_dependencies(\n+            context=context,\n+            dependant=dependant,\n+ ", "output": "Code Review for: Overhaul `solve_dependencies()` for performance\n\nüìù **fastapi/dependencies/utils.py**: Why are you using `dataclases.dataclass` here instead of Pydantic?\r\n\r\nI just want to know if there's a reason in particular\n\nüìù **fastapi/dependencies/utils.py**: Dataclass is basically a quick way to declare a class with initializers.  I'm not looking for pydantic's validation.  This is supposed to be low overhead.\r\nCould have used a plain class instead and written my own `__init__()`.\r\nCould also have made the solve_dependencies() an instance method, but I don't see much of that kind of programming style in FastAPI so I left it functional.\n\nüìù **fastapi/dependencies/utils.py**: Indeed, very good PR. I really liked it.\n\nüìù **fastapi/dependencies/utils.py**: It's tricky.  The thing is often dependencies don't do any IO at all, but they are marked `async` to be **not** marked sync.  All sync dependencies get run from a threadpool, because they **potentially** block.   This is a huge performance waste for a dependency which does something relatively simple without any IO.\r\n\r\nSimilarly, calling `asyncio.gather` on a bunch of `async` dependencies which don't do any IO is potentially quite wasteful.  It means that each will have a `Task` created and that we have to go and have a whole loop through the event loop while these Tasks are scheduled and run to completion.   This will cause some unnecessary latency.\r\n\r\nSo, I'm not super convinced that it should be _automatically_ done.  I think we should leave that up to the application to decide if multiple dependencies can be wrapped in a single common dependency and then explicitly call `asyncio.gather`\r\n\r\nAt least, we'd need to do some performance testing before deciding to go down that route.   And I'd like for it to be a separate PR, because that would be a significant change in logic.\n\nüìù **fastapi/dependencies/utils.py**: Sure, we can do that, but see my other comment about automatically gathering.  We'd have to to some performance tests to make sure it doesn't slow down simple getters.\n\n", "source": "pr", "type": "code_review", "pr_number": 425}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -454,77 +455,76 @@ async def solve_generator(\n     return await stack.enter_async_context(cm)\n \n \n+@dataclasses.dataclass\n+class DependencySolverContext:\n\n```", "output": "Why are you using `dataclases.dataclass` here instead of Pydantic?\r\n\r\nI just want to know if there's a reason in particular", "source": "pr_review", "type": "inline_review", "pr_number": 425}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -535,90 +535,188 @@ async def solve_dependencies(\n             solved = await run_in_threadpool(call, **sub_values)\n         if sub_dependant.name is not None:\n             values[sub_dependant.name] = solved\n-        if sub_dependant.cache_key not in dependency_cache:\n-            dependency_cache[sub_dependant.cache_key] = solved\n-    path_values, path_errors = request_params_to_args(\n-        dependant.path_params, request.path_params\n-    )\n-    query_values, query_errors = request_params_to_args(\n-        dependant.query_params, request.query_params\n-    )\n-    header_values, header_errors = request_params_to_args(\n-        dependant.header_params, request.headers\n-    )\n-    cookie_values, cookie_errors = request_params_to_args(\n-        dependant.cookie_params, request.cookies\n-    )\n-    values.update(path_values)\n-    values.update(query_values)\n-    values.update(header_values)\n-    values.update(cookie_values)\n-    errors += path_errors + query_errors + header_errors + cookie_errors\n+        context.dependency_cache[cache_key] = solved\n+\n+    # solve built-in dependencies\n+    if dependant.dependency_getters:\n+        context.values = values\n+        context.errors = errors\n+        for dependency_getter in dependant.dependency_getters:\n+            if inspect.iscoroutinefunction(dependency_getter):\n\n```", "output": "Sure, we can do that, but see my other comment about automatically gathering.  We'd have to to some performance tests to make sure it doesn't slow down simple getters.", "source": "pr_review", "type": "inline_review", "pr_number": 425}
{"instruction": "Review the following code changes: ‚ö°Ô∏è Parallelize dependency resolution", "input": "```diff\n@@ -1,5 +1,57 @@\n # Advanced Dependencies { #advanced-dependencies }\n \n+## Parallel dependency resolution (opt-in) { #parallel-dependency-resolution-opt-in }\n+\n+FastAPI can resolve independent dependencies in parallel to reduce overall latency.\n+\n+This is disabled by default. You can opt in per-application, and you can also control\n+it per dependency.\n+\n+- Application-wide default (disabled by default):\n+  - Set `depends_default_parallelizable=True` in `FastAPI(...)` to allow parallel\n+    resolution by default.\n+- Per-dependency override:\n+  - Use `Depends(..., parallelizable=True | False)` (and the same for `Security(...)`).\n+  - If not provided, the application default is used.\n+\n+When parallelization is enabled, dependencies at the same level of the dependency graph\n+that are not \"context sensitive\" will be resolved concurrently.\n+\n+Context sensitive dependencies are always resolved sequentially:\n+\n+- Dependencies implemented with `yield` (generator or async generator dependencies).\n+- Dependencies explicitly marked with `parallelizable=False`.\n+\n+Dependency errors are still raised in the order of declaration, even if resolved in\n+parallel. Caching (`use_cache=True`, the default) still works per request: concurrent\n+callers share a single in-flight execution and the same result.\n+\n+### Enable globally\n+\n+{* ../../docs_src/dependencies/parallel_global_opt_in.py *}\n+\n+### Enable/disable per dependency\n+\n+{* ../../docs_src/dependencies/parallel_per_dep_enable.py *}\n+\n+You can also opt out for a specific dependency when the app default is parallel:\n+\n+{* ../../docs_src/dependencies/parallel_per_dep_disable.py *}\n+\n+### Security dependencies\n+\n+`Security(...)` supports the same `parallelizable` flag. Caching for security dependencies\n+respects OAuth2 scopes: dependencies with the same scopes share a cached value within\n+one request, different scopes result in separate executions.\n+\n+{* ../../docs_src/dependencies/parallel_security.py *}\n+\n+### Notes\n+\n+- Sync (regular `def`) dependencies participate via a threadpool.\n+- Generator (`yield`) dependencies are always sequential.\n+- Errors from dependencies are raised respecting the declaration order.\n+\n ## Parameterized dependencies { #parameterized-dependencies }\n \n All the dependencies we have seen are a fixed function or class.\n\n```\n\n```diff\n@@ -5,7 +5,6 @@\n Dependencies are handled mainly with the special function `Depends()` that takes a callable.\n \n Here is the reference for it and its parameters.\n-\n You can import it directly from `fastapi`:\n \n \n```\n\n```diff\n@@ -0,0 +1,3 @@\n+from fastapi import FastAPI\n+\n+app = FastAPI(depends_default_parallelizable=True)\n\n```\n\n```diff\n@@ -0,0 +1,16 @@\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+\n+app = FastAPI(depends_default_parallelizable=True)\n+\n+\n+async def dep_seq() -> int:\n+    return 1\n+\n+\n+@app.get(\"/users\")\n+async def read_users(\n+    x: Annotated[int, Depends(dep_seq, parallelizable=False)],\n+):\n+    return {\"x\": x}\n\n```\n\n```diff\n@@ -0,0 +1,21 @@\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+\n+app = FastAPI(depends_default_parallelizable=False)\n+\n+\n+async def dep_a() -> int:\n+    return 1\n+\n+\n+async def dep_b() -> int:\n+    return 2\n+\n+\n+@app.get(\"/items\")\n+async def read_items(\n+    a: Annotated[int, Depends(dep_a, parallelizable=True)],\n+    b: Annotated[int, Depends(dep_b, parallelizable=True)],\n+):\n+    return {\"a\": a, \"b\": b}\n\n```", "output": "Code Review for: ‚ö°Ô∏è Parallelize dependency resolution\n\nüìù **tests/test_dependency_cache.py**: Here I had to change this to the topmost dep, because one level lower already resolves just a tiny bit later and in that case this test is not valid anymore.\n\nüìù **fastapi/dependencies/utils.py**: Tests case needed.\n\nüìù **fastapi/dependencies/utils.py**: Tests case needed.\n\n", "source": "pr", "type": "code_review", "pr_number": 424}
{"instruction": "Review this code change in `tests/test_dependency_cache.py`", "input": "```diff\n@@ -29,7 +29,7 @@ async def get_sub_counter(\n \n @app.get(\"/sub-counter-no-cache/\")\n async def get_sub_counter_no_cache(\n-    subcount: int = Depends(super_dep),\n+    subcount: int = Depends(dep_counter),\n\n```", "output": "Here I had to change this to the topmost dep, because one level lower already resolves just a tiny bit later and in that case this test is not valid anymore.", "source": "pr_review", "type": "inline_review", "pr_number": 424}
{"instruction": "Review the following code changes: Theme toggle functionality to Swagger UI", "input": "```diff\n@@ -121,8 +121,81 @@ def get_swagger_ui_html(\n     <link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n     <link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n     <title>{title}</title>\n+    <style>\n+        #theme-toggle {{\n+            position: fixed;\n+            top: 15px;\n+            right: 15px;\n+            z-index: 9999;\n+            display: flex;\n+            align-items: center;\n+            justify-content: center;\n+            gap: 8px;\n+            padding: 10px 16px;\n+            font-size: 14px;\n+            font-weight: 500;\n+            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n+            border: none;\n+            border-radius: 8px;\n+            cursor: pointer;\n+            transition: all 0.3s ease;\n+            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n+            background: #ffffff;\n+            color: #333333;\n+        }}\n+\n+        .dark-mode #theme-toggle {{\n+            background: #2d2d2d;\n+            color: #e0e0e0;\n+            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n+        }}\n+\n+        #theme-toggle:hover {{\n+            transform: translateY(-2px);\n+            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n+        }}\n+\n+        .dark-mode #theme-toggle:hover {{\n+            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);\n+        }}\n+\n+        #theme-toggle:active {{\n+            transform: translateY(0);\n+        }}\n+\n+        #theme-toggle svg {{\n+            width: 18px;\n+            height: 18px;\n+            transition: transform 0.3s ease;\n+        }}\n+\n+        #theme-toggle:hover svg {{\n+            transform: rotate(15deg);\n+        }}\n+\n+        .theme-icon-sun {{\n+            display: none;\n+        }}\n+\n+        .dark-mode .theme-icon-sun {{\n+            display: inline-block;\n+        }}\n+\n+        .dark-mode .theme-icon-moon {{\n+            display: none;\n+        }}\n+    </style>\n     </head>\n     <body>\n+    <button id=\"theme-toggle\" type=\"button\" aria-label=\"Toggle theme\">\n+        <svg class=\"theme-icon-moon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n+            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\"></path>\n+        </svg>\n+        <svg class=\"theme-icon-sun\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n+            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\"></path>\n+        </svg>\n+        <span id=\"theme-toggle-text\">Toggle theme</span>\n+    </button>\n     <div id=\"swagger-ui\">\n     </div>\n     <script src=\"{swagger_js_url}\"></script>\n@@ -152,6 +225,35 @@ def get_swagger_ui_html(\n \n     html += \"\"\"\n     </script>\n+    \n\n```", "output": "Changes look good. This PR implements: Theme toggle functionality to Swagger UI", "source": "pr", "type": "code_review", "pr_number": 422}
{"instruction": "Fix the following bug: üêõ Fix copy button in custom.js", "input": "I saw this bug in this discussion: https://github.com/fastapi/fastapi/discussions/14002\r\nAnd I'm happy to contribute, even if it's a very small start\r\n\r\n**Issue**: clicking the copy button was not working (error message in console)\r\n\r\n**Fix**: the copy button is looking for a code tag, which doesn't exist, because it's replaced by a div in custom.js. I modified custom.js to put the div after the code tag, not in place\r\n\r\n**Testing**: Tested locally on the fastAPI docs page.", "output": "```diff\n@@ -81,8 +81,14 @@ function setupTermynal() {\n                     }\n                 }\n                 saveBuffer();\n+                const inputCommands = useLines\n+                    .filter(line => line.type === \"input\")\n+                    .map(line => line.value)\n+                    .join(\"\\n\");\n+                node.textContent = inputCommands;\n                 const div = document.createElement(\"div\");\n-                node.replaceWith(div);\n+                node.style.display = \"none\";\n+                node.after(div);\n                 const termynal = new Termynal(div, {\n                     lineData: useLines,\n                     noInit: true,\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 421}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -81,8 +81,14 @@ function setupTermynal() {\n                     }\n                 }\n                 saveBuffer();\n+                const inputCommands = useLines\n+                    .filter(line => line.type === \"input\")\n+                    .map(line => line.value)\n+                    .join(\"\\n\");\n+                node.textContent = inputCommands;\n                 const div = document.createElement(\"div\");\n-                node.replaceWith(div);\n+                node.style.display = \"none\";\n+                node.after(div);\n                 const termynal = new Termynal(div, {\n                     lineData: useLines,\n                     noInit: true,\n\n```", "output": "Bug: üêõ Fix copy button in custom.js\n\nI saw this bug in this discussion: https://github.com/fastapi/fastapi/discussions/14002\r\nAnd I'm happy to contribute, even if it's a very small start\r\n\r\n**Issue**: clicking the copy button was not working (error message in console)\r\n\r\n**Fix**: the copy button is looking for a code tag, which doesn't exist, because it's replaced by a div in custom.js. I modified custom.js to put the div after the code tag, not in place\r\n\r\n**Testing**: Tested locally on the fastAPI docs page.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 421}
{"instruction": "Review the following code changes: üêõ Fix copy button in custom.js", "input": "```diff\n@@ -81,8 +81,14 @@ function setupTermynal() {\n                     }\n                 }\n                 saveBuffer();\n+                const inputCommands = useLines\n+                    .filter(line => line.type === \"input\")\n+                    .map(line => line.value)\n+                    .join(\"\\n\");\n+                node.textContent = inputCommands;\n                 const div = document.createElement(\"div\");\n-                node.replaceWith(div);\n+                node.style.display = \"none\";\n+                node.after(div);\n                 const termynal = new Termynal(div, {\n                     lineData: useLines,\n                     noInit: true,\n\n```", "output": "Changes look good. This PR implements: üêõ Fix copy button in custom.js", "source": "pr", "type": "code_review", "pr_number": 421}
{"instruction": "Review the following code changes: üåê Update translations for ko (add-missing)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# LLM ÌÖåÏä§Ìä∏ ÌååÏùº { #llm-test-file }\n+\n+Ïù¥ Î¨∏ÏÑúÎäî Î¨∏ÏÑúÎ•º Î≤àÏó≠ÌïòÎäî <abbr title=\"Large Language Model - ÎåÄÍ∑úÎ™® Ïñ∏Ïñ¥ Î™®Îç∏\">LLM</abbr>Ïù¥ `scripts/translate.py`Ïùò `general_prompt`ÏôÄ `docs/{language code}/llm-prompt.md`Ïùò Ïñ∏Ïñ¥Î≥Ñ ÌîÑÎ°¨ÌîÑÌä∏Î•º Ïù¥Ìï¥ÌïòÎäîÏßÄ ÌÖåÏä§Ìä∏Ìï©ÎãàÎã§. Ïñ∏Ïñ¥Î≥Ñ ÌîÑÎ°¨ÌîÑÌä∏Îäî `general_prompt`Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§.\n+\n+Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎêú ÌÖåÏä§Ìä∏Îäî Ïñ∏Ïñ¥Î≥Ñ ÌîÑÎ°¨ÌîÑÌä∏Î•º ÏÑ§Í≥ÑÌïòÎäî Î™®Îì† ÏÇ¨ÎûåÏù¥ Î≥¥Í≤å Îê©ÎãàÎã§.\n+\n+ÏÇ¨Ïö© Î∞©Î≤ïÏùÄ Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§:\n+\n+* Ïñ∏Ïñ¥Î≥Ñ ÌîÑÎ°¨ÌîÑÌä∏ `docs/{language code}/llm-prompt.md`Î•º Ï§ÄÎπÑÌï©ÎãàÎã§.\n+* Ïù¥ Î¨∏ÏÑúÎ•º ÏõêÌïòÎäî ÎåÄÏÉÅ Ïñ∏Ïñ¥Î°ú ÏÉàÎ°ú Î≤àÏó≠Ìï©ÎãàÎã§(Ïòà: `translate.py`Ïùò `translate-page` Î™ÖÎ†π). Í∑∏Îü¨Î©¥ `docs/{language code}/docs/_llm-test.md` ÏïÑÎûòÏóê Î≤àÏó≠Ïù¥ ÏÉùÏÑ±Îê©ÎãàÎã§.\n+* Î≤àÏó≠ÏóêÏÑú Î¨∏Ï†úÍ∞Ä ÏóÜÎäîÏßÄ ÌôïÏù∏Ìï©ÎãàÎã§.\n+* ÌïÑÏöîÌïòÎã§Î©¥ Ïñ∏Ïñ¥Î≥Ñ ÌîÑÎ°¨ÌîÑÌä∏, ÏùºÎ∞ò ÌîÑÎ°¨ÌîÑÌä∏, ÎòêÎäî ÏòÅÏñ¥ Î¨∏ÏÑúÎ•º Í∞úÏÑ†Ìï©ÎãàÎã§.\n+* Í∑∏Îü∞ Îã§Ïùå Î≤àÏó≠ÏóêÏÑú ÎÇ®ÏïÑ ÏûàÎäî Î¨∏Ï†úÎ•º ÏàòÎèôÏúºÎ°ú ÏàòÏ†ïÌï¥ Ï¢ãÏùÄ Î≤àÏó≠Ïù¥ ÎêòÍ≤å Ìï©ÎãàÎã§.\n+* Ï¢ãÏùÄ Î≤àÏó≠ÏùÑ Îëî ÏÉÅÌÉúÏóêÏÑú Îã§Ïãú Î≤àÏó≠Ìï©ÎãàÎã§. Ïù¥ÏÉÅÏ†ÅÏù∏ Í≤∞Í≥ºÎäî LLMÏù¥ Îçî Ïù¥ÏÉÅ Î≤àÏó≠Ïóê Î≥ÄÍ≤ΩÏùÑ ÎßåÎì§ÏßÄ ÏïäÎäî Í≤ÉÏûÖÎãàÎã§. Ïù¥Îäî ÏùºÎ∞ò ÌîÑÎ°¨ÌîÑÌä∏ÏôÄ Ïñ∏Ïñ¥Î≥Ñ ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä Í∞ÄÎä•Ìïú Ìïú ÏµúÏÑ†Ïù¥ÎùºÎäî ÎúªÏûÖÎãàÎã§(ÎïåÎïåÎ°ú Î™á Í∞ÄÏßÄ seemingly random Î≥ÄÍ≤ΩÏùÑ Ìï† Ïàò ÏûàÎäîÎç∞, Í∑∏ Ïù¥Ïú†Îäî <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLMÏùÄ Í≤∞Ï†ïÎ°†Ï†Å ÏïåÍ≥†Î¶¨Ï¶òÏù¥ ÏïÑÎãàÍ∏∞ ÎïåÎ¨∏</a>ÏûÖÎãàÎã§).\n+\n+ÌÖåÏä§Ìä∏:\n+\n+## ÏΩîÎìú Ïä§ÎãàÌé´ { #code-snippets }\n+\n+//// tab | ÌÖåÏä§Ìä∏\n+\n+Îã§ÏùåÏùÄ ÏΩîÎìú Ïä§ÎãàÌé´ÏûÖÎãàÎã§: `foo`. Í∑∏Î¶¨Í≥† Ïù¥Í≤ÉÏùÄ Îòê Îã§Î•∏ ÏΩîÎìú Ïä§ÎãàÌé´ÏûÖÎãàÎã§: `bar`. Í∑∏Î¶¨Í≥† Îòê ÌïòÎÇò: `baz quux`.\n+\n+////\n+\n+//// tab | Ï†ïÎ≥¥\n+\n+ÏΩîÎìú Ïä§ÎãàÌé´Ïùò ÎÇ¥Ïö©ÏùÄ Í∑∏ÎåÄÎ°ú ÎëêÏñ¥Ïïº Ìï©ÎãàÎã§.\n+\n+`scripts/translate.py`Ïùò ÏùºÎ∞ò ÌîÑÎ°¨ÌîÑÌä∏ÏóêÏÑú `### Content of code snippets` ÏÑπÏÖòÏùÑ Ï∞∏Í≥†ÌïòÏÑ∏Ïöî.\n+\n+////\n+\n+## Îî∞Ïò¥Ìëú { #quotes }\n+\n+//// tab | ÌÖåÏä§Ìä∏\n+\n+Ïñ¥Ï†ú Ï†ú ÏπúÍµ¨Í∞Ä Ïù¥Î†áÍ≤å ÏçºÏäµÎãàÎã§: \"If you spell incorrectly correctly, you have spelled it incorrectly\". Ïù¥Ïóê Ï†ÄÎäî Ïù¥Î†áÍ≤å ÎãµÌñàÏäµÎãàÎã§: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"\".\n+\n+/// note | Ï∞∏Í≥†\n+\n+LLMÏùÄ ÏïÑÎßà Ïù¥Í≤ÉÏùÑ ÏûòÎ™ª Î≤àÏó≠Ìï† Í≤ÉÏûÖÎãàÎã§. Ìù•ÎØ∏Î°úÏö¥ Ï†êÏùÄ Ïû¨Î≤àÏó≠Ìï† Îïå Í≥†Ï†ïÎêú Î≤àÏó≠ÏùÑ Ïú†ÏßÄÌïòÎäîÏßÄ Ïó¨Î∂ÄÎøêÏûÖÎãàÎã§.\n+\n+///\n+\n+////\n+\n+//// tab | Ï†ïÎ≥¥\n+\n+ÌîÑÎ°¨ÌîÑÌä∏ ÏÑ§Í≥ÑÏûêÎäî Ï§ëÎ¶Ω Îî∞Ïò¥ÌëúÎ•º ÌÉÄÏù¥Ìè¨Í∑∏ÎûòÌîº Îî∞Ïò¥ÌëúÎ°ú Î≥ÄÌôòÌï†ÏßÄ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§. Í∑∏ÎåÄÎ°ú ÎëêÏñ¥ÎèÑ Í¥úÏ∞ÆÏäµÎãàÎã§.\n+\n+ÏòàÎ•º Îì§Ïñ¥ `docs/de/llm-prompt.md`Ïùò `### Quotes` ÏÑπÏÖòÏùÑ Ï∞∏Í≥†ÌïòÏÑ∏Ïöî.\n+\n+////\n+\n+## ÏΩîÎìú Ïä§ÎãàÌé´Ïùò Îî∞Ïò¥Ìëú { #quotes-in-code-snippets }\n+\n+//// tab | ÌÖåÏä§Ìä∏\n+\n+`pip install \"foo[bar]\"`\n+\n+ÏΩîÎìú Ïä§ÎãàÌé´ÏóêÏÑú Î¨∏ÏûêÏó¥ Î¶¨ÌÑ∞Îü¥Ïùò Ïòà: `\"this\"`, `'that'`.\n+\n+ÏΩîÎìú Ïä§ÎãàÌé´ÏóêÏÑú Î¨∏ÏûêÏó¥ Î¶¨ÌÑ∞Îü¥Ïùò Ïñ¥Î†§Ïö¥ Ïòà: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+ÌïòÎìúÏΩîÏñ¥: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | Ï†ïÎ≥¥\n+\n+... ÌïòÏßÄÎßå ÏΩîÎìú Ïä§ÎãàÌé´ ÏïàÏùò Îî∞Ïò¥ÌëúÎäî Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÎêòÏñ¥Ïïº Ìï©ÎãàÎã§.\n+\n+////\n+\n+## ÏΩîÎìú Î∏îÎ°ù { #code-blocks }\n+\n+//// tab | ÌÖåÏä§Ìä∏\n+\n+Bash ÏΩîÎìú ÏòàÏãú...\n+\n+\n```\n\n```diff\n@@ -0,0 +1,247 @@\n+# OpenAPIÏóêÏÑú Ï∂îÍ∞Ä ÏùëÎãµ { #additional-responses-in-openapi }\n+\n+/// warning | Í≤ΩÍ≥†\n+\n+Ïù¥Îäî ÍΩ§ Í≥†Í∏â Ï£ºÏ†úÏûÖÎãàÎã§.\n+\n+**FastAPI**Î•º Îßâ ÏãúÏûëÌñàÎã§Î©¥, Ïù¥ ÎÇ¥Ïö©Ïù¥ ÌïÑÏöî ÏóÜÏùÑ ÏàòÎèÑ ÏûàÏäµÎãàÎã§.\n+\n+///\n+\n+Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú, ÎØ∏ÎîîÏñ¥ ÌÉÄÏûÖ, ÏÑ§Î™Ö Îì±ÏùÑ Ìè¨Ìï®Ìïú Ï∂îÍ∞Ä ÏùëÎãµÏùÑ ÏÑ†Ïñ∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+\n+Ïù¥Îü¨Ìïú Ï∂îÍ∞Ä ÏùëÎãµÏùÄ OpenAPI Ïä§ÌÇ§ÎßàÏóê Ìè¨Ìï®ÎêòÎØÄÎ°ú API Î¨∏ÏÑúÏóêÎèÑ ÌëúÏãúÎê©ÎãàÎã§.\n+\n+ÌïòÏßÄÎßå Ïù¥Îü¨Ìïú Ï∂îÍ∞Ä ÏùëÎãµÏùò Í≤ΩÏö∞, ÏÉÅÌÉú ÏΩîÎìúÏôÄ ÏΩòÌÖêÏ∏†Î•º Ìè¨Ìï®ÌïòÏó¨ `JSONResponse` Í∞ôÏùÄ `Response`Î•º ÏßÅÏ†ë Î∞òÌôòÌïòÎèÑÎ°ù Î∞òÎìúÏãú Ï≤òÎ¶¨Ìï¥Ïïº Ìï©ÎãàÎã§.\n+\n+## `model`ÏùÑ ÏÇ¨Ïö©Ìïú Ï∂îÍ∞Ä ÏùëÎãµ { #additional-response-with-model }\n+\n+*Í≤ΩÎ°ú Ï≤òÎ¶¨ Îç∞ÏΩîÎ†àÏù¥ÌÑ∞*Ïóê `responses` ÌååÎùºÎØ∏ÌÑ∞Î•º Ï†ÑÎã¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+\n+Ïù¥Îäî `dict`Î•º Î∞õÏäµÎãàÎã§. ÌÇ§Îäî Í∞Å ÏùëÎãµÏùò ÏÉÅÌÉú ÏΩîÎìú(Ïòà: `200`)Ïù¥Í≥†, Í∞íÏùÄ Í∞Å ÏùëÎãµÏóê ÎåÄÌïú Ï†ïÎ≥¥Î•º Îã¥ÏùÄ Îã§Î•∏ `dict`ÏûÖÎãàÎã§.\n+\n+Í∞Å ÏùëÎãµ `dict`ÏóêÎäî `response_model`Ï≤òÎüº Pydantic Î™®Îç∏ÏùÑ Îã¥Îäî `model` ÌÇ§Í∞Ä ÏûàÏùÑ Ïàò ÏûàÏäµÎãàÎã§.\n+\n+**FastAPI**Îäî Í∑∏ Î™®Îç∏ÏùÑ ÏÇ¨Ïö©Ìï¥ JSON SchemaÎ•º ÏÉùÏÑ±ÌïòÍ≥†, OpenAPIÏùò Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏóê Ìè¨Ìï®Ìï©ÎãàÎã§.\n+\n+ÏòàÎ•º Îì§Ïñ¥, ÏÉÅÌÉú ÏΩîÎìú `404`ÏôÄ Pydantic Î™®Îç∏ `Message`Î•º ÏÇ¨Ïö©ÌïòÎäî Îã§Î•∏ ÏùëÎãµÏùÑ ÏÑ†Ïñ∏ÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏûëÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n+\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+\n+/// note | Ï∞∏Í≥†\n+\n+`JSONResponse`Î•º ÏßÅÏ†ë Î∞òÌôòÌï¥Ïïº ÌïúÎã§Îäî Ï†êÏùÑ Í∏∞ÏñµÌïòÏÑ∏Ïöî.\n+\n+///\n+\n+/// info | Ï†ïÎ≥¥\n+\n+`model` ÌÇ§Îäî OpenAPIÏùò ÏùºÎ∂ÄÍ∞Ä ÏïÑÎãôÎãàÎã§.\n+\n+**FastAPI**Îäî Ïó¨Í∏∞ÏóêÏÑú Pydantic Î™®Îç∏ÏùÑ Í∞ÄÏ†∏ÏôÄ JSON SchemaÎ•º ÏÉùÏÑ±ÌïòÍ≥† Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏóê ÎÑ£ÏäµÎãàÎã§.\n+\n+Ïò¨Î∞îÎ•∏ ÏúÑÏπòÎäî Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§:\n+\n+* Í∞íÏúºÎ°ú Îòê Îã§Î•∏ JSON Í∞ùÏ≤¥(`dict`)Î•º Í∞ÄÏßÄÎäî `content` ÌÇ§ ÏïàÏóê:\n+    * ÎØ∏ÎîîÏñ¥ ÌÉÄÏûÖ(Ïòà: `application/json`)ÏùÑ ÌÇ§Î°ú Í∞ÄÏßÄÎ©∞, Í∞íÏúºÎ°ú Îòê Îã§Î•∏ JSON Í∞ùÏ≤¥Î•º Ìè¨Ìï®ÌïòÍ≥†:\n+        * `schema` ÌÇ§Í∞Ä ÏûàÍ≥†, Í∑∏ Í∞íÏù¥ Î™®Îç∏ÏóêÏÑú ÏÉùÏÑ±Îêú JSON SchemaÏûÖÎãàÎã§. Ïù¥Í≤ÉÏù¥ Ïò¨Î∞îÎ•∏ ÏúÑÏπòÏûÖÎãàÎã§.\n+            * **FastAPI**Îäî Ïù¥Î•º ÏßÅÏ†ë Ìè¨Ìï®ÌïòÎäî ÎåÄÏã†, OpenAPIÏùò Îã§Î•∏ ÏúÑÏπòÏóê ÏûàÎäî Ï†ÑÏó≠ JSON SchemasÎ•º Ï∞∏Ï°∞ÌïòÎèÑÎ°ù Ïó¨Í∏∞ÏóêÏÑú referenceÎ•º Ï∂îÍ∞ÄÌï©ÎãàÎã§. Ïù¥Î†áÍ≤å ÌïòÎ©¥ Îã§Î•∏ Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÍ≥º ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Í∞Ä Í∑∏ JSON SchemaÎ•º ÏßÅÏ†ë ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≥†, Îçî ÎÇòÏùÄ ÏΩîÎìú ÏÉùÏÑ± ÎèÑÍµ¨ Îì±ÏùÑ Ï†úÍ≥µÌï† Ïàò ÏûàÏäµÎãàÎã§.\n+\n+///\n+\n+Ïù¥ *Í≤ΩÎ°ú Ï≤òÎ¶¨*Ïóê ÎåÄÌï¥ OpenAPIÏóê ÏÉùÏÑ±ÎêòÎäî ÏùëÎãµÏùÄ Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§:\n+\n+\n```\n\n```diff\n@@ -0,0 +1,466 @@\n+# ÌîÑÎ°ùÏãú Îí§ÏóêÏÑú Ïã§ÌñâÌïòÍ∏∞ { #behind-a-proxy }\n+\n+ÎßéÏùÄ Í≤ΩÏö∞ FastAPI Ïï± ÏïûÎã®Ïóê TraefikÏù¥ÎÇò Nginx Í∞ôÏùÄ **ÌîÑÎ°ùÏãú(proxy)**Î•º ÎëêÍ≥† ÏÇ¨Ïö©Ìï©ÎãàÎã§.\n+\n+Ïù¥Îü∞ ÌîÑÎ°ùÏãúÎäî HTTPS Ïù∏Ï¶ùÏÑú Ï≤òÎ¶¨ Îì± Ïó¨Îü¨ ÏûëÏóÖÏùÑ Îã¥ÎãπÌï† Ïàò ÏûàÏäµÎãàÎã§.\n+\n+## ÌîÑÎ°ùÏãú Ï†ÑÎã¨ Ìó§Îçî { #proxy-forwarded-headers }\n+\n+Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò ÏïûÎã®Ïùò **ÌîÑÎ°ùÏãú**Îäî Î≥¥ÌÜµ **ÏÑúÎ≤Ñ**Î°ú ÏöîÏ≤≠ÏùÑ Î≥¥ÎÇ¥Í∏∞ Ï†ÑÏóê, Ìï¥Îãπ ÏöîÏ≤≠Ïù¥ ÌîÑÎ°ùÏãúÏóê ÏùòÌï¥ **Ï†ÑÎã¨(forwarded)**ÎêòÏóàÎã§Îäî Í≤ÉÏùÑ ÏÑúÎ≤ÑÍ∞Ä Ïïå Ïàò ÏûàÎèÑÎ°ù Î™áÎ™á Ìó§ÎçîÎ•º ÎèôÏ†ÅÏúºÎ°ú ÏÑ§Ï†ïÌï©ÎãàÎã§. Ïù¥Î•º ÌÜµÌï¥ ÏÑúÎ≤ÑÎäî ÎèÑÎ©îÏù∏ÏùÑ Ìè¨Ìï®Ìïú ÏõêÎûòÏùò (Í≥µÍ∞ú) URL, HTTPS ÏÇ¨Ïö© Ïó¨Î∂Ä Îì± Ï†ïÎ≥¥Î•º Ïïå Ïàò ÏûàÏäµÎãàÎã§.\n+\n+**ÏÑúÎ≤Ñ** ÌîÑÎ°úÍ∑∏Îû®(Ïòà: **FastAPI CLI**Î•º ÌÜµÌï¥ Ïã§ÌñâÎêòÎäî **Uvicorn**)ÏùÄ Ïù¥Îü∞ Ìó§ÎçîÎ•º Ìï¥ÏÑùÌï† Ïàò ÏûàÍ≥†, Í∑∏ Ï†ïÎ≥¥Î•º Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏúºÎ°ú Ï†ÑÎã¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+\n+ÌïòÏßÄÎßå Î≥¥ÏïàÏÉÅ, ÏÑúÎ≤ÑÎäî ÏûêÏã†Ïù¥ Ïã†Î¢∞Ìï† Ïàò ÏûàÎäî ÌîÑÎ°ùÏãú Îí§Ïóê ÏûàÎã§Îäî Í≤ÉÏùÑ Î™®Î•¥Î©¥ Ìï¥Îãπ Ìó§ÎçîÎ•º Ìï¥ÏÑùÌïòÏßÄ ÏïäÏäµÎãàÎã§.\n+\n+/// note | Í∏∞Ïà† ÏÑ∏Î∂ÄÏÇ¨Ìï≠\n+\n+ÌîÑÎ°ùÏãú Ìó§ÎçîÎäî Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§:\n+\n+* <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-For\" class=\"external-link\" target=\"_blank\">X-Forwarded-For</a>\n+* <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-Proto\" class=\"external-link\" target=\"_blank\">X-Forwarded-Proto</a>\n+* <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Forwarded-Host\" class=\"external-link\" target=\"_blank\">X-Forwarded-Host</a>\n+\n+///\n+\n+### ÌîÑÎ°ùÏãú Ï†ÑÎã¨ Ìó§Îçî ÌôúÏÑ±ÌôîÌïòÍ∏∞ { #enable-proxy-forwarded-headers }\n+\n+FastAPI CLIÎ•º *CLI ÏòµÏÖò* `--forwarded-allow-ips`Î°ú Ïã§ÌñâÌïòÍ≥†, Ï†ÑÎã¨ Ìó§ÎçîÎ•º ÏùΩÏùÑ Ïàò ÏûàÎèÑÎ°ù Ïã†Î¢∞Ìï† IP Ï£ºÏÜåÎì§ÏùÑ ÎÑòÍ∏∏ Ïàò ÏûàÏäµÎãàÎã§.\n+\n+`--forwarded-allow-ips=\"*", "output": "Changes look good. This PR implements: üåê Update translations for ko (add-missing)", "source": "pr", "type": "code_review", "pr_number": 420}
{"instruction": "Review the following code changes: üåê Update LLM prompt instructions file for French", "input": "```diff\n@@ -6,123 +6,127 @@ Language code: fr.\n \n ### Grammar to use when talking to the reader\n \n-Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+Use the formal grammar (use `vous` instead of `tu`).\n \n-### Quotes\n+Additionally, in instructional sentences, prefer the present tense for obligations:\n+\n+- Prefer `vous devez ‚Ä¶` over `vous devrez ‚Ä¶`, unless the English source explicitly refers to a future requirement.\n+\n+- When translating ‚Äúmake sure (that) ‚Ä¶ is ‚Ä¶‚Äù, prefer the indicative after `vous assurer que` (e.g. `Vous devez vous assurer qu'il est ‚Ä¶`) instead of the subjunctive (e.g. `qu'il soit ‚Ä¶`).\n \n-1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+### Quotes\n \n-2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+- Convert neutral double quotes (`\"`) to French guillemets (`¬´` and `¬ª`).\n \n-3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+- Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n \n Examples:\n \n-    Source (English):\n+Source (English):\n \n-        ¬´¬´¬´\n-        \"Hello world\"\n-        ‚ÄúHello Universe‚Äù\n-        \"He said: 'Hello'\"\n-        \"The module is `__main__`\"\n-        ¬ª¬ª¬ª\n+\n```\n\n```diff\n@@ -6,123 +6,127 @@ Language code: fr.\n \n ### Grammar to use when talking to the reader\n \n-Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+Use the formal grammar (use `vous` instead of `tu`).\n \n-### Quotes\n+Additionally, in instructional sentences, prefer the present tense for obligations:\n+\n+- Prefer `vous devez ‚Ä¶` over `vous devrez ‚Ä¶`, unless the English source explicitly refers to a future requirement.\n+\n+- When translating ‚Äúmake sure (that) ‚Ä¶ is ‚Ä¶‚Äù, prefer the indicative after `vous assurer que` (e.g. `Vous devez vous assurer qu'il est ‚Ä¶`) instead of the subjunctive (e.g. `qu'il soit ‚Ä¶`).\n \n-1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+### Quotes\n \n-2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+- Convert neutral double quotes (`\"`) to French guillemets (`¬´` and `¬ª`).\n \n-3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+- Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n \n Examples:\n \n-    Source (English):\n+Source (English):\n \n-        ¬´¬´¬´\n-        \"Hello world\"\n-        ‚ÄúHello Universe‚Äù\n-        \"He said: 'Hello'\"\n-        \"The module is `__main__`\"\n-        ¬ª¬ª¬ª\n+\n```\n\n```diff\n@@ -6,123 +6,127 @@ Language code: fr.\n \n ### Grammar to use when talking to the reader\n \n-Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+Use the formal grammar (use `vous` instead of `tu`).\n \n-### Quotes\n+Additionally, in instructional sentences, prefer the present tense for obligations:\n+\n+- Prefer `vous devez ‚Ä¶` over `vous devrez ‚Ä¶`, unless the English source explicitly refers to a future requirement.\n+\n+- When translating ‚Äúmake sure (that) ‚Ä¶ is ‚Ä¶‚Äù, prefer the indicative after `vous assurer que` (e.g. `Vous devez vous assurer qu'il est ‚Ä¶`) instead of the subjunctive (e.g. `qu'il soit ‚Ä¶`).\n \n-1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+### Quotes\n \n-2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+- Convert neutral double quotes (`\"`) to French guillemets (`¬´` and `¬ª`).\n \n-3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+- Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n \n Examples:\n \n-    Source (English):\n+Source (English):\n \n-        ¬´¬´¬´\n-        \"Hello world\"\n-        ‚ÄúHello Universe‚Äù\n-        \"He said: 'Hello'\"\n-        \"The module is `__main__`\"\n-        ¬ª¬ª¬ª\n+\n```\n\n```diff\n@@ -6,123 +6,127 @@ Language code: fr.\n \n ### Grammar to use when talking to the reader\n \n-Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+Use the formal grammar (use `vous` instead of `tu`).\n \n-### Quotes\n+Additionally, in instructional sentences, prefer the present tense for obligations:\n+\n+- Prefer `vous devez ‚Ä¶` over `vous devrez ‚Ä¶`, unless the English source explicitly refers to a future requirement.\n+\n+- When translating ‚Äúmake sure (that) ‚Ä¶ is ‚Ä¶‚Äù, prefer the indicative after `vous assurer que` (e.g. `Vous devez vous assurer qu'il est ‚Ä¶`) instead of the subjunctive (e.g. `qu'il soit ‚Ä¶`).\n \n-1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+### Quotes\n \n-2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+- Convert neutral double quotes (`\"`) to French guillemets (`¬´` and `¬ª`).\n \n-3) Do not convert quote", "output": "Code Review for: üåê Update LLM prompt instructions file for French\n\nüìù **docs/fr/llm-prompt.md**: We specifically mention to not change the quotes inside code blocks. Why do we do it here?\n\nüìù **docs/fr/llm-prompt.md**: I would recommend \"Alertes\" instead of \"Attention\".\r\n\"Alerte\" is a very broad term comparable to \"heads up\".\r\n\"Attention\", which by the dictionary translates to \"warning\" carries a heavy meaning; closer to \"BE CAREFUL!!\" (Caps included)\n\nüìù **docs/fr/llm-prompt.md**: V√©rifications*\n\nüìù **docs/fr/llm-prompt.md**: Oh, you're totally right, thanks for catching it!\n\nüìù **docs/fr/llm-prompt.md**: Perfect, thanks!\n\n", "source": "pr", "type": "code_review", "pr_number": 419}
{"instruction": "Review this code change in `docs/fr/llm-prompt.md`", "input": "```diff\n@@ -6,123 +6,127 @@ Language code: fr.\n \n ### Grammar to use when talking to the reader\n \n-Use the formal grammar (use ¬´vous¬ª instead of ¬´tu¬ª).\n+Use the formal grammar (use `vous` instead of `tu`).\n \n-### Quotes\n+Additionally, in instructional sentences, prefer the present tense for obligations:\n+\n+- Prefer `vous devez ‚Ä¶` over `vous devrez ‚Ä¶`, unless the English source explicitly refers to a future requirement.\n+\n+- When translating ‚Äúmake sure (that) ‚Ä¶ is ‚Ä¶‚Äù, prefer the indicative after `vous assurer que` (e.g. `Vous devez vous assurer qu'il est ‚Ä¶`) instead of the subjunctive (e.g. `qu'il soit ‚Ä¶`).\n \n-1) Convert neutral double quotes (¬´\"¬ª) and English double typographic quotes (¬´‚Äú¬ª and ¬´‚Äù¬ª) to French guillemets (¬´¬´¬ª and ¬´¬ª¬ª).\n+### Quotes\n \n-2) In the French docs, guillemets are written without extra spaces: use ¬´texte¬ª, not ¬´ texte ¬ª.\n+- Convert neutral double quotes (`\"`) to French guillemets (`¬´` and `¬ª`).\n \n-3) Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n+- Do not convert quotes inside code blocks, inline code, paths, URLs, or anything wrapped in backticks.\n \n Examples:\n \n-    Source (English):\n+Source (English):\n \n-        ¬´¬´¬´\n-        \"Hello world\"\n-        ‚ÄúHello Universe‚Äù\n-        \"He said: 'Hello'\"\n-        \"The module is `__main__`\"\n-        ¬ª¬ª¬ª\n+```\n+\"Hello world\"\n+‚ÄúHello Universe‚Äù\n+\"He said: 'Hello'\"\n+\"The module is `__main__`\"\n+```\n \n-    Result (French):\n+Result (French):\n \n-        ¬´¬´¬´\n-        ¬´Hello world¬ª\n-        ¬´Hello Universe¬ª\n-        ¬´He said: 'Hello'¬ª\n-        ¬´The module is `__main__`¬ª\n-        ¬ª¬ª¬ª\n+```\n+¬´Hello world¬ª\n+¬´Hello Universe¬ª\n+¬´He said: 'Hello'¬ª\n+¬´The module is `__main__`¬ª\n+```\n\n```", "output": "We specifically mention to not change the quotes inside code blocks. Why do we do it here?", "source": "pr_review", "type": "inline_review", "pr_number": 419}
{"instruction": "Review the following code changes: üåê Update translations for fr (update-outdated)", "input": "```diff\n@@ -317,6 +317,8 @@ extra:\n     name: de - Deutsch\n   - link: /es/\n     name: es - espa√±ol\n+  - link: /fr/\n+    name: fr - fran√ßais\n   - link: /pt/\n     name: pt - portugu√™s\n   - link: /ru/\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# R√©ponses suppl√©mentaires dans OpenAPI\n+# R√©ponses suppl√©mentaires dans OpenAPI { #additional-responses-in-openapi }\n \n /// warning | Attention\n \n@@ -14,9 +14,9 @@ Ces r√©ponses suppl√©mentaires seront incluses dans le sch√©ma OpenAPI, elles ap\n \n Mais pour ces r√©ponses suppl√©mentaires, vous devez vous assurer de renvoyer directement une `Response` comme `JSONResponse`, avec votre code HTTP et votre contenu.\n \n-## R√©ponse suppl√©mentaire avec `model`\n+## R√©ponse suppl√©mentaire avec `model` { #additional-response-with-model }\n \n-Vous pouvez ajouter √† votre d√©corateur de *param√®tre de chemin* un param√®tre `responses`.\n+Vous pouvez passer √† vos *d√©corateurs d'op√©ration de chemin* un param√®tre `responses`.\n \n Il prend comme valeur un `dict` dont les cl√©s sont des codes HTTP pour chaque r√©ponse, comme `200`, et la valeur de ces cl√©s sont d'autres `dict` avec des informations pour chacun d'eux.\n \n@@ -26,7 +26,7 @@ Chacun de ces `dict` de r√©ponse peut avoir une cl√© `model`, contenant un mod√®\n \n Par exemple, pour d√©clarer une autre r√©ponse avec un code HTTP `404` et un mod√®le Pydantic `Message`, vous pouvez √©crire¬†:\n \n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n /// note | Remarque\n \n@@ -169,13 +169,13 @@ Les sch√©mas sont r√©f√©renc√©s √† un autre endroit du mod√®le OpenAPI¬†:\n }\n \n```\n\n```diff\n@@ -1,41 +1,41 @@\n-# Codes HTTP suppl√©mentaires\n+# Codes HTTP suppl√©mentaires { #additional-status-codes }\n \n-Par d√©faut, **FastAPI** renverra les r√©ponses √† l'aide d'une structure de donn√©es `JSONResponse`, en pla√ßant la r√©ponse de votre  *chemin d'acc√®s* √† l'int√©rieur de cette `JSONResponse`.\n+Par d√©faut, **FastAPI** renverra les r√©ponses √† l'aide d'une structure de donn√©es `JSONResponse`, en pla√ßant la r√©ponse de votre *op√©ration de chemin* √† l'int√©rieur de cette `JSONResponse`.\n \n-Il utilisera le code HTTP par d√©faut ou celui que vous avez d√©fini dans votre *chemin d'acc√®s*.\n+Il utilisera le code HTTP par d√©faut ou celui que vous avez d√©fini dans votre *op√©ration de chemin*.\n \n-## Codes HTTP suppl√©mentaires\n+## Codes HTTP suppl√©mentaires { #additional-status-codes_1 }\n \n Si vous souhaitez renvoyer des codes HTTP suppl√©mentaires en plus du code principal, vous pouvez le faire en renvoyant directement une `Response`, comme une `JSONResponse`, et en d√©finissant directement le code HTTP suppl√©mentaire.\n \n-Par exemple, disons que vous voulez avoir un *chemin d'acc√®s* qui permet de mettre √† jour les √©l√©ments et renvoie les codes HTTP 200 \"OK\" en cas de succ√®s.\n+Par exemple, disons que vous voulez avoir une *op√©ration de chemin* qui permet de mettre √† jour les √©l√©ments et renvoie les codes HTTP 200 ¬´OK¬ª en cas de succ√®s.\n \n-Mais vous voulez aussi qu'il accepte de nouveaux √©l√©ments. Et lorsque les √©l√©ments n'existaient pas auparavant, il les cr√©e et renvoie un code HTTP de 201 \"Cr√©√©\".\n+Mais vous voulez aussi qu'il accepte de nouveaux √©l√©ments. Et lorsque les √©l√©ments n'existaient pas auparavant, il les cr√©e et renvoie un code HTTP de 201 ¬´Cr√©√©¬ª.\n \n Pour y parvenir, importez `JSONResponse` et renvoyez-y directement votre contenu, en d√©finissant le `status_code` que vous souhaitez¬†:\n \n-{* ../../docs_src/additional_status_codes/tutorial001.py hl[4,25] *}\n+{* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n /// warning | Attention\n \n Lorsque vous renvoyez une `Response` directement, comme dans l'exemple ci-dessus, elle sera renvoy√©e directement.\n \n Elle ne sera pas s√©rialis√©e avec un mod√®le.\n \n-Assurez-vous qu'il contient les donn√©es souhait√©es et que les valeurs soient dans un format JSON valides (si vous utilisez une `JSONResponse`).\n+Assurez-vous qu'elle contient les donn√©es souhait√©es et que les valeurs soient dans un format JSON valides (si vous utilisez une `JSONResponse`).\n \n ///\n \n /// note | D√©tails techniques\n \n Vous pouvez √©galement utiliser `from starlette.responses import JSONResponse`.\n \n-Pour plus de commodit√©s, **FastAPI** fournit les objets `starlette.responses` sous forme d'un alias accessible par `fastapi.responses`. Mais la plupart des r√©ponses disponibles proviennent directement de Starlette. Il en est de m√™me avec l'objet `statut`.\n+Pour plus de commodit√©s, **FastAPI** fournit les objets `starlette.responses` sous forme d'un alias accessible par `fastapi.responses`. Mais la plupart des r√©ponses disponibl\n\n```\n\n```diff\n@@ -1,27 +1,21 @@\n-# Guide de l'utilisateur avanc√©\n+# Guide de l'utilisateur avanc√© { #advanced-user-guide }\n \n-## Caract√©ristiques suppl√©mentaires\n+## Caract√©ristiques suppl√©mentaires { #additional-features }\n \n Le [Tutoriel - Guide de l'utilisateur](../tutorial/index.md){.internal-link target=_blank} devrait suffire √† vous faire d√©couvrir toutes les fonc", "output": "Changes look good. This PR implements: üåê Update translations for fr (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 418}
{"instruction": "Review the following code changes: üåê Update portuguese llm-prompt.md", "input": "```diff\n@@ -10,6 +10,26 @@ Keep existing translations as they are if the term is already translated.\n \n When translating documentation into Portuguese, use neutral and widely understandable language. Although Portuguese originated in Portugal and has its largest number of speakers in Brazil, it is also an official language in several countries and regions, such as Equatorial Guinea, Mozambique, Angola, Cape Verde, and S√£o Tom√© and Pr√≠ncipe. Avoid words or expressions that are specific to a single country or region.\n \n+Only keep parentheses if they exist in the source text. Do not add parentheses to terms that do not have them.\n+\n+### Avoiding Repetition in Translation\n+\n+When translating sentences, avoid unnecessary repetition of words or phrases that are implied in context.\n+- Merge repeated words naturally while keeping the meaning.\n+- Do **not** introduce extra words to replace repeated phrases unnecessarily.\n+- Keep translations fluent and concise, but maintain the original meaning.\n+\n+**Example:**\n+\n+Source:\n+Let's see how that works and how to change it if you need to do that.\n+\n+Avoid translating literally as:\n+Vamos ver como isso funciona e como alterar isso se voc√™ precisar fazer isso.\n+\n+Better translation:\n+Vamos ver como isso funciona e como alterar se voc√™ precisar.\n+\n ---\n \n For the next terms, use the following translations:\n@@ -22,10 +42,11 @@ For the next terms, use the following translations:\n * /// note: /// note | Nota\n * /// tip: /// tip | Dica\n * /// warning: /// warning | Aten√ß√£o\n-* (you should): (voc√™ deveria)\n+* you should: voc√™ deveria\n * async context manager: gerenciador de contexto ass√≠ncrono\n * autocomplete: autocompletar\n * autocompletion: preenchimento autom√°tico\n+* auto-completion: preenchimento autom√°tico\n * bug: bug\n * context manager: gerenciador de contexto\n * cross domain: cross domain (do not translate to \"dom√≠nio cruzado\")\n\n```", "output": "Changes look good. This PR implements: üåê Update portuguese llm-prompt.md", "source": "pr", "type": "code_review", "pr_number": 417}
{"instruction": "Review the following code changes: üåê Update translations for pt (update-outdated)", "input": "```diff\n@@ -1,8 +1,8 @@\n # Arquivo de teste de LLM { #llm-test-file }\n \n-Este documento testa se o <abbr title=\"Large Language Model ‚Äì Modelo de Linguagem de Grande Porte\">LLM</abbr>, que traduz a documenta√ß√£o, entende o `general_prompt` em `scripts/translate.py` e o prompt espec√≠fico do idioma em `docs/{language code}/llm-prompt.md`. O prompt espec√≠fico do idioma √© anexado ao `general_prompt`.\n+Este documento testa se o <abbr title=\"Large Language Model - Modelo de Linguagem de Grande Porte\">LLM</abbr>, que traduz a documenta√ß√£o, entende o `general_prompt` em `scripts/translate.py` e o prompt espec√≠fico do idioma em `docs/{language code}/llm-prompt.md`. O prompt espec√≠fico do idioma √© anexado ao `general_prompt`.\n \n-Os testes adicionados aqui ser√£o vistos por todos os autores dos prompts espec√≠ficos de idioma.\n+Os testes adicionados aqui ser√£o vistos por todos os designers de prompts espec√≠ficos de idioma.\n \n Use da seguinte forma:\n \n@@ -23,7 +23,7 @@ Este √© um trecho de c√≥digo: `foo`. E este √© outro trecho de c√≥digo: `bar`. E\n \n ////\n \n-//// tab | Informa√ß√µes\n+//// tab | Informa√ß√£o\n \n O conte√∫do dos trechos de c√≥digo deve ser deixado como est√°.\n \n@@ -45,9 +45,9 @@ O LLM provavelmente vai traduzir isso errado. O interessante √© apenas se ele ma\n \n ////\n \n-//// tab | Informa√ß√µes\n+//// tab | Informa√ß√£o\n \n-O autor do prompt pode escolher se deseja converter aspas neutras em aspas tipogr√°ficas. Tamb√©m √© aceit√°vel deix√°-las como est√£o.\n+O designer do prompt pode escolher se deseja converter aspas neutras em aspas tipogr√°ficas. Tamb√©m √© aceit√°vel deix√°-las como est√£o.\n \n Veja, por exemplo, a se√ß√£o `### Quotes` em `docs/de/llm-prompt.md`.\n \n@@ -67,7 +67,7 @@ Pesado: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you ha\n \n ////\n \n-//// tab | Informa√ß√µes\n+//// tab | Informa√ß√£o\n \n ... No entanto, as aspas dentro de trechos de c√≥digo devem permanecer como est√£o.\n \n@@ -112,7 +112,7 @@ works(foo=\"bar\")  # Isto funciona üéâ\n \n ////\n \n-//// tab | Informa√ß√µes\n+//// tab | Informa√ß√£o\n \n O c√≥digo em blocos de c√≥digo n√£o deve ser modificado, com exce√ß√£o dos coment√°rios.\n \n@@ -154,7 +154,7 @@ Algum texto\n \n ////\n \n-//// tab | Informa√ß√µes\n+//// tab | Informa√ß√£o\n \n Abas e blocos `Info`/`Note`/`Warning`/etc. devem ter a tradu√ß√£o do seu t√≠tulo adicionada ap√≥s uma barra vertical (`|`).\n \n@@ -181,7 +181,7 @@ O texto do link deve ser traduzido, o endere√ßo do link deve apontar para a trad\n \n ////\n \n-//// tab | Informa√ß√µes\n+//// tab | Informa√ß√£o\n \n Os links devem ser traduzidos, mas seus endere√ßos devem permanecer inalterados. Uma exce√ß√£o s√£o links absolutos para p√°ginas da documenta√ß√£o do FastAPI. Nesse caso, devem apontar para a tradu√ß√£o.\n \n@@ -197,10 +197,10 @@ Aqui est√£o algumas coisas envolvidas em elementos HTML \"abbr\" (algumas s√£o inv\n \n ### O abbr fornece uma frase completa { #the-abbr-gives-a-full-phrase }\n \n-* <abbr title=\"Getting Things Done ‚Äì Fazer as Coisas\">GTD</abbr>\n-* <abbr title=\"menos que\"><code>lt</code></abbr>\n-* <abbr title=\"XML Web Token ‚Äì Toke\n\n```\n\n```diff\n@@ -10,21 +10,21 @@ Se voc√™ n√£o √© um \"especialista\" no OpenAPI, voc√™ provavelmente n√£o precisa\n \n Voc√™ pode definir o `operationId` do OpenAPI que ser√° utilizado na sua *opera√ß√£o de rota* com o par√¢metro `operation_id`.\n \n-Voc√™ precisa ter certeza que ele √© √∫nico para cada opera√ß√£o.\n+Voc√™ (voc√™ deveria) ter certeza de que ele √© √∫nico para cada opera√ß√£o.\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial001_py39.py hl[6] *}\n \n ### Utilizando o nome da *fun√ß√£o de opera√ß√£o de rota* como o operationId { #using-the-path-operation-function-name-as-the-operationid }\n \n-Se voc√™ quiser utilizar o nome das fun√ß√µes da sua API como `operationId`s, voc√™ pode iterar sobre todos esses nomes e sobrescrever o `operation_id` em  cada *opera√ß√£o de rota* utilizando o `APIRoute.name` dela.\n+Se voc√™ quiser utilizar o nome das fun√ß√µes da sua API como `operationId`s, voc√™ pode iterar sobre todos esses nomes e sobrescrever o `operation_id` de cada *opera√ß√£o de rota* utilizando o `APIRoute.name` dela.\n \n-Voc√™ deve fazer isso depois de adicionar todas as suas *opera√ß√µes de rota*.\n+Voc√™ (voc√™ deveria) fazer isso depois de adicionar todas as suas *opera√ß√µes de rota*.\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial002_py39.py hl[2, 12:21, 24] *}\n \n /// tip | Dica\n \n-Se voc√™ chamar `app.openapi()` manualmente, os `operationId`s devem ser atualizados antes dessa chamada.\n+Se voc√™ chamar `app.openapi()` manualmente, voc√™ (voc√™ deveria) atualizar os `operationId`s antes disso.\n \n ///\n \n@@ -44,45 +44,45 @@ Para excluir uma *opera√ß√£o de rota* do esquema OpenAPI gerado (e por consequ√™\n \n ## Descri√ß√£o avan√ßada a partir de docstring { #advanced-description-from-docstring }\n \n-Voc√™ pode limitar as linhas utilizadas a partir de uma docstring de uma *fun√ß√£o de opera√ß√£o de rota* para o OpenAPI.\n+Voc√™ pode limitar as linhas utilizadas a partir da docstring de uma *fun√ß√£o de opera√ß√£o de rota* para o OpenAPI.\n \n-Adicionar um `\\f` (um caractere de escap", "output": "Code Review for: üåê Update translations for pt (update-outdated)\n\nüìù **docs/pt/docs/advanced/path-operation-advanced-configuration.md**: ```suggestion\nVoc√™ deveria ter certeza de que ele √© √∫nico para cada opera√ß√£o.\n```\n\nüìù **docs/pt/docs/advanced/path-operation-advanced-configuration.md**: ```suggestion\nVoc√™ deveria fazer isso depois de adicionar todas as suas *opera√ß√µes de rota*.\n```\n\nüìù **docs/pt/docs/advanced/path-operation-advanced-configuration.md**: ```suggestion\nSe voc√™ chamar `app.openapi()` manualmente, voc√™ deveria atualizar os `operationId`s antes disso.\n```\n\nüìù **docs/pt/docs/how-to/separate-openapi-schemas.md**: ```suggestion\nVamos ver como isso funciona e como alterar se voc√™ precisar.\n```\nThe word 'isso' was repeated 3 times in the same phrase, sounds very weird.\n\nüìù **docs/pt/docs/advanced/path-operation-advanced-configuration.md**: I agree.\r\n\r\n`Voc√™ (voc√™ deveria)` is too repetitive\n\n", "source": "pr", "type": "code_review", "pr_number": 416}
{"instruction": "Review this code change in `docs/pt/docs/advanced/path-operation-advanced-configuration.md`", "input": "```diff\n@@ -10,21 +10,21 @@ Se voc√™ n√£o √© um \"especialista\" no OpenAPI, voc√™ provavelmente n√£o precisa\n \n Voc√™ pode definir o `operationId` do OpenAPI que ser√° utilizado na sua *opera√ß√£o de rota* com o par√¢metro `operation_id`.\n \n-Voc√™ precisa ter certeza que ele √© √∫nico para cada opera√ß√£o.\n+Voc√™ (voc√™ deveria) ter certeza de que ele √© √∫nico para cada opera√ß√£o.\n\n```", "output": "```suggestion\nVoc√™ deveria ter certeza de que ele √© √∫nico para cada opera√ß√£o.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 416}
{"instruction": "Review this code change in `docs/pt/docs/how-to/separate-openapi-schemas.md`", "input": "```diff\n@@ -1,10 +1,10 @@\n # Esquemas OpenAPI Separados para Entrada e Sa√≠da ou N√£o { #separate-openapi-schemas-for-input-and-output-or-not }\n \n-Ao usar **Pydantic v2**, o OpenAPI gerado √© um pouco mais exato e **correto** do que antes. üòé\n+Desde que o **Pydantic v2** foi lan√ßado, o OpenAPI gerado √© um pouco mais exato e **correto** do que antes. üòé\n \n-Inclusive, em alguns casos, ele ter√° at√© **dois JSON Schemas** no OpenAPI para o mesmo modelo Pydantic, para entrada e sa√≠da, dependendo se eles possuem **valores padr√£o**.\n+De fato, em alguns casos, ele ter√° at√© **dois JSON Schemas** no OpenAPI para o mesmo modelo Pydantic, para entrada e sa√≠da, dependendo se eles t√™m **valores padr√£o**.\n \n-Vamos ver como isso funciona e como alterar se for necess√°rio.\n+Vamos ver como isso funciona e como alterar isso se voc√™ precisar fazer isso.\n\n```", "output": "```suggestion\nVamos ver como isso funciona e como alterar se voc√™ precisar.\n```\nThe word 'isso' was repeated 3 times in the same phrase, sounds very weird.", "source": "pr_review", "type": "inline_review", "pr_number": 416}
{"instruction": "Review this code change in `docs/pt/docs/tutorial/body.md`", "input": "```diff\n@@ -113,7 +114,7 @@ Se voc√™ utiliza o <a href=\"https://www.jetbrains.com/pycharm/\" class=\"external-\n \n Melhora o suporte do editor para seus modelos Pydantic com:\n \n-* preenchimento autom√°tico\n+* auto-completion\n\n```", "output": "Here we can translate it to `preenchimento autom√°tico`.\r\n\r\nI'll open a PR to add this to `llm-prompt.md`. We already have `autocompletion` instruction, but it seems it won't work for `auto-completion`", "source": "pr_review", "type": "inline_review", "pr_number": 416}
{"instruction": "Review this code change in `docs/pt/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -33,7 +33,7 @@ Para isso, primeiro importe:\n \n O FastAPI adicionou suporte a `Annotated` (e passou a recomend√°-lo) na vers√£o 0.95.0.\n \n-Se voc√™ tiver uma vers√£o mais antiga, ter√° erros ao tentar usar `Annotated`.\n+Se voc√™ tiver uma vers√£o mais antiga, (voc√™ deveria) obteria erros ao tentar usar `Annotated`.\n\n```", "output": "I've seen that we have an instruction to translate:\r\n\r\n* (you should): (voc√™ deveria)\r\n\r\nI think we had a case where `you should` inside parentheses was not being translated, so I added this instruction. However, it is now messing up some translations. I‚Äôll update the `llm-prompt.md` to handle it in a better way.\r\n\r\nIn this case, it should be translated to:\r\n\r\n`, voc√™ receberia erros ao tentar usar Annotated`\r\n\r", "source": "pr_review", "type": "inline_review", "pr_number": 416}
{"instruction": "Review this code change in `docs/pt/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -280,7 +266,7 @@ Ent√£o, com uma URL como:\n http://localhost:8000/items/?q=foo&q=bar\n ```\n \n-voc√™ receber√° os m√∫ltiplos valores do *par√¢metro de consulta* `q` (`foo` e `bar`) em uma `list` Python dentro da sua *fun√ß√£o de opera√ß√£o de rota*, no *par√¢metro da fun√ß√£o* `q`.\n+(voc√™ deveria) receber os m√∫ltiplos valores dos *par√¢metros de consulta* `q` (`foo` e `bar`) em uma `list` Python dentro da sua *fun√ß√£o de opera√ß√£o de rota*, no *par√¢metro da fun√ß√£o* `q`.\n\n```", "output": "It's funny, because we have the instruction:\r\n\r\n* (you should): (voc√™ deveria)\r\n\r\nBut it‚Äôs adding parentheses when `you would` appears. Strange.\r\n\r\nHere we can translate to:\r\n\r\n`voc√™ receberia os m√∫ltiplos...`\r", "source": "pr_review", "type": "inline_review", "pr_number": 416}
{"instruction": "Review the following code changes: just test how pr woks", "input": "```diff\n@@ -1,4 +1,5 @@\n <p align=\"center\">\n+this is a dumy pr, to test how pr works\n   <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n\n```", "output": "Changes look good. This PR implements: just test how pr woks", "source": "pr", "type": "code_review", "pr_number": 415}
{"instruction": "Review the following code changes: ‚ú® Add tags to websockets", "input": "```diff\n@@ -1179,12 +1179,14 @@ def add_api_websocket_route(\n         name: Optional[str] = None,\n         *,\n         dependencies: Optional[Sequence[Depends]] = None,\n+        tags: Optional[List[Union[str, Enum]]] = None,\n     ) -> None:\n         self.router.add_api_websocket_route(\n             path,\n             endpoint,\n             name=name,\n             dependencies=dependencies,\n+            tags=tags,\n         )\n \n     def websocket(\n@@ -1218,6 +1220,14 @@ def websocket(\n                 \"\"\"\n             ),\n         ] = None,\n+        tags: Annotated[\n+            Optional[List[Union[str, Enum]]],\n+            Doc(\n+                \"\"\"\n+                A list of tags to be applied to this WebSocket.\n+                \"\"\"\n+            ),\n+        ] = None,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         \"\"\"\n         Decorate a WebSocket function.\n@@ -1247,6 +1257,7 @@ def decorator(func: DecoratedCallable) -> DecoratedCallable:\n                 func,\n                 name=name,\n                 dependencies=dependencies,\n+                tags=tags,\n             )\n             return func\n \n\n```\n\n```diff\n@@ -11,6 +11,7 @@\n     Callable,\n     Coroutine,\n     Dict,\n+    Iterable,\n     List,\n     Mapping,\n     Optional,\n@@ -392,12 +393,14 @@ def __init__(\n         endpoint: Callable[..., Any],\n         *,\n         name: Optional[str] = None,\n+        tags: Optional[List[Union[str, Enum]]] = None,\n         dependencies: Optional[Sequence[params.Depends]] = None,\n         dependency_overrides_provider: Optional[Any] = None,\n     ) -> None:\n         self.path = path\n         self.endpoint = endpoint\n         self.name = get_name(endpoint) if name is None else name\n+        self.tags: List[Union[str, Enum]] = tags or []\n         self.dependencies = list(dependencies or [])\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         self.dependant = get_dependant(path=self.path_format, call=self.endpoint)\n@@ -918,9 +921,7 @@ def add_api_route(\n         current_response_class = get_value_or_default(\n             response_class, self.default_response_class\n         )\n-        current_tags = self.tags.copy()\n-        if tags:\n-            current_tags.extend(tags)\n+        current_tags = self.combine_tags(tags or [])\n         current_dependencies = self.dependencies.copy()\n         if dependencies:\n             current_dependencies.extend(dependencies)\n@@ -935,7 +936,7 @@ def add_api_route(\n             endpoint=endpoint,\n             response_model=response_model,\n             status_code=status_code,\n-            tags=current_tags,\n+            tags=list(current_tags),\n             dependencies=current_dependencies,\n             summary=summary,\n             description=description,\n@@ -1028,16 +1029,20 @@ def add_api_websocket_route(\n         endpoint: Callable[..., Any],\n         name: Optional[str] = None,\n         *,\n+        tags: Optional[List[Union[str, Enum]]] = None,\n         dependencies: Optional[Sequence[params.Depends]] = None,\n     ) -> None:\n         current_dependencies = self.dependencies.copy()\n         if dependencies:\n             current_dependencies.extend(dependencies)\n \n+        current_tags = self.combine_tags(tags)\n+\n         route = APIWebSocketRoute(\n             self.prefix + path,\n             endpoint=endpoint,\n             name=name,\n+            tags=current_tags,\n             dependencies=current_dependencies,\n             dependency_overrides_provider=self.dependency_overrides_provider,\n         )\n@@ -1062,6 +1067,14 @@ def websocket(\n             ),\n         ] = None,\n         *,\n+        tags: Annotated[\n+            Optional[List[Union[str, Enum]]],\n+            Doc(\n+                \"\"\"\n+                A list of tags to be applied to this WebSocket.\n+                \"\"\"\n+            ),\n+        ] = None,\n         dependencies: Annotated[\n             Optional[Sequence[params.Depends]],\n             Doc(\n@@ -1104,7 +1117,7 @@ async def websocket_endpoint(websocket: WebSocket):\n \n         def decorator(func: DecoratedCallable) -> DecoratedCallable:\n             self.add_api_websocke\n\n```\n\n```diff\n@@ -580,7 +580,7 @@ def test_openapi_schema(client: TestClient):\n                     },\n                 },\n                 \"put\": {\n-                    \"tags\": [\"items\", \"custom\"],\n+                    \"tags\": [\"custom\", \"items\"],\n                     \"summary\": \"Update Item\",\n                     \"operationId\": \"update_item_items__item_id__put\",\n                     \"parameters\": [\n\n```\n\n```diff\n@@ -13,9 +13,9 @@\n from fastapi.middleware import Middleware\n from fastapi.testclient import TestClient\n \n-router = APIRouter()\n-prefix_router = APIRouter()\n-native_prefix_route = APIRouter(prefix=\"/native\")\n+router = APIRouter(tags=[\"base\"])\n+prefix_router = APIRouter(tags=[\"prefix\"])\n+native_prefix_router = APIRouter(prefix=\"/native\", tags=[\"native\"])\n app = FastAPI()\n \n \n@@ -68,7 +68,7 @@ async def router_ws_decorator_depe", "output": "Changes look good. This PR implements: ‚ú® Add tags to websockets", "source": "pr", "type": "code_review", "pr_number": 414}
{"instruction": "Review the following code changes: test1", "input": "```diff\n@@ -0,0 +1,53 @@\n+name: Documentation Drift Check\n+\n+on:\n+  pull_request:\n+    types: [opened, synchronize, reopened]\n+\n+permissions:\n+  contents: read\n+  pull-requests: write\n+\n+jobs:\n+  check-docs-drift:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v4\n+        with:\n+          fetch-depth: 0\n+\n+      - name: Set up Node.js\n+        uses: actions/setup-node@v4\n+        with:\n+          node-version: \"18\"\n+\n+      - name: Run documentation drift detection\n+        env:\n+          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n+          PR_BASE_SHA: ${{ github.event.pull_request.base.sha }}\n+          PR_HEAD_SHA: ${{ github.event.pull_request.head.sha }}\n+        run: |\n+          node .github/scripts/detect_docs_drift.js\n+\n+      - name: Read drift count\n+        id: drift_count\n+        run: |\n+          COUNT=$(cat docs_drift_count.txt)\n+          echo \"count=$COUNT\" >> $GITHUB_OUTPUT\n+\n+      - name: Publish summary\n+        if: always()\n+        run: |\n+          cat docs_drift_report.md >> $GITHUB_STEP_SUMMARY\n+\n+      - name: Fail if documentation drift detected\n+        if: steps.drift_count.outputs.count != '0'\n+        run: |\n+          echo \"‚ùå Documentation drift detected: ${{ steps.drift_count.outputs.count }} suggestion(s)\"\n+          exit 1\n+\n+      - name: Success message\n+        if: steps.drift_count.outputs.count == '0'\n+        run: |\n+          echo \"‚úÖ No documentation drift detected\"\n\n```\n\n```diff\n@@ -0,0 +1,8 @@\n+\"\"\"\n+New configuration module for FastAPI\n+\"\"\"\n+\n+# New feature: Rate limiting\n+RATE_LIMIT_ENABLED = True\n+RATE_LIMIT_MAX_REQUESTS = 100\n+RATE_LIMIT_WINDOW_SECONDS = 60\n\n```", "output": "Changes look good. This PR implements: test1", "source": "pr", "type": "code_review", "pr_number": 413}
{"instruction": "Review the following code changes: üîß Update sponsors, LambdaTest changes to TestMu AI", "input": "```diff\n@@ -65,9 +65,9 @@ bronze:\n   # - url: https://testdriven.io/courses/tdd-fastapi/\n   #   title: Learn to build high-quality web apps with best practices\n   #   img: https://fastapi.tiangolo.com/img/sponsors/testdriven.svg\n-  - url: https://lambdatest.com/?utm_source=fastapi&utm_medium=partner&utm_campaign=sponsor&utm_term=opensource&utm_content=webpage\n-    title: LambdaTest, AI-Powered Cloud-based Test Orchestration Platform\n-    img: https://fastapi.tiangolo.com/img/sponsors/lambdatest.png\n+  - url: https://www.testmu.ai/?utm_source=fastapi&utm_medium=partner&utm_campaign=sponsor&utm_term=opensource&utm_content=webpage\n+    title: TestMu AI. The Native AI-Agentic Cloud Platform to Supercharge Quality Engineering.\n+    img: https://fastapi.tiangolo.com/img/sponsors/testmu.png\n   - url: https://requestly.com/fastapi\n     title: All-in-one platform to Test, Mock and Intercept APIs. Built for speed, privacy and offline support.\n     img: https://fastapi.tiangolo.com/img/sponsors/requestly.png\n\n```", "output": "Changes look good. This PR implements: üîß Update sponsors, LambdaTest changes to TestMu AI", "source": "pr", "type": "code_review", "pr_number": 411}
{"instruction": "Review the following code changes: üîß Update sponsors: remove Requestly", "input": "```diff\n@@ -68,6 +68,3 @@ bronze:\n   - url: https://www.testmu.ai/?utm_source=fastapi&utm_medium=partner&utm_campaign=sponsor&utm_term=opensource&utm_content=webpage\n     title: TestMu AI. The Native AI-Agentic Cloud Platform to Supercharge Quality Engineering.\n     img: https://fastapi.tiangolo.com/img/sponsors/testmu.png\n-  - url: https://requestly.com/fastapi\n-    title: All-in-one platform to Test, Mock and Intercept APIs. Built for speed, privacy and offline support.\n-    img: https://fastapi.tiangolo.com/img/sponsors/requestly.png\n\n```", "output": "Changes look good. This PR implements: üîß Update sponsors: remove Requestly", "source": "pr", "type": "code_review", "pr_number": 410}
{"instruction": "Review the following code changes: Improve newsletter documentation with clear context", "input": "```diff\n@@ -1,4 +1,17 @@\n-# FastAPI and friends newsletter\n+Stay up to date with the FastAPI ecosystem by subscribing to the **FastAPI and friends newsletter**.\n+\n+The newsletter occasionally shares:\n+\n+- Announcements about new FastAPI releases and features\n+- Updates from the FastAPI ecosystem and related projects\n+- Helpful tutorials, guides, and best practices\n+- Community news and important updates\n+\n+Emails are sent infrequently and focus on relevant, high-quality content for developers.\n+You can unsubscribe at any time using the link provided in each email.\n+\n+Use the form below to subscribe.\n+\n \n <iframe data-w-type=\"embedded\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" src=\"https://xr4n4.mjt.lu/wgt/xr4n4/hj5/form?c=40a44fa4\" width=\"100%\" style=\"height: 800px;\"></iframe>\n \n\n```", "output": "Changes look good. This PR implements: Improve newsletter documentation with clear context", "source": "pr", "type": "code_review", "pr_number": 409}
{"instruction": "Fix the following bug: ‚úèÔ∏è Fix typo in `docs/ja/docs/tutorial/response-status-code.md`", "input": "", "output": "```diff\n@@ -1,4 +1,4 @@\n-# „É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ\n+# „É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ { #response-status-code }\n \n „É¨„Çπ„Éù„É≥„Çπ„É¢„Éá„É´„ÇíÊåáÂÆö„Åô„Çã„ÅÆ„Å®Âêå„ÅòÊñπÊ≥ï„Åß„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Å´‰ΩøÁî®„Åï„Çå„ÇãHTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Çí‰ª•‰∏ã„ÅÆ*path operations*„ÅÆ„ÅÑ„Åö„Çå„Åã„ÅÆ`status_code`„Éë„É©„É°„Éº„Çø„ÅßÂÆ£Ë®Ä„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n \n@@ -8,7 +8,7 @@\n * `@app.delete()`\n * „Å™„Å©„ÄÇ\n \n-{* ../../docs_src/response_status_code/tutorial001.py hl[6] *}\n+{* ../../docs_src/response_status_code/tutorial001_py39.py hl[6] *}\n \n /// note | ÂÇôËÄÉ\n \n@@ -39,7 +39,7 @@ FastAPI„ÅØ„Åì„Çå„ÇíÁü•„Å£„Å¶„ÅÑ„Å¶„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Éú„Éá„Ç£„Åå„Å™„ÅÑ„Å®„ÅÑ„ÅÜO\n \n ///\n \n-## HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶\n+## HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶ { #about-http-status-codes }\n \n /// note | ÂÇôËÄÉ\n \n@@ -53,7 +53,7 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n „Å§„Åæ„Çä:\n \n-* `100`‰ª•‰∏ä„ÅØ„ÄåÊÉÖÂ†±„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„ÄÇÁõ¥Êé•‰Ωø„ÅÜ„Åì„Å®„ÅØ„Åª„Å®„Çì„Å©„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Çå„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÊåÅ„Å§„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Éú„Éá„Ç£„ÇíÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n+* `100`‰ª•‰∏ä„ÅØ„ÄåÊÉÖÂ†±„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇÁõ¥Êé•‰Ωø„ÅÜ„Åì„Å®„ÅØ„Åª„Å®„Çì„Å©„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Çå„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÊåÅ„Å§„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Éú„Éá„Ç£„ÇíÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n * **`200`** ‰ª•‰∏ä„ÅØ„ÄåÊàêÂäü„Äç„ÅÆ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„Åì„Çå„Çâ„ÅØÊúÄ„ÇÇÂà©Áî®„Åô„Çã„Åß„ÅÇ„Çç„ÅÜ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ\n     * `200`„ÅØ„Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åß„ÄÅ„Åô„Åπ„Å¶„Åå„ÄåOK„Äç„Åß„ÅÇ„Å£„Åü„Åì„Å®„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÄÇ\n     * Âà•„ÅÆ‰æã„Å®„Åó„Å¶„ÅØ„ÄÅ`201`ÔºàCreatedÔºâ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ„Éá„Éº„Çø„Éô„Éº„Çπ„Å´Êñ∞„Åó„ÅÑ„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê„Åó„ÅüÂæå„Å´„Çà„Åè‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ\n@@ -70,19 +70,19 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n ///\n \n-## ÂêçÂâç„ÇíË¶ö„Åà„Çã„Åü„ÇÅ„ÅÆËøëÈÅì\n+## ÂêçÂâç„ÇíË¶ö„Åà„Çã„Åü„ÇÅ„ÅÆËøëÈÅì { #shortcut-to-remember-the-names }\n \n ÂÖà„Åª„Å©„ÅÆ‰æã„Çí„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ:\n \n-{* ../../docs_src/response_status_code/tutorial001.py hl[6] *}\n+{* ../../docs_src/response_status_code/tutorial001_py39.py hl[6] *}\n \n `201`„ÅØ„Äå‰ΩúÊàêÂÆå‰∫Ü„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åß„Åô„ÄÇ\n \n „Åó„Åã„Åó„ÄÅ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Éº„Éâ„ÅÆÊÑèÂë≥„ÇíÊöóË®ò„Åô„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n \n `fastapi.status`„ÅÆ‰æøÂà©„Å™Â§âÊï∞„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n \n-{* ../../docs_src/response_status_code/tutorial002.py hl[1,6] *}\n+{* ../../docs_src/response_status_code/tutorial002_py39.py hl[1,6] *}\n \n „Åù„Çå„Çâ„ÅØ‰æøÂà©„Åß„Åô„ÄÇ„Åù„Çå„Çâ„ÅØÂêå„ÅòÁï™Âè∑„Çí‰øùÊåÅ„Åó„Å¶„Åä„Çä„ÄÅ„Åù„ÅÆÊñπÊ≥ï„Åß„ÅØ„Ç®„Éá„Ç£„Çø„ÅÆËá™ÂãïË£úÂÆå„Çí‰ΩøÁî®„Åó„Å¶„Åù„Çå„Çâ„ÇíË¶ã„Å§„Åë„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n \n@@ -96,6 +96,6 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n ///\n \n-## „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§âÊõ¥\n+## „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§âÊõ¥ { #changing-the-default }\n \n Âæå„Å´„ÄÅ[È´òÂ∫¶„Å™„É¶„Éº„Ç∂„Éº„Ç¨„Ç§„Éâ](../advanced/response-change-status-code.md){.internal-link target=_blank}„Åß„ÄÅ„Åì„Åì„ÅßÂÆ£Ë®Ä„Åó„Å¶„ÅÑ„Çã„Éá„Éï„Ç©„É´„Éà„Å®„ÅØÁï∞„Å™„Çã„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíËøî„ÅôÊñπÊ≥ï„ÇíË¶ã„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 408}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,4 +1,4 @@\n-# „É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ\n+# „É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ { #response-status-code }\n \n „É¨„Çπ„Éù„É≥„Çπ„É¢„Éá„É´„ÇíÊåáÂÆö„Åô„Çã„ÅÆ„Å®Âêå„ÅòÊñπÊ≥ï„Åß„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Å´‰ΩøÁî®„Åï„Çå„ÇãHTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Çí‰ª•‰∏ã„ÅÆ*path operations*„ÅÆ„ÅÑ„Åö„Çå„Åã„ÅÆ`status_code`„Éë„É©„É°„Éº„Çø„ÅßÂÆ£Ë®Ä„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n \n@@ -8,7 +8,7 @@\n * `@app.delete()`\n * „Å™„Å©„ÄÇ\n \n-{* ../../docs_src/response_status_code/tutorial001.py hl[6] *}\n+{* ../../docs_src/response_status_code/tutorial001_py39.py hl[6] *}\n \n /// note | ÂÇôËÄÉ\n \n@@ -39,7 +39,7 @@ FastAPI„ÅØ„Åì„Çå„ÇíÁü•„Å£„Å¶„ÅÑ„Å¶„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Éú„Éá„Ç£„Åå„Å™„ÅÑ„Å®„ÅÑ„ÅÜO\n \n ///\n \n-## HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶\n+## HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶ { #about-http-status-codes }\n \n /// note | ÂÇôËÄÉ\n \n@@ -53,7 +53,7 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n „Å§„Åæ„Çä:\n \n-* `100`‰ª•‰∏ä„ÅØ„ÄåÊÉÖÂ†±„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„ÄÇÁõ¥Êé•‰Ωø„ÅÜ„Åì„Å®„ÅØ„Åª„Å®„Çì„Å©„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Çå„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÊåÅ„Å§„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Éú„Éá„Ç£„ÇíÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n+* `100`‰ª•‰∏ä„ÅØ„ÄåÊÉÖÂ†±„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇÁõ¥Êé•‰Ωø„ÅÜ„Åì„Å®„ÅØ„Åª„Å®„Çì„Å©„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Çå„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÊåÅ„Å§„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Éú„Éá„Ç£„ÇíÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n * **`200`** ‰ª•‰∏ä„ÅØ„ÄåÊàêÂäü„Äç„ÅÆ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„Åì„Çå„Çâ„ÅØÊúÄ„ÇÇÂà©Áî®„Åô„Çã„Åß„ÅÇ„Çç„ÅÜ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ\n     * `200`„ÅØ„Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åß„ÄÅ„Åô„Åπ„Å¶„Åå„ÄåOK„Äç„Åß„ÅÇ„Å£„Åü„Åì„Å®„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÄÇ\n     * Âà•„ÅÆ‰æã„Å®„Åó„Å¶„ÅØ„ÄÅ`201`ÔºàCreatedÔºâ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ„Éá„Éº„Çø„Éô„Éº„Çπ„Å´Êñ∞„Åó„ÅÑ„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê„Åó„ÅüÂæå„Å´„Çà„Åè‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ\n@@ -70,19 +70,19 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n ///\n \n-## ÂêçÂâç„ÇíË¶ö„Åà„Çã„Åü„ÇÅ„ÅÆËøëÈÅì\n+## ÂêçÂâç„ÇíË¶ö„Åà„Çã„Åü„ÇÅ„ÅÆËøëÈÅì { #shortcut-to-remember-the-names }\n \n ÂÖà„Åª„Å©„ÅÆ‰æã„Çí„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ:\n \n-{* ../../docs_src/response_status_code/tutorial001.py hl[6] *}\n+{* ../../docs_src/response_status_code/tutorial001_py39.py hl[6] *}\n \n `201`„ÅØ„Äå‰ΩúÊàêÂÆå‰∫Ü„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åß„Åô„ÄÇ\n \n „Åó„Åã„Åó„ÄÅ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Éº„Éâ„ÅÆÊÑèÂë≥„ÇíÊöóË®ò„Åô„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n \n `fastapi.status`„ÅÆ‰æøÂà©„Å™Â§âÊï∞„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n \n-{* ../../docs_src/response_status_code/tutorial002.py hl[1,6] *}\n+{* ../../docs_src/response_status_code/tutorial002_py39.py hl[1,6] *}\n \n „Åù„Çå„Çâ„ÅØ‰æøÂà©„Åß„Åô„ÄÇ„Åù„Çå„Çâ„ÅØÂêå„ÅòÁï™Âè∑„Çí‰øùÊåÅ„Åó„Å¶„Åä„Çä„ÄÅ„Åù„ÅÆÊñπÊ≥ï„Åß„ÅØ„Ç®„Éá„Ç£„Çø„ÅÆËá™ÂãïË£úÂÆå„Çí‰ΩøÁî®„Åó„Å¶„Åù„Çå„Çâ„ÇíË¶ã„Å§„Åë„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n \n@@ -96,6 +96,6 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n ///\n \n-## „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§âÊõ¥\n+## „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§âÊõ¥ { #changing-the-default }\n \n Âæå„Å´„ÄÅ[È´òÂ∫¶„Å™„É¶„Éº„Ç∂„Éº„Ç¨„Ç§„Éâ](../advanced/response-change-status-code.md){.internal-link target=_blank}„Åß„ÄÅ„Åì„Åì„ÅßÂÆ£Ë®Ä„Åó„Å¶„ÅÑ„Çã„Éá„Éï„Ç©„É´„Éà„Å®„ÅØÁï∞„Å™„Çã„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíËøî„ÅôÊñπÊ≥ï„ÇíË¶ã„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ\n\n```", "output": "Bug: ‚úèÔ∏è Fix typo in `docs/ja/docs/tutorial/response-status-code.md`\n\n", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 408}
{"instruction": "Review the following code changes: ‚úèÔ∏è Fix typo in `docs/ja/docs/tutorial/response-status-code.md`", "input": "```diff\n@@ -1,4 +1,4 @@\n-# „É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ\n+# „É¨„Çπ„Éù„É≥„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ { #response-status-code }\n \n „É¨„Çπ„Éù„É≥„Çπ„É¢„Éá„É´„ÇíÊåáÂÆö„Åô„Çã„ÅÆ„Å®Âêå„ÅòÊñπÊ≥ï„Åß„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Å´‰ΩøÁî®„Åï„Çå„ÇãHTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Çí‰ª•‰∏ã„ÅÆ*path operations*„ÅÆ„ÅÑ„Åö„Çå„Åã„ÅÆ`status_code`„Éë„É©„É°„Éº„Çø„ÅßÂÆ£Ë®Ä„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n \n@@ -8,7 +8,7 @@\n * `@app.delete()`\n * „Å™„Å©„ÄÇ\n \n-{* ../../docs_src/response_status_code/tutorial001.py hl[6] *}\n+{* ../../docs_src/response_status_code/tutorial001_py39.py hl[6] *}\n \n /// note | ÂÇôËÄÉ\n \n@@ -39,7 +39,7 @@ FastAPI„ÅØ„Åì„Çå„ÇíÁü•„Å£„Å¶„ÅÑ„Å¶„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Éú„Éá„Ç£„Åå„Å™„ÅÑ„Å®„ÅÑ„ÅÜO\n \n ///\n \n-## HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶\n+## HTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å´„Å§„ÅÑ„Å¶ { #about-http-status-codes }\n \n /// note | ÂÇôËÄÉ\n \n@@ -53,7 +53,7 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n „Å§„Åæ„Çä:\n \n-* `100`‰ª•‰∏ä„ÅØ„ÄåÊÉÖÂ†±„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„ÄÇÁõ¥Êé•‰Ωø„ÅÜ„Åì„Å®„ÅØ„Åª„Å®„Çì„Å©„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Çå„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÊåÅ„Å§„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Éú„Éá„Ç£„ÇíÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n+* `100`‰ª•‰∏ä„ÅØ„ÄåÊÉÖÂ†±„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇÁõ¥Êé•‰Ωø„ÅÜ„Åì„Å®„ÅØ„Åª„Å®„Çì„Å©„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Åì„Çå„Çâ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÊåÅ„Å§„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Éú„Éá„Ç£„ÇíÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\n * **`200`** ‰ª•‰∏ä„ÅØ„ÄåÊàêÂäü„Äç„ÅÆ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ„Åì„Çå„Çâ„ÅØÊúÄ„ÇÇÂà©Áî®„Åô„Çã„Åß„ÅÇ„Çç„ÅÜ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ\n     * `200`„ÅØ„Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åß„ÄÅ„Åô„Åπ„Å¶„Åå„ÄåOK„Äç„Åß„ÅÇ„Å£„Åü„Åì„Å®„ÇíÊÑèÂë≥„Åó„Åæ„Åô„ÄÇ\n     * Âà•„ÅÆ‰æã„Å®„Åó„Å¶„ÅØ„ÄÅ`201`ÔºàCreatedÔºâ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ„Éá„Éº„Çø„Éô„Éº„Çπ„Å´Êñ∞„Åó„ÅÑ„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê„Åó„ÅüÂæå„Å´„Çà„Åè‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ\n@@ -70,19 +70,19 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n ///\n \n-## ÂêçÂâç„ÇíË¶ö„Åà„Çã„Åü„ÇÅ„ÅÆËøëÈÅì\n+## ÂêçÂâç„ÇíË¶ö„Åà„Çã„Åü„ÇÅ„ÅÆËøëÈÅì { #shortcut-to-remember-the-names }\n \n ÂÖà„Åª„Å©„ÅÆ‰æã„Çí„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë¶ã„Å¶„Åø„Åæ„Åó„Çá„ÅÜ:\n \n-{* ../../docs_src/response_status_code/tutorial001.py hl[6] *}\n+{* ../../docs_src/response_status_code/tutorial001_py39.py hl[6] *}\n \n `201`„ÅØ„Äå‰ΩúÊàêÂÆå‰∫Ü„Äç„ÅÆ„Åü„ÇÅ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åß„Åô„ÄÇ\n \n „Åó„Åã„Åó„ÄÅ„Åù„Çå„Åû„Çå„ÅÆ„Ç≥„Éº„Éâ„ÅÆÊÑèÂë≥„ÇíÊöóË®ò„Åô„ÇãÂøÖË¶Å„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n \n `fastapi.status`„ÅÆ‰æøÂà©„Å™Â§âÊï∞„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n \n-{* ../../docs_src/response_status_code/tutorial002.py hl[1,6] *}\n+{* ../../docs_src/response_status_code/tutorial002_py39.py hl[1,6] *}\n \n „Åù„Çå„Çâ„ÅØ‰æøÂà©„Åß„Åô„ÄÇ„Åù„Çå„Çâ„ÅØÂêå„ÅòÁï™Âè∑„Çí‰øùÊåÅ„Åó„Å¶„Åä„Çä„ÄÅ„Åù„ÅÆÊñπÊ≥ï„Åß„ÅØ„Ç®„Éá„Ç£„Çø„ÅÆËá™ÂãïË£úÂÆå„Çí‰ΩøÁî®„Åó„Å¶„Åù„Çå„Çâ„ÇíË¶ã„Å§„Åë„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n \n@@ -96,6 +96,6 @@ HTTP„Åß„ÅØ„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶ÔºìÊ°Å„ÅÆÊï∞Â≠ó„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ\n \n ///\n \n-## „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§âÊõ¥\n+## „Éá„Éï„Ç©„É´„Éà„ÅÆÂ§âÊõ¥ { #changing-the-default }\n \n Âæå„Å´„ÄÅ[È´òÂ∫¶„Å™„É¶„Éº„Ç∂„Éº„Ç¨„Ç§„Éâ](../advanced/response-change-status-code.md){.internal-link target=_blank}„Åß„ÄÅ„Åì„Åì„ÅßÂÆ£Ë®Ä„Åó„Å¶„ÅÑ„Çã„Éá„Éï„Ç©„É´„Éà„Å®„ÅØÁï∞„Å™„Çã„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíËøî„ÅôÊñπÊ≥ï„ÇíË¶ã„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ\n\n```", "output": "Changes look good. This PR implements: ‚úèÔ∏è Fix typo in `docs/ja/docs/tutorial/response-status-code.md`", "source": "pr", "type": "code_review", "pr_number": 408}
{"instruction": "Fix the following bug: Fix forward references inside Annotated dependencies", "input": "Fixes #13056\r\n\r\nThis PR fixes a bug where forward references inside typing.Annotated were not\r\nresolved correctly for dependency injection and OpenAPI generation.\r\n\r\nThe fix resolves type hints using get_type_hints(..., include_extras=True)\r\nbefore parameter analysis.\r\n\r\nA regression test is included.", "output": "```diff\n@@ -13,6 +13,7 @@\n     Optional,\n     Union,\n     cast,\n+    get_type_hints,\n )\n \n import anyio\n@@ -270,8 +271,19 @@ def get_dependant(\n     current_scopes = (parent_oauth_scopes or []) + (own_oauth_scopes or [])\n     path_param_names = get_path_param_names(path)\n     endpoint_signature = get_typed_signature(call)\n+\n+    # Resolve forward references inside Annotated (fix for issue #13056)\n+    try:\n+        type_hints = get_type_hints(call, include_extras=True)\n+    except Exception:\n+        type_hints = {}\n+\n     signature_params = endpoint_signature.parameters\n+\n     for param_name, param in signature_params.items():\n+        # Inject fully resolved Annotated types (including forward refs)\n+        if param_name in type_hints:\n+            param = param.replace(annotation=type_hints[param_name])\n         is_path_param = param_name in path_param_names\n         param_details = analyze_param(\n             param_name=param_name,\n\n```\n\n```diff\n@@ -0,0 +1,28 @@\n+from __future__ import annotations\n+\n+from dataclasses import dataclass\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_annotated_forwardref_dependency():\n+    app = FastAPI()\n+\n+    def get_item() -> Item:\n+        return Item(name=\"apple\")\n+\n+    @app.get(\"/\")\n+    def read(item: Annotated[Item, Depends(get_item)]):\n+        return {\"name\": item.name}\n+\n+    @dataclass\n+    class Item:\n+        name: str\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 200\n+    assert response.json() == {\"name\": \"apple\"}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 407}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -13,6 +13,7 @@\n     Optional,\n     Union,\n     cast,\n+    get_type_hints,\n )\n \n import anyio\n@@ -270,8 +271,19 @@ def get_dependant(\n     current_scopes = (parent_oauth_scopes or []) + (own_oauth_scopes or [])\n     path_param_names = get_path_param_names(path)\n     endpoint_signature = get_typed_signature(call)\n+\n+    # Resolve forward references inside Annotated (fix for issue #13056)\n+    try:\n+        type_hints = get_type_hints(call, include_extras=True)\n+    except Exception:\n+        type_hints = {}\n+\n     signature_params = endpoint_signature.parameters\n+\n     for param_name, param in signature_params.items():\n+        # Inject fully resolved Annotated types (including forward refs)\n+        if param_name in type_hints:\n+            param = param.replace(annotation=type_hints[param_name])\n         is_path_param = param_name in path_param_names\n         param_details = analyze_param(\n             param_name=param_name,\n\n```\n\n```diff\n@@ -0,0 +1,28 @@\n+from __future__ import annotations\n+\n+from dataclasses import dataclass\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_annotated_forwardref_dependency():\n+    app = FastAPI()\n+\n+    def get_item() -> Item:\n+        return Item(name=\"apple\")\n+\n+    @app.get(\"/\")\n+    def read(item: Annotated[Item, Depends(get_item)]):\n+        return {\"name\": item.name}\n+\n+    @dataclass\n+    class Item:\n+        name: str\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 200\n+    assert response.json() == {\"name\": \"apple\"}\n\n```", "output": "Bug: Fix forward references inside Annotated dependencies\n\nFixes #13056\r\n\r\nThis PR fixes a bug where forward references inside typing.Annotated were not\r\nresolved correctly for dependency injection and OpenAPI generation.\r\n\r\nThe fix resolves type hints using get_type_hints(..., include_extras=True)\r\nbefore parameter analysis.\r\n\r\nA regression test is included.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 407}
{"instruction": "Review the following code changes: Fix forward references inside Annotated dependencies", "input": "```diff\n@@ -13,6 +13,7 @@\n     Optional,\n     Union,\n     cast,\n+    get_type_hints,\n )\n \n import anyio\n@@ -270,8 +271,19 @@ def get_dependant(\n     current_scopes = (parent_oauth_scopes or []) + (own_oauth_scopes or [])\n     path_param_names = get_path_param_names(path)\n     endpoint_signature = get_typed_signature(call)\n+\n+    # Resolve forward references inside Annotated (fix for issue #13056)\n+    try:\n+        type_hints = get_type_hints(call, include_extras=True)\n+    except Exception:\n+        type_hints = {}\n+\n     signature_params = endpoint_signature.parameters\n+\n     for param_name, param in signature_params.items():\n+        # Inject fully resolved Annotated types (including forward refs)\n+        if param_name in type_hints:\n+            param = param.replace(annotation=type_hints[param_name])\n         is_path_param = param_name in path_param_names\n         param_details = analyze_param(\n             param_name=param_name,\n\n```\n\n```diff\n@@ -0,0 +1,28 @@\n+from __future__ import annotations\n+\n+from dataclasses import dataclass\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_annotated_forwardref_dependency():\n+    app = FastAPI()\n+\n+    def get_item() -> Item:\n+        return Item(name=\"apple\")\n+\n+    @app.get(\"/\")\n+    def read(item: Annotated[Item, Depends(get_item)]):\n+        return {\"name\": item.name}\n+\n+    @dataclass\n+    class Item:\n+        name: str\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 200\n+    assert response.json() == {\"name\": \"apple\"}\n\n```", "output": "Changes look good. This PR implements: Fix forward references inside Annotated dependencies", "source": "pr", "type": "code_review", "pr_number": 407}
{"instruction": "Review the following code changes: üåê Improve LLM prompt for Turkish translations", "input": "```diff\n@@ -4,24 +4,40 @@ Translate to Turkish (T√ºrk√ße).\n \n Language code: tr.\n \n+### Core principle\n+\n+Don't translate word-by-word. Rewrite naturally in Turkish as if writing the doc from scratch. Preserve meaning, but prioritize fluency over literal accuracy.\n+\n ### Grammar and tone\n \n - Use instructional Turkish, consistent with existing Turkish docs.\n-- Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+- Use imperative/guide language (e.g. \"a√ßalƒ±m\", \"gidin\", \"kopyalayalƒ±m\", \"bir bakalƒ±m\").\n+- Avoid filler words and overly long sentences.\n+- Ensure sentences make sense in Turkish context ‚Äî adjust structure, conjunctions, and verb forms as needed for natural flow (e.g. use \"Ancak\" instead of \"Ve\" when connecting contrasting sentences, use \"-maktadƒ±r/-mektedir\" for formal statements).\n \n ### Headings\n \n - Follow existing Turkish heading style (Title Case where used; no trailing period).\n \n ### Quotes\n \n-- Alƒ±ntƒ± stili mevcut T√ºrk√ße dok√ºmanlarla tutarlƒ± tutun (genellikle metin i√ßinde ASCII tƒ±rnak i≈üaretleri kullanƒ±lƒ±r).\n-- Satƒ±r i√ßi kod, kod bloklarƒ±, URL'ler veya dosya yollarƒ± i√ßindeki tƒ±rnak i≈üaretlerini asla deƒüi≈ütirmeyin.\n+- Keep quote style consistent with existing Turkish docs (typically ASCII quotes in text).\n+- Never modify quotes inside inline code, code blocks, URLs, or file paths.\n \n ### Ellipsis\n \n-- √ú√ß nokta (...) stili mevcut T√ºrk√ße dok√ºmanlarla tutarlƒ± tutun.\n-- Kod, URL veya CLI √∂rneklerindeki `...` ifadesini asla deƒüi≈ütirmeyin.\n+- Keep ellipsis style (`...`) consistent with existing Turkish docs.\n+- Never modify `...` in code, URLs, or CLI examples.\n+\n+### Consistency\n+\n+- Use the same translation for the same term throughout the document.\n+- If you translate a concept one way, keep it consistent across all occurrences.\n+\n+### Links and references\n+\n+- Never modify link syntax like `{.internal-link target=_blank}`.\n+- Keep markdown link structure intact: `[text](url){.internal-link}`.\n \n ### Preferred translations / glossary\n \n\n```", "output": "Changes look good. This PR implements: üåê Improve LLM prompt for Turkish translations", "source": "pr", "type": "code_review", "pr_number": 406}
{"instruction": "Review the following code changes: üåê Improve LLM prompt for Turkish translations - copy", "input": "```diff\n@@ -4,24 +4,40 @@ Translate to Turkish (T√ºrk√ße).\n \n Language code: tr.\n \n+### Core principle\n+\n+Don't translate word-by-word. Rewrite naturally in Turkish as if writing the doc from scratch. Preserve meaning, but prioritize fluency over literal accuracy.\n+\n ### Grammar and tone\n \n - Use instructional Turkish, consistent with existing Turkish docs.\n-- Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+- Use imperative/guide language (e.g. \"a√ßalƒ±m\", \"gidin\", \"kopyalayalƒ±m\", \"bir bakalƒ±m\").\n+- Avoid filler words and overly long sentences.\n+- Ensure sentences make sense in Turkish context ‚Äî adjust structure, conjunctions, and verb forms as needed for natural flow (e.g. use \"Ancak\" instead of \"Ve\" when connecting contrasting sentences, use \"-maktadƒ±r/-mektedir\" for formal statements).\n \n ### Headings\n \n - Follow existing Turkish heading style (Title Case where used; no trailing period).\n \n ### Quotes\n \n-- Alƒ±ntƒ± stili mevcut T√ºrk√ße dok√ºmanlarla tutarlƒ± tutun (genellikle metin i√ßinde ASCII tƒ±rnak i≈üaretleri kullanƒ±lƒ±r).\n-- Satƒ±r i√ßi kod, kod bloklarƒ±, URL'ler veya dosya yollarƒ± i√ßindeki tƒ±rnak i≈üaretlerini asla deƒüi≈ütirmeyin.\n+- Keep quote style consistent with existing Turkish docs (typically ASCII quotes in text).\n+- Never modify quotes inside inline code, code blocks, URLs, or file paths.\n \n ### Ellipsis\n \n-- √ú√ß nokta (...) stili mevcut T√ºrk√ße dok√ºmanlarla tutarlƒ± tutun.\n-- Kod, URL veya CLI √∂rneklerindeki `...` ifadesini asla deƒüi≈ütirmeyin.\n+- Keep ellipsis style (`...`) consistent with existing Turkish docs.\n+- Never modify `...` in code, URLs, or CLI examples.\n+\n+### Consistency\n+\n+- Use the same translation for the same term throughout the document.\n+- If you translate a concept one way, keep it consistent across all occurrences.\n+\n+### Links and references\n+\n+- Never modify link syntax like `{.internal-link target=_blank}`.\n+- Keep markdown link structure intact: `[text](url){.internal-link}`.\n \n ### Preferred translations / glossary\n \n\n```", "output": "Changes look good. This PR implements: üåê Improve LLM prompt for Turkish translations - copy", "source": "pr", "type": "code_review", "pr_number": 405}
{"instruction": "Review the following code changes: üåê Update translations for tr (update-outdated)", "input": "```diff\n@@ -1,3 +1,3 @@\n-# Hakkƒ±nda\n+# Hakkƒ±nda { #about }\n \n FastAPI, tasarƒ±mƒ±, ilham kaynaƒüƒ± ve daha fazlasƒ± hakkƒ±nda. ü§ì\n\n```\n\n```diff\n@@ -1,36 +1,21 @@\n-# Geli≈ümi≈ü Kullanƒ±cƒ± Rehberi\n+# Geli≈ümi≈ü Kullanƒ±cƒ± Rehberi { #advanced-user-guide }\n \n-## Ek √ñzellikler\n+## Ek √ñzellikler { #additional-features }\n \n-[Tutorial - User Guide](../tutorial/index.md){.internal-link target=_blank} sayfasƒ± **FastAPI**'ƒ±n t√ºm ana √∂zelliklerini tanƒ±tmaya yetecektir.\n+Ana [Tutorial - User Guide](../tutorial/index.md){.internal-link target=_blank} sayfasƒ±, **FastAPI**'ƒ±n t√ºm ana √∂zellikleri arasƒ±nda bir tur atmanƒ±z i√ßin yeterli olmalƒ±dƒ±r.\n \n-ƒ∞lerleyen b√∂l√ºmlerde diƒüer se√ßenekler, konfig√ºrasyonlar ve ek √∂zellikleri g√∂receƒüiz.\n+ƒ∞lerleyen b√∂l√ºmlerde diƒüer se√ßenekler, konfig√ºrasyonlar ve ek √∂zellikleri g√∂receksiniz.\n \n /// tip | ƒ∞pucu\n \n Sonraki b√∂l√ºmler **mutlaka \"geli≈ümi≈ü\" olmak zorunda deƒüildir**.\n \n-Kullanƒ±m ≈üeklinize baƒülƒ± olarak, √ß√∂z√ºm√ºn√ºz bu b√∂l√ºmlerden birinde olabilir.\n+Ve kullanƒ±m senaryonuza baƒülƒ± olarak, √ß√∂z√ºm bu b√∂l√ºmlerden birinde olabilir.\n \n ///\n \n-## √ñnce √ñƒüreticiyi Okuyun\n+## √ñnce √ñƒüreticiyi Okuyun { #read-the-tutorial-first }\n \n-[Tutorial - User Guide](../tutorial/index.md){.internal-link target=_blank} sayfasƒ±ndaki bilgilerle **FastAPI**'nƒ±n √ßoƒüu √∂zelliƒüini kullanabilirsiniz.\n+Ana [Tutorial - User Guide](../tutorial/index.md){.internal-link target=_blank} sayfasƒ±ndaki bilgilerle **FastAPI**'ƒ±n √ßoƒüu √∂zelliƒüini yine de kullanabilirsiniz.\n \n-Sonraki b√∂l√ºmler bu sayfayƒ± okuduƒüunuzu ve bu ana fikirleri bildiƒüinizi varsayarak hazƒ±rlanmƒ±≈ütƒ±r.\n-\n-## Diƒüer Kurslar\n-\n-[Tutorial - User Guide](../tutorial/index.md){.internal-link target=_blank} sayfasƒ± ve bu **Geli≈ümi≈ü Kullanƒ±cƒ± Rehberi**, √∂ƒüretici bir kƒ±lavuz (bir kitap gibi) ≈üeklinde yazƒ±lmƒ±≈ütƒ±r ve **FastAPI'ƒ± √∂ƒürenmek** i√ßin yeterli olsa da, ek kurslarla desteklemek isteyebilirsiniz.\n-\n-Belki de √∂ƒürenme tarzƒ±nƒ±za daha iyi uyduƒüu i√ßin ba≈üka kurslarƒ± tercih edebilirsiniz.\n-\n-Bazƒ± kurs saƒülayƒ±cƒ±larƒ± ‚ú® [**FastAPI destek√ßileridir**](../help-fastapi.md#sponsor-the-author){.internal-link target=_blank} ‚ú®, bu FastAPI ve **ekosisteminin** s√ºrekli ve saƒülƒ±klƒ± bir ≈üekilde **geli≈ümesini** saƒülar.\n-\n-Ayrƒ±ca, size **iyi bir √∂ƒürenme deneyimi** saƒülamakla kalmayƒ±p, **iyi ve saƒülƒ±klƒ± bir framework** olan FastAPI'a ve ve **topluluƒüuna** (yani size) olan ger√ßek baƒülƒ±lƒ±klarƒ±nƒ± g√∂sterir.\n-\n-Onlarƒ±n kurslarƒ±nƒ± denemek isteyebilirsiniz:\n-\n-* <a href=\"https://training.talkpython.fm/fastapi-courses\" class=\"external-link\" target=\"_blank\">Talk Python Training</a>\n-* <a href=\"https://testdriven.io/courses/tdd-fastapi/\" class=\"external-link\" target=\"_blank\">Test-Driven Development</a>\n+Ve sonraki b√∂l√ºmler, onu zaten okuduƒüunuzu ve o ana fikirleri bildiƒüinizi varsayar.\n\n```\n\n```diff\n@@ -1,19 +1,19 @@\n-# Geli≈ümi≈ü G√ºvenlik\n+# Geli≈ümi≈ü G√ºvenlik { #advanced-security }\n \n-## Ek √ñzellikler\n+## Ek √ñzellikler { #additional-features }\n \n [Tutorial - User Guide: Security](../../tutorial/security/index.md){.internal-link target=_blank} sayfasƒ±nda ele alƒ±nanlarƒ±n dƒ±≈üƒ±nda g√ºvenlikle ilgili bazƒ± ek √∂zellikler vardƒ±r.\n \n /// tip | ƒ∞pucu\n \n Sonraki b√∂l√ºmler **mutlaka \"geli≈ümi≈ü\" olmak zorunda deƒüildir**.\n \n-Kullanƒ±m ≈üeklinize baƒülƒ± olarak, √ß√∂z√ºm√ºn√ºz bu b√∂l√ºmlerden birinde olabilir.\n+Ve kullanƒ±m durumunuz i√ßin √ß√∂z√ºm√ºn bunlardan birinde olmasƒ± m√ºmk√ºnd√ºr.\n \n ///\n \n-## √ñnce √ñƒüreticiyi Okuyun\n+## √ñnce √ñƒüreticiyi Okuyun { #read-the-tutorial-first }\n \n-Sonraki b√∂l√ºmler [Tutorial - User Guide: Security](../../tutorial/security/index.md){.internal-link target=_blank} sayfasƒ±nƒ± okuduƒüunuzu varsayarak hazƒ±rlanmƒ±≈ütƒ±r.\n+Sonraki b√∂l√ºmler, ana [Tutorial - User Guide: Security](../../tutorial/security/index.md){.internal-link target=_blank} sayfasƒ±nƒ± zaten okuduƒüunuzu varsayar.\n \n-Bu b√∂l√ºmler aynƒ± kavramlara dayanƒ±r, ancak bazƒ± ek i≈ülevsellikler saƒülar.\n+Hepsi aynƒ± kavramlara dayanƒ±r, ancak bazƒ± ek i≈ülevler saƒülar.\n\n```\n\n```diff\n@@ -1,13 +1,13 @@\n-# WebSockets'i Test Etmek\n+# WebSockets'i Test Etmek { #testing-websockets }\n \n-WebSockets testi yapmak i√ßin `TestClient`'ƒ± kullanabilirsiniz.\n+WebSockets'i test etmek i√ßin aynƒ± `TestClient`'ƒ± kullanabilirsiniz.\n \n-Bu i≈ülem i√ßin, `TestClient`'ƒ± bir `with` ifadesinde kullanarak WebSocket'e baƒülanabilirsiniz:\n+Bunun i√ßin, `TestClient`'ƒ± bir `with` ifadesinde kullanarak WebSocket'e baƒülanƒ±rsƒ±nƒ±z:\n \n-{* ../../docs_src/app_testing/tutorial002.py hl[27:31] *}\n+{* ../../docs_src/app_testing/tutorial002_py39.py hl[27:31] *}\n \n /// note | Not\n \n-Daha fazla detay i√ßin Starlette'in <a href=\"https://www.starlette.dev/staticfiles/\" class=\"external-link\" target=\"_blank\">Websockets'i Test Etmek</a> dok√ºmantasyonunu inceleyin.\n+Daha fazla detay i√ßin Starlette'in <a href=\"https://www.starlette.dev/testclient/#testing-websocket-sessions\" class=\"external-link\" target=\"_blank\">WebSockets'i test etme</a> dok√ºmantasyonunu inceleyin.\n \n ///\n\n```\n\n```diff\n@@ -1,32 +1,32 @@\n-# WSGI - Flask, Django ve Daha Fazlasƒ±nƒ± FastAPI ile Kullanma\n+# WSGI Dahil Etme - Flask, Django, Diƒüerleri { #including-wsgi-flask-django-other", "output": "Changes look good. This PR implements: üåê Update translations for tr (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 403}
{"instruction": "Review the following code changes: üåê Update translations for tr (translate-page)", "input": "```diff\n@@ -1,34 +1,34 @@\n-# Kƒ±yaslamalar\n+# Kƒ±yaslamalar { #benchmarks }\n \n-Baƒüƒ±msƒ±z TechEmpower kƒ±yaslamalarƒ± g√∂steriyor ki <a href=\"https://www.techempower.com/benchmarks/#section=test&runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&hw=ph&test=query&l=zijzen-7\" class=\"external-link\" target=\"_blank\">en hƒ±zlƒ± Python frameworklerinden birisi</a> olan Uvicorn ile √ßalƒ±≈ütƒ±rƒ±lan **FastAPI** uygulamalarƒ±, sadece Starlette ve Uvicorn'dan daha d√º≈ü√ºk sƒ±ralamada (FastAPI bu frameworklerin √ºzerine kurulu) yer alƒ±yor. (*)\n+Baƒüƒ±msƒ±z TechEmpower kƒ±yaslamalarƒ±, Uvicorn altƒ±nda √ßalƒ±≈üan **FastAPI** uygulamalarƒ±nƒ±n <a href=\"https://www.techempower.com/benchmarks/#section=test&runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&hw=ph&test=query&l=zijzen-7\" class=\"external-link\" target=\"_blank\">mevcut en hƒ±zlƒ± Python frameworklerinden biri</a> olduƒüunu; yalnƒ±zca Starlette ve Uvicorn‚Äôun kendilerinin (FastAPI tarafƒ±ndan dahili olarak kullanƒ±lƒ±r) altƒ±nda kaldƒ±ƒüƒ±nƒ± g√∂steriyor.\n \n-Fakat kƒ±yaslamalarƒ± ve kar≈üƒ±la≈ütƒ±rmalarƒ± incelerken ≈üunlarƒ± aklƒ±nƒ±zda bulundurmalƒ±sƒ±nƒ±z.\n+Ancak kƒ±yaslamalarƒ± ve kar≈üƒ±la≈ütƒ±rmalarƒ± incelerken ≈üunlarƒ± aklƒ±nƒ±zda bulundurmalƒ±sƒ±nƒ±z.\n \n-## Kƒ±yaslamalar ve Hƒ±z\n+## Kƒ±yaslamalar ve Hƒ±z { #benchmarks-and-speed }\n \n-Kƒ±yaslamalarƒ± incelediƒüinizde, farklƒ± √∂zelliklere sahip ara√ßlarƒ±n e≈üdeƒüer olarak kar≈üƒ±la≈ütƒ±rƒ±ldƒ±ƒüƒ±nƒ± yaygƒ±n bir ≈üekilde g√∂rebilirsiniz.\n+Kƒ±yaslamalarƒ± incelediƒüinizde, farklƒ± t√ºrlerdeki bir√ßok aracƒ±n e≈üdeƒüer kabul edilerek kar≈üƒ±la≈ütƒ±rƒ±ldƒ±ƒüƒ±nƒ± g√∂rmek yaygƒ±ndƒ±r.\n \n-√ñzellikle, (diƒüer bir√ßok ara√ß arasƒ±nda) Uvicorn, Starlette ve FastAPI'ƒ±n birlikte kar≈üƒ±la≈ütƒ±rƒ±ldƒ±ƒüƒ±nƒ± g√∂rebilirsiniz.\n+√ñzellikle, (diƒüer bir√ßok aracƒ±n arasƒ±nda) Uvicorn, Starlette ve FastAPI‚Äôƒ±n birlikte kar≈üƒ±la≈ütƒ±rƒ±ldƒ±ƒüƒ±nƒ± g√∂rebilirsiniz.\n \n-Aracƒ±n √ß√∂zd√ºƒü√º problem ne kadar basitse, performansƒ± o kadar iyi olacaktƒ±r. Ancak kƒ±yaslamalarƒ±n √ßoƒüu, aracƒ±n saƒüladƒ±ƒüƒ± ek √∂zellikleri test etmez.\n+Aracƒ±n √ß√∂zd√ºƒü√º problem ne kadar basitse, elde edeceƒüi performans o kadar iyi olur. Ayrƒ±ca kƒ±yaslamalarƒ±n √ßoƒüu, aracƒ±n saƒüladƒ±ƒüƒ± ek √∂zellikleri test etmez.\n \n Hiyerar≈üi ≈ü√∂yledir:\n \n * **Uvicorn**: bir ASGI sunucusu\n-    * **Starlette**: (Uvicorn'u kullanƒ±r) bir web mikroframework√º\n-        * **FastAPI**: (Starlette'i kullanƒ±r) veri doƒürulama vb. √ße≈üitli ek √∂zelliklere sahip, API olu≈üturmak i√ßin kullanƒ±lan bir API mikroframework√º\n+    * **Starlette**: (Uvicorn‚Äôu kullanƒ±r) bir web microframework‚Äô√º\n+        * **FastAPI**: (Starlette‚Äôi kullanƒ±r) API‚Äôlar olu≈üturmak i√ßin veri doƒürulama vb. √ße≈üitli ek √∂zelliklere sahip bir API microframework‚Äô√º\n \n * **Uvicorn**:\n-    * Sunucunun kendisi dƒ±≈üƒ±nda ekstra bir kod i√ßermediƒüi i√ßin en iyi performansa sahip olacaktƒ±r.\n-    * Doƒürudan Uvicorn ile bir uygulama yazmazsƒ±nƒ±z. Bu, yazdƒ±ƒüƒ±nƒ±z kodun en azƒ±ndan Starlette tarafƒ±ndan saƒülanan t√ºm kodu (veya **FastAPI**) az √ßok i√ßermesi gerektiƒüi anlamƒ±na gelir. Eƒüer bunu yaptƒ±ysanƒ±z, son uygulamanƒ±z bir framework kullanmak ve uygulama kodlarƒ±nƒ± ve hatalarƒ± en aza indirmekle aynƒ± ek y√ºke sahip olacaktƒ±r.\n-    * Eƒüer Uvicorn'u kar≈üƒ±la≈ütƒ±rƒ±yorsanƒ±z, D\n\n```\n\n```diff\n@@ -4,24 +4,40 @@ Translate to Turkish (T√ºrk√ße).\n \n Language code: tr.\n \n+### Core principle\n+\n+Don't translate word-by-word. Rewrite naturally in Turkish as if writing the doc from scratch. Preserve meaning, but prioritize fluency over literal accuracy.\n+\n ### Grammar and tone\n \n - Use instructional Turkish, consistent with existing Turkish docs.\n-- Use imperative/guide language when appropriate (e.g. ‚Äúa√ßalƒ±m‚Äù, ‚Äúgidin‚Äù, ‚Äúkopyalayalƒ±m‚Äù).\n+- Use imperative/guide language (e.g. \"a√ßalƒ±m\", \"gidin\", \"kopyalayalƒ±m\", \"bir bakalƒ±m\").\n+- Avoid filler words and overly long sentences.\n+- Ensure sentences make sense in Turkish context ‚Äî adjust structure, conjunctions, and verb forms as needed for natural flow (e.g. use \"Ancak\" instead of \"Ve\" when connecting contrasting sentences, use \"-maktadƒ±r/-mektedir\" for formal statements).\n \n ### Headings\n \n - Follow existing Turkish heading style (Title Case where used; no trailing period).\n \n ### Quotes\n \n-- Alƒ±ntƒ± stili mevcut T√ºrk√ße dok√ºmanlarla tutarlƒ± tutun (genellikle metin i√ßinde ASCII tƒ±rnak i≈üaretleri kullanƒ±lƒ±r).\n-- Satƒ±r i√ßi kod, kod bloklarƒ±, URL'ler veya dosya yollarƒ± i√ßindeki tƒ±rnak i≈üaretlerini asla deƒüi≈ütirmeyin.\n+- Keep quote style consistent with existing Turkish docs (typically ASCII quotes in text).\n+- Never modify quotes inside inline code, code blocks, URLs, or file paths.\n \n ### Ellipsis\n \n-- √ú√ß nokta (...) stili mevcut T√ºrk√ße dok√ºmanlarla tutarlƒ± tutun.\n-- Kod, URL veya CLI √∂rneklerindeki `...` ifadesini asla deƒüi≈ütirmeyin.\n+- Keep ellipsis style (`...`) consistent with existing Turkish docs.\n+- Never modify `...` in code, URLs, or CLI examples.\n+\n+### Consistency\n+\n+- Use the same translation for the same term throughout the document.\n+- If you translate a concept one way, keep it consistent across all occurrences.\n+\n+### Links and references\n+\n+- Never modify link syntax like `{.internal-link target=_blank}`.\n+- Keep markdown link structure intact: `[text](url){.internal-link}`.\n \n ### Pr", "output": "Changes look good. This PR implements: üåê Update translations for tr (translate-page)", "source": "pr", "type": "code_review", "pr_number": 402}
{"instruction": "Review the following code changes: üåê Update translations for ru (update-outdated)", "input": "```diff\n@@ -1,8 +1,8 @@\n # –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª LLM { #llm-test-file }\n \n-–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–Ω–∏–º–∞–µ—Ç –ª–∏ <abbr title=\"Large Language Model ‚Äì –ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å\">LLM</abbr>, –ø–µ—Ä–µ–≤–æ–¥—è—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, `general_prompt` –≤ `scripts/translate.py` –∏ —è–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ `docs/{language code}/llm-prompt.md`. –Ø–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ `general_prompt`.\n+–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–Ω–∏–º–∞–µ—Ç –ª–∏ <abbr title=\"Large Language Model - –ë–æ–ª—å—à–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å\">LLM</abbr>, –ø–µ—Ä–µ–≤–æ–¥—è—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, `general_prompt` –≤ `scripts/translate.py` –∏ —è–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ `docs/{language code}/llm-prompt.md`. –Ø–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ `general_prompt`.\n \n-–¢–µ—Å—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–¥–µ—Å—å, —É–≤–∏–¥—è—Ç –≤—Å–µ —Å–æ–∑–¥–∞—Ç–µ–ª–∏ —è–∑—ã–∫–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤.\n+–¢–µ—Å—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–¥–µ—Å—å, —É–≤–∏–¥—è—Ç –≤—Å–µ —Å–æ–∑–¥–∞—Ç–µ–ª–∏ —è–∑—ã–∫–æ–≤—ã—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤.\n \n –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:\n \n@@ -11,7 +11,7 @@\n * –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤—Å—ë –ª–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –≤ –ø–µ—Ä–µ–≤–æ–¥–µ.\n * –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–ª—É—á—à–∏—Ç–µ –≤–∞—à —è–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –æ–±—â–∏–π –ø—Ä–æ–º–ø—Ç –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç.\n * –ó–∞—Ç–µ–º –≤—Ä—É—á–Ω—É—é –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø–µ—Ä–µ–≤–æ–¥–µ, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª —Ö–æ—Ä–æ—à–∏–º.\n-* –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ, –∏–º–µ—è —Ö–æ—Ä–æ—à–∏–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –º–µ—Å—Ç–µ. –ò–¥–µ–∞–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ LLM –±–æ–ª—å—à–µ –Ω–µ –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø–µ—Ä–µ–≤–æ–¥. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–±—â–∏–π –ø—Ä–æ–º–ø—Ç –∏ –≤–∞—à —è–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ö–æ—Ä–æ—à–∏ (–∏–Ω–æ–≥–¥–∞ –æ–Ω –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∫–∞–∑–∞–ª–æ—Å—å –±—ã, —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–∏—á–∏–Ω–∞ –≤ —Ç–æ–º, —á—Ç–æ <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM ‚Äî –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã</a>).\n+* –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ, –∏–º–µ—è —Ö–æ—Ä–æ—à–∏–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –º–µ—Å—Ç–µ. –ò–¥–µ–∞–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ LLM –±–æ–ª—å—à–µ –Ω–µ –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø–µ—Ä–µ–≤–æ–¥. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–±—â–∏–π –ø—Ä–æ–º–ø—Ç –∏ –≤–∞—à —è–∑—ã–∫–æ–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞—Å—Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∏, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ (–∏–Ω–æ–≥–¥–∞ –æ–Ω –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∫–∞–∑–∞–ª–æ—Å—å –±—ã, —Å–ª—É—á–∞–π–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø—Ä–∏—á–∏–Ω–∞ –≤ —Ç–æ–º, —á—Ç–æ <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM ‚Äî –Ω–µ–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã</a>).\n \n –¢–µ—Å—Ç—ã:\n \n@@ -197,10 +197,10 @@ works(foo=\"bar\")  # –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç üéâ\n \n ### abbr –¥–∞—ë—Ç –ø–æ–ª–Ω—É—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É { #the-abbr-gives-a-full-phrase }\n \n-* <abbr title=\"Getting Things Done ‚Äì –ö–∞–∫ –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–µ–ª–∞ –≤ –ø–æ—Ä—è–¥–æ–∫\">GTD</abbr>\n-* <abbr title=\"less than ‚Äì –º–µ–Ω—å—à–µ —á–µ–º\"><code>lt</code></abbr>\n-* <abbr title=\"XML Web Token ‚Äì XML –≤–µ–±‚Äë—Ç–æ–∫–µ–Ω\">XWT</abbr>\n-* <abbr title=\"Parallel Server Gateway Interface ‚Äì –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —à–ª—é–∑–∞\">PSGI</abbr>\n+* <abbr title=\"Getting Things Done - –ö–∞–∫ –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–µ–ª–∞ –≤ –ø–æ—Ä—è–¥–æ–∫\">GTD</abbr>\n+* <abbr title=\"less than - –º–µ–Ω—å—à–µ —á–µ–º\"><code>lt</code></abbr>\n+* <abbr title=\"XML Web Token - XML –≤–µ–±‚Äë—Ç–æ–∫–µ–Ω\">XWT</abbr>\n+* <abbr title=\"Parallel Server Gateway Interface - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —à–ª—é–∑–∞\">PSGI</abbr>\n \n ### abbr –¥–∞—ë—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ { #the-abbr-gives-an-explanation }\n \n@@ -209,8 +209,8 @@ works(foo=\"bar\")  # –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç üéâ\n \n ### abbr –¥–∞—ë—Ç –ø–æ–ª–Ω—É—é —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ { #the-abbr-gives-a-full-phrase-and-an-explanation }\n \n-* <\n\n```\n\n```diff\n@@ -14,7 +14,7 @@\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial001_py39.py hl[6] *}\n \n-### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—É—Ç–∏ –∫–∞–∫ operationId { #using-the-path-operation-function-name-as-the-operationid }\n+### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ *—Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—É—Ç–∏* –∫–∞–∫ operationId { #using-the-path-operation-function-name-as-the-operationid }\n \n –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –≤–∞—à–∏—Ö API –≤ –∫–∞—á–µ—Å—Ç–≤–µ `operationId`, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –ø–æ –≤—Å–µ–º –∏–∑ –Ω–∏—Ö –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `operation_id` –∫–∞–∂–¥–æ–π *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏* —Å –ø–æ–º–æ—â—å—é –∏—Ö `APIRoute.name`.\n \n@@ -38,7 +38,7 @@\n \n ## –ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ OpenAPI { #exclude-from-openapi }\n \n-–ß—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å *–æ–ø–µ—Ä–∞—Ü–∏—é –ø—É—Ç–∏* –∏–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π —Å—Ö–µ–º—ã OpenAPI (–∞ –∑–Ω–∞—á–∏—Ç, –∏ –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `include_in_schema` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ `False`:\n+–ß—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å *–æ–ø–µ—Ä–∞—Ü–∏—é –ø—É—Ç–∏* –∏–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π —Å—Ö–µ–º—ã OpenAPI (–∞ –∑–Ω–∞—á–∏—Ç, –∏ –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `include_in_schema` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ `False`:\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial003_py39.py hl[6] *}\n \n@@ -48,15 +48,15 @@\n \n –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `\\f` (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ ¬´form feed¬ª) –∑–∞—Å—Ç–∞–≤–∏—Ç **FastAPI** –æ–±—Ä–µ–∑–∞—Ç—å —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è OpenAPI, –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.\n \n-–≠—Ç–∞ —á–∞—Å—Ç—å –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –Ω–æ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Sphinx) —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–µ.\n+–≠—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –Ω–æ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Sphinx) —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–µ.\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial004_py310.py hl[17:27] *}\n \n ## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã { #additional-responses }\n \n –í—ã, –≤–µ—Ä–æ—è—Ç–Ω–æ, —É–∂–µ –≤–∏–¥–µ–ª–∏, –∫–∞–∫ –æ–±—ä—è–≤–ª—è—Ç—å `response_model` –∏ `status_code` –¥–ª—è *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*.\n \n-–≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–± –æ—Å–Ω–æ–≤–Ω–æ–º –æ—Ç–≤–µ—Ç–µ *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*.\n+–≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–± –æ—Å–Ω–æ–≤–Ω–æ–º HTTP-–æ—Ç–≤–µ—Ç–µ *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*.\n \n –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ–±—ä—è–≤–ª—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –∏—Ö –º–æ–¥–µ–ª—è–º–∏, —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–∞–º–∏ –∏ —Ç.–¥.\n \n@@ -76,7 +76,7 @@\n \n –¢–∞–º –µ—Å—Ç—å `tags`, `paramete", "output": "Code Review for: üåê Update translations for ru (update-outdated)\n\nüìù **docs/ru/docs/advanced/path-operation-advanced-configuration.md**: ```suggestion\r\n–î–æ–±–∞–≤–ª–µ–Ω–∏–µ `\\f` (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ ¬´form feed¬ª) –∑–∞—Å—Ç–∞–≤–∏—Ç **FastAPI** –æ–±—Ä–µ–∑–∞—Ç—å —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è OpenAPI, –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.\r\n```\n\nüìù **docs/ru/docs/advanced/path-operation-advanced-configuration.md**: ```suggestion\r\n–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å —á–∏—Ç–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º –∫–æ–¥–æ–º, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ FastAPI –∏ Pydantic, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–ø–∏—Å–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å –≤ —Å—Ö–µ–º–µ OpenAPI.\r\n```\n\nüìù **docs/ru/docs/advanced/path-operation-advanced-configuration.md**: ```suggestion\r\n–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –Ω–µ –æ–±—ä—è–≤–ª—è–ª–∏ –Ω–∏–∫–∞–∫—É—é Pydantic-–º–æ–¥–µ–ª—å. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–∞–∂–µ –Ω–µ <abbr title=\"–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –∏–∑ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä –±–∞–π—Ç–æ–≤, –≤ –æ–±—ä–µ–∫—Ç—ã Python\">—Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ</abbr> –∫–∞–∫ JSON, –æ–Ω–æ —á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∫ `bytes`, –∞ —Ñ—É–Ω–∫—Ü–∏—è `magic_data_reader()` –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥ –∫–∞–∫–∏–º-—Ç–æ —Å–ø–æ—Å–æ–±–æ–º.\r\n```\n\nüìù **docs/ru/docs/how-to/separate-openapi-schemas.md**: ```suggestion\r\n–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ **Pydantic v2** —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OpenAPI —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á—É—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º –∏ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º**, —á–µ–º —Ä–∞–Ω—å—à–µ. üòé\r\n```\n\nüìù **docs/ru/docs/how-to/separate-openapi-schemas.md**: ```suggestion\r\n–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –≤ OpenAPI –±—É–¥–µ—Ç –¥–∞–∂–µ **–¥–≤–µ JSON-—Å—Ö–µ–º—ã** –¥–ª—è –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ Pydantic‚Äë–º–æ–¥–µ–ª–∏: –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –¥–ª—è –≤—ã—Ö–æ–¥–∞ ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è **–∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**.\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/advanced/path-operation-advanced-configuration.md`", "input": "```diff\n@@ -38,25 +38,25 @@\n \n ## –ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ OpenAPI { #exclude-from-openapi }\n \n-–ß—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å *–æ–ø–µ—Ä–∞—Ü–∏—é –ø—É—Ç–∏* –∏–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π —Å—Ö–µ–º—ã OpenAPI (–∞ –∑–Ω–∞—á–∏—Ç, –∏ –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `include_in_schema` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ `False`:\n+–ß—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å *–æ–ø–µ—Ä–∞—Ü–∏—é –ø—É—Ç–∏* –∏–∑ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π —Å—Ö–µ–º—ã OpenAPI (–∞ –∑–Ω–∞—á–∏—Ç, –∏ –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `include_in_schema` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ `False`:\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial003_py39.py hl[6] *}\n \n ## –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ docstring { #advanced-description-from-docstring }\n \n –í—ã –º–æ–∂–µ—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∏–∑ docstring *—Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—É—Ç–∏*, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è OpenAPI.\n \n-–î–æ–±–∞–≤–ª–µ–Ω–∏–µ `\\f` (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ ¬´form feed¬ª) –∑–∞—Å—Ç–∞–≤–∏—Ç **FastAPI** –æ–±—Ä–µ–∑–∞—Ç—å —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è OpenAPI, –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.\n+–î–æ–±–∞–≤–ª–µ–Ω–∏–µ `\\f` (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ ¬´form feed¬ª) –∑–∞—Å—Ç–∞–≤–∏—Ç **FastAPI** –æ–±—Ä–µ–∑–∞—Ç—å –≤—ã–≤–æ–¥, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è OpenAPI, –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.\n\n```", "output": "```suggestion\r\n–î–æ–±–∞–≤–ª–µ–Ω–∏–µ `\\f` (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ ¬´form feed¬ª) –∑–∞—Å—Ç–∞–≤–∏—Ç **FastAPI** –æ–±—Ä–µ–∑–∞—Ç—å —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è OpenAPI, –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/advanced/path-operation-advanced-configuration.md`", "input": "```diff\n@@ -129,72 +129,40 @@\n }\n ```\n \n-### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ö–µ–º–∞ OpenAPI –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏ { #custom-openapi-path-operation-schema }\n+### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ö–µ–º–∞ OpenAPI –¥–ª—è *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏* { #custom-openapi-path-operation-schema }\n \n-–°–ª–æ–≤–∞—Ä—å –≤ `openapi_extra` –±—É–¥–µ—Ç –æ–±—ä–µ–¥–∏–Ω—ë–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π OpenAPI –¥–ª—è *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*.\n+–°–ª–æ–≤–∞—Ä—å –≤ `openapi_extra` –±—É–¥–µ—Ç –≥–ª—É–±–æ–∫–æ –æ–±—ä–µ–¥–∏–Ω—ë–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–æ–π OpenAPI –¥–ª—è *–æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏*.\n \n –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ.\n \n-–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å —á–∏—Ç–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º –∫–æ–¥–æ–º, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ FastAPI –∏ Pydantic, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤ —Å—Ö–µ–º–µ OpenAPI.\n+–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å —á–∏—Ç–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º –∫–æ–¥–æ–º, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ FastAPI —Å Pydantic, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–ø–∏—Å–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å –≤ —Å—Ö–µ–º–µ OpenAPI.\n\n```", "output": "```suggestion\r\n–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ —Ä–µ—à–∏—Ç—å —á–∏—Ç–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å —Å–≤–æ–∏–º –∫–æ–¥–æ–º, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ FastAPI –∏ Pydantic, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∑–∞—Ö–æ—Ç–∏—Ç–µ –æ–ø–∏—Å–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å –≤ —Å—Ö–µ–º–µ OpenAPI.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/how-to/separate-openapi-schemas.md`", "input": "```diff\n@@ -1,8 +1,8 @@\n # –†–∞–∑–¥–µ–ª—è—Ç—å —Å—Ö–µ–º—ã OpenAPI –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞ –∏–ª–∏ –Ω–µ—Ç { #separate-openapi-schemas-for-input-and-output-or-not }\n \n-–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ **Pydantic v2** —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OpenAPI —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á—É—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º –∏ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º**, —á–µ–º —Ä–∞–Ω—å—à–µ. üòé\n+–° –º–æ–º–µ–Ω—Ç–∞ –≤—ã—Ö–æ–¥–∞ **Pydantic v2** —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OpenAPI —Å—Ç–∞–ª —á—É—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º –∏ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º**, —á–µ–º —Ä–∞–Ω—å—à–µ. üòé\n\n```", "output": "```suggestion\r\n–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ **Pydantic v2** —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π OpenAPI —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á—É—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º –∏ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º**, —á–µ–º —Ä–∞–Ω—å—à–µ. üòé\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/how-to/separate-openapi-schemas.md`", "input": "```diff\n@@ -79,11 +79,11 @@\n \n ## –ù–µ —Ä–∞–∑–¥–µ–ª—è—Ç—å —Å—Ö–µ–º—ã { #do-not-separate-schemas }\n \n-–û–¥–Ω–∞–∫–æ –±—ã–≤–∞—é—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å **–æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ö–µ–º—É –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞**.\n+–¢–µ–ø–µ—Ä—å –±—ã–≤–∞—é—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å **–æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ö–µ–º—É –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞**.\n\n```", "output": "```suggestion\r\n–û–¥–Ω–∞–∫–æ –±—ã–≤–∞—é—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–º–µ—Ç—å **–æ–¥–Ω—É –∏ —Ç—É –∂–µ —Å—Ö–µ–º—É –¥–ª—è –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞**.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/index.md`", "input": "```diff\n@@ -5,10 +5,10 @@\n </style>\n \n <p align=\"center\">\n-  <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n+  <a href=\"https://fastapi.tiangolo.com/ru\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç –≤ –∏–∑—É—á–µ–Ω–∏–∏, –±—ã—Å—Ç—Ä—ã–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω</em>\n+    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç –≤ –∏–∑—É—á–µ–Ω–∏–∏, –±—ã—Å—Ç—Ä–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥, –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω</em>\n\n```", "output": "```suggestion\r\n    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç –≤ –∏–∑—É—á–µ–Ω–∏–∏, –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥, –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω</em>\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/index.md`", "input": "```diff\n@@ -40,7 +40,7 @@ FastAPI ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π (–≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏\n * **–°–∫–æ—Ä–æ—Å—Ç—å**: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –Ω–∞ —É—Ä–æ–≤–Ω–µ **NodeJS** –∏ **Go** (–±–ª–∞–≥–æ–¥–∞—Ä—è Starlette –∏ Pydantic). [–û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ Python](#performance).\n * **–ë—ã—Å—Ç—Ä–æ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: –£–≤–µ–ª–∏—á—å—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∏—á –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 200‚Äì300%. *\n * **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫**: –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 40% –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫, –≤—ã–∑–≤–∞–Ω–Ω—ã—Ö —á–µ–ª–æ–≤–µ–∫–æ–º (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º). *\n-* **–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ—Å—Ç—å**: –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞. <abbr title=\"—Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∫–∞–∫: –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, IntelliSense\">–ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ</abbr> –≤–µ–∑–¥–µ. –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–ª–∞–¥–∫—É.\n+* **–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ—Å—Ç—å**: –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense - —Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∫–∞–∫: –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, –∞–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, IntelliSense\">–ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ</abbr> –≤–µ–∑–¥–µ. –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–ª–∞–¥–∫—É.\n\n```", "output": "```suggestion\r\n* **–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ—Å—Ç—å**: –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞. <abbr title=\"—Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∫–∞–∫: –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, –∞–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ, IntelliSense\">–ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ</abbr> –≤–µ–∑–¥–µ. –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç–ª–∞–¥–∫—É.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/index.md`", "input": "```diff\n@@ -433,13 +439,13 @@ item: Item\n \n ![editor support](https://fastapi.tiangolo.com/img/vscode-completion.png)\n \n-–ë–æ–ª–µ–µ –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Å–º. –≤ <a href=\"https://fastapi.tiangolo.com/ru/tutorial/\">–£—á–µ–±–Ω–∏–∫ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>.\n+–ë–æ–ª–µ–µ –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Å–º. –≤ <a href=\"https://fastapi.tiangolo.com/ru/tutorial/\">–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>.\n\n```", "output": "```suggestion\r\n–ë–æ–ª–µ–µ –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Å–º. –≤ <a href=\"https://fastapi.tiangolo.com/ru/tutorial/\">–£—á–µ–±–Ω–∏–∫ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/index.md`", "input": "```diff\n@@ -490,7 +496,7 @@ Deploying to FastAPI Cloud...\n \n **<a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>** —Å–æ–∑–¥–∞–Ω —Ç–µ–º –∂–µ –∞–≤—Ç–æ—Ä–æ–º –∏ –∫–æ–º–∞–Ω–¥–æ–π, —á—Ç–æ –∏ **FastAPI**.\n \n-–û–Ω —É–ø—Ä–æ—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å **—Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞**, **—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** –∏ **–¥–æ—Å—Ç—É–ø–∞** –∫ API –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏—è—Ö.\n+–û–Ω —É–ø—Ä–æ—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å **—Å–æ–∑–¥–∞–Ω–∏—è**, **—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** –∏ **–¥–æ—Å—Ç—É–ø–∞** –∫ API –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏—è—Ö.\n\n```", "output": "```suggestion\r\n–û–Ω —É–ø—Ä–æ—â–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å **—Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞**, **—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** –∏ **–¥–æ—Å—Ç—É–ø–∞** –∫ API –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —É—Å–∏–ª–∏—è—Ö.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/index.md`", "input": "```diff\n@@ -524,11 +530,11 @@ FastAPI –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Pydantic –∏ Starlette.\n \n * <a href=\"https://www.python-httpx.org\" target=\"_blank\"><code>httpx</code></a> ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TestClient`.\n * <a href=\"https://jinja.palletsprojects.com\" target=\"_blank\"><code>jinja2</code></a> ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.\n-* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å <abbr title=\"–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏, –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∏–∑ HTTP-–∑–∞–ø—Ä–æ—Å–∞, –≤ –¥–∞–Ω–Ω—ã–µ Python\">¬´–ø–∞—Ä—Å–∏–Ω–≥¬ª</abbr> —Ñ–æ—Ä–º —á–µ—Ä–µ–∑ `request.form()`.\n+* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> ‚Äî –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å <abbr title=\"converting the string that comes from an HTTP request into Python data - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏, –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∏–∑ HTTP-–∑–∞–ø—Ä–æ—Å–∞, –≤ –¥–∞–Ω–Ω—ã–µ Python\">¬´–ø–∞—Ä—Å–∏–Ω–≥¬ª</abbr> —Ñ–æ—Ä–º —á–µ—Ä–µ–∑ `request.form()`.\n\n```", "output": "```suggestion\r\n* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å <abbr title=\"–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏, –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∏–∑ HTTP-–∑–∞–ø—Ä–æ—Å–∞, –≤ –¥–∞–Ω–Ω—ã–µ Python\">¬´–ø–∞—Ä—Å–∏–Ω–≥¬ª</abbr> —Ñ–æ—Ä–º —á–µ—Ä–µ–∑ `request.form()`.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/tutorial/body-updates.md`", "input": "```diff\n@@ -84,9 +70,9 @@\n \n * (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PATCH` –≤–º–µ—Å—Ç–æ `PUT`.\n * –ò–∑–≤–ª–µ—á—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.\n-* –ü–æ–º–µ—Å—Ç–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ Pydantic –º–æ–¥–µ–ª—å.\n+* –ü–æ–º–µ—Å—Ç–∏—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ Pydantic-–º–æ–¥–µ–ª—å.\n * –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `dict` –±–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –≤—Ö–æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `exclude_unset`).\n-    * –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≤ –º–æ–¥–µ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.\n+    * –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ, –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏.\n\n```", "output": "```suggestion\r\n    * –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –≤–∞—à–µ–π –º–æ–¥–µ–ª–∏.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/tutorial/body.md`", "input": "```diff\n@@ -153,20 +147,20 @@ JSON Schema –≤–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π –±—É–¥–µ—Ç —á–∞—Å—Ç—å—é —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ\n \n –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:\n \n-* –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∞–∫–∂–µ –æ–±—ä—è–≤–ª–µ–Ω –≤ **–ø—É—Ç–∏**, –æ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—É—Ç–∏.\n+* –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∞–∫–∂–µ –æ–±—ä—è–≤–ª–µ–Ω –≤ **–ø—É—Ç–∏**, –æ–Ω –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ path-–ø–∞—Ä–∞–º–µ—Ç—Ä.\n * –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–º–µ–µ—Ç **—Å–∫–∞–ª—è—Ä–Ω—ã–π —Ç–∏–ø** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `int`, `float`, `str`, `bool` –∏ —Ç. –ø.), –æ–Ω –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä **–∑–∞–ø—Ä–æ—Å–∞**.\n * –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω –∫–∞–∫ —Ç–∏–ø **–º–æ–¥–µ–ª–∏ Pydantic**, –æ–Ω –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ **—Ç–µ–ª–æ** –∑–∞–ø—Ä–æ—Å–∞.\n \n /// note | –ó–∞–º–µ—Ç–∫–∞\n \n FastAPI –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ `q` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∏–∑-–∑–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `= None`.\n \n-–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ `str | None` (Python 3.10+) –∏–ª–∏ `Union[str, None]` (Python 3.9+) –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è FastAPI –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏; –æ–Ω —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `= None`.\n+–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ `str | None` (Python 3.10+) –∏–ª–∏ `Union` –≤ `Union[str, None]` (Python 3.9+) –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è FastAPI –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏; –æ–Ω —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `= None`.\n \n –ù–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤ –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞—à–µ–º—É —Ä–µ–¥–∞–∫—Ç–æ—Ä—É –∫–æ–¥–∞ –ª—É—á—à–µ –≤–∞—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏.\n \n ///\n \n ## –ë–µ–∑ Pydantic { #without-pydantic }\n \n-–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ Pydantic, –≤—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã **Body**. –°–º. —Ä–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ [–¢–µ–ª–æ ‚Äî –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: –ï–¥–∏–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–µ–ª–µ](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\n+–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ Pydantic, –≤—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã **Body**. –°–º. —Ä–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ [Body - Multiple Parameters: Singular values in body](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\n\n```", "output": "```suggestion\r\n–ï—Å–ª–∏ –≤—ã –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ Pydantic, –≤—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã **Body**. –°–º. —Ä–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ [–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ - –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: –ï–¥–∏–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–µ–ª–µ](body-multiple-params.md#singular-values-in-body){.internal-link target=_blank}.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/tutorial/extra-models.md`", "input": "```diff\n@@ -160,21 +152,21 @@ UserInDB(\n \n –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –∏ —Ç.–ø. –±—É–¥—É—Ç –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.\n \n-–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ (—Å `password` –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ, —Å `hashed_password` –∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è):\n+–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ (—Å –ø–∞—Ä–æ–ª–µ–º –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ `password`, —Å `hashed_password` –∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è):\n\n```", "output": "```suggestion\r\n–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –º—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ (—Å `password` –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ, —Å `hashed_password` –∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è):\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -31,7 +31,7 @@ FastAPI –ø–æ–π–º—ë—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ `q` –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, \n \n /// info | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n \n-–ü–æ–¥–¥–µ—Ä–∂–∫–∞ `Annotated` (–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ) –ø–æ—è–≤–∏–ª–∞—Å—å –≤ FastAPI –≤–µ—Ä—Å–∏–∏ 0.95.0.\n+–ü–æ–¥–¥–µ—Ä–∂–∫–∞ `Annotated` (–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ) –ø–æ—è–≤–∏–ª–∞—Å—å –≤ FastAPI –≤–µ—Ä—Å–∏–∏ <abbr title=\"before 2023-03\">0.95.0</abbr>.\n\n```", "output": "```suggestion\r\n–ü–æ–¥–¥–µ—Ä–∂–∫–∞ `Annotated` (–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ) –ø–æ—è–≤–∏–ª–∞—Å—å –≤ FastAPI –≤–µ—Ä—Å–∏–∏ 0.95.0.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -109,7 +109,7 @@ q: Annotated[Union[str, None]] = None\n \n ## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (—É—Å—Ç–∞—Ä–µ–≤—à–µ–µ): `Query` –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é { #alternative-old-query-as-the-default-value }\n \n-–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö FastAPI (–¥–æ <abbr title=\"–¥–æ 2023-03\">0.95.0</abbr>) —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Query` –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤–º–µ—Å—Ç–æ –ø–æ–º–µ—â–µ–Ω–∏—è –µ–≥–æ –≤ `Annotated`. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤—ã –µ—â—ë –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ —Ç–∞–∫–æ–π –∫–æ–¥, –ø–æ—ç—Ç–æ–º—É –ø–æ—è—Å–Ω—é.\n+–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö FastAPI (–¥–æ <abbr title=\"before 2023-03\">0.95.0</abbr>) —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Query` –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤–º–µ—Å—Ç–æ –ø–æ–º–µ—â–µ–Ω–∏—è –µ–≥–æ –≤ `Annotated`. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤—ã –µ—â—ë –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ —Ç–∞–∫–æ–π –∫–æ–¥, –ø–æ—ç—Ç–æ–º—É –ø–æ—è—Å–Ω—é.\n\n```", "output": "```suggestion\r\n–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö FastAPI (–¥–æ <abbr title=\"–¥–æ 2023-03\">0.95.0</abbr>) —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Query` –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤–º–µ—Å—Ç–æ –ø–æ–º–µ—â–µ–Ω–∏—è –µ–≥–æ –≤ `Annotated`. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤—ã –µ—â—ë –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ —Ç–∞–∫–æ–π –∫–æ–¥, –ø–æ—ç—Ç–æ–º—É –ø–æ—è—Å–Ω—é.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review this code change in `docs/ru/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -191,7 +191,7 @@ q: str = Query(default=\"rick\")\n \n ## –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è { #add-regular-expressions }\n \n-–í—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å <abbr title=\"–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (regex, regexp) ‚Äî —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–¥–∞—é—â–∞—è —à–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å—Ç—Ä–æ–∫.\">—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</abbr> `pattern`, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä:\n+–í—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å <abbr title=\"A regular expression, regex or regexp is a sequence of characters that define a search pattern for strings.\">—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</abbr> `pattern`, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä:\n\n```", "output": "```suggestion\r\n–í—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å <abbr title=\"–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (regex, regexp) - —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–¥–∞—é—â–∞—è —à–∞–±–ª–æ–Ω –ø–æ–∏—Å–∫–∞ –¥–ª—è —Å—Ç—Ä–æ–∫.\">—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</abbr> `pattern`, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä:\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 401}
{"instruction": "Review the following code changes: üåê Update Korean LLM prompt", "input": "```diff\n@@ -8,6 +8,7 @@ Language code: ko.\n \n - Use polite, instructional Korean (e.g. Ìï©ÎãàÎã§/ÌïòÏÑ∏Ïöî style).\n - Keep the tone consistent with the existing Korean FastAPI docs.\n+- Do not translate ‚ÄúYou‚Äù literally as ‚ÄúÎãπÏã†‚Äù. Use ‚ÄúÏó¨Îü¨Î∂Ñ‚Äù where appropriate, or omit the subject if it sounds more natural in Korean.\n \n ### Headings\n \n\n```", "output": "Changes look good. This PR implements: üåê Update Korean LLM prompt", "source": "pr", "type": "code_review", "pr_number": 400}
{"instruction": "Fix the following bug: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool", "input": "**Note:** target branch is temporarily set to `check-translation-script` (branch of PR https://github.com/fastapi/fastapi/pull/14652) as this PR is based on those changes.", "output": "```diff\n@@ -0,0 +1,729 @@\n+import re\n+from typing import TypedDict\n+\n+CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n+CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n+\n+HEADER_WITH_PERMALINK_RE = re.compile(r\"^(#{1,6}) (.+?)(\\s*\\{\\s*#.*\\s*\\})?\\s*$\")\n+HEADER_LINE_RE = re.compile(r\"^(#{1,6}) (.+?)(?:\\s*\\{\\s*(#.*)\\s*\\})?\\s*$\")\n+\n+TIANGOLO_COM = \"https://fastapi.tiangolo.com\"\n+ASSETS_URL_PREFIXES = (\"/img/\", \"/css/\", \"/js/\")\n+\n+MARKDOWN_LINK_RE = re.compile(\n+    r\"(?<!\\\\)(?<!\\!)\"  # not an image ![...] and not escaped \\[...]\n+    r\"\\[(?P<text>.*?)\\]\"  # link text (non-greedy)\n+    r\"\\(\"\n+    r\"(?P<url>[^)\\s]+)\"  # url (no spaces and `)`)\n+    r'(?:\\s+[\"\\'](?P<title>.*?)[\"\\'])?'  # optional title in \"\" or ''\n+    r\"\\)\"\n+    r\"(?:\\s*\\{(?P<attrs>[^}]*)\\})?\"  # optional attributes in {}\n+)\n+\n+HTML_LINK_RE = re.compile(r\"<a\\s+[^>]*>.*?</a>\")\n+HTML_LINK_TEXT_RE = re.compile(r\"<a\\b([^>]*)>(.*?)</a>\")\n+HTML_LINK_OPEN_TAG_RE = re.compile(r\"<a\\b([^>]*)>\")\n+HTML_ATTR_RE = re.compile(r'(\\w+)\\s*=\\s*([\\'\"])(.*?)\\2')\n+\n+CODE_BLOCK_LANG_RE = re.compile(r\"^`{3,4}([\\w-]*)\", re.MULTILINE)\n+\n+SLASHES_COMMENT_RE = re.compile(\n+    r\"^(?P<code>.*?)(?P<comment>(?:(?<= )// .*)|(?:^// .*))?$\"\n+)\n+\n+HASH_COMMENT_RE = re.compile(r\"^(?P<code>.*?)(?P<comment>(?:(?<= )# .*)|(?:^# .*))?$\")\n+\n+\n+class CodeIncludeInfo(TypedDict):\n+    line_no: int\n+    line: str\n+\n+\n+class HeaderPermalinkInfo(TypedDict):\n+    line_no: int\n+    hashes: str\n+    title: str\n+    permalink: str\n+\n+\n+class MarkdownLinkInfo(TypedDict):\n+    line_no: int\n+    url: str\n+    text: str\n+    title: str | None\n+    attributes: str | None\n+    full_match: str\n+\n+\n+class HTMLLinkAttribute(TypedDict):\n+    name: str\n+    quote: str\n+    value: str\n+\n+\n+class HtmlLinkInfo(TypedDict):\n+    line_no: int\n+    full_tag: str\n+    attributes: list[HTMLLinkAttribute]\n+    text: str\n+\n+\n+class MultilineCodeBlockInfo(TypedDict):\n+    lang: str\n+    start_line_no: int\n+    content: list[str]\n+\n+\n+# Code includes\n+# -----------------------------------------------------------------------------------------\n+\n+\n+def extract_code_includes(lines: list[str]) -> list[CodeIncludeInfo]:\n+    \"\"\"\n+    Exctract lines that contain code includes.\n+\n+    Return list of CodeIncludeInfo namedtuples, where each tuple contains:\n+    - `line_no` - line number (1-based)\n+    - `line` - text of the line\n+    \"\"\"\n+\n+    includes: list[CodeIncludeInfo] = []\n+    for line_no, line in enumerate(lines, start=1):\n+        if CODE_INCLUDE_RE.match(line):\n+            includes.append(CodeIncludeInfo(line_no=line_no, line=line))\n+    return includes\n+\n+\n+def replace_code_includes_with_placeholders(text: list[str]) -> list[str]:\n+    \"\"\"\n+    Replace code includes with placeholders.\n+    \"\"\"\n+\n+    modified_text = text.copy()\n+    includes = extract_code_includes(text)\n+    for include in includes:\n+        modified_text[include[\"line_no\"] - 1] = CODE_INCLUDE_PLACEHOLDER\n+    return modified_text\n+\n+\n+def replace_placeholders_with_code_includes(\n+    text\n\n```\n\n```diff\n@@ -0,0 +1,32 @@\n+import shutil\n+from pathlib import Path\n+\n+import pytest\n+from typer.testing import CliRunner\n+\n+\n+@pytest.fixture(name=\"runner\")\n+def get_runner():\n+    runner = CliRunner()\n+    with runner.isolated_filesystem():\n+        yield runner\n+\n+\n+@pytest.fixture(name=\"root_dir\")\n+def prepare_paths(runner):\n+    docs_dir = Path(\"docs\")\n+    en_docs_dir = docs_dir / \"en\" / \"docs\"\n+    lang_docs_dir = docs_dir / \"lang\" / \"docs\"\n+    en_docs_dir.mkdir(parents=True, exist_ok=True)\n+    lang_docs_dir.mkdir(parents=True, exist_ok=True)\n+    yield Path.cwd()\n+\n+\n+@pytest.fixture\n+def copy_test_files(root_dir: Path, request: pytest.FixtureRequest):\n+    en_file_path = Path(request.param[0])\n+    translation_file_path = Path(request.param[1])\n+    shutil.copy(str(en_file_path), str(root_dir / \"docs\" / \"en\" / \"docs\" / \"doc.md\"))\n+    shutil.copy(\n+        str(translation_file_path), str(root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\")\n+    )\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 399}
{"instruction": "Review the following code changes: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool", "input": "```diff\n@@ -0,0 +1,729 @@\n+import re\n+from typing import TypedDict\n+\n+CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n+CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n+\n+HEADER_WITH_PERMALINK_RE = re.compile(r\"^(#{1,6}) (.+?)(\\s*\\{\\s*#.*\\s*\\})?\\s*$\")\n+HEADER_LINE_RE = re.compile(r\"^(#{1,6}) (.+?)(?:\\s*\\{\\s*(#.*)\\s*\\})?\\s*$\")\n+\n+TIANGOLO_COM = \"https://fastapi.tiangolo.com\"\n+ASSETS_URL_PREFIXES = (\"/img/\", \"/css/\", \"/js/\")\n+\n+MARKDOWN_LINK_RE = re.compile(\n+    r\"(?<!\\\\)(?<!\\!)\"  # not an image ![...] and not escaped \\[...]\n+    r\"\\[(?P<text>.*?)\\]\"  # link text (non-greedy)\n+    r\"\\(\"\n+    r\"(?P<url>[^)\\s]+)\"  # url (no spaces and `)`)\n+    r'(?:\\s+[\"\\'](?P<title>.*?)[\"\\'])?'  # optional title in \"\" or ''\n+    r\"\\)\"\n+    r\"(?:\\s*\\{(?P<attrs>[^}]*)\\})?\"  # optional attributes in {}\n+)\n+\n+HTML_LINK_RE = re.compile(r\"<a\\s+[^>]*>.*?</a>\")\n+HTML_LINK_TEXT_RE = re.compile(r\"<a\\b([^>]*)>(.*?)</a>\")\n+HTML_LINK_OPEN_TAG_RE = re.compile(r\"<a\\b([^>]*)>\")\n+HTML_ATTR_RE = re.compile(r'(\\w+)\\s*=\\s*([\\'\"])(.*?)\\2')\n+\n+CODE_BLOCK_LANG_RE = re.compile(r\"^`{3,4}([\\w-]*)\", re.MULTILINE)\n+\n+SLASHES_COMMENT_RE = re.compile(\n+    r\"^(?P<code>.*?)(?P<comment>(?:(?<= )// .*)|(?:^// .*))?$\"\n+)\n+\n+HASH_COMMENT_RE = re.compile(r\"^(?P<code>.*?)(?P<comment>(?:(?<= )# .*)|(?:^# .*))?$\")\n+\n+\n+class CodeIncludeInfo(TypedDict):\n+    line_no: int\n+    line: str\n+\n+\n+class HeaderPermalinkInfo(TypedDict):\n+    line_no: int\n+    hashes: str\n+    title: str\n+    permalink: str\n+\n+\n+class MarkdownLinkInfo(TypedDict):\n+    line_no: int\n+    url: str\n+    text: str\n+    title: str | None\n+    attributes: str | None\n+    full_match: str\n+\n+\n+class HTMLLinkAttribute(TypedDict):\n+    name: str\n+    quote: str\n+    value: str\n+\n+\n+class HtmlLinkInfo(TypedDict):\n+    line_no: int\n+    full_tag: str\n+    attributes: list[HTMLLinkAttribute]\n+    text: str\n+\n+\n+class MultilineCodeBlockInfo(TypedDict):\n+    lang: str\n+    start_line_no: int\n+    content: list[str]\n+\n+\n+# Code includes\n+# -----------------------------------------------------------------------------------------\n+\n+\n+def extract_code_includes(lines: list[str]) -> list[CodeIncludeInfo]:\n+    \"\"\"\n+    Exctract lines that contain code includes.\n+\n+    Return list of CodeIncludeInfo namedtuples, where each tuple contains:\n+    - `line_no` - line number (1-based)\n+    - `line` - text of the line\n+    \"\"\"\n+\n+    includes: list[CodeIncludeInfo] = []\n+    for line_no, line in enumerate(lines, start=1):\n+        if CODE_INCLUDE_RE.match(line):\n+            includes.append(CodeIncludeInfo(line_no=line_no, line=line))\n+    return includes\n+\n+\n+def replace_code_includes_with_placeholders(text: list[str]) -> list[str]:\n+    \"\"\"\n+    Replace code includes with placeholders.\n+    \"\"\"\n+\n+    modified_text = text.copy()\n+    includes = extract_code_includes(text)\n+    for include in includes:\n+        modified_text[include[\"line_no\"] - 1] = CODE_INCLUDE_PLACEHOLDER\n+    return modified_text\n+\n+\n+def replace_placeholders_with_code_includes(\n+    text\n\n```\n\n```diff\n@@ -0,0 +1,32 @@\n+import shutil\n+from pathlib import Path\n+\n+import pytest\n+from typer.testing import CliRunner\n+\n+\n+@pytest.fixture(name=\"runner\")\n+def get_runner():\n+    runner = CliRunner()\n+    with runner.isolated_filesystem():\n+        yield runner\n+\n+\n+@pytest.fixture(name=\"root_dir\")\n+def prepare_paths(runner):\n+    docs_dir = Path(\"docs\")\n+    en_docs_dir = docs_dir / \"en\" / \"docs\"\n+    lang_docs_dir = docs_dir / \"lang\" / \"docs\"\n+    en_docs_dir.mkdir(parents=True, exist_ok=True)\n+    lang_docs_dir.mkdir(parents=True, exist_ok=True)\n+    yield Path.cwd()\n+\n+\n+@pytest.fixture\n+def copy_test_files(root_dir: Path, request: pytest.FixtureRequest):\n+    en_file_path = Path(request.param[0])\n+    translation_file_path = Path(request.param[1])\n+    shutil.copy(str(en_file_path), str(root_dir / \"docs\" / \"en\" / \"docs\" / \"doc.md\"))\n+    shutil.copy(\n+        str(translation_file_path), str(root_dir / \"docs\" / \"lang\" / \"docs\" / \"doc.md\")\n+    )\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```\n\n```diff\n@@ -0,0 +1,45 @@\n+# Code blocks { #code-blocks }\n+\n+Some text\n+\n+\n```", "output": "Changes look good. This PR implements: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool", "source": "pr", "type": "code_review", "pr_number": 399}
{"instruction": "Review the following code changes: docs: clarify \"Required, can be None\" query parameter wording", "input": "```diff\n@@ -246,9 +246,12 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n ### Required, can be `None` { #required-can-be-none }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n+You can declare that a parameter can accept `None`, but that it's still required.\n+This forces clients to send a value, even if the value represents `None`.\n \n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+To do that, you can declare that `None` is a valid type but simply do not declare a default value.\n+\n+Query parameters are always received as strings, so clients cannot send an actual `None` value directly. If needed, you must explicitly handle a string representation (for example, `\"null\"`) and convert it to `None` inside your application logic.\n \n {* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n \n\n```", "output": "Changes look good. This PR implements: docs: clarify \"Required, can be None\" query parameter wording", "source": "pr", "type": "code_review", "pr_number": 398}
{"instruction": "Review the following code changes: docs: clarify \"Required, can be None\" query parameter wording", "input": "```diff\n@@ -4,7 +4,7 @@\n \n Let's take this application as example:\n \n-{* ../../docs_src/query_params_str_validations/tutorial001_py310.py hl[7] *}\n+{_ ../../docs_src/query_params_str_validations/tutorial001_py310.py hl[7] _}\n \n The query parameter `q` is of type `str | None`, that means that it's of type `str` but could also be `None`, and indeed, the default value is `None`, so FastAPI will know it's not required.\n \n@@ -24,24 +24,24 @@ We are going to enforce that even though `q` is optional, whenever it is provide\n \n To achieve that, first import:\n \n-* `Query` from `fastapi`\n-* `Annotated` from `typing`\n+- `Query` from `fastapi`\n+- `Annotated` from `typing`\n \n-{* ../../docs_src/query_params_str_validations/tutorial002_an_py310.py hl[1,3] *}\n+{_ ../../docs_src/query_params_str_validations/tutorial002_an_py310.py hl[1,3] _}\n \n /// info\n \n FastAPI added support for `Annotated` (and started recommending it) in version 0.95.0.\n \n If you have an older version, you would get errors when trying to use `Annotated`.\n \n-Make sure you [Upgrade the FastAPI version](../deployment/versions.md#upgrading-the-fastapi-versions){.internal-link target=_blank} to at least 0.95.1 before using `Annotated`.\n+Make sure you [Upgrade the FastAPI version](../deployment/versions.md#upgrading-the-fastapi-versions){.internal-link target=\\_blank} to at least 0.95.1 before using `Annotated`.\n \n ///\n \n ## Use `Annotated` in the type for the `q` parameter { #use-annotated-in-the-type-for-the-q-parameter }\n \n-Remember I told you before that `Annotated` can be used to add metadata to your parameters in the [Python Types Intro](../python-types.md#type-hints-with-metadata-annotations){.internal-link target=_blank}?\n+Remember I told you before that `Annotated` can be used to add metadata to your parameters in the [Python Types Intro](../python-types.md#type-hints-with-metadata-annotations){.internal-link target=\\_blank}?\n \n Now it's the time to use it with FastAPI. üöÄ\n \n@@ -89,7 +89,7 @@ Now let's jump to the fun stuff. üéâ\n \n Now that we have this `Annotated` where we can put more information (in this case some additional validation), add `Query` inside of `Annotated`, and set the parameter `max_length` to `50`:\n \n-{* ../../docs_src/query_params_str_validations/tutorial002_an_py310.py hl[9] *}\n+{_ ../../docs_src/query_params_str_validations/tutorial002_an_py310.py hl[9] _}\n \n Notice that the default value is still `None`, so the parameter is still optional.\n \n@@ -103,9 +103,9 @@ Here we are using `Query()` because this is a **query parameter**. Later we will\n \n FastAPI will now:\n \n-* **Validate** the data making sure that the max length is 50 characters\n-* Show a **clear error** for the client when the data is not valid\n-* **Document** the parameter in the OpenAPI schema *path operation* (so it will show up in the **automatic docs UI**)\n+- **Validate** the data making sure that the max length is 50 characters\n+- Show a **clear error** for the client when the data is not valid\n+- **Document** th\n\n```", "output": "Changes look good. This PR implements: docs: clarify \"Required, can be None\" query parameter wording", "source": "pr", "type": "code_review", "pr_number": 397}
{"instruction": "Review the following code changes: üåê Update LLM prompt for Russian translations", "input": "```diff\n@@ -90,5 +90,12 @@ For the following technical terms, use these specific translations to ensure con\n * serve (meaning providing access to something): ¬´–æ—Ç–¥–∞–≤–∞—Ç—å¬ª (or `–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø –∫`)\n * recap (noun): —Ä–µ–∑—é–º–µ\n * utility function: –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è\n+* fast to code: –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥\n+* Tutorial - User Guide: –£—á–µ–±–Ω–∏–∫ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n+* submodule: –ø–æ–¥–º–æ–¥—É–ª—å\n+* subpackage: –ø–æ–¥–ø–∞–∫–µ—Ç\n+* router: —Ä–æ—É—Ç–µ—Ä\n+* building, deploying, accessing (when describing features of FastAPI Cloud): —Å–æ–∑–¥–∞–Ω–∏e –æ–±—Ä–∞–∑–∞, —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –¥–æ—Å—Ç—É–ø\n+* type checker tool: –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤\n \n Do not add whitespace in `—Ç.–¥.`, `—Ç.–ø.`.\n\n```", "output": "Changes look good. This PR implements: üåê Update LLM prompt for Russian translations", "source": "pr", "type": "code_review", "pr_number": 396}
{"instruction": "Review the following code changes: üåê Update translations for de (update-outdated)", "input": "```diff\n@@ -189,7 +189,7 @@ Siehe Abschnitt `### Links` im allgemeinen Prompt in `scripts/translate.py`.\n \n ////\n \n-## HTML ‚Äûabbr‚Äú-Elemente { #html-abbr-elements }\n+## HTML-‚Äûabbr‚Äú-Elemente { #html-abbr-elements }\n \n //// tab | Test\n \n\n```\n\n```diff\n@@ -56,19 +56,19 @@ from app.routers import items\n \n Die gleiche Dateistruktur mit Kommentaren:\n \n-\n```\n\n```diff\n@@ -56,19 +56,19 @@ from app.routers import items\n \n Die gleiche Dateistruktur mit Kommentaren:\n \n-\n```\n\n```diff\n@@ -56,19 +56,19 @@ from app.routers import items\n \n Die gleiche Dateistruktur mit Kommentaren:\n \n-\n```\n\n```diff\n@@ -479,7 +479,7 @@ $ fastapi dev app/main.py\n \n </div>\n \n-und √∂ffnen Sie die Dokumentation unter <a href=\"http://127.0.0.1:8000/docs\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8000/docs</a>.\n+Und √∂ffnen Sie die Dokumentation unter <a href=\"http://127.0.0.1:8000/docs\" class=\"external-link\" target=\"_blank\">http://127.0.0.1:8000/docs</a>.\n\n```", "output": "Code Review for: üåê Update translations for de (update-outdated)\n\nüìù **docs/de/docs/tutorial/bigger-applications.md**: Keep.\r\n\r\nThat was addedd by tiangolo in the english document.\n\nüìù **docs/de/docs/tutorial/bigger-applications.md**: Revert.\r\n\r\nThe LLM reverts the German translation, despite being told not to do that, see section _Content of code blocks_ at the top of `scripts/general-llm-prompt.md`:\r\n\r\n>Do not translate the content of code blocks, except for comments in the language which the code block uses.\r\n\r\nI am open to replace the literal quotes though, if that disturbs in code comments.\r\n\r\nIf this keeps happening we may add another example to `scripts/general-llm-prompt.md`.\n\nüìù **docs/de/docs/tutorial/bigger-applications.md**: Keep.\r\n\r\nGood catch.\n\nüìù **docs/de/docs/_llm-test.md**: Keep.\r\n\r\nIn sync with section _German instructions, when to use and when not to use hyphens in words_ in `docs\\de\\llm-prompt.md`.\n\nüìù **docs/de/docs/_llm-test.md**: Revert.\r\n\r\nSee\r\n\r\n> You can leave the original full phrase away, if the translated full phrase is identical or starts with the same letters as the original full phrase\r\n\r\nin `scripts\\general-llm-prompt.md`.\n\n", "source": "pr", "type": "code_review", "pr_number": 395}
{"instruction": "Review this code change in `docs/de/docs/tutorial/bigger-applications.md`", "input": "```diff\n@@ -56,19 +56,19 @@ from app.routers import items\n \n Die gleiche Dateistruktur mit Kommentaren:\n \n-```\n+```bash\n\n```", "output": "Keep.\r\n\r\nThat was addedd by tiangolo in the english document.", "source": "pr_review", "type": "inline_review", "pr_number": 395}
{"instruction": "Review this code change in `docs/de/docs/_llm-test.md`", "input": "```diff\n@@ -189,7 +189,7 @@ Siehe Abschnitt `### Links` im allgemeinen Prompt in `scripts/translate.py`.\n \n ////\n \n-## HTML ‚Äûabbr‚Äú-Elemente { #html-abbr-elements }\n+## HTML-‚Äûabbr‚Äú-Elemente { #html-abbr-elements }\n\n```", "output": "Keep.\r\n\r\nIn sync with section _German instructions, when to use and when not to use hyphens in words_ in `docs\\de\\llm-prompt.md`.", "source": "pr_review", "type": "inline_review", "pr_number": 395}
{"instruction": "Review this code change in `docs/de/docs/_llm-test.md`", "input": "```diff\n@@ -200,16 +200,16 @@ Hier einige Dinge, die in HTML-‚Äûabbr‚Äú-Elemente gepackt sind (einige sind erf\n * <abbr title=\"Getting Things Done ‚Äì Dinge erledigt bekommen\">GTD</abbr>\n * <abbr title=\"less than ‚Äì kleiner als\"><code>lt</code></abbr>\n * <abbr title=\"XML Web Token\">XWT</abbr>\n-* <abbr title=\"Paralleles Server-Gateway-Interface\">PSGI</abbr>\n+* <abbr title=\"Parallel Server Gateway Interface\">PSGI</abbr>\n\n```", "output": "Revert.\r\n\r\nSee\r\n\r\n> You can leave the original full phrase away, if the translated full phrase is identical or starts with the same letters as the original full phrase\r\n\r\nin `scripts\\general-llm-prompt.md`.", "source": "pr_review", "type": "inline_review", "pr_number": 395}
{"instruction": "Review this code change in `docs/de/docs/tutorial/bigger-applications.md`", "input": "```diff\n@@ -285,7 +285,7 @@ Aber wir k√∂nnen immer noch _mehr_ `tags` hinzuf√ºgen, die auf eine bestimmte *P\n \n Diese letzte Pfadoperation wird eine Kombination von Tags haben: `[\"items\", \"custom\"]`.\n \n-Und sie wird auch beide <abbr title=\"Response ‚Äì Antwort: Daten, die der Server zum anfragenden Client zur√ºcksendet\">Responses</abbr> in der Dokumentation haben, eine f√ºr `404` und eine f√ºr `403`.\n+Und sie wird auch beide Responses in der Dokumentation haben, eine f√ºr `404` und eine f√ºr `403`.\n\n```", "output": "Undecided.\r\n\r\nSee below.", "source": "pr_review", "type": "inline_review", "pr_number": 395}
{"instruction": "Review this code change in `docs/de/docs/tutorial/bigger-applications.md`", "input": "```diff\n@@ -165,7 +165,7 @@ Das Pr√§fix lautet in diesem Fall also `/items`.\n \n Wir k√∂nnen auch eine Liste von `tags` und zus√§tzliche `responses` hinzuf√ºgen, die auf alle in diesem Router enthaltenen *Pfadoperationen* angewendet werden.\n \n-Und wir k√∂nnen eine Liste von `dependencies` hinzuf√ºgen, die allen *Pfadoperationen* im Router hinzugef√ºgt und f√ºr jeden an sie gerichteten <abbr title=\"Request ‚Äì Anfrage: Daten, die der Client zum Server sendet\">Request</abbr> ausgef√ºhrt/aufgel√∂st werden.\n+Und wir k√∂nnen eine Liste von `dependencies` hinzuf√ºgen, die allen *Pfadoperationen* im Router hinzugef√ºgt und f√ºr jeden an sie gerichteten Request ausgef√ºhrt/aufgel√∂st werden.\n\n```", "output": "Undecided.\r\n\r\nI once added these `abbr`s to the German docs (here and in other translated documents, once per document), to explain the meaning of _Request_ and _Response_. The LLM keeps removing them, despite being told not to, see:\r\n\r\n> If there is an existing translation, and it has ADDITIONAL abbr elements in a sentence, and these additional abbr elements do not exist in the related sentence in the English text, then KEEP those additional abbr elements in the translation.\r\n\r\nin `scripts/general-llm-prompt.md`.\r\n\r\nI am fine with removing them everywhere or with keeping them everywhere. Any opinions?", "source": "pr_review", "type": "inline_review", "pr_number": 395}
{"instruction": "Fix the following bug: Security finding resolved with no functional impact", "input": "Fixes the Semgrep security issue **\"insecure-document-method-226\"** by replacing insecure document handling with a secure implementation, in line with recommended best practices.\r\n\r\n* Security finding resolved with no functional impact\r\n* Branch synced with `master` prior to merge", "output": "```diff\n@@ -222,13 +222,35 @@ class Termynal {\n      */\n     lineDataToElements(lineData) {\n         return lineData.map(line => {\n-            let div = document.createElement('div');\n-            div.innerHTML = `<span ${this._attributes(line)}>${line.value || ''}</span>`;\n+            let span = document.createElement('span');\n+            span.textContent = line.value || '';\n+            this._setAttributes(span, line);\n \n-            return div.firstElementChild;\n+            return span;\n         });\n     }\n \n+    /**\n+     * Helper function for safely setting attributes on element.\n+     *\n+     * @param {Element} element - The element to set attributes on.\n+     * @param {Object} line - Line data object.\n+     */\n+    _setAttributes(element, line) {\n+        for (let prop in line) {\n+            // Custom add class\n+            if (prop === 'class') {\n+                element.className = line[prop];\n+                continue;\n+            }\n+            if (prop === 'type') {\n+                element.setAttribute(this.pfx, line[prop]);\n+            } else if (prop !== 'value') {\n+                element.setAttribute(`${this.pfx}-${prop}`, line[prop]);\n+            }\n+        }\n+    }\n+\n     /**\n      * Helper function for generating attributes string.\n      *\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 394}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -222,13 +222,35 @@ class Termynal {\n      */\n     lineDataToElements(lineData) {\n         return lineData.map(line => {\n-            let div = document.createElement('div');\n-            div.innerHTML = `<span ${this._attributes(line)}>${line.value || ''}</span>`;\n+            let span = document.createElement('span');\n+            span.textContent = line.value || '';\n+            this._setAttributes(span, line);\n \n-            return div.firstElementChild;\n+            return span;\n         });\n     }\n \n+    /**\n+     * Helper function for safely setting attributes on element.\n+     *\n+     * @param {Element} element - The element to set attributes on.\n+     * @param {Object} line - Line data object.\n+     */\n+    _setAttributes(element, line) {\n+        for (let prop in line) {\n+            // Custom add class\n+            if (prop === 'class') {\n+                element.className = line[prop];\n+                continue;\n+            }\n+            if (prop === 'type') {\n+                element.setAttribute(this.pfx, line[prop]);\n+            } else if (prop !== 'value') {\n+                element.setAttribute(`${this.pfx}-${prop}`, line[prop]);\n+            }\n+        }\n+    }\n+\n     /**\n      * Helper function for generating attributes string.\n      *\n\n```", "output": "Bug: Security finding resolved with no functional impact\n\nFixes the Semgrep security issue **\"insecure-document-method-226\"** by replacing insecure document handling with a secure implementation, in line with recommended best practices.\r\n\r\n* Security finding resolved with no functional impact\r\n* Branch synced with `master` prior to merge", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 394}
{"instruction": "Review the following code changes: Security finding resolved with no functional impact", "input": "```diff\n@@ -222,13 +222,35 @@ class Termynal {\n      */\n     lineDataToElements(lineData) {\n         return lineData.map(line => {\n-            let div = document.createElement('div');\n-            div.innerHTML = `<span ${this._attributes(line)}>${line.value || ''}</span>`;\n+            let span = document.createElement('span');\n+            span.textContent = line.value || '';\n+            this._setAttributes(span, line);\n \n-            return div.firstElementChild;\n+            return span;\n         });\n     }\n \n+    /**\n+     * Helper function for safely setting attributes on element.\n+     *\n+     * @param {Element} element - The element to set attributes on.\n+     * @param {Object} line - Line data object.\n+     */\n+    _setAttributes(element, line) {\n+        for (let prop in line) {\n+            // Custom add class\n+            if (prop === 'class') {\n+                element.className = line[prop];\n+                continue;\n+            }\n+            if (prop === 'type') {\n+                element.setAttribute(this.pfx, line[prop]);\n+            } else if (prop !== 'value') {\n+                element.setAttribute(`${this.pfx}-${prop}`, line[prop]);\n+            }\n+        }\n+    }\n+\n     /**\n      * Helper function for generating attributes string.\n      *\n\n```", "output": "Changes look good. This PR implements: Security finding resolved with no functional impact", "source": "pr", "type": "code_review", "pr_number": 394}
{"instruction": "Review the following code changes: Use sorted() rather than list() for consistent operation_id naming", "input": "```diff\n@@ -124,7 +124,7 @@ def generate_unique_id(route: \"APIRoute\") -> str:\n     operation_id = f\"{route.name}{route.path_format}\"\n     operation_id = re.sub(r\"\\W\", \"_\", operation_id)\n     assert route.methods\n-    operation_id = f\"{operation_id}_{list(route.methods)[0].lower()}\"\n+    operation_id = f\"{operation_id}_{sorted(route.methods)[0].lower()}\"\n     return operation_id\n \n \n\n```", "output": "Changes look good. This PR implements: Use sorted() rather than list() for consistent operation_id naming", "source": "pr", "type": "code_review", "pr_number": 393}
{"instruction": "Review the following code changes: üîß Ensure that an edit to `uv.lock` gets the `internal` label", "input": "```diff\n@@ -31,6 +31,7 @@ internal:\n         - .pre-commit-config.yaml\n         - pdm_build.py\n         - requirements*.txt\n+        - uv.lock\n         - docs/en/data/sponsors.yml\n         - docs/en/overrides/main.html\n       - all-globs-to-all-files:\n\n```", "output": "Changes look good. This PR implements: üîß Ensure that an edit to `uv.lock` gets the `internal` label", "source": "pr", "type": "code_review", "pr_number": 392}
{"instruction": "Review the following code changes: Bump starlette version to `<0.52.0`", "input": "```diff\n@@ -43,7 +43,7 @@ classifiers = [\n     \"Topic :: Internet :: WWW/HTTP\",\n ]\n dependencies = [\n-    \"starlette>=0.40.0,<0.51.0\",\n+    \"starlette>=0.40.0,<0.52.0\",\n     \"pydantic>=2.7.0\",\n     \"typing-extensions>=4.8.0\",\n     \"annotated-doc>=0.0.2\",\n\n```\n\n```diff\n@@ -1186,7 +1186,7 @@ requires-dist = [\n     { name = \"python-multipart\", marker = \"extra == 'standard'\", specifier = \">=0.0.18\" },\n     { name = \"python-multipart\", marker = \"extra == 'standard-no-fastapi-cloud-cli'\", specifier = \">=0.0.18\" },\n     { name = \"pyyaml\", marker = \"extra == 'all'\", specifier = \">=5.3.1\" },\n-    { name = \"starlette\", specifier = \">=0.40.0,<0.51.0\" },\n+    { name = \"starlette\", specifier = \">=0.40.0,<0.52.0\" },\n     { name = \"typing-extensions\", specifier = \">=4.8.0\" },\n     { name = \"ujson\", marker = \"extra == 'all'\", specifier = \">=4.0.1,!=4.0.2,!=4.1.0,!=4.2.0,!=4.3.0,!=5.0.0,!=5.1.0\" },\n     { name = \"uvicorn\", extras = [\"standard\"], marker = \"extra == 'all'\", specifier = \">=0.12.0\" },\n\n```", "output": "Changes look good. This PR implements: Bump starlette version to `<0.52.0`", "source": "pr", "type": "code_review", "pr_number": 391}
{"instruction": "Review the following code changes: ‚ú® Allow including additional scripts to Swagger UI page and adding presets", "input": "```diff\n@@ -60,8 +60,7 @@ FastAPI also includes these JavaScript-only `presets` settings:\n \n \n```\n\n```diff\n@@ -54,6 +54,14 @@ def get_swagger_ui_html(\n             \"\"\"\n         ),\n     ] = \"https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js\",\n+    swagger_extra_js_urls: Annotated[\n+        Optional[list[str]],\n+        Doc(\n+            \"\"\"\n+            The URLs of additional JavaScript files to include.\n+            \"\"\"\n+        ),\n+    ] = None,\n     swagger_css_url: Annotated[\n         str,\n         Doc(\n@@ -98,6 +106,14 @@ def get_swagger_ui_html(\n             \"\"\"\n         ),\n     ] = None,\n+    swagger_extra_presets: Annotated[\n+        Optional[list[str]],\n+        Doc(\n+            \"\"\"\n+            Extra presets to add to Swagger UI.\n+            \"\"\"\n+        ),\n+    ] = None,\n ) -> HTMLResponse:\n     \"\"\"\n     Generate and return the HTML  that loads Swagger UI for the interactive\n@@ -114,6 +130,13 @@ def get_swagger_ui_html(\n     if swagger_ui_parameters:\n         current_swagger_ui_parameters.update(swagger_ui_parameters)\n \n+    js_urls = [swagger_js_url]\n+    if swagger_extra_js_urls:\n+        js_urls.extend(swagger_extra_js_urls)\n+    scripts_str = \"\\n    \".join(\n+        f'<script src=\"{js_url}\"></script>' for js_url in js_urls\n+    )\n+\n     html = f\"\"\"\n     <!DOCTYPE html>\n     <html>\n@@ -125,7 +148,7 @@ def get_swagger_ui_html(\n     <body>\n     <div id=\"swagger-ui\">\n     </div>\n-    <script src=\"{swagger_js_url}\"></script>\n+    {scripts_str}\n     <!-- `SwaggerUIBundle` is now available on the page -->\n     <script>\n     const ui = SwaggerUIBundle({{\n@@ -138,12 +161,18 @@ def get_swagger_ui_html(\n     if oauth2_redirect_url:\n         html += f\"oauth2RedirectUrl: window.location.origin + '{oauth2_redirect_url}',\"\n \n-    html += \"\"\"\n+    presets = [\"SwaggerUIBundle.presets.apis\"]\n+    if swagger_extra_presets:\n+        presets.extend(swagger_extra_presets)\n+    presets_str = \",\\n        \".join(presets)\n+\n+    html += f\"\"\"\n     presets: [\n-        SwaggerUIBundle.presets.apis,\n-        SwaggerUIBundle.SwaggerUIStandalonePreset\n+        {presets_str},\n         ],\n-    })\"\"\"\n+    \"\"\"\n+\n+    html += \"    })\"\n \n     if init_oauth:\n         html += f\"\"\"\n\n```\n\n```diff\n@@ -18,9 +18,6 @@ def test_swagger_ui():\n     assert \"SwaggerUIBundle.presets.apis,\" in response.text, (\n         \"default configs should be preserved\"\n     )\n-    assert \"SwaggerUIBundle.SwaggerUIStandalonePreset\" in response.text, (\n-        \"default configs should be preserved\"\n-    )\n     assert '\"layout\": \"BaseLayout\",' in response.text, (\n         \"default configs should be preserved\"\n     )\n\n```\n\n```diff\n@@ -21,9 +21,6 @@ def test_swagger_ui():\n     assert \"SwaggerUIBundle.presets.apis,\" in response.text, (\n         \"default configs should be preserved\"\n     )\n-    assert \"SwaggerUIBundle.SwaggerUIStandalonePreset\" in response.text, (\n-        \"default configs should be preserved\"\n-    )\n     assert '\"layout\": \"BaseLayout\",' in response.text, (\n         \"default configs should be preserved\"\n     )\n\n```\n\n```diff\n@@ -24,9 +24,6 @@ def test_swagger_ui():\n     assert \"SwaggerUIBundle.presets.apis,\" in response.text, (\n         \"default configs should be preserved\"\n     )\n-    assert \"SwaggerUIBundle.SwaggerUIStandalonePreset\" in response.text, (\n-        \"default configs should be preserved\"\n-    )\n     assert '\"layout\": \"BaseLayout\",' in response.text, (\n         \"default configs should be preserved\"\n     )\n\n```", "output": "Changes look good. This PR implements: ‚ú® Allow including additional scripts to Swagger UI page and adding presets", "source": "pr", "type": "code_review", "pr_number": 390}
{"instruction": "Review the following code changes: ‚ú® Add `SimpleJSONResponse` for decimal JSON encoding", "input": "```diff\n@@ -157,6 +157,12 @@ An alternative JSON response using <a href=\"https://github.com/ultrajson/ultrajs\n !!! tip\n     It's possible that `ORJSONResponse` might be a faster alternative.\n \n+### `SimpleJSONResponse`\n+\n+Another JSON response using <a href=\"https://github.com/simplejson/simplejson\" class=\"external-link\" target=\"_blank\">`simplejson`</a>.\n+\n+This is particularly useful when you need to serialize `Decimal` data, see [Decimal Numbers](decimal-numbers.md) for more.\n+\n ### `RedirectResponse`\n \n Returns an HTTP redirect. Uses a 307 status code (Temporary Redirect) by default.\n\n```\n\n```diff\n@@ -0,0 +1,99 @@\n+# Decimal Numbers\n+\n+!!! warning\n+    This is a rather advanced feature. You probably can skip it.\n+\n+    If you are just following the tutorial - user guide, you can probably skip this section.\n+\n+    If you already know that you need to modify the generated OpenAPI schema, continue reading.\n+\n+In cases where precision is important, such as **finances**,  **science research**, the default `flaot` type is not punctual enough in most cases.\n+\n+\n```\n\n```diff\n@@ -144,6 +144,7 @@ nav:\n   - advanced/extending-openapi.md\n   - advanced/openapi-callbacks.md\n   - advanced/wsgi.md\n+  - advanced/decimal-numbers.md\n   - advanced/generate-clients.md\n - async.md\n - Deployment:\n\n```\n\n```diff\n@@ -0,0 +1,22 @@\n+from decimal import Decimal\n+\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+\n+class IrrationalNumbers(BaseModel):\n+    pi: Decimal\n+    e: Decimal\n+\n+\n+app = FastAPI()\n+\n+num_model = IrrationalNumbers(\n+    pi=Decimal(\"3.14159265358979323846264338327950288\"),\n+    e=Decimal(\"2.71828182845904523536028747135266249\"),\n+)\n+\n+\n+@app.get(\"/\", response_model=IrrationalNumbers)\n+def numbers():\n+    return num_model\n\n```\n\n```diff\n@@ -0,0 +1,26 @@\n+from decimal import Decimal\n+\n+from fastapi import FastAPI\n+from fastapi.responses import SimpleJSONResponse\n+from pydantic import BaseModel\n+\n+\n+class IrrationalNumbers(BaseModel):\n+    pi: Decimal\n+    e: Decimal\n+\n+    class Config:\n+        json_encoders = {Decimal: lambda d: d}\n+\n+\n+app = FastAPI()\n+\n+num_model = IrrationalNumbers(\n+    pi=Decimal(\"3.14159265358979323846264338327950288\"),\n+    e=Decimal(\"2.71828182845904523536028747135266249\"),\n+)\n+\n+\n+@app.get(\"/\", response_model=IrrationalNumbers, response_class=SimpleJSONResponse)\n+def numbers():\n+    return num_model\n\n```", "output": "Changes look good. This PR implements: ‚ú® Add `SimpleJSONResponse` for decimal JSON encoding", "source": "pr", "type": "code_review", "pr_number": 389}
{"instruction": "Fix the following bug: üåê Update translations for ko (update outdated, found by fixer tool)", "input": "Running translation fixer tool shows several pages that contain mistakes. They were likely missed because of the overridden commit date.\r\nThis PR updates those outdated pages", "output": "```diff\n@@ -1,18 +1,18 @@\n-# ÎèôÏãúÏÑ±Í≥º async / await\n+# ÎèôÏãúÏÑ±Í≥º async / await { #concurrency-and-async-await }\n \n-*Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò*ÏóêÏÑúÏùò `async def` Î¨∏Î≤ïÏóê ÎåÄÌïú ÏÑ∏Î∂ÄÏÇ¨Ìï≠Í≥º ÎπÑÎèôÍ∏∞ ÏΩîÎìú, ÎèôÏãúÏÑ± Î∞è Î≥ëÎ†¨ÏÑ±Ïóê ÎåÄÌïú Î∞∞Í≤Ω\n+*Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*ÏóêÏÑúÏùò `async def` Î¨∏Î≤ïÏóê ÎåÄÌïú ÏÑ∏Î∂ÄÏÇ¨Ìï≠Í≥º ÎπÑÎèôÍ∏∞ ÏΩîÎìú, ÎèôÏãúÏÑ± Î∞è Î≥ëÎ†¨ÏÑ±Ïóê ÎåÄÌïú Î∞∞Í≤Ω\n \n-## Î∞îÏÅòÏã† Í≤ΩÏö∞\n+## Î∞îÏÅòÏã†Í∞ÄÏöî? { #in-a-hurry }\n \n-<strong>ÏöîÏïΩ</strong>\n+<abbr title=\"too long; didn't read - ÎÑàÎ¨¥ Í∏∏Ïñ¥ÏÑú ÏùΩÏßÄ ÏïäÏùå\"><strong>TL;DR:</strong></abbr>\n \n-Îã§ÏùåÍ≥º Í∞ôÏù¥ `await`Î•º ÏÇ¨Ïö©Ìï¥ Ìò∏Ï∂úÌïòÎäî Ï†ú3Ïùò ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞:\n+Îã§ÏùåÍ≥º Í∞ôÏù¥ `await`Î•º ÏÇ¨Ïö©Ìï¥ Ìò∏Ï∂úÌïòÎùºÍ≥† ÏïàÎÇ¥ÌïòÎäî Ï†ú3Ïûê ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞:\n \n \n```\n\n```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÍ≥†, ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n+**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÏÑúÎπôÌïòÍ≥†, FastAPI ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏóê ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n \n-FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå (Ïòà: `pip install \"fastapi[standard]\"` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Í≤ΩÏö∞), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§. Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n+FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå(Ïòà: `pip install \"fastapi[standard]\"`), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®ÎêòÎ©∞, Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n \n-Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n+Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n <div class=\"termy\">\n \n \n```\n\n```diff\n@@ -1,43 +1,43 @@\n-# Í∏∞Îä•\n+# Í∏∞Îä• { #features }\n \n-## FastAPIÏùò Í∏∞Îä•\n+## FastAPIÏùò Í∏∞Îä• { #fastapi-features }\n \n **FastAPI**Îäî Îã§ÏùåÍ≥º Í∞ôÏùÄ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§:\n \n-### Í∞úÎ∞©Ìòï ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú\n+### Í∞úÎ∞©Ìòï ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú { #based-on-open-standards }\n \n-* <abbr title=\"ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎùºÏö∞Ìä∏Î°úÎèÑ ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">Í≤ΩÎ°ú</abbr><abbr title=\"POST, GET, PUT, DELETEÏôÄ Í∞ôÏùÄ HTTP Î©îÏÜåÎìúÎ°ú ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">ÏûëÎèô</abbr>, Îß§Í∞úÎ≥ÄÏàò, Î≥∏Î¨∏ ÏöîÏ≤≠, Î≥¥Ïïà Í∑∏ Ïô∏Ïùò ÏÑ†Ïñ∏ÏùÑ Ìè¨Ìï®Ìïú API ÏÉùÏÑ±ÏùÑ ÏúÑÌïú <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a>\n-* <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (OpenAPI ÏûêÏ≤¥Í∞Ä JSON SchemaÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ≥† ÏûàÏäµÎãàÎã§)Î•º ÏÇ¨Ïö©Ìïú ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î¨∏ÏÑúÌôî.\n-* Îã®ÏàúÌûà Îñ†Ïò¨Î†§ÏÑú ÎçßÎ∂ôÏù∏ Í∏∞Îä•Ïù¥ ÏïÑÎãôÎãàÎã§. ÏÑ∏Ïã¨Ìïú Í≤ÄÌÜ†Î•º Í±∞Ïπú ÌõÑ, Ïù¥Îü¨Ìïú ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.\n-* Ïù¥Îäî ÎòêÌïú Îã§ÏñëÌïú Ïñ∏Ïñ¥Î°ú ÏûêÎèôÏ†ÅÏù∏ **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏΩîÎìú ÏÉùÏÑ±**ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å ÏßÄÏõêÌï©ÎãàÎã§.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a>: <abbr title=\"ÎòêÌïú Îã§ÏùåÏúºÎ°úÎèÑ Î∂àÎ¶ΩÎãàÎã§: ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎùºÏö∞Ìä∏\">path</abbr> <abbr title=\"HTTP Î©îÏÜåÎìú(POST, GET, PUT, DELETE Îì±)Î°úÎèÑ ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">operations</abbr>, Îß§Í∞úÎ≥ÄÏàò, ÏöîÏ≤≠ Î≥∏Î¨∏, Î≥¥Ïïà Îì±Ïùò ÏÑ†Ïñ∏ÏùÑ Ìè¨Ìï®ÌïòÏó¨ APIÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§.\n+* <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a>Î•º ÏÇ¨Ïö©Ìïú ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î¨∏ÏÑúÌôî(OpenAPI ÏûêÏ≤¥Í∞Ä JSON SchemaÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞ ÎïåÎ¨∏ÏûÖÎãàÎã§).\n+* Îã®ÏàúÌûà Îñ†Ïò¨Î†§ÏÑú ÎçßÎ∂ôÏù∏ Î†àÏù¥Ïñ¥Í∞Ä ÏïÑÎãàÎùº, ÏÑ∏Ïã¨Ìïú Í≤ÄÌÜ†Î•º Í±∞Ïπú Îí§ Ïù¥Îü¨Ìïú ÌëúÏ§ÄÏùÑ Ï§ëÏã¨ÏúºÎ°ú ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.\n+* Ïù¥Îäî ÎòêÌïú Îã§ÏñëÌïú Ïñ∏Ïñ¥Î°ú ÏûêÎèô **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏΩîÎìú ÏÉùÏÑ±**ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ìï¥Ï§çÎãàÎã§.\n \n-### Î¨∏ÏÑú ÏûêÎèôÌôî\n+### Î¨∏ÏÑú ÏûêÎèôÌôî { #automatic-docs }\n \n-ÎåÄÌôîÌòï API Î¨∏ÏÑúÏôÄ Ïõπ ÌÉêÏÉâ Ïú†Ï†Ä Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌîÑÎ†àÏûÑÏõåÌÅ¨Í∞Ä OpenAPIÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞Ïóê, 2Í∞ÄÏßÄ ÏòµÏÖòÏù¥ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Îì§Ïñ¥Í∞Ñ Ïó¨Îü¨ ÏòµÏÖòÏù¥ Ï°¥Ïû¨Ìï©ÎãàÎã§.\n+ÎåÄÌôîÌòï API Î¨∏ÏÑúÏôÄ ÌÉêÏÉâÏö© Ïõπ ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌîÑÎ†àÏûÑÏõåÌÅ¨Í∞Ä OpenAPIÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞Ïóê Ïó¨Îü¨ ÏòµÏÖòÏù¥ ÏûàÏúºÎ©∞, Í∏∞Î≥∏ÏúºÎ°ú 2Í∞ÄÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§.\n \n-* ÎåÄÌôîÌòï ÌÉêÏÉâ <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>Î•º Ïù¥Ïö©Ìï¥, Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Î∞îÎ°ú Ïó¨Îü¨Î∂ÑÏùò APIÎ•º Ìò∏Ï∂úÌïòÍ±∞ÎÇò ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+* ÎåÄÌôîÌòï ÌÉêÏÉâÏù¥ Í∞ÄÎä•Ìïú <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>Î°ú Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÅÏ†ë APIÎ•º Ìò∏Ï∂úÌïòÍ≥† ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n ![Swagger UI interaction](https://fastapi.tiangolo.com/img/index/index-03-swagger-02.png)\n \n-* <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>ÏùÑ Ïù¥Ïö©Ìï¥ API Î¨∏ÏÑúÌôîÎ•º ÎåÄÏ≤¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+* <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>ÏùÑ Ïù¥Ïö©Ìïú ÎåÄÏ≤¥ API Î¨∏ÏÑúÌôî.\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Í∑∏Ï†Ä ÌòÑÎåÄ ÌååÏù¥Ïç¨\n+### Í∑∏Ï†Ä ÌòÑÎåÄ ÌååÏù¥Ïç¨ { #just-modern-python }\n \n-(Pydantic ÎçïÎ∂ÑÏóê) FastAPIÎäî ÌëúÏ§Ä **ÌååÏù¥Ïç¨ 3.6 ÌÉÄÏûÖ** ÏÑ†Ïñ∏Ïóê Í∏∞Î∞òÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÏÉàÎ°ú Î∞∞Ïö∏ Î¨∏Î≤ïÏù¥ ÏóÜÏäµÎãàÎã§. Í∑∏Ï†Ä ÌëúÏ§ÄÏ†ÅÏù∏ ÌòÑÎåÄ ÌååÏù¥Ïç¨ÏûÖÎãàÎã§.\n+( Pydantic ÎçïÎ∂ÑÏóê) Î™®Îì† Í≤ÉÏù¥ ÌëúÏ§Ä **Python ÌÉÄÏûÖ** ÏÑ†Ïñ∏ÏùÑ Í∏∞Î∞òÏúºÎ°ú Ìï©ÎãàÎã§. ÏÉàÎ°ú Î∞∞Ïö∏ Î¨∏Î≤ïÏù¥ ÏóÜÏäµÎãàÎã§. Í∑∏Ï†Ä ÌëúÏ§ÄÏ†ÅÏù∏ ÌòÑÎåÄ ÌååÏù¥Ïç¨ÏûÖÎãàÎã§.\n \n-ÎßåÏïΩ Ïó¨Îü¨Î∂ÑÏù¥ ÌååÏù¥Ïç¨ ÌÉÄÏûÖÏùÑ Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©ÌïòÎäîÏßÄÏóê ÎåÄÌïú 2Î∂Ñ Ï†ïÎèÑÏùò Î≥µÏäµÏù¥ ÌïÑÏöîÌïòÎã§Î©¥ (ÎπÑÎ°ù Ïó¨Îü¨Î∂ÑÏù¥ FastAPIÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäîÎã§ ÌïòÎçîÎùºÎèÑ), Îã§ÏùåÏùò ÏßßÏùÄ ÏûêÏäµÏÑúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî: [ÌååÏù¥Ïç¨ ÌÉÄÏûÖ](python-types.md){.internal-link target=\\_blank}.\n+Python ÌÉÄÏûÖÏùÑ Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©ÌïòÎäîÏßÄ 2Î∂Ñ Ï†ïÎèÑ Î≥µÏäµÏù¥ ÌïÑÏöîÌïòÎã§Î©¥(FastAPIÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎçîÎùºÎèÑ), Îã§ÏùåÏùò ÏßßÏùÄ ÏûêÏäµÏÑúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî: [Python ÌÉÄÏûÖ](python-types.md){.internal-link target=_blank}.\n \n-Ïó¨Îü¨Î∂ÑÏùÄ ÌÉÄÏûÖÏùÑ Ïù¥Ïö©Ìïú ÌëúÏ§Ä ÌååÏù¥Ïç¨ÏùÑ Îã§ÏùåÍ≥º Í∞ôÏù¥ Ï†ÅÏùÑ Ïàò ÏûàÏäµÎãàÎã§:\n+Ïó¨Îü¨Î∂ÑÏùÄ ÌÉÄÏûÖÏù¥ ÏûàÎäî ÌëúÏ§Ä PythonÏùÑ Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏûëÏÑ±Ìï©ÎãàÎã§:\n \n \n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# FastAPI ÏßÄÏõê - ÎèÑÏõÄ Î∞õÍ∏∞\n+# FastAPI ÏßÄÏõê - ÎèÑÏõÄ Î∞õÍ∏∞ { #help-fastapi-get-help }\n \n **FastAPI** Í∞Ä ÎßàÏùåÏóê ÎìúÏãúÎÇòÏöî?\n \n@@ -10,259 +10,246 @@ FastAPI, Îã§Î•∏ ÏÇ¨Ïö©Ïûê, Í∞úÎ∞úÏûêÎ•º ÏùëÏõêÌïòÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?\n \n ÎòêÌïú ÎèÑÏõÄÏùÑ Î∞õÏùÑ Ïàò ÏûàÎäî Î∞©Î≤ïÎèÑ Î™á Í∞ÄÏßÄ ÏûàÏäµÎãàÎã§.\n \n-## Îâ¥Ïä§Î†àÌÑ∞ Íµ¨ÎèÖ\n+## Îâ¥Ïä§Î†àÌÑ∞ Íµ¨ÎèÖ { #subscribe-to-the-newsletter }\n \n-[**FastAPI and friends** Îâ¥Ïä§Î†àÌÑ∞](newsletter.md){.internal-link target=\\_blank}Î•º Íµ¨ÎèÖÌïòÏó¨ ÏµúÏã† Ï†ïÎ≥¥Î•º Ïú†ÏßÄÌï† Ïàò ÏûàÏäµÎãàÎã§:\n+(ÏûêÏ£º Î∞úÏÜ°ÎêòÏßÄ ÏïäÎäî) [**FastAPI and friends** Îâ¥Ïä§Î†àÌÑ∞](newsletter.md){.internal-link target=_blank}Î•º Íµ¨ÎèÖÌïòÏó¨ ÏµúÏã† Ï†ïÎ≥¥Î•º Ïú†ÏßÄÌï† Ïàò ÏûàÏäµÎãàÎã§:\n \n * FastAPI and friendsÏóê ÎåÄÌïú Îâ¥Ïä§ üöÄ\n * Í∞ÄÏù¥Îìú üìù\n * Í∏∞Îä• ‚ú®\n * ÌöçÍ∏∞Ï†ÅÏù∏ Î≥ÄÌôî üö®\n * ÌåÅÍ≥º ÏöîÎ†π ‚úÖ\n \n-## Ìä∏ÏúÑÌÑ∞ÏóêÏÑú FastAPI ÌåîÎ°úÏö∞ÌïòÍ∏∞\n+## X(Twitter)ÏóêÏÑú FastAPI ÌåîÎ°úÏö∞ÌïòÍ∏∞ { #follow-fastapi-on-x-twitter }\n \n <a href=\"https://x.com/fastapi\" class=\"external-link\" target=\"_blank\">**X (Twitter)**Ïùò @fastapiÎ•º ÌåîÎ°úÏö∞</a>ÌïòÏó¨ **FastAPI** Ïóê ÎåÄÌïú ÏµúÏã† Îâ¥Ïä§Î•º ÏñªÏùÑ Ïàò ÏûàÏäµÎãàÎã§. üê¶\n \n-## Star **FastAPI** in GitHub\n+## GitHubÏóêÏÑú **FastAPI**Ïóê Star Ï£ºÍ∏∞ { #star-fastapi-in-github }\n \n GitHubÏóêÏÑú FastAPIÏóê \"star\"Î•º Î∂ôÏùº Ïàò ÏûàÏäµÎãàÎã§ (Ïò§Î•∏Ï™Ω ÏÉÅÎã®Ïùò star Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠): <a href=\"https://github.com/fastapi/fastapi\" class=\"external-link\" target=\"_blank\">https://github.com/fastapi/fastapi</a>. ‚≠êÔ∏è\n \n Ïä§ÌÉÄÎ•º ÎäòÎ¶ºÏúºÎ°úÏç®, Îã§Î•∏ ÏÇ¨Ïö©ÏûêÎì§Ïù¥ Ï¢Ä Îçî ÏâΩÍ≤å Ï∞æÏùÑ Ïàò ÏûàÍ≥†, ÎßéÏùÄ ÏÇ¨ÎûåÎì§ÏóêÍ≤å Ïú†Ïö©Ìïú Í≤ÉÏûÑÏùÑ ÎÇòÌÉÄÎÇº Ïàò ÏûàÏäµÎãàÎã§.\n \n-## GitHub Ï†ÄÏû•ÏÜåÏóêÏÑú Î¶¥Î¶¨Ï¶à ÌôïÏù∏\n+## Î¶¥Î¶¨Ï¶à ÌôïÏù∏ÏùÑ ÏúÑÌï¥ GitHub Ï†ÄÏû•ÏÜå Î≥¥Í∏∞ { #watch-the-github-repository-for-releases }\n \n-GitHubÏóêÏÑú FastAPIÎ•º \"watch\"Ìï† Ïàò ÏûàÏäµÎãàÎã§ (Ïò§Î•∏Ï™Ω ÏÉÅÎã® watch Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠): <a href=\"https://github.com/fastapi/fastapi\" class=\"external-link\" target=\"_blank\">https://github.com/fastapi/fastapi</a>. üëÄ\n+GitHubÏóêÏÑú FastAPIÎ•º \"watch\"Ìï† Ïàò ÏûàÏäµÎãàÎã§ (Ïò§Î•∏Ï™Ω ÏÉÅÎã® \"watch\" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠): <a href=\"https://github.com/fastapi/fastapi\" class=\"external-link\" target=\"_blank\">https://github.com/fastapi/fastapi</a>. üëÄ\n \n-Ïó¨Í∏∞ÏÑú \"Releases only\"ÏùÑ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.\n+Ïó¨Í∏∞ÏÑú \"Releases only\"Î•º ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.\n \n-Ïù¥Î†áÍ≤åÌïòÎ©¥, **FastAPI** Ïùò Î≤ÑÍ∑∏ ÏàòÏ†ï Î∞è ÏÉàÎ°úÏö¥ Í∏∞Îä•Ïùò Íµ¨ÌòÑ Îì±Ïùò ÏÉàÎ°úÏö¥ ÏûêÎ£å (ÏµúÏã† Î≤ÑÏ†Ñ)Ïù¥ ÏûàÏùÑ ÎïåÎßàÎã§ (Ïù¥Î©îÏùº) ÌÜµÏßÄÎ•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.\n+Ïù¥Î†áÍ≤åÌïòÎ©¥, **FastAPI** Ïùò Î≤ÑÍ∑∏ ÏàòÏ†ï Î∞è ÏÉàÎ°úÏö¥ Í∏∞Îä•Ïùò Íµ¨ÌòÑ Îì±Ïùò ÏÉàÎ°úÏö¥ Î¶¥Î¶¨Ï¶à(ÏÉà Î≤ÑÏ†Ñ)Í∞Ä ÏûàÏùÑ ÎïåÎßàÎã§ (Ïù¥Î©îÏùº) ÌÜµÏßÄÎ•º Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.\n \n-## Í∞úÎ∞úÏûêÏôÄÏùò Ïó∞Í≤∞\n+## Í∞úÎ∞úÏûêÏôÄÏùò Ïó∞Í≤∞ { #connect-with-the-author }\n \n-<a href=\"https://tiangolo.com\" class=\"external-link\" target=\"_blank\">Í∞úÎ∞úÏûê(Sebasti√°n Ram√≠rez / `tiangolo`)</a>ÏôÄ Ïó∞ÎùΩÏùÑ Ï∑®Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+Í∞úÎ∞úÏûê(ÏûëÏÑ±Ïûê)Ïù∏ <a href=\"https://tiangolo.com\" class=\"external-link\" target=\"_blank\">Ï†Ä(Sebasti√°n Ram√≠rez / `tiangolo`)</a>ÏôÄ Ïó∞ÎùΩÏùÑ Ï∑®Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n Ïó¨Îü¨Î∂ÑÏùÄ Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n-* <a href=\"https://github.com/tiangolo\" class=\"external-link\" target=\"_blank\">**GitHub**ÏóêÏÑú ÌåîÎ°úÏö∞ÌïòÍ∏∞.</a>.\n-    * ÎãπÏã†ÏóêÍ≤å ÎèÑÏõÄÏù¥ Îê† Ï†ÄÏùò Îã§Î•∏ Ïò§ÌîàÏÜåÏä§ ÌîÑÎ°úÏ†ùÌä∏Î•º ÌôïÏù∏ÌïòÏã≠ÏãúÏò§.\n+* <a href=\"https://github.com/tiangolo\" class=\"external-link\" target=\"_blank\">**GitHub**ÏóêÏÑú ÌåîÎ°úÏö∞ÌïòÍ∏∞</a>.\n+    * Ïó¨Îü¨Î∂ÑÏóêÍ≤å ÎèÑÏõÄÏù¥ Îê† Ï†ÄÏùò Îã§Î•∏ Ïò§ÌîàÏÜåÏä§ ÌîÑÎ°úÏ†ùÌä∏Î•º ÌôïÏù∏ÌïòÏã≠ÏãúÏò§.\n     * ÏÉàÎ°úÏö¥ Ïò§ÌîàÏÜåÏä§ ÌîÑÎ°úÏ†ùÌä∏Î•º ÎßåÎì§ÏóàÏùÑ Îïå ÌôïÏù∏ÌïòÎ†§Î©¥ ÌåîÎ°úÏö∞ ÌïòÏã≠ÏãúÏò§.\n * <a href=\"https://x.com/tiangolo\" class=\"external-link\" target=\"_blank\">**X (Twitter)**</a> ÎòêÎäî <a href=\"https://fosstodon.org/@tiangolo\" class=\"external-link\" target=\"_blank\">Mastodon</a>ÏóêÏÑú ÌåîÎ°úÏö∞ÌïòÍ∏∞.\n     * FastAPIÏùò ÏÇ¨Ïö© Ïö©ÎèÑÎ•º ÏïåÎ†§Ï£ºÏÑ∏Ïöî (Í∑∏Í≤ÉÏùÑ Îì£Îäî Í≤ÉÏùÑ Ï¢ãÏïÑÌï©ÎãàÎã§).\n     * Î∞úÌëúÎÇò ÏÉàÎ°úÏö¥ Ìà¥ Ï∂úÏãú ÏÜåÏãùÏùÑ Î∞õÏïÑÎ≥¥Ïã≠ÏãúÏò§.\n-    * <a href=\"https://x.com/fastapi\" class=\"external-link\" target=\"_blank\">**X (Twitter)**Ïùò @fastapiÎ•º ÌåîÎ°úÏö∞</a> (Î≥ÑÎèÑ Í≥ÑÏ†ïÏóêÏÑú) Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n-* <a href=\"https://www.linkedin.com/in/tiango\n\n```\n\n```diff\n@@ -1,81 +1,79 @@\n-# Ïó≠ÏÇ¨, ÎîîÏûêÏù∏ Í∑∏Î¶¨Í≥† ÎØ∏Îûò\n+# Ïó≠ÏÇ¨, ÎîîÏûêÏù∏ Í∑∏Î¶¨Í≥† ÎØ∏Îûò { #history-design-and-future }\n \n-Ïñ¥Îäê ÎÇ†, [Ìïú FastAPI ÏÇ¨Ïö©Ïûê](https://github.com/fastapi/fastapi/issues/3#issuecomment-454956920)Í∞Ä Ïù¥Î†áÍ≤å Î¨ºÏóàÏäµÎãàÎã§:\n+ÏñºÎßà Ï†Ñ, <a href=\"https://github.com/fastapi/fastapi/issues/3#issuecomment-454956920\" class=\"external-link\" target=\"_blank\">Ìïú **FastAPI** ÏÇ¨Ïö©ÏûêÍ∞Ä Ïù¥Î†áÍ≤å Î¨ºÏóàÏäµÎãàÎã§</a>:\n \n-> Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Ïùò Ïó≠ÏÇ¨Î•º ÏïåÎ†§ Ï£ºÏã§ Ïàò ÏûàÎÇòÏöî? Î™á Ï£º ÎßåÏóê Î©ãÏßÑ Í≤∞Í≥ºÎ•º ÎÇ∏ Í≤É Í∞ôÏïÑÏöî. [...]\n+> Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Ïùò Ïó≠ÏÇ¨Îäî Î¨¥ÏóáÏù∏Í∞ÄÏöî? Î™á Ï£º ÎßåÏóê ÏïÑÎ¨¥ Îç∞ÏÑúÎèÑ Í∞ëÏûêÍ∏∞ ÎÇòÌÉÄÎÇò ÏóÑÏ≤≠ÎÇòÍ≤å Ï¢ãÏïÑÏßÑ Í≤ÉÏ≤òÎüº Î≥¥Ïù¥ÎÑ§Ïöî [...]\n \n Ïó¨Í∏∞ÏÑú Í∑∏ Ïó≠ÏÇ¨Ïóê ÎåÄÌï¥ Í∞ÑÎã®Ìûà ÏÑ§Î™ÖÌïòÍ≤†ÏäµÎãàÎã§.\n \n----\n+## ÎåÄÏïà { #alternatives }\n \n-## ÎåÄÏïà\n+Ï†ÄÎäî Ïó¨Îü¨ Ìï¥ ÎèôÏïà Î≥µÏû°Ìïú ÏöîÍµ¨ÏÇ¨Ìï≠(Î®∏Ïã†Îü¨Îãù, Î∂ÑÏÇ∞ ÏãúÏä§ÌÖú, ÎπÑÎèôÍ∏∞ ÏûëÏóÖ, NoSQL Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Îì±)ÏùÑ Í∞ÄÏßÑ APIÎ•º ÎßåÎì§Î©¥ÏÑú Ïó¨Îü¨ Í∞úÎ∞ú ÌåÄÏùÑ Ïù¥ÎÅåÏñ¥ ÏôîÏäµÎãàÎã§.\n \n-Ï†ÄÎäî Ïó¨Îü¨ Ìï¥ ÎèôÏïà Î®∏Ïã†Îü¨Îãù, Î∂ÑÏÇ∞ ÏãúÏä§ÌÖú, ÎπÑÎèôÍ∏∞ ÏûëÏóÖ, NoSQL Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í∞ôÏùÄ Î≥µÏû°Ìïú ÏöîÍµ¨ÏÇ¨Ìï≠ÏùÑ Í∞ÄÏßÑ APIÎ•º Í∞úÎ∞úÌïòÎ©∞ Ïó¨Îü¨ ÌåÄÏùÑ Ïù¥ÎÅåÏñ¥ ÏôîÏäµÎãàÎã§.\n+Í∑∏ Í≥ºÏ†ïÏóêÏÑú ÎßéÏùÄ ÎåÄÏïàÏùÑ Ï°∞ÏÇ¨ÌïòÍ≥†, ÌÖåÏä§Ìä∏ÌïòÍ≥†, ÏÇ¨Ïö©Ìï¥Ïïº ÌñàÏäµÎãàÎã§.\n \n-Ïù¥ Í≥ºÏ†ïÏóêÏÑú ÎßéÏùÄ ÎåÄÏïàÏùÑ Ï°∞ÏÇ¨ÌïòÍ≥†, ÌÖåÏä§Ìä∏ÌïòÎ©∞, ÏÇ¨Ïö©Ìï¥Ïïº ÌñàÏäµÎãàÎã§. **Fas\n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 388}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,18 +1,18 @@\n-# ÎèôÏãúÏÑ±Í≥º async / await\n+# ÎèôÏãúÏÑ±Í≥º async / await { #concurrency-and-async-await }\n \n-*Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò*ÏóêÏÑúÏùò `async def` Î¨∏Î≤ïÏóê ÎåÄÌïú ÏÑ∏Î∂ÄÏÇ¨Ìï≠Í≥º ÎπÑÎèôÍ∏∞ ÏΩîÎìú, ÎèôÏãúÏÑ± Î∞è Î≥ëÎ†¨ÏÑ±Ïóê ÎåÄÌïú Î∞∞Í≤Ω\n+*Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*ÏóêÏÑúÏùò `async def` Î¨∏Î≤ïÏóê ÎåÄÌïú ÏÑ∏Î∂ÄÏÇ¨Ìï≠Í≥º ÎπÑÎèôÍ∏∞ ÏΩîÎìú, ÎèôÏãúÏÑ± Î∞è Î≥ëÎ†¨ÏÑ±Ïóê ÎåÄÌïú Î∞∞Í≤Ω\n \n-## Î∞îÏÅòÏã† Í≤ΩÏö∞\n+## Î∞îÏÅòÏã†Í∞ÄÏöî? { #in-a-hurry }\n \n-<strong>ÏöîÏïΩ</strong>\n+<abbr title=\"too long; didn't read - ÎÑàÎ¨¥ Í∏∏Ïñ¥ÏÑú ÏùΩÏßÄ ÏïäÏùå\"><strong>TL;DR:</strong></abbr>\n \n-Îã§ÏùåÍ≥º Í∞ôÏù¥ `await`Î•º ÏÇ¨Ïö©Ìï¥ Ìò∏Ï∂úÌïòÎäî Ï†ú3Ïùò ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞:\n+Îã§ÏùåÍ≥º Í∞ôÏù¥ `await`Î•º ÏÇ¨Ïö©Ìï¥ Ìò∏Ï∂úÌïòÎùºÍ≥† ÏïàÎÇ¥ÌïòÎäî Ï†ú3Ïûê ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞:\n \n \n```\n\n```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÍ≥†, ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n+**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÏÑúÎπôÌïòÍ≥†, FastAPI ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏóê ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n \n-FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå (Ïòà: `pip install \"fastapi[standard]\"` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Í≤ΩÏö∞), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§. Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n+FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå(Ïòà: `pip install \"fastapi[standard]\"`), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®ÎêòÎ©∞, Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n \n-Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n+Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n <div class=\"termy\">\n \n \n```\n\n```diff\n@@ -1,43 +1,43 @@\n-# Í∏∞Îä•\n+# Í∏∞Îä• { #features }\n \n-## FastAPIÏùò Í∏∞Îä•\n+## FastAPIÏùò Í∏∞Îä• { #fastapi-features }\n \n **FastAPI**Îäî Îã§ÏùåÍ≥º Í∞ôÏùÄ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§:\n \n-### Í∞úÎ∞©Ìòï ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú\n+### Í∞úÎ∞©Ìòï ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú { #based-on-open-standards }\n \n-* <abbr title=\"ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎùºÏö∞Ìä∏Î°úÎèÑ ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">Í≤ΩÎ°ú</abbr><abbr title=\"POST, GET, PUT, DELETEÏôÄ Í∞ôÏùÄ HTTP Î©îÏÜåÎìúÎ°ú ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">ÏûëÎèô</abbr>, Îß§Í∞úÎ≥ÄÏàò, Î≥∏Î¨∏ ÏöîÏ≤≠, Î≥¥Ïïà Í∑∏ Ïô∏Ïùò ÏÑ†Ïñ∏ÏùÑ Ìè¨Ìï®Ìïú API ÏÉùÏÑ±ÏùÑ ÏúÑÌïú <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a>\n-* <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (OpenAPI ÏûêÏ≤¥Í∞Ä JSON SchemaÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ≥† ÏûàÏäµÎãàÎã§)Î•º ÏÇ¨Ïö©Ìïú ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î¨∏ÏÑúÌôî.\n-* Îã®ÏàúÌûà Îñ†Ïò¨Î†§ÏÑú ÎçßÎ∂ôÏù∏ Í∏∞Îä•Ïù¥ ÏïÑÎãôÎãàÎã§. ÏÑ∏Ïã¨Ìïú Í≤ÄÌÜ†Î•º Í±∞Ïπú ÌõÑ, Ïù¥Îü¨Ìïú ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.\n-* Ïù¥Îäî ÎòêÌïú Îã§ÏñëÌïú Ïñ∏Ïñ¥Î°ú ÏûêÎèôÏ†ÅÏù∏ **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏΩîÎìú ÏÉùÏÑ±**ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å ÏßÄÏõêÌï©ÎãàÎã§.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a>: <abbr title=\"ÎòêÌïú Îã§ÏùåÏúºÎ°úÎèÑ Î∂àÎ¶ΩÎãàÎã§: ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎùºÏö∞Ìä∏\">path</abbr> <abbr title=\"HTTP Î©îÏÜåÎìú(POST, GET, PUT, DELETE Îì±)Î°úÎèÑ ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">operations</abbr>, Îß§Í∞úÎ≥ÄÏàò, ÏöîÏ≤≠ Î≥∏Î¨∏, Î≥¥Ïïà Îì±Ïùò ÏÑ†Ïñ∏ÏùÑ Ìè¨Ìï®ÌïòÏó¨ APIÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§.\n+* <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a>Î•º ÏÇ¨Ïö©Ìïú ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î¨∏ÏÑúÌôî(OpenAPI ÏûêÏ≤¥Í∞Ä JSON SchemaÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞ ÎïåÎ¨∏ÏûÖÎãàÎã§).\n+* Îã®ÏàúÌûà Îñ†Ïò¨Î†§ÏÑú ÎçßÎ∂ôÏù∏ Î†àÏù¥Ïñ¥Í∞Ä ÏïÑÎãàÎùº, ÏÑ∏Ïã¨Ìïú Í≤ÄÌÜ†Î•º Í±∞Ïπú Îí§ Ïù¥Îü¨Ìïú ÌëúÏ§ÄÏùÑ Ï§ëÏã¨ÏúºÎ°ú ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.\n+* Ïù¥Îäî ÎòêÌïú Îã§ÏñëÌïú Ïñ∏Ïñ¥Î°ú ÏûêÎèô **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏΩîÎìú ÏÉùÏÑ±**ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ìï¥Ï§çÎãàÎã§.\n \n-### Î¨∏ÏÑú ÏûêÎèôÌôî\n+### Î¨∏ÏÑú ÏûêÎèôÌôî { #automatic-docs }\n \n-ÎåÄÌôîÌòï API Î¨∏ÏÑúÏôÄ Ïõπ ÌÉêÏÉâ Ïú†Ï†Ä Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌîÑÎ†àÏûÑÏõåÌÅ¨Í∞Ä OpenAPIÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞Ïóê, 2Í∞ÄÏßÄ ÏòµÏÖòÏù¥ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Îì§Ïñ¥Í∞Ñ Ïó¨Îü¨ ÏòµÏÖòÏù¥ Ï°¥Ïû¨Ìï©ÎãàÎã§.\n+ÎåÄÌôîÌòï API Î¨∏ÏÑúÏôÄ ÌÉêÏÉâÏö© Ïõπ ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌîÑÎ†àÏûÑÏõåÌÅ¨Í∞Ä OpenAPIÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞Ïóê Ïó¨Îü¨ ÏòµÏÖòÏù¥ ÏûàÏúºÎ©∞, Í∏∞Î≥∏ÏúºÎ°ú 2Í∞ÄÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§.\n \n-* ÎåÄÌôîÌòï ÌÉêÏÉâ <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>Î•º Ïù¥Ïö©Ìï¥, Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Î∞îÎ°ú Ïó¨Îü¨Î∂ÑÏùò APIÎ•º Ìò∏Ï∂úÌïòÍ±∞ÎÇò ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+* ÎåÄÌôîÌòï ÌÉêÏÉâÏù¥ Í∞ÄÎä•Ìïú <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>Î°ú Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÅÏ†ë APIÎ•º Ìò∏Ï∂úÌïòÍ≥† ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n ![Swagger UI interaction](https://fastapi.tiangolo.com/img/index/index-03-swagger-02.png)\n \n-* <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>ÏùÑ Ïù¥Ïö©Ìï¥ API Î¨∏ÏÑúÌôîÎ•º ÎåÄÏ≤¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+* <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>ÏùÑ Ïù¥Ïö©Ìïú ÎåÄÏ≤¥ API Î¨∏ÏÑúÌôî.\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Í∑∏Ï†Ä ÌòÑÎåÄ ÌååÏù¥Ïç¨\n+### Í∑∏Ï†Ä ÌòÑÎåÄ ÌååÏù¥Ïç¨ { #just-modern-python }\n \n-(Pydantic ÎçïÎ∂ÑÏóê) FastAPIÎäî ÌëúÏ§Ä **ÌååÏù¥Ïç¨ 3.6 ÌÉÄÏûÖ** ÏÑ†Ïñ∏Ïóê Í∏∞Î∞òÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÏÉàÎ°ú Î∞∞Ïö∏ Î¨∏Î≤ïÏù¥ ÏóÜÏäµÎãàÎã§. Í∑∏Ï†Ä ÌëúÏ§ÄÏ†ÅÏù∏ ÌòÑÎåÄ ÌååÏù¥Ïç¨ÏûÖÎãàÎã§.\n+( Pydantic ÎçïÎ∂ÑÏóê) Î™®Îì† Í≤ÉÏù¥ ÌëúÏ§Ä **Python ÌÉÄÏûÖ** ÏÑ†Ïñ∏ÏùÑ Í∏∞Î∞òÏúºÎ°ú Ìï©ÎãàÎã§. ÏÉàÎ°ú Î∞∞Ïö∏ Î¨∏Î≤ïÏù¥ ÏóÜÏäµÎãàÎã§. Í∑∏Ï†Ä ÌëúÏ§ÄÏ†ÅÏù∏ ÌòÑÎåÄ ÌååÏù¥Ïç¨ÏûÖÎãàÎã§.\n \n-ÎßåÏïΩ Ïó¨Îü¨Î∂ÑÏù¥ ÌååÏù¥Ïç¨ ÌÉÄÏûÖÏùÑ Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©ÌïòÎäîÏßÄÏóê ÎåÄÌïú 2Î∂Ñ Ï†ïÎèÑÏùò Î≥µÏäµÏù¥ ÌïÑÏöîÌïòÎã§Î©¥ (ÎπÑÎ°ù Ïó¨Îü¨Î∂ÑÏù¥ FastAPIÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäîÎã§ ÌïòÎçîÎùºÎèÑ), Îã§ÏùåÏùò ÏßßÏùÄ ÏûêÏäµÏÑúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî: [ÌååÏù¥Ïç¨ ÌÉÄÏûÖ](python-types.md){.internal-link target=\\_blank}.\n+Python ÌÉÄÏûÖÏùÑ Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©ÌïòÎäîÏßÄ 2Î∂Ñ Ï†ïÎèÑ Î≥µÏäµÏù¥ ÌïÑÏöîÌïòÎã§Î©¥(FastAPIÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎçîÎùºÎèÑ), Îã§Ïùå", "output": "Bug: üåê Update translations for ko (update outdated, found by fixer tool)\n\nRunning translation fixer tool shows several pages that contain mistakes. They were likely missed because of the overridden commit date.\r\nThis PR updates those outdated pages", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 388}
{"instruction": "Review the following code changes: üåê Update translations for ko (update outdated, found by fixer tool)", "input": "```diff\n@@ -1,18 +1,18 @@\n-# ÎèôÏãúÏÑ±Í≥º async / await\n+# ÎèôÏãúÏÑ±Í≥º async / await { #concurrency-and-async-await }\n \n-*Í≤ΩÎ°ú ÏûëÎèô Ìï®Ïàò*ÏóêÏÑúÏùò `async def` Î¨∏Î≤ïÏóê ÎåÄÌïú ÏÑ∏Î∂ÄÏÇ¨Ìï≠Í≥º ÎπÑÎèôÍ∏∞ ÏΩîÎìú, ÎèôÏãúÏÑ± Î∞è Î≥ëÎ†¨ÏÑ±Ïóê ÎåÄÌïú Î∞∞Í≤Ω\n+*Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*ÏóêÏÑúÏùò `async def` Î¨∏Î≤ïÏóê ÎåÄÌïú ÏÑ∏Î∂ÄÏÇ¨Ìï≠Í≥º ÎπÑÎèôÍ∏∞ ÏΩîÎìú, ÎèôÏãúÏÑ± Î∞è Î≥ëÎ†¨ÏÑ±Ïóê ÎåÄÌïú Î∞∞Í≤Ω\n \n-## Î∞îÏÅòÏã† Í≤ΩÏö∞\n+## Î∞îÏÅòÏã†Í∞ÄÏöî? { #in-a-hurry }\n \n-<strong>ÏöîÏïΩ</strong>\n+<abbr title=\"too long; didn't read - ÎÑàÎ¨¥ Í∏∏Ïñ¥ÏÑú ÏùΩÏßÄ ÏïäÏùå\"><strong>TL;DR:</strong></abbr>\n \n-Îã§ÏùåÍ≥º Í∞ôÏù¥ `await`Î•º ÏÇ¨Ïö©Ìï¥ Ìò∏Ï∂úÌïòÎäî Ï†ú3Ïùò ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞:\n+Îã§ÏùåÍ≥º Í∞ôÏù¥ `await`Î•º ÏÇ¨Ïö©Ìï¥ Ìò∏Ï∂úÌïòÎùºÍ≥† ÏïàÎÇ¥ÌïòÎäî Ï†ú3Ïûê ÎùºÏù¥Î∏åÎü¨Î¶¨Î•º ÏÇ¨Ïö©ÌïòÎäî Í≤ΩÏö∞:\n \n \n```\n\n```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÍ≥†, ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n+**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÏÑúÎπôÌïòÍ≥†, FastAPI ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏóê ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n \n-FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå (Ïòà: `pip install \"fastapi[standard]\"` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Í≤ΩÏö∞), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§. Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n+FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå(Ïòà: `pip install \"fastapi[standard]\"`), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®ÎêòÎ©∞, Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n \n-Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n+Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n <div class=\"termy\">\n \n \n```\n\n```diff\n@@ -1,43 +1,43 @@\n-# Í∏∞Îä•\n+# Í∏∞Îä• { #features }\n \n-## FastAPIÏùò Í∏∞Îä•\n+## FastAPIÏùò Í∏∞Îä• { #fastapi-features }\n \n **FastAPI**Îäî Îã§ÏùåÍ≥º Í∞ôÏùÄ Í∏∞Îä•ÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§:\n \n-### Í∞úÎ∞©Ìòï ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú\n+### Í∞úÎ∞©Ìòï ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú { #based-on-open-standards }\n \n-* <abbr title=\"ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎùºÏö∞Ìä∏Î°úÎèÑ ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">Í≤ΩÎ°ú</abbr><abbr title=\"POST, GET, PUT, DELETEÏôÄ Í∞ôÏùÄ HTTP Î©îÏÜåÎìúÎ°ú ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">ÏûëÎèô</abbr>, Îß§Í∞úÎ≥ÄÏàò, Î≥∏Î¨∏ ÏöîÏ≤≠, Î≥¥Ïïà Í∑∏ Ïô∏Ïùò ÏÑ†Ïñ∏ÏùÑ Ìè¨Ìï®Ìïú API ÏÉùÏÑ±ÏùÑ ÏúÑÌïú <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a>\n-* <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (OpenAPI ÏûêÏ≤¥Í∞Ä JSON SchemaÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ≥† ÏûàÏäµÎãàÎã§)Î•º ÏÇ¨Ïö©Ìïú ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î¨∏ÏÑúÌôî.\n-* Îã®ÏàúÌûà Îñ†Ïò¨Î†§ÏÑú ÎçßÎ∂ôÏù∏ Í∏∞Îä•Ïù¥ ÏïÑÎãôÎãàÎã§. ÏÑ∏Ïã¨Ìïú Í≤ÄÌÜ†Î•º Í±∞Ïπú ÌõÑ, Ïù¥Îü¨Ìïú ÌëúÏ§ÄÏùÑ Í∏∞Î∞òÏúºÎ°ú ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.\n-* Ïù¥Îäî ÎòêÌïú Îã§ÏñëÌïú Ïñ∏Ïñ¥Î°ú ÏûêÎèôÏ†ÅÏù∏ **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏΩîÎìú ÏÉùÏÑ±**ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å ÏßÄÏõêÌï©ÎãàÎã§.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a>: <abbr title=\"ÎòêÌïú Îã§ÏùåÏúºÎ°úÎèÑ Î∂àÎ¶ΩÎãàÎã§: ÏóîÎìúÌè¨Ïù∏Ìä∏, ÎùºÏö∞Ìä∏\">path</abbr> <abbr title=\"HTTP Î©îÏÜåÎìú(POST, GET, PUT, DELETE Îì±)Î°úÎèÑ ÏïåÎ†§Ï†∏ ÏûàÏäµÎãàÎã§\">operations</abbr>, Îß§Í∞úÎ≥ÄÏàò, ÏöîÏ≤≠ Î≥∏Î¨∏, Î≥¥Ïïà Îì±Ïùò ÏÑ†Ïñ∏ÏùÑ Ìè¨Ìï®ÌïòÏó¨ APIÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§.\n+* <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a>Î•º ÏÇ¨Ïö©Ìïú ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î™®Îç∏ Î¨∏ÏÑúÌôî(OpenAPI ÏûêÏ≤¥Í∞Ä JSON SchemaÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞ ÎïåÎ¨∏ÏûÖÎãàÎã§).\n+* Îã®ÏàúÌûà Îñ†Ïò¨Î†§ÏÑú ÎçßÎ∂ôÏù∏ Î†àÏù¥Ïñ¥Í∞Ä ÏïÑÎãàÎùº, ÏÑ∏Ïã¨Ìïú Í≤ÄÌÜ†Î•º Í±∞Ïπú Îí§ Ïù¥Îü¨Ìïú ÌëúÏ§ÄÏùÑ Ï§ëÏã¨ÏúºÎ°ú ÏÑ§Í≥ÑÎêòÏóàÏäµÎãàÎã§.\n+* Ïù¥Îäî ÎòêÌïú Îã§ÏñëÌïú Ïñ∏Ïñ¥Î°ú ÏûêÎèô **ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏΩîÎìú ÏÉùÏÑ±**ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ìï¥Ï§çÎãàÎã§.\n \n-### Î¨∏ÏÑú ÏûêÎèôÌôî\n+### Î¨∏ÏÑú ÏûêÎèôÌôî { #automatic-docs }\n \n-ÎåÄÌôîÌòï API Î¨∏ÏÑúÏôÄ Ïõπ ÌÉêÏÉâ Ïú†Ï†Ä Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌîÑÎ†àÏûÑÏõåÌÅ¨Í∞Ä OpenAPIÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞Ïóê, 2Í∞ÄÏßÄ ÏòµÏÖòÏù¥ Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Îì§Ïñ¥Í∞Ñ Ïó¨Îü¨ ÏòµÏÖòÏù¥ Ï°¥Ïû¨Ìï©ÎãàÎã§.\n+ÎåÄÌôîÌòï API Î¨∏ÏÑúÏôÄ ÌÉêÏÉâÏö© Ïõπ ÏÇ¨Ïö©Ïûê Ïù∏ÌÑ∞ÌéòÏù¥Ïä§Î•º Ï†úÍ≥µÌï©ÎãàÎã§. ÌîÑÎ†àÏûÑÏõåÌÅ¨Í∞Ä OpenAPIÎ•º Í∏∞Î∞òÏúºÎ°ú ÌïòÍ∏∞Ïóê Ïó¨Îü¨ ÏòµÏÖòÏù¥ ÏûàÏúºÎ©∞, Í∏∞Î≥∏ÏúºÎ°ú 2Í∞ÄÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§.\n \n-* ÎåÄÌôîÌòï ÌÉêÏÉâ <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>Î•º Ïù¥Ïö©Ìï¥, Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Î∞îÎ°ú Ïó¨Îü¨Î∂ÑÏùò APIÎ•º Ìò∏Ï∂úÌïòÍ±∞ÎÇò ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+* ÎåÄÌôîÌòï ÌÉêÏÉâÏù¥ Í∞ÄÎä•Ìïú <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a>Î°ú Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÅÏ†ë APIÎ•º Ìò∏Ï∂úÌïòÍ≥† ÌÖåÏä§Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n ![Swagger UI interaction](https://fastapi.tiangolo.com/img/index/index-03-swagger-02.png)\n \n-* <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>ÏùÑ Ïù¥Ïö©Ìï¥ API Î¨∏ÏÑúÌôîÎ•º ÎåÄÏ≤¥Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+* <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>ÏùÑ Ïù¥Ïö©Ìïú ÎåÄÏ≤¥ API Î¨∏ÏÑúÌôî.\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Í∑∏Ï†Ä ÌòÑÎåÄ ÌååÏù¥Ïç¨\n+### Í∑∏Ï†Ä ÌòÑÎåÄ ÌååÏù¥Ïç¨ { #just-modern-python }\n \n-(Pydantic ÎçïÎ∂ÑÏóê) FastAPIÎäî ÌëúÏ§Ä **ÌååÏù¥Ïç¨ 3.6 ÌÉÄÏûÖ** ÏÑ†Ïñ∏Ïóê Í∏∞Î∞òÌïòÍ≥† ÏûàÏäµÎãàÎã§. ÏÉàÎ°ú Î∞∞Ïö∏ Î¨∏Î≤ïÏù¥ ÏóÜÏäµÎãàÎã§. Í∑∏Ï†Ä ÌëúÏ§ÄÏ†ÅÏù∏ ÌòÑÎåÄ ÌååÏù¥Ïç¨ÏûÖÎãàÎã§.\n+( Pydantic ÎçïÎ∂ÑÏóê) Î™®Îì† Í≤ÉÏù¥ ÌëúÏ§Ä **Python ÌÉÄÏûÖ** ÏÑ†Ïñ∏ÏùÑ Í∏∞Î∞òÏúºÎ°ú Ìï©ÎãàÎã§. ÏÉàÎ°ú Î∞∞Ïö∏ Î¨∏Î≤ïÏù¥ ÏóÜÏäµÎãàÎã§. Í∑∏Ï†Ä ÌëúÏ§ÄÏ†ÅÏù∏ ÌòÑÎåÄ ÌååÏù¥Ïç¨ÏûÖÎãàÎã§.\n \n-ÎßåÏïΩ Ïó¨Îü¨Î∂ÑÏù¥ ÌååÏù¥Ïç¨ ÌÉÄÏûÖÏùÑ Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©ÌïòÎäîÏßÄÏóê ÎåÄÌïú 2Î∂Ñ Ï†ïÎèÑÏùò Î≥µÏäµÏù¥ ÌïÑÏöîÌïòÎã§Î©¥ (ÎπÑÎ°ù Ïó¨Îü¨Î∂ÑÏù¥ FastAPIÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎäîÎã§ ÌïòÎçîÎùºÎèÑ), Îã§ÏùåÏùò ÏßßÏùÄ ÏûêÏäµÏÑúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî: [ÌååÏù¥Ïç¨ ÌÉÄÏûÖ](python-types.md){.internal-link target=\\_blank}.\n+Python ÌÉÄÏûÖÏùÑ Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©ÌïòÎäîÏßÄ 2Î∂Ñ Ï†ïÎèÑ Î≥µÏäµÏù¥ ÌïÑÏöîÌïòÎã§Î©¥(FastAPIÎ•º ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÎçîÎùºÎèÑ), Îã§ÏùåÏùò ÏßßÏùÄ ÏûêÏäµÏÑúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî: [Python ÌÉÄÏûÖ](python-types.md){.internal-link target=_blank}.\n \n-Ïó¨Îü¨Î∂ÑÏùÄ ÌÉÄÏûÖÏùÑ Ïù¥Ïö©Ìïú ÌëúÏ§Ä ÌååÏù¥Ïç¨ÏùÑ Îã§ÏùåÍ≥º Í∞ôÏù¥ Ï†ÅÏùÑ Ïàò ÏûàÏäµÎãàÎã§:\n+Ïó¨Îü¨Î∂ÑÏùÄ ÌÉÄÏûÖÏù¥ ÏûàÎäî ÌëúÏ§Ä PythonÏùÑ Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏûëÏÑ±Ìï©ÎãàÎã§:\n \n \n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# FastAPI ÏßÄÏõê - ÎèÑÏõÄ Î∞õÍ∏∞\n+# FastAPI ÏßÄÏõê - ÎèÑÏõÄ Î∞õÍ∏∞ { #help-fastapi-get-help }\n \n **FastAPI** Í∞Ä ÎßàÏùåÏóê ÎìúÏãúÎÇòÏöî?\n \n@@ -10,259 +10,246 @@ FastAPI, Îã§Î•∏ ÏÇ¨Ïö©Ïûê, Í∞úÎ∞úÏûêÎ•º ÏùëÏõêÌïòÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?\n \n ÎòêÌïú ÎèÑÏõÄÏùÑ Î∞õÏùÑ Ïàò ÏûàÎäî Î∞©Î≤ïÎèÑ Î™á Í∞ÄÏßÄ ÏûàÏäµÎãàÎã§.\n \n-## Îâ¥Ïä§Î†àÌÑ∞ Íµ¨ÎèÖ\n+## Îâ¥Ïä§Î†àÌÑ∞ Íµ¨ÎèÖ { #subscribe-to-the-newsletter }\n \n-[**FastAPI and friends** Îâ¥Ïä§Î†àÌÑ∞](newsletter.md){.internal-link target=\\_blank}Î•º Íµ¨ÎèÖÌïòÏó¨ ÏµúÏã† Ï†ïÎ≥¥Î•º Ïú†ÏßÄÌï† Ïàò ÏûàÏäµÎãàÎã§:\n+(ÏûêÏ£º Î∞úÏÜ°ÎêòÏßÄ ÏïäÎäî) [**FastAPI and friends** Îâ¥Ïä§Î†àÌÑ∞](newsletter.md){.internal-link target=_blank}Î•º Íµ¨ÎèÖÌïòÏó¨ ÏµúÏã† Ï†ïÎ≥¥Î•º Ïú†ÏßÄÌï† Ïàò ÏûàÏäµÎãàÎã§:\n \n * FastAPI and friendsÏóê ÎåÄÌïú Îâ¥Ïä§ üöÄ\n * Í∞ÄÏù¥Îìú üìù\n * Í∏∞Îä• ‚ú®\n * ÌöçÍ∏∞Ï†ÅÏù∏ Î≥ÄÌôî üö®\n * ÌåÅÍ≥º ÏöîÎ†π ‚úÖ\n \n-## Ìä∏ÏúÑÌÑ∞ÏóêÏÑú FastAPI ÌåîÎ°úÏö∞ÌïòÍ∏∞\n+## X(Twitter)ÏóêÏÑú FastAPI ÌåîÎ°úÏö∞ÌïòÍ∏∞ { #follow-fastapi-on-x-twitter }\n \n <a href=\"https://x.com/fastapi\" class=\"external-link\" target=\"_blank\">**X (Twitter)**Ïùò @fastapiÎ•º ÌåîÎ°úÏö∞</a>ÌïòÏó¨ **FastAPI** Ïóê ÎåÄÌïú ÏµúÏã† Îâ¥Ïä§Î•º ÏñªÏùÑ Ïàò ÏûàÏäµÎãàÎã§. üê¶\n \n-## Star **FastAPI** in GitH", "output": "Code Review for: üåê Update translations for ko (update outdated, found by fixer tool)\n\nüìù **docs/ko/docs/async.md**: @hard-coders, thanks!\r\nWould you like to open PR to update `llm-prompt.md`?\r\nI would then re-translate these documents using the updated prompt\r\n\nüìù **docs/ko/docs/async.md**: Re-translated pages with updated prompt. Commit https://github.com/fastapi/fastapi/pull/14738/commits/d65e8a4aaa8369d52c29b913b0528e8c54180dd6\n\nüìù **docs/ko/docs/fastapi-cli.md**: I think the original terms 'Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò' (Application) and 'Î™ÖÎ†πÏñ¥' (Command line/Instruction) are more accurate and natural than 'Ïï±' (App) or 'Î™ÖÎ†π' (Command).\r\n\r\nIn the Korean context, 'Ïï±' (App) is strongly associated with mobile applications. For a CLI tool, 'Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò' sounds more appropriate. Also, 'Î™ÖÎ†πÏñ¥' is the more standard term used to describe instructions typed into a terminal.\n\n", "source": "pr", "type": "code_review", "pr_number": 388}
{"instruction": "Review this code change in `docs/ko/docs/async.md`", "input": "```diff\n@@ -40,255 +40,287 @@ def results():\n \n ---\n \n-ÎßåÏïΩ ÎãπÏã†Ïùò ÏùëÏö©ÌîÑÎ°úÍ∑∏Îû®Ïù¥ (Ïñ¥Ïß∏ÏÑúÏù∏ÏßÄ) Îã§Î•∏ Î¨¥ÏóáÍ≥º ÏùòÏÇ¨ÏÜåÌÜµÌïòÍ≥† Í∑∏Í≤ÉÏù¥ ÏùëÎãµÌïòÍ∏∞Î•º Í∏∞Îã§Î¶¥ ÌïÑÏöîÍ∞Ä ÏóÜÎã§Î©¥ `async def`Î•º ÏÇ¨Ïö©ÌïòÏã≠ÏãúÏò§.\n+ÎßåÏïΩ ÎãπÏã†Ïùò Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏù¥ (Ïñ¥Ïß∏ÏÑúÏù∏ÏßÄ) Îã§Î•∏ Ïñ¥Îñ§ Í≤ÉÍ≥ºÎèÑ ÌÜµÏã†ÌïòÍ≥† Í∑∏ ÏùëÎãµÏùÑ Í∏∞Îã§Î¶¥ ÌïÑÏöîÍ∞Ä ÏóÜÎã§Î©¥, ÎÇ¥Î∂ÄÏóêÏÑú `await`Î•º ÏÇ¨Ïö©Ìï† ÌïÑÏöîÍ∞Ä ÏóÜÎçîÎùºÎèÑ `async def`Î•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.\n\n```", "output": "@hard-coders, thanks!\r\nWould you like to open PR to update `llm-prompt.md`?\r\nI would then re-translate these documents using the updated prompt\r", "source": "pr_review", "type": "inline_review", "pr_number": 388}
{"instruction": "Review this code change in `docs/ko/docs/fastapi-cli.md`", "input": "```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI**Îäî FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÍ≥†, ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏùÑ ÏàòÌñâÌï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n+**FastAPI CLI**Îäî FastAPI Ïï±ÏùÑ ÏÑúÎπôÌïòÍ≥†, FastAPI ÌîÑÎ°úÏ†ùÌä∏Î•º Í¥ÄÎ¶¨ÌïòÎäî Îì± Îã§ÏñëÌïú ÏûëÏóÖÏóê ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Ïª§Îß®Îìú ÎùºÏù∏ ÌîÑÎ°úÍ∑∏Îû®ÏûÖÎãàÎã§.\n \n-FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå (Ïòà: `pip install \"fastapi[standard]\"` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Í≤ΩÏö∞), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®Îê©ÎãàÎã§. Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî `fastapi` Î™ÖÎ†πÏñ¥Î•º Ï†úÍ≥µÌï©ÎãàÎã§.\n+FastAPIÎ•º ÏÑ§ÏπòÌï† Îïå(Ïòà: `pip install \"fastapi[standard]\"`), `fastapi-cli`ÎùºÎäî Ìå®ÌÇ§ÏßÄÍ∞Ä Ìè¨Ìï®ÎêòÎ©∞, Ïù¥ Ìå®ÌÇ§ÏßÄÎäî ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú `fastapi` Î™ÖÎ†πÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§.\n \n-Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ `fastapi dev` Î™ÖÎ†πÏñ¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n+Í∞úÎ∞úÏö©ÏúºÎ°ú FastAPI Ïï±ÏùÑ Ïã§ÌñâÌïòÎ†§Î©¥ `fastapi dev` Î™ÖÎ†πÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n\n```", "output": "I think the original terms 'Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò' (Application) and 'Î™ÖÎ†πÏñ¥' (Command line/Instruction) are more accurate and natural than 'Ïï±' (App) or 'Î™ÖÎ†π' (Command).\r\n\r\nIn the Korean context, 'Ïï±' (App) is strongly associated with mobile applications. For a CLI tool, 'Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò' sounds more appropriate. Also, 'Î™ÖÎ†πÏñ¥' is the more standard term used to describe instructions typed into a terminal.", "source": "pr_review", "type": "inline_review", "pr_number": 388}
{"instruction": "Review the following code changes: üåê Update `llm-prompt.md` for Korean language", "input": "```diff\n@@ -33,6 +33,9 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): ÏùëÎãµ\n - path operation: Í≤ΩÎ°ú Ï≤òÎ¶¨\n - path operation function: Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò\n+- app: Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò\n+- command: Î™ÖÎ†πÏñ¥\n+- burger: ÌñÑÎ≤ÑÍ±∞ (NOT Î≤ÑÍ±∞)\n \n ### `///` admonitions\n \n\n```\n\n```diff\n@@ -33,6 +33,7 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): ÏùëÎãµ\n - path operation: Í≤ΩÎ°ú Ï≤òÎ¶¨\n - path operation function: Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò\n+- burger: ÌñÑÎ≤ÑÍ±∞\n\n```\n\n```diff\n@@ -33,6 +33,7 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): ÏùëÎãµ\n - path operation: Í≤ΩÎ°ú Ï≤òÎ¶¨\n - path operation function: Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò\n+- burger: ÌñÑÎ≤ÑÍ±∞\n\n```", "output": "Code Review for: üåê Update `llm-prompt.md` for Korean language\n\nüìù **docs/ko/llm-prompt.md**: ```suggestion\r\n- burger: ÌñÑÎ≤ÑÍ±∞ (NOT Î≤ÑÍ±∞)\r\n```\r\nI just re-translated the `async.md` page with updated prompt and it didn't change translation until I changed it to explicitly ban `Î≤ÑÍ±∞`\n\nüìù **docs/ko/llm-prompt.md**: Good point. I'll apply your suggestion. Thanks for the feedback:)\n\n", "source": "pr", "type": "code_review", "pr_number": 387}
{"instruction": "Review this code change in `docs/ko/llm-prompt.md`", "input": "```diff\n@@ -33,6 +33,7 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): ÏùëÎãµ\n - path operation: Í≤ΩÎ°ú Ï≤òÎ¶¨\n - path operation function: Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò\n+- burger: ÌñÑÎ≤ÑÍ±∞\n\n```", "output": "```suggestion\r\n- burger: ÌñÑÎ≤ÑÍ±∞ (NOT Î≤ÑÍ±∞)\r\n```\r\nI just re-translated the `async.md` page with updated prompt and it didn't change translation until I changed it to explicitly ban `Î≤ÑÍ±∞`", "source": "pr_review", "type": "inline_review", "pr_number": 387}
{"instruction": "Review the following code changes: demo: logic change", "input": "```diff\n@@ -17,7 +17,7 @@\n     Any,\n     Callable,\n     Optional,\n-    Union,\n+    Union, Dict, List, Set, Type,\n )\n \n from annotated_doc import Doc\n@@ -484,47 +484,50 @@ def matches(self, scope: Scope) -> tuple[Match, Scope]:\n \n class APIRoute(routing.Route):\n     def __init__(\n-        self,\n-        path: str,\n-        endpoint: Callable[..., Any],\n-        *,\n-        response_model: Any = Default(None),\n-        status_code: Optional[int] = None,\n-        tags: Optional[list[Union[str, Enum]]] = None,\n-        dependencies: Optional[Sequence[params.Depends]] = None,\n-        summary: Optional[str] = None,\n-        description: Optional[str] = None,\n-        response_description: str = \"Successful Response\",\n-        responses: Optional[dict[Union[int, str], dict[str, Any]]] = None,\n-        deprecated: Optional[bool] = None,\n-        name: Optional[str] = None,\n-        methods: Optional[Union[set[str], list[str]]] = None,\n-        operation_id: Optional[str] = None,\n-        response_model_include: Optional[IncEx] = None,\n-        response_model_exclude: Optional[IncEx] = None,\n-        response_model_by_alias: bool = True,\n-        response_model_exclude_unset: bool = False,\n-        response_model_exclude_defaults: bool = False,\n-        response_model_exclude_none: bool = False,\n-        include_in_schema: bool = True,\n-        response_class: Union[type[Response], DefaultPlaceholder] = Default(\n-            JSONResponse\n-        ),\n-        dependency_overrides_provider: Optional[Any] = None,\n-        callbacks: Optional[list[BaseRoute]] = None,\n-        openapi_extra: Optional[dict[str, Any]] = None,\n-        generate_unique_id_function: Union[\n-            Callable[[\"APIRoute\"], str], DefaultPlaceholder\n-        ] = Default(generate_unique_id),\n+            self,\n+            path: str,\n+            endpoint: Callable[..., Any],\n+            *,\n+            response_model: Any = Default(None),\n+            status_code: Optional[int] = None,\n+            tags: Optional[List[Union[str, Enum]]] = None,\n+            dependencies: Optional[Sequence[params.Depends]] = None,\n+            summary: Optional[str] = None,\n+            description: Optional[str] = None,\n+            response_description: str = \"Successful Response\",\n+            responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,\n+            deprecated: Optional[bool] = None,\n+            name: Optional[str] = None,\n+            methods: Optional[Union[Set[str], List[str]]] = None,\n+            operation_id: Optional[str] = None,\n+            response_model_include: Optional[IncEx] = None,\n+            response_model_exclude: Optional[IncEx] = None,\n+            response_model_by_alias: bool = True,\n+            response_model_exclude_unset: bool = False,\n+            response_model_exclude_defaults: bool = False,\n+            response_model_exclude_none: bool = False,\n+            include_in_schema: bool = True,\n+            response_class: Union[Type[Response], DefaultP\n\n```", "output": "Changes look good. This PR implements: demo: logic change", "source": "pr", "type": "code_review", "pr_number": 386}
{"instruction": "Fix the following bug: Fixed typos in documentation", "input": "### What does this PR do?\r\nFixes minor typos in documentation for clarity.\r\n\r\n### Related issue\r\nN/A\r\n\r\n### Checklist\r\n- [x] Documentation typo fix\r\n- [x] No code logic changes\r\n- [x] Better readability", "output": "```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n \n {* ../../docs_src/bigger_applications/app_an_py39/main.py hl[4:5] title[\"app/main.py\"] *}\n \n\n```\n\n```diff\n@@ -10,7 +10,7 @@ In the previous example, we were returning a `dict` from our dependency (\"depend\n \n But then we get a `dict` in the parameter `commons` of the *path operation function*.\n \n-And we know that editors can't provide a lot of support (like completion) for `dict`s, because they can't know their keys and value types.\n+And we know that editors can't provide a lot of support (like completion) for `dict`'s, because they can't know their keys and value types.\n \n We can do better...\n \n\n```\n\n```diff\n@@ -129,7 +129,7 @@ Here we use the `SessionDep` dependency (a `Session`) to add the new `Hero` to t\n \n ### Read Heroes { #read-heroes }\n \n-We can **read** `Hero`s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n+We can **read** `Hero`'s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n \n {* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[48:55] hl[51:52,54] *}\n \n\n```\n\n```diff\n@@ -8,13 +8,13 @@ class User(BaseModel):\n     id: int\n     name: str = \"John Doe\"\n     signup_ts: Union[datetime, None] = None\n-    friends: list[int] = []\n+    friends: list[int] = []  # List of Integer\n \n \n external_data = {\n     \"id\": \"123\",\n     \"signup_ts\": \"2017-06-01 12:22\",\n-    \"friends\": [1, \"2\", b\"3\"],\n+    \"friends\": [1, 2, 3],\n }\n user = User(**external_data)\n print(user)\n\n```\n\n```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 385}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n \n {* ../../docs_src/bigger_applications/app_an_py39/main.py hl[4:5] title[\"app/main.py\"] *}\n \n\n```\n\n```diff\n@@ -10,7 +10,7 @@ In the previous example, we were returning a `dict` from our dependency (\"depend\n \n But then we get a `dict` in the parameter `commons` of the *path operation function*.\n \n-And we know that editors can't provide a lot of support (like completion) for `dict`s, because they can't know their keys and value types.\n+And we know that editors can't provide a lot of support (like completion) for `dict`'s, because they can't know their keys and value types.\n \n We can do better...\n \n\n```\n\n```diff\n@@ -129,7 +129,7 @@ Here we use the `SessionDep` dependency (a `Session`) to add the new `Hero` to t\n \n ### Read Heroes { #read-heroes }\n \n-We can **read** `Hero`s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n+We can **read** `Hero`'s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n \n {* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[48:55] hl[51:52,54] *}\n \n\n```\n\n```diff\n@@ -8,13 +8,13 @@ class User(BaseModel):\n     id: int\n     name: str = \"John Doe\"\n     signup_ts: Union[datetime, None] = None\n-    friends: list[int] = []\n+    friends: list[int] = []  # List of Integer\n \n \n external_data = {\n     \"id\": \"123\",\n     \"signup_ts\": \"2017-06-01 12:22\",\n-    \"friends\": [1, \"2\", b\"3\"],\n+    \"friends\": [1, 2, 3],\n }\n user = User(**external_data)\n print(user)\n\n```\n\n```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n\n```", "output": "Bug: Fixed typos in documentation\n\n### What does this PR do?\r\nFixes minor typos in documentation for clarity.\r\n\r\n### Related issue\r\nN/A\r\n\r\n### Checklist\r\n- [x] Documentation typo fix\r\n- [x] No code logic changes\r\n- [x] Better readability", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 385}
{"instruction": "Review the following code changes: Fixed typos in documentation", "input": "```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n \n {* ../../docs_src/bigger_applications/app_an_py39/main.py hl[4:5] title[\"app/main.py\"] *}\n \n\n```\n\n```diff\n@@ -10,7 +10,7 @@ In the previous example, we were returning a `dict` from our dependency (\"depend\n \n But then we get a `dict` in the parameter `commons` of the *path operation function*.\n \n-And we know that editors can't provide a lot of support (like completion) for `dict`s, because they can't know their keys and value types.\n+And we know that editors can't provide a lot of support (like completion) for `dict`'s, because they can't know their keys and value types.\n \n We can do better...\n \n\n```\n\n```diff\n@@ -129,7 +129,7 @@ Here we use the `SessionDep` dependency (a `Session`) to add the new `Hero` to t\n \n ### Read Heroes { #read-heroes }\n \n-We can **read** `Hero`s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n+We can **read** `Hero`'s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n \n {* ../../docs_src/sql_databases/tutorial001_an_py310.py ln[48:55] hl[51:52,54] *}\n \n\n```\n\n```diff\n@@ -8,13 +8,13 @@ class User(BaseModel):\n     id: int\n     name: str = \"John Doe\"\n     signup_ts: Union[datetime, None] = None\n-    friends: list[int] = []\n+    friends: list[int] = []  # List of Integer\n \n \n external_data = {\n     \"id\": \"123\",\n     \"signup_ts\": \"2017-06-01 12:22\",\n-    \"friends\": [1, \"2\", b\"3\"],\n+    \"friends\": [1, 2, 3],\n }\n user = User(**external_data)\n print(user)\n\n```\n\n```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n\n```", "output": "Code Review for: Fixed typos in documentation\n\nüìù **docs/en/docs/tutorial/bigger-applications.md**: `APIRouter`s is plural form of `APIRouter`, not possession here. So, adding `'` is incorrect\n\nüìù **docs/en/docs/tutorial/dependencies/classes-as-dependencies.md**: This is also plural form, not possession\n\nüìù **docs/en/docs/tutorial/sql-databases.md**: This is also plural form, not possession\n\nüìù **docs_src/python_types/tutorial011_py39.py**: That was intentionally. Please, read docs around this code example\n\n", "source": "pr", "type": "code_review", "pr_number": 385}
{"instruction": "Review this code change in `docs/en/docs/tutorial/bigger-applications.md`", "input": "```diff\n@@ -309,7 +309,7 @@ And we can even declare [global dependencies](dependencies/global-dependencies.m\n \n ### Import the `APIRouter` { #import-the-apirouter }\n \n-Now we import the other submodules that have `APIRouter`s:\n+Now we import the other submodules that have `APIRouter`'s:\n\n```", "output": "`APIRouter`s is plural form of `APIRouter`, not possession here. So, adding `'` is incorrect", "source": "pr_review", "type": "inline_review", "pr_number": 385}
{"instruction": "Review this code change in `docs/en/docs/tutorial/dependencies/classes-as-dependencies.md`", "input": "```diff\n@@ -10,7 +10,7 @@ In the previous example, we were returning a `dict` from our dependency (\"depend\n \n But then we get a `dict` in the parameter `commons` of the *path operation function*.\n \n-And we know that editors can't provide a lot of support (like completion) for `dict`s, because they can't know their keys and value types.\n+And we know that editors can't provide a lot of support (like completion) for `dict`'s, because they can't know their keys and value types.\n\n```", "output": "This is also plural form, not possession", "source": "pr_review", "type": "inline_review", "pr_number": 385}
{"instruction": "Review this code change in `docs/en/docs/tutorial/sql-databases.md`", "input": "```diff\n@@ -129,7 +129,7 @@ Here we use the `SessionDep` dependency (a `Session`) to add the new `Hero` to t\n \n ### Read Heroes { #read-heroes }\n \n-We can **read** `Hero`s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n+We can **read** `Hero`'s from the database using a `select()`. We can include a `limit` and `offset` to paginate the results.\n\n```", "output": "This is also plural form, not possession", "source": "pr_review", "type": "inline_review", "pr_number": 385}
{"instruction": "Review this code change in `docs_src/python_types/tutorial011_py39.py`", "input": "```diff\n@@ -8,13 +8,13 @@ class User(BaseModel):\n     id: int\n     name: str = \"John Doe\"\n     signup_ts: Union[datetime, None] = None\n-    friends: list[int] = []\n+    friends: list[int] = []  # List of Integer\n \n \n external_data = {\n     \"id\": \"123\",\n     \"signup_ts\": \"2017-06-01 12:22\",\n-    \"friends\": [1, \"2\", b\"3\"],\n+    \"friends\": [1, 2, 3],\n\n```", "output": "That was intentionally. Please, read docs around this code example", "source": "pr_review", "type": "inline_review", "pr_number": 385}
{"instruction": "Review the following code changes: Migrate deprecated on_event to lifespan API  and cleanup Pydantic v1 deprecations", "input": "```diff\n@@ -1,15 +1,19 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n-app = FastAPI()\n-\n items = {}\n \n \n-@app.on_event(\"startup\")\n-async def startup_event():\n+@asynccontextmanager\n+async def lifespan(app):\n     items[\"foo\"] = {\"name\": \"Fighters\"}\n     items[\"bar\"] = {\"name\": \"Tenders\"}\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.get(\"/items/{item_id}\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from pydantic import BaseModel\n \n@@ -9,7 +11,12 @@ class Item(BaseModel):\n     tax: float | None = None\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app):\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/items/\")\n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+from contextlib import asynccontextmanager\n from typing import Union\n \n from fastapi import FastAPI\n@@ -11,7 +12,12 @@ class Item(BaseModel):\n     tax: Union[float, None] = None\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app):\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/items/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from pydantic import BaseModel\n \n@@ -9,7 +11,12 @@ class Item(BaseModel):\n     tax: float | None = None\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/items/\")\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+from collections.abc import AsyncGenerator\n+from contextlib import asynccontextmanager\n from typing import Union\n \n from fastapi import FastAPI\n@@ -11,7 +13,12 @@ class Item(BaseModel):\n     tax: Union[float, None] = None\n \n \n-app = FastAPI()\n+@asynccontextmanager\n+async def lifespan(app: FastAPI) -> AsyncGenerator[None, None]:\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.post(\"/items/\")\n\n```", "output": "Changes look good. This PR implements: Migrate deprecated on_event to lifespan API  and cleanup Pydantic v1 deprecations", "source": "pr", "type": "code_review", "pr_number": 384}
{"instruction": "Review the following code changes: ‚ú® Add dataclasses-based route parameters", "input": "```diff\n@@ -1,3 +1,4 @@\n+import dataclasses\n from collections.abc import Mapping\n from typing import (\n     Annotated,\n@@ -152,6 +153,7 @@ def __get_pydantic_core_schema__(\n         return with_info_plain_validator_function(cls._validate)\n \n \n+@dataclasses.dataclass(frozen=True)\n class DefaultPlaceholder:\n     \"\"\"\n     You shouldn't use this class directly.\n@@ -160,8 +162,7 @@ class DefaultPlaceholder:\n     if the overridden default value was truthy.\n     \"\"\"\n \n-    def __init__(self, value: Any):\n-        self.value = value\n+    value: Any\n \n     def __bool__(self) -> bool:\n         return bool(self.value)\n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import abc\n+import dataclasses\n import email.message\n import functools\n import inspect\n@@ -661,7 +663,93 @@ def matches(self, scope: Scope) -> tuple[Match, Scope]:\n         return match, child_scope\n \n \n-class APIRouter(routing.Router):\n+@dataclasses.dataclass(frozen=True)\n+class APIRouteSpec:\n+    \"\"\"Parameters of an APIRoute, excluding the endpoint\"\"\"\n+\n+    path: str\n+    route_class: Union[type[APIRoute], DefaultPlaceholder] = Default(APIRoute)\n+    response_model: Any = Default(None)\n+    status_code: Optional[int] = None\n+    tags: Optional[list[Union[str, Enum]]] = None\n+    dependencies: Optional[Sequence[params.Depends]] = None\n+    summary: Optional[str] = None\n+    description: Optional[str] = None\n+    response_description: str = \"Successful Response\"\n+    responses: Optional[dict[Union[int, str], dict[str, Any]]] = None\n+    deprecated: Optional[bool] = None\n+    name: Optional[str] = None\n+    methods: Optional[Union[set[str], list[str]]] = None\n+    operation_id: Optional[str] = None\n+    response_model_include: Optional[IncEx] = None\n+    response_model_exclude: Optional[IncEx] = None\n+    response_model_by_alias: bool = True\n+    response_model_exclude_unset: bool = False\n+    response_model_exclude_defaults: bool = False\n+    response_model_exclude_none: bool = False\n+    include_in_schema: bool = True\n+    response_class: Union[type[Response], DefaultPlaceholder] = Default(JSONResponse)\n+    dependency_overrides_provider: Optional[Any] = None\n+    callbacks: Optional[list[BaseRoute]] = None\n+    openapi_extra: Optional[dict[str, Any]] = None\n+    generate_unique_id_function: Union[\n+        Callable[[\"APIRoute\"], str], DefaultPlaceholder\n+    ] = Default(generate_unique_id)\n+\n+    def build(self, endpoint: Callable[..., Any]) -> APIRoute:\n+        route_class_actual = (\n+            self.route_class.value\n+            if isinstance(self.route_class, DefaultPlaceholder)\n+            else self.route_class\n+        )\n+        return route_class_actual(\n+            path=self.path,\n+            endpoint=endpoint,\n+            response_model=self.response_model,\n+            status_code=self.status_code,\n+            tags=self.tags,\n+            dependencies=self.dependencies,\n+            summary=self.summary,\n+            description=self.description,\n+            response_description=self.response_description,\n+            responses=self.responses,\n+            deprecated=self.deprecated,\n+            name=self.name,\n+            methods=self.methods,\n+            operation_id=self.operation_id,\n+            response_model_include=self.response_model_include,\n+            response_model_exclude=self.response_model_exclude,\n+            response_model_by_alias=self.response_model_by_alias,\n+            response_model_exclude_unset=self.response_model_exclude_unset,\n+            response_model_exclude_defaults=self.response_model_exclude_defaults,\n+            response_model_exclude_none=self.response_model_exclude\n\n```", "output": "Changes look good. This PR implements: ‚ú® Add dataclasses-based route parameters", "source": "pr", "type": "code_review", "pr_number": 383}
{"instruction": "Review the following code changes: Set cooldown in dependabot", "input": "```diff\n@@ -7,10 +7,14 @@ updates:\n       interval: \"daily\"\n     commit-message:\n       prefix: ‚¨Ü\n+    cooldown:\n+      default-days: 7\n   # Python\n   - package-ecosystem: \"uv\"\n     directory: \"/\"\n     schedule:\n       interval: \"monthly\"\n     commit-message:\n       prefix: ‚¨Ü\n+    cooldown:\n+      default-days: 7\n\n```", "output": "Changes look good. This PR implements: Set cooldown in dependabot", "source": "pr", "type": "code_review", "pr_number": 382}
{"instruction": "Review the following code changes: docs: Add streaming inference example using StreamingResponse", "input": "```diff\n@@ -0,0 +1,47 @@\n+\"\"\"\n+Streaming inference example using StreamingResponse.\n+\n+This pattern is useful for long-running workloads such as machine learning\n+or large language model inference, where returning partial results improves\n+latency and user experience.\n+\"\"\"\n+\n+import time\n+from collections.abc import Generator\n+\n+from fastapi import FastAPI\n+from fastapi.responses import StreamingResponse\n+\n+app = FastAPI()\n+\n+\n+def fake_model_inference(prompt: str) -> Generator[str, None, None]:\n+    \"\"\"\n+    Simulates token-by-token inference.\n+\n+    In a real application, this could wrap a machine learning model that\n+    yields partial outputs as they are generated.\n+    \"\"\"\n+    try:\n+        for i in range(10):\n+            # Simulate computation time (e.g. model forward pass)\n+            time.sleep(0.2)\n+            yield f\"token_{i} for prompt='{prompt}'\\n\"\n+    except GeneratorExit:\n+        # This is triggered when the client disconnects early.\n+        # Cleanup logic for model inference can be placed here.\n+        print(\"Client disconnected, stopping inference\")\n+\n+\n+@app.get(\"/stream\")\n+def stream(prompt: str) -> StreamingResponse:\n+    \"\"\"\n+    Stream inference results incrementally to the client.\n+\n+    This endpoint returns partial results as they become available instead\n+    of waiting for the full inference to complete, making the user experience better.\n+    \"\"\"\n+    return StreamingResponse(\n+        fake_model_inference(prompt),\n+        media_type=\"text/plain\",\n+    )\n\n```", "output": "Changes look good. This PR implements: docs: Add streaming inference example using StreamingResponse", "source": "pr", "type": "code_review", "pr_number": 381}
{"instruction": "Review the following code changes: make type annotation for HTTPException.detail be Any", "input": "```diff\n@@ -42,6 +42,8 @@ async def read_item(item_id: str):\n     \n```", "output": "Changes look good. This PR implements: make type annotation for HTTPException.detail be Any", "source": "pr", "type": "code_review", "pr_number": 380}
{"instruction": "Review the following code changes: docs: clarify dynamic usage of response status codes", "input": "```diff\n@@ -29,3 +29,15 @@ And if you declared a `response_model`, it will still be used to filter and conv\n **FastAPI** will use that *temporal* response to extract the status code (also cookies and headers), and will put them in the final response that contains the value you returned, filtered by any `response_model`.\n \n You can also declare the `Response` parameter in dependencies, and set the status code in them. But keep in mind that the last one to be set will win.\n+\n+## Notes { #notes }\n+\n+The `status_code` can be set dynamically depending on your application logic.\n+\n+For example, you might return:\n+\n+- `200 OK` when the data already exists\n+- `201 Created` when new data is created\n+- `204 No Content` when no response body is needed\n+\n+This allows reusing the same path operation while still returning accurate HTTP status codes.\n\n```", "output": "Changes look good. This PR implements: docs: clarify dynamic usage of response status codes", "source": "pr", "type": "code_review", "pr_number": 379}
{"instruction": "Fix the following bug: üìù Fix minor typos in release notes", "input": "This PR fixes minor typos in the release notes.\r\n\r\n```diff\r\n- Remove dangling extra condiitonal no longer needed.\r\n+ Remove dangling extra conditional no longer needed.\r\n\r\n- Upate docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`.\r\n+ Update docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`.\r\n\r\n- Add Japanese tranlsation for `docs/ja/docs/tutorial/schema-extra-example.md`.\r\n+ Add Japanese translation for `docs/ja/docs/tutorial/schema-extra-example.md`.\r\n\r\n- Fix empty reponse body when default `status_code` is empty but the a `Response` parameter with `response.status_code` is set.\r\n+ Fix empty response body when default `status_code` is empty but the a `Response` parameter with `response.status_code` is set.\r\n```", "output": "```diff\n@@ -283,7 +283,7 @@ hide:\n \n ### Refactors\n \n-* üî• Remove dangling extra condiitonal no longer needed. PR [#14435](https://github.com/fastapi/fastapi/pull/14435) by [@tiangolo](https://github.com/tiangolo).\n+* üî• Remove dangling extra conditional no longer needed. PR [#14435](https://github.com/fastapi/fastapi/pull/14435) by [@tiangolo](https://github.com/tiangolo).\n * ‚ôªÔ∏è Refactor internals, update `is_coroutine` check to reuse internal supported variants (unwrap, check class). PR [#14434](https://github.com/fastapi/fastapi/pull/14434) by [@tiangolo](https://github.com/tiangolo).\n \n ### Translations\n@@ -418,7 +418,7 @@ hide:\n \n ### Docs\n \n-* üìù Upate docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`. PR [#14287](https://github.com/fastapi/fastapi/pull/14287) by [@tiangolo](https://github.com/tiangolo).\n+* üìù Update docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`. PR [#14287](https://github.com/fastapi/fastapi/pull/14287) by [@tiangolo](https://github.com/tiangolo).\n \n ### Internal\n \n@@ -2646,7 +2646,7 @@ Read more in the [advisory: Content-Type Header ReDoS](https://github.com/tiango\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/handling-errors.md`. PR [#1953](https://github.com/tiangolo/fastapi/pull/1953) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/response-status-code.md`. PR [#1942](https://github.com/tiangolo/fastapi/pull/1942) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/extra-models.md`. PR [#1941](https://github.com/tiangolo/fastapi/pull/1941) by [@SwftAlpc](https://github.com/SwftAlpc).\n-* üåê Add Japanese tranlsation for `docs/ja/docs/tutorial/schema-extra-example.md`. PR [#1931](https://github.com/tiangolo/fastapi/pull/1931) by [@SwftAlpc](https://github.com/SwftAlpc).\n+* üåê Add Japanese translation for `docs/ja/docs/tutorial/schema-extra-example.md`. PR [#1931](https://github.com/tiangolo/fastapi/pull/1931) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/body-nested-models.md`. PR [#1930](https://github.com/tiangolo/fastapi/pull/1930) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/body-fields.md`. PR [#1923](https://github.com/tiangolo/fastapi/pull/1923) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add German translation for `docs/de/docs/tutorial/index.md`. PR [#9502](https://github.com/tiangolo/fastapi/pull/9502) by [@fhabers21](https://github.com/fhabers21).\n@@ -4022,7 +4022,7 @@ You hopefully updated to a supported version of Python a while ago. If you haven\n ### Fixes\n \n * üêõ Fix `RuntimeError` raised when `HTTPException` has a status code with no content. PR [#5365](https://github.com/tiangolo/fastapi/pull/5365) by [@iudeen](https://github.com/iudeen).\n-* üêõ Fix empty reponse body when default `status_code` is empty but \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 378}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -283,7 +283,7 @@ hide:\n \n ### Refactors\n \n-* üî• Remove dangling extra condiitonal no longer needed. PR [#14435](https://github.com/fastapi/fastapi/pull/14435) by [@tiangolo](https://github.com/tiangolo).\n+* üî• Remove dangling extra conditional no longer needed. PR [#14435](https://github.com/fastapi/fastapi/pull/14435) by [@tiangolo](https://github.com/tiangolo).\n * ‚ôªÔ∏è Refactor internals, update `is_coroutine` check to reuse internal supported variants (unwrap, check class). PR [#14434](https://github.com/fastapi/fastapi/pull/14434) by [@tiangolo](https://github.com/tiangolo).\n \n ### Translations\n@@ -418,7 +418,7 @@ hide:\n \n ### Docs\n \n-* üìù Upate docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`. PR [#14287](https://github.com/fastapi/fastapi/pull/14287) by [@tiangolo](https://github.com/tiangolo).\n+* üìù Update docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`. PR [#14287](https://github.com/fastapi/fastapi/pull/14287) by [@tiangolo](https://github.com/tiangolo).\n \n ### Internal\n \n@@ -2646,7 +2646,7 @@ Read more in the [advisory: Content-Type Header ReDoS](https://github.com/tiango\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/handling-errors.md`. PR [#1953](https://github.com/tiangolo/fastapi/pull/1953) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/response-status-code.md`. PR [#1942](https://github.com/tiangolo/fastapi/pull/1942) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/extra-models.md`. PR [#1941](https://github.com/tiangolo/fastapi/pull/1941) by [@SwftAlpc](https://github.com/SwftAlpc).\n-* üåê Add Japanese tranlsation for `docs/ja/docs/tutorial/schema-extra-example.md`. PR [#1931](https://github.com/tiangolo/fastapi/pull/1931) by [@SwftAlpc](https://github.com/SwftAlpc).\n+* üåê Add Japanese translation for `docs/ja/docs/tutorial/schema-extra-example.md`. PR [#1931](https://github.com/tiangolo/fastapi/pull/1931) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/body-nested-models.md`. PR [#1930](https://github.com/tiangolo/fastapi/pull/1930) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/body-fields.md`. PR [#1923](https://github.com/tiangolo/fastapi/pull/1923) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add German translation for `docs/de/docs/tutorial/index.md`. PR [#9502](https://github.com/tiangolo/fastapi/pull/9502) by [@fhabers21](https://github.com/fhabers21).\n@@ -4022,7 +4022,7 @@ You hopefully updated to a supported version of Python a while ago. If you haven\n ### Fixes\n \n * üêõ Fix `RuntimeError` raised when `HTTPException` has a status code with no content. PR [#5365](https://github.com/tiangolo/fastapi/pull/5365) by [@iudeen](https://github.com/iudeen).\n-* üêõ Fix empty reponse body when default `status_code` is empty but \n\n```", "output": "Bug: üìù Fix minor typos in release notes\n\nThis PR fixes minor typos in the release notes.\r\n\r\n```diff\r\n- Remove dangling extra condiitonal no longer needed.\r\n+ Remove dangling extra conditional no longer needed.\r\n\r\n- Upate docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`.\r\n+ Update docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`.\r\n\r\n- Add Japanese tranlsation for `docs/ja/docs/tutorial/schema-extra-example.md`.\r\n+ Add Japanese translation for `docs/ja/docs/tutorial/schema-extra-example.md`.\r\n\r\n- Fix empty reponse body when default `status_code` is empty but the a `Response` parameter with `response.status_code` is set.\r\n+ Fix empty response body when default `status_code` is empty but the a `Response` parameter with `response.status_code` is set.\r\n```", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 378}
{"instruction": "Review the following code changes: üìù Fix minor typos in release notes", "input": "```diff\n@@ -283,7 +283,7 @@ hide:\n \n ### Refactors\n \n-* üî• Remove dangling extra condiitonal no longer needed. PR [#14435](https://github.com/fastapi/fastapi/pull/14435) by [@tiangolo](https://github.com/tiangolo).\n+* üî• Remove dangling extra conditional no longer needed. PR [#14435](https://github.com/fastapi/fastapi/pull/14435) by [@tiangolo](https://github.com/tiangolo).\n * ‚ôªÔ∏è Refactor internals, update `is_coroutine` check to reuse internal supported variants (unwrap, check class). PR [#14434](https://github.com/fastapi/fastapi/pull/14434) by [@tiangolo](https://github.com/tiangolo).\n \n ### Translations\n@@ -418,7 +418,7 @@ hide:\n \n ### Docs\n \n-* üìù Upate docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`. PR [#14287](https://github.com/fastapi/fastapi/pull/14287) by [@tiangolo](https://github.com/tiangolo).\n+* üìù Update docs for advanced dependencies with `yield`, noting the changes in 0.121.0, adding `scope`. PR [#14287](https://github.com/fastapi/fastapi/pull/14287) by [@tiangolo](https://github.com/tiangolo).\n \n ### Internal\n \n@@ -2646,7 +2646,7 @@ Read more in the [advisory: Content-Type Header ReDoS](https://github.com/tiango\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/handling-errors.md`. PR [#1953](https://github.com/tiangolo/fastapi/pull/1953) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/response-status-code.md`. PR [#1942](https://github.com/tiangolo/fastapi/pull/1942) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/extra-models.md`. PR [#1941](https://github.com/tiangolo/fastapi/pull/1941) by [@SwftAlpc](https://github.com/SwftAlpc).\n-* üåê Add Japanese tranlsation for `docs/ja/docs/tutorial/schema-extra-example.md`. PR [#1931](https://github.com/tiangolo/fastapi/pull/1931) by [@SwftAlpc](https://github.com/SwftAlpc).\n+* üåê Add Japanese translation for `docs/ja/docs/tutorial/schema-extra-example.md`. PR [#1931](https://github.com/tiangolo/fastapi/pull/1931) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/body-nested-models.md`. PR [#1930](https://github.com/tiangolo/fastapi/pull/1930) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add Japanese translation for `docs/ja/docs/tutorial/body-fields.md`. PR [#1923](https://github.com/tiangolo/fastapi/pull/1923) by [@SwftAlpc](https://github.com/SwftAlpc).\n * üåê Add German translation for `docs/de/docs/tutorial/index.md`. PR [#9502](https://github.com/tiangolo/fastapi/pull/9502) by [@fhabers21](https://github.com/fhabers21).\n@@ -4022,7 +4022,7 @@ You hopefully updated to a supported version of Python a while ago. If you haven\n ### Fixes\n \n * üêõ Fix `RuntimeError` raised when `HTTPException` has a status code with no content. PR [#5365](https://github.com/tiangolo/fastapi/pull/5365) by [@iudeen](https://github.com/iudeen).\n-* üêõ Fix empty reponse body when default `status_code` is empty but \n\n```", "output": "Changes look good. This PR implements: üìù Fix minor typos in release notes", "source": "pr", "type": "code_review", "pr_number": 378}
{"instruction": "Fix the following bug: üåê Update translations for uk (update outdated, found by fixer tool)", "input": "Running translation fixer tool shows several pages that contain mistakes. They were likely missed because of the overridden commit date.\r\nThis PR updates those outdated pages", "output": "```diff\n@@ -1,8 +1,8 @@\n-# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è\n+# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è { #alternatives-inspiration-and-comparisons }\n \n-–©–æ –Ω–∞–¥–∏—Ö–Ω—É–ª–æ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **FastAPI**, —è–∫–∏–π –≤—ñ–Ω —É –ø–æ—Ä—ñ–Ω—è–Ω–Ω—ñ –∑ —ñ–Ω—à–∏–º–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ —Ç–∞ —á–æ–≥–æ –≤—ñ–Ω —É –Ω–∏—Ö –Ω–∞–≤—á–∏–≤—Å—è.\n+–©–æ –Ω–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI**, —è–∫ –≤—ñ–Ω –ø–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ —Ç–∞ —á–æ–≥–æ –≤—ñ–Ω —É –Ω–∏—Ö –Ω–∞–≤—á–∏–≤—Å—è.\n \n-## –í—Å—Ç—É–ø\n+## –í—Å—Ç—É–ø { #intro }\n \n **FastAPI** –Ω–µ —ñ—Å–Ω—É–≤–∞–ª–æ –±, —è–∫–±–∏ –Ω–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–æ–±–æ—Ç–∏ —ñ–Ω—à–∏—Ö.\n \n@@ -12,17 +12,17 @@\n \n –ê–ª–µ –≤ —è–∫–∏–π—Å—å –º–æ–º–µ–Ω—Ç –Ω–µ –±—É–ª–æ —ñ–Ω—à–æ–≥–æ –≤–∏—Ö–æ–¥—É, –æ–∫—Ä—ñ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–æ–≥–æ—Å—å, —â–æ –Ω–∞–¥–∞–≤–∞–ª–æ –± —É—Å—ñ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤–∑—è–≤—à–∏ –Ω–∞–π–∫—Ä–∞—â—ñ —ñ–¥–µ—ó –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —ñ –ø–æ—î–¥–Ω–∞–≤—à–∏ —ó—Ö –Ω–∞–π–∫—Ä–∞—â–∏–º —á–∏–Ω–æ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –Ω–∞–≤—ñ—Ç—å –Ω–µ –±—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ä–∞–Ω—ñ—à–µ (Python 3.6+ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—ñ–≤).\n \n-## –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏\n+## –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n –¶–µ –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Python, —è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É—î—Ç—å—Å—è —à–∏—Ä–æ–∫–æ—é –¥–æ–≤—ñ—Ä–æ—é. –í—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º, —è–∫ Instagram.\n \n –í—ñ–Ω –≤—ñ–¥–Ω–æ—Å–Ω–æ —Ç—ñ—Å–Ω–æ –ø–æ–≤‚Äô—è–∑–∞–Ω–∏–π –∑ —Ä–µ–ª—è—Ü—ñ–π–Ω–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, MySQL –∞–±–æ PostgreSQL), —Ç–æ–º—É –º–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö NoSQL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Couchbase, MongoDB, Cassandra —Ç–æ—â–æ) —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –Ω–µ –¥—É–∂–µ –ø—Ä–æ—Å—Ç–æ.\n \n-–í—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —É —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ, –∞ –Ω–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—è–∫-–æ—Ç React, Vue.js —ñ Angular) –∞–±–æ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—è–∫-–æ—Ç <abbr title=\"Internet of Things\">IoT</abbr > –ø—Ä–∏—Å—Ç—Ä–æ—ó), —è–∫—ñ —Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è –∑ –Ω–∏–º.\n+–í—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —É —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ, –∞ –Ω–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—è–∫-–æ—Ç React, Vue.js —ñ Angular) –∞–±–æ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—è–∫-–æ—Ç <abbr title=\"Internet of Things - –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–µ—á–µ–π\">IoT</abbr> –ø—Ä–∏—Å—Ç—Ä–æ—ó), —è–∫—ñ —Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è –∑ –Ω–∏–º.\n \n-### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a>\n+### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a> { #django-rest-framework }\n \n –§—Ä–µ–π–º–≤–æ—Ä–∫ Django REST –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —è–∫ –≥–Ω—É—á–∫–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Django –≤ –æ—Å–Ω–æ–≤—ñ, —â–æ–± –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –π–æ–≥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ API.\n \n@@ -42,7 +42,7 @@ Django REST Framework —Å—Ç–≤–æ—Ä–∏–≤ –¢–æ–º –ö—Ä—ñ—Å—Ç—ñ. –¢–æ–π —Å–∞–º–∏–π —Ç–≤\n \n ///\n \n-### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a>\n+### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a> { #flask }\n \n Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –∞ —Ç–∞–∫–æ–∂ –±–∞–≥–∞—Ç–æ —Ä–µ—á–µ–π, —è–∫—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —î –≤ Django.\n \n@@ -64,7 +64,7 @@ Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω\n \n ///\n \n-### <a href=\"https://requests.readthedocs.io\" class=\"external-link\" target=\"_blank\">Requests</a>\n+### <a href=\"https://requests.readthedocs.io\" class=\"exter\n\n```\n\n```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI** —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —è–∫—É –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –í–∞—à –¥–æ–¥–∞—Ç–æ–∫ FastAPI, –∫–µ—Ä—É–≤–∞—Ç–∏ –í–∞—à–∏–º–∏ FastApi –ø—Ä–æ–µ–∫—Ç–∞–º–∏, —Ç–æ—â–æ.\n+**FastAPI CLI** ‚Äî —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —è–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI, –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–∞—à–∏–º –ø—Ä–æ—î–∫—Ç–æ–º FastAPI —Ç–æ—â–æ.\n \n-–ö–æ–ª–∏ –í–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ FastApi (—Ç–æ–±—Ç–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ `pip install \"fastapi[standard]\"`), –í–∏ —Ç–∞–∫–æ–∂ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ –ø–∞–∫—É–Ω–æ–∫ `fastapi-cli`, —Ü–µ–π –ø–∞–∫—É–Ω–æ–∫ –Ω–∞–¥–∞—î –∫–æ–º–∞–Ω–¥—É `fastapi` –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.\n+–ö–æ–ª–∏ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ FastAPI (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `pip install \"fastapi[standard]\"`), –≤—ñ–Ω –≤–∫–ª—é—á–∞—î –ø–∞–∫–µ—Ç –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `fastapi-cli`, —Ü–µ–π –ø–∞–∫–µ—Ç –Ω–∞–¥–∞—î –∫–æ–º–∞–Ω–¥—É `fastapi` —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.\n \n-–î–ª—è –∑–∞–ø—É—Å–∫—É –í–∞—à–æ–≥–æ FastAPI –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, –í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –∫–æ–º–∞–Ω–¥–æ—é `fastapi dev`:\n+–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `fastapi dev`:\n \n <div class=\"termy\">\n \n \n```\n\n```diff\n@@ -1,53 +1,55 @@\n-# –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ\n+# –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ { #features }\n \n-## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ FastAPI\n+## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ FastAPI { #fastapi-features }\n \n **FastAPI** –Ω–∞–¥–∞—î –≤–∞–º —Ç–∞–∫—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:\n \n-### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤\n+### –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: endpoints, –º–∞—Ä—à—Ä—É—Ç–∏\">—à–ª—è—Ö—ñ–≤</abbr>, <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ HTTP-–º–µ—Ç–æ–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</abbr>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\n * –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (–æ—Å–∫—ñ–ª—å–∫–∏ OpenAPI –±–∞–∑—É—î—Ç—å—Å—è —Å–∞–º–µ –Ω–∞ JSON Schema).\n * –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ –ø—ñ—Å–ª—è —Ä–µ—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É, –∞ –Ω–µ —è–∫ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å –ø–æ–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏.\n-* –¶–µ —Ç–∞–∫–æ–∂ –¥–∞—î –∑–º–æ–≥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ **–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ–¥ –∫–ª—ñ—î–Ω—Ç–∞** –±–∞–≥–∞—Ç—å–º–∞ –º–æ–≤–∞–º–∏.\n+* –¶–µ —Ç–∞–∫–æ–∂ –¥–∞—î –∑–º–æ–≥—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É **–≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–≥–æ –∫–æ–¥—É** –±–∞–≥–∞—Ç—å–º–∞ –º–æ–≤–∞–º–∏.\n \n-### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó\n+### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è { #automatic-docs }\n \n-–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API —Ç–∞ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –π–æ–≥–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è. –û—Å–∫—ñ–ª—å–∫–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ OpenAPI, —î –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤, –¥–≤–∞ –∑ —è–∫–∏—Ö –≤–∫–ª—é—á–µ–Ω—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.\n+–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API —Ç–∞ –≤–µ–±—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –¥–ª—è –π–æ–≥–æ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è. –û—Å–∫—ñ–ª—å–∫–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ OpenAPI, —î –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤, 2 –∑ —è–∫–∏—Ö –≤–∫–ª—é—á–µ–Ω—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.\n \n-* <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a> ‚Äî –¥–æ–∑–≤–æ–ª—è—î —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ API, –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ –ø—Ä—è–º–æ —É –±—Ä–∞—É–∑–µ—Ä—ñ.\n+* <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\"><strong>Swagger UI</strong></a> ‚Äî –∑ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏–º –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è–º, –≤–∏–∫–ª–∏–∫–æ–º —ñ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è–º –≤–∞—à–æ–≥–æ API –ø—Ä—è–º–æ –∑ –±—Ä–∞—É–∑–µ—Ä–∞.\n \n ![Swagger UI interaction](https://fastapi.tiangolo.com/img/index/index-03-swagger-02.png)\n \n * –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\"><strong>ReDoc</strong></a>.\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### –¢—ñ–ª—å–∫–∏ —Å—É—á–∞—Å–Ω–∏–π Python\n+### –õ–∏—à–µ —Å—É—á–∞—Å–Ω–∏–π Python { #just-modern-python }\n \n-FastAPI –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ **—Ç–∏–ø–∏ Python** (–∑–∞–≤–¥—è–∫–∏ Pydantic). –í–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–≤—á–∞—Ç–∏ –Ω–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å ‚Äî –ª–∏—à–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å—É—á–∞—Å–Ω–∏–π Python.\n+–£—Å–µ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è—Ö **—Ç–∏–ø—ñ–≤ Python** (–∑–∞–≤–¥—è–∫–∏ Pydantic). –ñ–æ–¥–Ω–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –¥–ª—è –≤–∏–≤—á–µ–Ω–Ω—è. –õ–∏—à–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å—É—á–∞—Å–Ω–∏–π Python.\n \n-–Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–µ –∫–æ—Ä–æ—Ç–∫–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∏–ø—ñ–≤ —É Python (–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ FastAPI), –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π –ø—ñ–¥—Ä—É—á–Ω–∏–∫: [–í—Å—Ç—É–ø –¥–æ —Ç–∏–ø—ñ–≤ Python](python-types.md){.internal-link target=_blank}.\n+–Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä\n\n```\n\n```diff\n@@ -56,15 +56,15 @@ Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω\n \n –í—Ä–∞—Ö–æ–≤—É—é—á–∏ –ø—Ä–æ—Å—Ç–æ—Ç—É Flask, –≤—ñ–Ω –∑–¥–∞–≤–∞–≤—Å—è —Ö–æ—Ä–æ—à–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API. –ù–∞—Å—Ç—É–ø–Ω–∏–º, —â–æ –∑–Ω–∞–π—à–æ–≤, –±—É–≤ ¬´Django REST Framework¬ª –¥–ª—è Flask.\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```\n\n```diff\n@@ -88,25 +88,25 @@ Requests –º–∞—é—Ç—å –¥—É–∂–µ –ø—Ä–æ—Å—Ç–∏–π —Ç–∞ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É\n response = requests.get(\"http://example.com/some/url\")\n \n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 376}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,8 +1,8 @@\n-# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è\n+# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è { #alternatives-inspiration-and-comparisons }\n \n-–©–æ –Ω–∞–¥–∏—Ö–Ω—É–ª–æ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **FastAPI**, —è–∫–∏–π –≤—ñ–Ω —É –ø–æ—Ä—ñ–Ω—è–Ω–Ω—ñ –∑ —ñ–Ω—à–∏–º–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ —Ç–∞ —á–æ–≥–æ –≤—ñ–Ω —É –Ω–∏—Ö –Ω–∞–≤—á–∏–≤—Å—è.\n+–©–æ –Ω–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI**, —è–∫ –≤—ñ–Ω –ø–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ —Ç–∞ —á–æ–≥–æ –≤—ñ–Ω —É –Ω–∏—Ö –Ω–∞–≤—á–∏–≤—Å—è.\n \n-## –í—Å—Ç—É–ø\n+## –í—Å—Ç—É–ø { #intro }\n \n **FastAPI** –Ω–µ —ñ—Å–Ω—É–≤–∞–ª–æ –±, —è–∫–±–∏ –Ω–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–æ–±–æ—Ç–∏ —ñ–Ω—à–∏—Ö.\n \n@@ -12,17 +12,17 @@\n \n –ê–ª–µ –≤ —è–∫–∏–π—Å—å –º–æ–º–µ–Ω—Ç –Ω–µ –±—É–ª–æ —ñ–Ω—à–æ–≥–æ –≤–∏—Ö–æ–¥—É, –æ–∫—Ä—ñ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–æ–≥–æ—Å—å, —â–æ –Ω–∞–¥–∞–≤–∞–ª–æ –± —É—Å—ñ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤–∑—è–≤—à–∏ –Ω–∞–π–∫—Ä–∞—â—ñ —ñ–¥–µ—ó –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —ñ –ø–æ—î–¥–Ω–∞–≤—à–∏ —ó—Ö –Ω–∞–π–∫—Ä–∞—â–∏–º —á–∏–Ω–æ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –Ω–∞–≤—ñ—Ç—å –Ω–µ –±—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ä–∞–Ω—ñ—à–µ (Python 3.6+ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—ñ–≤).\n \n-## –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏\n+## –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n –¶–µ –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Python, —è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É—î—Ç—å—Å—è —à–∏—Ä–æ–∫–æ—é –¥–æ–≤—ñ—Ä–æ—é. –í—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º, —è–∫ Instagram.\n \n –í—ñ–Ω –≤—ñ–¥–Ω–æ—Å–Ω–æ —Ç—ñ—Å–Ω–æ –ø–æ–≤‚Äô—è–∑–∞–Ω–∏–π –∑ —Ä–µ–ª—è—Ü—ñ–π–Ω–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, MySQL –∞–±–æ PostgreSQL), —Ç–æ–º—É –º–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö NoSQL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Couchbase, MongoDB, Cassandra —Ç–æ—â–æ) —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –Ω–µ –¥—É–∂–µ –ø—Ä–æ—Å—Ç–æ.\n \n-–í—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —É —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ, –∞ –Ω–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—è–∫-–æ—Ç React, Vue.js —ñ Angular) –∞–±–æ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—è–∫-–æ—Ç <abbr title=\"Internet of Things\">IoT</abbr > –ø—Ä–∏—Å—Ç—Ä–æ—ó), —è–∫—ñ —Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è –∑ –Ω–∏–º.\n+–í—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —É —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ, –∞ –Ω–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—è–∫-–æ—Ç React, Vue.js —ñ Angular) –∞–±–æ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—è–∫-–æ—Ç <abbr title=\"Internet of Things - –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–µ—á–µ–π\">IoT</abbr> –ø—Ä–∏—Å—Ç—Ä–æ—ó), —è–∫—ñ —Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è –∑ –Ω–∏–º.\n \n-### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a>\n+### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a> { #django-rest-framework }\n \n –§—Ä–µ–π–º–≤–æ—Ä–∫ Django REST –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —è–∫ –≥–Ω—É—á–∫–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Django –≤ –æ—Å–Ω–æ–≤—ñ, —â–æ–± –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –π–æ–≥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ API.\n \n@@ -42,7 +42,7 @@ Django REST Framework —Å—Ç–≤–æ—Ä–∏–≤ –¢–æ–º –ö—Ä—ñ—Å—Ç—ñ. –¢–æ–π —Å–∞–º–∏–π —Ç–≤\n \n ///\n \n-### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a>\n+### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a> { #flask }\n \n Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –∞ —Ç–∞–∫–æ–∂ –±–∞–≥–∞—Ç–æ —Ä–µ—á–µ–π, —è–∫—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —î –≤ Django.\n \n@@ -64,7 +64,7 @@ Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω\n \n ///\n \n-### <a href=\"https://requests.readthedocs.io\" class=\"external-link\" target=\"_blank\">Requests</a>\n+### <a href=\"https://requests.readthedocs.io\" class=\"exter\n\n```\n\n```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI** —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —è–∫—É –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –í–∞—à –¥–æ–¥–∞—Ç–æ–∫ FastAPI, –∫–µ—Ä—É–≤–∞—Ç–∏ –í–∞—à–∏–º–∏ FastApi –ø—Ä–æ–µ–∫—Ç–∞–º–∏, —Ç–æ—â–æ.\n+**FastAPI CLI** ‚Äî —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —è–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI, –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–∞—à–∏–º –ø—Ä–æ—î–∫—Ç–æ–º FastAPI —Ç–æ—â–æ.\n \n-–ö–æ–ª–∏ –í–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ FastApi (—Ç–æ–±—Ç–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ `pip install \"fastapi[standard]\"`), –í–∏ —Ç–∞–∫–æ–∂ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ –ø–∞–∫—É–Ω–æ–∫ `fastapi-cli`, —Ü–µ–π –ø–∞–∫—É–Ω–æ–∫ –Ω–∞–¥–∞—î –∫–æ–º–∞–Ω–¥—É `fastapi` –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.\n+–ö–æ–ª–∏ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ FastAPI (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `pip install \"fastapi[standard]\"`), –≤—ñ–Ω –≤–∫–ª—é—á–∞—î –ø–∞–∫–µ—Ç –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `fastapi-cli`, —Ü–µ–π –ø–∞–∫–µ—Ç –Ω–∞–¥–∞—î –∫–æ–º–∞–Ω–¥—É `fastapi` —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.\n \n-–î–ª—è –∑–∞–ø—É—Å–∫—É –í–∞—à–æ–≥–æ FastAPI –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, –í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –∫–æ–º–∞–Ω–¥–æ—é `fastapi dev`:\n+–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `fastapi dev`:\n \n <div class=\"termy\">\n \n \n```\n\n```", "output": "Bug: üåê Update translations for uk (update outdated, found by fixer tool)\n\nRunning translation fixer tool shows several pages that contain mistakes. They were likely missed because of the overridden commit date.\r\nThis PR updates those outdated pages", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 376}
{"instruction": "Review the following code changes: üåê Update translations for uk (update outdated, found by fixer tool)", "input": "```diff\n@@ -1,8 +1,8 @@\n-# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è\n+# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è { #alternatives-inspiration-and-comparisons }\n \n-–©–æ –Ω–∞–¥–∏—Ö–Ω—É–ª–æ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **FastAPI**, —è–∫–∏–π –≤—ñ–Ω —É –ø–æ—Ä—ñ–Ω—è–Ω–Ω—ñ –∑ —ñ–Ω—à–∏–º–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ —Ç–∞ —á–æ–≥–æ –≤—ñ–Ω —É –Ω–∏—Ö –Ω–∞–≤—á–∏–≤—Å—è.\n+–©–æ –Ω–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI**, —è–∫ –≤—ñ–Ω –ø–æ—Ä—ñ–≤–Ω—é—î—Ç—å—Å—è –∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ —Ç–∞ —á–æ–≥–æ –≤—ñ–Ω —É –Ω–∏—Ö –Ω–∞–≤—á–∏–≤—Å—è.\n \n-## –í—Å—Ç—É–ø\n+## –í—Å—Ç—É–ø { #intro }\n \n **FastAPI** –Ω–µ —ñ—Å–Ω—É–≤–∞–ª–æ –±, —è–∫–±–∏ –Ω–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ —Ä–æ–±–æ—Ç–∏ —ñ–Ω—à–∏—Ö.\n \n@@ -12,17 +12,17 @@\n \n –ê–ª–µ –≤ —è–∫–∏–π—Å—å –º–æ–º–µ–Ω—Ç –Ω–µ –±—É–ª–æ —ñ–Ω—à–æ–≥–æ –≤–∏—Ö–æ–¥—É, –æ–∫—Ä—ñ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–æ–≥–æ—Å—å, —â–æ –Ω–∞–¥–∞–≤–∞–ª–æ –± —É—Å—ñ —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤–∑—è–≤—à–∏ –Ω–∞–π–∫—Ä–∞—â—ñ —ñ–¥–µ—ó –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —ñ –ø–æ—î–¥–Ω–∞–≤—à–∏ —ó—Ö –Ω–∞–π–∫—Ä–∞—â–∏–º —á–∏–Ω–æ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –Ω–∞–≤—ñ—Ç—å –Ω–µ –±—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ä–∞–Ω—ñ—à–µ (Python 3.6+ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—ñ–≤).\n \n-## –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏\n+## –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n –¶–µ –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Python, —è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É—î—Ç—å—Å—è —à–∏—Ä–æ–∫–æ—é –¥–æ–≤—ñ—Ä–æ—é. –í—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º, —è–∫ Instagram.\n \n –í—ñ–Ω –≤—ñ–¥–Ω–æ—Å–Ω–æ —Ç—ñ—Å–Ω–æ –ø–æ–≤‚Äô—è–∑–∞–Ω–∏–π –∑ —Ä–µ–ª—è—Ü—ñ–π–Ω–∏–º–∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, MySQL –∞–±–æ PostgreSQL), —Ç–æ–º—É –º–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö NoSQL (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Couchbase, MongoDB, Cassandra —Ç–æ—â–æ) —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –Ω–µ –¥—É–∂–µ –ø—Ä–æ—Å—Ç–æ.\n \n-–í—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —É —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ, –∞ –Ω–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—è–∫-–æ—Ç React, Vue.js —ñ Angular) –∞–±–æ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—è–∫-–æ—Ç <abbr title=\"Internet of Things\">IoT</abbr > –ø—Ä–∏—Å—Ç—Ä–æ—ó), —è–∫—ñ —Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è –∑ –Ω–∏–º.\n+–í—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è HTML —É —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ, –∞ –Ω–µ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å—É—á–∞—Å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—è–∫-–æ—Ç React, Vue.js —ñ Angular) –∞–±–æ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—è–∫-–æ—Ç <abbr title=\"Internet of Things - –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–µ—á–µ–π\">IoT</abbr> –ø—Ä–∏—Å—Ç—Ä–æ—ó), —è–∫—ñ —Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è –∑ –Ω–∏–º.\n \n-### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a>\n+### <a href=\"https://www.django-rest-framework.org/\" class=\"external-link\" target=\"_blank\">Django REST Framework</a> { #django-rest-framework }\n \n –§—Ä–µ–π–º–≤–æ—Ä–∫ Django REST –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —è–∫ –≥–Ω—É—á–∫–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä—ñ–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Django –≤ –æ—Å–Ω–æ–≤—ñ, —â–æ–± –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –π–æ–≥–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ API.\n \n@@ -42,7 +42,7 @@ Django REST Framework —Å—Ç–≤–æ—Ä–∏–≤ –¢–æ–º –ö—Ä—ñ—Å—Ç—ñ. –¢–æ–π —Å–∞–º–∏–π —Ç–≤\n \n ///\n \n-### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a>\n+### <a href=\"https://flask.palletsprojects.com\" class=\"external-link\" target=\"_blank\">Flask</a> { #flask }\n \n Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –∞ —Ç–∞–∫–æ–∂ –±–∞–≥–∞—Ç–æ —Ä–µ—á–µ–π, —è–∫—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —î –≤ Django.\n \n@@ -64,7 +64,7 @@ Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω\n \n ///\n \n-### <a href=\"https://requests.readthedocs.io\" class=\"external-link\" target=\"_blank\">Requests</a>\n+### <a href=\"https://requests.readthedocs.io\" class=\"exter\n\n```\n\n```diff\n@@ -1,83 +1,75 @@\n-# FastAPI CLI\n+# FastAPI CLI { #fastapi-cli }\n \n-**FastAPI CLI** —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —è–∫—É –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –í–∞—à –¥–æ–¥–∞—Ç–æ–∫ FastAPI, –∫–µ—Ä—É–≤–∞—Ç–∏ –í–∞—à–∏–º–∏ FastApi –ø—Ä–æ–µ–∫—Ç–∞–º–∏, —Ç–æ—â–æ.\n+**FastAPI CLI** ‚Äî —Ü–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —è–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI, –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–∞—à–∏–º –ø—Ä–æ—î–∫—Ç–æ–º FastAPI —Ç–æ—â–æ.\n \n-–ö–æ–ª–∏ –í–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ FastApi (—Ç–æ–±—Ç–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ `pip install \"fastapi[standard]\"`), –í–∏ —Ç–∞–∫–æ–∂ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ –ø–∞–∫—É–Ω–æ–∫ `fastapi-cli`, —Ü–µ–π –ø–∞–∫—É–Ω–æ–∫ –Ω–∞–¥–∞—î –∫–æ–º–∞–Ω–¥—É `fastapi` –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.\n+–ö–æ–ª–∏ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç–µ FastAPI (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `pip install \"fastapi[standard]\"`), –≤—ñ–Ω –≤–∫–ª—é—á–∞—î –ø–∞–∫–µ—Ç –ø—ñ–¥ –Ω–∞–∑–≤–æ—é `fastapi-cli`, —Ü–µ–π –ø–∞–∫–µ—Ç –Ω–∞–¥–∞—î –∫–æ–º–∞–Ω–¥—É `fastapi` —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ.\n \n-–î–ª—è –∑–∞–ø—É—Å–∫—É –í–∞—à–æ–≥–æ FastAPI –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, –í–∏ –º–æ–∂–µ—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—å –∫–æ–º–∞–Ω–¥–æ—é `fastapi dev`:\n+–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ FastAPI –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É `fastapi dev`:\n \n <div class=\"termy\">\n \n \n```\n\n```diff\n@@ -1,53 +1,55 @@\n-# –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ\n+# –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ { #features }\n \n-## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ FastAPI\n+## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ FastAPI { #fastapi-features }\n \n **FastAPI** –Ω–∞–¥–∞—î –≤–∞–º —Ç–∞–∫—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:\n \n-### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤\n+### –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: endpoints, –º–∞—Ä—à—Ä—É—Ç–∏\">—à–ª—è—Ö—ñ–≤</abbr>, <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ HTTP-–º–µ—Ç–æ–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</abbr>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\n * –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (–æ—Å–∫—ñ–ª—å–∫–∏ OpenAPI –±–∞–∑—É—î—Ç—å—Å—è —Å–∞–º–µ –Ω–∞ JSON Schema).\n * –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ –ø—ñ—Å–ª—è —Ä–µ—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É, –∞ –Ω–µ —è–∫ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π ", "output": "Code Review for: üåê Update translations for uk (update outdated, found by fixer tool)\n\nüìù **docs/uk/docs/alternatives.md**: ```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```\n\nüìù **docs/uk/docs/alternatives.md**: ```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```\n\nüìù **docs/uk/docs/alternatives.md**: ```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```\n\nüìù **docs/uk/docs/alternatives.md**: ```suggestion\r\n–û–¥–Ω—ñ—î—é –∑ –≥–æ–ª–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º API, —î \"<abbr title=\"—Ç–∞–∫–æ–∂ –∑–≤–∞–Ω–∞ marshalling, conversion\">—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è</abbr>\", —è–∫–∞ –±–µ—Ä–µ –¥–∞–Ω—ñ –∑ –∫–æ–¥—É (Python) —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —ó—Ö –Ω–∞ —â–æ—Å—å, —â–æ –º–æ–∂–Ω–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç–∞, —â–æ –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –Ω–∞ –æ–±‚Äô—î–∫—Ç JSON. –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç—ñ–≤ `datetime` –Ω–∞ —Å—Ç—Ä–æ–∫–∏ —Ç–æ—â–æ.\r\n```\n\nüìù **docs/uk/docs/alternatives.md**: ```suggestion\r\n–ê–ª–µ –≤—ñ–Ω –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–æ —Ç–æ–≥–æ, —è–∫ —ñ—Å–Ω—É–≤–∞–ª–∏ –ø—ñ–¥–∫–∞–∑–∫–∏ —Ç–∏–ø—É Python. –û—Ç–∂–µ, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∫–æ–∂–Ω—É <abbr title=\"–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ –¥–∞–Ω—ñ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω—ñ\">—Å—Ö–µ–º—É</abbr>, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —É—Ç–∏–ª—ñ—Ç–∏ —Ç–∞ –∫–ª–∞—Å–∏, –Ω–∞–¥–∞–Ω—ñ Marshmallow.\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -56,15 +56,15 @@ Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω\n \n –í—Ä–∞—Ö–æ–≤—É—é—á–∏ –ø—Ä–æ—Å—Ç–æ—Ç—É Flask, –≤—ñ–Ω –∑–¥–∞–≤–∞–≤—Å—è —Ö–æ—Ä–æ—à–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API. –ù–∞—Å—Ç—É–ø–Ω–∏–º, —â–æ –∑–Ω–∞–π—à–æ–≤, –±—É–≤ ¬´Django REST Framework¬ª –¥–ª—è Flask.\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -88,25 +88,25 @@ Requests –º–∞—é—Ç—å –¥—É–∂–µ –ø—Ä–æ—Å—Ç–∏–π —Ç–∞ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É\n response = requests.get(\"http://example.com/some/url\")\n ```\n \n-–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è *—Ä–æ—É—Ç—É* API FastAPI –º–æ–∂–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫:\n+–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—É API FastAPI –º–æ–∂–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫:\n \n ```Python hl_lines=\"1\"\n @app.get(\"/some/url\")\n def read_url():\n-     return {\"message\": \"Hello World\"}\n+    return {\"message\": \"Hello World\"}\n ```\n \n –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Å—Ö–æ–∂—ñ—Å—Ç—å —É `requests.get(...)` —ñ `@app.get(...)`.\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -118,44 +118,44 @@ def read_url():\n \n –¢–æ–º—É, –∫–æ–ª–∏ –≥–æ–≤–æ—Ä—è—Ç—å –ø—Ä–æ –≤–µ—Ä—Å—ñ—é 2.0, –ø—Ä–∏–π–Ω—è—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç–∏ ¬´Swagger¬ª, –∞ –ø—Ä–æ –≤–µ—Ä—Å—ñ—é 3+ ¬´OpenAPI¬ª.\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -36,13 +36,13 @@ Django REST Framework —Å—Ç–≤–æ—Ä–∏–≤ –¢–æ–º –ö—Ä—ñ—Å—Ç—ñ. –¢–æ–π —Å–∞–º–∏–π —Ç–≤\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -169,13 +169,13 @@ Webargs –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç–∏–º–∏ –∂ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º–∏ Marshmall\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -199,13 +199,13 @@ APISpec –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç–∏–º–∏ –∂ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º–∏ Marshmall\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -231,35 +231,35 @@ Flask-apispec –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç–∏–º–∏ –∂ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º–∏ Mar\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -271,23 +271,23 @@ Flask-apispec –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π —Ç–∏–º–∏ –∂ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º–∏ Mar\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -313,15 +313,15 @@ Falcon ‚Äî —â–µ –æ–¥–∏–Ω –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫\n \n –ú–∞—Ä—à—Ä—É—Ç–∏ –æ–≥–æ–ª–æ—à—É—é—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —Ñ—É–Ω–∫—Ü—ñ–π, –æ–≥–æ–ª–æ—à–µ–Ω–∏—Ö –≤ —ñ–Ω—à–∏—Ö –º—ñ—Å—Ü—è—Ö (–∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ñ–≤, —è–∫—ñ –º–æ–∂–Ω–∞ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø–æ–≤–µ—Ä—Ö —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –æ–±—Ä–æ–±–ª—è—î –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É). –¶–µ –±–ª–∏–∂—á–µ –¥–æ —Ç–æ–≥–æ, —è–∫ —Ü–µ —Ä–æ–±–∏—Ç—å Django, –Ω—ñ–∂ –¥–æ Flask (—ñ Starlette). –í—ñ–Ω —Ä–æ–∑–¥—ñ–ª—è—î –≤ –∫–æ–¥—ñ —Ä–µ—á—ñ, —è–∫—ñ –≤—ñ–¥–Ω–æ—Å–Ω–æ —Ç—ñ—Å–Ω–æ –ø–æ–≤‚Äô—è–∑–∞–Ω—ñ.\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -341,7 +341,7 @@ Hug —Å—Ç–≤–æ—Ä–∏–≤ –¢—ñ–º–æ—Ç—ñ –ö—Ä–æ—Å–ª—ñ, —Ç–æ–π —Å–∞–º–∏–π —Ç–≤–æ—Ä–µ—Ü—å <\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Ideas inspiring **FastAPI**\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -379,45 +379,47 @@ Hug –Ω–∞–¥–∏—Ö–Ω—É–≤ —á–∞—Å—Ç–∏–Ω—É APIStar —ñ –±—É–≤ –æ–¥–Ω–∏–º —ñ–∑ –Ω–∞–π–±—ñ\n \n APIStar —Å—Ç–≤–æ—Ä–∏–≤ –¢–æ–º –ö—Ä—ñ—Å—Ç—ñ. –¢–æ–π —Å–∞–º–∏–π —Ö–ª–æ–ø–µ—Ü—å, —è–∫–∏–π —Å—Ç–≤–æ—Ä–∏–≤:\n \n- * Django REST Framework\n- * Starlette (–Ω–∞ —è–∫–æ–º—É –±–∞–∑—É—î—Ç—å—Å—è **FastAPI**)\n- * Uvicorn (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Starlette —ñ **FastAPI**)\n+* Django REST Framework\n+* Starlette (–Ω–∞ —è–∫–æ–º—É –±–∞–∑—É—î—Ç—å—Å—è **FastAPI**)\n+* Uvicorn (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Starlette —ñ **FastAPI**)\n \n ///\n \n-/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n+/// check | Inspired **FastAPI** to\n\n```", "output": "```suggestion\r\n/// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -450,7 +452,7 @@ ASGI ‚Äî —Ü–µ –Ω–æ–≤–∏–π ¬´—Å—Ç–∞–Ω–¥–∞—Ä—Ç¬ª, —è–∫–∏–π —Ä–æ–∑—Ä–æ–±–ª—è—î—Ç—å—Å\n \n ///\n \n-/// check | **FastAPI** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –π–æ–≥–æ –¥–ª—è\n+/// check | **FastAPI** uses it to\n\n```", "output": "```suggestion\r\n/// check | **FastAPI** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –π–æ–≥–æ –¥–ª—è\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/alternatives.md`", "input": "```diff\n@@ -460,24 +462,24 @@ ASGI ‚Äî —Ü–µ –Ω–æ–≤–∏–π ¬´—Å—Ç–∞–Ω–¥–∞—Ä—Ç¬ª, —è–∫–∏–π —Ä–æ–∑—Ä–æ–±–ª—è—î—Ç—å—Å\n \n ///\n \n-### <a href=\"https://www.uvicorn.dev/\" class=\"external-link\" target=\"_blank\">Uvicorn</a>\n+### <a href=\"https://www.uvicorn.dev/\" class=\"external-link\" target=\"_blank\">Uvicorn</a> { #uvicorn }\n \n Uvicorn ‚Äî —Ü–µ –±–ª–∏—Å–∫–∞–≤–∏—á–Ω–∏–π —Å–µ—Ä–≤–µ—Ä ASGI, –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ uvloop —ñ httptools.\n \n –¶–µ –Ω–µ –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –∞ —Å–µ—Ä–≤–µ—Ä. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—ñ–Ω –Ω–µ –Ω–∞–¥–∞—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó. –¶–µ —Ç–µ, —â–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –Ω–∞ –∫—à—Ç–∞–ª—Ç Starlette (–∞–±–æ **FastAPI**) –∑–∞–±–µ–∑–ø–µ—á–∏—Ç—å –ø–æ–≤–µ—Ä—Ö –Ω—å–æ–≥–æ.\n \n –¶–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è Starlette —ñ **FastAPI**.\n \n-/// check | **FastAPI** —Ä–µ–∫–æ–º–µ–Ω–¥—É—î —Ü–µ —è–∫\n+/// check | **FastAPI** recommends it as\n\n```", "output": "```suggestion\r\n/// check | **FastAPI** —Ä–µ–∫–æ–º–µ–Ω–¥—É—î —Ü–µ —è–∫\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/features.md`", "input": "```diff\n@@ -1,53 +1,55 @@\n-# –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ\n+# –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ { #features }\n \n-## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ FastAPI\n+## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ FastAPI { #fastapi-features }\n \n **FastAPI** –Ω–∞–¥–∞—î –≤–∞–º —Ç–∞–∫—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:\n \n-### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤\n+### –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ { #based-on-open-standards }\n \n-* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: endpoints, –º–∞—Ä—à—Ä—É—Ç–∏\">—à–ª—è—Ö—ñ–≤</abbr>, <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ HTTP-–º–µ—Ç–æ–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</abbr>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: endpoints, routes\">—à–ª—è—Ö—ñ–≤</abbr>, <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ HTTP-–º–µ—Ç–æ–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</abbr>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\n\n```", "output": "```suggestion\r\n* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: endpoints, –º–∞—Ä—à—Ä—É—Ç–∏\">—à–ª—è—Ö—ñ–≤</abbr>, <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ HTTP-–º–µ—Ç–æ–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</abbr>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Review this code change in `docs/uk/docs/features.md`", "input": "```diff\n@@ -87,103 +91,111 @@ my_second_user: User = User(**second_user_data)\n \n ![editor support](https://fastapi.tiangolo.com/img/pycharm-completion.png)\n \n-### –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥\n-FastAPI –º–∞—î —Ä–æ–∑—É–º–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è **–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**, –∞–ª–µ –≤—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±. –û–¥–Ω–∞–∫ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—Å–µ \"–ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é—î\".\n+–í–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –∞–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –≤ –∫–æ–¥—ñ, —è–∫–∏–π —Ä–∞–Ω—ñ—à–µ –º–æ–≥–ª–∏ –≤–≤–∞–∂–∞—Ç–∏ –Ω–∞–≤—ñ—Ç—å –Ω–µ–º–æ–∂–ª–∏–≤–∏–º. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∫–ª—é—á–∞ `price` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ JSON body (—è–∫–∏–π –º—ñ–≥ –±—É—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω–∏–º), —â–æ –Ω–∞–¥—Ö–æ–¥–∏—Ç—å —ñ–∑ –∑–∞–ø–∏—Ç—É.\n+\n+–ë—ñ–ª—å—à–µ –Ω–µ –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –≤–≤–æ–¥–∏—Ç–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –Ω–∞–∑–≤–∏ –∫–ª—é—á—ñ–≤, –ø–æ—Å—Ç—ñ–π–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó –∞–±–æ –ø—Ä–æ–∫—Ä—É—á—É–≤–∞—Ç–∏ –≤–≥–æ—Ä—É-–≤–Ω–∏–∑, —â–æ–± –∑–Ω–∞–π—Ç–∏, —á–∏ –≤–∏ –∑—Ä–µ—à—Ç–æ—é –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ `username` —á–∏ `user_name`.\n+\n+### –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ { #short }\n+\n+FastAPI –º–∞—î —Ä–æ–∑—É–º–Ω—ñ **–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º** –¥–ª—è –≤—Å—å–æ–≥–æ, –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—Å—é–¥–∏. –£—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –º–æ–∂–Ω–∞ —Ç–æ—á–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥ –≤–∞—à—ñ –ø–æ—Ç—Ä–µ–±–∏ —Ç–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –≤–∞–º API.\n+\n+–ê–ª–µ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É—Å–µ **¬´–ø—Ä–æ—Å—Ç–æ –ø—Ä–∞—Ü—é—î¬ª**.\n+\n+### –í–∞–ª—ñ–¥–∞—Ü—ñ—è { #validation }\n \n-### –í–∞–ª—ñ–¥–∞—Ü—ñ—è\n * –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ (–∞–±–æ –≤—Å—ñ—Ö?) **—Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö Python**, –∑–æ–∫—Ä–µ–º–∞:\n     * JSON-–æ–±'—î–∫—Ç—ñ–≤ (`dict`).\n-    * JSON-—Å–ø–∏—Å–∫—ñ–≤ (`list`) –∑ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º —Ç–∏–ø—ñ–≤ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.\n-    * –†—è–¥–∫—ñ–≤ (`str`) —ñ–∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—é —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—é –¥–æ–≤–∂–∏–Ω–æ—é.\n-    * –ß–∏—Å–µ–ª (`int`, `float`) –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏—Ö —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å —Ç–æ—â–æ.\n+    * JSON-–º–∞—Å–∏–≤—ñ–≤ (`list`) —ñ–∑ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º —Ç–∏–ø—ñ–≤ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.\n+    * –ü–æ–ª—ñ–≤-—Ä—è–¥–∫—ñ–≤ (`str`) —ñ–∑ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è–º –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –¥–æ–≤–∂–∏–Ω–∏.\n+    * –ß–∏—Å–µ–ª (`int`, `float`) –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ —Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ —Ç–æ—â–æ.\n \n-* –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö —Ç–∏–ø—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫:\n+* –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–ª—è –±—ñ–ª—å—à –µ–∫–∑–æ—Ç–∏—á–Ω–∏—Ö —Ç–∏–ø—ñ–≤, —è–∫-–æ—Ç:\n     * URL.\n     * Email.\n     * UUID.\n     * ...—Ç–∞ —ñ–Ω—à—ñ.\n \n –£—Å—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –Ω–∞–¥—ñ–π–Ω–∏–π —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π **Pydantic**.\n \n-### –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è\n+### –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è { #security-and-authentication }\n \n-**FastAPI** –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤–±—É–¥–æ–≤–∞–Ω—É –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é, –±–µ–∑ –ø—Ä–∏–≤‚Äô—è–∑–∫–∏ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö —á–∏ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö.\n+–Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ –±–µ–∑–ø–µ–∫–∞ —Ç–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è. –ë–µ–∑ –∂–æ–¥–Ω–∏—Ö –∫–æ–º–ø—Ä–æ–º—ñ—Å—ñ–≤ —ñ–∑ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö —á–∏ –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–∏—Ö.\n \n-–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –≤—Å—ñ —Å—Ö–µ–º–∏ –±–µ–∑–ø–µ–∫–∏ OpenAPI, –≤–∫–ª—é—á–∞—é—á–∏:\n+–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è –≤—Å—ñ —Å—Ö–µ–º–∏ –±–µ–∑–ø–µ–∫–∏, –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –≤ OpenAPI, –≤–∫–ª—é—á–Ω–æ –∑:\n \n * HTTP Basic.\n-* **OAuth2** (—Ç–∞–∫–æ–∂ —ñ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é **JWT-—Ç–æ–∫–µ–Ω—ñ–≤**). –î–∏–≤. –ø—ñ–¥—Ä—É—á–Ω–∏–∫: [OAuth2 —ñ–∑ JWT](tutorial/security/oauth2-jwt.md){.internal-link target=_blank}.\n+* **OAuth2** (—Ç–∞–∫–æ–∂ —ñ–∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é **JWT tokens**). –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø—ñ–¥—Ä—É—á–Ω–∏–∫: [OAuth2 —ñ–∑ JWT](tutorial/security/oauth2-jwt.md){.internal-link target=_blank}.\n * –ö–ª—é—á—ñ API –≤:\n     * –ó–∞–≥–æ–ª–æ–≤–∫–∞—Ö.\n     * –ü–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∑–∞–ø–∏—Ç—É.\n     * Cookies —Ç–æ—â–æ.\n \n-–ê —Ç–∞–∫–æ–∂ —É—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –±–µ–∑–ø–µ–∫–∏ –≤—ñ–¥ Starlette (–∑–æ–∫—Ä–µ–º–∞ **—Å–µ—Å—ñ–π–Ω—ñ cookies**).\n+–ê —Ç–∞–∫–æ–∂ —É—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –±–µ–∑–ø–µ–∫–∏ –≤—ñ–¥ Starlette (–∑–æ–∫—Ä–µ–º–∞ **session cookies**).\n \n-–£—Å—ñ –≤–æ–Ω–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ —è–∫ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —è–∫—ñ –ª–µ–≥–∫–æ —ñ–Ω—Ç–µ–≥—Ä—É—é—Ç—å—Å—è –∑ –≤–∞—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏, —Å—Ö–æ–≤–∏—â–∞–º–∏ –¥–∞–Ω–∏—Ö, —Ä–µ–ª—è—Ü—ñ–π–Ω–∏–º–∏ —Ç–∞ NoSQL –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö —Ç–æ—â–æ.\n+–£—Å–µ —Ü–µ –∑—Ä–æ–±–ª–µ–Ω–æ —è–∫ –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —è–∫—ñ –ª–µ–≥–∫–æ —ñ–Ω—Ç–µ–≥—Ä—É—é—Ç—å—Å—è –∑ –≤–∞—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏, —Å—Ö–æ–≤–∏—â–∞–º–∏ –¥–∞–Ω–∏—Ö, —Ä–µ–ª—è—Ü—ñ–π–Ω–∏–º–∏ —Ç–∞ NoSQL –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö —Ç–æ—â–æ.\n \n-### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π\n+### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π { #dependency-injection }\n \n-**FastAPI** –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø—Ä–æ—Å—Ç—É —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ, –∞–ª–µ –ø–æ—Ç—É–∂–Ω—É —Å–∏—Å—Ç–µ–º—É –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.\n+FastAPI –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø—Ä–æ—Å—Ç—É —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ, –∞–ª–µ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø–æ—Ç—É–∂–Ω—É —Å–∏—Å—Ç–µ–º—É <abbr title='—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–µ —è–∫: \"components\", \"resources\", \"services\", \"providers\"'><strong>Dependency Injection</strong></abbr>.\n \n-* –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, —É—Ç–≤–æ—Ä—é—é—á–∏ —ñ—î—Ä–∞—Ä—Ö—ñ—é –∞–±–æ **\"–≥—Ä–∞—Ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π\"**.\n-* –£—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—Ä—É—é—Ç—å—Å—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º.\n-* –£—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–æ–∂—É—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∑ –∑–∞–ø–∏—Ç—ñ–≤ —ñ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ **–æ–±–º–µ–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑–∞ —à–ª—è—Ö–æ–º** —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é.\n-* **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** –Ω–∞–≤—ñ—Ç—å –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ *–æ–ø–µ—Ä–∞—Ü—ñ–π —à–ª—è—Ö—É*, –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö —É –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è—Ö.\n-* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å–∫–ª–∞–¥–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, **–∑'—î–¥–Ω–∞–Ω—å —ñ–∑ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö** —Ç–æ—â–æ.\n-* **–ñ–æ–¥–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å** —â–æ–¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–∞–∑ –¥–∞–Ω–∏—Ö, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ñ–≤ —Ç–æ—â–æ, –∞–ª–µ –≤–æ–¥–Ω–æ—á–∞—Å –ø—Ä–æ—Å—Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —É—Å—ñ–º–∞ –Ω–∏–º–∏.\n+* –ù–∞–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, —É—Ç–≤–æ—Ä—é—é—á–∏ —ñ—î—Ä–∞—Ä—Ö—ñ—é –∞–±–æ **¬´–≥—Ä–∞—Ñ¬ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π**.\n+* –£—Å–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è** —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º.\n+* –£—Å—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–æ–∂—É—Ç—å –≤–∏–º–∞–≥–∞—Ç–∏ –¥–∞–Ω—ñ —ñ–∑ –∑–∞–ø–∏—Ç—ñ–≤ —ñ **—Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É** —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é.\n+* **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** –Ω–∞–≤—ñ—Ç—å –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ *–æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É*, –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö —É –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è—Ö.\n+* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å–∫–ª–∞–¥–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, **–ø—ñ–¥–∫–ª—é—á–µ–Ω—å –¥–æ –±–∞–∑ –¥–∞–Ω–∏—Ö** —Ç–æ—â–æ.\n+* **–ñ–æ–¥–Ω–∏—Ö –∫–æ–º–ø—Ä–æ–º—ñ—Å—ñ–≤** —ñ–∑ –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞–º–∏ —Ç–æ—â–æ. –ê–ª–µ –ø—Ä–æ—Å—Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —É—Å—ñ–º–∞ –Ω–∏–º–∏.\n \n-### –ù–µ–º–∞—î –æ–±–º–µ–∂–µ–Ω—å –Ω–∞ \"–ø–ª–∞–≥—ñ–Ω–∏\"\n+### –ù–µ–æ–±–º–µ–∂–µ–Ω—ñ ¬´–ø–ª–∞–≥—ñ–Ω–∏¬ª { #unlimited-plug-ins }\n \n-–ê–±–æ —ñ–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –≤–æ–Ω–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ ‚Äì –ø—Ä–æ—Å—Ç–æ —ñ–º–ø–æ—Ä—Ç—É–π—Ç–µ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –∫–æ–¥.\n+–Ü–Ω–∞–∫—à–µ –∫–∞–∂—É—á–∏, –≤–æ–Ω–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ ‚Äî —ñ–º–ø–æ—Ä—Ç—É–π—Ç–µ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–¥, —è–∫–∏–π –≤–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω.\n \n-–ë—É–¥—å-—è–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Å–ø—Ä–æ—î–∫—Ç–æ–≤–∞–Ω–∞ –Ω–∞—Å—Ç—ñ–ª—å–∫–∏ –ø—Ä–æ—Å—Ç–æ (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π), —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ \"–ø–ª–∞–≥—ñ–Ω\" –¥–ª—è —Å–≤–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É –≤—Å—å–æ–≥–æ —É 2 —Ä—è–¥–∫–∞—Ö –∫–æ–¥—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—É —Å–∞–º—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —â–æ –π –¥–ª—è –≤–∞—à–∏—Ö *–æ–ø–µ—Ä–∞—Ü—ñ–π —à–ª—è—Ö—É*.\n+–ë—É–¥—å-—è–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Å–ø—Ä–æ—î–∫—Ç–æ–≤–∞–Ω–∞ —Ç–∞–∫, —â–æ–± —ó—ó –±—É–ª–æ –¥—É–∂–µ –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ (—ñ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏), —Ç–æ–∂ –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ ¬´–ø–ª–∞–≥—ñ–Ω¬ª –¥–ª—è —Å–≤–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —É 2 —Ä—è–¥–∫–∞—Ö –∫–æ–¥—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç—É —Å–∞–º—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —â–æ –π –¥–ª—è –≤–∞—à–∏—Ö *–æ–ø–µ—Ä–∞—Ü—ñ–π —à–ª—è—Ö—É*.\n \n-### –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ\n+### –ü—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ { #tested }\n \n * 100% <abbr title=\"–û–±—Å—è–≥ –∫–æ–¥—É, —â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç–µ—Å—Ç—É—î—Ç—å—Å—è\">–ø–æ–∫—Ä–∏—Ç—Ç—è —Ç–µ—Å—Ç–∞–º–∏</abbr>.\n * 100% <abbr title=\"–ê–Ω–æ—Ç–∞—Ü—ñ—ó —Ç–∏–ø—ñ–≤ —É Python, –∑–∞–≤–¥—è–∫–∏ —è–∫–∏–º –≤–∞—à —Ä–µ–¥–∞–∫—Ç–æ—Ä —ñ –∑–æ–≤–Ω—ñ—à–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –º–æ–∂—É—Ç—å –Ω–∞–¥–∞–≤–∞—Ç–∏ –∫—Ä–∞—â—É –ø—ñ–¥—Ç—Ä–∏–º–∫—É\">–∞–Ω–æ—Ç–æ–≤–∞–Ω–∞ —Ç–∏–ø–∞–º–∏</abbr> –∫–æ–¥–æ–≤–∞ –±–∞–∑–∞.\n-* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —É —Ä–æ–±–æ—á–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö.\n+* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ production-–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö.\n \n-## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ Starlette\n+## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ Starlette { #starlette-features }\n \n **FastAPI** –ø–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω–∏–π —ñ–∑ (—Ç–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ) <a href=\"https://www.starlette.dev/\" class=\"external-link\" target=\"_blank\"><strong>Starlette</strong></a>. –¢–æ–º—É –±—É–¥—å-—è–∫–∏–π –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∫–æ–¥ Starlette, —è–∫–∏–π –≤–∏ –º–∞—î—Ç–µ, —Ç–∞–∫–æ–∂ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ.\n \n-**FastAPI** —Ñ–∞–∫—Ç–∏—á–Ω–æ —î –ø—ñ–¥–∫–ª–∞—Å–æ–º **Starlette**. –¢–æ–º—É, —è–∫—â–æ –≤–∏ –≤–∂–µ –∑–Ω–∞–π–æ–º—ñ –∑—ñ Starlette –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –π–æ–≥–æ, –±—ñ–ª—å—à—ñ—Å—Ç—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ —Ç–∞–∫ —Å–∞–º–æ.\n+`FastAPI` —Ñ–∞–∫—Ç–∏—á–Ω–æ —î –ø—ñ–¥–∫–ª–∞—Å–æ–º `Starlette`. –¢–æ–º—É, —è–∫—â–æ –≤–∏ –≤–∂–µ –∑–Ω–∞–π–æ–º—ñ –∑—ñ Starlette –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –π–æ–≥–æ, –±—ñ–ª—å—à—ñ—Å—Ç—å —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ —Ç–∞–∫ —Å–∞–º–æ.\n \n-–ó **FastAPI** –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≤—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ **Starlette** (–∞–¥–∂–µ FastAPI ‚Äî —Ü–µ, –ø–æ —Å—É—Ç—ñ, Starlette –Ω–∞ —Å—Ç–µ—Ä–æ—ó–¥–∞—Ö):\n+–ó **FastAPI** –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≤—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ **Starlette** (–∞–¥–∂–µ FastAPI ‚Äî —Ü–µ –ø—Ä–æ—Å—Ç–æ Starlette –Ω–∞ —Å—Ç–µ—Ä–æ—ó–¥–∞—Ö):\n \n-* –†–∞–∑—é—á–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å. –¶–µ <a href=\"https://github.com/encode/starlette#performance\" class=\"external-link\" target=\"_blank\">–æ–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤ –Ω–∞ Python</a>, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —ñ **Go**.\n+* –†–∞–∑—é—á–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å. –¶–µ <a href=\"https://github.com/encode/starlette#performance\" class=\"external-link\" target=\"_blank\">–æ–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö Python-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —ñ **Go**</a>.\n * –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ **WebSocket**.\n * –§–æ–Ω–æ–≤—ñ –∑–∞–¥–∞—á—ñ —É –ø—Ä–æ—Ü–µ—Å—ñ.\n * –ü–æ–¥—ñ—ó –∑–∞–ø—É—Å–∫—É —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏.\n * –ö–ª—ñ—î–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è, –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π –Ω–∞ HTTPX.\n-* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ **CORS**, **GZip**, —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, –ø–æ—Ç–æ–∫–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.\n-* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ **—Å–µ—Å—ñ–π** —ñ **cookie**.\n+* **CORS**, GZip, Static Files, Streaming responses.\n+* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ **Session and Cookie**.\n\n```", "output": "```suggestion\r\n* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ **CORS**, **GZip**, —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, –ø–æ—Ç–æ–∫–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.\r\n* –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ **—Å–µ—Å—ñ–π** —ñ **cookie**.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 376}
{"instruction": "Fix the following bug: üêõ Fix support for nullable form fields", "input": "Fix support for nullable form fields, differentiate between unspecified and specified as None. See related bug ticket https://github.com/fastapi/fastapi/issues/12245", "output": "```diff\n@@ -87,6 +87,9 @@\n     \"pip install python-multipart\\n\"\n )\n \n+# Sentinel value for unspecified fields\n+_NOT_SPECIFIED = object()\n+\n \n def ensure_multipart_is_installed() -> None:\n     try:\n@@ -690,7 +693,7 @@ async def solve_dependencies(\n def _validate_value_with_model_field(\n     *, field: ModelField, value: Any, values: Dict[str, Any], loc: Tuple[str, ...]\n ) -> Tuple[Any, List[Any]]:\n-    if value is None:\n+    if value is _NOT_SPECIFIED:\n         if field.required:\n             return None, [get_missing_field_error(loc=loc)]\n         else:\n@@ -712,20 +715,24 @@ def _get_multidict_value(\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n-        value = values.get(alias, None)\n+        value = values.get(alias, _NOT_SPECIFIED)\n     if (\n-        value is None\n-        or (\n-            isinstance(field.field_info, params.Form)\n-            and isinstance(value, str)  # For type checks\n-            and value == \"\"\n-        )\n-        or (is_sequence_field(field) and len(value) == 0)\n+        isinstance(field.field_info, params.Form)\n+        and isinstance(value, str)  # For type checks\n+        and value == \"\"\n     ):\n+        # Empty strings in a form can be a representation of None values\n+        _, error = field.validate(None, {}, loc=())\n+        # If None is an accepted value for this field, use that\n+        if error is None:\n+            value = None\n+\n+    if value == _NOT_SPECIFIED or (is_sequence_field(field) and len(value) == 0):\n         if field.required:\n-            return\n+            return _NOT_SPECIFIED\n         else:\n             return deepcopy(field.default)\n+\n     return value\n \n \n@@ -763,7 +770,7 @@ def request_params_to_args(\n                     else field.name.replace(\"_\", \"-\")\n                 )\n         value = _get_multidict_value(field, received_params, alias=alias)\n-        if value is not None:\n+        if value != _NOT_SPECIFIED:\n             params_to_process[field.name] = value\n         processed_keys.add(alias or field.alias)\n         processed_keys.add(field.name)\n@@ -830,6 +837,8 @@ async def _extract_form_body(\n     first_field = body_fields[0]\n     first_field_info = first_field.field_info\n \n+    processed_keys = set()\n+\n     for field in body_fields:\n         value = _get_multidict_value(field, received_body)\n         if (\n@@ -857,10 +866,13 @@ async def process_fn(\n                 for sub_value in value:\n                     tg.start_soon(process_fn, sub_value.read)\n             value = serialize_sequence_value(field=field, value=results)\n-        if value is not None:\n+        if value != _NOT_SPECIFIED:\n             values[field.alias] = value\n+        processed_keys.add(field.alias)\n+        processed_keys.add(field.name)\n+\n     for key, value in received_body.items():\n-        if key not in values:\n+        if key not in processed_keys:\n             values[key] = value\n     return values\n \n@@ -888,15 +900,18\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+from typing import Optional\n+from uuid import UUID, uuid4\n+\n+import pytest\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+default_uuid = uuid4()\n+\n+\n+@app.post(\"/form-optional/\")\n+def post_form_optional(\n+    test_id: Annotated[Optional[UUID], Form(alias=\"testId\")] = default_uuid,\n+) -> Optional[UUID]:\n+    return test_id\n+\n+\n+@app.post(\"/form-required/\")\n+def post_form_required(\n+    test_id: Annotated[Optional[UUID], Form(alias=\"testId\")],\n+) -> Optional[UUID]:\n+    return test_id\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_unspecified_optional() -> None:\n+    response = client.post(\"/form-optional/\", data={})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == str(default_uuid)\n+\n+\n+def test_unspecified_required() -> None:\n+    response = client.post(\"/form-required/\", data={})\n+    assert response.status_code == 422, response.text\n+\n+\n+@pytest.mark.parametrize(\"url\", [\"/form-optional/\", \"/form-required/\"])\n+@pytest.mark.parametrize(\"test_id\", [None, str(uuid4())])\n+def test_specified(url: str, test_id: Optional[str]) -> None:\n+    response = client.post(url, data={\"testId\": test_id})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_id\n\n```\n\n```diff\n@@ -104,13 +104,13 @@ def test_no_data():\n                     \"type\": \"missing\",\n                     \"loc\": [\"body\", \"username\"],\n                     \"msg\": \"Field required\",\n-                    \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                    \"input\": {\"age\": None, \"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n                 },\n                 {\n                     \"type\": \"missing\",\n                     \"loc\": [\"body\", \"lastname\"],\n                     \"msg\": \"Field required\",\n-                    \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                    \"input\": {\"age\": None, \"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n                 },\n             ]\n         }\n\n```\n\n```diff\n@@ -62,7 +62,7 @@ def test_cookie_param_model_invalid(client: TestClient):\n                         \"type\": \"missing\",\n                         \"loc\": [\"cookie\", \"session_id\"],\n                         \"msg\": \"Field required\",\n-                        \"input\": {},\n+                        \"input\": {\"fatebook_tracker\": None, \"googall_tracker\": None},\n                     }\n                 ]\n             }\n\n```\n\n```diff\n@@ -67,7 +67,7 @@ def test_cookie_param_model_invalid(client: TestClient):\n                         \"type\": \"missing\",\n                         \"loc\": [\"cookie\", \"session_id\"],\n                         \"msg\": \"Field required\",\n-                        \"input\": {},\n+                        \"input\": {\"fatebook_tracker\": None, \"googall_tracker\": None},\n                     }\n                 ]\n             }\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 375}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -87,6 +87,9 @@\n     \"pip install python-multipart\\n\"\n )\n \n+# Sentinel value for unspecified fields\n+_NOT_SPECIFIED = object()\n+\n \n def ensure_multipart_is_installed() -> None:\n     try:\n@@ -690,7 +693,7 @@ async def solve_dependencies(\n def _validate_value_with_model_field(\n     *, field: ModelField, value: Any, values: Dict[str, Any], loc: Tuple[str, ...]\n ) -> Tuple[Any, List[Any]]:\n-    if value is None:\n+    if value is _NOT_SPECIFIED:\n         if field.required:\n             return None, [get_missing_field_error(loc=loc)]\n         else:\n@@ -712,20 +715,24 @@ def _get_multidict_value(\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n-        value = values.get(alias, None)\n+        value = values.get(alias, _NOT_SPECIFIED)\n     if (\n-        value is None\n-        or (\n-            isinstance(field.field_info, params.Form)\n-            and isinstance(value, str)  # For type checks\n-            and value == \"\"\n-        )\n-        or (is_sequence_field(field) and len(value) == 0)\n+        isinstance(field.field_info, params.Form)\n+        and isinstance(value, str)  # For type checks\n+        and value == \"\"\n     ):\n+        # Empty strings in a form can be a representation of None values\n+        _, error = field.validate(None, {}, loc=())\n+        # If None is an accepted value for this field, use that\n+        if error is None:\n+            value = None\n+\n+    if value == _NOT_SPECIFIED or (is_sequence_field(field) and len(value) == 0):\n         if field.required:\n-            return\n+            return _NOT_SPECIFIED\n         else:\n             return deepcopy(field.default)\n+\n     return value\n \n \n@@ -763,7 +770,7 @@ def request_params_to_args(\n                     else field.name.replace(\"_\", \"-\")\n                 )\n         value = _get_multidict_value(field, received_params, alias=alias)\n-        if value is not None:\n+        if value != _NOT_SPECIFIED:\n             params_to_process[field.name] = value\n         processed_keys.add(alias or field.alias)\n         processed_keys.add(field.name)\n@@ -830,6 +837,8 @@ async def _extract_form_body(\n     first_field = body_fields[0]\n     first_field_info = first_field.field_info\n \n+    processed_keys = set()\n+\n     for field in body_fields:\n         value = _get_multidict_value(field, received_body)\n         if (\n@@ -857,10 +866,13 @@ async def process_fn(\n                 for sub_value in value:\n                     tg.start_soon(process_fn, sub_value.read)\n             value = serialize_sequence_value(field=field, value=results)\n-        if value is not None:\n+        if value != _NOT_SPECIFIED:\n             values[field.alias] = value\n+        processed_keys.add(field.alias)\n+        processed_keys.add(field.name)\n+\n     for key, value in received_body.items():\n-        if key not in values:\n+        if key not in processed_keys:\n             values[key] = value\n     return values\n \n@@ -888,15 +900,18\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+from typing import Optional\n+from uuid import UUID, uuid4\n+\n+import pytest\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+default_uuid = uuid4()\n+\n+\n+@app.post(\"/form-optional/\")\n+def post_form_optional(\n+    test_id: Annotated[Optional[UUID], Form(alias=\"testId\")] = default_uuid,\n+) -> Optional[UUID]:\n+    return test_id\n+\n+\n+@app.post(\"/form-required/\")\n+def post_form_required(\n+    test_id: Annotated[Optional[UUID], Form(alias=\"testId\")],\n+) -> Optional[UUID]:\n+    return test_id\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_unspecified_optional() -> None:\n+    response = client.post(\"/form-optional/\", data={})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == str(default_uuid)\n+\n+\n+def test_unspecified_required() -> None:\n+    response = client.post(\"/form-required/\", data={})\n+    assert response.status_code == 422", "output": "Bug: üêõ Fix support for nullable form fields\n\nFix support for nullable form fields, differentiate between unspecified and specified as None. See related bug ticket https://github.com/fastapi/fastapi/issues/12245", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 375}
{"instruction": "Review the following code changes: üêõ Fix support for nullable form fields", "input": "```diff\n@@ -87,6 +87,9 @@\n     \"pip install python-multipart\\n\"\n )\n \n+# Sentinel value for unspecified fields\n+_NOT_SPECIFIED = object()\n+\n \n def ensure_multipart_is_installed() -> None:\n     try:\n@@ -690,7 +693,7 @@ async def solve_dependencies(\n def _validate_value_with_model_field(\n     *, field: ModelField, value: Any, values: Dict[str, Any], loc: Tuple[str, ...]\n ) -> Tuple[Any, List[Any]]:\n-    if value is None:\n+    if value is _NOT_SPECIFIED:\n         if field.required:\n             return None, [get_missing_field_error(loc=loc)]\n         else:\n@@ -712,20 +715,24 @@ def _get_multidict_value(\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n-        value = values.get(alias, None)\n+        value = values.get(alias, _NOT_SPECIFIED)\n     if (\n-        value is None\n-        or (\n-            isinstance(field.field_info, params.Form)\n-            and isinstance(value, str)  # For type checks\n-            and value == \"\"\n-        )\n-        or (is_sequence_field(field) and len(value) == 0)\n+        isinstance(field.field_info, params.Form)\n+        and isinstance(value, str)  # For type checks\n+        and value == \"\"\n     ):\n+        # Empty strings in a form can be a representation of None values\n+        _, error = field.validate(None, {}, loc=())\n+        # If None is an accepted value for this field, use that\n+        if error is None:\n+            value = None\n+\n+    if value == _NOT_SPECIFIED or (is_sequence_field(field) and len(value) == 0):\n         if field.required:\n-            return\n+            return _NOT_SPECIFIED\n         else:\n             return deepcopy(field.default)\n+\n     return value\n \n \n@@ -763,7 +770,7 @@ def request_params_to_args(\n                     else field.name.replace(\"_\", \"-\")\n                 )\n         value = _get_multidict_value(field, received_params, alias=alias)\n-        if value is not None:\n+        if value != _NOT_SPECIFIED:\n             params_to_process[field.name] = value\n         processed_keys.add(alias or field.alias)\n         processed_keys.add(field.name)\n@@ -830,6 +837,8 @@ async def _extract_form_body(\n     first_field = body_fields[0]\n     first_field_info = first_field.field_info\n \n+    processed_keys = set()\n+\n     for field in body_fields:\n         value = _get_multidict_value(field, received_body)\n         if (\n@@ -857,10 +866,13 @@ async def process_fn(\n                 for sub_value in value:\n                     tg.start_soon(process_fn, sub_value.read)\n             value = serialize_sequence_value(field=field, value=results)\n-        if value is not None:\n+        if value != _NOT_SPECIFIED:\n             values[field.alias] = value\n+        processed_keys.add(field.alias)\n+        processed_keys.add(field.name)\n+\n     for key, value in received_body.items():\n-        if key not in values:\n+        if key not in processed_keys:\n             values[key] = value\n     return values\n \n@@ -888,15 +900,18\n\n```\n\n```diff\n@@ -0,0 +1,47 @@\n+from typing import Optional\n+from uuid import UUID, uuid4\n+\n+import pytest\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from typing_extensions import Annotated\n+\n+app = FastAPI()\n+\n+default_uuid = uuid4()\n+\n+\n+@app.post(\"/form-optional/\")\n+def post_form_optional(\n+    test_id: Annotated[Optional[UUID], Form(alias=\"testId\")] = default_uuid,\n+) -> Optional[UUID]:\n+    return test_id\n+\n+\n+@app.post(\"/form-required/\")\n+def post_form_required(\n+    test_id: Annotated[Optional[UUID], Form(alias=\"testId\")],\n+) -> Optional[UUID]:\n+    return test_id\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_unspecified_optional() -> None:\n+    response = client.post(\"/form-optional/\", data={})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == str(default_uuid)\n+\n+\n+def test_unspecified_required() -> None:\n+    response = client.post(\"/form-required/\", data={})\n+    assert response.status_code == 422, response.text\n+\n+\n+@pytest.mark.parametrize(\"url\", [\"/form-optional/\", \"/form-required/\"])\n+@pytest.mark.parametrize(\"test_id\", [None, str(uuid4())])\n+def test_specified(url: str, test_id: Optional[str]) -> None:\n+    response = client.post(url, data={\"testId\": test_id})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_id\n\n```\n\n```diff\n@@ -104,13 +104,13 @@ def test_no_data():\n                     \"type\": \"missing\",\n                     \"loc\": [\"body\", \"username\"],\n                     \"msg\": \"Field required\",\n-                    \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                    \"input\": {\"age\": None, \"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n                 },\n                 {\n                     \"type\": \"missing\",\n                     \"loc\": [\"body\", \"lastname\"],\n                     \"msg\": \"Field required\",\n-                    \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                    \"input", "output": "Code Review for: üêõ Fix support for nullable form fields\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n    if value is _NOT_SPECIFIED or value == \"\":\r\n```\r\n\r\nChanging it to this also fixes my issue: https://github.com/fastapi/fastapi/discussions/13255\r\n\r\nIt looks like `request_body_to_args` was refactored to `_validate_value_with_model_field` in https://github.com/fastapi/fastapi/pull/12117/files but it dropped the empty string case.\r\n\r\nNote that just fixing this line isn't enough for the empty string case, the changes in this PR are also required.\n\nüìù **fastapi/dependencies/utils.py**: @tonyay163 Your issue seems unrelated though. The fact that you pass an empty string and it is parsed as an empty string (instead of `None`) sounds more like a feature than a bug...\n\nüìù **fastapi/dependencies/utils.py**: breaking changes are features? this worked in a previous version but does not anymore. how can this be used by so many people and have breaking changes from a refactor?\n\nüìù **fastapi/dependencies/utils.py**: You are right that the behaviour has changed, but for me the behaviour is correct now and was incorrect in the past. That's why I called it a feature, cause for me the behaviour was \"buggy\" before :)\r\n\r\nAnyway, my opinion on your issue doesn't really matter. My point here was that your issue is \"unrelated\" to this PR. This PR is about broken functionality, about not being able to have optional Form fields at all.\r\nHow an optional Form field should be parsed is (imho) a different (very opinionated) discussion.\n\nüìù **fastapi/dependencies/utils.py**: Could you please clarify why you removed the `or (is_sequence_field(field) and len(value) == 0)` part from this condition?\n\n", "source": "pr", "type": "code_review", "pr_number": 375}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -690,7 +693,7 @@ async def solve_dependencies(\n def _validate_value_with_model_field(\n     *, field: ModelField, value: Any, values: Dict[str, Any], loc: Tuple[str, ...]\n ) -> Tuple[Any, List[Any]]:\n-    if value is None:\n+    if value is _NOT_SPECIFIED:\n\n```", "output": "```suggestion\r\n    if value is _NOT_SPECIFIED or value == \"\":\r\n```\r\n\r\nChanging it to this also fixes my issue: https://github.com/fastapi/fastapi/discussions/13255\r\n\r\nIt looks like `request_body_to_args` was refactored to `_validate_value_with_model_field` in https://github.com/fastapi/fastapi/pull/12117/files but it dropped the empty string case.\r\n\r\nNote that just fixing this line isn't enough for the empty string case, the changes in this PR are also required.", "source": "pr_review", "type": "inline_review", "pr_number": 375}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -712,20 +715,24 @@ def _get_multidict_value(\n     if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n         value = values.getlist(alias)\n     else:\n-        value = values.get(alias, None)\n+        value = values.get(alias, _NOT_SPECIFIED)\n     if (\n-        value is None\n-        or (\n-            isinstance(field.field_info, params.Form)\n-            and isinstance(value, str)  # For type checks\n-            and value == \"\"\n-        )\n-        or (is_sequence_field(field) and len(value) == 0)\n+        isinstance(field.field_info, params.Form)\n+        and isinstance(value, str)  # For type checks\n+        and value == \"\"\n\n```", "output": "Could you please clarify why you removed the `or (is_sequence_field(field) and len(value) == 0)` part from this condition?", "source": "pr_review", "type": "inline_review", "pr_number": 375}
{"instruction": "Review the following code changes: ‚ú® Don't revalidate the response content if it is of the same type as `response_model`", "input": "```diff\n@@ -190,6 +190,7 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n async def serialize_response(\n     *,\n     field: Optional[ModelField] = None,\n+    response_model: Any = Default(None),\n     response_content: Any,\n     include: Optional[IncEx] = None,\n     exclude: Optional[IncEx] = None,\n@@ -200,7 +201,10 @@ async def serialize_response(\n     is_coroutine: bool = True,\n     endpoint_ctx: Optional[EndpointContext] = None,\n ) -> Any:\n-    if field:\n+    if not field:\n+        return jsonable_encoder(response_content)\n+\n+    if type(response_content) is not response_model:\n         errors = []\n         if is_coroutine:\n             value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n@@ -227,9 +231,18 @@ async def serialize_response(\n             exclude_defaults=exclude_defaults,\n             exclude_none=exclude_none,\n         )\n-\n     else:\n-        return jsonable_encoder(response_content)\n+        value = response_content\n+\n+    return jsonable_encoder(\n+        value,\n+        include=include,\n+        exclude=exclude,\n+        by_alias=by_alias,\n+        exclude_unset=exclude_unset,\n+        exclude_defaults=exclude_defaults,\n+        exclude_none=exclude_none,\n+    )\n \n \n async def run_endpoint_function(\n@@ -251,6 +264,7 @@ def get_request_handler(\n     status_code: Optional[int] = None,\n     response_class: Union[type[Response], DefaultPlaceholder] = Default(JSONResponse),\n     response_field: Optional[ModelField] = None,\n+    response_model: Any = Default(None),\n     response_model_include: Optional[IncEx] = None,\n     response_model_exclude: Optional[IncEx] = None,\n     response_model_by_alias: bool = True,\n@@ -377,6 +391,7 @@ async def app(request: Request) -> Response:\n                 content = await serialize_response(\n                     field=response_field,\n                     response_content=raw_response,\n+                    response_model=response_model,\n                     include=response_model_include,\n                     exclude=response_model_exclude,\n                     by_alias=response_model_by_alias,\n@@ -644,6 +659,7 @@ def get_route_handler(self) -> Callable[[Request], Coroutine[Any, Any, Response]\n             status_code=self.status_code,\n             response_class=self.response_class,\n             response_field=self.secure_cloned_response_field,\n+            response_model=self.response_model,\n             response_model_include=self.response_model_include,\n             response_model_exclude=self.response_model_exclude,\n             response_model_by_alias=self.response_model_by_alias,\n\n```\n\n```diff\n@@ -1,6 +1,7 @@\n from typing import Optional\n \n from fastapi import FastAPI\n+from fastapi._compat import PYDANTIC_V2\n from pydantic import BaseModel, Field\n from starlette.testclient import TestClient\n \n@@ -152,3 +153,23 @@ def test_validdict_exclude_unset():\n         \"k2\": {\"aliased_name\": \"bar\", \"price\": 1.0},\n         \"k3\": {\"aliased_name\": \"baz\", \"price\": 2.0, \"owner_ids\": [1, 2, 3]},\n     }\n+\n+\n+if not PYDANTIC_V2:\n+    from pydantic import validator\n+\n+    class AutoIncrement(BaseModel):\n+        count: int\n+\n+        @validator(\"count\")\n+        def auto_increment(cls, count: int):\n+            return count + 1\n+\n+    @app.post(\"/increment\", response_model=AutoIncrement)\n+    async def increment():\n+        return AutoIncrement(count=0)\n+\n+    def test_response_model_should_not_revalidate_response_content_if_they_had_same_type():\n+        response = client.post(\"/increment\")\n+        response.raise_for_status()\n+        assert response.json() == {\"count\": 1}\n\n```\n\n```diff\n@@ -116,25 +117,28 @@ async def serialize_response(\n     is_coroutine: bool = True,\n ) -> Any:\n     if field:\n\n```\n\n```diff\n@@ -116,25 +117,28 @@ async def serialize_response(\n     is_coroutine: bool = True,\n ) -> Any:\n     if field:\n\n```\n\n```diff\n@@ -116,40 +116,41 @@ async def serialize_response(\n     exclude_none: bool = False,\n     is_coroutine: bool = True,\n ) -> Any:\n-    if field:\n-        if type(response_content) is not response_model:\n-            errors = []\n-            response_content = _prepare_response_content(\n-                response_content,\n-                exclude_unset=exclude_unset,\n-                exclude_defaults=exclude_defaults,\n-                exclude_none=exclude_none,\n-            )\n-            if is_coroutine:\n-                value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n-            else:\n-                value, errors_ = await run_in_threadpool(\n-                    field.validate, response_content, {}, loc=(\"response\",)\n-                )\n-            if isinstance(errors_, ErrorWrapper):\n-                errors.append(errors_)\n-            elif isinstance(errors_, list):\n-                errors.extend(errors_)\n-            if errors:\n-                raise ValidationError(errors, field.type_)\n-        else:\n-            value = response_content\n-        return jsonable_encoder(\n-        ", "output": "Code Review for: ‚ú® Don't revalidate the response content if it is of the same type as `response_model`\n\nüìù **fastapi/routing.py**: ```py\r\nif not field:\r\n    return jsonable_encoder(response_content)\r\n```\r\nTo decrease the indentation level. The pattern is called early return.\n\nüìù **fastapi/routing.py**: good point\n\nüìù **fastapi/routing.py**: Reverse the condition and return early.\r\n\r\n```py\r\nif type(response_content) is response_model:\r\n    return jsonable_encoder(\r\n        response_content,\r\n        include=include,\r\n        exclude=exclude,\r\n        by_alias=by_alias,\r\n        exclude_unset=exclude_unset,\r\n        exclude_defaults=exclude_defaults,\r\n        exclude_none=exclude_none,\r\n    )\r\n\r\n# put all logics that are in your if statement implementation here.\r\n```\n\nüìù **fastapi/routing.py**:  Put this case together with `type(response_content) is not response_model` is more clear, they should share the same encoding (`jsonable_encoder`) process.\n\nüìù **tests/test_serialize_response_model.py**: not sure if there's a better way to test this üòä\r\n\r\n@kaiix I know this is an old PR, but feel free to suggest something :D \n\n", "source": "pr", "type": "code_review", "pr_number": 374}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -116,25 +117,28 @@ async def serialize_response(\n     is_coroutine: bool = True,\n ) -> Any:\n     if field:\n\n```", "output": "```py\r\nif not field:\r\n    return jsonable_encoder(response_content)\r\n```\r\nTo decrease the indentation level. The pattern is called early return.", "source": "pr_review", "type": "inline_review", "pr_number": 374}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -116,40 +116,41 @@ async def serialize_response(\n     exclude_none: bool = False,\n     is_coroutine: bool = True,\n ) -> Any:\n-    if field:\n-        if type(response_content) is not response_model:\n-            errors = []\n-            response_content = _prepare_response_content(\n-                response_content,\n-                exclude_unset=exclude_unset,\n-                exclude_defaults=exclude_defaults,\n-                exclude_none=exclude_none,\n-            )\n-            if is_coroutine:\n-                value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n-            else:\n-                value, errors_ = await run_in_threadpool(\n-                    field.validate, response_content, {}, loc=(\"response\",)\n-                )\n-            if isinstance(errors_, ErrorWrapper):\n-                errors.append(errors_)\n-            elif isinstance(errors_, list):\n-                errors.extend(errors_)\n-            if errors:\n-                raise ValidationError(errors, field.type_)\n-        else:\n-            value = response_content\n-        return jsonable_encoder(\n-            value,\n-            include=include,\n-            exclude=exclude,\n-            by_alias=by_alias,\n+    if not field:\n+        return jsonable_encoder(response_content)\n+\n+    if type(response_content) is not response_model:\n\n```", "output": "Reverse the condition and return early.\r\n\r\n```py\r\nif type(response_content) is response_model:\r\n    return jsonable_encoder(\r\n        response_content,\r\n        include=include,\r\n        exclude=exclude,\r\n        by_alias=by_alias,\r\n        exclude_unset=exclude_unset,\r\n        exclude_defaults=exclude_defaults,\r\n        exclude_none=exclude_none,\r\n    )\r\n\r\n# put all logics that are in your if statement implementation here.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 374}
{"instruction": "Review this code change in `tests/test_serialize_response_model.py`", "input": "```diff\n@@ -152,3 +153,32 @@ def test_validdict_exclude_unset():\n         \"k2\": {\"aliased_name\": \"bar\", \"price\": 1.0},\n         \"k3\": {\"aliased_name\": \"baz\", \"price\": 2.0, \"owner_ids\": [1, 2, 3]},\n     }\n+\n+\n+class Toggle(BaseModel):\n+    switch: bool\n+\n+    if PYDANTIC_V2:\n+        from pydantic import field_validator\n+\n+        @field_validator(\"switch\")\n+        def toggle_switch(cls, switch: bool):\n+            return not switch\n+\n+    else:\n+        from pydantic import validator\n+\n+        @validator(\"switch\")\n+        def toggle_switch(cls, v):\n+            return not v\n\n```", "output": "not sure if there's a better way to test this üòä\r\n\r\n@kaiix I know this is an old PR, but feel free to suggest something :D ", "source": "pr_review", "type": "inline_review", "pr_number": 374}
{"instruction": "Review this code change in `tests/test_serialize_response_model.py`", "input": "```diff\n@@ -152,3 +153,23 @@ def test_validdict_exclude_unset():\n         \"k2\": {\"aliased_name\": \"bar\", \"price\": 1.0},\n         \"k3\": {\"aliased_name\": \"baz\", \"price\": 2.0, \"owner_ids\": [1, 2, 3]},\n     }\n+\n+\n+if not PYDANTIC_V2:\n+    from pydantic import validator\n+\n+    class AutoIncrement(BaseModel):\n+        count: int\n+\n+        @validator(\"count\")\n+        def auto_increment(cls, count: int):\n+            return count + 1\n+\n+    @app.post(\"/increment\", response_model=AutoIncrement)\n+    async def increment():\n+        return AutoIncrement(count=0)\n+\n+    def test_response_model_should_not_revalidate_response_content_if_they_had_same_type():\n+        response = client.post(\"/increment\")\n+        response.raise_for_status()\n+        assert response.json() == {\"count\": 1}\n\n```", "output": "Just to confirm: on `master` and with Pydantic 1.10.22, this fails with \r\n```\r\nAssertionError: assert {'count': 2} == {'count': 1}\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 374}
{"instruction": "Review the following code changes: üë• Update FastAPI People - Contributors and Translators", "input": "```diff\n@@ -1,17 +1,17 @@\n tiangolo:\n   login: tiangolo\n-  count: 857\n+  count: 871\n   avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n   url: https://github.com/tiangolo\n dependabot:\n   login: dependabot\n-  count: 130\n+  count: 133\n   avatarUrl: https://avatars.githubusercontent.com/in/29110?v=4\n   url: https://github.com/apps/dependabot\n alejsdev:\n   login: alejsdev\n   count: 53\n-  avatarUrl: https://avatars.githubusercontent.com/u/90076947?u=85ceac49fb87138aebe8d663912e359447329090&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/90076947?u=0facffe3abf87f57a1f05fa773d1119cc5c2f6a5&v=4\n   url: https://github.com/alejsdev\n pre-commit-ci:\n   login: pre-commit-ci\n@@ -20,8 +20,8 @@ pre-commit-ci:\n   url: https://github.com/apps/pre-commit-ci\n YuriiMotov:\n   login: YuriiMotov\n-  count: 36\n-  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=b9b13d598dddfab529a52d264df80a900bfe7060&v=4\n+  count: 38\n+  avatarUrl: https://avatars.githubusercontent.com/u/109919500?u=bc48be95c429989224786106b027f3c5e40cc354&v=4\n   url: https://github.com/YuriiMotov\n github-actions:\n   login: github-actions\n@@ -40,7 +40,7 @@ dmontagu:\n   url: https://github.com/dmontagu\n svlandeg:\n   login: svlandeg\n-  count: 16\n+  count: 17\n   avatarUrl: https://avatars.githubusercontent.com/u/8796347?u=556c97650c27021911b0b9447ec55e75987b0e8a&v=4\n   url: https://github.com/svlandeg\n nilslindemann:\n@@ -126,7 +126,7 @@ hitrust:\n ShahriyarR:\n   login: ShahriyarR\n   count: 4\n-  avatarUrl: https://avatars.githubusercontent.com/u/3852029?u=631b2ae59360ab380c524b32bc3d245aff1165af&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/3852029?u=2dc6402d9053ee53f7afc407089cbab21c68f21d&v=4\n   url: https://github.com/ShahriyarR\n adriangb:\n   login: adriangb\n@@ -266,7 +266,7 @@ Nimitha-jagadeesha:\n lucaromagnoli:\n   login: lucaromagnoli\n   count: 3\n-  avatarUrl: https://avatars.githubusercontent.com/u/38782977?u=15df02e806a2293af40ac619fba11dbe3c0c4fd4&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/38782977?u=a09a2e916625fa035f9dfa25ebc58e07aac8ec36&v=4\n   url: https://github.com/lucaromagnoli\n salmantec:\n   login: salmantec\n@@ -521,7 +521,7 @@ s111d:\n estebanx64:\n   login: estebanx64\n   count: 2\n-  avatarUrl: https://avatars.githubusercontent.com/u/10840422?u=1900887aeed268699e5ea6f3fb7db614f7b77cd3&v=4\n+  avatarUrl: https://avatars.githubusercontent.com/u/10840422?u=812422ae5d6a4bc5ff331c901fc54f9ab3cecf5c&v=4\n   url: https://github.com/estebanx64\n ndimares:\n   login: ndimares\n\n```\n\n```diff\n@@ -10,12 +10,12 @@ Xewus:\n   url: https://github.com/Xewus\n sodaMelon:\n   login: sodaMelon\n-  count: 127\n+  count: 128\n   avatarUrl: https://avatars.githubusercontent.com/u/66295123?u=be939db90f1119efee9e6110cc05066ff1f40f00&v=4\n   url: https://github.com/sodaMelon\n ceb10n:\n   login: ceb10n\n-  count: 117\n+  count: 119\n   avatarUrl: https://avatars.githubusercontent.com/u/235213?u=edcce471814a1eba9f0cdaa4cd0de18921a940a6&v=4\n   url: https://github.com/ceb10n\n tokusumi:\n@@ -25,7 +25,7 @@ tokusumi:\n   url: https://github.com/tokusumi\n hard-coders:\n   login: hard-coders\n-  count: 96\n+  count: 102\n   avatarUrl: https://avatars.githubusercontent.com/u/9651103?u=78d12d1acdf853c817700145e73de7fd9e5d068b&v=4\n   url: https://github.com/hard-coders\n hasansezertasan:\n@@ -50,34 +50,39 @@ AlertRED:\n   url: https://github.com/AlertRED\n tiangolo:\n   login: tiangolo\n-  count: 73\n+  count: 78\n   avatarUrl: https://avatars.githubusercontent.com/u/1326112?u=cb5d06e73a9e1998141b1641aa88e443c6717651&v=4\n   url: https://github.com/tiangolo\n Alexandrhub:\n   login: Alexandrhub\n   count: 68\n   avatarUrl: https://avatars.githubusercontent.com/u/119126536?u=9fc0d48f3307817bafecc5861eb2168401a6cb04&v=4\n   url: https://github.com/Alexandrhub\n+cassiobotaro:\n+  login: cassiobotaro\n+  count: 64\n+  avatarUrl: https://avatars.githubusercontent.com/u/3127847?u=a08022b191ddbd0a6159b2981d9d878b6d5bb71f&v=4\n+  url: https://github.com/cassiobotaro\n waynerv:\n   login: waynerv\n   count: 63\n   avatarUrl: https://avatars.githubusercontent.com/u/39515546?u=ec35139777597cdbbbddda29bf8b9d4396b429a9&v=4\n   url: https://github.com/waynerv\n-cassiobotaro:\n-  login: cassiobotaro\n-  count: 62\n-  avatarUrl: https://avatars.githubusercontent.com/u/3127847?u=a08022b191ddbd0a6159b2981d9d878b6d5bb71f&v=4\n-  url: https://github.com/cassiobotaro\n+nilslindemann:\n+  login: nilslindemann\n+  count: 61\n+  avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n+  url: https://github.com/nilslindemann\n mattwang44:\n   login: mattwang44\n   count: 61\n   avatarUrl: https://avatars.githubusercontent.com/u/24987826?u=58e37fb3927b9124b458945ac4c97aa0f1062d85&v=4\n   url: https://github.com/mattwang44\n-nilslindemann:\n-  login: nilslindemann\n-  count: 59\n-  avatarUrl: https://avatars.githubusercontent.com/u/6892179?u=1dca6a22195d6cd1ab20737c0e19a4c55d639472&v=4\n-  url: https://github.com/nilslindemann", "output": "Changes look good. This PR implements: üë• Update FastAPI People - Contributors and Translators", "source": "pr", "type": "code_review", "pr_number": 373}
{"instruction": "Review the following code changes: üë• Update FastAPI GitHub topic repositories", "input": "```diff\n@@ -1,176 +1,181 @@\n - name: full-stack-fastapi-template\n   html_url: https://github.com/fastapi/full-stack-fastapi-template\n-  stars: 40334\n+  stars: 41312\n   owner_login: fastapi\n   owner_html_url: https://github.com/fastapi\n - name: Hello-Python\n   html_url: https://github.com/mouredev/Hello-Python\n-  stars: 33628\n+  stars: 34206\n   owner_login: mouredev\n   owner_html_url: https://github.com/mouredev\n - name: serve\n   html_url: https://github.com/jina-ai/serve\n-  stars: 21817\n+  stars: 21832\n   owner_login: jina-ai\n   owner_html_url: https://github.com/jina-ai\n - name: HivisionIDPhotos\n   html_url: https://github.com/Zeyi-Lin/HivisionIDPhotos\n-  stars: 20409\n+  stars: 20661\n   owner_login: Zeyi-Lin\n   owner_html_url: https://github.com/Zeyi-Lin\n - name: sqlmodel\n   html_url: https://github.com/fastapi/sqlmodel\n-  stars: 17415\n+  stars: 17567\n   owner_login: fastapi\n   owner_html_url: https://github.com/fastapi\n - name: fastapi-best-practices\n   html_url: https://github.com/zhanymkanov/fastapi-best-practices\n-  stars: 15776\n+  stars: 16291\n   owner_login: zhanymkanov\n   owner_html_url: https://github.com/zhanymkanov\n - name: Douyin_TikTok_Download_API\n   html_url: https://github.com/Evil0ctal/Douyin_TikTok_Download_API\n-  stars: 15588\n+  stars: 16132\n   owner_login: Evil0ctal\n   owner_html_url: https://github.com/Evil0ctal\n-- name: machine-learning-zoomcamp\n-  html_url: https://github.com/DataTalksClub/machine-learning-zoomcamp\n-  stars: 12447\n-  owner_login: DataTalksClub\n-  owner_html_url: https://github.com/DataTalksClub\n - name: SurfSense\n   html_url: https://github.com/MODSetter/SurfSense\n-  stars: 12128\n+  stars: 12723\n   owner_login: MODSetter\n   owner_html_url: https://github.com/MODSetter\n+- name: machine-learning-zoomcamp\n+  html_url: https://github.com/DataTalksClub/machine-learning-zoomcamp\n+  stars: 12575\n+  owner_login: DataTalksClub\n+  owner_html_url: https://github.com/DataTalksClub\n - name: fastapi_mcp\n   html_url: https://github.com/tadata-org/fastapi_mcp\n-  stars: 11326\n+  stars: 11478\n   owner_login: tadata-org\n   owner_html_url: https://github.com/tadata-org\n - name: awesome-fastapi\n   html_url: https://github.com/mjhea0/awesome-fastapi\n-  stars: 10901\n+  stars: 11018\n   owner_login: mjhea0\n   owner_html_url: https://github.com/mjhea0\n - name: XHS-Downloader\n   html_url: https://github.com/JoeanAmier/XHS-Downloader\n-  stars: 9584\n+  stars: 9938\n   owner_login: JoeanAmier\n   owner_html_url: https://github.com/JoeanAmier\n - name: polar\n   html_url: https://github.com/polarsource/polar\n-  stars: 8951\n+  stars: 9348\n   owner_login: polarsource\n   owner_html_url: https://github.com/polarsource\n - name: FastUI\n   html_url: https://github.com/pydantic/FastUI\n-  stars: 8934\n+  stars: 8949\n   owner_login: pydantic\n   owner_html_url: https://github.com/pydantic\n - name: FileCodeBox\n   html_url: https://github.com/vastsa/FileCodeBox\n-  stars: 7934\n+  stars: 8060\n   owner_login: vastsa\n   owner_html_url: https://github.com/vastsa\n - na\n\n```", "output": "Changes look good. This PR implements: üë• Update FastAPI GitHub topic repositories", "source": "pr", "type": "code_review", "pr_number": 372}
{"instruction": "Fix the following bug: fix: enable mounting sub-applications under APIRouter", "input": "## Summary\nFixes #10180\n\nWhen mounting a sub-application on an `APIRouter` with a prefix, the mount wasn't accessible at the expected path. The router's prefix wasn't being applied to mounts.\n\n## Changes\n1. Override `mount()` in `APIRouter` to automatically apply the router's prefix\n2. Handle `Mount` routes in `include_router()` to apply the include prefix\n\n## Usage\nEnables patterns like:\n```python\nrouter = APIRouter(prefix='/api')\nrouter.mount('/subapp', FastAPI())\napp.include_router(router)\n# Sub-app is now accessible at /api/subapp/...\n```\n\nNote: Mounts must be added before `include_router()` is called.\n\n## Testing\nAdded comprehensive tests in `tests/test_router_mount.py`", "output": "```diff\n@@ -928,6 +928,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(\n+        self,\n+        path: str,\n+        app: ASGIApp,\n+        name: Optional[str] = None,\n+    ) -> None:\n+        \"\"\"\n+        Mount a sub-application or ASGI app at the given path.\n+\n+        The router's prefix is automatically applied to the mount path.\n+        \"\"\"\n+        # Apply the router's prefix to the mount path\n+        super().mount(self.prefix + path, app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1423,6 +1437,9 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, Mount):\n+                # Handle mounted sub-applications by re-mounting with the prefix\n+                self.mount(prefix + route.path, route.app, name=route.name)\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,133 @@\n+\"\"\"Test mounting sub-applications under APIRouter.\"\"\"\n+\n+from fastapi import APIRouter, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_router_mount_basic():\n+    \"\"\"Sub-applications mounted on a router should work when included in the app.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/main\")\n+    def read_main():\n+        return {\"message\": \"Hello from main\"}\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/sub\")\n+    def read_sub():\n+        return {\"message\": \"Hello from sub\"}\n+\n+    # Mount BEFORE include_router\n+    api_router.mount(\"/subapi\", subapi)\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Main route should work\n+    response = client.get(\"/api/main\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"Hello from main\"}\n+\n+    # Sub-application route should also work\n+    response = client.get(\"/api/subapi/sub\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"Hello from sub\"}\n+\n+\n+def test_router_mount_with_include_prefix():\n+    \"\"\"Mount path should combine with both router prefix and include_router prefix.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/v1\")\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/endpoint\")\n+    def sub_endpoint():\n+        return {\"version\": \"1\"}\n+\n+    api_router.mount(\"/mounted\", subapi)\n+    app.include_router(api_router, prefix=\"/api\")\n+\n+    client = TestClient(app)\n+\n+    # Full path: /api + /v1 + /mounted + /endpoint\n+    response = client.get(\"/api/v1/mounted/endpoint\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"version\": \"1\"}\n+\n+\n+def test_router_mount_without_prefix():\n+    \"\"\"Mount should work on router without prefix.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter()  # No prefix\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/hello\")\n+    def hello():\n+        return {\"hello\": \"world\"}\n+\n+    api_router.mount(\"/sub\", subapi)\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    response = client.get(\"/sub/hello\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"hello\": \"world\"}\n+\n+\n+def test_router_mount_applies_router_prefix():\n+    \"\"\"Mount path should include the router's prefix.\"\"\"\n+    router = APIRouter(prefix=\"/api\")\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/test\")\n+    def test_route():\n+        return {\"test\": True}\n+\n+    router.mount(\"/mounted\", subapi)\n+\n+    # Check that the mount path includes the router prefix\n+    mount_route = None\n+    for route in router.routes:\n+        if hasattr(route, \"path\") and \"mounted\" in route.path:\n+            mount_route = route\n+            break\n+\n+    assert mount_route is not None\n+    assert mount_route.path == \"/api/mounted\"\n+\n+\n+def test_router_mount_multiple_subapps():\n+    \"\"\"Multiple sub-applications can be mounted on the same router.\"\"\"\n+    app = FastAPI()\n+    api_\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 371}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -928,6 +928,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(\n+        self,\n+        path: str,\n+        app: ASGIApp,\n+        name: Optional[str] = None,\n+    ) -> None:\n+        \"\"\"\n+        Mount a sub-application or ASGI app at the given path.\n+\n+        The router's prefix is automatically applied to the mount path.\n+        \"\"\"\n+        # Apply the router's prefix to the mount path\n+        super().mount(self.prefix + path, app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1423,6 +1437,9 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, Mount):\n+                # Handle mounted sub-applications by re-mounting with the prefix\n+                self.mount(prefix + route.path, route.app, name=route.name)\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,133 @@\n+\"\"\"Test mounting sub-applications under APIRouter.\"\"\"\n+\n+from fastapi import APIRouter, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_router_mount_basic():\n+    \"\"\"Sub-applications mounted on a router should work when included in the app.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/main\")\n+    def read_main():\n+        return {\"message\": \"Hello from main\"}\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/sub\")\n+    def read_sub():\n+        return {\"message\": \"Hello from sub\"}\n+\n+    # Mount BEFORE include_router\n+    api_router.mount(\"/subapi\", subapi)\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Main route should work\n+    response = client.get(\"/api/main\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"Hello from main\"}\n+\n+    # Sub-application route should also work\n+    response = client.get(\"/api/subapi/sub\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"Hello from sub\"}\n+\n+\n+def test_router_mount_with_include_prefix():\n+    \"\"\"Mount path should combine with both router prefix and include_router prefix.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/v1\")\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/endpoint\")\n+    def sub_endpoint():\n+        return {\"version\": \"1\"}\n+\n+    api_router.mount(\"/mounted\", subapi)\n+    app.include_router(api_router, prefix=\"/api\")\n+\n+    client = TestClient(app)\n+\n+    # Full path: /api + /v1 + /mounted + /endpoint\n+    response = client.get(\"/api/v1/mounted/endpoint\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"version\": \"1\"}\n+\n+\n+def test_router_mount_without_prefix():\n+    \"\"\"Mount should work on router without prefix.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter()  # No prefix\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/hello\")\n+    def hello():\n+        return {\"hello\": \"world\"}\n+\n+    api_router.mount(\"/sub\", subapi)\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    response = client.get(\"/sub/hello\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"hello\": \"world\"}\n+\n+\n+def test_router_mount_applies_router_prefix():\n+    \"\"\"Mount path should include the router's prefix.\"\"\"\n+    router = APIRouter(prefix=\"/api\")\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/test\")\n+    def test_route():\n+        return {\"test\": True}\n+\n+    router.mount(\"/mounted\", subapi)\n+\n+    # Check that the mount path includes the router prefix\n+    mount_route = None\n+    for route in router.routes:\n+        if hasattr(route, \"path\") and \"mounted\" in route.path:\n+            mount_route = route\n+            break\n+\n+    assert mount_route is not None\n+    assert mount_rout", "output": "Bug: fix: enable mounting sub-applications under APIRouter\n\n## Summary\nFixes #10180\n\nWhen mounting a sub-application on an `APIRouter` with a prefix, the mount wasn't accessible at the expected path. The router's prefix wasn't being applied to mounts.\n\n## Changes\n1. Override `mount()` in `APIRouter` to automatically apply the router's prefix\n2. Handle `Mount` routes in `include_router()` to apply the include prefix\n\n## Usage\nEnables patterns like:\n```python\nrouter = APIRouter(prefix='/api')\nrouter.mount('/subapp', FastAPI())\napp.include_router(router)\n# Sub-app is now accessible at /api/subapp/...\n```\n\nNote: Mounts must be added before `include_router()` is called.\n\n## Testing\nAdded comprehensive tests in `tests/test_router_mount.py`", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 371}
{"instruction": "Review the following code changes: fix: enable mounting sub-applications under APIRouter", "input": "```diff\n@@ -928,6 +928,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(\n+        self,\n+        path: str,\n+        app: ASGIApp,\n+        name: Optional[str] = None,\n+    ) -> None:\n+        \"\"\"\n+        Mount a sub-application or ASGI app at the given path.\n+\n+        The router's prefix is automatically applied to the mount path.\n+        \"\"\"\n+        # Apply the router's prefix to the mount path\n+        super().mount(self.prefix + path, app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1423,6 +1437,9 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, Mount):\n+                # Handle mounted sub-applications by re-mounting with the prefix\n+                self.mount(prefix + route.path, route.app, name=route.name)\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,133 @@\n+\"\"\"Test mounting sub-applications under APIRouter.\"\"\"\n+\n+from fastapi import APIRouter, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_router_mount_basic():\n+    \"\"\"Sub-applications mounted on a router should work when included in the app.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/main\")\n+    def read_main():\n+        return {\"message\": \"Hello from main\"}\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/sub\")\n+    def read_sub():\n+        return {\"message\": \"Hello from sub\"}\n+\n+    # Mount BEFORE include_router\n+    api_router.mount(\"/subapi\", subapi)\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Main route should work\n+    response = client.get(\"/api/main\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"Hello from main\"}\n+\n+    # Sub-application route should also work\n+    response = client.get(\"/api/subapi/sub\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"Hello from sub\"}\n+\n+\n+def test_router_mount_with_include_prefix():\n+    \"\"\"Mount path should combine with both router prefix and include_router prefix.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/v1\")\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/endpoint\")\n+    def sub_endpoint():\n+        return {\"version\": \"1\"}\n+\n+    api_router.mount(\"/mounted\", subapi)\n+    app.include_router(api_router, prefix=\"/api\")\n+\n+    client = TestClient(app)\n+\n+    # Full path: /api + /v1 + /mounted + /endpoint\n+    response = client.get(\"/api/v1/mounted/endpoint\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"version\": \"1\"}\n+\n+\n+def test_router_mount_without_prefix():\n+    \"\"\"Mount should work on router without prefix.\"\"\"\n+    app = FastAPI()\n+    api_router = APIRouter()  # No prefix\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/hello\")\n+    def hello():\n+        return {\"hello\": \"world\"}\n+\n+    api_router.mount(\"/sub\", subapi)\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    response = client.get(\"/sub/hello\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"hello\": \"world\"}\n+\n+\n+def test_router_mount_applies_router_prefix():\n+    \"\"\"Mount path should include the router's prefix.\"\"\"\n+    router = APIRouter(prefix=\"/api\")\n+\n+    subapi = FastAPI()\n+\n+    @subapi.get(\"/test\")\n+    def test_route():\n+        return {\"test\": True}\n+\n+    router.mount(\"/mounted\", subapi)\n+\n+    # Check that the mount path includes the router prefix\n+    mount_route = None\n+    for route in router.routes:\n+        if hasattr(route, \"path\") and \"mounted\" in route.path:\n+            mount_route = route\n+            break\n+\n+    assert mount_route is not None\n+    assert mount_route.path == \"/api/mounted\"\n+\n+\n+def test_router_mount_multiple_subapps():\n+    \"\"\"Multiple sub-applications can be mounted on the same router.\"\"\"\n+    app = FastAPI()\n+    api_\n\n```", "output": "Changes look good. This PR implements: fix: enable mounting sub-applications under APIRouter", "source": "pr", "type": "code_review", "pr_number": 371}
{"instruction": "Review the following code changes: ‚¨Ü Bump typer from 0.16.0 to 0.21.1", "input": "```diff\n@@ -147,7 +147,7 @@ docs = [\n     \"pillow==11.3.0\",\n     \"python-slugify==8.0.4\",\n     \"pyyaml>=5.3.1,<7.0.0\",\n-    \"typer==0.16.0\",\n+    \"typer==0.21.1\",\n ]\n docs-tests = [\n     \"httpx>=0.23.0,<1.0.0\",\n\n```\n\n```diff\n@@ -1230,7 +1230,7 @@ dev = [\n     { name = \"ruff\", specifier = \"==0.14.3\" },\n     { name = \"sqlmodel\", specifier = \"==0.0.27\" },\n     { name = \"strawberry-graphql\", specifier = \">=0.200.0,<1.0.0\" },\n-    { name = \"typer\", specifier = \"==0.16.0\" },\n+    { name = \"typer\", specifier = \"==0.21.1\" },\n     { name = \"types-orjson\", specifier = \"==3.6.2\" },\n     { name = \"types-ujson\", specifier = \"==5.10.0.20240515\" },\n ]\n@@ -1251,7 +1251,7 @@ docs = [\n     { name = \"python-slugify\", specifier = \"==8.0.4\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n     { name = \"ruff\", specifier = \"==0.14.3\" },\n-    { name = \"typer\", specifier = \"==0.16.0\" },\n+    { name = \"typer\", specifier = \"==0.21.1\" },\n ]\n docs-tests = [\n     { name = \"httpx\", specifier = \">=0.23.0,<1.0.0\" },\n@@ -4737,7 +4737,7 @@ wheels = [\n \n [[package]]\n name = \"typer\"\n-version = \"0.16.0\"\n+version = \"0.21.1\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"click\", version = \"8.1.8\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version < '3.10'\" },\n@@ -4746,9 +4746,9 @@ dependencies = [\n     { name = \"shellingham\" },\n     { name = \"typing-extensions\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/c5/8c/7d682431efca5fd290017663ea4588bf6f2c6aad085c7f108c5dbc316e70/typer-0.16.0.tar.gz\", hash = \"sha256:af377ffaee1dbe37ae9440cb4e8f11686ea5ce4e9bae01b84ae7c63b87f1dd3b\", size = 102625, upload-time = \"2025-05-26T14:30:31.824Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/36/bf/8825b5929afd84d0dabd606c67cd57b8388cb3ec385f7ef19c5cc2202069/typer-0.21.1.tar.gz\", hash = \"sha256:ea835607cd752343b6b2b7ce676893e5a0324082268b48f27aa058bdb7d2145d\", size = 110371, upload-time = \"2026-01-06T11:21:10.989Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/76/42/3efaf858001d2c2913de7f354563e3a3a2f0decae3efe98427125a8f441e/typer-0.16.0-py3-none-any.whl\", hash = \"sha256:1f79bed11d4d02d4310e3c1b7ba594183bcedb0ac73b27a9e5f28f6fb5b98855\", size = 46317, upload-time = \"2025-05-26T14:30:30.523Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/a0/1d/d9257dd49ff2ca23ea5f132edf1281a0c4f9de8a762b9ae399b670a59235/typer-0.21.1-py3-none-any.whl\", hash = \"sha256:7985e89081c636b88d172c2ee0cfe33c253160994d47bdfdc302defd7d1f1d01\", size = 47381, upload-time = \"2026-01-06T11:21:09.824Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump typer from 0.16.0 to 0.21.1", "source": "pr", "type": "code_review", "pr_number": 370}
{"instruction": "Review the following code changes: ‚¨Ü Bump gitpython from 3.1.45 to 3.1.46", "input": "```diff\n@@ -180,7 +180,7 @@ tests = [\n     \"types-ujson==5.10.0.20240515\",\n ]\n translations = [\n-    \"gitpython==3.1.45\",\n+    \"gitpython==3.1.46\",\n     \"pydantic-ai==0.4.10\",\n     \"pygithub==2.8.1\",\n ]\n\n```\n\n```diff\n@@ -1203,7 +1203,7 @@ dev = [\n     { name = \"coverage\", extras = [\"toml\"], specifier = \">=6.5.0,<8.0\" },\n     { name = \"dirty-equals\", specifier = \"==0.9.0\" },\n     { name = \"flask\", specifier = \">=1.1.2,<4.0.0\" },\n-    { name = \"gitpython\", specifier = \"==3.1.45\" },\n+    { name = \"gitpython\", specifier = \"==3.1.46\" },\n     { name = \"griffe-typingdoc\", specifier = \"==0.3.0\" },\n     { name = \"griffe-warnings-deprecated\", specifier = \"==1.1.0\" },\n     { name = \"httpx\", specifier = \">=0.23.0,<1.0.0\" },\n@@ -1285,7 +1285,7 @@ tests = [\n     { name = \"types-ujson\", specifier = \"==5.10.0.20240515\" },\n ]\n translations = [\n-    { name = \"gitpython\", specifier = \"==3.1.45\" },\n+    { name = \"gitpython\", specifier = \"==3.1.46\" },\n     { name = \"pydantic-ai\", specifier = \"==0.4.10\" },\n     { name = \"pygithub\", specifier = \"==2.8.1\" },\n ]\n@@ -1632,15 +1632,15 @@ wheels = [\n \n [[package]]\n name = \"gitpython\"\n-version = \"3.1.45\"\n+version = \"3.1.46\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"gitdb\" },\n     { name = \"typing-extensions\", marker = \"python_full_version < '3.10'\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/9a/c8/dd58967d119baab745caec2f9d853297cec1989ec1d63f677d3880632b88/gitpython-3.1.45.tar.gz\", hash = \"sha256:85b0ee964ceddf211c41b9f27a49086010a190fd8132a24e21f362a4b36a791c\", size = 215076, upload-time = \"2025-07-24T03:45:54.871Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/df/b5/59d16470a1f0dfe8c793f9ef56fd3826093fc52b3bd96d6b9d6c26c7e27b/gitpython-3.1.46.tar.gz\", hash = \"sha256:400124c7d0ef4ea03f7310ac2fbf7151e09ff97f2a3288d64a440c584a29c37f\", size = 215371, upload-time = \"2026-01-01T15:37:32.073Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/01/61/d4b89fec821f72385526e1b9d9a3a0385dda4a72b206d28049e2c7cd39b8/gitpython-3.1.45-py3-none-any.whl\", hash = \"sha256:8908cb2e02fb3b93b7eb0f2827125cb699869470432cc885f019b8fd0fccff77\", size = 208168, upload-time = \"2025-07-24T03:45:52.517Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/6a/09/e21df6aef1e1ffc0c816f0522ddc3f6dcded766c3261813131c78a704470/gitpython-3.1.46-py3-none-any.whl\", hash = \"sha256:79812ed143d9d25b6d176a10bb511de0f9c67b1fa641d82097b0ab90398a2058\", size = 208620, upload-time = \"2026-01-01T15:37:30.574Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump gitpython from 3.1.45 to 3.1.46", "source": "pr", "type": "code_review", "pr_number": 369}
{"instruction": "Review the following code changes: ‚¨Ü Bump mkdocs-macros-plugin from 1.4.1 to 1.5.0", "input": "```diff\n@@ -140,7 +140,7 @@ docs = [\n     \"jieba==0.42.1\",\n     \"markdown-include-variants==0.0.8\",\n     \"mdx-include>=1.4.1,<2.0.0\",\n-    \"mkdocs-macros-plugin==1.4.1\",\n+    \"mkdocs-macros-plugin==1.5.0\",\n     \"mkdocs-material==9.7.0\",\n     \"mkdocs-redirects>=1.2.1,<1.3.0\",\n     \"mkdocstrings[python]==0.30.1\",\n\n```\n\n```diff\n@@ -1211,7 +1211,7 @@ dev = [\n     { name = \"jieba\", specifier = \"==0.42.1\" },\n     { name = \"markdown-include-variants\", specifier = \"==0.0.8\" },\n     { name = \"mdx-include\", specifier = \">=1.4.1,<2.0.0\" },\n-    { name = \"mkdocs-macros-plugin\", specifier = \"==1.4.1\" },\n+    { name = \"mkdocs-macros-plugin\", specifier = \"==1.5.0\" },\n     { name = \"mkdocs-material\", specifier = \"==9.7.0\" },\n     { name = \"mkdocs-redirects\", specifier = \">=1.2.1,<1.3.0\" },\n     { name = \"mkdocstrings\", extras = [\"python\"], specifier = \"==0.30.1\" },\n@@ -1243,7 +1243,7 @@ docs = [\n     { name = \"jieba\", specifier = \"==0.42.1\" },\n     { name = \"markdown-include-variants\", specifier = \"==0.0.8\" },\n     { name = \"mdx-include\", specifier = \">=1.4.1,<2.0.0\" },\n-    { name = \"mkdocs-macros-plugin\", specifier = \"==1.4.1\" },\n+    { name = \"mkdocs-macros-plugin\", specifier = \"==1.5.0\" },\n     { name = \"mkdocs-material\", specifier = \"==9.7.0\" },\n     { name = \"mkdocs-redirects\", specifier = \">=1.2.1,<1.3.0\" },\n     { name = \"mkdocstrings\", extras = [\"python\"], specifier = \"==0.30.1\" },\n@@ -2652,7 +2652,7 @@ wheels = [\n \n [[package]]\n name = \"mkdocs-macros-plugin\"\n-version = \"1.4.1\"\n+version = \"1.5.0\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"hjson\" },\n@@ -2667,9 +2667,9 @@ dependencies = [\n     { name = \"termcolor\", version = \"3.1.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version < '3.10'\" },\n     { name = \"termcolor\", version = \"3.3.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/1b/42/bb2ceed148c77f82b57c6d3b7f584f0f34ababf7a9a8ff85809380d1f400/mkdocs_macros_plugin-1.4.1.tar.gz\", hash = \"sha256:55a9c93871e3744cdeb0736316783d60830a6d5d97b1132364e6b491607f2332\", size = 35094, upload-time = \"2025-10-25T12:37:20.689Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/92/15/e6a44839841ebc9c5872fa0e6fad1c3757424e4fe026093b68e9f386d136/mkdocs_macros_plugin-1.5.0.tar.gz\", hash = \"sha256:12aa45ce7ecb7a445c66b9f649f3dd05e9b92e8af6bc65e4acd91d26f878c01f\", size = 37730, upload-time = \"2025-11-13T08:08:55.545Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/93/ec/e6e96a7ae8df414f03f43681821234b0d3b86666f7b91f70ab26775a8809/mkdocs_macros_plugin-1.4.1-py3-none-any.whl\", hash = \"sha256:5a9e483f6056fe7ad0923802affe699233ca468672e20a9640dba237165b3240\", size = 40155, upload-time = \"2025-10-25T12:37:19.417Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/51/62/9fffba5bb9ed3d31a932ad35038ba9483d59850256ee0fea7f1187173983/mkdocs_macros_plugin-1.5.0-py3-none-any.whl\", hash = \"sha256:c10fabd812bf50f9170609d0ed518e54f1f0e12c334ac29141723a83c881dd6f\", size = 44626, upload-time = \"2025-11-13T08:08:53.878Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump mkdocs-macros-plugin from 1.4.1 to 1.5.0", "source": "pr", "type": "code_review", "pr_number": 368}
{"instruction": "Review the following code changes: ‚¨Ü Bump sqlmodel from 0.0.27 to 0.0.31", "input": "```diff\n@@ -174,7 +174,7 @@ tests = [\n     \"pytest>=7.1.3,<9.0.0\",\n     \"pytest-codspeed==4.2.0\",\n     \"pyyaml>=5.3.1,<7.0.0\",\n-    \"sqlmodel==0.0.27\",\n+    \"sqlmodel==0.0.31\",\n     \"strawberry-graphql>=0.200.0,<1.0.0\",\n     \"types-orjson==3.6.2\",\n     \"types-ujson==5.10.0.20240515\",\n\n```\n\n```diff\n@@ -1228,7 +1228,7 @@ dev = [\n     { name = \"python-slugify\", specifier = \"==8.0.4\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n     { name = \"ruff\", specifier = \"==0.14.3\" },\n-    { name = \"sqlmodel\", specifier = \"==0.0.27\" },\n+    { name = \"sqlmodel\", specifier = \"==0.0.31\" },\n     { name = \"strawberry-graphql\", specifier = \">=0.200.0,<1.0.0\" },\n     { name = \"typer\", specifier = \"==0.16.0\" },\n     { name = \"types-orjson\", specifier = \"==3.6.2\" },\n@@ -1279,7 +1279,7 @@ tests = [\n     { name = \"pytest-codspeed\", specifier = \"==4.2.0\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n     { name = \"ruff\", specifier = \"==0.14.3\" },\n-    { name = \"sqlmodel\", specifier = \"==0.0.27\" },\n+    { name = \"sqlmodel\", specifier = \"==0.0.31\" },\n     { name = \"strawberry-graphql\", specifier = \">=0.200.0,<1.0.0\" },\n     { name = \"types-orjson\", specifier = \"==3.6.2\" },\n     { name = \"types-ujson\", specifier = \"==5.10.0.20240515\" },\n@@ -4415,15 +4415,15 @@ wheels = [\n \n [[package]]\n name = \"sqlmodel\"\n-version = \"0.0.27\"\n+version = \"0.0.31\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"pydantic\" },\n     { name = \"sqlalchemy\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/90/5a/693d90866233e837d182da76082a6d4c2303f54d3aaaa5c78e1238c5d863/sqlmodel-0.0.27.tar.gz\", hash = \"sha256:ad1227f2014a03905aef32e21428640848ac09ff793047744a73dfdd077ff620\", size = 118053, upload-time = \"2025-10-08T16:39:11.938Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/56/b8/e7cd6def4a773f25d6e29ffce63ccbfd6cf9488b804ab6fb9b80d334b39d/sqlmodel-0.0.31.tar.gz\", hash = \"sha256:2d41a8a9ee05e40736e2f9db8ea28cbfe9b5d4e5a18dd139e80605025e0c516c\", size = 94952, upload-time = \"2025-12-28T12:35:01.436Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/8c/92/c35e036151fe53822893979f8a13e6f235ae8191f4164a79ae60a95d66aa/sqlmodel-0.0.27-py3-none-any.whl\", hash = \"sha256:667fe10aa8ff5438134668228dc7d7a08306f4c5c4c7e6ad3ad68defa0e7aa49\", size = 29131, upload-time = \"2025-10-08T16:39:10.917Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/6c/72/5aa5be921800f6418a949a73c9bb7054890881143e6bc604a93d228a95a3/sqlmodel-0.0.31-py3-none-any.whl\", hash = \"sha256:6d946d56cac4c2db296ba1541357cee2e795d68174e2043cd138b916794b1513\", size = 27093, upload-time = \"2025-12-28T12:35:00.108Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump sqlmodel from 0.0.27 to 0.0.31", "source": "pr", "type": "code_review", "pr_number": 367}
{"instruction": "Review the following code changes: ‚¨Ü Bump pyasn1 from 0.6.1 to 0.6.2", "input": "```diff\n@@ -3238,11 +3238,11 @@ argon2 = [\n \n [[package]]\n name = \"pyasn1\"\n-version = \"0.6.1\"\n+version = \"0.6.2\"\n source = { registry = \"https://pypi.org/simple\" }\n-sdist = { url = \"https://files.pythonhosted.org/packages/ba/e9/01f1a64245b89f039897cb0130016d79f77d52669aae6ee7b159a6c4c018/pyasn1-0.6.1.tar.gz\", hash = \"sha256:6f580d2bdd84365380830acf45550f2511469f673cb4a5ae3857a3170128b034\", size = 145322, upload-time = \"2024-09-10T22:41:42.55Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/fe/b6/6e630dff89739fcd427e3f72b3d905ce0acb85a45d4ec3e2678718a3487f/pyasn1-0.6.2.tar.gz\", hash = \"sha256:9b59a2b25ba7e4f8197db7686c09fb33e658b98339fadb826e9512629017833b\", size = 146586, upload-time = \"2026-01-16T18:04:18.534Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/c8/f1/d6a797abb14f6283c0ddff96bbdd46937f64122b8c925cab503dd37f8214/pyasn1-0.6.1-py3-none-any.whl\", hash = \"sha256:0d632f46f2ba09143da3a8afe9e33fb6f92fa2320ab7e886e2d0f7672af84629\", size = 83135, upload-time = \"2024-09-11T16:00:36.122Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/44/b5/a96872e5184f354da9c84ae119971a0a4c221fe9b27a4d94bd43f2596727/pyasn1-0.6.2-py3-none-any.whl\", hash = \"sha256:1eb26d860996a18e9b6ed05e7aae0e9fc21619fcee6af91cca9bad4fbea224bf\", size = 83371, upload-time = \"2026-01-16T18:04:17.174Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump pyasn1 from 0.6.1 to 0.6.2", "source": "pr", "type": "code_review", "pr_number": 366}
{"instruction": "Review the following code changes: ‚¨Ü Bump ruff from 0.14.3 to 0.14.14", "input": "```diff\n@@ -151,7 +151,7 @@ docs = [\n ]\n docs-tests = [\n     \"httpx>=0.23.0,<1.0.0\",\n-    \"ruff==0.14.3\",\n+    \"ruff==0.14.14\",\n ]\n github-actions = [\n     \"httpx>=0.27.0,<1.0.0\",\n\n```\n\n```diff\n@@ -1227,7 +1227,7 @@ dev = [\n     { name = \"pytest-codspeed\", specifier = \"==4.2.0\" },\n     { name = \"python-slugify\", specifier = \"==8.0.4\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n-    { name = \"ruff\", specifier = \"==0.14.3\" },\n+    { name = \"ruff\", specifier = \"==0.14.14\" },\n     { name = \"sqlmodel\", specifier = \"==0.0.31\" },\n     { name = \"strawberry-graphql\", specifier = \">=0.200.0,<1.0.0\" },\n     { name = \"typer\", specifier = \"==0.21.1\" },\n@@ -1250,12 +1250,12 @@ docs = [\n     { name = \"pillow\", specifier = \"==11.3.0\" },\n     { name = \"python-slugify\", specifier = \"==8.0.4\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n-    { name = \"ruff\", specifier = \"==0.14.3\" },\n+    { name = \"ruff\", specifier = \"==0.14.14\" },\n     { name = \"typer\", specifier = \"==0.21.1\" },\n ]\n docs-tests = [\n     { name = \"httpx\", specifier = \">=0.23.0,<1.0.0\" },\n-    { name = \"ruff\", specifier = \"==0.14.3\" },\n+    { name = \"ruff\", specifier = \"==0.14.14\" },\n ]\n github-actions = [\n     { name = \"httpx\", specifier = \">=0.27.0,<1.0.0\" },\n@@ -1278,7 +1278,7 @@ tests = [\n     { name = \"pytest\", specifier = \">=7.1.3,<9.0.0\" },\n     { name = \"pytest-codspeed\", specifier = \"==4.2.0\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n-    { name = \"ruff\", specifier = \"==0.14.3\" },\n+    { name = \"ruff\", specifier = \"==0.14.14\" },\n     { name = \"sqlmodel\", specifier = \"==0.0.31\" },\n     { name = \"strawberry-graphql\", specifier = \">=0.200.0,<1.0.0\" },\n     { name = \"types-orjson\", specifier = \"==3.6.2\" },\n@@ -4248,28 +4248,28 @@ wheels = [\n \n [[package]]\n name = \"ruff\"\n-version = \"0.14.3\"\n-source = { registry = \"https://pypi.org/simple\" }\n-sdist = { url = \"https://files.pythonhosted.org/packages/75/62/50b7727004dfe361104dfbf898c45a9a2fdfad8c72c04ae62900224d6ecf/ruff-0.14.3.tar.gz\", hash = \"sha256:4ff876d2ab2b161b6de0aa1f5bd714e8e9b4033dc122ee006925fbacc4f62153\", size = 5558687, upload-time = \"2025-10-31T00:26:26.878Z\" }\n-wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/ce/8e/0c10ff1ea5d4360ab8bfca4cb2c9d979101a391f3e79d2616c9bf348cd26/ruff-0.14.3-py3-none-linux_armv6l.whl\", hash = \"sha256:876b21e6c824f519446715c1342b8e60f97f93264012de9d8d10314f8a79c371\", size = 12535613, upload-time = \"2025-10-31T00:25:44.302Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/d3/c8/6724f4634c1daf52409fbf13fefda64aa9c8f81e44727a378b7b73dc590b/ruff-0.14.3-py3-none-macosx_10_12_x86_64.whl\", hash = \"sha256:b6fd8c79b457bedd2abf2702b9b472147cd860ed7855c73a5247fa55c9117654\", size = 12855812, upload-time = \"2025-10-31T00:25:47.793Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/de/03/db1bce591d55fd5f8a08bb02517fa0b5097b2ccabd4ea1ee29aa72b67d96/ruff-0.14.3-py3-none-macosx_11_0_arm64.whl\", hash = \"sha256:71ff6edca490c308f083156938c0c1a66907151263c4abdcb588602c6e696a14\", size = 11944026, upload-time = \"2025-10-31T00:25:49.657Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/0b/75/4f8dbd48e03272715d12c87dc4fcaaf21b913f0affa\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump ruff from 0.14.3 to 0.14.14", "source": "pr", "type": "code_review", "pr_number": 365}
{"instruction": "Review the following code changes: üë∑ Run mypy by pre-commit", "input": "```diff\n@@ -30,6 +30,13 @@ repos:\n         language: unsupported\n         types: [python]\n \n+      - id: local-mypy\n+        name: mypy check\n+        entry: uv run mypy fastapi\n+        require_serial: true\n+        language: unsupported\n+        pass_filenames: false\n+\n       - id: add-permalinks-pages\n         language: unsupported\n         name: add-permalinks-pages\n\n```\n\n```diff\n@@ -477,7 +477,7 @@ def get_model_fields(model: type[BaseModel]) -> list[ModelField]:\n \n @lru_cache\n def get_cached_model_fields(model: type[BaseModel]) -> list[ModelField]:\n-    return get_model_fields(model)  # type: ignore[return-value]\n+    return get_model_fields(model)\n \n \n # Duplicate of several schema functions from Pydantic v1 to make them compatible with\n@@ -500,13 +500,13 @@ def get_model_name_map(unique_models: TypeModelSet) -> dict[TypeModelOrEnum, str\n \n \n def get_compat_model_name_map(fields: list[ModelField]) -> ModelNameMap:\n-    all_flat_models = set()\n+    all_flat_models: TypeModelSet = set()\n \n     v2_model_fields = [field for field in fields if isinstance(field, ModelField)]\n     v2_flat_models = get_flat_models_from_fields(v2_model_fields, known_models=set())\n-    all_flat_models = all_flat_models.union(v2_flat_models)  # type: ignore[arg-type]\n+    all_flat_models = all_flat_models.union(v2_flat_models)\n \n-    model_name_map = get_model_name_map(all_flat_models)  # type: ignore[arg-type]\n+    model_name_map = get_model_name_map(all_flat_models)\n     return model_name_map\n \n \n\n```\n\n```diff\n@@ -399,7 +399,7 @@ def analyze_param(\n         if isinstance(fastapi_annotation, FieldInfo):\n             # Copy `field_info` because we mutate `field_info.default` below.\n             field_info = copy_field_info(\n-                field_info=fastapi_annotation,  # type: ignore[arg-type]\n+                field_info=fastapi_annotation,\n                 annotation=use_annotation,\n             )\n             assert (\n@@ -433,7 +433,7 @@ def analyze_param(\n             \"Cannot specify FastAPI annotations in `Annotated` and default value\"\n             f\" together for {param_name!r}\"\n         )\n-        field_info = value  # type: ignore[assignment]\n+        field_info = value\n         if isinstance(field_info, FieldInfo):\n             field_info.annotation = type_annotation\n \n\n```\n\n```diff\n@@ -90,7 +90,7 @@ def create_model_field(\n     field_info = field_info or FieldInfo(annotation=type_, default=default, alias=alias)\n     kwargs = {\"mode\": mode, \"name\": name, \"field_info\": field_info}\n     try:\n-        return v2.ModelField(**kwargs)  # type: ignore[return-value,arg-type]\n+        return v2.ModelField(**kwargs)  # type: ignore[arg-type]\n     except PydanticSchemaGenerationError:\n         raise fastapi.exceptions.FastAPIError(\n             _invalid_args_message.format(type_=type_)\n\n```", "output": "Changes look good. This PR implements: üë∑ Run mypy by pre-commit", "source": "pr", "type": "code_review", "pr_number": 364}
{"instruction": "Review the following code changes: feat: automatically support HEAD method for all GET routes", "input": "```diff\n@@ -278,6 +278,11 @@ def get_openapi_path(\n     route_response_media_type: Optional[str] = current_response_class.media_type\n     if route.include_in_schema:\n         for method in route.methods:\n+            # Skip auto-added HEAD method in OpenAPI when it's paired with GET.\n+            # HEAD is automatically supported for all GET endpoints per HTTP semantics.\n+            # But explicit HEAD-only routes should still appear in the schema.\n+            if method == \"HEAD\" and \"GET\" in route.methods:\n+                continue\n             operation = get_openapi_operation_metadata(\n                 route=route, method=method, operation_ids=operation_ids\n             )\n\n```\n\n```diff\n@@ -549,6 +549,9 @@ def __init__(\n         if methods is None:\n             methods = [\"GET\"]\n         self.methods: set[str] = {method.upper() for method in methods}\n+        # Automatically add HEAD for GET routes, following HTTP semantics and Starlette behavior\n+        if \"GET\" in self.methods:\n+            self.methods.add(\"HEAD\")\n         if isinstance(generate_unique_id_function, DefaultPlaceholder):\n             current_generate_unique_id: Callable[[APIRoute], str] = (\n                 generate_unique_id_function.value\n\n```\n\n```diff\n@@ -124,7 +124,12 @@ def generate_unique_id(route: \"APIRoute\") -> str:\n     operation_id = f\"{route.name}{route.path_format}\"\n     operation_id = re.sub(r\"\\W\", \"_\", operation_id)\n     assert route.methods\n-    operation_id = f\"{operation_id}_{list(route.methods)[0].lower()}\"\n+    # Use a deterministic method for the operation ID.\n+    # Prefer non-HEAD methods since HEAD is often auto-added for GET routes.\n+    # Sort to ensure consistent ordering across Python versions.\n+    methods = sorted(route.methods)\n+    method = next((m for m in methods if m != \"HEAD\"), methods[0])\n+    operation_id = f\"{operation_id}_{method.lower()}\"\n     return operation_id\n \n \n\n```\n\n```diff\n@@ -13,6 +13,14 @@ class Item(BaseModel):\n     price: Optional[float] = None\n \n \n+# Note: HEAD route defined BEFORE GET route to allow custom HEAD behavior.\n+# GET routes automatically support HEAD, but explicit HEAD routes take precedence\n+# when defined first.\n+@app.head(\"/items/{item_id}\")\n+def head_item(item_id: str):\n+    return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})\n+\n+\n @app.api_route(\"/items/{item_id}\", methods=[\"GET\"])\n def get_items(item_id: str):\n     return {\"item_id\": item_id}\n@@ -30,11 +38,6 @@ def delete_item(item_id: str, item: Item):\n     return {\"item_id\": item_id, \"item\": item}\n \n \n-@app.head(\"/items/{item_id}\")\n-def head_item(item_id: str):\n-    return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})\n-\n-\n @app.options(\"/items/{item_id}\")\n def options_item(item_id: str):\n     return JSONResponse(None, headers={\"x-fastapi-item-id\": item_id})\n\n```\n\n```diff\n@@ -0,0 +1,115 @@\n+\"\"\"Test automatic HEAD method support for GET routes.\"\"\"\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_head_method_automatically_supported():\n+    \"\"\"HEAD should work automatically for all GET endpoints.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def read_root():\n+        return {\"hello\": \"world\"}\n+\n+    @app.get(\"/items/{item_id}\")\n+    def read_item(item_id: int):\n+        return {\"item_id\": item_id}\n+\n+    client = TestClient(app)\n+\n+    # GET should work\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"hello\": \"world\"}\n+\n+    # HEAD should work and return same headers but no body\n+    head_response = client.head(\"/\")\n+    assert head_response.status_code == 200\n+    assert head_response.content == b\"\"\n+    assert head_response.headers.get(\"content-type\") == \"application/json\"\n+    assert int(head_response.headers.get(\"content-length\")) > 0\n+\n+    # HEAD with path params\n+    head_response = client.head(\"/items/42\")\n+    assert head_response.status_code == 200\n+    assert head_response.content == b\"\"\n+\n+\n+def test_head_not_in_openapi_schema():\n+    \"\"\"HEAD should not appear in OpenAPI schema - it's implicit per HTTP semantics.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def read_root():\n+        return {\"hello\": \"world\"}\n+\n+    @app.post(\"/items\")\n+    def create_item():\n+        return {\"created\": True}\n+\n+    schema = app.openapi()\n+\n+    # GET should be in schema\n+    assert \"get\" in schema[\"paths\"][\"/\"]\n+\n+    # HEAD should NOT be in schema\n+    assert \"head\" not in schema[\"paths\"][\"/\"]\n+\n+    # POST shouldn't have HEAD\n+    assert \"post\" in schema[\"paths\"][\"/items\"]\n+    assert \"head\" not in schema[\"paths\"][\"/items\"]\n+\n+\n+def test_head_not_added_for_post_routes():\n+    \"\"\"HEAD should NOT be added for non-GET routes.\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/items\")\n+    def create_item():\n+        return {\"created\": True}\n+\n+    client = TestClient(app)\n+\n+    # POST should work\n+    response = client.post(\"/items\")\n+    assert response.status_code == 200\n+\n+    # HEAD should NOT work", "output": "Code Review for: feat: automatically support HEAD method for all GET routes\n\nüìù **fastapi/openapi/utils.py**: It will also hide the HEAD method if user adds GET and HEAD methods explicitly using `app.add_route(\"/\", handler, methods=[\"GET\", \"HEAD\"])`\n\nüìù **fastapi/routing.py**: This will be a breaking change for use cases when developers explicitly declare `HEAD` method after `GET` method.\nThis is probably not a big problem, but we should mark this PR\\Release as Breaking changes and probably provide the way to disable this feature. Also, this should be explained in docs.\n\nüìù **fastapi/utils.py**: This will not be needed if we add a separate **route** instead of extending the methods of existing route.\n\n", "source": "pr", "type": "code_review", "pr_number": 363}
{"instruction": "Review this code change in `fastapi/openapi/utils.py`", "input": "```diff\n@@ -278,6 +278,11 @@ def get_openapi_path(\n     route_response_media_type: Optional[str] = current_response_class.media_type\n     if route.include_in_schema:\n         for method in route.methods:\n+            # Skip auto-added HEAD method in OpenAPI when it's paired with GET.\n+            # HEAD is automatically supported for all GET endpoints per HTTP semantics.\n+            # But explicit HEAD-only routes should still appear in the schema.\n+            if method == \"HEAD\" and \"GET\" in route.methods:\n+                continue\n\n```", "output": "It will also hide the HEAD method if user adds GET and HEAD methods explicitly using `app.add_route(\"/\", handler, methods=[\"GET\", \"HEAD\"])`", "source": "pr_review", "type": "inline_review", "pr_number": 363}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -549,6 +549,9 @@ def __init__(\n         if methods is None:\n             methods = [\"GET\"]\n         self.methods: set[str] = {method.upper() for method in methods}\n+        # Automatically add HEAD for GET routes, following HTTP semantics and Starlette behavior\n+        if \"GET\" in self.methods:\n+            self.methods.add(\"HEAD\")\n\n```", "output": "This will be a breaking change for use cases when developers explicitly declare `HEAD` method after `GET` method.\nThis is probably not a big problem, but we should mark this PR\\Release as Breaking changes and probably provide the way to disable this feature. Also, this should be explained in docs.", "source": "pr_review", "type": "inline_review", "pr_number": 363}
{"instruction": "Review this code change in `fastapi/utils.py`", "input": "```diff\n@@ -124,7 +124,12 @@ def generate_unique_id(route: \"APIRoute\") -> str:\n     operation_id = f\"{route.name}{route.path_format}\"\n     operation_id = re.sub(r\"\\W\", \"_\", operation_id)\n     assert route.methods\n-    operation_id = f\"{operation_id}_{list(route.methods)[0].lower()}\"\n+    # Use a deterministic method for the operation ID.\n+    # Prefer non-HEAD methods since HEAD is often auto-added for GET routes.\n+    # Sort to ensure consistent ordering across Python versions.\n+    methods = sorted(route.methods)\n+    method = next((m for m in methods if m != \"HEAD\"), methods[0])\n+    operation_id = f\"{operation_id}_{method.lower()}\"\n\n```", "output": "This will not be needed if we add a separate **route** instead of extending the methods of existing route.", "source": "pr_review", "type": "inline_review", "pr_number": 363}
{"instruction": "Fix the following bug: üêõ Fix non-deterministic openapi spec in case of duplicated model names", "input": "v0.128.0 introduced non-deterministic openapi spec schema naming in the case of multiple pydantic models with the same name.\r\n\r\nCommit [e300630](https://github.com/fastapi/fastapi/commit/e3006305518a56ea35f62a31748ad26fe4356fcc#diff-1086603fdd56511aafd1d279396b142b803e48164327148e6de26cef4cdaed81L504) removed the check for conflicting names.\r\n\r\nThe component names two classes named `User` would randomly be either\r\n\r\n```\r\nUser\r\ntests__test_duplicate_model_names_openapi__b__model__User\r\n```\r\n\r\n```\r\ntests__test_duplicate_model_names_openapi__a__model__User\r\nUser\r\n```\r\n\r\nWith this change, we reintroduce the conflict check to always use fully qualified names in case of conflict.", "output": "```diff\n@@ -1,3 +1,4 @@\n+import hashlib\n import re\n import warnings\n from collections.abc import Sequence\n@@ -491,11 +492,25 @@ def normalize_name(name: str) -> str:\n     return re.sub(r\"[^a-zA-Z0-9.\\-_]\", \"_\", name)\n \n \n+def get_long_model_name(model: TypeModelOrEnum) -> str:\n+    return f\"{model.__qualname__}_{hashlib.sha1(model.__module__.encode()).hexdigest()}\"\n+\n+\n def get_model_name_map(unique_models: TypeModelSet) -> dict[TypeModelOrEnum, str]:\n     name_model_map = {}\n+    conflicting_names: set[str] = set()\n     for model in unique_models:\n         model_name = normalize_name(model.__name__)\n-        name_model_map[model_name] = model\n+        if model_name in conflicting_names:\n+            model_name = get_long_model_name(model)\n+            name_model_map[model_name] = model\n+        elif model_name in name_model_map:\n+            conflicting_names.add(model_name)\n+            conflicting_model = name_model_map.pop(model_name)\n+            name_model_map[get_long_model_name(conflicting_model)] = conflicting_model\n+            name_model_map[get_long_model_name(model)] = model\n+        else:\n+            name_model_map[model_name] = model\n     return {v: k for k, v in name_model_map.items()}\n \n \n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    a: int\n\n```\n\n```diff\n@@ -0,0 +1,19 @@\n+from fastapi import FastAPI\n+\n+from tests.test_duplicate_model_names_openapi.a.model import User as UserA\n+from tests.test_duplicate_model_names_openapi.b.model import User as UserB\n+from tests.test_duplicate_model_names_openapi.c.model import User as UserC\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/a\", response_model=UserA)\n+def user_a(): ...\n+\n+\n+@app.get(\"/b\", response_model=UserB)\n+def user_b(): ...\n+\n+\n+@app.get(\"/c\", response_model=UserC)\n+def user_c(): ...\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    b: int\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    c: int\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 362}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,3 +1,4 @@\n+import hashlib\n import re\n import warnings\n from collections.abc import Sequence\n@@ -491,11 +492,25 @@ def normalize_name(name: str) -> str:\n     return re.sub(r\"[^a-zA-Z0-9.\\-_]\", \"_\", name)\n \n \n+def get_long_model_name(model: TypeModelOrEnum) -> str:\n+    return f\"{model.__qualname__}_{hashlib.sha1(model.__module__.encode()).hexdigest()}\"\n+\n+\n def get_model_name_map(unique_models: TypeModelSet) -> dict[TypeModelOrEnum, str]:\n     name_model_map = {}\n+    conflicting_names: set[str] = set()\n     for model in unique_models:\n         model_name = normalize_name(model.__name__)\n-        name_model_map[model_name] = model\n+        if model_name in conflicting_names:\n+            model_name = get_long_model_name(model)\n+            name_model_map[model_name] = model\n+        elif model_name in name_model_map:\n+            conflicting_names.add(model_name)\n+            conflicting_model = name_model_map.pop(model_name)\n+            name_model_map[get_long_model_name(conflicting_model)] = conflicting_model\n+            name_model_map[get_long_model_name(model)] = model\n+        else:\n+            name_model_map[model_name] = model\n     return {v: k for k, v in name_model_map.items()}\n \n \n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    a: int\n\n```\n\n```diff\n@@ -0,0 +1,19 @@\n+from fastapi import FastAPI\n+\n+from tests.test_duplicate_model_names_openapi.a.model import User as UserA\n+from tests.test_duplicate_model_names_openapi.b.model import User as UserB\n+from tests.test_duplicate_model_names_openapi.c.model import User as UserC\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/a\", response_model=UserA)\n+def user_a(): ...\n+\n+\n+@app.get(\"/b\", response_model=UserB)\n+def user_b(): ...\n+\n+\n+@app.get(\"/c\", response_model=UserC)\n+def user_c(): ...\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    b: int\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    c: int\n\n```", "output": "Bug: üêõ Fix non-deterministic openapi spec in case of duplicated model names\n\nv0.128.0 introduced non-deterministic openapi spec schema naming in the case of multiple pydantic models with the same name.\r\n\r\nCommit [e300630](https://github.com/fastapi/fastapi/commit/e3006305518a56ea35f62a31748ad26fe4356fcc#diff-1086603fdd56511aafd1d279396b142b803e48164327148e6de26cef4cdaed81L504) removed the check for conflicting names.\r\n\r\nThe component names two classes named `User` would randomly be either\r\n\r\n```\r\nUser\r\ntests__test_duplicate_model_names_openapi__b__model__User\r\n```\r\n\r\n```\r\ntests__test_duplicate_model_names_openapi__a__model__User\r\nUser\r\n```\r\n\r\nWith this change, we reintroduce the conflict check to always use fully qualified names in case of conflict.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 362}
{"instruction": "Review the following code changes: üêõ Fix non-deterministic openapi spec in case of duplicated model names", "input": "```diff\n@@ -1,3 +1,4 @@\n+import hashlib\n import re\n import warnings\n from collections.abc import Sequence\n@@ -491,11 +492,25 @@ def normalize_name(name: str) -> str:\n     return re.sub(r\"[^a-zA-Z0-9.\\-_]\", \"_\", name)\n \n \n+def get_long_model_name(model: TypeModelOrEnum) -> str:\n+    return f\"{model.__qualname__}_{hashlib.sha1(model.__module__.encode()).hexdigest()}\"\n+\n+\n def get_model_name_map(unique_models: TypeModelSet) -> dict[TypeModelOrEnum, str]:\n     name_model_map = {}\n+    conflicting_names: set[str] = set()\n     for model in unique_models:\n         model_name = normalize_name(model.__name__)\n-        name_model_map[model_name] = model\n+        if model_name in conflicting_names:\n+            model_name = get_long_model_name(model)\n+            name_model_map[model_name] = model\n+        elif model_name in name_model_map:\n+            conflicting_names.add(model_name)\n+            conflicting_model = name_model_map.pop(model_name)\n+            name_model_map[get_long_model_name(conflicting_model)] = conflicting_model\n+            name_model_map[get_long_model_name(model)] = model\n+        else:\n+            name_model_map[model_name] = model\n     return {v: k for k, v in name_model_map.items()}\n \n \n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    a: int\n\n```\n\n```diff\n@@ -0,0 +1,19 @@\n+from fastapi import FastAPI\n+\n+from tests.test_duplicate_model_names_openapi.a.model import User as UserA\n+from tests.test_duplicate_model_names_openapi.b.model import User as UserB\n+from tests.test_duplicate_model_names_openapi.c.model import User as UserC\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/a\", response_model=UserA)\n+def user_a(): ...\n+\n+\n+@app.get(\"/b\", response_model=UserB)\n+def user_b(): ...\n+\n+\n+@app.get(\"/c\", response_model=UserC)\n+def user_c(): ...\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    b: int\n\n```\n\n```diff\n@@ -0,0 +1,5 @@\n+from pydantic import BaseModel\n+\n+\n+class User(BaseModel):\n+    c: int\n\n```", "output": "Code Review for: üêõ Fix non-deterministic openapi spec in case of duplicated model names\n\nüìù **fastapi/_compat/v2.py**: I think we shouldn't expose the module path. Some developers may not want this to happen..\n\nüìù **fastapi/_compat/v2.py**: Makes sense, I think hashing the path is the way to go. It's easy and the possible exposure is extremely small. \r\nI'll push an update. \n\nüìù **fastapi/_compat/v2.py**: Should be reasonable now, let me know what you think. \n\n", "source": "pr", "type": "code_review", "pr_number": 362}
{"instruction": "Review this code change in `fastapi/_compat/v2.py`", "input": "```diff\n@@ -491,11 +491,25 @@ def normalize_name(name: str) -> str:\n     return re.sub(r\"[^a-zA-Z0-9.\\-_]\", \"_\", name)\n \n \n+def get_long_model_name(model: TypeModelOrEnum) -> str:\n+    return f\"{model.__module__}__{model.__qualname__}\".replace(\".\", \"__\")\n\n```", "output": "I think we shouldn't expose the module path. Some developers may not want this to happen..", "source": "pr_review", "type": "inline_review", "pr_number": 362}
{"instruction": "Review the following code changes: üë∑ Run tests only on relevant code changes (not on docs)", "input": "```diff\n@@ -16,7 +16,35 @@ env:\n   UV_NO_SYNC: true\n \n jobs:\n+  changes:\n+    runs-on: ubuntu-latest\n+    # Required permissions\n+    permissions:\n+      pull-requests: read\n+    # Set job outputs to values from filter step\n+    outputs:\n+      src: ${{ steps.filter.outputs.src }}\n+    steps:\n+    - uses: actions/checkout@v6\n+    # For pull requests it's not necessary to checkout the code but for the main branch it is\n+    - uses: dorny/paths-filter@v3\n+      id: filter\n+      with:\n+        filters: |\n+          src:\n+            - .github/workflows/test.yml\n+            - docs_src/**\n+            - fastapi/**\n+            - scripts/**\n+            - tests/**\n+            - .python-version\n+            - pyproject.toml\n+            - uv.lock\n+\n   test:\n+    needs:\n+      - changes\n+    if: needs.changes.outputs.src == 'true'\n     strategy:\n       matrix:\n         os: [ windows-latest, macos-latest ]\n@@ -91,7 +119,8 @@ jobs:\n           include-hidden-files: true\n \n   coverage-combine:\n-    needs: [test]\n+    needs:\n+      - test\n     runs-on: ubuntu-latest\n     steps:\n       - name: Dump GitHub context\n@@ -143,3 +172,4 @@ jobs:\n         uses: re-actors/alls-green@release/v1\n         with:\n           jobs: ${{ toJSON(needs) }}\n+          allowed-skips: coverage-combine,test\n\n```", "output": "Changes look good. This PR implements: üë∑ Run tests only on relevant code changes (not on docs)", "source": "pr", "type": "code_review", "pr_number": 361}
{"instruction": "Review the following code changes: üí° Update comment for Pydantic internals", "input": "```diff\n@@ -17,7 +17,7 @@\n from starlette.datastructures import UploadFile\n from typing_extensions import get_args, get_origin\n \n-# Copy from Pydantic v2, compatible with v1\n+# Copy from Pydantic: pydantic/_internal/_typing_extra.py\n if sys.version_info < (3, 10):\n     WithArgsTypes: tuple[Any, ...] = (typing._GenericAlias, types.GenericAlias)  # type: ignore[attr-defined]\n else:\n@@ -45,7 +45,7 @@\n Url: type[Any]\n \n \n-# Copy of Pydantic v2, compatible with v1\n+# Copy of Pydantic: pydantic/_internal/_utils.py\n def lenient_issubclass(\n     cls: Any, class_or_tuple: Union[type[Any], tuple[type[Any], ...], None]\n ) -> bool:\n\n```", "output": "Changes look good. This PR implements: üí° Update comment for Pydantic internals", "source": "pr", "type": "code_review", "pr_number": 360}
{"instruction": "Review the following code changes: üìù Use `WSGIMiddleware` from `a2wsgi` instead of deprecated `fastapi.middleware.wsgi.WSGIMiddleware`", "input": "```diff\n@@ -6,13 +6,29 @@ For that, you can use the `WSGIMiddleware` and use it to wrap your WSGI applicat\n \n ## Using `WSGIMiddleware` { #using-wsgimiddleware }\n \n-You need to import `WSGIMiddleware`.\n+/// info\n+\n+This requires installing `a2wsgi` for example with `pip install a2wsgi`.\n+\n+///\n+\n+You need to import `WSGIMiddleware` from `a2wsgi`.\n \n Then wrap the WSGI (e.g. Flask) app with the middleware.\n \n And then mount that under a path.\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note\n+\n+Previously, it was recommended to use `WSGIMiddleware` from `fastapi.middleware.wsgi`, but it is now deprecated.\n+\n+It‚Äôs advised to use the `a2wsgi` package instead. The usage remains the same.\n+\n+Just ensure that you have the `a2wsgi` package installed and import `WSGIMiddleware` correctly from `a2wsgi`.\n+\n+///\n \n ## Check it { #check-it }\n \n\n```\n\n```diff\n@@ -35,11 +35,3 @@ It can be imported from `fastapi`:\n \n```\n\n```diff\n@@ -1,5 +1,5 @@\n+from a2wsgi import WSGIMiddleware\n from fastapi import FastAPI\n-from fastapi.middleware.wsgi import WSGIMiddleware\n from flask import Flask, request\n from markupsafe import escape\n \n\n```\n\n```diff\n@@ -1 +1,3 @@\n-from starlette.middleware.wsgi import WSGIMiddleware as WSGIMiddleware  # noqa\n+from starlette.middleware.wsgi import (\n+    WSGIMiddleware as WSGIMiddleware,\n+)  # pragma: no cover # noqa\n\n```\n\n```diff\n@@ -178,6 +178,7 @@ tests = [\n     \"strawberry-graphql>=0.200.0,<1.0.0\",\n     \"types-orjson==3.6.2\",\n     \"types-ujson==5.10.0.20240515\",\n+    \"a2wsgi>=1.9.0,<=2.0.0\",\n ]\n translations = [\n     \"gitpython==3.1.45\",\n@@ -231,7 +232,6 @@ xfail_strict = true\n junit_family = \"xunit2\"\n filterwarnings = [\n     \"error\",\n-    'ignore:starlette.middleware.wsgi is deprecated and will be removed in a future release\\..*:DeprecationWarning:starlette',\n     # see https://trio.readthedocs.io/en/stable/history.html#trio-0-22-0-2022-09-28\n     \"ignore:You seem to already have a custom.*:RuntimeWarning:trio\",\n     # TODO: remove after upgrading SQLAlchemy to a version that includes the following changes\n\n```", "output": "Code Review for: üìù Use `WSGIMiddleware` from `a2wsgi` instead of deprecated `fastapi.middleware.wsgi.WSGIMiddleware`\n\nüìù **pyproject.toml**: With versions prior to `1.9.0` it gives error `404 Not found`\n\n", "source": "pr", "type": "code_review", "pr_number": 359}
{"instruction": "Review this code change in `pyproject.toml`", "input": "```diff\n@@ -178,6 +178,7 @@ tests = [\n     \"strawberry-graphql>=0.200.0,<1.0.0\",\n     \"types-orjson==3.6.2\",\n     \"types-ujson==5.10.0.20240515\",\n+    \"a2wsgi>=1.9.0,<=2.0.0\",\n\n```", "output": "With versions prior to `1.9.0` it gives error `404 Not found`", "source": "pr_review", "type": "inline_review", "pr_number": 359}
{"instruction": "Fix the following bug: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool", "input": "Sometimes LLM fails to generate translation correctly - introduces some mistakes that can be found by translation fixer tool, but can't be automatically fixed (e.g. wrong number of code blocks or code includes).\r\n\r\nFor example, in https://github.com/fastapi/fastapi/pull/14588 LLM preserved existing mistake in `virtual-environments.md` (the language of code block was specified after whitespace) and it caused pre-commit CI to fail.\r\nJust running translation script second time on that file resolved the problem - https://github.com/fastapi/fastapi/pull/14588/commits/4eb0b839b992e8c03dd2e9e7c2eec028b3d5d5f9\r\n\r\nThis PR updates the translation script to check LLM response with translation fixer and retry if it has non-fixable mistakes", "output": "```diff\n@@ -10,6 +10,7 @@\n import git\n import typer\n import yaml\n+from doc_parsing_utils import check_translation\n from github import Github\n from pydantic_ai import Agent\n from rich import print\n@@ -119,9 +120,30 @@ def translate_page(\n         ]\n     )\n     prompt = \"\\n\\n\".join(prompt_segments)\n-    print(f\"Running agent for {out_path}\")\n-    result = agent.run_sync(prompt)\n-    out_content = f\"{result.output.strip()}\\n\"\n+\n+    MAX_ATTEMPTS = 3\n+    for attempt_no in range(1, MAX_ATTEMPTS + 1):\n+        print(f\"Running agent for {out_path} (attempt {attempt_no}/{MAX_ATTEMPTS})\")\n+        result = agent.run_sync(prompt)\n+        out_content = f\"{result.output.strip()}\\n\"\n+        try:\n+            check_translation(\n+                doc_lines=out_content.splitlines(),\n+                en_doc_lines=original_content.splitlines(),\n+                lang_code=language,\n+                auto_fix=False,\n+                path=str(out_path),\n+            )\n+            break  # Exit loop if no errors\n+        except ValueError as e:\n+            print(\n+                f\"Translation check failed on attempt {attempt_no}/{MAX_ATTEMPTS}: {e}\"\n+            )\n+            continue  # Retry if not reached max attempts\n+    else:  # Max retry attempts reached\n+        print(f\"Translation failed for {out_path} after {MAX_ATTEMPTS} attempts\")\n+        raise typer.Exit(code=1)\n+\n     print(f\"Saving translation to {out_path}\")\n     out_path.write_text(out_content, encoding=\"utf-8\", newline=\"\\n\")\n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 358}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -10,6 +10,7 @@\n import git\n import typer\n import yaml\n+from doc_parsing_utils import check_translation\n from github import Github\n from pydantic_ai import Agent\n from rich import print\n@@ -119,9 +120,30 @@ def translate_page(\n         ]\n     )\n     prompt = \"\\n\\n\".join(prompt_segments)\n-    print(f\"Running agent for {out_path}\")\n-    result = agent.run_sync(prompt)\n-    out_content = f\"{result.output.strip()}\\n\"\n+\n+    MAX_ATTEMPTS = 3\n+    for attempt_no in range(1, MAX_ATTEMPTS + 1):\n+        print(f\"Running agent for {out_path} (attempt {attempt_no}/{MAX_ATTEMPTS})\")\n+        result = agent.run_sync(prompt)\n+        out_content = f\"{result.output.strip()}\\n\"\n+        try:\n+            check_translation(\n+                doc_lines=out_content.splitlines(),\n+                en_doc_lines=original_content.splitlines(),\n+                lang_code=language,\n+                auto_fix=False,\n+                path=str(out_path),\n+            )\n+            break  # Exit loop if no errors\n+        except ValueError as e:\n+            print(\n+                f\"Translation check failed on attempt {attempt_no}/{MAX_ATTEMPTS}: {e}\"\n+            )\n+            continue  # Retry if not reached max attempts\n+    else:  # Max retry attempts reached\n+        print(f\"Translation failed for {out_path} after {MAX_ATTEMPTS} attempts\")\n+        raise typer.Exit(code=1)\n+\n     print(f\"Saving translation to {out_path}\")\n     out_path.write_text(out_content, encoding=\"utf-8\", newline=\"\\n\")\n \n\n```", "output": "Bug: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool\n\nSometimes LLM fails to generate translation correctly - introduces some mistakes that can be found by translation fixer tool, but can't be automatically fixed (e.g. wrong number of code blocks or code includes).\r\n\r\nFor example, in https://github.com/fastapi/fastapi/pull/14588 LLM preserved existing mistake in `virtual-environments.md` (the language of code block was specified after whitespace) and it caused pre-commit CI to fail.\r\nJust running translation script second time on that file resolved the problem - https://github.com/fastapi/fastapi/pull/14588/commits/4eb0b839b992e8c03dd2e9e7c2eec028b3d5d5f9\r\n\r\nThis PR updates the translation script to check LLM response with translation fixer and retry if it has non-fixable mistakes", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 358}
{"instruction": "Review the following code changes: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool", "input": "```diff\n@@ -10,6 +10,7 @@\n import git\n import typer\n import yaml\n+from doc_parsing_utils import check_translation\n from github import Github\n from pydantic_ai import Agent\n from rich import print\n@@ -119,9 +120,30 @@ def translate_page(\n         ]\n     )\n     prompt = \"\\n\\n\".join(prompt_segments)\n-    print(f\"Running agent for {out_path}\")\n-    result = agent.run_sync(prompt)\n-    out_content = f\"{result.output.strip()}\\n\"\n+\n+    MAX_ATTEMPTS = 3\n+    for attempt_no in range(1, MAX_ATTEMPTS + 1):\n+        print(f\"Running agent for {out_path} (attempt {attempt_no}/{MAX_ATTEMPTS})\")\n+        result = agent.run_sync(prompt)\n+        out_content = f\"{result.output.strip()}\\n\"\n+        try:\n+            check_translation(\n+                doc_lines=out_content.splitlines(),\n+                en_doc_lines=original_content.splitlines(),\n+                lang_code=language,\n+                auto_fix=False,\n+                path=str(out_path),\n+            )\n+            break  # Exit loop if no errors\n+        except ValueError as e:\n+            print(\n+                f\"Translation check failed on attempt {attempt_no}/{MAX_ATTEMPTS}: {e}\"\n+            )\n+            continue  # Retry if not reached max attempts\n+    else:  # Max retry attempts reached\n+        print(f\"Translation failed for {out_path} after {MAX_ATTEMPTS} attempts\")\n+        raise typer.Exit(code=1)\n+\n     print(f\"Saving translation to {out_path}\")\n     out_path.write_text(out_content, encoding=\"utf-8\", newline=\"\\n\")\n \n\n```", "output": "Changes look good. This PR implements: üî® Update translation script to retry if LLM-response doesn't pass validation with Translation Fixer tool", "source": "pr", "type": "code_review", "pr_number": 358}
{"instruction": "Review the following code changes: üìù Use return type annotation instead of `response_model` when possible", "input": "```diff\n@@ -52,7 +52,7 @@ In these cases, it could make sense to store the tags in an `Enum`.\n \n You can add a `summary` and `description`:\n \n-{* ../../docs_src/path_operation_configuration/tutorial003_py310.py hl[18:19] *}\n+{* ../../docs_src/path_operation_configuration/tutorial003_py310.py hl[17:18] *}\n \n ## Description from docstring { #description-from-docstring }\n \n@@ -70,7 +70,7 @@ It will be used in the interactive docs:\n \n You can specify the response description with the parameter `response_description`:\n \n-{* ../../docs_src/path_operation_configuration/tutorial005_py310.py hl[19] *}\n+{* ../../docs_src/path_operation_configuration/tutorial005_py310.py hl[18] *}\n \n /// info\n \n\n```\n\n```diff\n@@ -28,8 +28,8 @@ async def read_main(item_id: str, x_token: Annotated[str, Header()]):\n     return fake_db[item_id]\n \n \n-@app.post(\"/items/\", response_model=Item)\n-async def create_item(item: Item, x_token: Annotated[str, Header()]):\n+@app.post(\"/items/\")\n+async def create_item(item: Item, x_token: Annotated[str, Header()]) -> Item:\n     if x_token != fake_secret_token:\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n\n```\n\n```diff\n@@ -28,8 +28,8 @@ async def read_main(item_id: str, x_token: Annotated[str, Header()]):\n     return fake_db[item_id]\n \n \n-@app.post(\"/items/\", response_model=Item)\n-async def create_item(item: Item, x_token: Annotated[str, Header()]):\n+@app.post(\"/items/\")\n+async def create_item(item: Item, x_token: Annotated[str, Header()]) -> Item:\n     if x_token != fake_secret_token:\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n\n```\n\n```diff\n@@ -26,8 +26,8 @@ async def read_main(item_id: str, x_token: str = Header()):\n     return fake_db[item_id]\n \n \n-@app.post(\"/items/\", response_model=Item)\n-async def create_item(item: Item, x_token: str = Header()):\n+@app.post(\"/items/\")\n+async def create_item(item: Item, x_token: str = Header()) -> Item:\n     if x_token != fake_secret_token:\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n\n```\n\n```diff\n@@ -28,8 +28,8 @@ async def read_main(item_id: str, x_token: str = Header()):\n     return fake_db[item_id]\n \n \n-@app.post(\"/items/\", response_model=Item)\n-async def create_item(item: Item, x_token: str = Header()):\n+@app.post(\"/items/\")\n+async def create_item(item: Item, x_token: str = Header()) -> Item:\n     if x_token != fake_secret_token:\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n\n```", "output": "Changes look good. This PR implements: üìù Use return type annotation instead of `response_model` when possible", "source": "pr", "type": "code_review", "pr_number": 357}
{"instruction": "Fix the following bug: üìù Fix dependency installation command in `docs/en/docs/contributing.md`", "input": "Just `uv sync` will not install optional dependencies, but some dependencies from `all` option are required for tests:\r\n\r\n```\r\nE   ModuleNotFoundError: No module named 'orjson'\r\n```\r\n\r\nDiscussed this with @DoctorJohn, this solution was actually proposed by him.\r\n\r\nAlternatively we can duplicate required dependencies in `tests` group:\r\n\r\n```\r\n    \"orjson >=3.2.1\",\r\n    \"fastapi-cli[standard] >=0.0.8\",\r\n    \"email-validator >=2.0.0\",\r\n    \"ujson >=4.0.1,!=4.0.2,!=4.1.0,!=4.2.0,!=4.3.0,!=5.0.0,!=5.1.0\",\r\n```", "output": "```diff\n@@ -13,7 +13,7 @@ Create a virtual environment and install the required packages with <a href=\"htt\n <div class=\"termy\">\n \n \n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 356}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -13,7 +13,7 @@ Create a virtual environment and install the required packages with <a href=\"htt\n <div class=\"termy\">\n \n \n```", "output": "Bug: üìù Fix dependency installation command in `docs/en/docs/contributing.md`\n\nJust `uv sync` will not install optional dependencies, but some dependencies from `all` option are required for tests:\r\n\r\n```\r\nE   ModuleNotFoundError: No module named 'orjson'\r\n```\r\n\r\nDiscussed this with @DoctorJohn, this solution was actually proposed by him.\r\n\r\nAlternatively we can duplicate required dependencies in `tests` group:\r\n\r\n```\r\n    \"orjson >=3.2.1\",\r\n    \"fastapi-cli[standard] >=0.0.8\",\r\n    \"email-validator >=2.0.0\",\r\n    \"ujson >=4.0.1,!=4.0.2,!=4.1.0,!=4.2.0,!=4.3.0,!=5.0.0,!=5.1.0\",\r\n```", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 356}
{"instruction": "Review the following code changes: üìù Fix dependency installation command in `docs/en/docs/contributing.md`", "input": "```diff\n@@ -13,7 +13,7 @@ Create a virtual environment and install the required packages with <a href=\"htt\n <div class=\"termy\">\n \n \n```", "output": "Changes look good. This PR implements: üìù Fix dependency installation command in `docs/en/docs/contributing.md`", "source": "pr", "type": "code_review", "pr_number": 356}
{"instruction": "Review the following code changes: üìù Update embedded code examples to Python 3.10 syntax", "input": "```diff\n@@ -164,8 +164,6 @@ $ pip install \"fastapi[standard]\"\n Create a file `main.py` with:\n \n \n```\n\n```diff\n@@ -145,8 +145,6 @@ There are other formats and tools to define and install package dependencies.\n * Create a `main.py` file with:\n \n \n```\n\n```diff\n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n Create a file `main.py` with:\n \n \n```\n\n```diff\n@@ -103,15 +103,16 @@ Of course, you can also declare additional query parameters whenever you need, a\n As, by default, singular values are interpreted as query parameters, you don't have to explicitly add a `Query`, you can just do:\n \n \n```", "output": "Changes look good. This PR implements: üìù Update embedded code examples to Python 3.10 syntax", "source": "pr", "type": "code_review", "pr_number": 355}
{"instruction": "Review the following code changes: üìù Add links to related sections of docs to docstrings", "input": "```diff\n@@ -2,6 +2,8 @@\n \n You can declare a parameter in a *path operation function* or dependency to be of type `Request` and then you can access the raw request object directly, without any validation, etc.\n \n+Read more about it in the [FastAPI docs about using Request directly](https://fastapi.tiangolo.com/advanced/using-request-directly/)\n+\n You can import it directly from `fastapi`:\n \n \n```\n\n```diff\n@@ -4,6 +4,8 @@ You can declare a parameter in a *path operation function* or dependency to be o\n \n You can also use it directly to create an instance of it and return it from your *path operations*.\n \n+Read more about it in the [FastAPI docs about returning a custom Response](https://fastapi.tiangolo.com/advanced/response-directly/#returning-a-custom-response)\n+\n You can import it directly from `fastapi`:\n \n \n```\n\n```diff\n@@ -56,6 +56,8 @@ There are a couple of custom FastAPI response classes, you can use them to optim\n \n ## Starlette Responses\n \n+You can read more about all of them in the [FastAPI docs for Custom Response](https://fastapi.tiangolo.com/advanced/custom-response/) and in the [Starlette docs about Responses](https://starlette.dev/responses/).\n+\n ::: fastapi.responses.FileResponse\n     options:\n         members:\n\n```\n\n```diff\n@@ -28,6 +28,8 @@ from fastapi.security import (\n )\n \n```\n\n```diff\n@@ -2,6 +2,8 @@\n \n When defining WebSockets, you normally declare a parameter of type `WebSocket` and with it you can read data from the client and send data to it.\n \n+Read more about it in the [FastAPI docs for WebSockets](https://fastapi.tiangolo.com/advanced/websockets/)\n+\n It is provided directly by Starlette, but you can import it from `fastapi`:\n \n \n```", "output": "Changes look good. This PR implements: üìù Add links to related sections of docs to docstrings", "source": "pr", "type": "code_review", "pr_number": 354}
{"instruction": "Fix the following bug: üêõ Fix OpenAPI duplication of `anyOf` refs for app-level responses with specified `content` and `model` as `Union`", "input": "## Summary\r\n\r\nFixes an issue where defining app-level `responses={...}` with a `Union` of Pydantic models **and** specifying `[\"content\"][...][\"examples\"]` causes the generated OpenAPI schema to accumulate duplicate `$ref` entries in the `anyOf` array.\r\n\r\n\r\n\r\n## Minimal reproducible example\r\n\r\n<details open>\r\n<summary> <code>app.py</code> </summary>\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass ModelA(BaseModel):\r\n    a: str\r\n\r\n\r\nclass ModelB(BaseModel):\r\n    b: str\r\n\r\n\r\napp = FastAPI(\r\n    responses={\r\n        500: {\r\n            'model': ModelA | ModelB,\r\n            'content': {\"application/json\": {\r\n                'examples': {\"Case A\": {\"value\": \"a\"}}\r\n            }}\r\n        }\r\n    }\r\n)\r\n\r\n\r\n@app.get('/route1')\r\ndef route1():\r\n    return \"test\"\r\n\r\n@app.get('/route2')\r\ndef route2():\r\n    return \"test\"\r\n\r\n@app.get('/route3')\r\ndef route2():\r\n    return \"test\"\r\n```\r\n</details>\r\n\r\n<details open>\r\n<summary>Generated <code>/openapi.json</code> excerpt (<code>paths[\"/route1\"][\"get\"][\"responses\"]</code>)</summary>\r\n\r\n```json\r\n{\r\n  \"500\": {\r\n    \"description\": \"Internal Server Error\",\r\n    \"content\": {\r\n      \"application/json\": {\r\n        \"schema\": {\r\n          \"anyOf\": [\r\n            { \"$ref\": \"#/components/schemas/ModelA\" },\r\n            { \"$ref\": \"#/components/schemas/ModelB\" },\r\n            { \"$ref\": \"#/components/schemas/ModelA\" },\r\n            { \"$ref\": \"#/components/schemas/ModelB\" },\r\n            { \"$ref\": \"#/components/schemas/ModelA\" },\r\n            { \"$ref\": \"#/components/schemas/ModelB\" }\r\n          ]\r\n        }\r\n       }\r\n     }\r\n  }\r\n}\r\n```\r\n</details>\r\n\r\nAs you can see, the `$ref`s are duplicated three times within `anyOf`. \r\n\r\nThis appears to be an unintended behavior, since FastAPI‚Äôs documentation does not indicate that specifying both a `model` and `content` is prohibited. The generated schema is still valid, but the duplication grows with teh route count and produces excessively large `anyOf` lists for bigger applications.\r\n\r\n\r\n<details open>\r\n<summary> <h2>Root Cause</h2> </summary>\r\n\r\n[Relevant Code Snippet](https://github.com/fastapi/fastapi/blob/f0dd1046a688935ffd23666b3d4164b838a4d8fe/fastapi/openapi/utils.py#L376-L416)\r\n\r\nFirst, `additional_response` is taken from the `route` object:\r\n\r\nhttps://github.com/fastapi/fastapi/blob/f0dd1046a688935ffd23666b3d4164b838a4d8fe/fastapi/openapi/utils.py#L376-L379\r\n\r\n<details>\r\n<summary> Example <code>additional_response</code> </summary>\r\n\r\n```python\r\n{\r\n    'model': ModelA | ModelB,\r\n    'content': {\"application/json\": {\r\n        'examples': {\"Case A\": {\"value\": \"a\"}}\r\n    }}\r\n}\r\n```\r\n</details>\r\n\r\n `additional_response` is *shallowly* `.copy()`ed into `process_response`:\r\n\r\nhttps://github.com/fastapi/fastapi/blob/f0dd1046a688935ffd23666b3d4164b838a4d8fe/fastapi/openapi/utils.py#L380\r\n\r\nNow, `id(process_response['content']) == id(additional_response['content'])`, so when `process_response['content']` is modified, the `route.responses` object inadv", "output": "```diff\n@@ -1,3 +1,4 @@\n+import copy\n import http.client\n import inspect\n import warnings\n@@ -377,7 +378,7 @@ def get_openapi_path(\n                     additional_status_code,\n                     additional_response,\n                 ) in route.responses.items():\n-                    process_response = additional_response.copy()\n+                    process_response = copy.deepcopy(additional_response)\n                     process_response.pop(\"model\", None)\n                     status_code_key = str(additional_status_code).upper()\n                     if status_code_key == \"DEFAULT\":\n\n```\n\n```diff\n@@ -0,0 +1,123 @@\n+\"\"\"\n+Regression test: Ensure app-level responses with Union models and content/examples\n+don't accumulate duplicate $ref entries in anyOf arrays.\n+See https://github.com/fastapi/fastapi/pull/14463\n+\"\"\"\n+\n+from typing import Union\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class ModelA(BaseModel):\n+    a: str\n+\n+\n+class ModelB(BaseModel):\n+    b: str\n+\n+\n+app = FastAPI(\n+    responses={\n+        500: {\n+            \"model\": Union[ModelA, ModelB],\n+            \"content\": {\"application/json\": {\"examples\": {\"Case A\": {\"value\": \"a\"}}}},\n+        }\n+    }\n+)\n+\n+\n+@app.get(\"/route1\")\n+async def route1():\n+    pass  # pragma: no cover\n+\n+\n+@app.get(\"/route2\")\n+async def route2():\n+    pass  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"openapi\": \"3.1.0\",\n+        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+        \"paths\": {\n+            \"/route1\": {\n+                \"get\": {\n+                    \"summary\": \"Route1\",\n+                    \"operationId\": \"route1_route1_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"500\": {\n+                            \"description\": \"Internal Server Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"anyOf\": [\n+                                            {\"$ref\": \"#/components/schemas/ModelA\"},\n+                                            {\"$ref\": \"#/components/schemas/ModelB\"},\n+                                        ],\n+                                        \"title\": \"Response 500 Route1 Route1 Get\",\n+                                    },\n+                                    \"examples\": {\"Case A\": {\"value\": \"a\"}},\n+                                }\n+                            },\n+                        },\n+                    },\n+                }\n+            },\n+            \"/route2\": {\n+                \"get\": {\n+                    \"summary\": \"Route2\",\n+                    \"operationId\": \"route2_route2_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"500\": {\n+                            \"description\": \"Internal Server Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"sc\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 353}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,3 +1,4 @@\n+import copy\n import http.client\n import inspect\n import warnings\n@@ -377,7 +378,7 @@ def get_openapi_path(\n                     additional_status_code,\n                     additional_response,\n                 ) in route.responses.items():\n-                    process_response = additional_response.copy()\n+                    process_response = copy.deepcopy(additional_response)\n                     process_response.pop(\"model\", None)\n                     status_code_key = str(additional_status_code).upper()\n                     if status_code_key == \"DEFAULT\":\n\n```\n\n```diff\n@@ -0,0 +1,123 @@\n+\"\"\"\n+Regression test: Ensure app-level responses with Union models and content/examples\n+don't accumulate duplicate $ref entries in anyOf arrays.\n+See https://github.com/fastapi/fastapi/pull/14463\n+\"\"\"\n+\n+from typing import Union\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class ModelA(BaseModel):\n+    a: str\n+\n+\n+class ModelB(BaseModel):\n+    b: str\n+\n+\n+app = FastAPI(\n+    responses={\n+        500: {\n+            \"model\": Union[ModelA, ModelB],\n+            \"content\": {\"application/json\": {\"examples\": {\"Case A\": {\"value\": \"a\"}}}},\n+        }\n+    }\n+)\n+\n+\n+@app.get(\"/route1\")\n+async def route1():\n+    pass  # pragma: no cover\n+\n+\n+@app.get(\"/route2\")\n+async def route2():\n+    pass  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"openapi\": \"3.1.0\",\n+        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+        \"paths\": {\n+            \"/route1\": {\n+                \"get\": {\n+                    \"summary\": \"Route1\",\n+                    \"operationId\": \"route1_route1_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"500\": {\n+                            \"description\": \"Internal Server Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"anyOf\": [\n+                                            {\"$ref\": \"#/components/schemas/ModelA\"},\n+                                            {\"$ref\": \"#/components/schemas/ModelB\"},\n+                                        ],\n+                                        \"title\": \"Response 500 Route1 Route1 Get\",\n+                                    },\n+                                    \"examples\": {\"Case A\": {\"value\": \"a\"}},\n+                                }\n+                            },\n+                        },\n+                    },\n+                }\n+            },\n+            \"/route2\": {\n+                \"get\": {\n+                    \"summary\": \"Route2\",\n+                    \"operationId\": \"route2_route2_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"500\": {\n+                            \"description\": \"Internal Server Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"sc\n\n```", "output": "Bug: üêõ Fix OpenAPI duplication of `anyOf` refs for app-level responses with specified `content` and `model` as `Union`\n\n## Summary\r\n\r\nFixes an issue where defining app-level `responses={...}` with a `Union` of Pydantic models **and** specifying `[\"content\"][...][\"examples\"]` causes the generated OpenAPI schema to accumulate duplicate `$ref` entries in the `anyOf` array.\r\n\r\n\r\n\r\n## Minimal reproducible example\r\n\r\n<details open>\r\n<summary> <code>app.py</code> </summary>\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass ModelA(BaseModel):\r\n    a: str\r\n\r\n\r\nclass ModelB(BaseModel):\r\n    b: str\r\n\r\n\r\napp = FastAPI(\r\n    responses={\r\n        500: {\r\n            'model': ModelA | ModelB,\r\n            'content': {\"application/json\": {\r\n                'examples': {\"Case A\": {\"value\": \"a\"}}\r\n            }}\r\n        }\r\n    }\r\n)\r\n\r\n\r\n@app.get('/route1')\r\ndef route1():\r\n    return \"test\"\r\n\r\n@app.get('/route2')\r\ndef route2():\r\n    return \"test\"\r\n\r\n@app.get('/route3')\r\ndef route2():\r\n    return \"test\"\r\n```\r\n</details>\r\n\r\n<details open>\r\n<summary>Generated <code>/openapi.json</code> excerpt (<code>paths[\"/route1\"][\"get\"][\"responses\"]</code>)</summary>\r\n\r\n```json\r\n{\r\n  \"500\": {\r\n    \"description\": \"Internal Server Error\",\r\n    \"content\": {\r\n      \"application/json\": {\r\n        \"schema\": {\r\n          \"anyOf\": [\r\n            { \"$ref\": \"#/components/schemas/ModelA\" },\r\n            { \"$ref\": \"#/components/schemas/ModelB\" },\r\n            { \"$ref\": \"#/components/schemas/ModelA\" },\r\n            { \"$ref\": \"#/components/schemas/ModelB\" },\r\n            { \"$ref\": \"#/components/schemas/ModelA\" },\r\n            { \"$ref\": \"#/components/schemas/ModelB\" }\r\n          ]\r\n        }\r\n       }\r\n     }\r\n  }\r\n}\r\n```\r\n</details>\r\n\r\nAs you can see, the `$ref`s are duplicated three times within `anyOf`. \r\n\r\nThis appears to be an unintended behavior, since FastAPI‚Äôs documentation does not indicate that specifying both a `model` and `content` is prohibited. The generated schema is still valid, but the duplication grows with teh route count and produces excessively large `anyOf` lists for bigger applications.\r\n\r\n\r\n<details open>\r\n<summary> <h2>Root Cause</h2> </summary>\r\n\r\n[Relevant Code Snippet](https://github.com/fastapi/fastapi/blob/f0dd1046a688935ffd23666b3d4164b838a4d8fe/fastapi/openapi/utils.py#L376-L416)\r\n\r\nFirst, `additional_response` is taken from the `route` object:\r\n\r\nhttps://github.com/fastapi/fastapi/blob/f0dd1046a688935ffd23666b3d4164b838a4d8fe/fastapi/openapi/utils.py#L376-L379\r\n\r\n<details>\r\n<summary> Example <code>additional_response</code> </summary>\r\n\r\n```python\r\n{\r\n    'model': ModelA | ModelB,\r\n    'content': {\"application/json\": {\r\n        'examples': {\"Case A\": {\"value\": \"a\"}}\r\n    }}\r\n}\r\n```\r\n</details>\r\n\r\n `additional_response` is *shallowly* `.copy()`ed into `process_response`:\r\n\r\nhttps://github.com/fastapi/fastapi/blob/f0dd1046a688935ffd23666b3d4164b838a4d8fe/fastapi/openapi/utils.py#L380\r\n\r\nNow, `id(process_response['content']) == id(additional_response['content'])`, so when `process_response['content']` is modified, the `route.responses` object inadv", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 353}
{"instruction": "Review the following code changes: üêõ Fix OpenAPI duplication of `anyOf` refs for app-level responses with specified `content` and `model` as `Union`", "input": "```diff\n@@ -1,3 +1,4 @@\n+import copy\n import http.client\n import inspect\n import warnings\n@@ -377,7 +378,7 @@ def get_openapi_path(\n                     additional_status_code,\n                     additional_response,\n                 ) in route.responses.items():\n-                    process_response = additional_response.copy()\n+                    process_response = copy.deepcopy(additional_response)\n                     process_response.pop(\"model\", None)\n                     status_code_key = str(additional_status_code).upper()\n                     if status_code_key == \"DEFAULT\":\n\n```\n\n```diff\n@@ -0,0 +1,123 @@\n+\"\"\"\n+Regression test: Ensure app-level responses with Union models and content/examples\n+don't accumulate duplicate $ref entries in anyOf arrays.\n+See https://github.com/fastapi/fastapi/pull/14463\n+\"\"\"\n+\n+from typing import Union\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class ModelA(BaseModel):\n+    a: str\n+\n+\n+class ModelB(BaseModel):\n+    b: str\n+\n+\n+app = FastAPI(\n+    responses={\n+        500: {\n+            \"model\": Union[ModelA, ModelB],\n+            \"content\": {\"application/json\": {\"examples\": {\"Case A\": {\"value\": \"a\"}}}},\n+        }\n+    }\n+)\n+\n+\n+@app.get(\"/route1\")\n+async def route1():\n+    pass  # pragma: no cover\n+\n+\n+@app.get(\"/route2\")\n+async def route2():\n+    pass  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_openapi_schema():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"openapi\": \"3.1.0\",\n+        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+        \"paths\": {\n+            \"/route1\": {\n+                \"get\": {\n+                    \"summary\": \"Route1\",\n+                    \"operationId\": \"route1_route1_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"500\": {\n+                            \"description\": \"Internal Server Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"anyOf\": [\n+                                            {\"$ref\": \"#/components/schemas/ModelA\"},\n+                                            {\"$ref\": \"#/components/schemas/ModelB\"},\n+                                        ],\n+                                        \"title\": \"Response 500 Route1 Route1 Get\",\n+                                    },\n+                                    \"examples\": {\"Case A\": {\"value\": \"a\"}},\n+                                }\n+                            },\n+                        },\n+                    },\n+                }\n+            },\n+            \"/route2\": {\n+                \"get\": {\n+                    \"summary\": \"Route2\",\n+                    \"operationId\": \"route2_route2_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"500\": {\n+                            \"description\": \"Internal Server Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"sc\n\n```", "output": "Changes look good. This PR implements: üêõ Fix OpenAPI duplication of `anyOf` refs for app-level responses with specified `content` and `model` as `Union`", "source": "pr", "type": "code_review", "pr_number": 353}
{"instruction": "Fix the following bug: üö∏ Improve error message for invalid query parameter type annotations", "input": "When I bumped FastAPI from 0.181.1 to 0.181.2, project started crashing on startup with AssertionError. The traceback didn‚Äôt provide any helpful context. After debugging, I found that issue was caused by incorrectly typed query parameters after the changes introduced in PR #12942 \r\n\r\nThis PR adds a clearer error message to assertion, indicating that query parameter type is incorrect, and updates tests to ensure that new message is present.\r\n\r\nBelow is an example of a wrongly typed query parameter that didn‚Äôt fail before 0.181.2, but starts failing in 0.181.2 and later:\r\n```python\r\nfrom typing import Annotated, Any\r\nfrom fastapi import FastAPI, Query\r\nfrom pydantic import BeforeValidator, WithJsonSchema\r\n\r\napp = FastAPI()\r\n\r\nFilterableStr = Annotated[\r\n    str | dict,\r\n    BeforeValidator(lambda x: x),\r\n    WithJsonSchema({\"type\": \"string\"}, mode=\"serialization\"),\r\n]\r\n\r\n@app.get(\"/hello\")\r\nasync def get_hello(data: FilterableStr | None = Query(default=None)) -> Any:\r\n    return data\r\n```\r\n\r\n\r\nStacktrace before:\r\n```python\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 630, in __init__\r\n    self.dependant = get_dependant(path=self.path_format, call=self.endpoint)\r\n                     ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 293, in get_dependant\r\n    param_details = analyze_param(\r\n        param_name=param_name,\r\n    ...<2 lines>...\r\n        is_path_param=is_path_param,\r\n    )\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 510, in analyze_param\r\n    is_scalar_field(field)\r\n    ...<5 lines>...\r\n    )\r\nAssertionError\r\n```\r\n\r\nStacktrace after:\r\n```python\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 293, in get_dependant\r\n    param_details = analyze_param(\r\n        param_name=param_name,\r\n    ...<2 lines>...\r\n        is_path_param=is_path_param,\r\n    )\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 510, in analyze_param\r\n    is_scalar_field(field)\r\n    ...<5 lines>...\r\n    )\r\nAssertionError: Query param 'data' must be of one of the supported types\r\n```", "output": "```diff\n@@ -552,7 +552,7 @@ def analyze_param(\n                     # For Pydantic v1\n                     and getattr(field, \"shape\", 1) == 1\n                 )\n-            )\n+            ), f\"Query parameter {param_name!r} must be one of the supported types\"\n \n     return ParamDetails(type_annotation=type_annotation, depends=depends, field=field)\n \n\n```\n\n```diff\n@@ -6,7 +6,10 @@\n \n \n def test_invalid_sequence():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -18,7 +21,10 @@ def read_items(q: list[Item] = Query(default=None)):\n \n \n def test_invalid_tuple():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -30,7 +36,10 @@ def read_items(q: tuple[Item, Item] = Query(default=None)):\n \n \n def test_invalid_dict():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -42,7 +51,10 @@ def read_items(q: dict[str, Item] = Query(default=None)):\n \n \n def test_invalid_simple_dict():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 352}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -552,7 +552,7 @@ def analyze_param(\n                     # For Pydantic v1\n                     and getattr(field, \"shape\", 1) == 1\n                 )\n-            )\n+            ), f\"Query parameter {param_name!r} must be one of the supported types\"\n \n     return ParamDetails(type_annotation=type_annotation, depends=depends, field=field)\n \n\n```\n\n```diff\n@@ -6,7 +6,10 @@\n \n \n def test_invalid_sequence():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -18,7 +21,10 @@ def read_items(q: list[Item] = Query(default=None)):\n \n \n def test_invalid_tuple():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -30,7 +36,10 @@ def read_items(q: tuple[Item, Item] = Query(default=None)):\n \n \n def test_invalid_dict():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -42,7 +51,10 @@ def read_items(q: dict[str, Item] = Query(default=None)):\n \n \n def test_invalid_simple_dict():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n\n```", "output": "Bug: üö∏ Improve error message for invalid query parameter type annotations\n\nWhen I bumped FastAPI from 0.181.1 to 0.181.2, project started crashing on startup with AssertionError. The traceback didn‚Äôt provide any helpful context. After debugging, I found that issue was caused by incorrectly typed query parameters after the changes introduced in PR #12942 \r\n\r\nThis PR adds a clearer error message to assertion, indicating that query parameter type is incorrect, and updates tests to ensure that new message is present.\r\n\r\nBelow is an example of a wrongly typed query parameter that didn‚Äôt fail before 0.181.2, but starts failing in 0.181.2 and later:\r\n```python\r\nfrom typing import Annotated, Any\r\nfrom fastapi import FastAPI, Query\r\nfrom pydantic import BeforeValidator, WithJsonSchema\r\n\r\napp = FastAPI()\r\n\r\nFilterableStr = Annotated[\r\n    str | dict,\r\n    BeforeValidator(lambda x: x),\r\n    WithJsonSchema({\"type\": \"string\"}, mode=\"serialization\"),\r\n]\r\n\r\n@app.get(\"/hello\")\r\nasync def get_hello(data: FilterableStr | None = Query(default=None)) -> Any:\r\n    return data\r\n```\r\n\r\n\r\nStacktrace before:\r\n```python\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/routing.py\", line 630, in __init__\r\n    self.dependant = get_dependant(path=self.path_format, call=self.endpoint)\r\n                     ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 293, in get_dependant\r\n    param_details = analyze_param(\r\n        param_name=param_name,\r\n    ...<2 lines>...\r\n        is_path_param=is_path_param,\r\n    )\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 510, in analyze_param\r\n    is_scalar_field(field)\r\n    ...<5 lines>...\r\n    )\r\nAssertionError\r\n```\r\n\r\nStacktrace after:\r\n```python\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 293, in get_dependant\r\n    param_details = analyze_param(\r\n        param_name=param_name,\r\n    ...<2 lines>...\r\n        is_path_param=is_path_param,\r\n    )\r\n  File \"/Users/tony/Projects/fastapi_exampl/.venv/lib/python3.13/site-packages/fastapi/dependencies/utils.py\", line 510, in analyze_param\r\n    is_scalar_field(field)\r\n    ...<5 lines>...\r\n    )\r\nAssertionError: Query param 'data' must be of one of the supported types\r\n```", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 352}
{"instruction": "Review the following code changes: üö∏ Improve error message for invalid query parameter type annotations", "input": "```diff\n@@ -552,7 +552,7 @@ def analyze_param(\n                     # For Pydantic v1\n                     and getattr(field, \"shape\", 1) == 1\n                 )\n-            )\n+            ), f\"Query parameter {param_name!r} must be one of the supported types\"\n \n     return ParamDetails(type_annotation=type_annotation, depends=depends, field=field)\n \n\n```\n\n```diff\n@@ -6,7 +6,10 @@\n \n \n def test_invalid_sequence():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -18,7 +21,10 @@ def read_items(q: list[Item] = Query(default=None)):\n \n \n def test_invalid_tuple():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -30,7 +36,10 @@ def read_items(q: tuple[Item, Item] = Query(default=None)):\n \n \n def test_invalid_dict():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n@@ -42,7 +51,10 @@ def read_items(q: dict[str, Item] = Query(default=None)):\n \n \n def test_invalid_simple_dict():\n-    with pytest.raises(AssertionError):\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Query parameter 'q' must be one of the supported types\",\n+    ):\n         app = FastAPI()\n \n         class Item(BaseModel):\n\n```", "output": "Changes look good. This PR implements: üö∏ Improve error message for invalid query parameter type annotations", "source": "pr", "type": "code_review", "pr_number": 352}
{"instruction": "Review the following code changes: üìù Add banner to translated pages", "input": "```diff\n@@ -0,0 +1,11 @@\n+/// details | üåê Translation by AI and humans\n+\n+This translation was made by AI guided by humans. ü§ù\n+\n+It could have mistakes of misunderstanding the original meaning, or looking unnatural, etc. ü§ñ\n+\n+You can improve this translation by [helping us guide the AI LLM better](https://fastapi.tiangolo.com/contributing/#translations).\n+\n+[English version](ENGLISH_VERSION_URL)\n+\n+///\n\n```\n\n```diff\n@@ -0,0 +1,11 @@\n+/// details | üåê –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –ø–æ–º–æ—â—å—é –ò–ò –∏ –ª—é–¥–µ–π\n+\n+–≠—Ç–æ—Ç –ø–µ—Ä–µ–≤–æ–¥ –±—ã–ª —Å–¥–µ–ª–∞–Ω –ò–ò –ø–æ–¥ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ª—é–¥–µ–π. ü§ù\n+\n+–í –Ω–µ–º –º–æ–≥—É—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–º—ã—Å–ª–∞ –∏–ª–∏ –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç. –¥. ü§ñ\n+\n+–í—ã –º–æ–∂–µ—Ç–µ —É–ª—É—á—à–∏—Ç—å —ç—Ç–æ—Ç –ø–µ—Ä–µ–≤–æ–¥, [–ø–æ–º–æ–≥–∞—è –Ω–∞–º –ª—É—á—à–µ –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –ò–ò LLM](https://fastapi.tiangolo.com/ru/contributing/#translations).\n+\n+[–ê–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è](ENGLISH_VERSION_URL)\n+\n+///\n\n```\n\n```diff\n@@ -26,6 +26,17 @@ def get_missing_translation_content(docs_dir: str) -> str:\n     return missing_translation_path.read_text(encoding=\"utf-8\")\n \n \n+@lru_cache\n+def get_translation_banner_content(docs_dir: str) -> str:\n+    docs_dir_path = Path(docs_dir)\n+    translation_banner_path = docs_dir_path / \"translation-banner.md\"\n+    if not translation_banner_path.is_file():\n+        translation_banner_path = (\n+            docs_dir_path.parent.parent / \"en\" / \"docs\" / \"translation-banner.md\"\n+        )\n+    return translation_banner_path.read_text(encoding=\"utf-8\")\n+\n+\n @lru_cache\n def get_mkdocs_material_langs() -> list[str]:\n     material_path = Path(material.__file__).parent\n@@ -151,4 +162,21 @@ def on_page_markdown(\n         if markdown.startswith(\"#\"):\n             header, _, body = markdown.partition(\"\\n\\n\")\n         return f\"{header}\\n\\n{missing_translation_content}\\n\\n{body}\"\n-    return markdown\n+\n+    docs_dir_path = Path(config.docs_dir)\n+    en_docs_dir_path = docs_dir_path.parent.parent / \"en/docs\"\n+\n+    if docs_dir_path == en_docs_dir_path:\n+        return markdown\n+\n+    # For translated pages add translation banner\n+    translation_banner_content = get_translation_banner_content(config.docs_dir)\n+    en_url = \"https://fastapi.tiangolo.com/\" + page.url.lstrip(\"/\")\n+    translation_banner_content = translation_banner_content.replace(\n+        \"ENGLISH_VERSION_URL\", en_url\n+    )\n+    header = \"\"\n+    body = markdown\n+    if markdown.startswith(\"#\"):\n+        header, _, body = markdown.partition(\"\\n\\n\")\n+    return f\"{header}\\n\\n{translation_banner_content}\\n\\n{body}\"\n\n```\n\n```diff\n@@ -294,6 +294,7 @@ markdown_extensions:\n     - info\n     - check\n   pymdownx.blocks.details: null\n+  pymdownx.details: null\n\n```\n\n```diff\n@@ -294,6 +294,7 @@ markdown_extensions:\n     - info\n     - check\n   pymdownx.blocks.details: null\n+  pymdownx.details: null\n\n```", "output": "Code Review for: üìù Add banner to translated pages\n\nüìù **docs/en/mkdocs.yml**: Is the line above valid?\nI haven't found docs about it. Maybe just a typo?\n\nüìù **docs/en/mkdocs.yml**: Ah, yep, it's here: https://facelessuser.github.io/pymdown-extensions/extensions/blocks/plugins/details/\n\nüìù **scripts/mkdocs_hooks.py**: Looking at this I'm realizing that we already have the data to put there a link to the original in English, that might help.\n\nüìù **docs/en/mkdocs.yml**: Thanks!\r\nUpdated\n\nüìù **scripts/mkdocs_hooks.py**: Added link\n\n", "source": "pr", "type": "code_review", "pr_number": 351}
{"instruction": "Review this code change in `docs/en/mkdocs.yml`", "input": "```diff\n@@ -294,6 +294,7 @@ markdown_extensions:\n     - info\n     - check\n   pymdownx.blocks.details: null\n+  pymdownx.details: null\n\n```", "output": "Is the line above valid?\nI haven't found docs about it. Maybe just a typo?", "source": "pr_review", "type": "inline_review", "pr_number": 351}
{"instruction": "Review this code change in `scripts/mkdocs_hooks.py`", "input": "```diff\n@@ -151,4 +162,17 @@ def on_page_markdown(\n         if markdown.startswith(\"#\"):\n             header, _, body = markdown.partition(\"\\n\\n\")\n         return f\"{header}\\n\\n{missing_translation_content}\\n\\n{body}\"\n-    return markdown\n+\n+    docs_dir_path = Path(config.docs_dir)\n+    en_docs_dir_path = docs_dir_path.parent.parent / \"en/docs\"\n+\n+    if docs_dir_path == en_docs_dir_path:\n+        return markdown\n+\n+    # For translated pages add translation banner\n+    translation_banner_content = get_translation_banner_content(config.docs_dir)\n+    header = \"\"\n+    body = markdown\n+    if markdown.startswith(\"#\"):\n+        header, _, body = markdown.partition(\"\\n\\n\")\n+    return f\"{header}\\n\\n{translation_banner_content}\\n\\n{body}\"\n\n```", "output": "Looking at this I'm realizing that we already have the data to put there a link to the original in English, that might help.", "source": "pr_review", "type": "inline_review", "pr_number": 351}
{"instruction": "Fix the following bug: üìù Add validation error example for `Enum` path parameter", "input": "## Description\r\nAdds an example showing validation errors when using Enum path parameters in FastAPI.\r\n\r\n## Problem\r\nThe tutorial previously did not include clear examples of what happens when a path parameter fails Enum validation, which can be confusing for beginners.\r\n\r\n## Solution\r\n- Adds a JSON-formatted example showing the validation error FastAPI returns for an invalid Enum value.\r\n- Highlights the `loc`, `type`, `msg`, and `input` fields in the response.\r\n\r\n## Impact\r\nHelps beginners understand FastAPI's automatic validation for Enums and interpret error responses correctly.\r\n\r\n## Type of Change\r\n- [x] Documentation improvement\r\n- [ ] Bug fix\r\n- [ ] New feature\r\n- [ ] Breaking change\r\n\r\n## Checklist\r\n- [x] Documentation follows style guide\r\n- [x] Improves clarity for beginners\r\n- [x] No technical errors introduced", "output": "```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Request Validation with Enums { #request-validation-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+\n```\n\n```diff\n@@ -166,6 +166,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+\n```\n\n```diff\n@@ -20,6 +20,13 @@ As it is discouraged, the interactive docs with Swagger UI won't show the docume\n \n ## Import Pydantic's `BaseModel` { #import-pydantics-basemodel }\n \n+/// note\n+\n+`BaseModel` is the main class from Pydantic used for creating data models.\n+FastAPI needs this import to validate request bodies and generate documentation.\n+\n+///\n\n```\n\n```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 350}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Request Validation with Enums { #request-validation-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+\n```\n\n```diff\n@@ -166,6 +166,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+\n```\n\n```diff\n@@ -20,6 +20,13 @@ As it is discouraged, the interactive docs with Swagger UI won't show the docume\n \n ## Import Pydantic's `BaseModel` { #import-pydantics-basemodel }\n \n+/// note\n+\n+`BaseModel` is the main class from Pydantic used for creating data models.\n+FastAPI needs this import to validate request bodies and generate documentation.\n+\n+///\n\n```\n\n```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n\n```", "output": "Bug: üìù Add validation error example for `Enum` path parameter\n\n## Description\r\nAdds an example showing validation errors when using Enum path parameters in FastAPI.\r\n\r\n## Problem\r\nThe tutorial previously did not include clear examples of what happens when a path parameter fails Enum validation, which can be confusing for beginners.\r\n\r\n## Solution\r\n- Adds a JSON-formatted example showing the validation error FastAPI returns for an invalid Enum value.\r\n- Highlights the `loc`, `type`, `msg`, and `input` fields in the response.\r\n\r\n## Impact\r\nHelps beginners understand FastAPI's automatic validation for Enums and interpret error responses correctly.\r\n\r\n## Type of Change\r\n- [x] Documentation improvement\r\n- [ ] Bug fix\r\n- [ ] New feature\r\n- [ ] Breaking change\r\n\r\n## Checklist\r\n- [x] Documentation follows style guide\r\n- [x] Improves clarity for beginners\r\n- [x] No technical errors introduced", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 350}
{"instruction": "Review the following code changes: üìù Add validation error example for `Enum` path parameter", "input": "```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Request Validation with Enums { #request-validation-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+\n```\n\n```diff\n@@ -166,6 +166,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+\n```\n\n```diff\n@@ -20,6 +20,13 @@ As it is discouraged, the interactive docs with Swagger UI won't show the docume\n \n ## Import Pydantic's `BaseModel` { #import-pydantics-basemodel }\n \n+/// note\n+\n+`BaseModel` is the main class from Pydantic used for creating data models.\n+FastAPI needs this import to validate request bodies and generate documentation.\n+\n+///\n\n```\n\n```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n\n```", "output": "Code Review for: üìù Add validation error example for `Enum` path parameter\n\nüìù **docs/en/docs/tutorial/path-params.md**: Add JSON to the Markdown code block\r\n\r\n```suggestion\r\n```JSON\r\n```\r\n\nüìù **docs/en/docs/tutorial/body.md**: I think we don't need to add this clarification.\r\n\r\nIt should be clear that we need to import class before using it.\r\n\nüìù **docs/en/docs/tutorial/path-params.md**: ```suggestion\r\n### Request Validation with Enums { #request-validation-with-enums }\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 350}
{"instruction": "Review this code change in `docs/en/docs/tutorial/path-params.md`", "input": "```diff\n@@ -166,6 +166,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n+\n+When using an `Enum` for a path parameter, FastAPI will validate the value automatically.\n+\n+For example, if your `ModelName` enum only allows:\n+\n+- `\"alexnet\"`\n+- `\"resnet\"`\n+- `\"lenet\"`\n+\n+And the client sends an invalid value:\n+\n+```\n+GET /models/vgg16\n+```\n+\n+FastAPI returns a clear validation error:\n+\n+```\n\n```", "output": "Add JSON to the Markdown code block\r\n\r\n```suggestion\r\n```JSON\r\n```\r", "source": "pr_review", "type": "inline_review", "pr_number": 350}
{"instruction": "Review this code change in `docs/en/docs/tutorial/body.md`", "input": "```diff\n@@ -20,6 +20,13 @@ As it is discouraged, the interactive docs with Swagger UI won't show the docume\n \n ## Import Pydantic's `BaseModel` { #import-pydantics-basemodel }\n \n+/// note\n+\n+`BaseModel` is the main class from Pydantic used for creating data models.\n+FastAPI needs this import to validate request bodies and generate documentation.\n+\n+///\n\n```", "output": "I think we don't need to add this clarification.\r\n\r\nIt should be clear that we need to import class before using it.\r", "source": "pr_review", "type": "inline_review", "pr_number": 350}
{"instruction": "Review this code change in `docs/en/docs/tutorial/path-params.md`", "input": "```diff\n@@ -160,6 +160,40 @@ Because the available values for the *path parameter* are predefined, the intera\n \n <img src=\"/img/tutorial/path-params/image03.png\">\n \n+### Common Validation Errors with Enums { #common-validation-errors-with-enums }\n\n```", "output": "```suggestion\r\n### Request Validation with Enums { #request-validation-with-enums }\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 350}
{"instruction": "Fix the following bug: üìù Fix example of license identifier in documentation", "input": "Fix the Apache 2.0 license identifier to be `Apache-2.0`, not `MIT` (which is NOT an Apache 2.0 license).", "output": "```diff\n@@ -28,7 +28,7 @@\n     },\n     license_info={\n         \"name\": \"Apache 2.0\",\n-        \"identifier\": \"MIT\",\n+        \"identifier\": \"Apache-2.0\",\n     },\n )\n \n\n```\n\n```diff\n@@ -28,7 +28,7 @@ def test_openapi_schema():\n             },\n             \"license\": {\n                 \"name\": \"Apache 2.0\",\n-                \"identifier\": \"MIT\",\n+                \"identifier\": \"Apache-2.0\",\n             },\n             \"version\": \"0.0.1\",\n         },\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 349}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -28,7 +28,7 @@\n     },\n     license_info={\n         \"name\": \"Apache 2.0\",\n-        \"identifier\": \"MIT\",\n+        \"identifier\": \"Apache-2.0\",\n     },\n )\n \n\n```\n\n```diff\n@@ -28,7 +28,7 @@ def test_openapi_schema():\n             },\n             \"license\": {\n                 \"name\": \"Apache 2.0\",\n-                \"identifier\": \"MIT\",\n+                \"identifier\": \"Apache-2.0\",\n             },\n             \"version\": \"0.0.1\",\n         },\n\n```", "output": "Bug: üìù Fix example of license identifier in documentation\n\nFix the Apache 2.0 license identifier to be `Apache-2.0`, not `MIT` (which is NOT an Apache 2.0 license).", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 349}
{"instruction": "Review the following code changes: üìù Fix example of license identifier in documentation", "input": "```diff\n@@ -28,7 +28,7 @@\n     },\n     license_info={\n         \"name\": \"Apache 2.0\",\n-        \"identifier\": \"MIT\",\n+        \"identifier\": \"Apache-2.0\",\n     },\n )\n \n\n```\n\n```diff\n@@ -28,7 +28,7 @@ def test_openapi_schema():\n             },\n             \"license\": {\n                 \"name\": \"Apache 2.0\",\n-                \"identifier\": \"MIT\",\n+                \"identifier\": \"Apache-2.0\",\n             },\n             \"version\": \"0.0.1\",\n         },\n\n```", "output": "Changes look good. This PR implements: üìù Fix example of license identifier in documentation", "source": "pr", "type": "code_review", "pr_number": 349}
{"instruction": "Fix the following bug: üìù Fix typing issue in `docs_src/app_testing/app_b` code example", "input": "", "output": "```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: Annotated[str, Header()]):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: Annotated[str, Header()]):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -32,5 +32,5 @@ async def create_item(item: Item, x_token: str = Header()):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: str = Header()):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -3,22 +3,26 @@\n from fastapi import FastAPI, Header, HTTPException\n from pydantic import BaseModel\n \n-fake_secret_token = \"coneofsilence\"\n-\n-fake_db = {\n-    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n-    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n-}\n-\n-app = FastAPI()\n-\n \n class Item(BaseModel):\n     id: str\n     title: str\n     description: str | None = None\n \n \n+foo_item = Item(id=\"foo\", title=\"Foo\", description=\"There goes my hero\")\n+bar_item = Item(id=\"bar\", title=\"Bar\", description=\"The bartenders\")\n+\n+fake_secret_token = \"coneofsilence\"\n+\n+fake_db: dict[str, Item] = {\n+    \"foo\": foo_item,\n+    \"bar\": bar_item,\n+}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 348}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: Annotated[str, Header()]):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: Annotated[str, Header()]):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -32,5 +32,5 @@ async def create_item(item: Item, x_token: str = Header()):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: str = Header()):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -3,22 +3,26 @@\n from fastapi import FastAPI, Header, HTTPException\n from pydantic import BaseModel\n \n-fake_secret_token = \"coneofsilence\"\n-\n-fake_db = {\n-    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n-    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n-}\n-\n-app = FastAPI()\n-\n \n class Item(BaseModel):\n     id: str\n     title: str\n     description: str | None = None\n \n \n+foo_item = Item(id=\"foo\", title=\"Foo\", description=\"There goes my hero\")\n+bar_item = Item(id=\"bar\", title=\"Bar\", description=\"The bartenders\")\n+\n+fake_secret_token = \"coneofsilence\"\n+\n+fake_db: dict[str, Item] = {\n+    \"foo\": foo_item,\n+    \"bar\": bar_item,\n+}\n\n```", "output": "Bug: üìù Fix typing issue in `docs_src/app_testing/app_b` code example\n\n", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 348}
{"instruction": "Review the following code changes: üìù Fix typing issue in `docs_src/app_testing/app_b` code example", "input": "```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: Annotated[str, Header()]):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: Annotated[str, Header()]):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -32,5 +32,5 @@ async def create_item(item: Item, x_token: str = Header()):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -34,5 +34,5 @@ async def create_item(item: Item, x_token: str = Header()):\n         raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n     if item.id in fake_db:\n         raise HTTPException(status_code=409, detail=\"Item already exists\")\n-    fake_db[item.id] = item\n+    fake_db[item.id] = item.model_dump()\n     return item\n\n```\n\n```diff\n@@ -3,22 +3,26 @@\n from fastapi import FastAPI, Header, HTTPException\n from pydantic import BaseModel\n \n-fake_secret_token = \"coneofsilence\"\n-\n-fake_db = {\n-    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n-    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n-}\n-\n-app = FastAPI()\n-\n \n class Item(BaseModel):\n     id: str\n     title: str\n     description: str | None = None\n \n \n+foo_item = Item(id=\"foo\", title=\"Foo\", description=\"There goes my hero\")\n+bar_item = Item(id=\"bar\", title=\"Bar\", description=\"The bartenders\")\n+\n+fake_secret_token = \"coneofsilence\"\n+\n+fake_db: dict[str, Item] = {\n+    \"foo\": foo_item,\n+    \"bar\": bar_item,\n+}\n\n```", "output": "Code Review for: üìù Fix typing issue in `docs_src/app_testing/app_b` code example\n\nüìù **docs_src/app_testing/app_b_an_py310/main.py**: ```suggestion\r\nfake_secret_token = \"coneofsilence\"\r\n\r\nfake_db: dict[str, Item] = {\r\n    \"foo\": Item(id=\"foo\", title=\"Foo\", description=\"There goes my hero\"),\r\n    \"bar\": Item(id=\"bar\", title=\"Bar\", description=\"The bartenders\"),\r\n}\r\n```\r\n\r\nI think there is no need in `foo_item` and `bar_item` variables\n\n", "source": "pr", "type": "code_review", "pr_number": 348}
{"instruction": "Review this code change in `docs_src/app_testing/app_b_an_py310/main.py`", "input": "```diff\n@@ -3,22 +3,26 @@\n from fastapi import FastAPI, Header, HTTPException\n from pydantic import BaseModel\n \n-fake_secret_token = \"coneofsilence\"\n-\n-fake_db = {\n-    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n-    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n-}\n-\n-app = FastAPI()\n-\n \n class Item(BaseModel):\n     id: str\n     title: str\n     description: str | None = None\n \n \n+foo_item = Item(id=\"foo\", title=\"Foo\", description=\"There goes my hero\")\n+bar_item = Item(id=\"bar\", title=\"Bar\", description=\"The bartenders\")\n+\n+fake_secret_token = \"coneofsilence\"\n+\n+fake_db: dict[str, Item] = {\n+    \"foo\": foo_item,\n+    \"bar\": bar_item,\n+}\n\n```", "output": "```suggestion\r\nfake_secret_token = \"coneofsilence\"\r\n\r\nfake_db: dict[str, Item] = {\r\n    \"foo\": Item(id=\"foo\", title=\"Foo\", description=\"There goes my hero\"),\r\n    \"bar\": Item(id=\"bar\", title=\"Bar\", description=\"The bartenders\"),\r\n}\r\n```\r\n\r\nI think there is no need in `foo_item` and `bar_item` variables", "source": "pr_review", "type": "inline_review", "pr_number": 348}
{"instruction": "Review the following code changes: üè∑Ô∏è Re-export `IncEx` type from Pydantic instead of duplicating it", "input": "```diff\n@@ -3,9 +3,9 @@\n from typing import Any, Callable, Optional, TypeVar, Union\n \n from pydantic import BaseModel\n+from pydantic.main import IncEx as IncEx\n \n DecoratedCallable = TypeVar(\"DecoratedCallable\", bound=Callable[..., Any])\n UnionType = getattr(types, \"UnionType\", Union)\n ModelNameMap = dict[Union[type[BaseModel], type[Enum]], str]\n-IncEx = Union[set[int], set[str], dict[int, Any], dict[str, Any]]\n DependencyCacheKey = tuple[Optional[Callable[..., Any]], tuple[str, ...], str]\n\n```", "output": "Changes look good. This PR implements: üè∑Ô∏è Re-export `IncEx` type from Pydantic instead of duplicating it", "source": "pr", "type": "code_review", "pr_number": 347}
{"instruction": "Review the following code changes: ‚ú® Add `viewport` meta tag to improve Swagger UI on mobile devices", "input": "```diff\n@@ -118,6 +118,7 @@ def get_swagger_ui_html(\n     <!DOCTYPE html>\n     <html>\n     <head>\n+    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n     <link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n     <link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n     <title>{title}</title>\n\n```", "output": "Changes look good. This PR implements: ‚ú® Add `viewport` meta tag to improve Swagger UI on mobile devices", "source": "pr", "type": "code_review", "pr_number": 346}
{"instruction": "Review the following code changes: ‚ö∞Ô∏è Remove SQLAlchemy deprecation filter and old Pydantic v1 code examples", "input": "```diff\n@@ -1,32 +0,0 @@\n-import yaml\n-from fastapi import FastAPI, HTTPException, Request\n-from pydantic.v1 import BaseModel, ValidationError\n-\n-app = FastAPI()\n-\n-\n-class Item(BaseModel):\n-    name: str\n-    tags: list[str]\n-\n-\n-@app.post(\n-    \"/items/\",\n-    openapi_extra={\n-        \"requestBody\": {\n-            \"content\": {\"application/x-yaml\": {\"schema\": Item.schema()}},\n-            \"required\": True,\n-        },\n-    },\n-)\n-async def create_item(request: Request):\n-    raw_body = await request.body()\n-    try:\n-        data = yaml.safe_load(raw_body)\n-    except yaml.YAMLError:\n-        raise HTTPException(status_code=422, detail=\"Invalid YAML\")\n-    try:\n-        item = Item.parse_obj(data)\n-    except ValidationError as e:\n-        raise HTTPException(status_code=422, detail=e.errors())\n-    return item\n\n```\n\n```diff\n@@ -1,29 +0,0 @@\n-from fastapi import FastAPI\n-from pydantic.v1 import BaseModel\n-\n-app = FastAPI()\n-\n-\n-class Item(BaseModel):\n-    name: str\n-    description: str | None = None\n-    price: float\n-    tax: float | None = None\n-\n-    class Config:\n-        schema_extra = {\n-            \"examples\": [\n-                {\n-                    \"name\": \"Foo\",\n-                    \"description\": \"A very nice Item\",\n-                    \"price\": 35.4,\n-                    \"tax\": 3.2,\n-                }\n-            ]\n-        }\n-\n-\n-@app.put(\"/items/{item_id}\")\n-async def update_item(item_id: int, item: Item):\n-    results = {\"item_id\": item_id, \"item\": item}\n-    return results\n\n```\n\n```diff\n@@ -1,31 +0,0 @@\n-from typing import Union\n-\n-from fastapi import FastAPI\n-from pydantic.v1 import BaseModel\n-\n-app = FastAPI()\n-\n-\n-class Item(BaseModel):\n-    name: str\n-    description: Union[str, None] = None\n-    price: float\n-    tax: Union[float, None] = None\n-\n-    class Config:\n-        schema_extra = {\n-            \"examples\": [\n-                {\n-                    \"name\": \"Foo\",\n-                    \"description\": \"A very nice Item\",\n-                    \"price\": 35.4,\n-                    \"tax\": 3.2,\n-                }\n-            ]\n-        }\n-\n-\n-@app.put(\"/items/{item_id}\")\n-async def update_item(item_id: int, item: Item):\n-    results = {\"item_id\": item_id, \"item\": item}\n-    return results\n\n```\n\n```diff\n@@ -1,10 +0,0 @@\n-from pydantic.v1 import BaseSettings\n-\n-\n-class Settings(BaseSettings):\n-    app_name: str = \"Awesome API\"\n-    admin_email: str\n-    items_per_user: int = 50\n-\n-    class Config:\n-        env_file = \".env\"\n\n```\n\n```diff\n@@ -1,10 +0,0 @@\n-from pydantic.v1 import BaseSettings\n-\n-\n-class Settings(BaseSettings):\n-    app_name: str = \"Awesome API\"\n-    admin_email: str\n-    items_per_user: int = 50\n-\n-    class Config:\n-        env_file = \".env\"\n\n```", "output": "Changes look good. This PR implements: ‚ö∞Ô∏è Remove SQLAlchemy deprecation filter and old Pydantic v1 code examples", "source": "pr", "type": "code_review", "pr_number": 345}
{"instruction": "Review the following code changes: üìù Improve grammar (\"if you haven't\" -> \"if you haven't already\")", "input": "```diff\n@@ -461,7 +461,7 @@ For a more complete example including more features, see the <a href=\"https://fa\n \n ### Deploy your app (optional)\n \n-You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't. üöÄ\n+You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't already. üöÄ\n \n If you already have a **FastAPI Cloud** account (we invited you from the waiting list üòâ), you can deploy your application with one command.\n \n\n```\n\n```diff\n@@ -1,6 +1,6 @@\n # FastAPI Cloud { #fastapi-cloud }\n \n-You can deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a> with **one command**, go and join the waiting list if you haven't. üöÄ\n+You can deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a> with **one command**, go and join the waiting list if you haven't already. üöÄ\n \n ## Login { #login }\n \n\n```\n\n```diff\n@@ -458,7 +458,7 @@ For a more complete example including more features, see the <a href=\"https://fa\n \n ### Deploy your app (optional) { #deploy-your-app-optional }\n \n-You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't. üöÄ\n+You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't already. üöÄ\n \n If you already have a **FastAPI Cloud** account (we invited you from the waiting list üòâ), you can deploy your application with one command.\n \n\n```\n\n```diff\n@@ -145,7 +145,7 @@ You could also use it to generate code automatically, for clients that communica\n \n ### Deploy your app (optional) { #deploy-your-app-optional }\n \n-You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't. üöÄ\n+You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't already. üöÄ\n \n If you already have a **FastAPI Cloud** account (we invited you from the waiting list üòâ), you can deploy your application with one command.\n \n\n```\n\n```diff\n@@ -145,7 +145,7 @@ You could also use it to generate code automatically, for clients that communica\n \n ### Deploy your app (optional) { #deploy-your-app-optional }\n \n-You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't. üöÄ\n+You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't already. üöÄ\n\n```", "output": "Code Review for: üìù Improve grammar (\"if you haven't\" -> \"if you haven't already\")\n\nüìù **docs/en/docs/tutorial/first-steps.md**: Highlighting is strange because of GitHub bug - it fails to properly handle incorrect JSON code blocks (see JSON code block without closing brackets above)\n\n", "source": "pr", "type": "code_review", "pr_number": 344}
{"instruction": "Review this code change in `docs/en/docs/tutorial/first-steps.md`", "input": "```diff\n@@ -145,7 +145,7 @@ You could also use it to generate code automatically, for clients that communica\n \n ### Deploy your app (optional) { #deploy-your-app-optional }\n \n-You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't. üöÄ\n+You can optionally deploy your FastAPI app to <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>, go and join the waiting list if you haven't already. üöÄ\n\n```", "output": "Highlighting is strange because of GitHub bug - it fails to properly handle incorrect JSON code blocks (see JSON code block without closing brackets above)", "source": "pr_review", "type": "inline_review", "pr_number": 344}
{"instruction": "Review the following code changes: üêõ Strip whitespaces from `Authorization` header credentials", "input": "```diff\n@@ -7,4 +7,4 @@ def get_authorization_scheme_param(\n     if not authorization_header_value:\n         return \"\", \"\"\n     scheme, _, param = authorization_header_value.partition(\" \")\n-    return scheme, param\n+    return scheme, param.strip()\n\n```\n\n```diff\n@@ -21,6 +21,12 @@ def test_security_http_base():\n     assert response.json() == {\"scheme\": \"Other\", \"credentials\": \"foobar\"}\n \n \n+def test_security_http_base_with_whitespaces():\n+    response = client.get(\"/users/me\", headers={\"Authorization\": \"Other  foobar \"})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"scheme\": \"Other\", \"credentials\": \"foobar\"}\n+\n+\n def test_security_http_base_no_credentials():\n     response = client.get(\"/users/me\")\n     assert response.status_code == 401, response.text\n\n```\n\n```diff\n@@ -37,6 +37,12 @@ def test_token():\n     assert response.json() == {\"token\": \"testtoken\"}\n \n \n+def test_token_with_whitespaces():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Bearer  testtoken \"})\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"token\": \"testtoken\"}\n+\n+\n def test_openapi_schema():\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n\n```", "output": "Changes look good. This PR implements: üêõ Strip whitespaces from `Authorization` header credentials", "source": "pr", "type": "code_review", "pr_number": 343}
{"instruction": "Fix the following bug: üêõ Fix TYPE_CHECKING annotations for Python 3.14 (PEP 649)", "input": "PR #14485 fixed support for if TYPE_CHECKING, non-evaluated stringified annotations, when using `from __future__ import annotations`.\r\n\r\nThis change adds the same support when using deferred evaluation of annotations introduced in Python 3.14.\r\n\r\nNote: I was also able to reproduce the issue by removing `from __future__ import annotations` from `tests/test_stringified_annotation_dependency.py` (using python 3.14). \r\n\r\nIt has been [discussed here](https://github.com/fastapi/fastapi/discussions/14784)", "output": "```diff\n@@ -204,7 +204,12 @@ def _get_signature(call: Callable[..., Any]) -> inspect.Signature:\n         except NameError:\n             # Handle type annotations with if TYPE_CHECKING, not used by FastAPI\n             # e.g. dependency return types\n-            signature = inspect.signature(call)\n+            if sys.version_info >= (3, 14):\n+                from annotationlib import Format\n+\n+                signature = inspect.signature(call, annotation_format=Format.FORWARDREF)\n+            else:\n+                signature = inspect.signature(call)\n     else:\n         signature = inspect.signature(call)\n     return signature\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from typing import TYPE_CHECKING, Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+from .utils import needs_py314\n+\n+if TYPE_CHECKING:  # pragma: no cover\n+\n+    class DummyUser: ...\n+\n+\n+@needs_py314\n+def test_stringified_annotation():\n+    # python3.14: Use forward reference without \"from __future__ import annotations\"\n+    async def get_current_user() -> DummyUser | None:\n+        return None\n+\n+    app = FastAPI()\n+\n+    client = TestClient(app)\n+\n+    @app.get(\"/\")\n+    async def get(\n+        current_user: Annotated[DummyUser | None, Depends(get_current_user)],\n+    ) -> str:\n+        return \"hello world\"\n+\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n\n```\n\n```diff\n@@ -1,4 +1,5 @@\n import importlib\n+import sys\n from types import ModuleType\n from typing import Annotated, Any\n from unittest.mock import Mock, patch\n@@ -12,8 +13,13 @@\n     name=\"module\",\n     params=[\n         \"tutorial008_py39\",\n-        # Fails with `NameError: name 'DepA' is not defined`\n-        pytest.param(\"tutorial008_an_py39\", marks=pytest.mark.xfail),\n+        pytest.param(\n+            \"tutorial008_an_py39\",\n+            marks=pytest.mark.xfail(\n+                sys.version_info < (3, 14),\n+                reason=\"Fails with `NameError: name 'DepA' is not defined`\",\n+            ),\n+        ),\n     ],\n )\n def get_module(request: pytest.FixtureRequest):\n\n```\n\n```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14+\"\n )\n \n \n\n```\n\n```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14-\"\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 342}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -204,7 +204,12 @@ def _get_signature(call: Callable[..., Any]) -> inspect.Signature:\n         except NameError:\n             # Handle type annotations with if TYPE_CHECKING, not used by FastAPI\n             # e.g. dependency return types\n-            signature = inspect.signature(call)\n+            if sys.version_info >= (3, 14):\n+                from annotationlib import Format\n+\n+                signature = inspect.signature(call, annotation_format=Format.FORWARDREF)\n+            else:\n+                signature = inspect.signature(call)\n     else:\n         signature = inspect.signature(call)\n     return signature\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from typing import TYPE_CHECKING, Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+from .utils import needs_py314\n+\n+if TYPE_CHECKING:  # pragma: no cover\n+\n+    class DummyUser: ...\n+\n+\n+@needs_py314\n+def test_stringified_annotation():\n+    # python3.14: Use forward reference without \"from __future__ import annotations\"\n+    async def get_current_user() -> DummyUser | None:\n+        return None\n+\n+    app = FastAPI()\n+\n+    client = TestClient(app)\n+\n+    @app.get(\"/\")\n+    async def get(\n+        current_user: Annotated[DummyUser | None, Depends(get_current_user)],\n+    ) -> str:\n+        return \"hello world\"\n+\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n\n```\n\n```diff\n@@ -1,4 +1,5 @@\n import importlib\n+import sys\n from types import ModuleType\n from typing import Annotated, Any\n from unittest.mock import Mock, patch\n@@ -12,8 +13,13 @@\n     name=\"module\",\n     params=[\n         \"tutorial008_py39\",\n-        # Fails with `NameError: name 'DepA' is not defined`\n-        pytest.param(\"tutorial008_an_py39\", marks=pytest.mark.xfail),\n+        pytest.param(\n+            \"tutorial008_an_py39\",\n+            marks=pytest.mark.xfail(\n+                sys.version_info < (3, 14),\n+                reason=\"Fails with `NameError: name 'DepA' is not defined`\",\n+            ),\n+        ),\n     ],\n )\n def get_module(request: pytest.FixtureRequest):\n\n```\n\n```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14+\"\n )\n \n \n\n```\n\n```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14-\"\n\n```", "output": "Bug: üêõ Fix TYPE_CHECKING annotations for Python 3.14 (PEP 649)\n\nPR #14485 fixed support for if TYPE_CHECKING, non-evaluated stringified annotations, when using `from __future__ import annotations`.\r\n\r\nThis change adds the same support when using deferred evaluation of annotations introduced in Python 3.14.\r\n\r\nNote: I was also able to reproduce the issue by removing `from __future__ import annotations` from `tests/test_stringified_annotation_dependency.py` (using python 3.14). \r\n\r\nIt has been [discussed here](https://github.com/fastapi/fastapi/discussions/14784)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 342}
{"instruction": "Review the following code changes: üêõ Fix TYPE_CHECKING annotations for Python 3.14 (PEP 649)", "input": "```diff\n@@ -204,7 +204,12 @@ def _get_signature(call: Callable[..., Any]) -> inspect.Signature:\n         except NameError:\n             # Handle type annotations with if TYPE_CHECKING, not used by FastAPI\n             # e.g. dependency return types\n-            signature = inspect.signature(call)\n+            if sys.version_info >= (3, 14):\n+                from annotationlib import Format\n+\n+                signature = inspect.signature(call, annotation_format=Format.FORWARDREF)\n+            else:\n+                signature = inspect.signature(call)\n     else:\n         signature = inspect.signature(call)\n     return signature\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from typing import TYPE_CHECKING, Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+from .utils import needs_py314\n+\n+if TYPE_CHECKING:  # pragma: no cover\n+\n+    class DummyUser: ...\n+\n+\n+@needs_py314\n+def test_stringified_annotation():\n+    # python3.14: Use forward reference without \"from __future__ import annotations\"\n+    async def get_current_user() -> DummyUser | None:\n+        return None\n+\n+    app = FastAPI()\n+\n+    client = TestClient(app)\n+\n+    @app.get(\"/\")\n+    async def get(\n+        current_user: Annotated[DummyUser | None, Depends(get_current_user)],\n+    ) -> str:\n+        return \"hello world\"\n+\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n\n```\n\n```diff\n@@ -1,4 +1,5 @@\n import importlib\n+import sys\n from types import ModuleType\n from typing import Annotated, Any\n from unittest.mock import Mock, patch\n@@ -12,8 +13,13 @@\n     name=\"module\",\n     params=[\n         \"tutorial008_py39\",\n-        # Fails with `NameError: name 'DepA' is not defined`\n-        pytest.param(\"tutorial008_an_py39\", marks=pytest.mark.xfail),\n+        pytest.param(\n+            \"tutorial008_an_py39\",\n+            marks=pytest.mark.xfail(\n+                sys.version_info < (3, 14),\n+                reason=\"Fails with `NameError: name 'DepA' is not defined`\",\n+            ),\n+        ),\n     ],\n )\n def get_module(request: pytest.FixtureRequest):\n\n```\n\n```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14+\"\n )\n \n \n\n```\n\n```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14-\"\n\n```", "output": "Code Review for: üêõ Fix TYPE_CHECKING annotations for Python 3.14 (PEP 649)\n\nüìù **tests/utils.py**: `needs_py_lt_314` wasn't used\n\nüìù **fastapi/dependencies/utils.py**: I could move this import to top level, wdyt?\n\n", "source": "pr", "type": "code_review", "pr_number": 342}
{"instruction": "Review this code change in `tests/utils.py`", "input": "```diff\n@@ -6,8 +6,8 @@\n needs_py310 = pytest.mark.skipif(\n     sys.version_info < (3, 10), reason=\"requires python3.10+\"\n )\n-needs_py_lt_314 = pytest.mark.skipif(\n-    sys.version_info >= (3, 14), reason=\"requires python3.13-\"\n+needs_py314 = pytest.mark.skipif(\n+    sys.version_info < (3, 14), reason=\"requires python3.14-\"\n\n```", "output": "`needs_py_lt_314` wasn't used", "source": "pr_review", "type": "inline_review", "pr_number": 342}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -204,7 +204,12 @@ def _get_signature(call: Callable[..., Any]) -> inspect.Signature:\n         except NameError:\n             # Handle type annotations with if TYPE_CHECKING, not used by FastAPI\n             # e.g. dependency return types\n-            signature = inspect.signature(call)\n+            if sys.version_info >= (3, 14):\n+                from annotationlib import Format\n\n```", "output": "I could move this import to top level, wdyt?", "source": "pr_review", "type": "inline_review", "pr_number": 342}
{"instruction": "Review the following code changes: üé® Tweak types for mypy", "input": "```diff\n@@ -219,9 +219,9 @@ def jsonable_encoder(\n                 if isinstance(obj, encoder_type):\n                     return encoder_instance(obj)\n     if include is not None and not isinstance(include, (set, dict)):\n-        include = set(include)\n+        include = set(include)  # type: ignore[assignment]\n     if exclude is not None and not isinstance(exclude, (set, dict)):\n-        exclude = set(exclude)\n+        exclude = set(exclude)  # type: ignore[assignment]\n     if isinstance(obj, BaseModel):\n         obj_dict = obj.model_dump(\n             mode=\"json\",\n\n```", "output": "Changes look good. This PR implements: üé® Tweak types for mypy", "source": "pr", "type": "code_review", "pr_number": 341}
{"instruction": "Review the following code changes: ‚ö°Ô∏èImprove caching of callable inspection result", "input": "```diff\n@@ -595,22 +595,17 @@ async def solve_dependencies(\n         response.status_code = None  # type: ignore\n     if dependency_cache is None:\n         dependency_cache = {}\n+    dependency_overrides: dict[Callable[..., Any], Callable[..., Any]] = getattr(\n+        dependency_overrides_provider, \"dependency_overrides\", {}\n+    )\n     for sub_dependant in dependant.dependencies:\n-        sub_dependant.call = cast(Callable[..., Any], sub_dependant.call)\n-        call = sub_dependant.call\n+        call = cast(Callable[..., Any], sub_dependant.call)\n         use_sub_dependant = sub_dependant\n-        if (\n-            dependency_overrides_provider\n-            and dependency_overrides_provider.dependency_overrides\n-        ):\n-            original_call = sub_dependant.call\n-            call = getattr(\n-                dependency_overrides_provider, \"dependency_overrides\", {}\n-            ).get(original_call, original_call)\n-            use_path: str = sub_dependant.path  # type: ignore\n+        if dependency_overrides and (overridden_call := dependency_overrides.get(call)):\n+            call = overridden_call\n             use_sub_dependant = get_dependant(\n-                path=use_path,\n-                call=call,\n+                path=cast(str, sub_dependant.path),\n+                call=overridden_call,\n                 name=sub_dependant.name,\n                 parent_oauth_scopes=sub_dependant.oauth_scopes,\n                 scope=sub_dependant.scope,\n\n```", "output": "Changes look good. This PR implements: ‚ö°Ô∏èImprove caching of callable inspection result", "source": "pr", "type": "code_review", "pr_number": 340}
{"instruction": "Fix the following bug: üêõ Update `ValidationError` schema to include `input` and `ctx`", "input": "## Summary\r\n\r\nRelated to #10787\r\n\r\nThe OpenAPI `ValidationError` schema was outdated and didn't reflect the actual error format returned by Pydantic V2.\r\n\r\n## Changes\r\nUpdated `validation_error_definition` in `fastapi/openapi/utils.py` to include:\r\n- `input`: The actual input value that caused the validation error  \r\n- `ctx`: Optional context dictionary with additional error information\r\n\r\n## Testing\r\nAll existing tests pass with the updated schema. The test snapshots have been updated to reflect the new schema structure.", "output": "```diff\n@@ -49,6 +49,8 @@\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"input\": {\"title\": \"Input\"},\n+        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n\n```\n\n```diff\n@@ -89,6 +89,8 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```\n\n```diff\n@@ -101,6 +101,8 @@ def test_openapi_schema():\n                 },\n                 \"ValidationError\": {\n                     \"properties\": {\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"input\": {\"title\": \"Input\"},\n                         \"loc\": {\n                             \"items\": {\n                                 \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]\n\n```\n\n```diff\n@@ -128,6 +128,8 @@ def test_openapi_schema():\n                         \"required\": [\"loc\", \"msg\", \"type\"],\n                         \"type\": \"object\",\n                         \"properties\": {\n+                            \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                            \"input\": {\"title\": \"Input\"},\n                             \"loc\": {\n                                 \"title\": \"Location\",\n                                 \"type\": \"array\",\n\n```\n\n```diff\n@@ -66,6 +66,8 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 339}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -49,6 +49,8 @@\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"input\": {\"title\": \"Input\"},\n+        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n\n```\n\n```diff\n@@ -89,6 +89,8 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```\n\n```diff\n@@ -101,6 +101,8 @@ def test_openapi_schema():\n                 },\n                 \"ValidationError\": {\n                     \"properties\": {\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"input\": {\"title\": \"Input\"},\n                         \"loc\": {\n                             \"items\": {\n                                 \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]\n\n```\n\n```diff\n@@ -128,6 +128,8 @@ def test_openapi_schema():\n                         \"required\": [\"loc\", \"msg\", \"type\"],\n                         \"type\": \"object\",\n                         \"properties\": {\n+                            \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                            \"input\": {\"title\": \"Input\"},\n                             \"loc\": {\n                                 \"title\": \"Location\",\n                                 \"type\": \"array\",\n\n```\n\n```diff\n@@ -66,6 +66,8 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```", "output": "Bug: üêõ Update `ValidationError` schema to include `input` and `ctx`\n\n## Summary\r\n\r\nRelated to #10787\r\n\r\nThe OpenAPI `ValidationError` schema was outdated and didn't reflect the actual error format returned by Pydantic V2.\r\n\r\n## Changes\r\nUpdated `validation_error_definition` in `fastapi/openapi/utils.py` to include:\r\n- `input`: The actual input value that caused the validation error  \r\n- `ctx`: Optional context dictionary with additional error information\r\n\r\n## Testing\r\nAll existing tests pass with the updated schema. The test snapshots have been updated to reflect the new schema structure.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 339}
{"instruction": "Review the following code changes: üêõ Update `ValidationError` schema to include `input` and `ctx`", "input": "```diff\n@@ -49,6 +49,8 @@\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"input\": {\"title\": \"Input\"},\n+        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n\n```\n\n```diff\n@@ -89,6 +89,8 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```\n\n```diff\n@@ -101,6 +101,8 @@ def test_openapi_schema():\n                 },\n                 \"ValidationError\": {\n                     \"properties\": {\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"input\": {\"title\": \"Input\"},\n                         \"loc\": {\n                             \"items\": {\n                                 \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}]\n\n```\n\n```diff\n@@ -128,6 +128,8 @@ def test_openapi_schema():\n                         \"required\": [\"loc\", \"msg\", \"type\"],\n                         \"type\": \"object\",\n                         \"properties\": {\n+                            \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                            \"input\": {\"title\": \"Input\"},\n                             \"loc\": {\n                                 \"title\": \"Location\",\n                                 \"type\": \"array\",\n\n```\n\n```diff\n@@ -66,6 +66,8 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```", "output": "Changes look good. This PR implements: üêõ Update `ValidationError` schema to include `input` and `ctx`", "source": "pr", "type": "code_review", "pr_number": 339}
{"instruction": "Review the following code changes: üìù Update docs for contributing translations, simplify title", "input": "```diff\n@@ -181,7 +181,7 @@ Help with translations is VERY MUCH appreciated! And it can't be done without th\n \n Here are the steps to help with translations.\n \n-#### Review Translation PRs\n+#### Translation PRs\n \n Translation pull requests are made by LLMs guided with prompts designed by the FastAPI team together with the community of native speakers for each supported language.\n \n\n```", "output": "Changes look good. This PR implements: üìù Update docs for contributing translations, simplify title", "source": "pr", "type": "code_review", "pr_number": 338}
{"instruction": "Fix the following bug: ‚ú® Improve JSON Parsing Error Messages", "input": "This PR enhances JSON parsing error messages to provide better debugging information.\r\n\r\n## Changes\r\n\r\nModified JSON error handling in fastapi/routing.py to include additional context in the error response:\r\n  - Line and column numbers where the error occurred (0-indexed)\r\n  - Position in the JSON string\r\n  - Error snippet (max 80 chars with ellipsis) showing the problematic JSON\r\n\r\n## Error Response Format\r\n\r\nThe error location remains [\"body\", position] to maintain backward compatibility. Additional debugging information is provided in the ctx field:\r\n```JSON\r\n  {\r\n    \"loc\": [\"body\", 47],\r\n    \"msg\": \"JSON decode error\",\r\n    \"input\": {},\r\n    \"ctx\": {\r\n      \"error\": \"Expecting value\",\r\n      \"position\": 47,\r\n      \"line\": 3,\r\n      \"column\": 12,\r\n      \"snippet\": \"...\\\"price\\\": 'invalid'...\"\r\n    }\r\n  }\r\n```\r\n## Testing\r\n\r\n  - Added comprehensive test suite in tests/test_json_body_decode_error.py\r\n  - Tests cover single-line errors, multi-line errors, snippet ellipsis behavior, and edge cases", "output": "```diff\n@@ -313,14 +313,28 @@ async def app(request: Request) -> Response:\n                         else:\n                             body = body_bytes\n         except json.JSONDecodeError as e:\n+            start_pos = max(0, e.pos - 40)\n+            end_pos = min(len(e.doc), e.pos + 40)\n+            error_snippet = e.doc[start_pos:end_pos]\n+            if start_pos > 0:\n+                error_snippet = \"...\" + error_snippet\n+            if end_pos < len(e.doc):\n+                error_snippet = error_snippet + \"...\"\n+\n             validation_error = RequestValidationError(\n                 [\n                     {\n                         \"type\": \"json_invalid\",\n                         \"loc\": (\"body\", e.pos),\n                         \"msg\": \"JSON decode error\",\n                         \"input\": {},\n-                        \"ctx\": {\"error\": e.msg},\n+                        \"ctx\": {\n+                            \"error\": e.msg,\n+                            \"position\": e.pos,\n+                            \"line\": e.lineno - 1,\n+                            \"column\": e.colno - 1,\n+                            \"snippet\": error_snippet,\n+                        },\n                     }\n                 ],\n                 body=e.doc,\n\n```\n\n```diff\n@@ -0,0 +1,157 @@\n+import pytest\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+INVALID_JSON = \"\"\"\n+{\n+  \"name\": \"Test\",\n+  \"price\": 'invalid'\n+}\"\"\"\n+\n+\n+class Item(BaseModel):\n+    name: str\n+    price: float\n+    description: str = None\n+\n+\n+@app.post(\"/items/\")\n+async def create_item(item: Item):\n+    return item  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_decode_error_single_line():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\", \"price\": None}',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"] == [\"body\", 26]\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"error\"] == \"Expecting value\"\n+    assert error[\"ctx\"][\"position\"] == 26\n+    assert error[\"ctx\"][\"line\"] == 0\n+    assert error[\"ctx\"][\"column\"] == 26\n+    assert \"None\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_multiline():\n+    response = client.post(\n+        \"/items/\", content=INVALID_JSON, headers={\"Content-Type\": \"application/json\"}\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"][0] == \"body\"\n+    assert isinstance(error[\"loc\"][1], int)\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"line\"] == 3\n+    assert error[\"ctx\"][\"column\"] == 11\n+    assert \"invalid\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_empty_body():\n+    response = client.post(\n+        \"/items/\", content=\"\", headers={\"Content-Type\": \"application/json\"}\n+    )\n+\n+    assert response.status_code == 422\n+    # Handle both Pydantic v1 and v2 - empty body is handled differently\n+    assert response.json() == IsDict(\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": [\"body\"],\n+                    \"msg\": \"Field required\",\n+                    \"type\": \"missing\",\n+                    \"input\": None,\n+                }\n+            ]\n+        }\n+    ) | IsDict(\n+        # Pydantic v1\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": [\"body\"],\n+                    \"msg\": \"field required\",\n+                    \"type\": \"value_error.missing\",\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+def test_json_decode_error_unclosed_brace():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\"',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"type\"] == \"json_invalid\"\n+    assert error[\"input\"] == {}\n+    assert \"position\" in error[\"ctx\"]\n+    assert \"line\" in error\n\n```\n\n```diff\n@@ -150,7 +150,13 @@ def test_post_broken_body(client: TestClient):\n                 \"loc\": [\"body\", 1],\n                 \"msg\": \"JSON decode error\",\n                 \"input\": {},\n-                \"ctx\": {\"error\": \"Expecting property name enclosed in double quotes\"},\n+                \"ctx\": {\n+                    \"error\": \"Expecting property name enclosed in double quotes\",\n+                    \"position\": 1,\n+                    \"line\": 0,\n+                    \"column\": 1,\n+                    \"snippet\": \"{some broken json}\",\n+                },\n             }\n         ]\n     }\n\n```\n\n```diff\n@@ -206,11 +206,14 @@ def test_post_broken_body(client: TestClient):\n             \"detail\": [\n                 {\n                     \"type\": \"json_invalid\",\n-                    \"loc\": [\"body\", 1],\n-                    \"msg\": \"JSON decode error\",\n-                    \"input\": {},\n+                    \"loc\": [\"body\", 1, 2],\n+                    \"msg\": \"JSON decode error - Expecting property name enclosed in double quotes at line 1, column 2\",\n\n```\n\n```diff\n@@ -206,11 +206,14 @@ def test_post_broken_body(client: TestClient):\n             \"detail\": [\n                 {\n                     \"type\": \"json_invalid\",\n-                    \"loc\": [\"body\", 1],\n-                    \"msg\": \"JSON decode error\",\n-                    \"input\": {},\n+                    \"loc\": [\"body\", 1, 2],\n+                    \"msg\": \"JSON decode error - Expecting property name enclosed in double quotes at line 1, column 2\",\n+                    \"input\": \"{some broken json}\",\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 337}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -313,14 +313,28 @@ async def app(request: Request) -> Response:\n                         else:\n                             body = body_bytes\n         except json.JSONDecodeError as e:\n+            start_pos = max(0, e.pos - 40)\n+            end_pos = min(len(e.doc), e.pos + 40)\n+            error_snippet = e.doc[start_pos:end_pos]\n+            if start_pos > 0:\n+                error_snippet = \"...\" + error_snippet\n+            if end_pos < len(e.doc):\n+                error_snippet = error_snippet + \"...\"\n+\n             validation_error = RequestValidationError(\n                 [\n                     {\n                         \"type\": \"json_invalid\",\n                         \"loc\": (\"body\", e.pos),\n                         \"msg\": \"JSON decode error\",\n                         \"input\": {},\n-                        \"ctx\": {\"error\": e.msg},\n+                        \"ctx\": {\n+                            \"error\": e.msg,\n+                            \"position\": e.pos,\n+                            \"line\": e.lineno - 1,\n+                            \"column\": e.colno - 1,\n+                            \"snippet\": error_snippet,\n+                        },\n                     }\n                 ],\n                 body=e.doc,\n\n```\n\n```diff\n@@ -0,0 +1,157 @@\n+import pytest\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+INVALID_JSON = \"\"\"\n+{\n+  \"name\": \"Test\",\n+  \"price\": 'invalid'\n+}\"\"\"\n+\n+\n+class Item(BaseModel):\n+    name: str\n+    price: float\n+    description: str = None\n+\n+\n+@app.post(\"/items/\")\n+async def create_item(item: Item):\n+    return item  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_decode_error_single_line():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\", \"price\": None}',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"] == [\"body\", 26]\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"error\"] == \"Expecting value\"\n+    assert error[\"ctx\"][\"position\"] == 26\n+    assert error[\"ctx\"][\"line\"] == 0\n+    assert error[\"ctx\"][\"column\"] == 26\n+    assert \"None\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_multiline():\n+    response = client.post(\n+        \"/items/\", content=INVALID_JSON, headers={\"Content-Type\": \"application/json\"}\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"][0] == \"body\"\n+    assert isinstance(error[\"loc\"][1], int)\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"line\"] == 3\n+    assert error[\"ctx\"][\"column\"] == 11\n+    assert \"invalid\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_empty_body():\n+    response = client.post(\n+        \"/items/\", content=\"\", headers={\"Content-Type\": \"application/json\"}\n+    )\n+\n+    assert response.status_code == 422\n+    # Handle both Pydantic v1 and v2 - empty body is handled differently\n+    assert response.json() == IsDict(\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": [\"body\"],\n+                    \"msg\": \"Field required\",\n+                    \"type\": \"missing\",\n+                    \"input\": None,\n+                }\n+            ]\n+        }\n+    ) | IsDict(\n+        # Pydantic v1\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": [\"body\"],\n+                    \"msg\": \"field required\",\n+                    \"type\": \"value_error.missing\",\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+def test_json_decode_error_unclosed_brace():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\"',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert r", "output": "Bug: ‚ú® Improve JSON Parsing Error Messages\n\nThis PR enhances JSON parsing error messages to provide better debugging information.\r\n\r\n## Changes\r\n\r\nModified JSON error handling in fastapi/routing.py to include additional context in the error response:\r\n  - Line and column numbers where the error occurred (0-indexed)\r\n  - Position in the JSON string\r\n  - Error snippet (max 80 chars with ellipsis) showing the problematic JSON\r\n\r\n## Error Response Format\r\n\r\nThe error location remains [\"body\", position] to maintain backward compatibility. Additional debugging information is provided in the ctx field:\r\n```JSON\r\n  {\r\n    \"loc\": [\"body\", 47],\r\n    \"msg\": \"JSON decode error\",\r\n    \"input\": {},\r\n    \"ctx\": {\r\n      \"error\": \"Expecting value\",\r\n      \"position\": 47,\r\n      \"line\": 3,\r\n      \"column\": 12,\r\n      \"snippet\": \"...\\\"price\\\": 'invalid'...\"\r\n    }\r\n  }\r\n```\r\n## Testing\r\n\r\n  - Added comprehensive test suite in tests/test_json_body_decode_error.py\r\n  - Tests cover single-line errors, multi-line errors, snippet ellipsis behavior, and edge cases", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 337}
{"instruction": "Review the following code changes: ‚ú® Improve JSON Parsing Error Messages", "input": "```diff\n@@ -313,14 +313,28 @@ async def app(request: Request) -> Response:\n                         else:\n                             body = body_bytes\n         except json.JSONDecodeError as e:\n+            start_pos = max(0, e.pos - 40)\n+            end_pos = min(len(e.doc), e.pos + 40)\n+            error_snippet = e.doc[start_pos:end_pos]\n+            if start_pos > 0:\n+                error_snippet = \"...\" + error_snippet\n+            if end_pos < len(e.doc):\n+                error_snippet = error_snippet + \"...\"\n+\n             validation_error = RequestValidationError(\n                 [\n                     {\n                         \"type\": \"json_invalid\",\n                         \"loc\": (\"body\", e.pos),\n                         \"msg\": \"JSON decode error\",\n                         \"input\": {},\n-                        \"ctx\": {\"error\": e.msg},\n+                        \"ctx\": {\n+                            \"error\": e.msg,\n+                            \"position\": e.pos,\n+                            \"line\": e.lineno - 1,\n+                            \"column\": e.colno - 1,\n+                            \"snippet\": error_snippet,\n+                        },\n                     }\n                 ],\n                 body=e.doc,\n\n```\n\n```diff\n@@ -0,0 +1,157 @@\n+import pytest\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+INVALID_JSON = \"\"\"\n+{\n+  \"name\": \"Test\",\n+  \"price\": 'invalid'\n+}\"\"\"\n+\n+\n+class Item(BaseModel):\n+    name: str\n+    price: float\n+    description: str = None\n+\n+\n+@app.post(\"/items/\")\n+async def create_item(item: Item):\n+    return item  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_decode_error_single_line():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\", \"price\": None}',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"] == [\"body\", 26]\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"error\"] == \"Expecting value\"\n+    assert error[\"ctx\"][\"position\"] == 26\n+    assert error[\"ctx\"][\"line\"] == 0\n+    assert error[\"ctx\"][\"column\"] == 26\n+    assert \"None\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_multiline():\n+    response = client.post(\n+        \"/items/\", content=INVALID_JSON, headers={\"Content-Type\": \"application/json\"}\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"][0] == \"body\"\n+    assert isinstance(error[\"loc\"][1], int)\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"line\"] == 3\n+    assert error[\"ctx\"][\"column\"] == 11\n+    assert \"invalid\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_empty_body():\n+    response = client.post(\n+        \"/items/\", content=\"\", headers={\"Content-Type\": \"application/json\"}\n+    )\n+\n+    assert response.status_code == 422\n+    # Handle both Pydantic v1 and v2 - empty body is handled differently\n+    assert response.json() == IsDict(\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": [\"body\"],\n+                    \"msg\": \"Field required\",\n+                    \"type\": \"missing\",\n+                    \"input\": None,\n+                }\n+            ]\n+        }\n+    ) | IsDict(\n+        # Pydantic v1\n+        {\n+            \"detail\": [\n+                {\n+                    \"loc\": [\"body\"],\n+                    \"msg\": \"field required\",\n+                    \"type\": \"value_error.missing\",\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+def test_json_decode_error_unclosed_brace():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\"',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"type\"] == \"json_invalid\"\n+    assert error[\"input\"] == {}\n+    assert \"position\" in error[\"ctx\"]\n+    assert \"line\" in error\n\n```\n\n```diff\n@@ -150,7 +150,13 @@ def test_post_broken_body(client: TestClient):\n                 \"loc\": [\"body\", 1],\n                 \"msg\": \"JSON decode error\",\n                 \"input\": {},\n-                \"ctx\": {\"error\": \"Expecting property name enclosed in double quotes\"},\n+                \"ctx\": {\n+                    \"error\": \"Expecting property name enclosed in double quotes\",\n+                    \"position\": 1,\n+                    \"line\": 0,\n+                    \"column\": 1,\n+                    \"snippet\": \"{some broken json}\",\n+                },\n             }\n         ]\n     }\n\n```\n\n```diff\n@@ -206,11 +206,14 @@ def test_post_broken_body(client: TestClient):\n             \"detail\": [\n                 {\n          ", "output": "Code Review for: ‚ú® Improve JSON Parsing Error Messages\n\nüìù **tests/test_tutorial/test_body/test_tutorial001.py**: ```suggestion\r\n                    \"loc\": [\"body\", 1],\r\n                    \"msg\": \"JSON decode error\",\r\n```\r\n\r\nI think we don't need this duplication - having `error`, `line` and `column` in `ctx` should be enough.\r\n\r\nAlso, the semantic of `loc` field seems to be different - it should be indexes of list or dict\n\nüìù **tests/test_tutorial/test_body/test_tutorial001.py**: As for `input` - I'm not sure, but it's probably incorrect to pass partial input string here:\r\n\r\nFor Pydantic the `input` field contains whole input value. So, it might be better to add this snippet to `ctx`\n\nüìù **tests/test_tutorial/test_body/test_tutorial001.py**: There is an inconsistency here - `position` starts from `0`, but `line` and `column` start from `1`\n\nüìù **tests/test_json_error_improvements.py**: I think it would be better to move this outside the function:\r\n```py\r\nINVALID_JSON = \"\"\"\r\n{\r\n  \"name\": \"Test\",\r\n  \"price\": 'invalid'\r\n}\"\"\"\r\n\r\nclass Item(BaseModel):\r\n    name: str\r\n    ...\r\n```\r\n\nüìù **tests/test_json_error_improvements.py**: ```suggestion\r\n```\r\nI think this comment is not needed.\r\nI would parameterize this test to cover cases:\r\n* snippet starts with `...`\r\n* snippet ends with `...`\r\n* snippet starts and ends with `...`\r\n* snippet contains the whole input\r\n\r\nThen we can delete `test_json_decode_error_shows_snippet` (it will be covered)\n\n", "source": "pr", "type": "code_review", "pr_number": 337}
{"instruction": "Review this code change in `tests/test_tutorial/test_body/test_tutorial001.py`", "input": "```diff\n@@ -206,11 +206,14 @@ def test_post_broken_body(client: TestClient):\n             \"detail\": [\n                 {\n                     \"type\": \"json_invalid\",\n-                    \"loc\": [\"body\", 1],\n-                    \"msg\": \"JSON decode error\",\n-                    \"input\": {},\n+                    \"loc\": [\"body\", 1, 2],\n+                    \"msg\": \"JSON decode error - Expecting property name enclosed in double quotes at line 1, column 2\",\n\n```", "output": "```suggestion\r\n                    \"loc\": [\"body\", 1],\r\n                    \"msg\": \"JSON decode error\",\r\n```\r\n\r\nI think we don't need this duplication - having `error`, `line` and `column` in `ctx` should be enough.\r\n\r\nAlso, the semantic of `loc` field seems to be different - it should be indexes of list or dict", "source": "pr_review", "type": "inline_review", "pr_number": 337}
{"instruction": "Review this code change in `tests/test_json_error_improvements.py`", "input": "```diff\n@@ -0,0 +1,162 @@\n+from dirty_equals import IsDict\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class Item(BaseModel):\n+    name: str\n+    price: float\n+    description: str = None\n+\n+\n+@app.post(\"/items/\")\n+async def create_item(item: Item):\n+    return item\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_decode_error_single_line():\n+    response = client.post(\n+        \"/items/\",\n+        content='{\"name\": \"Test\", \"price\": None}',\n+        headers={\"Content-Type\": \"application/json\"},\n+    )\n+\n+    assert response.status_code == 422\n+    error = response.json()[\"detail\"][0]\n+\n+    assert error[\"loc\"] == [\"body\", 26]\n+    assert error[\"msg\"] == \"JSON decode error\"\n+    assert error[\"input\"] == {}\n+    assert error[\"ctx\"][\"error\"] == \"Expecting value\"\n+    assert error[\"ctx\"][\"position\"] == 26\n+    assert error[\"ctx\"][\"line\"] == 0\n+    assert error[\"ctx\"][\"column\"] == 26\n+    assert \"None\" in error[\"ctx\"][\"snippet\"]\n+\n+\n+def test_json_decode_error_multiline():\n+    invalid_json = \"\"\"\n+{\n+  \"name\": \"Test\",\n+  \"price\": 'invalid'\n+}\"\"\"\n\n```", "output": "I think it would be better to move this outside the function:\r\n```py\r\nINVALID_JSON = \"\"\"\r\n{\r\n  \"name\": \"Test\",\r\n  \"price\": 'invalid'\r\n}\"\"\"\r\n\r\nclass Item(BaseModel):\r\n    name: str\r\n    ...\r\n```\r", "source": "pr_review", "type": "inline_review", "pr_number": 337}
{"instruction": "Fix the following bug: üêõ Fix translation script commit in place", "input": "üêõ Fix translation script commit in place", "output": "```diff\n@@ -411,7 +411,8 @@ def make_pr(\n         print(f\"Creating a new branch {branch_name}\")\n         subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n     else:\n-        print(f\"Committing in place on branch {current_branch}\")\n+        branch_name = current_branch\n+        print(f\"Committing in place on branch {branch_name}\")\n     print(\"Adding updated files\")\n     git_path = Path(\"docs\")\n     subprocess.run([\"git\", \"add\", str(git_path)], check=True)\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 336}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -411,7 +411,8 @@ def make_pr(\n         print(f\"Creating a new branch {branch_name}\")\n         subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n     else:\n-        print(f\"Committing in place on branch {current_branch}\")\n+        branch_name = current_branch\n+        print(f\"Committing in place on branch {branch_name}\")\n     print(\"Adding updated files\")\n     git_path = Path(\"docs\")\n     subprocess.run([\"git\", \"add\", str(git_path)], check=True)\n\n```", "output": "Bug: üêõ Fix translation script commit in place\n\nüêõ Fix translation script commit in place", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 336}
{"instruction": "Review the following code changes: üêõ Fix translation script commit in place", "input": "```diff\n@@ -411,7 +411,8 @@ def make_pr(\n         print(f\"Creating a new branch {branch_name}\")\n         subprocess.run([\"git\", \"checkout\", \"-b\", branch_name], check=True)\n     else:\n-        print(f\"Committing in place on branch {current_branch}\")\n+        branch_name = current_branch\n+        print(f\"Committing in place on branch {branch_name}\")\n     print(\"Adding updated files\")\n     git_path = Path(\"docs\")\n     subprocess.run([\"git\", \"add\", str(git_path)], check=True)\n\n```", "output": "Changes look good. This PR implements: üêõ Fix translation script commit in place", "source": "pr", "type": "code_review", "pr_number": 336}
{"instruction": "Fix the following bug: Feature addition and fixes", "input": "1. Added a plugin system allowing third-party libraries to hook into OpenAPI generation without monkey-patching FastAPI internals.\r\n\r\n2. Unified FastAPI and Starlette lifespan handling so:\r\nStartup/shutdown hooks behave consistently\r\nErrors are propagated correctly\r\n\r\n3. Reduced OpenAPI Generation Overhead\r\n\r\n4. Added an optional, non-production debugging endpoint that exposes the resolved dependency graph for each route. Requirements:  Added an internal API to extract the dependency DAG per route Include: Dependency callables Scope (request / function) Cleanup (yield) dependencies Security scopes Output must be purely informational (no execution) Must not affect runtime behavior Constraints \r\n\r\n5. Defined and enforced a deterministic cleanup order for dependency finalizers.", "output": "```diff\n@@ -0,0 +1,112 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Hook to capture session start/end events.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import sys\n+import os\n+import subprocess\n+from datetime import datetime, timezone\n+from claude_code_capture_utils import get_log_file_path, add_ab_metadata\n+\n+def get_git_metadata(repo_dir):\n+    \"\"\"Get current git commit and branch.\"\"\"\n+    try:\n+        # Get current commit hash\n+        commit_result = subprocess.run(\n+            ['git', 'rev-parse', 'HEAD'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        # Get current branch\n+        branch_result = subprocess.run(\n+            ['git', 'branch', '--show-current'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        git_metadata = {\n+            \"base_commit\": commit_result.stdout.strip() if commit_result.returncode == 0 else None,\n+            \"branch\": branch_result.stdout.strip() if branch_result.returncode == 0 else None,\n+            \"timestamp\": datetime.now(timezone.utc).isoformat()\n+        }\n+\n+        if git_metadata[\"base_commit\"]:\n+            return git_metadata\n+        else:\n+            return None\n+\n+    except Exception as e:\n+        print(f\"Warning: Could not capture git metadata: {e}\", file=sys.stderr)\n+        return None\n+\n+def main():\n+    try:\n+        if len(sys.argv) < 2:\n+            print(\"Usage: capture_session_event.py [start|end]\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        event_type = sys.argv[1].lower()\n+        if event_type not in [\"start\", \"end\"]:\n+            print(\"Event type must be 'start' or 'end'\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        input_data = json.load(sys.stdin)\n+\n+        session_id = input_data.get(\"session_id\", \"unknown\")\n+        transcript_path = input_data.get(\"transcript_path\", \"\")\n+        cwd = input_data.get(\"cwd\", \"\")\n+\n+        if event_type == \"start\":\n+            # Session start: capture git metadata\n+            git_metadata = get_git_metadata(cwd)\n+\n+            log_entry = {\n+                \"type\": \"session_start\",\n+                \"timestamp\": datetime.now(timezone.utc).isoformat(),\n+                \"session_id\": session_id,\n+                \"transcript_path\": transcript_path,\n+                \"cwd\": cwd,\n+                \"git_metadata\": git_metadata\n+            }\n+\n+            log_entry = add_ab_metadata(log_entry, cwd)\n+\n+            if git_metadata:\n+                print(f\"[OK] Captured git metadata: {git_metadata['base_commit'][:8]} on {git_metadata['branch']}\")\n+\n+            # Write session_start event\n+            log_file = get_log_file_path(session_id, cwd)\n+            with open(log_file, \"a\", encoding=\"utf-8\") as f:\n+                f.write(json.dumps(log_entry) + \"\\n\")\n+\n+        elif event_type == \"end\":\n+            # Session end: log the event\n+            log\n\n```\n\n```diff\n@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Utility functions for A/B testing hooks.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import os\n+from pathlib import Path\n+\n+def detect_model_lane(cwd):\n+    \"\"\"Detect if we're in model_a or model_b directory.\"\"\"\n+    path_parts = Path(cwd).parts\n+    if 'model_a' in path_parts:\n+        return 'model_a'\n+    elif 'model_b' in path_parts:\n+        return 'model_b'\n+    return None\n+\n+def get_experiment_root(cwd):\n+    \"\"\"Get the experiment root directory (parent of model_a/model_b).\"\"\"\n+    current_path = Path(cwd)\n+    \n+    # Check if we're inside a model_a or model_b directory\n+    # Look for the parent that contains both model_a and model_b\n+    for parent in [current_path] + list(current_path.parents):\n+        if (parent / 'model_a').exists() and (parent / 'model_b').exists():\n+            return str(parent)\n+        # Also check one level up (in case we're inside the cloned repo)\n+        parent_up = parent.parent\n+        if (parent_up / 'model_a').exists() and (parent_up / 'model_b').exists():\n+            return str(parent_up)\n+    return None\n+\n+def read_manifest(experiment_root):\n+    \"\"\"Read the manifest.json file to get task_id and model assignments.\"\"\"\n+    try:\n+        manifest_path = os.path.join(experiment_root, 'manifest.json')\n+        if os.path.exists(manifest_path):\n+            with open(manifest_path, 'r', encoding='utf-8') as f:\n+                return json.load(f)\n+    except Exception:\n+        pass\n+    return {}\n+\n+def get_ab_metadata(cwd):\n+    \"\"\"Get A/B testing metadata (task_id, model_lane, model_name) from current directory.\"\"\"\n+    model_lane = detect_model_lane(cwd)\n+    experiment_root = get_experiment_root(cwd)\n+    \n+    if not model_lane or not experiment_root:\n+        return {}\n+    \n+    manifest = read_manifest(experiment_root)\n+    \n+    metadata = {\n+        \"task_id\": manifest.get(\"task_id\"),\n+        \"model_lane\": model_lane,\n+        \"experiment_root\": experiment_root\n+    }\n+    \n+    # Get model name from assignments\n+    assignments = manifest.get(\"assignments\", {})\n+    if model_lane in assignments:\n+        metadata[\"model_name\"] = assignments[model_lane]\n+    \n+    return metadata\n+\n+def get_log_file_path(session_id, cwd):\n+    \"\"\"Get the correct log file path for A/B testing (routes to model-specific directory).\"\"\"\n+    model_lane = detect_model_lane(cwd)\n+    experiment_root = get_experiment_root(cwd)\n+    \n+    if model_lane and experiment_root:\n+        # Route to model-specific logs directory\n+        logs_dir = os.path.join(experiment_root, \"logs\", model_lane)\n+        os.makedirs(logs_dir, exist_ok=True)\n+        return os.path.join(logs_dir, f\"session_{session_id}.jsonl\")\n+    else:\n+        # Fallback to current behavior\n+        project_dir = os.environ.get(\"CLAUDE_PROJECT_DIR\", os.getcwd())\n+        logs_dir = os.path.join(project_dir, \"logs\")\n+        os.makedirs(logs_dir, exist_ok=True)\n+        return \n\n```\n\n```diff\n@@ -0,0 +1,720 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Process raw transcript to extract all messages and generate summaries.\n+Handles both incremental (Stop event) and final (SessionEnd) processing.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import sys\n+import os\n+import shutil\n+import subprocess\n+from datetime import datetime, timezone\n+from pathlib import Path\n+from collections import defaultdict\n+from claude_code_capture_utils import get_log_file_path, add_ab_metadata, detect_model_lane, get_experiment_root\n+\n+def read_and_process_raw_transcript(transcript_path):\n+    \"\"\"\n+    Read raw transcript and extract all unique messages.\n+    Returns deduplicated messages with last occurrence (final state).\n+    Also extracts thinking blocks as separate entries.\n+    \"\"\"\n+    if not os.path.exists(transcript_path):\n+        return []\n+    \n+    # Track assistant messages by message.id (they have IDs, can have duplicates)\n+    assistant_messages = {}\n+    # Track thinking blocks separately (won't be counted in token usage)\n+    thinking_blocks = {}\n+    # Track user messages by uuid (they don't have message.id, use uuid)\n+    user_messages = {}\n+    \n+    try:\n+        with open(transcript_path, 'r', encoding='utf-8') as f:\n+            for line in f:\n+                line = line.strip()\n+                if not line:\n+                    continue\n+                \n+                try:\n+                    event = json.loads(line)\n+                    event_type = event.get('type')\n+                    message = event.get('message', {})\n+                    \n+                    # Process assistant messages (have message.id)\n+                    if event_type == 'assistant':\n+                        msg_id = message.get('id')\n+                        if msg_id:\n+                            # Check for thinking blocks in content\n+                            content = message.get('content', [])\n+                 \n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 335}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -0,0 +1,112 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Hook to capture session start/end events.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import sys\n+import os\n+import subprocess\n+from datetime import datetime, timezone\n+from claude_code_capture_utils import get_log_file_path, add_ab_metadata\n+\n+def get_git_metadata(repo_dir):\n+    \"\"\"Get current git commit and branch.\"\"\"\n+    try:\n+        # Get current commit hash\n+        commit_result = subprocess.run(\n+            ['git', 'rev-parse', 'HEAD'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        # Get current branch\n+        branch_result = subprocess.run(\n+            ['git', 'branch', '--show-current'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        git_metadata = {\n+            \"base_commit\": commit_result.stdout.strip() if commit_result.returncode == 0 else None,\n+            \"branch\": branch_result.stdout.strip() if branch_result.returncode == 0 else None,\n+            \"timestamp\": datetime.now(timezone.utc).isoformat()\n+        }\n+\n+        if git_metadata[\"base_commit\"]:\n+            return git_metadata\n+        else:\n+            return None\n+\n+    except Exception as e:\n+        print(f\"Warning: Could not capture git metadata: {e}\", file=sys.stderr)\n+        return None\n+\n+def main():\n+    try:\n+        if len(sys.argv) < 2:\n+            print(\"Usage: capture_session_event.py [start|end]\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        event_type = sys.argv[1].lower()\n+        if event_type not in [\"start\", \"end\"]:\n+            print(\"Event type must be 'start' or 'end'\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        input_data = json.load(sys.stdin)\n+\n+        session_id = input_data.get(\"session_id\", \"unknown\")\n+        transcript_path = input_data.get(\"transcript_path\", \"\")\n+        cwd = input_data.get(\"cwd\", \"\")\n+\n+        if event_type == \"start\":\n+            # Session start: capture git metadata\n+            git_metadata = get_git_metadata(cwd)\n+\n+            log_entry = {\n+                \"type\": \"session_start\",\n+                \"timestamp\": datetime.now(timezone.utc).isoformat(),\n+                \"session_id\": session_id,\n+                \"transcript_path\": transcript_path,\n+                \"cwd\": cwd,\n+                \"git_metadata\": git_metadata\n+            }\n+\n+            log_entry = add_ab_metadata(log_entry, cwd)\n+\n+            if git_metadata:\n+                print(f\"[OK] Captured git metadata: {git_metadata['base_commit'][:8]} on {git_metadata['branch']}\")\n+\n+            # Write session_start event\n+            log_file = get_log_file_path(session_id, cwd)\n+            with open(log_file, \"a\", encoding=\"utf-8\") as f:\n+                f.write(json.dumps(log_entry) + \"\\n\")\n+\n+        elif event_type == \"end\":\n+            # Session end: log the event\n+            log\n\n```\n\n```diff\n@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Utility functions for A/B testing hooks.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import os\n+from pathlib import Path\n+\n+def detect_model_lane(cwd):\n+    \"\"\"Detect if we're in model_a or model_b directory.\"\"\"\n+    path_parts = Path(cwd).parts\n+    if 'model_a' in path_parts:\n+        return 'model_a'\n+    elif 'model_b' in path_parts:\n+        return 'model_b'\n+    return None\n+\n+def get_experiment_root(cwd):\n+    \"\"\"Get the experiment root directory (parent of model_a/model_b).\"\"\"\n+    current_path = Path(cwd)\n+    \n+    # Check if we're inside a model_a or model_b directory\n+    # Look for the parent that contains both model_a and model_b\n+    for parent in [current_path] + list(current_path.parents):\n+        if (parent / 'model_a').exists() and (parent / 'model_b').exists():\n+            return str(parent)\n+        # Also check one level up (in case we're inside the cloned repo)\n+", "output": "Bug: Feature addition and fixes\n\n1. Added a plugin system allowing third-party libraries to hook into OpenAPI generation without monkey-patching FastAPI internals.\r\n\r\n2. Unified FastAPI and Starlette lifespan handling so:\r\nStartup/shutdown hooks behave consistently\r\nErrors are propagated correctly\r\n\r\n3. Reduced OpenAPI Generation Overhead\r\n\r\n4. Added an optional, non-production debugging endpoint that exposes the resolved dependency graph for each route. Requirements:  Added an internal API to extract the dependency DAG per route Include: Dependency callables Scope (request / function) Cleanup (yield) dependencies Security scopes Output must be purely informational (no execution) Must not affect runtime behavior Constraints \r\n\r\n5. Defined and enforced a deterministic cleanup order for dependency finalizers.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 335}
{"instruction": "Review the following code changes: Feature addition and fixes", "input": "```diff\n@@ -0,0 +1,112 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Hook to capture session start/end events.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import sys\n+import os\n+import subprocess\n+from datetime import datetime, timezone\n+from claude_code_capture_utils import get_log_file_path, add_ab_metadata\n+\n+def get_git_metadata(repo_dir):\n+    \"\"\"Get current git commit and branch.\"\"\"\n+    try:\n+        # Get current commit hash\n+        commit_result = subprocess.run(\n+            ['git', 'rev-parse', 'HEAD'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        # Get current branch\n+        branch_result = subprocess.run(\n+            ['git', 'branch', '--show-current'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        git_metadata = {\n+            \"base_commit\": commit_result.stdout.strip() if commit_result.returncode == 0 else None,\n+            \"branch\": branch_result.stdout.strip() if branch_result.returncode == 0 else None,\n+            \"timestamp\": datetime.now(timezone.utc).isoformat()\n+        }\n+\n+        if git_metadata[\"base_commit\"]:\n+            return git_metadata\n+        else:\n+            return None\n+\n+    except Exception as e:\n+        print(f\"Warning: Could not capture git metadata: {e}\", file=sys.stderr)\n+        return None\n+\n+def main():\n+    try:\n+        if len(sys.argv) < 2:\n+            print(\"Usage: capture_session_event.py [start|end]\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        event_type = sys.argv[1].lower()\n+        if event_type not in [\"start\", \"end\"]:\n+            print(\"Event type must be 'start' or 'end'\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        input_data = json.load(sys.stdin)\n+\n+        session_id = input_data.get(\"session_id\", \"unknown\")\n+        transcript_path = input_data.get(\"transcript_path\", \"\")\n+        cwd = input_data.get(\"cwd\", \"\")\n+\n+        if event_type == \"start\":\n+            # Session start: capture git metadata\n+            git_metadata = get_git_metadata(cwd)\n+\n+            log_entry = {\n+                \"type\": \"session_start\",\n+                \"timestamp\": datetime.now(timezone.utc).isoformat(),\n+                \"session_id\": session_id,\n+                \"transcript_path\": transcript_path,\n+                \"cwd\": cwd,\n+                \"git_metadata\": git_metadata\n+            }\n+\n+            log_entry = add_ab_metadata(log_entry, cwd)\n+\n+            if git_metadata:\n+                print(f\"[OK] Captured git metadata: {git_metadata['base_commit'][:8]} on {git_metadata['branch']}\")\n+\n+            # Write session_start event\n+            log_file = get_log_file_path(session_id, cwd)\n+            with open(log_file, \"a\", encoding=\"utf-8\") as f:\n+                f.write(json.dumps(log_entry) + \"\\n\")\n+\n+        elif event_type == \"end\":\n+            # Session end: log the event\n+            log\n\n```\n\n```diff\n@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Utility functions for A/B testing hooks.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import os\n+from pathlib import Path\n+\n+def detect_model_lane(cwd):\n+    \"\"\"Detect if we're in model_a or model_b directory.\"\"\"\n+    path_parts = Path(cwd).parts\n+    if 'model_a' in path_parts:\n+        return 'model_a'\n+    elif 'model_b' in path_parts:\n+        return 'model_b'\n+    return None\n+\n+def get_experiment_root(cwd):\n+    \"\"\"Get the experiment root directory (parent of model_a/model_b).\"\"\"\n+    current_path = Path(cwd)\n+    \n+    # Check if we're inside a model_a or model_b directory\n+    # Look for the parent that contains both model_a and model_b\n+    for parent in [current_path] + list(current_path.parents):\n+        if (parent / 'model_a').exists() and (parent / 'model_b').exists():\n+            return str(parent)\n+        # Also check one level up (in case we're inside the cloned repo)\n+        parent_up = parent.parent\n+        if (parent_up / 'model_a').exists() and (parent_up / 'model_b').exists():\n+            return str(parent_up)\n+    return None\n+\n+def read_manifest(experiment_root):\n+    \"\"\"Read the manifest.json file to get task_id and model assignments.\"\"\"\n+    try:\n+        manifest_path = os.path.join(experiment_root, 'manifest.json')\n+        if os.path.exists(manifest_path):\n+            with open(manifest_path, 'r', encoding='utf-8') as f:\n+                return json.load(f)\n+    except Exception:\n+        pass\n+    return {}\n+\n+def get_ab_metadata(cwd):\n+    \"\"\"Get A/B testing metadata (task_id, model_lane, model_name) from current directory.\"\"\"\n+    model_lane = detect_model_lane(cwd)\n+    experiment_root = get_experiment_root(cwd)\n+    \n+    if not model_lane or not experiment_root:\n+        return {}\n+    \n+    manifest = read_manifest(experiment_root)\n+    \n+    metadata = {\n+        \"task_id\": manifest.get(\"task_id\"),\n+        \"model_lane\": model", "output": "Changes look good. This PR implements: Feature addition and fixes", "source": "pr", "type": "code_review", "pr_number": 335}
{"instruction": "Fix the following bug: Update ValidationError schema for Pydantic V2 compatibility", "input": "## Summary\n- Add `input`, `ctx`, and `url` fields to the ValidationError OpenAPI definition\n- These fields are present in Pydantic V2 validation errors but were missing from the OpenAPI schema\n\n## Background\nPydantic V2 validation errors include additional fields beyond the original V1 schema:\n- `input`: The value that failed validation\n- `ctx`: Additional context about the error (optional)\n- `url`: Documentation URL for the error type (optional)\n\nThis update ensures the OpenAPI documentation accurately reflects the actual error response structure.\n\n## Test plan\n- [x] All existing tests updated to expect new schema fields\n- [x] Verified schema matches actual Pydantic V2 error output\n- [x] All test suites pass\n\nFixes #10787", "output": "```diff\n@@ -51,6 +51,9 @@\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"input\": {\"title\": \"Input\"},\n+        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+        \"url\": {\"title\": \"Error URL\", \"type\": \"string\", \"format\": \"uri\"},\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n\n```\n\n```diff\n@@ -89,6 +89,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```\n\n```diff\n@@ -117,6 +117,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"type\": \"string\", \"title\": \"Message\"},\n                         \"type\": {\"type\": \"string\", \"title\": \"Error Type\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                     \"type\": \"object\",\n                     \"required\": [\"loc\", \"msg\", \"type\"],\n\n```\n\n```diff\n@@ -145,6 +145,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n             }\n\n```\n\n```diff\n@@ -66,6 +66,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 334}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -51,6 +51,9 @@\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"input\": {\"title\": \"Input\"},\n+        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+        \"url\": {\"title\": \"Error URL\", \"type\": \"string\", \"format\": \"uri\"},\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n\n```\n\n```diff\n@@ -89,6 +89,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```\n\n```diff\n@@ -117,6 +117,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"type\": \"string\", \"title\": \"Message\"},\n                         \"type\": {\"type\": \"string\", \"title\": \"Error Type\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                     \"type\": \"object\",\n                     \"required\": [\"loc\", \"msg\", \"type\"],\n\n```\n\n```diff\n@@ -145,6 +145,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n             }\n\n```\n\n```diff\n@@ -66,6 +66,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```", "output": "Bug: Update ValidationError schema for Pydantic V2 compatibility\n\n## Summary\n- Add `input`, `ctx`, and `url` fields to the ValidationError OpenAPI definition\n- These fields are present in Pydantic V2 validation errors but were missing from the OpenAPI schema\n\n## Background\nPydantic V2 validation errors include additional fields beyond the original V1 schema:\n- `input`: The value that failed validation\n- `ctx`: Additional context about the error (optional)\n- `url`: Documentation URL for the error type (optional)\n\nThis update ensures the OpenAPI documentation accurately reflects the actual error response structure.\n\n## Test plan\n- [x] All existing tests updated to expect new schema fields\n- [x] Verified schema matches actual Pydantic V2 error output\n- [x] All test suites pass\n\nFixes #10787", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 334}
{"instruction": "Review the following code changes: Update ValidationError schema for Pydantic V2 compatibility", "input": "```diff\n@@ -51,6 +51,9 @@\n         },\n         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+        \"input\": {\"title\": \"Input\"},\n+        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+        \"url\": {\"title\": \"Error URL\", \"type\": \"string\", \"format\": \"uri\"},\n     },\n     \"required\": [\"loc\", \"msg\", \"type\"],\n }\n\n```\n\n```diff\n@@ -89,6 +89,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```\n\n```diff\n@@ -117,6 +117,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"type\": \"string\", \"title\": \"Message\"},\n                         \"type\": {\"type\": \"string\", \"title\": \"Error Type\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                     \"type\": \"object\",\n                     \"required\": [\"loc\", \"msg\", \"type\"],\n\n```\n\n```diff\n@@ -145,6 +145,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n             }\n\n```\n\n```diff\n@@ -66,6 +66,13 @@ def test_openapi_schema():\n                         },\n                         \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        \"input\": {\"title\": \"Input\"},\n+                        \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                        \"url\": {\n+                            \"title\": \"Error URL\",\n+                            \"type\": \"string\",\n+                            \"format\": \"uri\",\n+                        },\n                     },\n                 },\n                 \"HTTPValidationError\": {\n\n```", "output": "Changes look good. This PR implements: Update ValidationError schema for Pydantic V2 compatibility", "source": "pr", "type": "code_review", "pr_number": 334}
{"instruction": "Review the following code changes: üåê Update translations for ja (update-outdated)", "input": "```diff\n@@ -317,6 +317,8 @@ extra:\n     name: de - Deutsch\n   - link: /es/\n     name: es - espa√±ol\n+  - link: /ja/\n+    name: ja - Êó•Êú¨Ë™û\n   - link: /ko/\n     name: ko - ÌïúÍµ≠Ïñ¥\n   - link: /pt/\n\n```\n\n```diff\n@@ -1,41 +1,41 @@\n-# ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ\n+# ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ { #additional-status-codes }\n \n-„Éá„Éï„Ç©„É´„Éà„Åß„ÅØ„ÄÅ **FastAPI** „ÅØ `JSONResponse` „Çí‰Ωø„Å£„Å¶„É¨„Çπ„Éù„É≥„Çπ„ÇíËøî„Åó„Åæ„Åô„ÄÇ„Åù„ÅÆ `JSONResponse` „ÅÆ‰∏≠„Å´„ÅØ„ÄÅ *path operation* „ÅåËøî„Åó„ÅüÂÜÖÂÆπ„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ\n+„Éá„Éï„Ç©„É´„Éà„Åß„ÅØ„ÄÅ **FastAPI** „ÅØ `JSONResponse` „Çí‰Ωø„Å£„Å¶„É¨„Çπ„Éù„É≥„Çπ„ÇíËøî„Åó„ÄÅ*path operation* „Åã„ÇâËøî„Åó„ÅüÂÜÖÂÆπ„Çí„Åù„ÅÆ `JSONResponse` „ÅÆ‰∏≠„Å´ÂÖ•„Çå„Åæ„Åô„ÄÇ\n \n-„Åù„Çå„ÅØ„ÄÅ„Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åã„ÄÅ *path operation* „Åß„Çª„ÉÉ„Éà„Åó„Åü„ÇÇ„ÅÆ„ÇíÂà©Áî®„Åó„Åæ„Åô„ÄÇ\n+„Éá„Éï„Ç©„É´„Éà„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÄÅ„Åæ„Åü„ÅØ *path operation* „ÅßË®≠ÂÆö„Åó„Åü„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Åå‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ\n \n-## ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ\n+## ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ { #additional-status-codes_1 }\n \n-„É°„Ç§„É≥„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å®„ÅØÂà•„Å´„ÄÅ‰ªñ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíËøî„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅ`Response` (`JSONResponse` „Å™„Å©) „Å´ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶Áõ¥Êé•Ëøî„Åó„Åæ„Åô„ÄÇ\n+„É°„Ç§„É≥„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å®„ÅØÂà•„Å´ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíËøî„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅ`JSONResponse` „ÅÆ„Çà„ÅÜ„Å™ `Response` „ÇíÁõ¥Êé•Ëøî„Åó„ÄÅËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíÁõ¥Êé•Ë®≠ÂÆö„Åß„Åç„Åæ„Åô„ÄÇ\n \n-‰æã„Åà„Å∞„ÄÅitem„ÇíÊõ¥Êñ∞„Åó„ÄÅÊàêÂäü„Åó„ÅüÂ†¥Âêà„ÅØ200 \"OK\"„ÅÆHTTP„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÇíËøî„Åô *path operation* „Çí‰Ωú„Çä„Åü„ÅÑ„Å®„Åó„Åæ„Åô„ÄÇ\n+„Åü„Å®„Åà„Å∞„ÄÅitem „ÇíÊõ¥Êñ∞„Åß„Åç„ÄÅÊàêÂäüÊôÇ„Å´ HTTP „Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ 200 \"OK\" „ÇíËøî„Åô *path operation* „Çí‰Ωú„Çä„Åü„ÅÑ„Å®„Åó„Åæ„Åô„ÄÇ\n \n-„Åó„Åã„Åó„ÄÅÊñ∞„Åó„ÅÑitem„ÇÇË®±ÂèØ„Åó„Åü„ÅÑ„Åß„Åô„ÄÇitem„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ„Åù„Çå„Çâ„Çí‰ΩúÊàê„Åó„Å¶201 \"Created\"„ÇíËøî„Åó„Åæ„Åô„ÄÇ\n+„Åó„Åã„Åó„ÄÅÊñ∞„Åó„ÅÑ item „ÇÇÂèó„Åë‰ªò„Åë„Åü„ÅÑ„Å®„Åó„Åæ„Åô„ÄÇ„Åù„Åó„Å¶„ÄÅitem „Åå‰ª•ÂâçÂ≠òÂú®„Åó„Å™„Åã„Å£„ÅüÂ†¥Âêà„Å´„ÅØ‰ΩúÊàê„Åó„ÄÅHTTP „Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ 201„ÄåCreated„Äç„ÇíËøî„Åó„Åæ„Åô„ÄÇ\n \n-„Åì„Çå„ÇíÈÅîÊàê„Åô„Çã„Å´„ÅØ„ÄÅ `JSONResponse` „Çí„Ç§„É≥„Éù„Éº„Éà„Åó„ÄÅ `status_code` „ÇíË®≠ÂÆö„Åó„Å¶Áõ¥Êé•ÂÜÖÂÆπ„ÇíËøî„Åó„Åæ„Åô„ÄÇ\n+„Åì„Çå„ÇíÂÆüÁèæ„Åô„Çã„Å´„ÅØ„ÄÅ`JSONResponse` „Çí„Ç§„É≥„Éù„Éº„Éà„Åó„ÄÅÊúõ„ÇÄ `status_code` „ÇíË®≠ÂÆö„Åó„Å¶„ÄÅ„Åù„Åì„ÅßÂÜÖÂÆπ„ÇíÁõ¥Êé•Ëøî„Åó„Åæ„Åô„ÄÇ\n \n-{* ../../docs_src/additional_status_codes/tutorial001.py hl[4,25] *}\n+{* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n /// warning | Ê≥®ÊÑè\n \n-‰∏äË®ò„ÅÆ‰æã„ÅÆ„Çà„ÅÜ„Å´ `Response` „ÇíÊòéÁ§∫ÁöÑ„Å´Ëøî„ÅôÂ†¥Âêà„ÄÅ„Åù„Çå„ÅØÁõ¥Êé•Ëøî„Åï„Çå„Åæ„Åô„ÄÇ\n+‰∏ä„ÅÆ‰æã„ÅÆ„Çà„ÅÜ„Å´ `Response` „ÇíÁõ¥Êé•Ëøî„Åô„Å®„ÄÅ„Åù„Çå„ÅØ„Åù„ÅÆ„Åæ„ÅæËøî„Åï„Çå„Åæ„Åô„ÄÇ\n \n-„É¢„Éá„É´„Å™„Å©„ÅØ„Ç∑„É™„Ç¢„É©„Ç§„Ç∫„Åï„Çå„Åæ„Åõ„Çì„ÄÇ\n+„É¢„Éá„É´„Å™„Å©„Å´„Çà„Å£„Å¶„Ç∑„É™„Ç¢„É©„Ç§„Ç∫„Åï„Çå„Åæ„Åõ„Çì„ÄÇ\n \n-ÂøÖË¶Å„Å™„Éá„Éº„Çø„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇÑ„ÄÅÂÄ§„ÅåÊúâÂäπ„Å™JSON„Åß„ÅÇ„Çã„Åì„Å® (`JSONResponse` „Çí‰Ωø„ÅÜÂ†¥Âêà) „ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n+ÂøÖË¶Å„Å™„Éá„Éº„Çø„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÄÅ„Åù„Åó„Å¶Ôºà`JSONResponse` „Çí‰ΩøÁî®„Åó„Å¶„ÅÑ„ÇãÂ†¥ÂêàÔºâÂÄ§„ÅåÊúâÂäπ„Å™ JSON „Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n \n ///\n \n /// note | ÊäÄË°ìË©≥Á¥∞\n \n-`from starlette.responses import JSONResponse` „ÇíÂà©Áî®„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n+`from starlette.responses import JSONResponse` „Çí‰Ωø„ÅÜ„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n \n-**FastAPI** „ÅØ `fastapi.responses` „Å®Âêå„Åò `starlette.responses` „Çí„ÄÅÈñãÁô∫ËÄÖ„ÅÆÂà©‰æøÊÄß„ÅÆ„Åü„ÇÅ„Å´Êèê‰æõ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åó„Åã„ÅóÊúâÂäπ„Å™„É¨„Çπ„Éù„É≥„Çπ„ÅØ„Åª„Å®„Çì„Å©Starlette„Åã„ÇâÊù•„Å¶„ÅÑ„Åæ„Åô„ÄÇ `status` „Å´„Å§„ÅÑ„Å¶„ÇÇÂêå„Åò„Åß„Åô„ÄÇ\n+**FastAPI** „ÅØÈñãÁô∫ËÄÖ„ÅÆÂà©‰æøÊÄß„ÅÆ„Åü„ÇÅ„Å´„ÄÅ`fastapi.responses` „Å®Âêå„Åò `starlette.responses` „ÇíÊèê‰æõ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åó„Åã„Åó„ÄÅÂà©Áî®ÂèØËÉΩ„Å™„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Åª„Å®„Çì„Å©„ÅØ Starlette „Åã„ÇâÁõ¥Êé•Êèê‰æõ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`status` „ÇÇÂêåÊßò„Åß„Åô„ÄÇ\n \n ///\n \n-## OpenAPI„Å®API„Éâ„Ç≠„É•„É°„É≥„Éà\n+## OpenAPI „Å® API „Éâ„Ç≠„É•„É°„É≥„Éà { #openapi-and-api-docs }\n \n-„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å®„É¨„Çπ„Éù„É≥„Çπ„ÇíÁõ¥Êé•Ëøî„ÅôÂ†¥Âêà„ÄÅ„Åù„Çå„Çâ„ÅØOpenAPI„Çπ„Ç≠„Éº„Éû (API„Éâ„Ç≠„É•„É°„É≥„Éà) „Å´„ÅØÂê´„Åæ„Çå„Åæ„Åõ„Çì„ÄÇ„Å™„Åú„Å™„Çâ„ÄÅFastAPI„ÅØ‰Ωï„ÅåËøî„Åï„Çå„Çã„ÅÆ„Åã‰∫ãÂâç„Å´Áü•„Çã„Åì„Å®„Åå„Åß„Åç„Å™„ÅÑ„Åã„Çâ„Åß„Åô„ÄÇ\n+ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å®„É¨„Çπ„Éù„É≥„Çπ„ÇíÁõ¥Êé•Ëøî„ÅôÂ†¥Âêà„ÄÅ„Åù„Çå„Çâ„ÅØ OpenAPI „Çπ„Ç≠„Éº„ÉûÔºàAPI „Éâ„Ç≠„É•„É°„É≥„ÉàÔºâ„Å´„ÅØÂê´„Åæ„Çå„Åæ„Åõ„Çì„ÄÇFastAPI „Å´„ÅØ„ÄÅ‰∫ãÂâç„Å´‰Ωï„ÅåËøî„Åï„Çå„Çã„Åã„ÇíÁü•„ÇãÊñπÊ≥ï„Åå„Å™„ÅÑ„Åã„Çâ„Åß„Åô„ÄÇ\n \n-„Åó„Åã„Åó„ÄÅ [Additional Responses](additional-responses.md){.internal-link target=_blank} „Çí‰Ωø„Å£„Å¶„Ç≥„Éº„Éâ„ÅÆ‰∏≠„Å´„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÊõ∏„Åè„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n+„Åó„Åã„Åó„ÄÅ[Additional Responses](additional-responses.md){.internal-link target=_blank} „Çí‰Ωø„Å£„Å¶„Ç≥„Éº„ÉâÂÜÖ„Å´„Éâ„Ç≠„É•„É°„É≥„ÉàÂåñ„Åß„Åç„Åæ„Åô„ÄÇ\n\n```\n\n```diff\n@@ -1,34 +1,40 @@\n-# „Ç´„Çπ„Çø„É†„É¨„Çπ„Éù„É≥„Çπ - HTML„ÄÅ„Çπ„Éà„É™„Éº„É†„ÄÅ„Éï„Ç°„Ç§„É´„ÄÅ„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Çπ„Éù„É≥„Çπ\n+# „Ç´„Çπ„Çø„É†„É¨„Çπ„Éù„É≥„Çπ - HTML„ÄÅ„Çπ„Éà„É™„Éº„É†„ÄÅ„Éï„Ç°„Ç§„É´„ÄÅ„Åù„ÅÆ‰ªñ„ÅÆ„É¨„Çπ„Éù„É≥„Çπ { #custom-response-html-stream-file-others }\n \n „Éá„Éï„Ç©„É´„Éà„Åß„ÅØ„ÄÅ**FastAPI** „ÅØ `JSONResponse` „Çí‰Ωø„Å£„Å¶„É¨„Çπ„Éù„É≥„Çπ„ÇíËøî„Åó„Åæ„Åô„ÄÇ\n \n [„É¨„Çπ„Éù„É≥„Çπ„ÇíÁõ¥Êé•Ëøî„Åô](response-directly.md){.internal-link target=_blank}„ÅßË¶ã„Åü„Çà„ÅÜ„Å´„ÄÅ `Response` „ÇíÁõ¥Êé•Ëøî„Åô„Åì„Å®„Åß„Åì„ÅÆÊåôÂãï„Çí„Ç™„Éº„Éê„Éº„É©„Ç§„Éâ„Åß„Åç„Åæ„Åô„ÄÇ\n \n-„Åó„Åã„Åó„ÄÅ`Response` „ÇíÁõ¥Êé•Ëøî„Åô„Å®„ÄÅ„Éá„Éº„Çø„ÅØËá™ÂãïÁöÑ„Å´Â§âÊèõ„Åï„Çå„Åö„ÄÅ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇÇËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åõ„Çì (‰æã„Åà„Å∞„ÄÅÁîüÊàê„Åï„Çå„ÇãOpenAPI„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶HTTP„Éò„ÉÉ„ÉÄ„Éº `Content-Type` „Å´ÁâπÂÆö„ÅÆ„Äå„É°„Éá„Ç£„Ç¢„Çø„Ç§„Éó„Äç„ÇíÂê´„ÇÅ„Çã„Å™„Å©) „ÄÇ\n+„Åó„Åã„Åó„ÄÅ`Response` „ÇíÁõ¥Êé•Ëøî„Åô„Å®Ôºà„Åæ„Åü„ÅØ `JSONResponse` „ÅÆ„Çà„ÅÜ„Å™‰ªªÊÑè„ÅÆ„Çµ„Éñ„ÇØ„É©„Çπ„ÇíËøî„Åô„Å®Ôºâ„ÄÅ„Éá„Éº„Çø„ÅØËá™ÂãïÁöÑ„Å´Â§âÊèõ„Åï„Çå„ÅöÔºà`response_model` „ÇíÂÆ£Ë®Ä„Åó„Å¶„ÅÑ„Å¶„ÇÇÔºâ„ÄÅ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇÇËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åõ„ÇìÔºà‰æã„Åà„Å∞„ÄÅÁîüÊàê„Åï„Çå„ÇãOpenAPI„ÅÆ‰∏ÄÈÉ®„Å®„Åó„Å¶HTTP„Éò„ÉÉ„ÉÄ„Éº `Content-Type` „Å´ÁâπÂÆö„ÅÆ„Äå„É°„Éá„Ç£„Ç¢„Çø„Ç§„Éó„Äç„ÇíÂê´„ÇÅ„Çã„Å™„Å©Ôºâ„ÄÇ\n \n-„Åó„Åã„Åó„ÄÅ*path operation„Éá„Ç≥„É¨„Éº„Çø* „Å´„ÄÅ‰Ωø„ÅÑ„Åü„ÅÑ `Response` „ÇíÂÆ£Ë®Ä„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n+`response_class` „Éë„É©„É°„Éº„Çø„Çí‰ΩøÁî®„Åó„Å¶„ÄÅ*path operation „Éá„Ç≥„É¨„Éº„Çø* „Åß‰ΩøÁî®„Åó„Åü„ÅÑ `Response`Ôºà‰ªªÊÑè„ÅÆ `Response` „Çµ„Éñ„ÇØ„É©„ÇπÔºâ„ÇíÂÆ£Ë®Ä„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ\n \n-*path operationÈñ¢Êï∞* „Åã„ÇâËøî„Åï„Çå„Çã„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅØ„ÄÅ„Åù„ÅÆ `Response` „Å´Âê´„Åæ„Çå„Åæ„Åô„ÄÇ\n+*path operation Èñ¢Êï∞* „Åã„ÇâËøî„Åï„Çå„Çã„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅØ„ÄÅ„Åù„ÅÆ `Response` „Å´Âê´„Åæ„Çå„Åæ„Åô„ÄÇ\n \n-„Åù„Åó„Å¶„ÇÇ„Åó„ÄÅ`Response` „Åå„ÄÅ`JSONResponse` „ÇÑ `UJSONResponse` „ÅÆÂ†¥Âêà„ÅÆ„Çà„ÅÜ„Å´JSON„É°„Éá„Ç£„Ç¢„Çø„Ç§„Éó (`application/json`) „Å™„Çâ„Å∞„ÄÅ„Éá„Éº„Çø„ÅØ *path operation„Éá„Ç≥„É¨„Éº„Çø* „Å´ÂÆ£Ë®Ä„Åó„ÅüPydantic `response_model` „Å´„Çà„ÇäËá™ÂãïÁöÑ„Å´Â§âÊèõ („ÇÇ„Åó„Åè„ÅØ„Éï„Ç£„É´„Çø) „Åï„Çå„Åæ„Åô„ÄÇ\n+„Åù„Åó„Å¶„Åù„ÅÆ `Response` „Åå„ÄÅ`JSONResponse` „ÇÑ `UJSONResponse` „ÅÆÂ†¥Âêà„ÅÆ„Çà„ÅÜ„Å´JSON„É°„Éá„Ç£„Ç¢„Çø„Ç§„ÉóÔºà`application/json`Ôºâ„Å™„Çâ„ÄÅÈñ¢Êï∞„ÅÆËøî„ÇäÂÄ§„ÅØ *path operation„Éá„Ç≥„É¨„Éº„Çø* „Å´ÂÆ£Ë®Ä„Åó„Åü‰ªªÊÑè„ÅÆPydantic `response_model` „Å´„Çà„ÇäËá™ÂãïÁöÑ„Å´Â§âÊèõÔºà„Åä„Çà„Å≥„Éï„Ç£„É´„ÇøÔºâ„Åï„Çå„Åæ„Åô„ÄÇ\n \n /// note | ÂÇôËÄÉ\n \n-„É°„Éá„Ç£„Ç¢„Çø„Ç§„Éó„ÇíÊåáÂÆö„Åõ„Åö„Å´„É¨„Çπ„Éù„É≥„Çπ„ÇØ„É©„Çπ„ÇíÂà©Áî®„Åô„Çã„Å®„ÄÅFastAPI„ÅØ‰Ωï„ÇÇ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„Å™„ÅÑ„Åì„Å®„ÇíÊúüÂæÖ„Åó„Åæ„Åô„ÄÇ„Åù„ÅÆ„Åü„ÇÅ„ÄÅÁîüÊàê„Åï„Çå„ÇãOpenAPI„Éâ„Ç≠„É•„É°„É≥„Éà„Å´„É¨„Çπ„Éù„É≥„Çπ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅåË®òËºâ„Åï„Çå„Åæ„Åõ„Çì„ÄÇ\n+„É°„Éá„Ç£„Ç¢„Çø„Ç§„Éó„ÇíÊåáÂÆö„Åõ„Åö„Å´„É¨„Çπ„Éù„É≥„Çπ„ÇØ„É©„Çπ„ÇíÂà©Áî®„Åô„Çã„Å®„ÄÅFastAPI„ÅØ„É¨„Çπ„Éù„É≥„Çπ„Å´„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Åå„Å™„ÅÑ„Åì„Å®„ÇíÊúüÂæÖ„Åó„Åæ„Åô„ÄÇ„Åù„ÅÆ„Åü„ÇÅ„ÄÅÁîüÊàê„Åï„Çå„ÇãOpenAPI„Éâ„Ç≠„É•„É°„É≥„Éà„Å´„É¨„Çπ„Éù„É≥„Çπ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÅåË®òËºâ„Åï„Çå„Åæ„Åõ„Çì„ÄÇ\n \n ///\n \n-## `ORJSONResponse` „Çí‰Ωø„ÅÜ\n+## `ORJSONResponse` „Çí‰Ωø„ÅÜ { #use-orjsonresponse }\n \n-‰æã„Åà„Å∞„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíÂá∫„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅ<a href=\"https://github.com/ijl/orjson\" class=\"external-link\" target=\"_blank\">`orjson`</a>„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„ÄÅ`ORJSONResponse`„Çí„É¨„Çπ„Éù„É≥„Çπ„Å®„Åó„Å¶„Çª„ÉÉ„Éà„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ\n+‰æã„Åà„Å∞„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíÁµû„ÇäÂá∫„Åó„Åü„ÅÑÂ†¥Âêà„ÅØ„ÄÅ<a href=\"https://github.com/ijl/orjson\" class=\"external-link\" target=\"_blank\">`orjson`</a>„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„ÄÅ„É¨„Çπ„Éù„É≥„Çπ„Å®„Åó„Å¶ `ORJSONResponse` „Çí„Çª„ÉÉ„Éà„Åß„Åç„Åæ„Åô„ÄÇ\n \n-‰Ωø„ÅÑ„Åü„ÅÑ `Response` „ÇØ„É©„Çπ („Çµ„Éñ„ÇØ„É©„Çπ) „Çí„Ç§„É≥„Éù„Éº„Éà„Åó„ÄÅ *path operation„Éá„Ç≥„É¨„Éº„Çø* „Å´ÂÆ£Ë®Ä„Åó„Åæ„Åô„ÄÇ\n+‰Ωø„ÅÑ„Åü„ÅÑ `Response` „ÇØ„É©„ÇπÔºà„Çµ„Éñ„ÇØ„É©„ÇπÔºâ„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„ÄÅ*path operation„Éá„Ç≥„É¨„Éº„Çø* „Å´ÂÆ£Ë®Ä„Åó„Åæ„Åô„ÄÇ\n \n-{* ../../docs_src/custom_response/tutorial001b.py hl[2,7] *}\n+Â§ß„Åç„Å™„É¨„Çπ„Éù„É≥„Çπ„ÅÆÂ†¥Âêà„ÄÅ`Response` „ÇíÁõ¥Êé•Ëøî„Åô„Åª„ÅÜ„Åå„ÄÅËæûÊõ∏„ÇíËøî„Åô„Çà„Çä„ÇÇ„ÅØ„Çã„Åã„Å´È´òÈÄü„Åß„Åô„ÄÇ\n+\n+„Åì„Çå„ÅØ„ÄÅ„Éá„Éï„Ç©„É´„Éà„Åß„ÅØFastAPI„Åå„ÉÅ„É•„Éº„Éà„É™„Ç¢„É´„ÅßË™¨Êòé„Åó„ÅüÂêå„Åò[JSON Compatible Encoder](../tutorial/encoder.md){.internal-link target=_blank}„Çí‰Ωø„Å£„Å¶„ÄÅÂÜÖÈÉ®„ÅÆÂêÑ„Ç¢„Ç§„ÉÜ„É†„ÇíÊ§úÊüª„Åó„ÄÅJSON„Å®„Åó„Å¶„Ç∑„É™„Ç¢„É©„Ç§„Ç∫ÂèØËÉΩ„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åô„Çã", "output": "Changes look good. This PR implements: üåê Update translations for ja (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 333}
{"instruction": "Review the following code changes: üåê Update translations for uk (add-missing)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# –¢–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª LLM { #llm-test-file }\n+\n+–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ <abbr title=\"Large Language Model - –í–µ–ª–∏–∫–∞ –º–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å\">LLM</abbr>, —è–∫–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥–∞—î –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é, —Ä–æ–∑—É–º—ñ—î `general_prompt` —É `scripts/translate.py` —Ç–∞ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π prompt —É `docs/{language code}/llm-prompt.md`. –ú–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π prompt –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ `general_prompt`.\n+\n+–¢–µ—Å—Ç–∏, –¥–æ–¥–∞–Ω—ñ —Ç—É—Ç, –ø–æ–±–∞—á–∞—Ç—å —É—Å—ñ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö prompt.\n+\n+–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–∞–∫:\n+\n+* –ú–∞–π—Ç–µ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π prompt ‚Äî `docs/{language code}/llm-prompt.md`.\n+* –ó—Ä–æ–±—ñ—Ç—å ¬´—Å–≤—ñ–∂–∏–π¬ª –ø–µ—Ä–µ–∫–ª–∞–¥ —Ü—å–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –±–∞–∂–∞–Ω—É —Ü—ñ–ª—å–æ–≤—É –º–æ–≤—É (–¥–∏–≤., –Ω–∞–ø—Ä., –∫–æ–º–∞–Ω–¥—É `translate-page` —É `translate.py`). –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –ø–µ—Ä–µ–∫–ª–∞–¥ —É `docs/{language code}/docs/_llm-test.md`.\n+* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—Å–µ –≥–∞—Ä–∞–∑–¥ —É –ø–µ—Ä–µ–∫–ª–∞–¥—ñ.\n+* –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –ø–æ–ª—ñ–ø—à—Ç–µ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π prompt, –∑–∞–≥–∞–ª—å–Ω–∏–π prompt –∞–±–æ –∞–Ω–≥–ª–æ–º–æ–≤–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç.\n+* –ü–æ—Ç—ñ–º –≤—Ä—É—á–Ω—É –≤–∏–ø—Ä–∞–≤—Ç–µ —Ä–µ—à—Ç—É –ø—Ä–æ–±–ª–µ–º —É –ø–µ—Ä–µ–∫–ª–∞–¥—ñ, —â–æ–± —Ü–µ –±—É–≤ —è–∫—ñ—Å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥.\n+* –ü–µ—Ä–µ–∫–ª–∞–¥—ñ—Ç—å –∑–Ω–æ–≤—É, –º–∞—é—á–∏ —è–∫—ñ—Å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ –Ω–∞ –º—ñ—Å—Ü—ñ. –Ü–¥–µ–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî LLM –±—ñ–ª—å—à–µ –Ω–µ –≤–Ω–æ—Å–∏—Ç—å –∂–æ–¥–Ω–∏—Ö –∑–º—ñ–Ω —É –ø–µ—Ä–µ–∫–ª–∞–¥. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–∞–≥–∞–ª—å–Ω–∏–π prompt —ñ –≤–∞—à –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π prompt ‚Äî –Ω–∞—Å—Ç—ñ–ª—å–∫–∏ –¥–æ–±—Ä—ñ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –º–æ–∂–ª–∏–≤–æ (—ñ–Ω–∫–æ–ª–∏ –≤—ñ–Ω —É—Å–µ –∂ —Ä–æ–±–∏—Ç–∏–º–µ –∫—ñ–ª—å–∫–∞ –Ω–∞ –≤–∏–≥–ª—è–¥ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∑–º—ñ–Ω, –ø—Ä–∏—á–∏–Ω–∞ –≤ —Ç–æ–º—É, —â–æ <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM –Ω–µ —î –¥–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏</a>).\n+\n+–¢–µ—Å—Ç–∏:\n+\n+## –§—Ä–∞–≥–º–µ–Ω—Ç–∏ –∫–æ–¥—É { #code-snippets }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+–û—Å—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥—É: `foo`. –ê –æ—Å—å —â–µ –æ–¥–∏–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥—É: `bar`. –Ü —â–µ –æ–¥–∏–Ω: `baz quux`.\n+\n+////\n+\n+//// tab | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+–í–º—ñ—Å—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ –∫–æ–¥—É —Å–ª—ñ–¥ –∑–∞–ª–∏—à–∞—Ç–∏ –±–µ–∑ –∑–º—ñ–Ω.\n+\n+–î–∏–≤. —Ä–æ–∑–¥—ñ–ª `### Content of code snippets` —É –∑–∞–≥–∞–ª—å–Ω–æ–º—É prompt —É `scripts/translate.py`.\n+\n+////\n+\n+## –õ–∞–ø–∫–∏ { #quotes }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+–£—á–æ—Ä–∞ –º—ñ–π –¥—Ä—É–≥ –Ω–∞–ø–∏—Å–∞–≤: \"If you spell incorrectly correctly, you have spelled it incorrectly\". –ù–∞ —â–æ —è –≤—ñ–¥–ø–æ–≤—ñ–≤: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\" .\n+\n+/// note | –ü—Ä–∏–º—ñ—Ç–∫–∞\n+\n+LLM, —ñ–º–æ–≤—ñ—Ä–Ω–æ, –ø–µ—Ä–µ–∫–ª–∞–¥–µ —Ü–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –¶—ñ–∫–∞–≤–æ –ª–∏—à–µ, —á–∏ –∑–±–µ—Ä–µ–∂–µ –≤—ñ–Ω –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ –ø—ñ–¥ —á–∞—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∞–Ω–Ω—è.\n+\n+///\n+\n+////\n+\n+//// tab | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+–ê–≤—Ç–æ—Ä prompt –º–æ–∂–µ –≤–∏—Ä—ñ—à–∏—Ç–∏, —á–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ñ –ª–∞–ø–∫–∏ –Ω–∞ —Ç–∏–ø–æ–≥—Ä–∞—Ñ—Å—å–∫—ñ. –ú–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ —è–∫ —î.\n+\n+–î–∏–≤., –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–æ–∑–¥—ñ–ª `### Quotes` —É `docs/de/llm-prompt.md`.\n+\n+////\n+\n+## –õ–∞–ø–∫–∏ —É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥—É { #quotes-in-code-snippets }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+`pip install \"foo[bar]\"`\n+\n+–ü—Ä–∏–∫–ª–∞–¥–∏ —Ä—è–¥–∫–æ–≤–∏—Ö –ª—ñ—Ç–µ—Ä–∞–ª—ñ–≤ —É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥—É: `\"this\"`, `'that'`.\n+\n+–°–∫–ª–∞–¥–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Ä—è–¥–∫–æ–≤–∏—Ö –ª—ñ—Ç–µ—Ä–∞–ª—ñ–≤ —É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥—É: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+–•–∞—Ä–¥–∫–æ—Ä: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+... –û–¥–Ω–∞–∫ –ª–∞–ø–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ –∫–æ–¥—É –º–∞—é—Ç—å –∑–∞–ª–∏—à–∞—Ç–∏—Å—è —è–∫ —î.\n+\n+////\n+\n+## –ë–ª–æ–∫–∏ –∫–æ–¥—É { #code-blocks }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+–ü—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É Bash...\n+\n+\n```\n\n```diff\n@@ -0,0 +1,3 @@\n+# –ü—Ä–æ { #about }\n+\n+–ü—Ä–æ FastAPI, –π–æ–≥–æ –¥–∏–∑–∞–π–Ω, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ —ñ–Ω—à–µ. ü§ì\n\n```\n\n```diff\n@@ -0,0 +1,247 @@\n+# –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ OpenAPI { #additional-responses-in-openapi }\n+\n+/// warning | –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è\n+\n+–¶–µ –¥–æ–≤–æ–ª—ñ –ø—Ä–æ—Å—É–Ω—É—Ç–∞ —Ç–µ–º–∞.\n+\n+–Ø–∫—â–æ –≤–∏ —Ç—ñ–ª—å–∫–∏ –ø–æ—á–∏–Ω–∞—î—Ç–µ –∑ **FastAPI**, –≤–∞–º —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.\n+\n+///\n+\n+–í–∏ –º–æ–∂–µ—Ç–µ –æ–≥–æ–ª–æ—à—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –∫–æ–¥–∞–º–∏ —Å—Ç–∞—Ç—É—Å—É, media types, –æ–ø–∏—Å–∞–º–∏ —Ç–æ—â–æ.\n+\n+–¶—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±—É–¥–µ –≤–∫–ª—é—á–µ–Ω–æ –¥–æ —Å—Ö–µ–º–∏ OpenAPI, —Ç–æ–∂ –≤–æ–Ω–∏ —Ç–∞–∫–æ–∂ –∑‚Äô—è–≤–ª—è—Ç—å—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó API.\n+\n+–ê–ª–µ –¥–ª—è —Ü–∏—Ö –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–∏ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç–µ `Response`, —è–∫-–æ—Ç `JSONResponse`, –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, —ñ–∑ –≤–∞—à–∏–º –∫–æ–¥–æ–º —Å—Ç–∞—Ç—É—Å—É —Ç–∞ –≤–º—ñ—Å—Ç–æ–º.\n+\n+## –î–æ–¥–∞—Ç–∫–æ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —ñ–∑ `model` { #additional-response-with-model }\n+\n+–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç–∏ –≤ *–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É* –ø–∞—Ä–∞–º–µ—Ç—Ä `responses`.\n+\n+–í—ñ–Ω –ø—Ä–∏–π–º–∞—î `dict`: –∫–ª—é—á—ñ ‚Äî —Ü–µ –∫–æ–¥–∏ —Å—Ç–∞—Ç—É—Å—É –¥–ª—è –∫–æ–∂–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `200`), –∞ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî —ñ–Ω—à—ñ `dict` –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –¥–ª—è –∫–æ–∂–Ω–æ—ó –∑ –Ω–∏—Ö.\n+\n+–ö–æ–∂–µ–Ω —ñ–∑ —Ü–∏—Ö `dict` –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –º–æ–∂–µ –º–∞—Ç–∏ –∫–ª—é—á `model`, —â–æ –º—ñ—Å—Ç–∏—Ç—å Pydantic model, —Ç–∞–∫ —Å–∞–º–æ —è–∫ `response_model`.\n+\n+**FastAPI** –≤—ñ–∑—å–º–µ —Ü—é –º–æ–¥–µ–ª—å, –∑–≥–µ–Ω–µ—Ä—É—î —ó—ó JSON Schema —Ç–∞ –≤–∫–ª—é—á–∏—Ç—å —É –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ –≤ OpenAPI.\n+\n+–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ–± –æ–≥–æ–ª–æ—Å–∏—Ç–∏ —â–µ –æ–¥–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å —ñ–∑ –∫–æ–¥–æ–º —Å—Ç–∞—Ç—É—Å—É `404` —ñ Pydantic model `Message`, –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏:\n+\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+\n+/// note | –ü—Ä–∏–º—ñ—Ç–∫–∞\n+\n+–ü–∞–º‚Äô—è—Ç–∞–π—Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `JSONResponse` –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ.\n+\n+///\n+\n+/// info | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+–ö–ª—é—á `model` –Ω–µ —î —á–∞—Å—Ç–∏–Ω–æ—é OpenAPI.\n+\n+**FastAPI** –≤—ñ–∑—å–º–µ Pydantic model –∑–≤—ñ–¥—Ç–∏, –∑–≥–µ–Ω–µ—Ä—É—î JSON Schema —ñ –ø–æ–º—ñ—Å—Ç–∏—Ç—å –π–æ–≥–æ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ.\n+\n+–ü—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ:\n+\n+* –£ –∫–ª—é—á—ñ `content`, –∑–Ω–∞—á–µ–Ω–Ω—è–º —è–∫–æ–≥–æ —î —ñ–Ω—à–∏–π JSON-–æ–±‚Äô—î–∫—Ç (`dict`), —â–æ –º—ñ—Å—Ç–∏—Ç—å:\n+    * –ö–ª—é—á —ñ–∑ media type, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `application/json`, –∑–Ω–∞—á–µ–Ω–Ω—è–º —è–∫–æ–≥–æ —î —ñ–Ω—à–∏–π JSON-–æ–±‚Äô—î–∫—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å:\n+        * –ö–ª—é—á `schema`, –∑–Ω–∞—á–µ–Ω–Ω—è–º —è–∫–æ–≥–æ —î JSON Schema –∑ –º–æ–¥–µ–ª—ñ ‚Äî –æ—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ.\n+            * **FastAPI** –¥–æ–¥–∞—î —Ç—É—Ç", "output": "Changes look good. This PR implements: üåê Update translations for uk (add-missing)", "source": "pr", "type": "code_review", "pr_number": 332}
{"instruction": "Review the following code changes: üåê Update translations for zh (update-outdated)", "input": "```diff\n@@ -1,44 +1,57 @@\n-# OPENAPI ‰∏≠ÁöÑÂÖ∂‰ªñÂìçÂ∫î\n+# OPENAPI ‰∏≠ÁöÑÂÖ∂‰ªñÂìçÂ∫î { #additional-responses-in-openapi }\n \n-ÊÇ®ÂèØ‰ª•Â£∞ÊòéÈôÑÂä†ÂìçÂ∫îÔºåÂåÖÊã¨ÈôÑÂä†Áä∂ÊÄÅ‰ª£Á†Å„ÄÅÂ™í‰ΩìÁ±ªÂûã„ÄÅÊèèËø∞Á≠â„ÄÇ\n+/// warning | Ë≠¶Âëä\n \n-Ëøô‰∫õÈ¢ùÂ§ñÁöÑÂìçÂ∫îÂ∞ÜÂåÖÂê´Âú®OpenAPIÊ®°Âºè‰∏≠ÔºåÂõ†Ê≠§ÂÆÉ‰ª¨‰πüÂ∞ÜÂá∫Áé∞Âú®APIÊñáÊ°£‰∏≠„ÄÇ\n+ËøôÊòØ‰∏Ä‰∏™Áõ∏ÂΩìÈ´òÁ∫ßÁöÑËØùÈ¢ò„ÄÇ\n \n-‰ΩÜÊòØÂØπ‰∫éÈÇ£‰∫õÈ¢ùÂ§ñÁöÑÂìçÂ∫îÔºå‰Ω†ÂøÖÈ°ªÁ°Æ‰øù‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂÉè `JSONResponse` ‰∏ÄÊ†∑ÁöÑ `Response` ÔºåÂπ∂ÂåÖÂê´‰Ω†ÁöÑÁä∂ÊÄÅ‰ª£Á†ÅÂíåÂÜÖÂÆπ„ÄÇ\n+Â¶ÇÊûú‰Ω†ÂàöÂºÄÂßã‰ΩøÁî® **FastAPI**ÔºåÂèØËÉΩ‰∏çÈúÄË¶ÅËøô‰∏™„ÄÇ\n \n-## `model`ÈôÑÂä†ÂìçÂ∫î\n-ÊÇ®ÂèØ‰ª•ÂêëË∑ØÂæÑÊìç‰ΩúË£ÖÈ•∞Âô®‰º†ÈÄíÂèÇÊï∞ `responses` „ÄÇ\n+///\n+\n+‰Ω†ÂèØ‰ª•Â£∞ÊòéÈôÑÂä†ÂìçÂ∫îÔºåÂåÖÊã¨ÈôÑÂä†Áä∂ÊÄÅÁ†Å„ÄÅÂ™í‰ΩìÁ±ªÂûã„ÄÅÊèèËø∞Á≠â„ÄÇ\n+\n+Ëøô‰∫õÈ¢ùÂ§ñÁöÑÂìçÂ∫îÂ∞ÜÂåÖÂê´Âú® OpenAPI schema ‰∏≠ÔºåÂõ†Ê≠§ÂÆÉ‰ª¨‰πüÂ∞ÜÂá∫Áé∞Âú® API ÊñáÊ°£‰∏≠„ÄÇ\n+\n+‰ΩÜÊòØÂØπ‰∫éËøô‰∫õÈ¢ùÂ§ñÁöÑÂìçÂ∫îÔºå‰Ω†ÂøÖÈ°ªÁ°Æ‰øù‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂÉè `JSONResponse` ‰∏ÄÊ†∑ÁöÑ `Response`ÔºåÂπ∂ÂåÖÂê´‰Ω†ÁöÑÁä∂ÊÄÅÁ†ÅÂíåÂÜÖÂÆπ„ÄÇ\n+\n+## ‰ΩøÁî® `model` ÁöÑÈôÑÂä†ÂìçÂ∫î { #additional-response-with-model }\n+\n+‰Ω†ÂèØ‰ª•Âêë‰Ω†ÁöÑ*Ë∑ØÂæÑÊìç‰ΩúË£ÖÈ•∞Âô®*‰º†ÈÄíÂèÇÊï∞ `responses`„ÄÇ\n+\n+ÂÆÉÊé•Êî∂‰∏Ä‰∏™ `dict`ÔºöÈîÆÊòØÊØè‰∏™ÂìçÂ∫îÁöÑÁä∂ÊÄÅÁ†ÅÔºàÂ¶Ç `200`ÔºâÔºåÂÄºÊòØÂåÖÂê´ÊØè‰∏™ÂìçÂ∫î‰ø°ÊÅØÁöÑÂÖ∂‰ªñ `dict`„ÄÇ\n \n-ÂÆÉÊé•Êî∂‰∏Ä‰∏™ `dict`ÔºåÈîÆÊòØÊØè‰∏™ÂìçÂ∫îÁöÑÁä∂ÊÄÅ‰ª£Á†ÅÔºàÂ¶Ç`200`ÔºâÔºåÂÄºÊòØÂåÖÂê´ÊØè‰∏™ÂìçÂ∫î‰ø°ÊÅØÁöÑÂÖ∂‰ªñ `dict`„ÄÇ\n+Ëøô‰∫õÂìçÂ∫î `dict` ‰∏≠ÁöÑÊØè‰∏Ä‰∏™ÈÉΩÂèØ‰ª•Êúâ‰∏Ä‰∏™ÈîÆ `model`ÔºåÂåÖÂê´‰∏Ä‰∏™ Pydantic Ê®°ÂûãÔºåÂ∞±ÂÉè `response_model` ‰∏ÄÊ†∑„ÄÇ\n \n-ÊØè‰∏™ÂìçÂ∫îÂ≠óÂÖ∏ÈÉΩÂèØ‰ª•Êúâ‰∏Ä‰∏™ÂÖ≥ÈîÆÊ®°ÂûãÔºåÂÖ∂‰∏≠ÂåÖÂê´‰∏Ä‰∏™ `Pydantic` Ê®°ÂûãÔºåÂ∞±ÂÉè `response_model` ‰∏ÄÊ†∑„ÄÇ\n+**FastAPI** Â∞ÜÈááÁî®ËØ•Ê®°ÂûãÔºåÁîüÊàêÂÖ∂ JSON Schema Âπ∂Â∞ÜÂÖ∂ÂåÖÂê´Âú® OpenAPI ÁöÑÊ≠£Á°Æ‰ΩçÁΩÆ„ÄÇ\n \n-**FastAPI**Â∞ÜÈááÁî®ËØ•Ê®°ÂûãÔºåÁîüÊàêÂÖ∂`JSON Schema`Âπ∂Â∞ÜÂÖ∂ÂåÖÂê´Âú®`OpenAPI`‰∏≠ÁöÑÊ≠£Á°Æ‰ΩçÁΩÆ„ÄÇ\n+‰æãÂ¶ÇÔºåË¶ÅÂ£∞ÊòéÂè¶‰∏Ä‰∏™ÂÖ∑ÊúâÁä∂ÊÄÅÁ†Å `404` Âíå Pydantic Ê®°Âûã `Message` ÁöÑÂìçÂ∫îÔºå‰Ω†ÂèØ‰ª•ËøôÊ†∑ÂÜôÔºö\n \n-‰æãÂ¶ÇÔºåË¶ÅÂ£∞ÊòéÂè¶‰∏Ä‰∏™ÂÖ∑ÊúâÁä∂ÊÄÅÁ†Å `404` Âíå`Pydantic`Ê®°Âûã `Message` ÁöÑÂìçÂ∫îÔºåÂèØ‰ª•ÂÜôÔºö\n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n-/// note\n+/// note | Ê≥®ÊÑè\n \n-ËØ∑ËÆ∞‰ΩèÔºåÊÇ®ÂøÖÈ°ªÁõ¥Êé•ËøîÂõû `JSONResponse` „ÄÇ\n+ËØ∑ËÆ∞‰ΩèÔºå‰Ω†ÂøÖÈ°ªÁõ¥Êé•ËøîÂõû `JSONResponse`„ÄÇ\n \n ///\n \n-/// info\n+/// info | ‰ø°ÊÅØ\n \n-`model` ÂØÜÈí•‰∏çÊòØOpenAPIÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ\n-**FastAPI**Â∞Ü‰ªéÈÇ£ÈáåËé∑Âèñ`Pydantic`Ê®°ÂûãÔºåÁîüÊàê` JSON Schema` ÔºåÂπ∂Â∞ÜÂÖ∂ÊîæÂú®Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇ\n-- Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆÊòØÔºö\n-    - Âú®ÈîÆ `content` ‰∏≠ÔºåÂÖ∂ÂÖ∑ÊúâÂè¶‰∏Ä‰∏™`JSON`ÂØπË±°Ôºà `dict` Ôºâ‰Ωú‰∏∫ÂÄºÔºåËØ•`JSON`ÂØπË±°ÂåÖÂê´Ôºö\n-        - Â™í‰ΩìÁ±ªÂûãÁöÑÂØÜÈí•Ôºå‰æãÂ¶Ç `application/json` ÔºåÂÆÉÂåÖÂê´Âè¶‰∏Ä‰∏™`JSON`ÂØπË±°‰Ωú‰∏∫ÂÄºÔºåËØ•ÂØπË±°ÂåÖÂê´Ôºö\n-            - ‰∏Ä‰∏™ÈîÆ` schema` ÔºåÂÆÉÁöÑÂÄºÊòØÊù•Ëá™Ê®°ÂûãÁöÑ`JSON Schema`ÔºåÊ≠£Á°ÆÁöÑ‰ΩçÁΩÆÂú®ËøôÈáå„ÄÇ\n-                - **FastAPI**Âú®ËøôÈáåÊ∑ªÂä†‰∫ÜÂØπOpenAPI‰∏≠Âè¶‰∏Ä‰∏™Âú∞ÊñπÁöÑÂÖ®Â±ÄJSONÊ®°ÂºèÁöÑÂºïÁî®ÔºåËÄå‰∏çÊòØÁõ¥Êé•ÂåÖÂê´ÂÆÉ„ÄÇËøôÊ†∑ÔºåÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫èÂíåÂÆ¢Êà∑Á´ØÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ëøô‰∫õJSONÊ®°ÂºèÔºåÊèê‰æõÊõ¥Â•ΩÁöÑ‰ª£Á†ÅÁîüÊàêÂ∑•ÂÖ∑Á≠â„ÄÇ\n+`model` ÈîÆ‰∏çÊòØ OpenAPI ÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ\n+\n+**FastAPI** Â∞Ü‰ªéÈÇ£ÈáåËé∑Âèñ Pydantic Ê®°ÂûãÔºåÁîüÊàê JSON SchemaÔºåÂπ∂Â∞ÜÂÖ∂ÊîæÂú®Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇ\n+\n+Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆÊòØÔºö\n+\n+* Âú®ÈîÆ `content` ‰∏≠ÔºåÂÖ∂ÂÄºÊòØÂè¶‰∏Ä‰∏™ JSON ÂØπË±°Ôºà`dict`ÔºâÔºåÂÆÉÂåÖÂê´Ôºö\n+    * ‰∏Ä‰∏™‰ª•Â™í‰ΩìÁ±ªÂûã‰∏∫ÈîÆÔºà‰æãÂ¶Ç `application/json`ÔºâÁöÑÊù°ÁõÆÔºåÂÖ∂ÂÄºÊòØÂè¶‰∏Ä‰∏™ JSON ÂØπË±°ÔºåÂÆÉÂåÖÂê´Ôºö\n+        * ‰∏Ä‰∏™ÈîÆ `schema`ÔºåÂÖ∂ÂÄºÊòØÊù•Ëá™Ê®°ÂûãÁöÑ JSON SchemaÔºåËøôÈáåÂ∞±ÊòØÊ≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇ\n+            * **FastAPI** Âú®ËøôÈáåÊ∑ªÂä†‰∫ÜÂØπ OpenAPI ‰∏≠Âè¶‰∏Ä‰∏™Âú∞ÊñπÁöÑÂÖ®Â±Ä JSON Schemas ÁöÑÂºïÁî®ÔºåËÄå‰∏çÊòØÁõ¥Êé•ÂåÖÂê´ÂÆÉ„ÄÇËøôÊ†∑ÔºåÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫èÂíåÂÆ¢Êà∑Á´ØÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ëøô‰∫õ JSON SchemasÔºåÊèê‰æõÊõ¥Â•ΩÁöÑ‰ª£Á†ÅÁîüÊàêÂ∑•ÂÖ∑Á≠â„ÄÇ\n \n ///\n \n-**Âú®OpenAPI‰∏≠‰∏∫ËØ•Ë∑ØÂæÑÊìç‰ΩúÁîüÊàêÁöÑÂìçÂ∫îÂ∞ÜÊòØÔºö**\n+‰∏∫ËØ•*Ë∑ØÂæÑÊìç‰Ωú*Âú® OpenAPI ‰∏≠ÁîüÊàêÁöÑÂìçÂ∫îÂ∞ÜÊòØÔºö\n \n-\n```\n\n```diff\n@@ -1,41 +1,41 @@\n-# È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å\n+# È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å { #additional-status-codes }\n \n-**FastAPI** ÈªòËÆ§‰ΩøÁî® `JSONResponse` ËøîÂõû‰∏Ä‰∏™ÂìçÂ∫îÔºåÂ∞Ü‰Ω†ÁöÑ *Ë∑ØÂæÑÊìç‰Ωú* ‰∏≠ÁöÑËøîÂõûÂÜÖÂÆπÊîæÂà∞ËØ• `JSONResponse` ‰∏≠„ÄÇ\n+ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºå**FastAPI** ‰ºö‰ΩøÁî® `JSONResponse` ËøîÂõûÂìçÂ∫îÔºåÊää‰Ω†‰ªé *Ë∑ØÂæÑÊìç‰Ωú* ËøîÂõûÁöÑÂÜÖÂÆπÊîæÂà∞ËØ• `JSONResponse` Èáå„ÄÇ\n \n-**FastAPI** ‰ºöËá™Âä®‰ΩøÁî®ÈªòËÆ§ÁöÑÁä∂ÊÄÅÁ†ÅÊàñËÄÖ‰ΩøÁî®‰Ω†Âú® *Ë∑ØÂæÑÊìç‰Ωú* ‰∏≠ËÆæÁΩÆÁöÑÁä∂ÊÄÅÁ†Å„ÄÇ\n+ÂÆÉ‰ºö‰ΩøÁî®ÈªòËÆ§ÁöÑÁä∂ÊÄÅÁ†ÅÔºåÊàñËÄÖ‰ΩøÁî®‰Ω†Âú® *Ë∑ØÂæÑÊìç‰Ωú* ‰∏≠ËÆæÁΩÆÁöÑÁä∂ÊÄÅÁ†Å„ÄÇ\n \n-## È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å\n+## È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å { #additional-status-codes_1 }\n \n-Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅËøîÂõû‰∏ªË¶ÅÁä∂ÊÄÅÁ†Å‰πãÂ§ñÁöÑÁä∂ÊÄÅÁ†ÅÔºå‰Ω†ÂèØ‰ª•ÈÄöËøáÁõ¥Êé•ËøîÂõû‰∏Ä‰∏™ `Response` Êù•ÂÆûÁé∞ÔºåÊØîÂ¶Ç `JSONResponse`ÔºåÁÑ∂ÂêéÁõ¥Êé•ËÆæÁΩÆÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å„ÄÇ\n+Â¶ÇÊûú‰Ω†ÊÉ≥Âú®‰∏ªË¶ÅÁä∂ÊÄÅÁ†Å‰πãÂ§ñËøîÂõûÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†ÅÔºå‰Ω†ÂèØ‰ª•ÈÄöËøáÁõ¥Êé•ËøîÂõû‰∏Ä‰∏™ `Response` Êù•ÂÆûÁé∞ÔºåÊØîÂ¶Ç `JSONResponse`ÔºåÁÑ∂ÂêéÁõ¥Êé•ËÆæÁΩÆÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å„ÄÇ\n \n-‰æãÂ¶ÇÔºåÂÅáËÆæ‰Ω†ÊÉ≥Êúâ‰∏Ä‰∏™ *Ë∑ØÂæÑÊìç‰Ωú* ËÉΩÂ§üÊõ¥Êñ∞Êù°ÁõÆÔºåÂπ∂‰∏îÊõ¥Êñ∞ÊàêÂäüÊó∂ËøîÂõû 200 „ÄåÊàêÂäü„Äç ÁöÑ HTTP Áä∂ÊÄÅÁ†Å„ÄÇ\n+‰æãÂ¶ÇÔºåÂÅáËÆæ‰Ω†ÊÉ≥Ë¶Å‰∏Ä‰∏™ÂÖÅËÆ∏Êõ¥Êñ∞Êù°ÁõÆÁöÑ *Ë∑ØÂæÑÊìç‰Ωú*ÔºåÂπ∂‰∏îÂú®ÊàêÂäüÊó∂ËøîÂõû 200 ‚ÄúOK‚Äù ÁöÑ HTTP Áä∂ÊÄÅÁ†Å„ÄÇ\n \n-‰ΩÜÊòØ‰Ω†‰πüÂ∏åÊúõÂÆÉËÉΩÂ§üÊé•ÂèóÊñ∞ÁöÑÊù°ÁõÆ„ÄÇÂπ∂‰∏îÂΩìËøô‰∫õÊù°ÁõÆ‰∏çÂ≠òÂú®Êó∂Ôºå‰ºöËá™Âä®ÂàõÂª∫Âπ∂ËøîÂõû 201 „ÄåÂàõÂª∫„ÄçÁöÑ HTTP Áä∂ÊÄÅÁ†Å„ÄÇ\n+‰ΩÜ‰Ω†‰πüÂ∏åÊúõÂÆÉËÉΩÂ§üÊé•ÂèóÊñ∞Êù°ÁõÆ„ÄÇËÄåÂΩìËøô‰∫õÊù°ÁõÆ‰πãÂâç‰∏çÂ≠òÂú®Êó∂ÔºåÂÆÉ‰ºöÂàõÂª∫ÂÆÉ‰ª¨ÔºåÂπ∂ËøîÂõû 201 ‚ÄúCreated‚Äù ÁöÑ HTTP Áä∂ÊÄÅÁ†Å„ÄÇ\n \n-Ë¶ÅÂÆûÁé∞ÂÆÉÔºåÂØºÂÖ• `JSONResponse`ÔºåÁÑ∂ÂêéÂú®ÂÖ∂‰∏≠Áõ¥Êé•ËøîÂõû‰Ω†ÁöÑÂÜÖÂÆπÔºåÂπ∂Â∞Ü `status_code` ËÆæÁΩÆ‰∏∫‰∏∫‰Ω†Ë¶ÅÁöÑÂÄº„ÄÇ\n+Ë¶ÅÂÆûÁé∞Ëøô‰∏ÄÁÇπÔºåÂØºÂÖ• `JSONResponse`ÔºåÂπ∂Áõ¥Êé•Âú®ÂÖ∂‰∏≠ËøîÂõû‰Ω†ÁöÑÂÜÖÂÆπÔºåËÆæÁΩÆ‰Ω†ÊÉ≥Ë¶ÅÁöÑ `status_code`Ôºö\n \n-{* ../../docs_src/additional_status_codes/tutorial001.py hl[4,25] *}\n+{* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n /// warning | Ë≠¶Âëä\n \n-ÂΩì‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂÉè‰∏äÈù¢‰æãÂ≠ê‰∏≠ÁöÑ `Response` ÂØπË±°Êó∂ÔºåÂÆÉ‰ºöÁõ¥Êé•ËøîÂõû„ÄÇ\n+ÂΩì‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ `Response`ÔºàÂ¶Ç‰∏äÈù¢ÁöÑÁ§∫‰æãÔºâÊó∂ÔºåÂÆÉ‰ºöË¢´Áõ¥Êé•ËøîÂõû„ÄÇ\n \n-FastAPI ‰∏ç‰ºöÁî®Ê®°ÂûãÁ≠âÂØπËØ•ÂìçÂ∫îËøõË°åÂ∫èÂàóÂåñ„ÄÇ\n+ÂÆÉ‰∏ç‰ºö‰ΩøÁî®Ê®°ÂûãÁ≠âËøõË°åÂ∫èÂàóÂåñ„ÄÇ\n \n-Á°Æ‰øùÂÖ∂‰∏≠Êúâ‰Ω†ÊÉ≥Ë¶ÅÁöÑÊï∞ÊçÆÔºå‰∏îËøîÂõûÁöÑÂÄº‰∏∫ÂêàÊ≥ïÁöÑ JSONÔºàÂ¶ÇÊûú‰Ω†‰ΩøÁî® `JSONResponse` ÁöÑËØùÔºâ„ÄÇ\n+Á°Æ‰øùÂÆÉÂåÖÂê´‰Ω†Â∏åÊúõÂåÖÂê´ÁöÑÊï∞ÊçÆÔºåÂπ∂‰∏îËøô‰∫õÂÄºÊòØÂêàÊ≥ïÁöÑ JSONÔºàÂ¶ÇÊûú‰Ω†‰ΩøÁî® `JSONResponse` ÁöÑËØùÔºâ„ÄÇ\n \n ///\n \n /// note | ÊäÄÊúØÁªÜËäÇ\n \n-‰Ω†‰πüÂèØ‰ª•‰ΩøÁî® `from starlette.responses import JSONResponse`„ÄÇ„ÄÄ\n+‰Ω†‰πüÂèØ‰ª•‰ΩøÁî® `from starlette.responses import JSONResponse`„ÄÇ\n \n-Âá∫‰∫éÊñπ‰æøÔºå**FastAPI** ‰∏∫ÂºÄÂèëËÄÖÊèê‰æõÂêå `starlette.responses` ‰∏ÄÊ†∑ÁöÑ `fastapi.responses`„ÄÇ‰ΩÜÊòØÂ§ßÂ§öÊï∞ÂèØÁî®ÁöÑÂìçÂ∫îÈÉΩÊòØÁõ¥Êé•Êù•Ëá™ Starlette„ÄÇ`status` ‰πüÊòØ‰∏ÄÊ†∑„ÄÇ\n+**FastAPI** ‰∏∫‰∫ÜÊñπ‰æø‰Ω†ÔºàÂºÄÂèëËÄÖÔºâ‰ΩøÁî®ÔºåÊèê‰æõ‰∫Ü‰∏é `starlette.responses` Áõ∏ÂêåÁöÑ `fastapi.responses`„ÄÇ‰ΩÜÂ§ßÂ§öÊï∞ÂèØÁî®ÁöÑÂìçÂ∫îÈÉΩÁõ¥Êé•Êù•Ëá™ Starlette„ÄÇ`status` ‰πüÊòØ‰∏ÄÊ†∑„ÄÇ\n \n ///\n \n-## OpenAPI Âíå API ÊñáÊ°£\n+## OpenAPI Âíå API ÊñáÊ°£ { #openapi-and-api-docs }\n \n-Â¶ÇÊûú‰Ω†Áõ¥Êé•ËøîÂõûÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†ÅÂíåÂìçÂ∫îÔºåÂÆÉ‰ª¨‰∏ç‰ºöÂåÖÂê´Âú® OpenAPI ÊñπÊ°àÔºàAPI ÊñáÊ°£Ôºâ‰∏≠ÔºåÂõ†‰∏∫ FastAPI Ê≤°ÂäûÊ≥ïÈ¢ÑÂÖàÁü•ÈÅì‰Ω†Ë¶ÅËøîÂõû‰ªÄ‰πà„ÄÇ\n+Â¶ÇÊûú‰Ω†Áõ¥Êé•ËøîÂõûÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†ÅÂíåÂìçÂ∫îÔºåÂÆÉ‰ª¨‰∏ç‰ºöÂåÖÂê´Âú® OpenAPI schemaÔºàAPI ÊñáÊ°£Ôºâ‰∏≠ÔºåÂõ†‰∏∫ FastAPI Ê≤°ÂäûÊ≥ïÈ¢ÑÂÖàÁü•ÈÅì‰Ω†Â∞ÜË¶ÅËøîÂõû‰ªÄ‰πà„ÄÇ\n \n-‰ΩÜÊòØ‰Ω†ÂèØ‰ª•‰ΩøÁî® [È¢ùÂ§ñÁöÑÂìçÂ∫î](additional-responses.md){.internal-link target=_blank} Âú®‰ª£Á†Å‰∏≠ËÆ∞ÂΩïËøô‰∫õÂÜÖÂÆπ„ÄÇ\n+‰ΩÜ‰Ω†ÂèØ‰ª•Âú®‰ª£Á†Å‰∏≠‰ΩøÁî®Ôºö[È¢ùÂ§ñÁöÑÂìçÂ∫î](additional-responses.md){.internal-link target=_blank} Êù•ËÆ∞ÂΩïËøô‰∫õÂÜÖÂÆπ„ÄÇ\n\n```\n\n```diff\n@@ -1,65 +1,163 @@\n-# È´òÁ∫ß‰æùËµñÈ°π\n+# È´òÁ∫ß‰æùËµñÈ°π { #advanced-dependencies }\n \n-## ÂèÇÊï∞ÂåñÁöÑ‰æùËµñÈ°π\n+## ÂèÇÊï∞ÂåñÁöÑ‰æùËµñÈ°π { #parameterized-dependencies }\n \n Êàë‰ª¨‰πãÂâçÁúãÂà∞ÁöÑÊâÄÊúâ‰æùËµñÈ°πÈÉΩÊòØÂÜôÊ≠ªÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n \n-‰ΩÜ‰πüÂèØ‰ª•‰∏∫‰æùËµñÈ°πËÆæÁΩÆÂèÇÊï∞ÔºåÈÅøÂÖçÂ£∞ÊòéÂ§ö‰∏™‰∏çÂêåÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n+‰ΩÜ‰πüÂèØ‰ª•Âú®Êüê‰∫õÊÉÖÂÜµ‰∏ã‰∏∫‰æùËµñÈ°πËÆæÁΩÆÂèÇÊï∞ÔºåËÄåÊó†ÈúÄÂ£∞ÊòéËÆ∏Â§ö‰∏çÂêåÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n \n-ÂÅáËÆæË¶ÅÂàõÂª∫Ê†°È™åÊü•ËØ¢ÂèÇÊï∞ `q` ÊòØÂê¶ÂåÖÂê´Âõ∫ÂÆöÂÜÖÂÆπÁöÑ‰æùËµñÈ°π„ÄÇ\n+ÂÅáËÆæË¶ÅÂàõÂª∫‰∏Ä‰∏™‰æùËµñÈ°πÔºåÁî®Êù•Ê£ÄÊü•Êü•ËØ¢ÂèÇÊï∞ `q` ÊòØÂê¶ÂåÖÂê´Êüê‰∫õÂõ∫ÂÆöÂÜÖÂÆπ„ÄÇ\n \n-‰ΩÜÊ≠§Â§ÑË¶ÅÊääÂæÖÊ£ÄÈ™åÁöÑÂõ∫ÂÆöÂÜÖÂÆπÂÆö‰πâ‰∏∫ÂèÇÊï∞„ÄÇ\n+‰ΩÜÊàë‰ª¨Â∏åÊúõËÉΩÂ§üÂØπËØ•Âõ∫ÂÆöÂÜÖÂÆπËøõË°åÂèÇÊï∞Âåñ„ÄÇ\n \n-## **ÂèØË∞ÉÁî®**ÂÆû‰æã\n+## **ÂèØË∞ÉÁî®**ÂÆû‰æã { #a-callable-instance }\n \n-Python ÂèØ‰ª•ÊääÁ±ªÂÆû‰æãÂèò‰∏∫**ÂèØË∞ÉÁî®È°π**„ÄÇ\n+Python ÂèØ‰ª•ÊääÁ±ªÂÆû‰æãÂèò‰∏∫‚ÄúÂèØË∞ÉÁî®È°π‚Äù„ÄÇ\n \n-ËøôÈáåËØ¥ÁöÑ‰∏çÊòØÁ±ªÊú¨Ë∫´ÔºàÁ±ªÊú¨Â∞±ÊòØÂèØË∞ÉÁî®È°πÔºâÔºåËÄåÊòØÁ±ªÂÆû‰æã„ÄÇ\n+ËøôÈáåËØ¥ÁöÑ‰∏çÊòØÁ±ªÊú¨Ë∫´ÔºàÁ±ªÊú¨Â∞±ÊòØÂèØË∞ÉÁî®È°πÔºâÔºåËÄåÊòØËØ•Á±ªÁöÑÂÆû‰æã„ÄÇ\n \n ‰∏∫Ê≠§ÔºåÈúÄË¶ÅÂ£∞Êòé `__call__` ÊñπÊ≥ïÔºö\n \n-{* ../../docs_src/dependencies/tutorial011.py hl[10] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n \n-Êú¨‰æã‰∏≠Ôºå**Fast", "output": "Changes look good. This PR implements: üåê Update translations for zh (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 331}
{"instruction": "Review the following code changes: üåê Update translations for fr (update-outdated)", "input": "```diff\n@@ -1,55 +1,55 @@\n-# R√©ponses suppl√©mentaires dans OpenAPI\n+# R√©ponses suppl√©mentaires dans OpenAPI { #additional-responses-in-openapi }\n \n-/// warning | Attention\n+/// warning | Alertes\n \n Ceci concerne un sujet plut√¥t avanc√©.\n \n Si vous d√©butez avec **FastAPI**, vous n'en aurez peut-√™tre pas besoin.\n \n ///\n \n-Vous pouvez d√©clarer des r√©ponses suppl√©mentaires, avec des codes HTTP, des types de m√©dias, des descriptions, etc.\n+Vous pouvez d√©clarer des r√©ponses suppl√©mentaires, avec des codes de statut suppl√©mentaires, des types de m√©dias, des descriptions, etc.\n \n Ces r√©ponses suppl√©mentaires seront incluses dans le sch√©ma OpenAPI, elles appara√Ætront donc √©galement dans la documentation de l'API.\n \n-Mais pour ces r√©ponses suppl√©mentaires, vous devez vous assurer de renvoyer directement une `Response` comme `JSONResponse`, avec votre code HTTP et votre contenu.\n+Mais pour ces r√©ponses suppl√©mentaires, vous devez vous assurer de renvoyer directement une `Response` comme `JSONResponse`, avec votre code de statut et votre contenu.\n \n-## R√©ponse suppl√©mentaire avec `model`\n+## R√©ponse suppl√©mentaire avec `model` { #additional-response-with-model }\n \n-Vous pouvez ajouter √† votre d√©corateur de *param√®tre de chemin* un param√®tre `responses`.\n+Vous pouvez passer √† vos *d√©corateurs de chemin d'acc√®s* un param√®tre `responses`.\n \n-Il prend comme valeur un `dict` dont les cl√©s sont des codes HTTP pour chaque r√©ponse, comme `200`, et la valeur de ces cl√©s sont d'autres `dict` avec des informations pour chacun d'eux.\n+Il re√ßoit un `dict` : les cl√©s sont des codes de statut pour chaque r√©ponse (comme `200`), et les valeurs sont d'autres `dict` avec les informations pour chacune d'elles.\n \n Chacun de ces `dict` de r√©ponse peut avoir une cl√© `model`, contenant un mod√®le Pydantic, tout comme `response_model`.\n \n-**FastAPI** prendra ce mod√®le, g√©n√©rera son sch√©ma JSON et l'inclura au bon endroit dans OpenAPI.\n+**FastAPI** prendra ce mod√®le, g√©n√©rera son JSON Schema et l'inclura au bon endroit dans OpenAPI.\n \n-Par exemple, pour d√©clarer une autre r√©ponse avec un code HTTP `404` et un mod√®le Pydantic `Message`, vous pouvez √©crire¬†:\n+Par exemple, pour d√©clarer une autre r√©ponse avec un code de statut `404` et un mod√®le Pydantic `Message`, vous pouvez √©crire :\n \n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n /// note | Remarque\n \n-Gardez √† l'esprit que vous devez renvoyer directement `JSONResponse`.\n+Gardez √† l'esprit que vous devez renvoyer directement le `JSONResponse`.\n \n ///\n \n /// info\n \n La cl√© `model` ne fait pas partie d'OpenAPI.\n \n-**FastAPI** prendra le mod√®le Pydantic √† partir de l√†, g√©n√©rera le `JSON Schema` et le placera au bon endroit.\n+**FastAPI** prendra le mod√®le Pydantic √† partir de l√†, g√©n√©rera le JSON Schema et le placera au bon endroit.\n \n Le bon endroit est :\n \n-* Dans la cl√© `content`, qui a pour valeur un autre objet JSON (`dict`) qui contient¬†:\n-    *\n\n```\n\n```diff\n@@ -1,41 +1,41 @@\n-# Codes HTTP suppl√©mentaires\n+# Codes de statut suppl√©mentaires { #additional-status-codes }\n \n-Par d√©faut, **FastAPI** renverra les r√©ponses √† l'aide d'une structure de donn√©es `JSONResponse`, en pla√ßant la r√©ponse de votre  *chemin d'acc√®s* √† l'int√©rieur de cette `JSONResponse`.\n+Par d√©faut, **FastAPI** renverra les r√©ponses en utilisant une `JSONResponse`, en pla√ßant le contenu que vous renvoyez depuis votre *chemin d'acc√®s* √† l'int√©rieur de cette `JSONResponse`.\n \n-Il utilisera le code HTTP par d√©faut ou celui que vous avez d√©fini dans votre *chemin d'acc√®s*.\n+Il utilisera le code de statut par d√©faut ou celui que vous d√©finissez dans votre *chemin d'acc√®s*.\n \n-## Codes HTTP suppl√©mentaires\n+## Codes de statut suppl√©mentaires { #additional-status-codes_1 }\n \n-Si vous souhaitez renvoyer des codes HTTP suppl√©mentaires en plus du code principal, vous pouvez le faire en renvoyant directement une `Response`, comme une `JSONResponse`, et en d√©finissant directement le code HTTP suppl√©mentaire.\n+Si vous souhaitez renvoyer des codes de statut suppl√©mentaires en plus du code principal, vous pouvez le faire en renvoyant directement une `Response`, comme une `JSONResponse`, et en d√©finissant directement le code de statut suppl√©mentaire.\n \n-Par exemple, disons que vous voulez avoir un *chemin d'acc√®s* qui permet de mettre √† jour les √©l√©ments et renvoie les codes HTTP 200 \"OK\" en cas de succ√®s.\n+Par exemple, disons que vous voulez avoir un *chemin d'acc√®s* qui permet de mettre √† jour des √©l√©ments et renvoie des codes de statut HTTP 200 ¬´ OK ¬ª en cas de succ√®s.\n \n-Mais vous voulez aussi qu'il accepte de nouveaux √©l√©ments. Et lorsque les √©l√©ments n'existaient pas auparavant, il les cr√©e et renvoie un code HTTP de 201 \"Cr√©√©\".\n+Mais vous voulez aussi qu'il accepte de nouveaux √©l√©ments. Et lorsque les √©l√©ments n'existaient pas auparavant, il les cr√©e et renvoie un code de statut HTTP de 201 ¬´ Created ¬ª.\n \n-Pour y parvenir, importez `JSONRe", "output": "Changes look good. This PR implements: üåê Update translations for fr (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 330}
{"instruction": "Review the following code changes: ‚¨áÔ∏è Downgrade LLM translations model to GPT-5 to reduce mistakes", "input": "```diff\n@@ -86,7 +86,7 @@ def translate_page(\n         print(f\"Found existing translation: {out_path}\")\n         old_translation = out_path.read_text(encoding=\"utf-8\")\n     print(f\"Translating {en_path} to {language} ({language_name})\")\n-    agent = Agent(\"openai:gpt-5.2\")\n+    agent = Agent(\"openai:gpt-5\")\n \n     prompt_segments = [\n         general_prompt,\n\n```", "output": "Changes look good. This PR implements: ‚¨áÔ∏è Downgrade LLM translations model to GPT-5 to reduce mistakes", "source": "pr", "type": "code_review", "pr_number": 329}
{"instruction": "Review the following code changes: üî® Update docs and translations scripts, enable Turkish", "input": "```diff\n@@ -325,6 +325,8 @@ extra:\n     name: pt - portugu√™s\n   - link: /ru/\n     name: ru - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫\n+  - link: /tr/\n+    name: tr - T√ºrk√ße\n   - link: /uk/\n     name: uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞\n extra_css:\n\n```\n\n```diff\n@@ -20,14 +20,18 @@\n logging.basicConfig(level=logging.INFO)\n \n SUPPORTED_LANGS = {\n-    \"en\",\n     \"de\",\n+    \"en\",\n     \"es\",\n+    # \"fr\",\n     \"ja\",\n     \"ko\",\n     \"pt\",\n     \"ru\",\n+    \"tr\",\n     \"uk\",\n+    # \"zh\",\n+    # \"zh-hant\",\n }\n \n \n\n```", "output": "Changes look good. This PR implements: üî® Update docs and translations scripts, enable Turkish", "source": "pr", "type": "code_review", "pr_number": 328}
{"instruction": "Fix the following bug: Fix Duplicate OperationId When Using Multiple Methods on Same Route", "input": "## Description\r\n\r\nFixes #13175\r\n\r\nWhen a route is added with multiple HTTP methods using `router.add_api_route(\"/path\", handler, methods=[\"POST\", \"DELETE\"])`, all methods were getting the same auto-generated `operationId` (based only on the first method), causing `UserWarning: Duplicate Operation ID` warnings.\r\n\r\n## Changes\r\n\r\n### Code Fix (`fastapi/openapi/utils.py`)\r\n\r\nModified `get_openapi_operation_metadata()` to append the method name to the `operationId` when:\r\n1. No explicit `operation_id` is provided (uses auto-generated `unique_id`)\r\n2. The route has multiple methods\r\n\r\n```python\r\noperation_id = route.operation_id or route.unique_id\r\n# When a route has multiple methods and uses auto-generated unique_id,\r\n# append the method to make the operation_id unique for each method\r\nif not route.operation_id and len(route.methods) > 1:\r\n    operation_id = f\"{operation_id}_{method.lower()}\"\r\n```\r\n\r\n### Test Cases (`tests/test_generate_unique_id_function.py`)\r\n\r\nAdded 4 new test cases:\r\n- `test_multiple_methods_unique_operation_id` - Verifies POST and DELETE get unique IDs\r\n- `test_three_methods_unique_operation_id` - Verifies 3 methods all get unique IDs\r\n- `test_explicit_operation_id_multiple_methods` - Verifies explicit operation_id still triggers warning (expected behavior)\r\n- `test_single_method_no_extra_suffix` - Verifies single method routes remain unchanged\r\n\r\n## Behavior Changes\r\n\r\n### Before (Bug)\r\n```python\r\nrouter.add_api_route(\"/clear\", clear_endpoint, methods=[\"POST\", \"DELETE\"])\r\n```\r\nGenerated OpenAPI:\r\n```json\r\n{\r\n  \"/clear\": {\r\n    \"post\": {\"operationId\": \"clear_endpoint_clear_post\"},\r\n    \"delete\": {\"operationId\": \"clear_endpoint_clear_post\"}  // ‚ùå Same!\r\n  }\r\n}\r\n```\r\nWarning: `UserWarning: Duplicate Operation ID clear_endpoint_clear_post`\r\n\r\n### After (Fixed)\r\n```python\r\nrouter.add_api_route(\"/clear\", clear_endpoint, methods=[\"POST\", \"DELETE\"])\r\n```\r\nGenerated OpenAPI:\r\n```json\r\n{\r\n  \"/clear\": {\r\n    \"post\": {\"operationId\": \"clear_endpoint_clear_post_post\"},      // ‚úÖ Unique\r\n    \"delete\": {\"operationId\": \"clear_endpoint_clear_post_delete\"}   // ‚úÖ Unique\r\n  }\r\n}\r\n```\r\nNo warnings.\r\n\r\n## Backward Compatibility\r\n\r\n‚úÖ **Single method routes**: Unchanged (no extra suffix added)  \r\n‚úÖ **Explicit `operation_id`**: Respected as-is (user's intentional choice)  \r\n‚ö†Ô∏è **Multiple methods**: Will now get unique operationIds (fixes the bug)\r\n\r\n## Checklist\r\n\r\n- [x] I have read the [contributing guidelines](https://github.com/fastapi/fastapi/blob/master/CONTRIBUTING.md)\r\n- [x] The code follows the style guidelines of this project\r\n- [x] I have performed a self-review of my own code\r\n- [x] I have added tests that prove my fix is effective\r\n- [x] New and existing unit tests pass locally with my changes\r\n- [x] My changes generate no new warnings\r\n\r\n## Related Issue\r\n\r\nCloses #13175", "output": "```diff\n@@ -243,6 +243,10 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    # When a route has multiple methods and uses auto-generated unique_id,\n+    # append the method to make the operation_id unique for each method\n+    if not route.operation_id and len(route.methods) > 1:\n+        operation_id = f\"{operation_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -1645,3 +1645,180 @@ def post_third(item1: Item):\n         ]\n         assert len(duplicate_warnings) > 0\n         assert \"Duplicate Operation ID\" in str(duplicate_warnings[0].message)\n+\n+\n+def test_multiple_methods_unique_operation_id():\n+    \"\"\"\n+    Test that routes with multiple methods get unique operationIds.\n+\n+    This was a bug where all methods on the same route would get the same\n+    operationId (based only on the first method), causing duplicate\n+    operation ID warnings. See https://github.com/fastapi/fastapi/issues/13175\n+    \"\"\"\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    @router.post(\"/clear\")\n+    @router.delete(\"/clear\")\n+    def clear_endpoint():\n+        return {\"message\": \"cleared\"}\n+\n+    app.include_router(router)\n+    client = TestClient(app)\n+\n+    # Call the endpoints to ensure coverage\n+    post_response = client.post(\"/clear\")\n+    assert post_response.status_code == 200\n+    delete_response = client.delete(\"/clear\")\n+    assert delete_response.status_code == 200\n+\n+    # Check no warnings are raised when generating OpenAPI\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+        response = client.get(\"/openapi.json\")\n+\n+        # Should not have any duplicate operation ID warnings\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings) == 0, (\n+            f\"Unexpected duplicate warnings: {duplicate_warnings}\"\n+        )\n+\n+    data = response.json()\n+    paths = data[\"paths\"]\n+\n+    # Verify both methods have unique operationIds\n+    post_op_id = paths[\"/clear\"][\"post\"][\"operationId\"]\n+    delete_op_id = paths[\"/clear\"][\"delete\"][\"operationId\"]\n+\n+    assert post_op_id != delete_op_id, (\n+        f\"POST and DELETE should have different operationIds, got: {post_op_id}\"\n+    )\n+\n+    # Verify the operationIds contain the method suffix\n+    assert post_op_id.endswith(\"_post\"), (\n+        f\"POST operationId should end with '_post', got: {post_op_id}\"\n+    )\n+    assert delete_op_id.endswith(\"_delete\"), (\n+        f\"DELETE operationId should end with '_delete', got: {delete_op_id}\"\n+    )\n+\n+\n+def test_three_methods_unique_operation_id():\n+    \"\"\"Test with three methods on the same route.\"\"\"\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    @router.get(\"/items\")\n+    @router.put(\"/items\")\n+    @router.patch(\"/items\")\n+    def item_handler():\n+        return {\"message\": \"items\"}\n+\n+    app.include_router(router)\n+    client = TestClient(app)\n+\n+    # Call the endpoints to ensure coverage\n+    get_response = client.get(\"/items\")\n+    assert get_response.status_code == 200\n+    put_response = client.put(\"/items\")\n+    assert put_response.status_code == 200\n+    patch_response = client.patch(\"/items\")\n+    assert patch_response.status_code == 200\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+      \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 327}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -243,6 +243,10 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    # When a route has multiple methods and uses auto-generated unique_id,\n+    # append the method to make the operation_id unique for each method\n+    if not route.operation_id and len(route.methods) > 1:\n+        operation_id = f\"{operation_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -1645,3 +1645,180 @@ def post_third(item1: Item):\n         ]\n         assert len(duplicate_warnings) > 0\n         assert \"Duplicate Operation ID\" in str(duplicate_warnings[0].message)\n+\n+\n+def test_multiple_methods_unique_operation_id():\n+    \"\"\"\n+    Test that routes with multiple methods get unique operationIds.\n+\n+    This was a bug where all methods on the same route would get the same\n+    operationId (based only on the first method), causing duplicate\n+    operation ID warnings. See https://github.com/fastapi/fastapi/issues/13175\n+    \"\"\"\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    @router.post(\"/clear\")\n+    @router.delete(\"/clear\")\n+    def clear_endpoint():\n+        return {\"message\": \"cleared\"}\n+\n+    app.include_router(router)\n+    client = TestClient(app)\n+\n+    # Call the endpoints to ensure coverage\n+    post_response = client.post(\"/clear\")\n+    assert post_response.status_code == 200\n+    delete_response = client.delete(\"/clear\")\n+    assert delete_response.status_code == 200\n+\n+    # Check no warnings are raised when generating OpenAPI\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+        response = client.get(\"/openapi.json\")\n+\n+        # Should not have any duplicate operation ID warnings\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings) == 0, (\n+            f\"Unexpected duplicate warnings: {duplicate_warnings}\"\n+        )\n+\n+    data = response.json()\n+    paths = data[\"paths\"]\n+\n+    # Verify both methods have unique operationIds\n+    post_op_id = paths[\"/clear\"][\"post\"][\"operationId\"]\n+    delete_op_id = paths[\"/clear\"][\"delete\"][\"operationId\"]\n+\n+    assert post_op_id != delete_op_id, (\n+        f\"POST and DELETE should have different operationIds, got: {post_op_id}\"\n+    )\n+\n+    # Verify the operationIds contain the method suffix\n+    assert post_op_id.endswith(\"_post\"), (\n+        f\"POST operationId should end with '_post', got: {post_op_id}\"\n+    )\n+    assert delete_op_id.endswith(\"_delete\"), (\n+        f\"DELETE operationId should end with '_delete', got: {delete_op_id}\"\n+    )\n+\n+\n+def test_three_methods_unique_operation_id():\n+    \"\"\"Test with three methods on the same route.\"\"\"\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    @router.get(\"/items\")\n+    @router.put(\"/items\")\n+    @router.patch(\"/items\")\n+    def item_handler():\n+        return {\"message\": \"items\"}\n+\n+    app.include_router(router)\n+    client = TestClient(app)\n+\n+    # Call the endpoints to ensure coverage\n+    get_response = client.get(\"/items\")\n+    assert get_response.status_code == 200\n+    put_response = client.put(\"/items\")\n+    assert put_response.status_code == 200\n+    patch_response = client.patch(\"/items\")\n+    assert patch_response.status_code == 200\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+      \n\n```", "output": "Bug: Fix Duplicate OperationId When Using Multiple Methods on Same Route\n\n## Description\r\n\r\nFixes #13175\r\n\r\nWhen a route is added with multiple HTTP methods using `router.add_api_route(\"/path\", handler, methods=[\"POST\", \"DELETE\"])`, all methods were getting the same auto-generated `operationId` (based only on the first method), causing `UserWarning: Duplicate Operation ID` warnings.\r\n\r\n## Changes\r\n\r\n### Code Fix (`fastapi/openapi/utils.py`)\r\n\r\nModified `get_openapi_operation_metadata()` to append the method name to the `operationId` when:\r\n1. No explicit `operation_id` is provided (uses auto-generated `unique_id`)\r\n2. The route has multiple methods\r\n\r\n```python\r\noperation_id = route.operation_id or route.unique_id\r\n# When a route has multiple methods and uses auto-generated unique_id,\r\n# append the method to make the operation_id unique for each method\r\nif not route.operation_id and len(route.methods) > 1:\r\n    operation_id = f\"{operation_id}_{method.lower()}\"\r\n```\r\n\r\n### Test Cases (`tests/test_generate_unique_id_function.py`)\r\n\r\nAdded 4 new test cases:\r\n- `test_multiple_methods_unique_operation_id` - Verifies POST and DELETE get unique IDs\r\n- `test_three_methods_unique_operation_id` - Verifies 3 methods all get unique IDs\r\n- `test_explicit_operation_id_multiple_methods` - Verifies explicit operation_id still triggers warning (expected behavior)\r\n- `test_single_method_no_extra_suffix` - Verifies single method routes remain unchanged\r\n\r\n## Behavior Changes\r\n\r\n### Before (Bug)\r\n```python\r\nrouter.add_api_route(\"/clear\", clear_endpoint, methods=[\"POST\", \"DELETE\"])\r\n```\r\nGenerated OpenAPI:\r\n```json\r\n{\r\n  \"/clear\": {\r\n    \"post\": {\"operationId\": \"clear_endpoint_clear_post\"},\r\n    \"delete\": {\"operationId\": \"clear_endpoint_clear_post\"}  // ‚ùå Same!\r\n  }\r\n}\r\n```\r\nWarning: `UserWarning: Duplicate Operation ID clear_endpoint_clear_post`\r\n\r\n### After (Fixed)\r\n```python\r\nrouter.add_api_route(\"/clear\", clear_endpoint, methods=[\"POST\", \"DELETE\"])\r\n```\r\nGenerated OpenAPI:\r\n```json\r\n{\r\n  \"/clear\": {\r\n    \"post\": {\"operationId\": \"clear_endpoint_clear_post_post\"},      // ‚úÖ Unique\r\n    \"delete\": {\"operationId\": \"clear_endpoint_clear_post_delete\"}   // ‚úÖ Unique\r\n  }\r\n}\r\n```\r\nNo warnings.\r\n\r\n## Backward Compatibility\r\n\r\n‚úÖ **Single method routes**: Unchanged (no extra suffix added)  \r\n‚úÖ **Explicit `operation_id`**: Respected as-is (user's intentional choice)  \r\n‚ö†Ô∏è **Multiple methods**: Will now get unique operationIds (fixes the bug)\r\n\r\n## Checklist\r\n\r\n- [x] I have read the [contributing guidelines](https://github.com/fastapi/fastapi/blob/master/CONTRIBUTING.md)\r\n- [x] The code follows the style guidelines of this project\r\n- [x] I have performed a self-review of my own code\r\n- [x] I have added tests that prove my fix is effective\r\n- [x] New and existing unit tests pass locally with my changes\r\n- [x] My changes generate no new warnings\r\n\r\n## Related Issue\r\n\r\nCloses #13175", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 327}
{"instruction": "Review the following code changes: Fix Duplicate OperationId When Using Multiple Methods on Same Route", "input": "```diff\n@@ -243,6 +243,10 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    # When a route has multiple methods and uses auto-generated unique_id,\n+    # append the method to make the operation_id unique for each method\n+    if not route.operation_id and len(route.methods) > 1:\n+        operation_id = f\"{operation_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -1645,3 +1645,180 @@ def post_third(item1: Item):\n         ]\n         assert len(duplicate_warnings) > 0\n         assert \"Duplicate Operation ID\" in str(duplicate_warnings[0].message)\n+\n+\n+def test_multiple_methods_unique_operation_id():\n+    \"\"\"\n+    Test that routes with multiple methods get unique operationIds.\n+\n+    This was a bug where all methods on the same route would get the same\n+    operationId (based only on the first method), causing duplicate\n+    operation ID warnings. See https://github.com/fastapi/fastapi/issues/13175\n+    \"\"\"\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    @router.post(\"/clear\")\n+    @router.delete(\"/clear\")\n+    def clear_endpoint():\n+        return {\"message\": \"cleared\"}\n+\n+    app.include_router(router)\n+    client = TestClient(app)\n+\n+    # Call the endpoints to ensure coverage\n+    post_response = client.post(\"/clear\")\n+    assert post_response.status_code == 200\n+    delete_response = client.delete(\"/clear\")\n+    assert delete_response.status_code == 200\n+\n+    # Check no warnings are raised when generating OpenAPI\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+        response = client.get(\"/openapi.json\")\n+\n+        # Should not have any duplicate operation ID warnings\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings) == 0, (\n+            f\"Unexpected duplicate warnings: {duplicate_warnings}\"\n+        )\n+\n+    data = response.json()\n+    paths = data[\"paths\"]\n+\n+    # Verify both methods have unique operationIds\n+    post_op_id = paths[\"/clear\"][\"post\"][\"operationId\"]\n+    delete_op_id = paths[\"/clear\"][\"delete\"][\"operationId\"]\n+\n+    assert post_op_id != delete_op_id, (\n+        f\"POST and DELETE should have different operationIds, got: {post_op_id}\"\n+    )\n+\n+    # Verify the operationIds contain the method suffix\n+    assert post_op_id.endswith(\"_post\"), (\n+        f\"POST operationId should end with '_post', got: {post_op_id}\"\n+    )\n+    assert delete_op_id.endswith(\"_delete\"), (\n+        f\"DELETE operationId should end with '_delete', got: {delete_op_id}\"\n+    )\n+\n+\n+def test_three_methods_unique_operation_id():\n+    \"\"\"Test with three methods on the same route.\"\"\"\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    @router.get(\"/items\")\n+    @router.put(\"/items\")\n+    @router.patch(\"/items\")\n+    def item_handler():\n+        return {\"message\": \"items\"}\n+\n+    app.include_router(router)\n+    client = TestClient(app)\n+\n+    # Call the endpoints to ensure coverage\n+    get_response = client.get(\"/items\")\n+    assert get_response.status_code == 200\n+    put_response = client.put(\"/items\")\n+    assert put_response.status_code == 200\n+    patch_response = client.patch(\"/items\")\n+    assert patch_response.status_code == 200\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+      \n\n```", "output": "Changes look good. This PR implements: Fix Duplicate OperationId When Using Multiple Methods on Same Route", "source": "pr", "type": "code_review", "pr_number": 327}
{"instruction": "Review the following code changes: üåê Update translations for zh-hant (update-outdated)", "input": "```diff\n@@ -1,3 +1,3 @@\n-# ÈóúÊñº FastAPI\n+# ÈóúÊñº { #about }\n \n ÈóúÊñº FastAPI„ÄÅÂÖ∂Ë®≠Ë®à„ÄÅÈùàÊÑü‰æÜÊ∫êÁ≠âÊõ¥Â§öË≥áË®ä„ÄÇ ü§ì\n\n```\n\n```diff\n@@ -1,10 +1,10 @@\n-# Âü∫Ê∫ñÊ∏¨Ë©¶\n+# Âü∫Ê∫ñÊ∏¨Ë©¶ { #benchmarks }\n \n Áî±Á¨¨‰∏âÊñπÊ©üÊßã TechEmpower ÁöÑÂü∫Ê∫ñÊ∏¨Ë©¶Ë°®ÊòéÂú® Uvicorn ‰∏ãÈÅãË°åÁöÑ **FastAPI** ÊáâÁî®Á®ãÂºèÊòØ <a href=\"https://www.techempower.com/benchmarks/#section=test&runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&hw=ph&test=query&l=zijzen-7\" class=\"external-link\" target=\"_blank\">ÊúÄÂø´ÁöÑ Python ÂèØÁî®Ê°ÜÊû∂‰πã‰∏Ä</a>ÔºåÂÉÖÊ¨°Êñº Starlette Âíå Uvicorn Êú¨Ë∫´ÔºàÊñº FastAPI ÂÖßÈÉ®‰ΩøÁî®Ôºâ„ÄÇ\n \n ‰ΩÜÊòØÂú®Êü•ÁúãÂü∫Ê∫ñÂæóÂàÜÂíåÂ∞çÊØîÊôÇÔºåË´ãÊ≥®ÊÑè‰ª•‰∏ãÂπæÈªû„ÄÇ\n \n-## Âü∫Ê∫ñÊ∏¨Ë©¶ÂíåÈÄüÂ∫¶\n+## Âü∫Ê∫ñÊ∏¨Ë©¶ËàáÈÄüÂ∫¶ { #benchmarks-and-speed }\n \n Áï∂‰Ω†Êü•ÁúãÂü∫Ê∫ñÊ∏¨Ë©¶ÊôÇÔºåÊôÇÂ∏∏ÊúÉË¶ãÂà∞ÂπæÂÄã‰∏çÂêåÈ°ûÂûãÁöÑÂ∑•ÂÖ∑Ë¢´ÂêåÊôÇÈÄ≤Ë°åÊ∏¨Ë©¶„ÄÇ\n \n@@ -28,7 +28,7 @@\n     * Â¶ÇÊûú‰Ω†Ë¶ÅÊØîËºÉ StarletteÔºåË´ãÂ∞áÂÖ∂Ëàá Sanic„ÄÅFlask„ÄÅDjango Á≠âÁ∂≤È†ÅÊ°ÜÊû∂ÔºàÊàñÂæÆÊ°ÜÊû∂ÔºâÈÄ≤Ë°åÊØîËºÉ„ÄÇ\n * **FastAPI**Ôºö\n     * Â∞±ÂÉè Starlette ‰ΩøÁî® Uvicorn ‰∏¶‰∏çËÉΩÊØîÂÆÉÊõ¥Âø´‰∏ÄÊ®£Ôºå **FastAPI** ‰ΩøÁî® StarletteÔºåÊâÄ‰ª•ÂÆÉ‰∏çËÉΩÊØîÂÆÉÊõ¥Âø´„ÄÇ\n-    * FastAPI Âú® Starlette Âü∫Á§é‰πã‰∏äÊèê‰æõ‰∫ÜÊõ¥Â§öÂäüËÉΩ„ÄÇÂåÖÂê´Âª∫Êßã API ÊôÇÊâÄÈúÄË¶ÅÁöÑÂäüËÉΩÔºå‰æãÂ¶ÇË≥áÊñôÈ©óË≠âÂíåÂ∫èÂàóÂåñ„ÄÇFastAPI ÂèØ‰ª•Âπ´Âä©‰Ω†Ëá™ÂãïÁî¢Áîü API Êñá‰ª∂ÔºåÔºàÊáâÁî®Á®ãÂºèÂïüÂãïÊôÇÂ∞áÊúÉËá™ÂãïÁîüÊàêÊñá‰ª∂ÔºåÊâÄ‰ª•‰∏çÊúÉÂ¢ûÂä†ÊáâÁî®Á®ãÂºèÈÅãË°åÊôÇÁöÑÈñãÈä∑Ôºâ„ÄÇ\n+    * FastAPI Âú® Starlette Âü∫Á§é‰πã‰∏äÊèê‰æõ‰∫ÜÊõ¥Â§öÂäüËÉΩ„ÄÇÂåÖÂê´Âª∫Êßã API ÊôÇÊâÄÈúÄË¶ÅÁöÑÂäüËÉΩÔºå‰æãÂ¶ÇË≥áÊñôÈ©óË≠âÂíåÂ∫èÂàóÂåñ„ÄÇ‰∏¶‰∏î‰ΩøÁî®ÂÆÉÊôÇÔºå‰Ω†ÂèØ‰ª•ÂÖçË≤ªÁç≤ÂæóËá™ÂãïÊñá‰ª∂ÔºàËá™ÂãïÊñá‰ª∂ÁîöËá≥‰∏çÊúÉÂ¢ûÂä†ÈÅãË°å‰∏≠ÊáâÁî®Á®ãÂºèÁöÑÈñãÈä∑ÔºåÂÆÉÊòØÂú®ÂïüÂãïÊôÇÁî¢ÁîüÁöÑÔºâ„ÄÇ\n     * Â¶ÇÊûú‰Ω†Ê≤íÊúâ‰ΩøÁî® FastAPI ËÄåÊòØÁõ¥Êé•‰ΩøÁî® StarletteÔºàÊàñÂÖ∂‰ªñÂ∑•ÂÖ∑ÔºåÂ¶Ç Sanic„ÄÅFlask„ÄÅResponder Á≠âÔºâÔºå‰Ω†Â∞áÂøÖÈ†àËá™Ë°åÂØ¶ÁèæÊâÄÊúâË≥áÊñôÈ©óË≠âÂíåÂ∫èÂàóÂåñ„ÄÇÂõ†Ê≠§Ôºå‰Ω†ÁöÑÊúÄÁµÇÊáâÁî®Á®ãÂºè‰ªçÁÑ∂ÂÖ∑ÊúâËàá‰ΩøÁî® FastAPI Âª∫ÁΩÆÁõ∏ÂêåÁöÑÈñãÈä∑„ÄÇÂú®Ë®±Â§öÊÉÖÊ≥Å‰∏ãÔºåÈÄôÁ®ÆË≥áÊñôÈ©óË≠âÂíåÂ∫èÂàóÂåñÊòØÊáâÁî®Á®ãÂºè‰∏≠Á∑®ÂØ´ÊúÄÂ§ßÈáèÁöÑÁ®ãÂºèÁ¢º„ÄÇ\n-    * Âõ†Ê≠§ÈÄèÈÅé‰ΩøÁî® FastAPIÔºå‰Ω†ÂèØ‰ª•ÁØÄÁúÅÈñãÁôºÊôÇÈñì„ÄÅÈåØË™§ËàáÁ®ãÂºèÁ¢ºÊï∏ÈáèÔºå‰∏¶‰∏îÁõ∏ÊØî‰∏ç‰ΩøÁî® FastAPI ‰Ω†ÂæàÂ§ßÂèØËÉΩÊúÉÁç≤ÂæóÁõ∏ÂêåÊàñÊõ¥Â•ΩÁöÑÊïàËÉΩÔºàÂõ†ÁÇ∫ÈÇ£Ê®£‰Ω†ÂøÖÈ†àÂú®Á®ãÂºèÁ¢º‰∏≠ÂØ¶ÁèæÊâÄÊúâÁõ∏ÂêåÁöÑÂäüËÉΩÔºâ„ÄÇ\n-    * Â¶ÇÊûú‰Ω†Ë¶ÅËàá FastAPI ÊØîËºÉÔºåË´ãÂ∞áÂÖ∂ËàáËÉΩÂ§†Êèê‰æõË≥áÊñôÈ©óË≠â„ÄÅÂ∫èÂàóÂåñÂíåÊñá‰ª∂ÁöÑÁ∂≤È†ÅÊáâÁî®Á®ãÂºèÊ°ÜÊû∂ÔºàÊàñÂ∑•ÂÖ∑ÈõÜÔºâÈÄ≤Ë°åÊØîËºÉÔºå‰æãÂ¶Ç Flask-apispec„ÄÅNestJS„ÄÅMolten Á≠âÊ°ÜÊû∂„ÄÇ\n+    * Âõ†Ê≠§ÈÄèÈÅé‰ΩøÁî® FastAPIÔºå‰Ω†ÂèØ‰ª•ÁØÄÁúÅÈñãÁôºÊôÇÈñì„ÄÅÈåØË™§ËàáÁ®ãÂºèÁ¢ºÊï∏ÈáèÔºå‰∏¶‰∏î‰Ω†ÂæàÂèØËÉΩÊúÉÁç≤ÂæóËàá‰∏ç‰ΩøÁî®ÂÆÉÊôÇÁõ∏ÂêåÁöÑÊïàËÉΩÔºàÊàñÊõ¥Â•ΩÔºâÔºàÂõ†ÁÇ∫ÈÇ£Ê®£‰Ω†ÂøÖÈ†àÂú®Á®ãÂºèÁ¢º‰∏≠ÂØ¶ÁèæÊâÄÊúâÂäüËÉΩÔºâ„ÄÇ\n+    * Â¶ÇÊûú‰Ω†Ë¶ÅËàá FastAPI ÊØîËºÉÔºåË´ãÂ∞áÂÖ∂ËàáËÉΩÂ§†Êèê‰æõË≥áÊñôÈ©óË≠â„ÄÅÂ∫èÂàóÂåñÂíåÊñá‰ª∂ÁöÑÁ∂≤È†ÅÊáâÁî®Á®ãÂºèÊ°ÜÊû∂ÔºàÊàñÂ∑•ÂÖ∑ÈõÜÔºâÈÄ≤Ë°åÊØîËºÉÔºå‰æãÂ¶Ç Flask-apispec„ÄÅNestJS„ÄÅMolten Á≠â„ÄÇÂÖ∑ÂÇôÊï¥ÂêàÂºèËá™ÂãïË≥áÊñôÈ©óË≠â„ÄÅÂ∫èÂàóÂåñÂíåÊñá‰ª∂ÁöÑÊ°ÜÊû∂„ÄÇ\n\n```\n\n```diff\n@@ -1,13 +1,24 @@\n-# Âú®Èõ≤Á´ØÈÉ®ÁΩ≤ FastAPI\n+# Âú®Èõ≤Á´Ø‰æõÊáâÂïÜ‰∏äÈÉ®ÁΩ≤ FastAPI { #deploy-fastapi-on-cloud-providers }\n \n ‰Ω†Âπæ‰πéÂèØ‰ª•‰ΩøÁî®**‰ªª‰ΩïÈõ≤Á´Ø‰æõÊáâÂïÜ**‰æÜÈÉ®ÁΩ≤‰Ω†ÁöÑ FastAPI ÊáâÁî®Á®ãÂºè„ÄÇ\n \n-Âú®Â§ßÂ§öÊï∏ÊÉÖÊ≥Å‰∏ãÔºå‰∏ªË¶ÅÁöÑÈõ≤Á´Ø‰æõÊáâÂïÜÈÉΩÊúâÈÉ®ÁΩ≤ FastAPI ÁöÑÊåáÂçó„ÄÇ\n+Âú®Â§ßÂ§öÊï∏ÊÉÖÊ≥Å‰∏ãÔºå‰∏ªË¶ÅÁöÑÈõ≤Á´Ø‰æõÊáâÂïÜÈÉΩÊúâ‰ΩøÁî®ÂÖ∂ÊúçÂãôÈÉ®ÁΩ≤ FastAPI ÁöÑÊåáÂçó„ÄÇ\n \n-## Èõ≤Á´Ø‰æõÊáâÂïÜ - Ë¥äÂä©ÂïÜ\n+## FastAPI Cloud { #fastapi-cloud }\n \n-‰∏Ä‰∫õÈõ≤Á´Ø‰æõÊáâÂïÜ ‚ú® [**Ë¥äÂä© FastAPI**](../help-fastapi.md#sponsor-the-author){.internal-link target=_blank} ‚ú®ÔºåÈÄôÁ¢∫‰øù‰∫Ü FastAPI ÂèäÂÖ∂**ÁîüÊÖãÁ≥ªÁµ±**ÊåÅÁ∫åÂÅ•Â∫∑Âú∞**ÁôºÂ±ï**„ÄÇ\n+**<a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">FastAPI Cloud</a>** Áî±ÊâìÈÄ† **FastAPI** ÁöÑÂêå‰∏Ä‰Ωç‰ΩúËÄÖËàáÂúòÈöäÊâÄÂª∫ÁΩÆ„ÄÇ\n \n-ÈÄô‰πüÂ±ïÁèæ‰∫Ü‰ªñÂÄëÂ∞ç FastAPI ÂíåÂÖ∂**Á§æÁæ§**ÔºàÂåÖÊã¨‰Ω†ÔºâÁöÑÁúüÊ≠£ÊâøË´æÔºå‰ªñÂÄë‰∏çÂÉÖÂ∏åÊúõÁÇ∫‰Ω†Êèê‰æõ**ÂÑ™Ë≥™ÁöÑÊúçÂãô**ÔºåÈÇÑÂ∏åÊúõÁ¢∫‰øù‰Ω†ÊìÅÊúâ‰∏ÄÂÄã**ËâØÂ•Ω‰∏îÂÅ•Â∫∑ÁöÑÊ°ÜÊû∂**ÔºöFastAPI„ÄÇüôá\n+ÂÆÉ‰ª•ÊúÄÂ∞ëÁöÑÁ≤æÂäõÔºåÁ∞°Âåñ **Âª∫ÁΩÆ**„ÄÅ**ÈÉ®ÁΩ≤** Ëàá**Â≠òÂèñ** API ÁöÑÊµÅÁ®ã„ÄÇ\n \n-‰Ω†ÂèØËÉΩÊúÉÊÉ≥ÂòóË©¶‰ªñÂÄëÁöÑÊúçÂãôÔºå‰ª•‰∏ãÊúâ‰ªñÂÄëÁöÑÊåáÂçó.\n+ÂÆÉÂ∞á‰ΩøÁî® FastAPI Âª∫ÁΩÆÊáâÁî®Á®ãÂºèÊôÇÁöÑÁõ∏Âêå**ÈñãÁôºËÄÖÈ´îÈ©ó**Â∏∂Âà∞Â∞áÂÆÉÂÄë**ÈÉ®ÁΩ≤**Âà∞Èõ≤Á´ØÁöÑÈÅéÁ®ã„ÄÇüéâ\n+\n+FastAPI Cloud ÊòØ *FastAPI and friends* ÈñãÊ∫êÂ∞àÊ°àÁöÑ‰∏ªË¶ÅË¥äÂä©ÂïÜËàáË≥áÈáëÊèê‰æõËÄÖ„ÄÇ‚ú®\n+\n+## Èõ≤Á´Ø‰æõÊáâÂïÜ - Ë¥äÂä©ÂïÜ { #cloud-providers-sponsors }\n+\n+‰∏Ä‰∫õÂÖ∂‰ªñÈõ≤Á´Ø‰æõÊáâÂïÜ‰πü ‚ú® [**Ë¥äÂä© FastAPI**](../help-fastapi.md#sponsor-the-author){.internal-link target=_blank} ‚ú®„ÄÇüôá\n+\n+‰Ω†‰πüÂèØ‰ª•ËÄÉÊÖÆ‰ªñÂÄëÔºåË∑üËëó‰ªñÂÄëÁöÑÊåáÂçó‰∏¶ÂòóË©¶‰ªñÂÄëÁöÑÊúçÂãôÔºö\n+\n+* <a href=\"https://docs.render.com/deploy-fastapi?utm_source=deploydoc&utm_medium=referral&utm_campaign=fastapi\" class=\"external-link\" target=\"_blank\">Render</a>\n+* <a href=\"https://docs.railway.com/guides/fastapi?utm_medium=integration&utm_source=docs&utm_campaign=fastapi\" class=\"external-link\" target=\"_blank\">Railway</a>\n\n```\n\n```diff\n@@ -1,21 +1,23 @@\n-# ÈÉ®ÁΩ≤\n+# ÈÉ®ÁΩ≤ { #deployment }\n \n ÈÉ®ÁΩ≤ **FastAPI** ÊáâÁî®Á®ãÂºèÁõ∏Â∞çÂÆπÊòì„ÄÇ\n \n-## ÈÉ®ÁΩ≤ÊòØ‰ªÄÈ∫ºÊÑèÊÄù\n+## ÈÉ®ÁΩ≤ÊòØ‰ªÄÈ∫ºÊÑèÊÄù { #what-does-deployment-mean }\n \n-**ÈÉ®ÁΩ≤**ÊáâÁî®Á®ãÂºèÊåáÁöÑÊòØÂü∑Ë°å‰∏ÄÁ≥ªÂàóÂøÖË¶ÅÁöÑÊ≠•È©üÔºå‰ΩøÂÖ∂ËÉΩÂ§†**ËÆì‰ΩøÁî®ËÄÖÂ≠òÂèñÂíå‰ΩøÁî®**„ÄÇ\n+**ÈÉ®ÁΩ≤**ÊáâÁî®Á®ãÂºèÊåáÁöÑÊòØÂü∑Ë°åÂøÖË¶ÅÁöÑÊ≠•È©üÔºå‰ΩøÂÖ∂ËÉΩÂ§†**ËÆì‰ΩøÁî®ËÄÖÂ≠òÂèñÂíå‰ΩøÁî®**„ÄÇ\n \n-Â∞çÊñº‰∏ÄÂÄã **Web API**ÔºåÈÉ®ÁΩ≤ÈÄöÂ∏∏Ê∂âÂèäÂ∞áÂÖ∂ÊîæÁΩÆÂú®**ÈÅ†Á´Ø‰º∫ÊúçÂô®**‰∏äÔºå‰∏¶‰ΩøÁî®ÊÄßËÉΩÂÑ™ËâØ‰∏îÁ©©ÂÆöÁöÑ**‰º∫ÊúçÂô®Á®ãÂºè**ÔºåÁ¢∫‰øù‰ΩøÁî®ËÄÖËÉΩÂ§†È´òÊïà„ÄÅÁÑ°‰∏≠Êñ∑Âú∞Â≠òÂèñÊáâÁî®Á®ãÂºèÔºå‰∏î‰∏çÊúÉÈÅáÂà∞ÂïèÈ°å„ÄÇ\n+Â∞çÊñº **Web API**ÔºåÈÉ®ÁΩ≤ÈÄöÂ∏∏Ê∂âÂèäÂ∞áÂÖ∂ÊîæÁΩÆÂú®**ÈÅ†Á´ØÊ©üÂô®**‰∏äÔºå‰∏¶Êê≠ÈÖçÂÖ∑ÂÇôËâØÂ•ΩÊïàËÉΩ„ÄÅÁ©©ÂÆöÊÄßÁ≠âÁöÑ**‰º∫ÊúçÂô®Á®ãÂºè**ÔºåËÆì‰Ω†ÁöÑ**‰ΩøÁî®ËÄÖ**ËÉΩÂ§†È´òÊïà‰∏î‰∏ç‰∏≠Êñ∑Êàñ‰∏çÈÅáÂà∞ÂïèÈ°åÂú∞**Â≠òÂèñ**ÊáâÁî®Á®ãÂºè„ÄÇ\n \n-ÈÄôËàá**ÈñãÁôº**ÈöéÊÆµÂΩ¢ÊàêÈÆÆÊòéÂ∞çÊØîÔºåÂú®**ÈñãÁôº**ÈöéÊÆµÔºå‰Ω†ÊúÉ‰∏çÊñ∑Êõ¥ÊîπÁ®ãÂºèÁ¢º„ÄÅÁ†¥Â£ûÁ®ãÂºèÁ¢º„ÄÅ‰øÆÂæ©Á®ãÂºèÁ¢ºÔºåÁÑ∂ÂæåÂÅúÊ≠¢ÂíåÈáçÊñ∞ÂïüÂãï‰º∫ÊúçÂô®Á≠â„ÄÇ\n+ÈÄôËàá**ÈñãÁôº**ÈöéÊÆµÂΩ¢ÊàêÂ∞çÊØîÔºöÂú®**ÈñãÁôº**ÈöéÊÆµÔºå‰Ω†ÊúÉ‰∏çÊñ∑Êõ¥ÊîπÁ®ãÂºèÁ¢º„ÄÅÁ†¥Â£ûÁ®ãÂºèÁ¢º‰∏¶‰øÆÂæ©ÂÆÉÔºåÂÅúÊ≠¢‰∏¶ÈáçÊñ∞ÂïüÂãïÈñãÁôº‰º∫ÊúçÂô®Á≠â„ÄÇ\n \n-## ÈÉ®ÁΩ≤Á≠ñÁï•\n+## ÈÉ®ÁΩ≤Á≠ñÁï• { #deployment-strategies }\n \n-Ê†πÊìö‰Ω†ÁöÑ‰ΩøÁî®Â†¥ÊôØÂíå‰ΩøÁî®Â∑•ÂÖ∑ÔºåÊúâÂ§öÁ®ÆÊñπÊ≥ïÂèØ‰ª•ÂØ¶ÁèæÊ≠§ÁõÆÁöÑ„ÄÇ\n+Ê†πÊìö‰Ω†ÁöÑÁâπÂÆö‰ΩøÁî®Â†¥ÊôØËàáÊâÄ‰ΩøÁî®ÁöÑÂ∑•ÂÖ∑ÔºåÊúâÂ§öÁ®ÆÊñπÊ≥ïÂèØ‰ª•ÂÅöÂà∞„ÄÇ\n \n-‰Ω†ÂèØ‰ª•‰ΩøÁî®‰∏Ä‰∫õÂ∑•ÂÖ∑Ëá™Ë°å**ÈÉ®ÁΩ≤‰º∫ÊúçÂô®**Ôºå‰Ω†‰πüÂèØ‰ª•‰ΩøÁî®ËÉΩÁÇ∫‰Ω†ÂÆåÊàêÈÉ®ÂàÜÂ∑•‰ΩúÁöÑ**Èõ≤Á´ØÊúçÂãô**ÔºåÊàñÂÖ∂‰ªñÂèØËÉΩÁöÑÈÅ∏È†Ö„ÄÇ\n+‰Ω†ÂèØ‰ª•Ëá™Ë°å‰ΩøÁî®‰∏ÄÁµÑÂ∑•ÂÖ∑‰æÜ**ÈÉ®ÁΩ≤‰º∫ÊúçÂô®**Ôºõ‰πüÂèØ‰ª•‰ΩøÁî®Êõø‰Ω†ÂÆåÊàêÈÉ®ÂàÜÂ∑•‰ΩúÁöÑ**Èõ≤Á´ØÊúçÂãô**ÔºåÊàñÂÖ∂‰ªñÂèØËÉΩÁöÑÈÅ∏È†Ö„ÄÇ\n+\n+‰æãÂ¶ÇÔºåÊàëÂÄëÔºàFastAPI ËÉåÂæåÁöÑÂúòÈöäÔºâÊâìÈÄ†‰∫Ü <a href=\"https://fastapicloud.com\" class=\"external-link\" target=\"_blank\">**FastAPI Cloud**</a>ÔºåËÆìÂ∞á FastAPI apps ÈÉ®ÁΩ≤Âà∞Èõ≤Á´ØÁöÑÊµÅÁ®ãÁõ°ÂèØËÉΩÈ†ÜÊö¢ÔºåÂêåÊôÇ‰øùÊúâ‰ΩøÁî® FastAPI ÈñãÁôºÊôÇÁöÑÁõ∏ÂêåÈñãÁôºËÄÖÈ´îÈ©ó„ÄÇ\n \n ÊàëÂ∞áÂêë‰Ω†Â±ïÁ§∫Âú®ÈÉ®ÁΩ≤ **FastAPI** ÊáâÁî®Á®ãÂºèÊôÇ‰Ω†ÂèØËÉΩÊáâË©≤Ë®ò‰ΩèÁöÑ‰∏Ä‰∫õ‰∏ªË¶ÅÊ¶ÇÂøµÔºàÂÑòÁÆ°ÂÖ∂‰∏≠Â§ßÈÉ®ÂàÜÈÅ©Áî®Êñº‰ªª‰ΩïÂÖ∂‰ªñÈ°ûÂûãÁöÑ Web ÊáâÁî®Á®ãÂºèÔºâ„ÄÇ\n \n-Âú®Êé•‰∏ã‰æÜÁöÑÈÉ®ÂàÜ‰∏≠Ôºå‰Ω†Â∞áÁúãÂà∞Êõ¥Â§öÈúÄË¶ÅË®ò‰ΩèÁöÑÁ¥∞ÁØÄ‰ª•Âèä‰∏Ä‰∫õÊäÄÂ∑ß„ÄÇ ‚ú®\n+Âú®Êé•‰∏ã‰æÜÁöÑÈÉ®ÂàÜ‰∏≠Ôºå‰Ω†Â∞áÁúãÂà∞Êõ¥Â§öÈúÄË¶ÅË®ò‰ΩèÁöÑÁ¥∞ÁØÄ‰ª•Âèä‰∏Ä‰∫õÂØ¶‰ΩúÊäÄÂ∑ß„ÄÇ ‚ú®\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-# Áí∞Â¢ÉËÆäÊï∏\n+# Áí∞Â¢ÉËÆäÊï∏ { #environment-variables }\n \n /// tip\n \n@@ -10,7 +10,7 @@\n \n Áí∞Â¢ÉËÆäÊï∏Â∞çÊñºËôïÁêÜÊáâÁî®Á®ãÂºè**Ë®≠ÂÆö**Ôºà‰ΩúÁÇ∫ Python **ÂÆâË£ù**ÁöÑ‰∏ÄÈÉ®ÂàÜÁ≠âÊñπÈù¢ÔºâÈùûÂ∏∏ÊúâÁî®„ÄÇ\n \n-## Âª∫Á´ãÂíå‰ΩøÁî®Áí∞Â¢ÉËÆäÊï∏\n+## Âª∫Á´ãÂíå‰ΩøÁî® env var { #create-and-use-env-vars }\n \n ‰Ω†Âú® **shellÔºàÁµÇÁ´ØÊ©üÔºâ**‰∏≠Â∞±ÂèØ‰ª•**Âª∫Á´ã**Âíå‰ΩøÁî®Áí∞Â¢ÉËÆäÊï∏Ôºå‰∏¶‰∏çÈúÄË¶ÅÁî®Âà∞ PythonÔºö\n \n@@ -50,7 +50,7 @@ Hello Wade Wilson\n \n ////\n \n-## Âú® Python ‰∏≠ËÆÄÂèñÁí∞Â¢ÉËÆäÊï∏\n+## Âú® Python ‰∏≠ËÆÄÂèñ env var { #read-env-vars-in-python }\n \n ‰Ω†‰πüÂèØ‰ª•Âú® Python **‰πãÂ§ñ**ÁöÑÁµÇÁ´ØÊ©ü‰∏≠Âª∫Á´ãÁí∞Â¢ÉËÆäÊï∏ÔºàÊàñ‰ΩøÁî®ÂÖ∂‰ªñÊñπÊ≥ïÔºâÔºåÁÑ∂ÂæåÂú® Python ‰∏≠**ËÆÄÂèñ**ÂÆÉÂÄë„ÄÇ\n \n@@ -65,9 +65,9 @@ print(f\"Hello {name} from Python\")\n \n /// tip\n \n-Á¨¨‰∫åÂÄãÂèÉÊï∏ÊòØ <a href=\"https://docs.python.org/zh-tw/3.8/library/os.html#os.getenv\" class=\"external-link\" target=\"_blank\">`os.getenv()`</a> ÁöÑÈ†êË®≠ÂõûÂÇ≥ÂÄº„ÄÇ\n+<a href=\"https://docs.python.org/3.8/library/os.html#os.getenv\" class=\"external-link\" target=\"_blank\">`os.getenv()`</a> ÁöÑÁ¨¨‰∫åÂÄãÂèÉÊï∏ÊòØÈ†êË®≠Ë¶ÅÂõûÂÇ≥ÁöÑÂÄº„ÄÇ\n \n-Â¶ÇÊûúÊ≤íÊúâÊèê‰æõÔºåÈ†êË®≠ÂÄºÁÇ∫ `None`ÔºåÈÄôË£°ÊàëÂÄëÊèê‰æõ `\"World\"` ‰ΩúÁÇ∫È†êË®≠ÂÄº„ÄÇ\n+Â¶ÇÊûúÊú™Êèê‰æõÔºåÈ†êË®≠ÂÄºÁÇ∫ `None`ÔºåÈÄôË£°ÊàëÂÄëÊèê‰æõ `\"World\"` ‰ΩúÁÇ∫Ë¶Å‰ΩøÁî®ÁöÑÈ†êË®≠ÂÄº„ÄÇ\n \n ///\n \n@@ -78,10 +78,10 @@ print(f\"Hello {name} from Python\")\n <div class=\"termy\">\n \n \n```", "output": "Changes look good. This PR implements: üåê Update translations for zh-hant (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 326}
{"instruction": "Fix the following bug: üìù Fix duplicate word in `advanced-dependencies.md`", "input": "Fixes duplicate \"the\" in docs/en/docs/advanced/advanced-dependencies.md (line 123): \"after the the response\" ‚Üí \"after the response\".", "output": "```diff\n@@ -120,7 +120,7 @@ The exit code, the automatic closing of the `Session` in:\n \n {* ../../docs_src/dependencies/tutorial013_an_py310.py ln[19:21] *}\n \n-...would be run after the the response finishes sending the slow data:\n+...would be run after the response finishes sending the slow data:\n \n {* ../../docs_src/dependencies/tutorial013_an_py310.py ln[30:38] hl[31:33] *}\n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 325}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -120,7 +120,7 @@ The exit code, the automatic closing of the `Session` in:\n \n {* ../../docs_src/dependencies/tutorial013_an_py310.py ln[19:21] *}\n \n-...would be run after the the response finishes sending the slow data:\n+...would be run after the response finishes sending the slow data:\n \n {* ../../docs_src/dependencies/tutorial013_an_py310.py ln[30:38] hl[31:33] *}\n \n\n```", "output": "Bug: üìù Fix duplicate word in `advanced-dependencies.md`\n\nFixes duplicate \"the\" in docs/en/docs/advanced/advanced-dependencies.md (line 123): \"after the the response\" ‚Üí \"after the response\".", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 325}
{"instruction": "Review the following code changes: üìù Fix duplicate word in `advanced-dependencies.md`", "input": "```diff\n@@ -120,7 +120,7 @@ The exit code, the automatic closing of the `Session` in:\n \n {* ../../docs_src/dependencies/tutorial013_an_py310.py ln[19:21] *}\n \n-...would be run after the the response finishes sending the slow data:\n+...would be run after the response finishes sending the slow data:\n \n {* ../../docs_src/dependencies/tutorial013_an_py310.py ln[30:38] hl[31:33] *}\n \n\n```", "output": "Changes look good. This PR implements: üìù Fix duplicate word in `advanced-dependencies.md`", "source": "pr", "type": "code_review", "pr_number": 325}
{"instruction": "Fix the following bug: Feature addition and fixes", "input": "Added a plugin system allowing third-party libraries to hook into OpenAPI generation without monkey-patching FastAPI internals.\r\n\r\nUnified FastAPI and Starlette lifespan handling so:\r\nStartup/shutdown hooks behave consistently\r\nErrors are propagated correctly\r\n\r\nReduced OpenAPI Generation Overhead\r\n\r\nAdded an optional, non-production debugging endpoint that exposes the resolved dependency graph for each route. Requirements: Added an internal API to extract the dependency DAG per route Include: Dependency callables Scope (request / function) Cleanup (yield) dependencies Security scopes Output must be purely informational (no execution) Must not affect runtime behavior Constraints\r\n\r\nDefined and enforced a deterministic cleanup order for dependency finalizers.", "output": "```diff\n@@ -0,0 +1,112 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Hook to capture session start/end events.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import sys\n+import os\n+import subprocess\n+from datetime import datetime, timezone\n+from claude_code_capture_utils import get_log_file_path, add_ab_metadata\n+\n+def get_git_metadata(repo_dir):\n+    \"\"\"Get current git commit and branch.\"\"\"\n+    try:\n+        # Get current commit hash\n+        commit_result = subprocess.run(\n+            ['git', 'rev-parse', 'HEAD'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        # Get current branch\n+        branch_result = subprocess.run(\n+            ['git', 'branch', '--show-current'],\n+            cwd=repo_dir,\n+            capture_output=True,\n+            text=True,\n+            timeout=10\n+        )\n+\n+        git_metadata = {\n+            \"base_commit\": commit_result.stdout.strip() if commit_result.returncode == 0 else None,\n+            \"branch\": branch_result.stdout.strip() if branch_result.returncode == 0 else None,\n+            \"timestamp\": datetime.now(timezone.utc).isoformat()\n+        }\n+\n+        if git_metadata[\"base_commit\"]:\n+            return git_metadata\n+        else:\n+            return None\n+\n+    except Exception as e:\n+        print(f\"Warning: Could not capture git metadata: {e}\", file=sys.stderr)\n+        return None\n+\n+def main():\n+    try:\n+        if len(sys.argv) < 2:\n+            print(\"Usage: capture_session_event.py [start|end]\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        event_type = sys.argv[1].lower()\n+        if event_type not in [\"start\", \"end\"]:\n+            print(\"Event type must be 'start' or 'end'\", file=sys.stderr)\n+            sys.exit(1)\n+\n+        input_data = json.load(sys.stdin)\n+\n+        session_id = input_data.get(\"session_id\", \"unknown\")\n+        transcript_path = input_data.get(\"transcript_path\", \"\")\n+        cwd = input_data.get(\"cwd\", \"\")\n+\n+        if event_type == \"start\":\n+            # Session start: capture git metadata\n+            git_metadata = get_git_metadata(cwd)\n+\n+            log_entry = {\n+                \"type\": \"session_start\",\n+                \"timestamp\": datetime.now(timezone.utc).isoformat(),\n+                \"session_id\": session_id,\n+                \"transcript_path\": transcript_path,\n+                \"cwd\": cwd,\n+                \"git_metadata\": git_metadata\n+            }\n+\n+            log_entry = add_ab_metadata(log_entry, cwd)\n+\n+            if git_metadata:\n+                print(f\"[OK] Captured git metadata: {git_metadata['base_commit'][:8]} on {git_metadata['branch']}\")\n+\n+            # Write session_start event\n+            log_file = get_log_file_path(session_id, cwd)\n+            with open(log_file, \"a\", encoding=\"utf-8\") as f:\n+                f.write(json.dumps(log_entry) + \"\\n\")\n+\n+        elif event_type == \"end\":\n+            # Session end: log the event\n+            log\n\n```\n\n```diff\n@@ -0,0 +1,93 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Utility functions for A/B testing hooks.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import os\n+from pathlib import Path\n+\n+def detect_model_lane(cwd):\n+    \"\"\"Detect if we're in model_a or model_b directory.\"\"\"\n+    path_parts = Path(cwd).parts\n+    if 'model_a' in path_parts:\n+        return 'model_a'\n+    elif 'model_b' in path_parts:\n+        return 'model_b'\n+    return None\n+\n+def get_experiment_root(cwd):\n+    \"\"\"Get the experiment root directory (parent of model_a/model_b).\"\"\"\n+    current_path = Path(cwd)\n+    \n+    # Check if we're inside a model_a or model_b directory\n+    # Look for the parent that contains both model_a and model_b\n+    for parent in [current_path] + list(current_path.parents):\n+        if (parent / 'model_a').exists() and (parent / 'model_b').exists():\n+            return str(parent)\n+        # Also check one level up (in case we're inside the cloned repo)\n+        parent_up = parent.parent\n+        if (parent_up / 'model_a').exists() and (parent_up / 'model_b').exists():\n+            return str(parent_up)\n+    return None\n+\n+def read_manifest(experiment_root):\n+    \"\"\"Read the manifest.json file to get task_id and model assignments.\"\"\"\n+    try:\n+        manifest_path = os.path.join(experiment_root, 'manifest.json')\n+        if os.path.exists(manifest_path):\n+            with open(manifest_path, 'r', encoding='utf-8') as f:\n+                return json.load(f)\n+    except Exception:\n+        pass\n+    return {}\n+\n+def get_ab_metadata(cwd):\n+    \"\"\"Get A/B testing metadata (task_id, model_lane, model_name) from current directory.\"\"\"\n+    model_lane = detect_model_lane(cwd)\n+    experiment_root = get_experiment_root(cwd)\n+    \n+    if not model_lane or not experiment_root:\n+        return {}\n+    \n+    manifest = read_manifest(experiment_root)\n+    \n+    metadata = {\n+        \"task_id\": manifest.get(\"task_id\"),\n+        \"model_lane\": model_lane,\n+        \"experiment_root\": experiment_root\n+    }\n+    \n+    # Get model name from assignments\n+    assignments = manifest.get(\"assignments\", {})\n+    if model_lane in assignments:\n+        metadata[\"model_name\"] = assignments[model_lane]\n+    \n+    return metadata\n+\n+def get_log_file_path(session_id, cwd):\n+    \"\"\"Get the correct log file path for A/B testing (routes to model-specific directory).\"\"\"\n+    model_lane = detect_model_lane(cwd)\n+    experiment_root = get_experiment_root(cwd)\n+    \n+    if model_lane and experiment_root:\n+        # Route to model-specific logs directory\n+        logs_dir = os.path.join(experiment_root, \"logs\", model_lane)\n+        os.makedirs(logs_dir, exist_ok=True)\n+        return os.path.join(logs_dir, f\"session_{session_id}.jsonl\")\n+    else:\n+        # Fallback to current behavior\n+        project_dir = os.environ.get(\"CLAUDE_PROJECT_DIR\", os.getcwd())\n+        logs_dir = os.path.join(project_dir, \"logs\")\n+        os.makedirs(logs_dir, exist_ok=True)\n+        return \n\n```\n\n```diff\n@@ -0,0 +1,720 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Process raw transcript to extract all messages and generate summaries.\n+Handles both incremental (Stop event) and final (SessionEnd) processing.\n+Cross-platform support for Windows, macOS, and Linux.\n+\"\"\"\n+import json\n+import sys\n+import os\n+import shutil\n+import subprocess\n+from datetime import datetime, timezone\n+from pathlib import Path\n+from collections import defaultdict\n+from claude_code_capture_utils import get_log_file_path, add_ab_metadata, detect_model_lane, get_experiment_root\n+\n+def read_and_process_raw_transcript(transcript_path):\n+    \"\"\"\n+    Read raw transcript and extract all unique messages.\n+    Returns deduplicated messages with last occurrence (final state).\n+    Also extracts thinking blocks as separate entries.\n+    \"\"\"\n+    if not os.path.exists(transcript_path):\n+        return []\n+    \n+    # Track assistant messages by message.id (they have IDs, can have duplicates)\n+    assistant_messages = {}\n+    # Track thinking blocks separately (won't be counted in token usage)\n+    thinking_blocks = {}\n+    # Track user messages by uuid (they don't have message.id, use uuid)\n+    user_messages = {}\n+    \n+    try:\n+        with open(transcript_path, 'r', encoding='utf-8') as f:\n+            for line in f:\n+                line = line.strip()\n+                if not line:\n+                    continue\n+                \n+                try:\n+                    event = json.loads(line)\n+                    event_type = event.get('type')\n+                    message = event.get('message', {})\n+                    \n+                    # Process assistant messages (have message.id)\n+                    if event_type == 'assistant':\n+                        msg_id = message.get('id')\n+                        if msg_id:\n+                            # Check for thinking blocks in content\n+                            content = message.get('content', [])\n+                 \n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 324}
{"instruction": "Review the following code changes: üåê Update translations for uk (update-outdated)", "input": "```diff\n@@ -8,7 +8,7 @@\n   <a href=\"https://fastapi.tiangolo.com/uk\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI: –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n+    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI - —Ü–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n </p>\n <p align=\"center\">\n <a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n@@ -33,14 +33,14 @@\n \n ---\n \n-FastAPI ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n+FastAPI - —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n \n –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:\n \n * **–®–≤–∏–¥–∫–∏–π**: –¥—É–∂–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —Ç–∞ **Go** (–∑–∞–≤–¥—è–∫–∏ Starlette —Ç–∞ Pydantic). [–û–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö Python-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤](#performance).\n * **–®–≤–∏–¥–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É**: –ø—Ä–∏—à–≤–∏–¥—à—É—î —Ä–æ–∑—Ä–æ–±–∫—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 200%‚Äì300%. *\n * **–ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫**: –∑–º–µ–Ω—à—É—î –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 40% –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫, —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–∏—Ö –ª—é–¥–∏–Ω–æ—é (—Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º). *\n-* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n+* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–µ —è–∫ auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n * **–ü—Ä–æ—Å—Ç–∏–π**: —Å–ø—Ä–æ—î–∫—Ç–æ–≤–∞–Ω–∏–π —Ç–∞–∫, —â–æ–± –±—É—Ç–∏ –ø—Ä–æ—Å—Ç–∏–º —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Ç–∞ –≤–∏–≤—á–µ–Ω–Ω—ñ. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó.\n * **–ö–æ—Ä–æ—Ç–∫–∏–π**: –º—ñ–Ω—ñ–º—ñ–∑—É—î –¥—É–±–ª—é–≤–∞–Ω–Ω—è –∫–æ–¥—É. –ö—ñ–ª—å–∫–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π –∑ –∫–æ–∂–Ω–æ–≥–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞. –ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫.\n * **–ù–∞–¥—ñ–π–Ω–∏–π**: –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É. –ó –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é.\n@@ -127,9 +127,9 @@ FastAPI ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏\n \n <a href=\"https://typer.tiangolo.com\" target=\"_blank\"><img src=\"https://typer.tiangolo.com/img/logo-margin/logo-margin-vector.svg\" style=\"width: 20%;\"></a>\n \n-–Ø–∫—â–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ <abbr title=\"Command Line Interface\">CLI</abbr> –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∑–∞–º—ñ—Å—Ç—å –≤–µ–±-API, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n+–Ø–∫—â–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ <abbr title=\"Command Line Interface- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞\">CLI</abbr> –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∑–∞–º—ñ—Å—Ç—å –≤–µ–±-API, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n \n-**Typer** ‚Äî –º–æ–ª–æ–¥—à–∏–π –±—Ä–∞—Ç FastAPI. –Ü –π–æ–≥–æ –∑–∞–¥—É–º–∞–Ω–æ —è–∫ **FastAPI –¥–ª—è CLI**. ‚å®Ô∏è üöÄ\n+**Typer** - –º–æ–ª–æ–¥—à–∏–π –±—Ä–∞—Ç FastAPI. –Ü –π–æ–≥–æ –∑–∞–¥—É–º–∞–Ω–æ —è–∫ **FastAPI –¥–ª—è CLI**. ‚å®Ô∏è üöÄ\n \n ## –í–∏–º–æ–≥–∏ { #requirements }\n \n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `main.py` –∑:\n \n \n```\n\n```diff\n@@ -103,15 +103,16 @@\n –û—Å–∫—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –æ–¥–∏–Ω–∏—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É—é—Ç—å—Å—è —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø–∏—Ç—É, –≤–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ —è–≤–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏ `Query`, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑—Ä–æ–±–∏—Ç–∏:\n \n \n```\n\n```diff\n@@ -33,14 +33,14 @@\n \n ---\n \n-FastAPI ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n+FastAPI - —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n \n –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:\n \n * **–®–≤–∏–¥–∫–∏–π**: –¥—É–∂–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —Ç–∞ **Go** (–∑–∞–≤–¥—è–∫–∏ Starlette —Ç–∞ Pydantic). [–û–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö Python-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤](#performance).\n * **–®–≤–∏–¥–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É**: –ø—Ä–∏—à–≤–∏–¥—à—É—î —Ä–æ–∑—Ä–æ–±–∫—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 200%‚Äì300%. *\n * **–ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫**: –∑–º–µ–Ω—à—É—î –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 40% –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫, —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–∏—Ö –ª—é–¥–∏–Ω–æ—é (—Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º). *\n-* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n+* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense - —Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ —è–∫ auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n\n```\n\n```diff\n@@ -530,7 +524,7 @@ FastAPI –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ Pydantic —ñ Starlette.\n \n * <a href=\"https://www.python-httpx.org\" target=\"_blank\"><code>httpx</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `TestClient`.\n * <a href=\"https://jinja.palletsprojects.com\" target=\"_blank\"><code>jinja2</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —à–∞–±–ª–æ–Ω—ñ–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.\n-* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ <abbr title=\"converting the string that comes from an HTTP request into Python data\">¬´parsing¬ª</abbr> —Ñ–æ—Ä–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `request", "output": "Code Review for: üåê Update translations for uk (update-outdated)\n\nüìù **docs/uk/docs/index.md**: ```suggestion\n* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense - –≤—ñ–¥–æ–º–µ —è–∫ auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n```\n\nüìù **docs/uk/docs/index.md**: ```suggestion\n* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ <abbr title=\"converting the string that comes from an HTTP request into Python datatypes - –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä–æ–∫–∏ —ñ–∑ HTTP-–∑–∞–ø–∏—Ç—É, —É Python —Ç–∏–ø–∏\">¬´parsing¬ª</abbr> —Ñ–æ—Ä–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `request.form()`.\n```\n\nüìù **docs/uk/docs/index.md**: ```suggestion\n* <abbr title=\"also known as: serialization, parsing, marshalling - –≤—ñ–¥–æ–º–µ —è–∫ serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python —É –º–µ—Ä–µ–∂–µ–≤—ñ –¥–∞–Ω—ñ (—è–∫ JSON):\n```\n\nüìù **docs/uk/docs/index.md**: ```suggestion\n* <abbr title=\"also known as: serialization, parsing, marshalling - –≤—ñ–¥–æ–º–µ —è–∫ serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –∑ –º–µ—Ä–µ–∂—ñ –¥–æ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python. –ß–∏—Ç–∞–Ω–Ω—è –∑:\n```\n\nüìù **docs/uk/docs/index.md**: ```suggestion\n    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI - —Ü–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -33,14 +33,14 @@\n \n ---\n \n-FastAPI ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n+FastAPI - —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∏–π) –≤–µ–±—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Python, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –ø—ñ–¥–∫–∞–∑–∫–∞—Ö —Ç–∏–ø—ñ–≤ Python.\n \n –ö–ª—é—á–æ–≤—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:\n \n * **–®–≤–∏–¥–∫–∏–π**: –¥—É–∂–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –Ω–∞ —Ä—ñ–≤–Ω—ñ –∑ **NodeJS** —Ç–∞ **Go** (–∑–∞–≤–¥—è–∫–∏ Starlette —Ç–∞ Pydantic). [–û–¥–∏–Ω —ñ–∑ –Ω–∞–π—à–≤–∏–¥—à–∏—Ö Python-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤](#performance).\n * **–®–≤–∏–¥–∫–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∫–æ–¥—É**: –ø—Ä–∏—à–≤–∏–¥—à—É—î —Ä–æ–∑—Ä–æ–±–∫—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 200%‚Äì300%. *\n * **–ú–µ–Ω—à–µ –ø–æ–º–∏–ª–æ–∫**: –∑–º–µ–Ω—à—É—î –ø—Ä–∏–±–ª–∏–∑–Ω–æ –Ω–∞ 40% –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫, —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–∏—Ö –ª—é–¥–∏–Ω–æ—é (—Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º). *\n-* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n+* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense - —Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ —è–∫ auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n\n```", "output": "```suggestion\n* **–Ü–Ω—Ç—É—ó—Ç–∏–≤–Ω–∏–π**: —á—É–¥–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º–∏ –∫–æ–¥—É. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense - –≤—ñ–¥–æ–º–µ —è–∫ auto-complete, autocompletion, IntelliSense\">–ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</abbr> –≤—Å—é–¥–∏. –ú–µ–Ω—à–µ —á–∞—Å—É –Ω–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -530,7 +524,7 @@ FastAPI –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ Pydantic —ñ Starlette.\n \n * <a href=\"https://www.python-httpx.org\" target=\"_blank\"><code>httpx</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `TestClient`.\n * <a href=\"https://jinja.palletsprojects.com\" target=\"_blank\"><code>jinja2</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —à–∞–±–ª–æ–Ω—ñ–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.\n-* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ <abbr title=\"converting the string that comes from an HTTP request into Python data\">¬´parsing¬ª</abbr> —Ñ–æ—Ä–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `request.form()`.\n+* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ <abbr title=\"converting the string that comes from an HTTP request into Python data - –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä–æ–∫–∏, —â–æ –Ω–∞–¥—Ö–æ–¥–∏—Ç—å –∑ HTTP-–∑–∞–ø–∏—Ç—É, —É –¥–∞–Ω—ñ Python\">¬´parsing¬ª</abbr> —Ñ–æ—Ä–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `request.form()`.\n\n```", "output": "```suggestion\n* <a href=\"https://github.com/Kludex/python-multipart\" target=\"_blank\"><code>python-multipart</code></a> - –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ <abbr title=\"converting the string that comes from an HTTP request into Python datatypes - –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä–æ–∫–∏ —ñ–∑ HTTP-–∑–∞–ø–∏—Ç—É, —É Python —Ç–∏–ø–∏\">¬´parsing¬ª</abbr> —Ñ–æ—Ä–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `request.form()`.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -374,15 +368,15 @@ item: Item\n * –í–∞–ª—ñ–¥–∞—Ü—ñ—é –¥–∞–Ω–∏—Ö:\n     * –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–∞ –∑—Ä–æ–∑—É–º—ñ–ª—ñ –ø–æ–º–∏–ª–∫–∏, –∫–æ–ª–∏ –¥–∞–Ω—ñ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ.\n     * –í–∞–ª—ñ–¥–∞—Ü—ñ—é –Ω–∞–≤—ñ—Ç—å –¥–ª—è –≥–ª–∏–±–æ–∫–æ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö JSON-–æ–± º—î–∫—Ç—ñ–≤.\n-* <abbr title=\"also known as: serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –∑ –º–µ—Ä–µ–∂—ñ –¥–æ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python. –ß–∏—Ç–∞–Ω–Ω—è –∑:\n+* <abbr title=\"also known as: serialization, parsing, marshalling - —Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ —è–∫ serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –∑ –º–µ—Ä–µ–∂—ñ –¥–æ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python. –ß–∏—Ç–∞–Ω–Ω—è –∑:\n     * JSON.\n     * –ü–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —à–ª—è—Ö—É.\n     * –ü–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∑–∞–ø–∏—Ç—É.\n     * Cookies.\n     * Headers.\n     * Forms.\n     * Files.\n-* <abbr title=\"also known as: serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python —É –º–µ—Ä–µ–∂–µ–≤—ñ –¥–∞–Ω—ñ (—è–∫ JSON):\n+* <abbr title=\"also known as: serialization, parsing, marshalling - —Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–æ —è–∫ serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python —É –º–µ—Ä–µ–∂–µ–≤—ñ –¥–∞–Ω—ñ (—è–∫ JSON):\n\n```", "output": "```suggestion\n* <abbr title=\"also known as: serialization, parsing, marshalling - –≤—ñ–¥–æ–º–µ —è–∫ serialization, parsing, marshalling\">–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è</abbr> –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑ –¥–∞–Ω–∏—Ö —ñ —Ç–∏–ø—ñ–≤ Python —É –º–µ—Ä–µ–∂–µ–≤—ñ –¥–∞–Ω—ñ (—è–∫ JSON):\n```", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -8,7 +8,7 @@\n   <a href=\"https://fastapi.tiangolo.com/uk\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n </p>\n <p align=\"center\">\n-    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI: –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n+    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI - –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n\n```", "output": "```suggestion\n    <em>–§—Ä–µ–π–º–≤–æ—Ä–∫ FastAPI - —Ü–µ –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –ª–µ–≥–∫–æ –≤–∏–≤—á–∞—Ç–∏, —à–≤–∏–¥–∫–æ –ø–∏—Å–∞—Ç–∏ –∫–æ–¥, –≥–æ—Ç–æ–≤–∏–π –¥–æ –ø—Ä–æ–¥–∞–∫—à–∏–Ω—É</em>\n```", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -500,11 +494,11 @@ Deploying to FastAPI Cloud...\n \n –í—ñ–Ω –∑–∞–±–µ–∑–ø–µ—á—É—î —Ç–æ–π —Å–∞–º–∏–π **developer experience** —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤ –Ω–∞ FastAPI –ø—ñ–¥ —á–∞—Å —ó—Ö **—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è** —É —Ö–º–∞—Ä—ñ. üéâ\n \n-FastAPI Cloud ‚Äî –æ—Å–Ω–æ–≤–Ω–∏–π —Å–ø–æ–Ω—Å–æ—Ä —ñ –¥–∂–µ—Ä–µ–ª–æ —Ñ—ñ–Ω–∞–Ω—Å—É–≤–∞–Ω–Ω—è open source –ø—Ä–æ—î–∫—Ç—ñ–≤ *FastAPI and friends*. ‚ú®\n+FastAPI Cloud - –æ—Å–Ω–æ–≤–Ω–∏–π —Å–ø–æ–Ω—Å–æ—Ä —ñ –¥–∂–µ—Ä–µ–ª–æ —Ñ—ñ–Ω–∞–Ω—Å—É–≤–∞–Ω–Ω—è open source –ø—Ä–æ—î–∫—Ç—ñ–≤ *FastAPI and friends*. ‚ú®\n \n #### –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤ —ñ–Ω—à–∏—Ö —Ö–º–∞—Ä–Ω–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤ { #deploy-to-other-cloud-providers }\n \n-FastAPI ‚Äî open source —ñ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö. –í–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ FastAPI –≤ –±—É–¥—å-—è–∫–æ–º—É —Ö–º–∞—Ä–Ω–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ, —è–∫–∏–π –≤–∏ –æ–±–µ—Ä–µ—Ç–µ.\n+FastAPI - open source —ñ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö. –í–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ FastAPI –≤ –±—É–¥—å-—è–∫–æ–º—É —Ö–º–∞—Ä–Ω–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ, —è–∫–∏–π –≤–∏ –æ–±–µ—Ä–µ—Ç–µ.\n\n```", "output": "```suggestion\nFastAPI - open source –ø—Ä–æ–µ–∫—Ç —ñ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö. –í–∏ –º–æ–∂–µ—Ç–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ FastAPI –≤ –±—É–¥—å-—è–∫–æ–º—É —Ö–º–∞—Ä–Ω–æ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ, —è–∫–∏–π –≤–∏ –æ–±–µ—Ä–µ—Ç–µ.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -127,9 +127,9 @@ FastAPI ‚Äî —Ü–µ —Å—É—á–∞—Å–Ω–∏–π, —à–≤–∏–¥–∫–∏–π (–≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏\n \n <a href=\"https://typer.tiangolo.com\" target=\"_blank\"><img src=\"https://typer.tiangolo.com/img/logo-margin/logo-margin-vector.svg\" style=\"width: 20%;\"></a>\n \n-–Ø–∫—â–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ <abbr title=\"Command Line Interface\">CLI</abbr> –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∑–∞–º—ñ—Å—Ç—å –≤–µ–±-API, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n+–Ø–∫—â–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ <abbr title=\"Command Line Interface - Command Line Interface\">CLI</abbr> –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∑–∞–º—ñ—Å—Ç—å –≤–µ–±-API, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n\n```", "output": "```suggestion\n–Ø–∫—â–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ <abbr title=\"Command Line Interface- –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞\">CLI</abbr> –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ –∑–∞–º—ñ—Å—Ç—å –≤–µ–±-API, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ <a href=\"https://typer.tiangolo.com/\" class=\"external-link\" target=\"_blank\">**Typer**</a>.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review this code change in `docs/uk/docs/index.md`", "input": "```diff\n@@ -439,9 +433,9 @@ item: Item\n \n ![editor support](https://fastapi.tiangolo.com/img/vscode-completion.png)\n \n-–î–ª—è –±—ñ–ª—å—à –ø–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É, —â–æ –≤–∫–ª—é—á–∞—î –±—ñ–ª—å—à–µ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ <a href=\"https://fastapi.tiangolo.com/uk/tutorial/\">–¢—É—Ç–æ—Ä—ñ–∞–ª ‚Äî –ü–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a>.\n+–î–ª—è –±—ñ–ª—å—à –ø–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É, —â–æ –≤–∫–ª—é—á–∞—î –±—ñ–ª—å—à–µ –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ <a href=\"https://fastapi.tiangolo.com/uk/tutorial/\">–ù–∞–≤—á–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ - –ü–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</a>.\n \n-**Spoiler alert**: —Ç—É—Ç–æ—Ä—ñ–∞–ª ‚Äî –ø–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –º—ñ—Å—Ç–∏—Ç—å:\n+**Spoiler alert**: –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ - –ø–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –º—ñ—Å—Ç–∏—Ç—å:\n\n```", "output": "\"Spoiler alert\" is not translated", "source": "pr_review", "type": "inline_review", "pr_number": 323}
{"instruction": "Review the following code changes: üåê Update translations for fr (update-outdated)", "input": "```diff\n@@ -1,6 +1,6 @@\n-# R√©ponses suppl√©mentaires dans OpenAPI\n+# R√©ponses suppl√©mentaires dans OpenAPI { #additional-responses-in-openapi }\n \n-/// warning | Attention\n+/// warning | Alertes\n \n Ceci concerne un sujet plut√¥t avanc√©.\n \n@@ -14,9 +14,9 @@ Ces r√©ponses suppl√©mentaires seront incluses dans le sch√©ma OpenAPI, elles ap\n \n Mais pour ces r√©ponses suppl√©mentaires, vous devez vous assurer de renvoyer directement une `Response` comme `JSONResponse`, avec votre code HTTP et votre contenu.\n \n-## R√©ponse suppl√©mentaire avec `model`\n+## R√©ponse suppl√©mentaire avec `model` { #additional-response-with-model }\n \n-Vous pouvez ajouter √† votre d√©corateur de *param√®tre de chemin* un param√®tre `responses`.\n+Vous pouvez passer √† vos d√©corateurs de *chemin d'acc√®s* un param√®tre `responses`.\n \n Il prend comme valeur un `dict` dont les cl√©s sont des codes HTTP pour chaque r√©ponse, comme `200`, et la valeur de ces cl√©s sont d'autres `dict` avec des informations pour chacun d'eux.\n \n@@ -26,7 +26,7 @@ Chacun de ces `dict` de r√©ponse peut avoir une cl√© `model`, contenant un mod√®\n \n Par exemple, pour d√©clarer une autre r√©ponse avec un code HTTP `404` et un mod√®le Pydantic `Message`, vous pouvez √©crire¬†:\n \n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n /// note | Remarque\n \n@@ -49,7 +49,7 @@ Le bon endroit est :\n \n ///\n \n-Les r√©ponses g√©n√©r√©es au format OpenAPI pour cette *op√©ration de chemin* seront¬†:\n+Les r√©ponses g√©n√©r√©es au format OpenAPI pour ce *chemin d'acc√®s* seront¬†:\n \n \n```\n\n```diff\n@@ -1,41 +1,41 @@\n-# Codes HTTP suppl√©mentaires\n+# Codes HTTP suppl√©mentaires { #additional-status-codes }\n \n Par d√©faut, **FastAPI** renverra les r√©ponses √† l'aide d'une structure de donn√©es `JSONResponse`, en pla√ßant la r√©ponse de votre  *chemin d'acc√®s* √† l'int√©rieur de cette `JSONResponse`.\n \n Il utilisera le code HTTP par d√©faut ou celui que vous avez d√©fini dans votre *chemin d'acc√®s*.\n \n-## Codes HTTP suppl√©mentaires\n+## Codes HTTP suppl√©mentaires { #additional-status-codes_1 }\n \n Si vous souhaitez renvoyer des codes HTTP suppl√©mentaires en plus du code principal, vous pouvez le faire en renvoyant directement une `Response`, comme une `JSONResponse`, et en d√©finissant directement le code HTTP suppl√©mentaire.\n \n-Par exemple, disons que vous voulez avoir un *chemin d'acc√®s* qui permet de mettre √† jour les √©l√©ments et renvoie les codes HTTP 200 \"OK\" en cas de succ√®s.\n+Par exemple, disons que vous voulez avoir un *chemin d'acc√®s* qui permet de mettre √† jour les √©l√©ments et renvoie les codes HTTP 200 ¬´ OK ¬ª en cas de succ√®s.\n \n-Mais vous voulez aussi qu'il accepte de nouveaux √©l√©ments. Et lorsque les √©l√©ments n'existaient pas auparavant, il les cr√©e et renvoie un code HTTP de 201 \"Cr√©√©\".\n+Mais vous voulez aussi qu'il accepte de nouveaux √©l√©ments. Et lorsque les √©l√©ments n'existaient pas auparavant, il les cr√©e et renvoie un code HTTP de 201 ¬´ Cr√©√© ¬ª.\n \n Pour y parvenir, importez `JSONResponse` et renvoyez-y directement votre contenu, en d√©finissant le `status_code` que vous souhaitez¬†:\n \n-{* ../../docs_src/additional_status_codes/tutorial001.py hl[4,25] *}\n+{* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n-/// warning | Attention\n+/// warning | Alertes\n \n Lorsque vous renvoyez une `Response` directement, comme dans l'exemple ci-dessus, elle sera renvoy√©e directement.\n \n Elle ne sera pas s√©rialis√©e avec un mod√®le.\n \n-Assurez-vous qu'il contient les donn√©es souhait√©es et que les valeurs soient dans un format JSON valides (si vous utilisez une `JSONResponse`).\n+Assurez-vous qu'il contient les donn√©es souhait√©es et que les valeurs sont dans un format JSON valide (si vous utilisez une `JSONResponse`).\n \n ///\n \n /// note | D√©tails techniques\n \n Vous pouvez √©galement utiliser `from starlette.responses import JSONResponse`.\n \n-Pour plus de commodit√©s, **FastAPI** fournit les objets `starlette.responses` sous forme d'un alias accessible par `fastapi.responses`. Mais la plupart des r√©ponses disponibles proviennent directement de Starlette. Il en est de m√™me avec l'objet `statut`.\n+Pour plus de commodit√©s, **FastAPI** fournit les objets `starlette.responses` sous forme d'un alias accessible par `fastapi.responses`. Mais la plupart des r√©ponses disponibles proviennent directement de Starlette. Il en est de m√™me avec `status`.\n \n ///\n \n-##¬†Documents OpenAPI et API\n+## Documents OpenAPI et API { #openapi-and-api-docs }\n \n Si vous renvoyez directement des codes HTTP et des r√©ponses suppl√©mentaires, ils ne seront pas inclus dans \n\n```\n\n```diff\n@@ -1,27 +1,21 @@\n-# Guide de l'utilisateur avanc√©\n+# Guide de l'utilisateur avanc√© { #advanced-user-guide }\n \n-## Caract√©ristiques suppl√©mentaires\n+## Caract√©ristiques suppl√©mentaires { #additional-features }\n \n Le [Tutoriel - Guide de l'utilisateur](../tutorial/index.md){.internal-link target=_blank} devrait suffire √† vous faire d√©couvrir toutes les fonctionnalit√©s principales de *", "output": "Changes look good. This PR implements: üåê Update translations for fr (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 321}
{"instruction": "Review the following code changes: üåê Update translations for tr (add-missing)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# LLM test dosyasƒ± { #llm-test-file }\n+\n+Bu dok√ºman, dok√ºmantasyonu √ßeviren <abbr title=\"Large Language Model - B√ºy√ºk Dil Modeli\">LLM</abbr>'nin `scripts/translate.py` i√ßindeki `general_prompt`'u ve `docs/{language code}/llm-prompt.md` i√ßindeki dile √∂zel prompt'u anlayƒ±p anlamadƒ±ƒüƒ±nƒ± test eder. Dile √∂zel prompt, `general_prompt`'a eklenir.\n+\n+Buraya eklenen testler, dile √∂zel prompt'larƒ± tasarlayan herkes tarafƒ±ndan g√∂r√ºlecektir.\n+\n+≈ûu ≈üekilde kullanƒ±n:\n+\n+* Dile √∂zel bir prompt bulundurun: `docs/{language code}/llm-prompt.md`.\n+* Bu dok√ºmanƒ±n hedeflediƒüiniz dile sƒ±fƒ±rdan yeni bir √ßevirisini yapƒ±n (√∂rneƒüin `translate.py` i√ßindeki `translate-page` komutu). Bu, √ßeviriyi `docs/{language code}/docs/_llm-test.md` altƒ±nda olu≈üturur.\n+* √áeviride her ≈üeyin yolunda olup olmadƒ±ƒüƒ±nƒ± kontrol edin.\n+* Gerekirse dile √∂zel prompt'u, genel prompt'u veya ƒ∞ngilizce dok√ºmanƒ± iyile≈ütirin.\n+* Ardƒ±ndan √ßeviride kalan sorunlarƒ± elle d√ºzeltin; b√∂ylece iyi bir √ßeviri elde edin.\n+* ƒ∞yi √ßeviri yerindeyken yeniden √ßeviri yapƒ±n. ƒ∞deal sonu√ß, LLM'nin artƒ±k √ßeviride hi√ßbir deƒüi≈üiklik yapmamasƒ±dƒ±r. Bu da genel prompt'un ve dile √∂zel prompt'un olabilecek en iyi h√¢le geldiƒüi anlamƒ±na gelir (bazen rastgele gibi g√∂r√ºnen birka√ß deƒüi≈üiklik yapabilir; √ß√ºnk√º <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM'ler deterministik algoritmalar deƒüildir</a>).\n+\n+Testler:\n+\n+## Code snippets { #code-snippets }\n+\n+//// tab | Test\n+\n+Bu bir code snippet: `foo`. Bu da ba≈üka bir code snippet: `bar`. Bir tane daha: `baz quux`.\n+\n+////\n+\n+//// tab | Bilgi\n+\n+Code snippet'lerin i√ßeriƒüi olduƒüu gibi bƒ±rakƒ±lmalƒ±dƒ±r.\n+\n+`script/translate.py` i√ßindeki genel prompt'ta `### Content of code snippets` b√∂l√ºm√ºne bakƒ±n.\n+\n+////\n+\n+## Alƒ±ntƒ±lar { #quotes }\n+\n+//// tab | Test\n+\n+D√ºn bir arkada≈üƒ±m ≈üunu yazdƒ±: \"If you spell incorrectly correctly, you have spelled it incorrectly\". Ben de ≈üunu yanƒ±tladƒ±m: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\".\n+\n+/// note | Not\n+\n+LLM muhtemelen bunu yanlƒ±≈ü √ßevirecektir. Yeniden √ßeviri yapƒ±ldƒ±ƒüƒ±nda d√ºzeltilmi≈ü √ßeviriyi koruyup korumadƒ±ƒüƒ± √∂nemlidir.\n+\n+///\n+\n+////\n+\n+//// tab | Bilgi\n+\n+Prompt tasarlayan ki≈üi, d√ºz tƒ±rnaklarƒ± tipografik tƒ±rnaklara d√∂n√º≈üt√ºr√ºp d√∂n√º≈üt√ºrmemeyi se√ßebilir. Olduƒüu gibi bƒ±rakmak da uygundur.\n+\n+√ñrneƒüin `docs/de/llm-prompt.md` i√ßindeki `### Quotes` b√∂l√ºm√ºne bakƒ±n.\n+\n+////\n+\n+## Code snippet'lerde alƒ±ntƒ±lar { #quotes-in-code-snippets }\n+\n+//// tab | Test\n+\n+`pip install \"foo[bar]\"`\n+\n+Code snippet'lerde string literal √∂rnekleri: `\"this\"`, `'that'`.\n+\n+Code snippet'lerde string literal i√ßin zor bir √∂rnek: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+Hardcore: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | Bilgi\n+\n+... Ancak code snippet'lerin i√ßindeki tƒ±rnaklar olduƒüu gibi kalmalƒ±dƒ±r.\n+\n+////\n+\n+##\n\n```\n\n```diff\n@@ -0,0 +1,247 @@\n+# OpenAPI'de Ek Response'lar { #additional-responses-in-openapi }\n+\n+/// warning | Uyarƒ±\n+\n+Bu konu olduk√ßa ileri seviye bir konudur.\n+\n+**FastAPI**'ye yeni ba≈ülƒ±yorsanƒ±z buna ihtiya√ß duymayabilirsiniz.\n+\n+///\n+\n+Ek status code'lar, media type'lar, a√ßƒ±klamalar vb. ile ek response'lar tanƒ±mlayabilirsiniz.\n+\n+Bu ek response'lar OpenAPI ≈üemasƒ±na dahil edilir; dolayƒ±sƒ±yla API dok√ºmanlarƒ±nda da g√∂r√ºn√ºrler.\n+\n+Ancak bu ek response'lar i√ßin, status code'unuzu ve i√ßeriƒüinizi vererek `JSONResponse` gibi bir `Response`'u doƒürudan d√∂nd√ºrd√ºƒü√ºn√ºzden emin olmanƒ±z gerekir.\n+\n+## `model` ile Ek Response { #additional-response-with-model }\n+\n+*Path operation decorator*'larƒ±nƒ±za `responses` adlƒ± bir parametre ge√ßebilirsiniz.\n+\n+Bu parametre bir `dict` alƒ±r: anahtarlar her response i√ßin status code'lardƒ±r (`200` gibi), deƒüerler ise her birine ait bilgileri i√ßeren ba≈üka `dict`'lerdir.\n+\n+Bu response `dict`'lerinin her birinde, `response_model`'e benzer ≈üekilde bir Pydantic model i√ßeren `model` anahtarƒ± olabilir.\n+\n+**FastAPI** bu modeli alƒ±r, JSON Schema'sƒ±nƒ± √ºretir ve OpenAPI'de doƒüru yere ekler.\n+\n+√ñrneƒüin, `404` status code'u ve `Message` Pydantic model'i ile ba≈üka bir response tanƒ±mlamak i√ßin ≈üunu yazabilirsiniz:\n+\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+\n+/// note | Not\n+\n+`JSONResponse`'u doƒürudan d√∂nd√ºrmeniz gerektiƒüini unutmayƒ±n.\n+\n+///\n+\n+/// info | Bilgi\n+\n+`model` anahtarƒ± OpenAPI'nin bir par√ßasƒ± deƒüildir.\n+\n+**FastAPI** buradaki Pydantic model'i alƒ±r, JSON Schema'yƒ± √ºretir ve doƒüru yere yerle≈ütirir.\n+\n+Doƒüru yer ≈üurasƒ±dƒ±r:\n+\n+* Deƒüeri ba≈üka bir JSON nesnesi (`dict`) olan `content` anahtarƒ±nƒ±n i√ßinde:\n+    * Media type anahtarƒ± (√∂rn. `application/json`) bulunur; bunun deƒüeri ba≈üka bir JSON nesnesidir ve onun i√ßinde:\n+        * Deƒüeri model'den gelen JSON Schema olan `schema` anahtarƒ± vardƒ±r; doƒüru yer burasƒ±dƒ±r.\n+            * **FastAPI** bunu doƒürudan g√∂mmek yerine OpenAPI'deki ba≈üka bir yerde bulun", "output": "Changes look good. This PR implements: üåê Update translations for tr (add-missing)", "source": "pr", "type": "code_review", "pr_number": 320}
{"instruction": "Review the following code changes: üìù Update docs for translations", "input": "```diff\n@@ -179,19 +179,23 @@ as Uvicorn by default will use the port `8000`, the documentation on port `8008`\n \n Help with translations is VERY MUCH appreciated! And it can't be done without the help from the community. üåé üöÄ\n \n-Here are the steps to help with translations.\n+Translation pull requests are made by LLMs guided with prompts designed by the FastAPI team together with the community of native speakers for each supported language.\n \n-#### Translation PRs\n+#### LLM Prompt per Language\n \n-Translation pull requests are made by LLMs guided with prompts designed by the FastAPI team together with the community of native speakers for each supported language.\n+Each language has a directory: <a href=\"https://github.com/fastapi/fastapi/tree/master/docs\" class=\"external-link\" target=\"_blank\">https://github.com/fastapi/fastapi/tree/master/docs</a>, in it you can see a file `llm-prompt.md` with the prompt specific for that language.\n+\n+For example, for Spanish, the prompt is at: <a href=\"https://github.com/fastapi/fastapi/blob/master/docs/es/llm-prompt.md\" class=\"external-link\" target=\"_blank\">`docs/es/llm-prompt.md`</a>.\n+\n+If you see mistakes in your language, you can make suggestions to the prompt in that file for your language, and request the specific pages you would like to re-generate after the changes.\n \n-These translations are normally still reviewed by native speakers, and here's where you can help!\n+#### Reviewing Translation PRs\n \n-* Check the currently <a href=\"https://github.com/fastapi/fastapi/pulls\" class=\"external-link\" target=\"_blank\">existing pull requests</a> for your language. You can filter the pull requests by the ones with the label for your language. For example, for Spanish, the label is <a href=\"https://github.com/fastapi/fastapi/pulls?q=is%3Aopen+sort%3Aupdated-desc+label%3Alang-es+label%3Aawaiting-review\" class=\"external-link\" target=\"_blank\">`lang-es`</a>.\n+You can also check the currently <a href=\"https://github.com/fastapi/fastapi/pulls\" class=\"external-link\" target=\"_blank\">existing pull requests</a> for your language. You can filter the pull requests by the ones with the label for your language. For example, for Spanish, the label is <a href=\"https://github.com/fastapi/fastapi/pulls?q=is%3Aopen+sort%3Aupdated-desc+label%3Alang-es+label%3Aawaiting-review\" class=\"external-link\" target=\"_blank\">`lang-es`</a>.\n \n-* When reviewing a pull request, it's better not to suggest changes in the same pull request, because it is LLM generated, and it won't be possible to make sure that small individual changes are replicated in other similar sections, or that they are preserved when translating the same content again.\n+When reviewing a pull request, it's better not to suggest changes in the same pull request, because it is LLM generated, and it won't be possible to make sure that small individual changes are replicated in other similar sections, or that they are preserved when translating the same content again.\n \n-* Instead of adding sugg\n\n```", "output": "Changes look good. This PR implements: üìù Update docs for translations", "source": "pr", "type": "code_review", "pr_number": 319}
{"instruction": "Review the following code changes: üåê Update translations for tr (update-outdated)", "input": "```diff\n@@ -1,18 +1,34 @@\n # WSGI'yi Dahil Etme - Flask, Django ve Diƒüerleri { #including-wsgi-flask-django-others }\n \n-WSGI uygulamalarƒ±nƒ± [Sub Applications - Mounts](sub-applications.md){.internal-link target=_blank}, [Behind a Proxy](behind-a-proxy.md){.internal-link target=_blank} b√∂l√ºmlerinde g√∂rd√ºƒü√ºn√ºz gibi mount edebilirsiniz.\n+WSGI uygulamalarƒ±nƒ± [Alt Uygulamalar - Mount Etme](sub-applications.md){.internal-link target=_blank}, [Bir Proxy Arkasƒ±nda](behind-a-proxy.md){.internal-link target=_blank} b√∂l√ºmlerinde g√∂rd√ºƒü√ºn√ºz gibi mount edebilirsiniz.\n \n Bunun i√ßin `WSGIMiddleware`'ƒ± kullanabilir ve bunu WSGI uygulamanƒ±zƒ± (√∂rneƒüin Flask, Django vb.) sarmalamak i√ßin kullanabilirsiniz.\n \n ## `WSGIMiddleware` Kullanƒ±mƒ± { #using-wsgimiddleware }\n \n-`WSGIMiddleware`'ƒ± import etmeniz gerekir.\n+/// info | Bilgi\n+\n+Bunun i√ßin `a2wsgi` kurulmalƒ±dƒ±r; √∂rneƒüin `pip install a2wsgi` ile.\n+\n+///\n+\n+`WSGIMiddleware`'ƒ± `a2wsgi` paketinden import etmeniz gerekir.\n \n Ardƒ±ndan WSGI (√∂rn. Flask) uygulamasƒ±nƒ± middleware ile sarmalayƒ±n.\n \n Ve sonra bunu bir path'in altƒ±na mount edin.\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note | Not\n+\n+√ñnceden, `fastapi.middleware.wsgi` i√ßindeki `WSGIMiddleware`'ƒ±n kullanƒ±lmasƒ± √∂neriliyordu, ancak artƒ±k kullanƒ±mdan kaldƒ±rƒ±ldƒ±.\n+\n+Bunun yerine `a2wsgi` paketini kullanmanƒ±z √∂nerilir. Kullanƒ±m aynƒ±dƒ±r.\n+\n+Sadece `a2wsgi` paketinin kurulu olduƒüundan emin olun ve `WSGIMiddleware`'ƒ± `a2wsgi` i√ßinden doƒüru ≈üekilde import edin.\n+\n+///\n \n ## Kontrol Edelim { #check-it }\n \n\n```\n\n```diff\n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n ≈ûu i√ßerikle `main.py` adƒ±nda bir dosya olu≈üturalƒ±m:\n \n \n```", "output": "Changes look good. This PR implements: üåê Update translations for tr (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 318}
{"instruction": "Review the following code changes: üåê Update translations for es (update-outdated)", "input": "```diff\n@@ -2,17 +2,33 @@\n \n Puedes montar aplicaciones WSGI como viste con [Sub Aplicaciones - Mounts](sub-applications.md){.internal-link target=_blank}, [Detr√°s de un Proxy](behind-a-proxy.md){.internal-link target=_blank}.\n \n-Para eso, puedes usar `WSGIMiddleware` y usarlo para envolver tu aplicaci√≥n WSGI, por ejemplo, Flask, Django, etc.\n+Para eso, puedes usar el `WSGIMiddleware` y usarlo para envolver tu aplicaci√≥n WSGI, por ejemplo, Flask, Django, etc.\n \n ## Usando `WSGIMiddleware` { #using-wsgimiddleware }\n \n-Necesitas importar `WSGIMiddleware`.\n+/// info | Informaci√≥n\n+\n+Esto requiere instalar `a2wsgi`, por ejemplo con `pip install a2wsgi`.\n+\n+///\n+\n+Necesitas importar `WSGIMiddleware` de `a2wsgi`.\n \n Luego envuelve la aplicaci√≥n WSGI (p. ej., Flask) con el middleware.\n \n Y luego m√≥ntala bajo un path.\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note | Nota\n+\n+Anteriormente, se recomendaba usar `WSGIMiddleware` de `fastapi.middleware.wsgi`, pero ahora est√° deprecado.\n+\n+Se aconseja usar el paquete `a2wsgi` en su lugar. El uso sigue siendo el mismo.\n+\n+Solo aseg√∫rate de tener instalado el paquete `a2wsgi` e importar `WSGIMiddleware` correctamente desde `a2wsgi`.\n+\n+///\n \n ## Revisa { #check-it }\n \n\n```\n\n```diff\n@@ -145,8 +145,6 @@ Existen otros formatos y herramientas para definir e instalar dependencias de pa\n * Crea un archivo `main.py` con:\n \n \n```\n\n```diff\n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n Crea un archivo `main.py` con:\n \n \n```\n\n```diff\n@@ -101,13 +101,13 @@ Por supuesto, tambi√©n puedes declarar par√°metros adicionales de query siempre\n Como, por defecto, los valores singulares se interpretan como par√°metros de query, no tienes que a√±adir expl√≠citamente un `Query`, solo puedes hacer:\n \n \n```\n\n```diff\n@@ -52,7 +52,7 @@ En estos casos, podr√≠a tener sentido almacenar las tags en un `Enum`.\n \n Puedes a√±adir un `summary` y `description`:\n \n-{* ../../docs_src/path_operation_configuration/tutorial003_py310.py hl[18:19] *}\n+{* ../../docs_src/path_operation_configuration/tutorial003_py310.py hl[17:18] *}\n \n ## Descripci√≥n desde docstring { #description-from-docstring }\n \n@@ -70,7 +70,7 @@ Ser√° usado en la documentaci√≥n interactiva:\n \n Puedes especificar la descripci√≥n del response con el par√°metro `response_description`:\n \n-{* ../../docs_src/path_operation_configuration/tutorial005_py310.py hl[19] *}\n+{* ../../docs_src/path_operation_configuration/tutorial005_py310.py hl[18] *}\n \n /// info | Informaci√≥n\n \n\n```", "output": "Changes look good. This PR implements: üåê Update translations for es (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 317}
{"instruction": "Review the following code changes: üåê Update translations for ko (update-outdated)", "input": "```diff\n@@ -79,13 +79,13 @@ checker(q=\"somequery\")\n \n ### `yield`ÏôÄ `scope`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ± { #dependencies-with-yield-and-scope }\n \n-0.121.0 Î≤ÑÏ†ÑÏóêÏÑú FastAPIÎäî `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±Ïóê ÎåÄÌï¥ `Depends(scope=\"function\")` ÏßÄÏõêÏùÑ Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§.\n+0.121.0 Î≤ÑÏ†ÑÏóêÏÑú FastAPIÎäî `Depends(scope=\"function\")` ÏßÄÏõêÏùÑ Ï∂îÍ∞ÄÌñàÏäµÎãàÎã§.\n \n `Depends(scope=\"function\")`Î•º ÏÇ¨Ïö©ÌïòÎ©¥, `yield` Ïù¥ÌõÑÏùò Ï¢ÖÎ£å ÏΩîÎìúÎäî *Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*Í∞Ä ÎÅùÎÇú ÏßÅÌõÑ(ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Ïóê ÏùëÎãµÏù¥ Î∞òÌôòÎêòÍ∏∞ Ï†Ñ)Ïóê Ïã§ÌñâÎê©ÎãàÎã§.\n \n Í∑∏Î¶¨Í≥† `Depends(scope=\"request\")`(Í∏∞Î≥∏Í∞í)Î•º ÏÇ¨Ïö©ÌïòÎ©¥, `yield` Ïù¥ÌõÑÏùò Ï¢ÖÎ£å ÏΩîÎìúÎäî ÏùëÎãµÏù¥ Ï†ÑÏÜ°Îêú ÌõÑÏóê Ïã§ÌñâÎê©ÎãàÎã§.\n \n-ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ [Dependencies with `yield` - Early exit and `scope`](../tutorial/dependencies/dependencies-with-yield.md#early-exit-and-scope) Î¨∏ÏÑúÎ•º Ï∞∏Í≥†ÌïòÏÑ∏Ïöî.\n+ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ [`yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ± - Ï°∞Í∏∞ Ï¢ÖÎ£åÏôÄ `scope`](../tutorial/dependencies/dependencies-with-yield.md#early-exit-and-scope) Î¨∏ÏÑúÎ•º Ï∞∏Í≥†ÌïòÏÑ∏Ïöî.\n \n ### `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±Í≥º `StreamingResponse`, Í∏∞Ïà† ÏÑ∏Î∂ÄÏÇ¨Ìï≠ { #dependencies-with-yield-and-streamingresponse-technical-details }\n \n@@ -133,7 +133,7 @@ SQLModel(ÎòêÎäî SQLAlchemy)ÏùÑ ÏÇ¨Ïö©ÌïòÎ©¥ÏÑú Ïù¥Îü∞ ÌäπÏ†ï ÏÇ¨Ïö© ÏÇ¨Î°ÄÍ∞Ä \n \n Í∑∏Îü¨Î©¥ ÏÑ∏ÏÖòÏù¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞ÏùÑ Ìï¥Ï†úÌïòÏó¨, Îã§Î•∏ ÏöîÏ≤≠Îì§Ïù¥ Ïù¥Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Îê©ÎãàÎã§.\n \n-`yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±ÏóêÏÑú Ï°∞Í∏∞ Ï¢ÖÎ£åÍ∞Ä ÌïÑÏöîÌïú Îã§Î•∏ ÏÇ¨Ïö© ÏÇ¨Î°ÄÍ∞Ä ÏûàÎã§Î©¥, Ïó¨Îü¨Î∂ÑÏùò Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÇ¨Ïö© ÏÇ¨Î°ÄÏôÄ `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±Ïóê ÎåÄÌïú Ï°∞Í∏∞ Ï¢ÖÎ£åÍ∞Ä Ïñ¥Îñ§ Ï†êÏóêÏÑú Ïù¥ÎìùÏù¥ ÎêòÎäîÏßÄÎ•º Ìè¨Ìï®Ìï¥ <a href=\"https://github.com/fastapi/fastapi/discussions/new?category=questions\" class=\"external-link\" target=\"_blank\">GitHub Discussion Question</a>ÏùÑ ÏÉùÏÑ±Ìï¥ Ï£ºÏÑ∏Ïöî.\n+`yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±ÏóêÏÑú Ï°∞Í∏∞ Ï¢ÖÎ£åÍ∞Ä ÌïÑÏöîÌïú Îã§Î•∏ ÏÇ¨Ïö© ÏÇ¨Î°ÄÍ∞Ä ÏûàÎã§Î©¥, Ïó¨Îü¨Î∂ÑÏùò Íµ¨Ï≤¥Ï†ÅÏù∏ ÏÇ¨Ïö© ÏÇ¨Î°ÄÏôÄ `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±Ïóê ÎåÄÌïú Ï°∞Í∏∞ Ï¢ÖÎ£åÍ∞Ä Ïñ¥Îñ§ Ï†êÏóêÏÑú Ïù¥ÎìùÏù¥ ÎêòÎäîÏßÄÎ•º Ìè¨Ìï®Ìï¥ <a href=\"https://github.com/fastapi/fastapi/discussions/new?category=questions\" class=\"external-link\" target=\"_blank\">GitHub Discussions ÏßàÎ¨∏</a>ÏùÑ ÏÉùÏÑ±Ìï¥ Ï£ºÏÑ∏Ïöî.\n \n `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±ÏóêÏÑú Ï°∞Í∏∞ Ï¢ÖÎ£åÏóê ÎåÄÌïú ÏÑ§ÎìùÎ†• ÏûàÎäî ÏÇ¨Ïö© ÏÇ¨Î°ÄÍ∞Ä ÏûàÎã§Î©¥, Ï°∞Í∏∞ Ï¢ÖÎ£åÎ•º ÏÑ†ÌÉùÏ†ÅÏúºÎ°ú ÌôúÏÑ±ÌôîÌï† Ïàò ÏûàÎäî ÏÉàÎ°úÏö¥ Î∞©Î≤ïÏùÑ Ï∂îÍ∞ÄÌïòÎäî Í≤ÉÏùÑ Í≥†Î†§ÌïòÍ≤†ÏäµÎãàÎã§.\n \n@@ -145,7 +145,7 @@ FastAPI 0.110.0 Ïù¥Ï†ÑÏóêÎäî `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±ÏùÑ ÏÇ¨Ïö©Ìïú Îã§Ïùå Í∑∏\n \n ### Î∞±Í∑∏ÎùºÏö¥Îìú ÌÉúÏä§ÌÅ¨ÏôÄ `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±, Í∏∞Ïà† ÏÑ∏Î∂ÄÏÇ¨Ìï≠ { #background-tasks-and-dependencies-with-yield-technical-details }\n \n-FastAPI 0.106.0 Ïù¥Ï†ÑÏóêÎäî `yield` Ïù¥ÌõÑÏóê ÏòàÏô∏Î•º Î∞úÏÉùÏãúÌÇ§Îäî Í≤ÉÏù¥ Î∂àÍ∞ÄÎä•ÌñàÏäµÎãàÎã§. `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±Ïùò Ï¢ÖÎ£å ÏΩîÎìúÎäî ÏùëÎãµÏù¥ Ï†ÑÏÜ°Îêú *ÌõÑÏóê* Ïã§ÌñâÎêòÏóàÍ∏∞ ÎïåÎ¨∏Ïóê, [Exception Handlers](../tutorial/handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank}Í∞Ä Ïù¥ÎØ∏ Ïã§ÌñâÎêú Îí§ÏòÄÏäµÎãàÎã§.\n+FastAPI 0.106.0 Ïù¥Ï†ÑÏóêÎäî `yield` Ïù¥ÌõÑÏóê ÏòàÏô∏Î•º Î∞úÏÉùÏãúÌÇ§Îäî Í≤ÉÏù¥ Î∂àÍ∞ÄÎä•ÌñàÏäµÎãàÎã§. `yield`Í∞Ä ÏûàÎäî ÏùòÏ°¥ÏÑ±Ïùò Ï¢ÖÎ£å ÏΩîÎìúÎäî ÏùëÎãµÏù¥ Ï†ÑÏÜ°Îêú *ÌõÑÏóê* Ïã§ÌñâÎêòÏóàÍ∏∞ ÎïåÎ¨∏Ïóê, [ÏòàÏô∏ Ìï∏Îì§Îü¨](../tutorial/handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank}Í∞Ä Ïù¥ÎØ∏ Ïã§ÌñâÎêú Îí§ÏòÄÏäµÎãàÎã§.\n \n Ïù¥Îäî Ï£ºÎ°ú Î∞±Í∑∏ÎùºÏö¥Îìú ÌÉúÏä§ÌÅ¨ ÏïàÏóêÏÑú ÏùòÏ°¥ÏÑ±Ïù¥ \"yield\"Ìïú ÎèôÏùºÌïú Í∞ùÏ≤¥Îì§ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å ÌïòÍ∏∞ ÏúÑÌïú ÏÑ§Í≥ÑÏòÄÏäµÎãàÎã§. Î∞±Í∑∏ÎùºÏö¥Îìú ÌÉúÏä§ÌÅ¨Í∞Ä ÎÅùÎÇú Îí§Ïóê Ï¢ÖÎ£å ÏΩîÎìúÍ∞Ä Ïã§ÌñâÎêòÏóàÍ∏∞ ÎïåÎ¨∏ÏûÖÎãàÎã§.\n \n\n```\n\n```diff\n@@ -1,32 +1,48 @@\n-# WSGI Ìè¨Ìï®ÌïòÍ∏∞ - Flask, Django Í∑∏ Ïô∏ { #including-wsgi-flask-django-others }\n+# WSGI Ìè¨Ìï®ÌïòÍ∏∞ - Flask, Django Îì± { #including-wsgi-flask-django-others }\n \n-[ÏÑúÎ∏å ÏùëÏö© ÌîÑÎ°úÍ∑∏Îû® - ÎßàÏö¥Ìä∏](sub-applications.md){.internal-link target=_blank}, [ÌîÑÎ°ùÏãú Îí§Ìé∏ÏóêÏÑú](behind-a-proxy.md){.internal-link target=_blank}ÏóêÏÑú Î≥¥ÏïòÎìØÏù¥ WSGI ÏùëÏö© ÌîÑÎ°úÍ∑∏Îû®Îì§ÏùÑ ÎßàÏö¥Ìä∏ Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+[ÏÑúÎ∏å Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò - ÎßàÏö¥Ìä∏](sub-applications.md){.internal-link target=_blank}, [ÌîÑÎ°ùÏãú Îí§ÏóêÏÑú](behind-a-proxy.md){.internal-link target=_blank}ÏóêÏÑú Î≥∏ Í≤ÉÏ≤òÎüº WSGI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÎßàÏö¥Ìä∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n-Ïù¥Î•º ÏúÑÌï¥ `WSGIMiddleware`Î•º ÏÇ¨Ïö©Ìï¥ WSGI ÏùëÏö© ÌîÑÎ°úÍ∑∏Îû®(Ïòà: Flask, Django Îì±)ÏùÑ Í∞êÏåÄ Ïàò ÏûàÏäµÎãàÎã§.\n+Ïù¥Î•º ÏúÑÌï¥ `WSGIMiddleware`Î•º ÏÇ¨Ïö©Ìï¥ WSGI Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖò(Ïòà: Flask, Django Îì±)ÏùÑ Í∞êÏåÄ Ïàò ÏûàÏäµÎãàÎã§.\n \n ## `WSGIMiddleware` ÏÇ¨Ïö©ÌïòÍ∏∞ { #using-wsgimiddleware }\n \n-`WSGIMiddleware`Î•º Î∂àÎü¨ÏôÄÏïº Ìï©ÎãàÎã§.\n+/// info | Ï†ïÎ≥¥\n \n-Í∑∏Îü∞ Îã§Ïùå, WSGI(Ïòà: Flask) ÏùëÏö© ÌîÑÎ°úÍ∑∏Îû®ÏùÑ ÎØ∏Îì§Ïõ®Ïñ¥Î°ú Ìè¨Ïû•Ìï©ÎãàÎã§.\n+Ïù¥Î•º ÏÇ¨Ïö©ÌïòÎ†§Î©¥ `a2wsgi`Î•º ÏÑ§ÏπòÌï¥Ïïº Ìï©ÎãàÎã§. Ïòà: `pip install a2wsgi`\n \n-Í∑∏ ÌõÑ, Ìï¥Îãπ Í≤ΩÎ°úÏóê ÎßàÏö¥Ìä∏Ìï©ÎãàÎã§.\n+///\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+`a2wsgi`ÏóêÏÑú `WSGIMiddleware`Î•º import Ìï¥Ïïº Ìï©ÎãàÎã§.\n+\n+Í∑∏Îü∞ Îã§Ïùå, WSGI(Ïòà: Flask) Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÎØ∏Îì§Ïõ®Ïñ¥Î°ú Í∞êÏåâÎãàÎã§.\n+\n+Í∑∏Î¶¨Í≥† Ìï¥Îãπ Í≤ΩÎ°úÏóê ÎßàÏö¥Ìä∏Ìï©ÎãàÎã§.\n+\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note | Ï∞∏Í≥†\n+\n+Ïù¥Ï†ÑÏóê `fastapi.middleware.wsgi`Ïùò `WSGIMiddleware` ÏÇ¨Ïö©ÏùÑ Í∂åÏû•ÌñàÏßÄÎßå Ïù¥Ï†úÎäî Îçî Ïù¥ÏÉÅ Í∂åÏû•ÎêòÏßÄ ÏïäÏäµÎãàÎã§.\n+\n+ÎåÄÏã† `a2wsgi` Ìå®ÌÇ§ÏßÄ ÏÇ¨Ïö©ÏùÑ Í∂åÏû•Ìï©ÎãàÎã§. ÏÇ¨Ïö© Î∞©Î≤ïÏùÄ ÎèôÏùºÌï©ÎãàÎã§.\n+\n+Îã®, `a2wsgi` Ìå®ÌÇ§ÏßÄÍ∞Ä ÏÑ§ÏπòÎêòÏñ¥ ÏûàÍ≥† `a2wsgi`ÏóêÏÑú `WSGIMiddleware`Î•º Ïò¨Î∞îÎ•¥Í≤å import ÌïòÎäîÏßÄÎßå ÌôïÏù∏ÌïòÏÑ∏Ïöî.\n+\n+///\n \n ## ÌôïÏù∏ÌïòÍ∏∞ { #check-it }\n \n-Ïù¥Ï†ú `/v1/` Í≤ΩÎ°úÏóê ÏûàÎäî Î™®Îì† ÏöîÏ≤≠ÏùÄ Flask ÏùëÏö© ÌîÑÎ°úÍ∑∏Îû®ÏóêÏÑú Ï≤òÎ¶¨Îê©ÎãàÎã§.\n+Ïù¥Ï†ú `/v1/` Í≤ΩÎ°úÏóê ÏûàÎäî Î™®Îì† ÏöîÏ≤≠ÏùÄ Flask Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóêÏÑú Ï≤òÎ¶¨Îê©ÎãàÎã§.\n \n Í∑∏Î¶¨Í≥† ÎÇòÎ®∏ÏßÄÎäî **FastAPI**Ïóê ÏùòÌï¥ Ï≤òÎ¶¨Îê©ÎãàÎã§.\n \n-Ïã§ÌñâÌïòÎ©¥ <a href=\"http://localhost:8000/v1/\" class=\"external-link\" target=\"_blank\">http://localhost:8000/v1/</a>ÏúºÎ°ú Ïù¥ÎèôÌï¥ÏÑú FlaskÏùò ÏùëÎãµÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§:\n+Ïã§ÌñâÌïòÍ≥† <a href=\"http://localhost:8000/v1/\" class=\"external-link\" target=\"_blank\">http://localhost:8000/v1/</a>Î°ú Ïù¥ÎèôÌïòÎ©¥ FlaskÏùò ÏùëÎãµÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§:\n \n \n```\n\n```diff\n@@ -145,8 +145,6 @@ Successfully installed fastapi pydantic\n * Îã§Ïùå ÎÇ¥Ïö©ÏúºÎ°ú `main.py` ÌååÏùºÏùÑ ÎßåÎì≠ÎãàÎã§:\n \n \n```\n\n```diff\n@@ -40,7 +40,7 @@ FastAPIÎäî ÌòÑÎåÄÏ†ÅÏù¥Í≥†, Îπ†Î•¥Î©∞(Í≥†ÏÑ±Îä•), ÌååÏù¥Ïç¨ ÌëúÏ§Ä ÌÉÄÏûÖ ÌûåÌä∏\n * **Îπ†Î¶Ñ**: (StarletteÍ≥º Pydantic ÎçïÎ∂ÑÏóê) **NodeJS** Î∞è **Go**ÏôÄ ÎåÄÎì±Ìï† Ï†ïÎèÑÎ°ú Îß§Ïö∞ ÎÜíÏùÄ ÏÑ±Îä•. [ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Í∞ÄÏû• Îπ†Î•∏ ÌååÏù¥Ïç¨ ÌîÑÎ†àÏûÑÏõåÌÅ¨ Ï§ë ÌïòÎÇò](#performance).\n * **Îπ†Î•∏ ÏΩîÎìú ÏûëÏÑ±**: ÏïΩ 200%ÏóêÏÑú 300%ÍπåÏßÄ Í∏∞Îä• Í∞úÎ∞ú ÏÜçÎèÑ Ï¶ùÍ∞Ä. *\n * **Ï†ÅÏùÄ Î≤ÑÍ∑∏**: ÏÇ¨Îûå(Í∞úÎ∞úÏûê)Ïóê ÏùòÌïú ÏóêÎü¨ ÏïΩ 40% Í∞êÏÜå. *\n-* **ÏßÅÍ¥ÄÏ†Å**: ÌõåÎ•≠Ìïú Ìé∏ÏßëÍ∏∞ ÏßÄÏõê. Î™®Îì† Í≥≥ÏóêÏÑú <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">ÏûêÎèôÏôÑÏÑ±</abbr>. Ï†ÅÏùÄ ÎîîÎ≤ÑÍπÖ ÏãúÍ∞Ñ.\n+* **ÏßÅÍ¥ÄÏ†Å**: ÌõåÎ•≠Ìïú Ìé∏ÏßëÍ∏∞ ÏßÄÏõê. Î™®Îì† Í≥≥ÏóêÏÑú <abbr title=\"Îã§Î•∏ ÎßêÎ°úÎäî: auto-complete, autocompletion, IntelliSense\">ÏûêÎèôÏôÑÏÑ±</abbr>. Ï†ÅÏùÄ ÎîîÎ≤ÑÍπÖ ÏãúÍ∞Ñ.\n * **Ïâ¨ÏõÄ**: ÏâΩÍ≤å ÏÇ¨Ïö©ÌïòÍ≥† Î∞∞Ïö∞ÎèÑÎ°ù ÏÑ§Í≥Ñ. Ï†ÅÏùÄ Î¨∏ÏÑú ÏùΩÍ∏∞ ÏãúÍ∞Ñ.\n * **ÏßßÏùå**: ÏΩîÎìú Ï§ëÎ≥µ ÏµúÏÜåÌôî. Í∞Å Îß§Í∞úÎ≥ÄÏàò ÏÑ†Ïñ∏Ïùò Ïó¨Îü¨ Í∏∞Îä•. Ï†ÅÏùÄ Î≤ÑÍ∑∏.\n * **Í≤¨Í≥†Ìï®**: Ï§ÄÎπÑÎêú ÌîÑÎ°úÎçïÏÖò Ïö© ÏΩîÎìúÎ•º ÏñªÏúºÏã≠ÏãúÏò§. ÏûêÎèô ÎåÄÌôîÌòï Î¨∏ÏÑúÏôÄ Ìï®Íªò.\n@@ -127,7 +127,7 @@ FastAPIÎäî ÌòÑÎåÄÏ†ÅÏù¥Í≥†, Îπ†Î•¥Î©∞(Í≥†ÏÑ±Îä•), ÌååÏù¥Ïç¨ ÌëúÏ§Ä ÌÉÄÏûÖ ÌûåÌä∏\n \n <a href=\"https://typer", "output": "Changes look good. This PR implements: üåê Update translations for ko (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 316}
{"instruction": "Review the following code changes: üåê Update translations for pt (update-outdated)", "input": "```diff\n@@ -148,7 +148,7 @@ Antes do FastAPI 0.106.0, lan√ßar exce√ß√µes ap√≥s o `yield` n√£o era poss√≠vel,\n \n Isso foi projetado assim principalmente para permitir o uso dos mesmos objetos \"yielded\" por depend√™ncias dentro de tarefas em segundo plano, porque o c√≥digo de sa√≠da seria executado depois que as tarefas em segundo plano fossem conclu√≠das.\n \n-Isso foi alterado no FastAPI 0.106.0 com a inten√ß√£o de n√£o manter recursos enquanto se espera a resposta percorrer a rede.\n+Isso foi alterado no FastAPI 0.106.0 com a inten√ß√£o de n√£o manter recursos enquanto se espera a response percorrer a rede.\n \n /// tip | Dica\n \n\n```\n\n```diff\n@@ -6,13 +6,29 @@ Para isso, voc√™ pode utilizar o `WSGIMiddleware` para encapsular a sua aplica√ß\n \n ## Usando `WSGIMiddleware` { #using-wsgimiddleware }\n \n-Voc√™ precisa importar o `WSGIMiddleware`.\n+/// info | Informa√ß√£o\n+\n+Isso requer instalar `a2wsgi`, por exemplo com `pip install a2wsgi`.\n+\n+///\n+\n+Voc√™ precisa importar o `WSGIMiddleware` de `a2wsgi`.\n \n Em seguida, encapsule a aplica√ß√£o WSGI (e.g. Flask) com o middleware.\n \n E ent√£o monte isso sob um path.\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note | Nota\n+\n+Anteriormente, recomendava-se usar `WSGIMiddleware` de `fastapi.middleware.wsgi`, mas agora est√° descontinuado.\n+\n+√â aconselh√°vel usar o pacote `a2wsgi` em seu lugar. O uso permanece o mesmo.\n+\n+Apenas certifique-se de que o pacote `a2wsgi` est√° instalado e importe `WSGIMiddleware` corretamente de `a2wsgi`.\n+\n+///\n \n ## Confira { #check-it }\n \n\n```\n\n```diff\n@@ -145,8 +145,6 @@ H√° outros formatos e ferramentas para definir e instalar depend√™ncias de pacot\n * Crie um arquivo `main.py` com:\n \n \n```\n\n```diff\n@@ -33,7 +33,7 @@\n \n ---\n \n-FastAPI √© um moderno e r√°pido (alta performance) _framework web_ para constru√ß√£o de APIs com Python, baseado nos _type hints_ padr√µes do Python.\n+FastAPI √© um moderno e r√°pido (alta performance) framework web para constru√ß√£o de APIs com Python, baseado nos type hints padr√µes do Python.\n \n Os recursos chave s√£o:\n \n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n Crie um arquivo `main.py` com:\n \n \n```\n\n```diff\n@@ -101,13 +101,13 @@ Obviamente, voc√™ tamb√©m pode declarar par√¢metros de consulta assim que voc√™\n Dado que, por padr√£o, valores singulares s√£o interpretados como par√¢metros de consulta, voc√™ n√£o precisa explicitamente adicionar uma `Query`, voc√™ pode somente:\n \n \n```", "output": "Changes look good. This PR implements: üåê Update translations for pt (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 315}
{"instruction": "Review the following code changes: üåê Update translations for de (update-outdated)", "input": "```diff\n@@ -6,13 +6,29 @@ Dazu k√∂nnen Sie die `WSGIMiddleware` verwenden und damit Ihre WSGI-Anwendung wr\n \n ## `WSGIMiddleware` verwenden { #using-wsgimiddleware }\n \n-Sie m√ºssen `WSGIMiddleware` importieren.\n+/// info | Info\n+\n+Daf√ºr muss `a2wsgi` installiert sein, z. B. mit `pip install a2wsgi`.\n+\n+///\n+\n+Sie m√ºssen `WSGIMiddleware` aus `a2wsgi` importieren.\n \n Wrappen Sie dann die WSGI-Anwendung (z. B. Flask) mit der Middleware.\n \n Und dann mounten Sie das auf einem Pfad.\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note | Hinweis\n+\n+Fr√ºher wurde empfohlen, `WSGIMiddleware` aus `fastapi.middleware.wsgi` zu verwenden, dies ist jetzt deprecatet.\n+\n+Stattdessen wird empfohlen, das Paket `a2wsgi` zu verwenden. Die Nutzung bleibt gleich.\n+\n+Stellen Sie lediglich sicher, dass das Paket `a2wsgi` installiert ist und importieren Sie `WSGIMiddleware` korrekt aus `a2wsgi`.\n+\n+///\n \n ## Es testen { #check-it }\n \n\n```\n\n```diff\n@@ -145,8 +145,6 @@ Es gibt andere Formate und Tools zum Definieren und Installieren von Paketabh√§n\n * Erstellen Sie eine `main.py`-Datei mit:\n \n \n```\n\n```diff\n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n Erstellen Sie eine Datei `main.py` mit:\n \n \n```\n\n```diff\n@@ -1,6 +1,6 @@\n # Body ‚Äì Mehrere Parameter { #body-multiple-parameters }\n \n-Nun, da wir gesehen haben, wie `Path` und `Query` verwendet werden, schauen wir uns fortgeschrittenere Verwendungsm√∂glichkeiten von <abbr title=\"Anfragek√∂rper\">Requestbody</abbr>-Deklarationen an.\n+Nun, da wir gesehen haben, wie `Path` und `Query` verwendet werden, schauen wir uns fortgeschrittenere Verwendungsm√∂glichkeiten von <abbr title=\"Requestbody\">Requestbody</abbr>-Deklarationen an.\n \n ## `Path`-, `Query`- und Body-Parameter vermischen { #mix-path-query-and-body-parameters }\n \n@@ -101,13 +101,13 @@ Nat√ºrlich k√∂nnen Sie auch, wann immer Sie das brauchen, weitere Query-Paramete\n Da einfache Werte standardm√§√üig als Query-Parameter interpretiert werden, m√ºssen Sie `Query` nicht explizit hinzuf√ºgen, Sie k√∂nnen einfach schreiben:\n \n \n```\n\n```diff\n@@ -52,7 +52,7 @@ In diesem Fall macht es Sinn, die Tags in einem `Enum` zu speichern.\n \n Sie k√∂nnen eine <abbr title=\"Zusammenfassung\">`summary`</abbr> und eine <abbr title=\"Beschreibung\">`description`</abbr> hinzuf√ºgen:\n \n-{* ../../docs_src/path_operation_configuration/tutorial003_py310.py hl[18:19] *}\n+{* ../../docs_src/path_operation_configuration/tutorial003_py310.py hl[17:18] *}\n \n ## Beschreibung mittels Docstring { #description-from-docstring }\n \n@@ -70,7 +70,7 @@ Es wird in der interaktiven Dokumentation verwendet:\n \n Sie k√∂nnen die Response mit dem Parameter `response_description` beschreiben:\n \n-{* ../../docs_src/path_operation_configuration/tutorial005_py310.py hl[19] *}\n+{* ../../docs_src/path_operation_configuration/tutorial005_py310.py hl[18] *}\n \n /// info | Info\n \n\n```", "output": "Changes look good. This PR implements: üåê Update translations for de (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 314}
{"instruction": "Fix the following bug: üìù Fix small typo in french documentation", "input": "Fix a typo in french docs: `example` -> `exemple`  and remove a line break that split the IP address (0.0.0.0).", "output": "```diff\n@@ -152,8 +152,7 @@ Vous pouvez d√©sormais utiliser Trio en interne dans votre application. Ou mieux\n \n ## Concepts de d√©ploiement\n \n-Ces exemples lancent le programme serveur (e.g. Uvicorn), d√©marrant **un seul processus**, sur toutes les IPs (`0.0.\n-0.0`) sur un port pr√©d√©fini (par example, `80`).\n+Ces exemples lancent le programme serveur (e.g. Uvicorn), d√©marrant **un seul processus**, sur toutes les IPs (`0.0.0.0`) sur un port pr√©d√©fini (par exemple, `80`).\n \n C'est l'id√©e de base. Mais vous vous pr√©occuperez probablement de certains concepts suppl√©mentaires, tels que ... :\n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 313}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -152,8 +152,7 @@ Vous pouvez d√©sormais utiliser Trio en interne dans votre application. Ou mieux\n \n ## Concepts de d√©ploiement\n \n-Ces exemples lancent le programme serveur (e.g. Uvicorn), d√©marrant **un seul processus**, sur toutes les IPs (`0.0.\n-0.0`) sur un port pr√©d√©fini (par example, `80`).\n+Ces exemples lancent le programme serveur (e.g. Uvicorn), d√©marrant **un seul processus**, sur toutes les IPs (`0.0.0.0`) sur un port pr√©d√©fini (par exemple, `80`).\n \n C'est l'id√©e de base. Mais vous vous pr√©occuperez probablement de certains concepts suppl√©mentaires, tels que ... :\n \n\n```", "output": "Bug: üìù Fix small typo in french documentation\n\nFix a typo in french docs: `example` -> `exemple`  and remove a line break that split the IP address (0.0.0.0).", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 313}
{"instruction": "Review the following code changes: üìù Fix small typo in french documentation", "input": "```diff\n@@ -152,8 +152,7 @@ Vous pouvez d√©sormais utiliser Trio en interne dans votre application. Ou mieux\n \n ## Concepts de d√©ploiement\n \n-Ces exemples lancent le programme serveur (e.g. Uvicorn), d√©marrant **un seul processus**, sur toutes les IPs (`0.0.\n-0.0`) sur un port pr√©d√©fini (par example, `80`).\n+Ces exemples lancent le programme serveur (e.g. Uvicorn), d√©marrant **un seul processus**, sur toutes les IPs (`0.0.0.0`) sur un port pr√©d√©fini (par exemple, `80`).\n \n C'est l'id√©e de base. Mais vous vous pr√©occuperez probablement de certains concepts suppl√©mentaires, tels que ... :\n \n\n```", "output": "Changes look good. This PR implements: üìù Fix small typo in french documentation", "source": "pr", "type": "code_review", "pr_number": 313}
{"instruction": "Review the following code changes: üåê Update translations for fr (translate-page)", "input": "```diff\n@@ -1,167 +1,157 @@\n-# Ex√©cuter un serveur manuellement - Uvicorn\n+# Ex√©cuter un serveur manuellement { #run-a-server-manually }\n \n-La principale chose dont vous avez besoin pour ex√©cuter une application **FastAPI** sur une machine serveur distante est un programme serveur ASGI tel que **Uvicorn**.\n+## Utiliser la commande `fastapi run` { #use-the-fastapi-run-command }\n \n-Il existe 3 principales alternatives¬†:\n+En bref, utilisez `fastapi run` pour servir votre application FastAPI¬†:\n \n-* <a href=\"https://www.uvicorn.dev/\" class=\"external-link\" target=\"_blank\">Uvicorn</a>¬†: un serveur ASGI haute performance.\n-* <a href=\"https://hypercorn.readthedocs.io/\" class=\"external-link\" target=\"_blank\">Hypercorn</a>¬†: un serveur\n-  ASGI compatible avec HTTP/2 et Trio entre autres fonctionnalit√©s.\n-* <a href=\"https://github.com/django/daphne\" class=\"external-link\" target=\"_blank\">Daphne</a>¬†: le serveur ASGI\n-  con√ßu pour Django Channels.\n-\n-## Machine serveur et programme serveur\n-\n-Il y a un petit d√©tail sur les noms √† garder √† l'esprit. üí°\n-\n-Le mot \"**serveur**\" est couramment utilis√© pour d√©signer √† la fois l'ordinateur distant/cloud (la machine physique ou virtuelle) et √©galement le programme qui s'ex√©cute sur cette machine (par exemple, Uvicorn).\n+<div class=\"termy\">\n \n-Gardez cela √† l'esprit lorsque vous lisez \"serveur\" en g√©n√©ral, cela pourrait faire r√©f√©rence √† l'une de ces deux choses.\n+\n```", "output": "Changes look good. This PR implements: üåê Update translations for fr (translate-page)", "source": "pr", "type": "code_review", "pr_number": 312}
{"instruction": "Review the following code changes: ‚ú® Support HTTP QUERY method", "input": "```diff\n@@ -0,0 +1,40 @@\n+#!/usr/bin/env python3\n+\n+\"\"\"\n+Example: Basic QUERY method usage in FastAPI.\n+\n+This example demonstrates how to use the QUERY HTTP method for simple queries.\n+\"\"\"\n+\n+from typing import Optional\n+\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class SimpleQuery(BaseModel):\n+    search_term: str\n+    limit: Optional[int] = 10\n+\n+\n+@app.query(\"/search\")\n+def search_items(query: SimpleQuery):\n+    \"\"\"\n+    Search for items using the QUERY method.\n+\n+    The QUERY method allows sending complex search parameters in the request body\n+    instead of URL parameters, making it ideal for complex queries.\n+    \"\"\"\n+    # Simulate search logic\n+    results = [\n+        f\"Item {i}: {query.search_term}\" for i in range(1, min(query.limit + 1, 6))\n+    ]\n+\n+    return {\n+        \"query\": query.search_term,\n+        \"limit\": query.limit,\n+        \"results\": results,\n+        \"total_found\": len(results),\n+    }\n\n```\n\n```diff\n@@ -0,0 +1,278 @@\n+#!/usr/bin/env python3\n+\n+\"\"\"\n+Example: Advanced QUERY method usage with complex filtering.\n+\n+This example demonstrates the power of the QUERY method for complex data filtering\n+and field selection, similar to GraphQL but using standard HTTP.\n+\"\"\"\n+\n+from typing import Any, Dict, List, Optional\n+\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+# Sample data structure\n+sample_data = [\n+    {\n+        \"id\": 1,\n+        \"name\": \"Math Course\",\n+        \"description\": \"Advanced mathematics\",\n+        \"instructor\": {\n+            \"id\": 101,\n+            \"name\": \"Dr. Smith\",\n+            \"email\": \"smith@university.edu\",\n+            \"bio\": \"Mathematics professor with 20 years experience\",\n+        },\n+        \"topics\": [\n+            {\n+                \"id\": 1,\n+                \"title\": \"Algebra\",\n+                \"difficulty\": \"intermediate\",\n+                \"lessons\": 15,\n+                \"exercises\": [\n+                    {\"id\": 1, \"title\": \"Linear Equations\", \"points\": 10},\n+                    {\"id\": 2, \"title\": \"Quadratic Equations\", \"points\": 15},\n+                ],\n+            },\n+            {\n+                \"id\": 2,\n+                \"title\": \"Calculus\",\n+                \"difficulty\": \"advanced\",\n+                \"lessons\": 20,\n+                \"exercises\": [\n+                    {\"id\": 3, \"title\": \"Derivatives\", \"points\": 20},\n+                    {\"id\": 4, \"title\": \"Integrals\", \"points\": 25},\n+                ],\n+            },\n+        ],\n+        \"tags\": [\"mathematics\", \"algebra\", \"calculus\"],\n+        \"rating\": 4.8,\n+        \"enrolled_students\": 245,\n+    },\n+    {\n+        \"id\": 2,\n+        \"name\": \"Physics Course\",\n+        \"description\": \"Quantum physics fundamentals\",\n+        \"instructor\": {\n+            \"id\": 102,\n+            \"name\": \"Dr. Johnson\",\n+            \"email\": \"johnson@university.edu\",\n+            \"bio\": \"Physics professor specializing in quantum mechanics\",\n+        },\n+        \"topics\": [\n+            {\n+                \"id\": 3,\n+                \"title\": \"Quantum Mechanics\",\n+                \"difficulty\": \"advanced\",\n+                \"lessons\": 25,\n+                \"exercises\": [\n+                    {\"id\": 5, \"title\": \"Wave Functions\", \"points\": 30},\n+                    {\"id\": 6, \"title\": \"Uncertainty Principle\", \"points\": 35},\n+                ],\n+            }\n+        ],\n+        \"tags\": [\"physics\", \"quantum\", \"mechanics\"],\n+        \"rating\": 4.9,\n+        \"enrolled_students\": 156,\n+    },\n+]\n+\n+\n+class FieldSelector(BaseModel):\n+    \"\"\"Define which fields to include in the response.\"\"\"\n+\n+    course_fields: Optional[List[str]] = None\n+    instructor_fields: Optional[List[str]] = None\n+    topic_fields: Optional[List[str]] = None\n+    exercise_fields: Optional[List[str]] = None\n+\n+\n+class QueryFilter(BaseModel):\n+    \"\"\"Define filters for the query.\"\"\"\n+\n+    min_rating: Optional[float] = None\n+    max_rating: Optional[float] = None\n+    difficulty: Opt\n\n```\n\n```diff\n@@ -0,0 +1,352 @@\n+#!/usr/bin/env python3\n+\n+\"\"\"\n+Example: QUERY method implementation matching the original GitHub issue.\n+\n+This example directly addresses the use case described in the GitHub issue:\n+- Complex nested data structures\n+- Dynamic field selection through request body\n+- Avoids URL length limitations\n+- Provides GraphQL-like flexibility with standard HTTP\n+\"\"\"\n+\n+from typing import Any, Dict, List, Optional\n+\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+# Original data structure from the GitHub issue\n+sample_subject = {\n+    \"id\": 1,\n+    \"name\": \"Math\",\n+    \"tags\": [\n+        {\n+            \"id\": 1,\n+            \"name\": \"Algebra\",\n+            \"number_of_clicks\": 1,\n+            \"number_of_questions\": 7,\n+            \"number_of_answers\": 3,\n+            \"number_of_comments\": 2,\n+            \"number_of_votes\": 1,\n+        }\n+    ],\n+    \"topics\": [\n+        {\n+            \"id\": 1,\n+            \"name\": \"Linear Equations\",\n+        ", "output": "Changes look good. This PR implements: ‚ú® Support HTTP QUERY method", "source": "pr", "type": "code_review", "pr_number": 311}
{"instruction": "Review the following code changes: feat: add experimental .query() decorator for HTTP QUERY", "input": "```diff\n@@ -107,3 +107,41 @@ You can also set the `route_class` parameter of an `APIRouter`:\n In this example, the *path operations* under the `router` will use the custom `TimedRoute` class, and will have an extra `X-Response-Time` header in the response with the time it took to generate the response:\n \n {* ../../docs_src/custom_request_and_route/tutorial003.py hl[13:20] *}\n+\n+## Experimental: HTTP QUERY method { #experimental-http-query-method }\n+\n+/// warning\n+\n+This is an experimental feature for the non-standard HTTP QUERY method. Use with caution.\n+\n+///\n+\n+FastAPI and `APIRouter` expose a `.query()` decorator for the experimental HTTP QUERY method, as defined in the <a href=\"https://www.ietf.org/archive/id/draft-ietf-httpbis-safe-method-w-body-02.html\" class=\"external-link\" target=\"_blank\">IETF draft for \"safe method with body\"</a>.\n+\n+The QUERY method works at runtime and can be used like any other HTTP method decorator:\n+\n+\n```\n\n```diff\n@@ -107,3 +107,41 @@ Tambi√©n puedes establecer el par√°metro `route_class` de un `APIRouter`:\n En este ejemplo, las *path operations* bajo el `router` usar√°n la clase personalizada `TimedRoute`, y tendr√°n un header `X-Response-Time` extra en el response con el tiempo que tom√≥ generar el response:\n \n {* ../../docs_src/custom_request_and_route/tutorial003.py hl[13:20] *}\n+\n+## Experimental: M√©todo HTTP QUERY { #experimental-http-query-method }\n+\n+/// warning | Advertencia\n+\n+Esta es una funcionalidad experimental para el m√©todo HTTP QUERY no est√°ndar. √ösalo con precauci√≥n.\n+\n+///\n+\n+FastAPI y `APIRouter` exponen un decorador `.query()` para el m√©todo HTTP QUERY experimental, tal como se define en el <a href=\"https://www.ietf.org/archive/id/draft-ietf-httpbis-safe-method-w-body-02.html\" class=\"external-link\" target=\"_blank\">borrador del IETF para \"m√©todo seguro con cuerpo\"</a>.\n+\n+El m√©todo QUERY funciona en tiempo de ejecuci√≥n y puede usarse como cualquier otro decorador de m√©todo HTTP:\n+\n+\n```\n\n```diff\n@@ -4535,6 +4535,17 @@ def trace_item(item_id: str):\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self,\n+        path: str,\n+        *args: Any,\n+        **kwargs: Any,\n+    ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n+        \"\"\"\n+        Experimental: HTTP QUERY method. See APIRouter.query for caveats.\n+        \"\"\"\n+        return self.router.query(path, *args, **kwargs)\n+\n     def websocket_route(\n         self, path: str, name: Union[str, None] = None\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n\n```\n\n```diff\n@@ -4482,6 +4482,66 @@ def trace_item(item_id: str):\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self,\n+        path: str,\n+        *,\n+        response_model: Any = Default(None),\n+        status_code: Optional[int] = None,\n+        tags: Optional[List[Union[str, Enum]]] = None,\n+        dependencies: Optional[Sequence[params.Depends]] = None,\n+        summary: Optional[str] = None,\n+        description: Optional[str] = None,\n+        response_description: str = \"Successful Response\",\n+        responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,\n+        deprecated: Optional[bool] = None,\n+        operation_id: Optional[str] = None,\n+        response_model_include: Optional[IncEx] = None,\n+        response_model_exclude: Optional[IncEx] = None,\n+        response_model_by_alias: bool = True,\n+        response_model_exclude_unset: bool = False,\n+        response_model_exclude_defaults: bool = False,\n+        response_model_exclude_none: bool = False,\n+        include_in_schema: bool = False,\n+        response_class: Type[Response] = Default(JSONResponse),\n+        name: Optional[str] = None,\n+        callbacks: Optional[List[BaseRoute]] = None,\n+        openapi_extra: Optional[Dict[str, Any]] = None,\n+        generate_unique_id_function: Callable[[APIRoute], str] = Default(\n+            generate_unique_id\n+        ),\n+    ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n+        \"\"\"\n+        Experimental: register a handler for the non-standard HTTP QUERY method.\n+        Works at runtime, but not represented in OpenAPI (spec doesn't support it).\n+        \"\"\"\n+        return self.api_route(\n+            path=path,\n+            response_model=response_model,\n+            status_code=status_code,\n+            tags=tags,\n+            dependencies=dependencies,\n+            summary=summary,\n+            description=description,\n+            response_description=response_description,\n+            responses=responses,\n+            deprecated=deprecated,\n+            methods=[\"QUERY\"],\n+            operation_id=operation_id,\n+            response_model_include=response_model_include,\n+            response_model_exclude=response_model_exclude,\n+            response_model_by_alias=response_model_by_alias,\n+            response_model_exclude_unset=response_model_exclude_unset,\n+            response_mod", "output": "Code Review for: feat: add experimental .query() decorator for HTTP QUERY\n\nüìù **docs/en/docs/how-to/custom-request-and-route.md**: Quick drive-by comment: the docs should say from which version onwards this is supported (if we want to merge this, that is)\n\n", "source": "pr", "type": "code_review", "pr_number": 310}
{"instruction": "Review this code change in `docs/en/docs/how-to/custom-request-and-route.md`", "input": "```diff\n@@ -107,3 +107,41 @@ You can also set the `route_class` parameter of an `APIRouter`:\n In this example, the *path operations* under the `router` will use the custom `TimedRoute` class, and will have an extra `X-Response-Time` header in the response with the time it took to generate the response:\n \n {* ../../docs_src/custom_request_and_route/tutorial003.py hl[13:20] *}\n+\n+## Experimental: HTTP QUERY method { #experimental-http-query-method }\n+\n+/// warning\n+\n+This is an experimental feature for the non-standard HTTP QUERY method. Use with caution.\n+\n+///\n+\n+FastAPI and `APIRouter` expose a `.query()` decorator for the experimental HTTP QUERY method, as defined in the <a href=\"https://www.ietf.org/archive/id/draft-ietf-httpbis-safe-method-w-body-02.html\" class=\"external-link\" target=\"_blank\">IETF draft for \"safe method with body\"</a>.\n\n```", "output": "Quick drive-by comment: the docs should say from which version onwards this is supported (if we want to merge this, that is)", "source": "pr_review", "type": "inline_review", "pr_number": 310}
{"instruction": "Review the following code changes: Add QUERY HTTP method support", "input": "```diff\n@@ -769,7 +769,7 @@ async def read_items():\n             ),\n         ] = None,\n         generate_unique_id_function: Annotated[\n-            Callable[[routing.APIRoute], str],\n+            Callable[[\"routing.APIRoute\"], str],\n             Doc(\n                 \"\"\"\n                 Customize the function used to generate unique IDs for the *path\n@@ -2666,6 +2666,363 @@ def create_item(item: Item):\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self: AppType,\n+        path: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL path to be used for this *path operation*.\n+\n+                For example, in `http://example.com/items`, the path is `/items`.\n+                \"\"\"\n+            ),\n+        ],\n+        *,\n+        response_model: Annotated[\n+            Any,\n+            Doc(\n+                \"\"\"\n+                The type to use for the response.\n+\n+                It could be any valid Pydantic *field* type. So, it doesn't have to\n+                be a Pydantic model, it could be other things, like a `list`, `dict`,\n+                etc.\n+\n+                It will be used for:\n+\n+                * Documentation: the generated OpenAPI (and the UI at `/docs`) will\n+                    show it as the response (JSON Schema).\n+                * Serialization: you could return an arbitrary object and the\n+                    `response_model` would be used to serialize that object into the\n+                    corresponding JSON.\n+                * Filtering: the JSON sent to the client will only contain the data\n+                    (fields) defined in the `response_model`. If you returned an object\n+                    that contains an attribute `password` but the `response_model` does\n+                    not include that field, the JSON sent to the client would not have\n+                    that `password`.\n+                * Validation: whatever you return will be serialized with the\n+                    `response_model`, converting any data as necessary to generate the\n+                    corresponding JSON. But if the data in the object returned is not\n+                    valid, that would mean a violation of the contract with the client,\n+                    so it's an error from the API developer. So, FastAPI will raise an\n+                    error and return a 500 error code (Internal Server Error).\n+\n+                Read more about it in the\n+                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).\n+                \"\"\"\n+            ),\n+        ] = Default(None),\n+        status_code: Annotated[\n+            Optional[int],\n+            Doc(\n+                \"\"\"\n+                The default status code to be used for the response.\n+\n+                You could override the status code by returning a response directly.\n+\n+                Read more about it in the\n+                [FastAPI d\n\n```\n\n```diff\n@@ -1,3 +1,3 @@\n-METHODS_WITH_BODY = {\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"}\n+METHODS_WITH_BODY = {\"GET\", \"HEAD\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\", \"QUERY\"}\n REF_PREFIX = \"#/components/schemas/\"\n REF_TEMPLATE = \"#/components/schemas/{model}\"\n\n```\n\n```diff\n@@ -2588,6 +2588,363 @@ def create_item(item: Item):\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self,\n+        path: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL path to be used for this *path operation*.\n+\n+                For example, in `http://example.com/items`, the path is `/items`.\n+                \"\"\"\n+            ),\n+        ],\n+        *,\n+        response_model: Annotated[\n+            Any,\n+            Doc(\n+                \"\"\"\n+                The type to use for the response.\n+\n+                It could be any valid Pydantic *field* type. So, it doesn't have to\n+                be a Pydantic model, it could be other things, like a `list`, `dict`,\n+                etc.\n+\n+                It will be used for:\n+\n+                * Documentation: the generated OpenAPI (and the UI at `/docs`) will\n+                    show it as the response (JSON Schema).\n+                * Serialization: you could return an arbitrary object and the\n+                    `response_model` would be used to serialize that object into the\n+                    corresponding JSON.\n+                * Filtering: the JSON sent to the client will only contain the data\n+                    (fields) defined in the `response_model`. If you returned an object\n+                    that contains an attribute `password` but the `response_model` does\n+                    not include that field, the JSON sent to the client would not have\n+                    that `password`.\n+                * Validation: whatever you return will be serialized with the\n+                    `response_model`, convert", "output": "Changes look good. This PR implements: Add QUERY HTTP method support", "source": "pr", "type": "code_review", "pr_number": 309}
{"instruction": "Review the following code changes: ‚ú® feature: Add support for HTTP QUERY method", "input": "```diff\n@@ -0,0 +1,29 @@\n+# HTTP QUERY { #http-query }\n+\n+Typically, when you want to read data you use `GET`. If you need to send complex data (like a large JSON object) to filter that data, you traditionally had to use `POST` because `GET` requests does not support request bodies.\n+\n+However, using `POST` for read-only operations isn't semantically correct, as `POST` implies that you are creating or modifying data.\n+\n+There is a newer HTTP method called **QUERY**. It is designed exactly for this: performing safe, idempotent read operations that require a request body.\n+\n+## Using `QUERY` { #using-query }\n+\n+In **FastAPI**, you can use the `QUERY` method using the `@app.query()` decorator.\n+\n+It works similarly to `@app.post()`, allowing you to receive Pydantic models in the body, but it signals that the operation is a read-only query.\n+\n+\n+{* ../../docs_src/http_query/tutorial001.py hl[7] *}\n+\n+### Testing it { #testing-it }\n+\n+You can test it using an HTTP client that supports the `QUERY` method.\n+\n+Because it allows a body, you can send complex filters without hitting URL length limits common with `GET` query parameters.\n+\n+### Technical Details { #technical-details }\n+\n+The `QUERY` method is defined in the [IETF HTTP QUERY Method Draft](https://www.ietf.org/archive/id/draft-ietf-httpbis-safe-method-w-body-02.html). It is considered:\n+\n+*   **Safe**: It does not alter the state of the server (read-only).\n+*   **Idempotent**: Making the same request multiple times yields the same result.\n\n```\n\n```diff\n@@ -136,6 +136,7 @@ nav:\n     - tutorial/request-forms-and-files.md\n     - tutorial/handling-errors.md\n     - tutorial/path-operation-configuration.md\n+    - tutorial/http-query.md\n     - tutorial/encoder.md\n     - tutorial/body-updates.md\n     - Dependencies:\n\n```\n\n```diff\n@@ -0,0 +1,17 @@\n+from typing import Optional\n+\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class ItemSearch(BaseModel):\n+    keyword: str\n+    min_price: Optional[float] = None\n+    max_price: Optional[float] = None\n+\n+\n+@app.query(\"/items/\")\n+async def search_items(search_params: ItemSearch):\n+    return {\"message\": \"Searching items\", \"search_params\": search_params}\n\n```\n\n```diff\n@@ -4536,6 +4536,384 @@ def trace_item(item_id: str):\n             generate_unique_id_function=generate_unique_id_function,\n         )\n \n+    def query(\n+        self,\n+        path: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                    The URL path to be used for this *path operation*.\n+\n+                    For example, in `http://example.com/items`, the path is `/items`.\n+                    \"\"\"\n+            ),\n+        ],\n+        *,\n+        response_model: Annotated[\n+            Any,\n+            Doc(\n+                \"\"\"\n+                    The type to use for the response.\n+\n+                    It could be any valid Pydantic *field* type. So, it doesn't have to\n+                    be a Pydantic model, it could be other things, like a `list`, `dict`,\n+                    etc.\n+\n+                    It will be used for:\n+\n+                    * Documentation: the generated OpenAPI (and the UI at `/docs`) will\n+                        show it as the response (JSON Schema).\n+                    * Serialization: you could return an arbitrary object and the\n+                        `response_model` would be used to serialize that object into the\n+                        corresponding JSON.\n+                    * Filtering: the JSON sent to the client will only contain the data\n+                        (fields) defined in the `response_model`. If you returned an object\n+                        that contains an attribute `password` but the `response_model` does\n+                        not include that field, the JSON sent to the client would not have\n+                        that `password`.\n+                    * Validation: whatever you return will be serialized with the\n+                        `response_model`, converting any data as necessary to generate the\n+                        corresponding JSON. But if the data in the object returned is not\n+                        valid, that would mean a violation of the contract with the client,\n+                        so it's an error from the API developer. So, FastAPI will raise an\n+                        error and return a 500 error code (Internal Server Error).\n+\n+                    Read more about it in the\n+                    [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).\n+                    \"\"\"\n+            ),\n+        ] = Default(None),\n+        status_code: Annotated[\n+            Optional[int],\n+            Doc(\n+                \"\"\"\n+                    The default status code to be used for the response.\n+\n+                    You could override the status code by returning a response directly.\n+\n+                    Read more about it in the\n+                    [FastAPI d", "output": "Changes look good. This PR implements: ‚ú® feature: Add support for HTTP QUERY method", "source": "pr", "type": "code_review", "pr_number": 308}
{"instruction": "Review the following code changes: Update HTTPDigest to match RFC 7616", "input": "```diff\n@@ -6,6 +6,7 @@\n from .http import HTTPBasicCredentials as HTTPBasicCredentials\n from .http import HTTPBearer as HTTPBearer\n from .http import HTTPDigest as HTTPDigest\n+from .http import HTTPDigestCredentials as HTTPDigestCredentials\n from .oauth2 import OAuth2 as OAuth2\n from .oauth2 import OAuth2AuthorizationCodeBearer as OAuth2AuthorizationCodeBearer\n from .oauth2 import OAuth2PasswordBearer as OAuth2PasswordBearer\n\n```\n\n```diff\n@@ -1,12 +1,19 @@\n import binascii\n+import hashlib\n+import os\n from base64 import b64decode\n-from typing import Optional\n+from typing import Awaitable, Callable, Dict, NoReturn, Optional, Tuple\n \n from fastapi.exceptions import HTTPException\n from fastapi.openapi.models import HTTPBase as HTTPBaseModel\n from fastapi.openapi.models import HTTPBearer as HTTPBearerModel\n from fastapi.security.base import SecurityBase\n-from fastapi.security.utils import get_authorization_scheme_param\n+from fastapi.security.utils import (\n+    check_nonce,\n+    digest_access_response,\n+    get_authorization_scheme_param,\n+    make_nonce,\n+)\n from pydantic import BaseModel\n from starlette.requests import Request\n from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN\n@@ -22,6 +29,54 @@ class HTTPAuthorizationCredentials(BaseModel):\n     credentials: str\n \n \n+class HTTPDigestCredentials(BaseModel):\n+    scheme: str\n+    credentials: str\n+    request_method: str\n+    request_uri: str\n+    request_body: Callable[[], Awaitable[bytes]]\n+    username: str\n+    userhash: bool\n+    realm: str\n+    nonce: str\n+    cnonce: str\n+    nc: str\n+    qop: str\n+    algorithm: Optional[str]\n+\n+    def _hashed_username(self, username: str) -> str:\n+        \"\"\"\n+        Hash the username if userhash is enabled.\n+        \"\"\"\n+        if self.userhash:\n+            algo = self.algorithm or \"md5\"\n+            algo = (algo[:-5] if algo.endswith(\"-sess\") else algo).lower()\n+            return hashlib.new(algo, f\"{username}:{self.realm}\".encode()).hexdigest()\n+        else:\n+            return username\n+\n+    async def authenticate(self, username: str, password: str) -> bool:\n+        \"\"\"\n+        Authenticate the credentials against a password.\n+        \"\"\"\n+        if self.username != self._hashed_username(username):\n+            return False\n+\n+        return self.credentials == digest_access_response(\n+            request_method=self.request_method,\n+            request_uri=self.request_uri,\n+            request_body=await self.request_body(),\n+            username=self._hashed_username(username),\n+            password=password,\n+            realm=self.realm,\n+            nonce=self.nonce,\n+            cnonce=self.cnonce,\n+            nc=self.nc,\n+            qop=self.qop,\n+            algo=self.algorithm,\n+        )\n+\n+\n class HTTPBase(SecurityBase):\n     def __init__(\n         self,\n@@ -138,28 +193,139 @@ def __init__(\n         self,\n         *,\n         scheme_name: Optional[str] = None,\n+        realm: Optional[str] = None,\n+        qop: Tuple[str] = (\"auth\",),\n+        algorithm: str = \"md5\",\n+        userhash: bool = False,\n+        nonce_secret: Optional[str] = None,\n         description: Optional[str] = None,\n         auto_error: bool = True,\n     ):\n         self.model = HTTPBaseModel(scheme=\"digest\", description=description)\n         self.scheme_name = scheme_name or self.__class__.__name__\n+        self.realm = realm\n+\n+        self.algorithm_name = (\n+           \n\n```\n\n```diff\n@@ -1,5 +1,11 @@\n+import binascii\n+import hashlib\n+import time\n+from base64 import b64decode, b64encode\n from typing import Optional, Tuple\n \n+from starlette.requests import Request\n+\n \n def get_authorization_scheme_param(\n     authorization_header_value: Optional[str],\n@@ -8,3 +14,175 @@ def get_authorization_scheme_param(\n         return \"\", \"\"\n     scheme, _, param = authorization_header_value.partition(\" \")\n     return scheme, param\n+\n+\n+def make_nonce(request: Request, secret: Optional[str] = None) -> str:\n+    \"\"\"\n+    Create a nonce for HTTP digest access authentication.\n+\n+    This implementation is based on RFC 7616, section 3.3 which suggests, a\n+    nonce value `H(timestamp \":\" ETag \":\" secret-data)`. However, because\n+    the ETag is not available, we use the more readily available\n+    request.url.path. Additionally, to limit the length of the nonce, we use the\n+    first 10 characters of the MD5 hash of both the path and the secret.\n+\n+    Args:\n+        request (Request): The HTTP request.\n+        secret (str | None): The secret to use for the nonce.\n+\n+    Returns:\n+        str: The nonce.\n+    \"\"\"\n+\n+    now = int(time.time() * 1000)\n+    path = hashlib.md5(request.url.path.encode()).hexdigest()[:10]\n+    secret = secret or \"\"\n+    secret = hashlib.md5(secret.encode()).hexdigest()[:10]\n+    return b64encode(f\"{now}:{path}:{secret}\".encode()).decode()\n+\n+\n+def check_nonce(\n+    nonce: str,\n+    request: Request,\n+    valid_for_seconds: int = 300,\n+    secret: Optional[str] = None,\n+) -> bool:\n+    \"", "output": "Code Review for: Update HTTPDigest to match RFC 7616\n\nüìù **fastapi/security/http.py**: Is \"opqaue_data\" a typo for \"opaque_data\" ?\n\n", "source": "pr", "type": "code_review", "pr_number": 307}
{"instruction": "Review this code change in `fastapi/security/http.py`", "input": "```diff\n@@ -138,28 +193,139 @@ def __init__(\n         self,\n         *,\n         scheme_name: Optional[str] = None,\n+        realm: Optional[str] = None,\n+        qop: Tuple[str] = (\"auth\",),\n+        algorithm: str = \"md5\",\n+        userhash: bool = False,\n+        nonce_secret: Optional[str] = None,\n         description: Optional[str] = None,\n         auto_error: bool = True,\n     ):\n         self.model = HTTPBaseModel(scheme=\"digest\", description=description)\n         self.scheme_name = scheme_name or self.__class__.__name__\n+        self.realm = realm\n+\n+        self.algorithm_name = (\n+            algorithm[:-5] if algorithm.endswith(\"-sess\") else algorithm\n+        ).lower()\n+\n+        if self.algorithm_name not in hashlib.algorithms_available:\n+            raise ValueError(f\"algorithm must be one of {hashlib.algorithms_available}\")\n+        self.algorithm = algorithm\n+\n+        if qop != (\"auth\",):\n+            raise ValueError(\"Only 'auth' qop value is supported\")\n+        self.qop = qop\n+\n+        self.userhash = userhash\n+        self.nonce_secret = nonce_secret\n         self.auto_error = auto_error\n \n-    async def __call__(\n+        opqaue_data = realm.encode() if realm else os.urandom(32)\n\n```", "output": "Is \"opqaue_data\" a typo for \"opaque_data\" ?", "source": "pr_review", "type": "inline_review", "pr_number": 307}
{"instruction": "Review the following code changes: ‚ú® Add possibility to get and modify response in dependencies with yield", "input": "```diff\n@@ -19,7 +19,7 @@ Any function that is valid to use with:\n \n would be valid to use as a **FastAPI** dependency.\n \n-In fact, FastAPI uses those two decorators internally.\n+In fact, FastAPI uses similar decorator internally.\n \n ///\n \n@@ -129,6 +129,19 @@ You can re-raise the same exception using `raise`:\n \n Now the client will get the same *HTTP 500 Internal Server Error* response, but the server will have our custom `InternalError` in the logs. üòé\n \n+## Modifying response in dependencies after `yield`\n+\n+If you want to read or change response in a dependency with `yield` after `yield`, you can get your endpoint's response\n+if you assign `yield` to it:\n+\n+{* ../../docs_src/dependencies/tutorial008e.py hl[13:14] *}\n+\n+/// warning\n+\n+You cannot use dependency-injected `Response` to modify response in dependency after `yield`.\n+\n+///\n+\n ## Execution of dependencies with `yield` { #execution-of-dependencies-with-yield }\n \n The sequence of execution is more or less like this diagram. Time flows from top to bottom. And each column is one of the parts interacting or executing code.\n@@ -266,7 +279,7 @@ Another way to create a context manager is with:\n \n using them to decorate a function with a single `yield`.\n \n-That's what **FastAPI** uses internally for dependencies with `yield`.\n+A similar decorator is what **FastAPI** uses internally for dependencies with `yield`.\n \n But you don't have to use the decorators for FastAPI dependencies (and you shouldn't).\n \n\n```\n\n```diff\n@@ -0,0 +1,23 @@\n+import json\n+\n+from fastapi import Depends, FastAPI, HTTPException\n+\n+app = FastAPI()\n+\n+\n+data = {\n+    \"plumbus\": {\"description\": \"Freshly pickled plumbus\", \"owner\": \"Morty\"},\n+    \"portal-gun\": {\"description\": \"Gun to create portals\", \"owner\": \"Rick\"},\n+}\n+\n+\n+def set_username():\n+    response = yield\n+    response.headers[\"X-Username\"] = json.loads(response.body)[\"owner\"]\n+\n+\n+@app.get(\"/items/{item_id}\", dependencies=[Depends(set_username)])\n+def get_item(item_id: str):\n+    if item_id not in data:\n+        raise HTTPException(status_code=404, detail=\"Item not found\")\n+    return data[item_id]\n\n```\n\n```diff\n@@ -1,5 +1,15 @@\n from contextlib import asynccontextmanager as asynccontextmanager\n-from typing import AsyncGenerator, ContextManager, TypeVar\n+from types import TracebackType\n+from typing import (\n+    Any,\n+    AsyncGenerator,\n+    ContextManager,\n+    Generator,\n+    Optional,\n+    Type,\n+    TypeVar,\n+    Union,\n+)\n \n import anyio.to_thread\n from anyio import CapacityLimiter\n@@ -13,9 +23,9 @@\n \n \n @asynccontextmanager\n-async def contextmanager_in_threadpool(\n+async def contextmanager_in_threadpool(  # not used, kept for backwards compatibility\n     cm: ContextManager[_T],\n-) -> AsyncGenerator[_T, None]:\n+) -> AsyncGenerator[_T, None]:  # pragma: no cover\n     # blocking __exit__ from running waiting on a free thread\n     # can create race conditions/deadlocks if the context manager itself\n     # has its own internal pool (e.g. a database connection pool)\n@@ -37,3 +47,188 @@ async def contextmanager_in_threadpool(\n         await anyio.to_thread.run_sync(\n             cm.__exit__, None, None, None, limiter=exit_limiter\n         )\n+\n+\n+class _StopIteration(Exception):\n+    pass\n+\n+\n+class ContextManagerFromGenerator:\n+    \"\"\"Create a context manager from a generator.\n+\n+    It handles both sync and async generators. Generator has to have exactly one yield.\n+\n+    Implementation is based on contextlib's contextmanager.\n+\n+    Additionally, as apposed to contextlib.contextmanager/contextlib.asynccontextmanager,\n+    this context manager allows to call `asend` on underlaying generator and gracefully handle\n+    this scenario in __aexit__.\n+\n+    Instances of this class cannot be reused.\n+    \"\"\"\n+\n+    def __init__(self, gen: Union[AsyncGenerator[_T, None], Generator[_T, None, None]]):\n+        self.gen = gen\n+        self._has_started = False\n+        self._has_executed = False\n+\n+    @staticmethod\n+    def _send(gen: Generator[_T, None, None], value: Any) -> Any:\n+        # We can't raise `StopIteration` from within the threadpool executor\n+        # and catch it outside that context, so we coerce them into a different\n+        # exception type.\n+        try:\n+            return gen.send(value)\n+        except StopIteration:\n+            raise _StopIteration from None\n+\n+    @staticmethod\n+    def _throw(gen: Generator[_T, None, None], value: Any) -> Any:\n+        # We can't raise `StopIteration` from within the threadpool executor\n+        # and catch it outside that context, so we coerce them into a different\n+        # exception type.\n+        try:\n+            return gen.throw(value)\n+        except StopIteration:\n+            raise _StopIteration from None\n+\n+    async def __aenter__(self) -> Any:\n+        try:\n+            if isinstance(self.gen, Generator):\n+                result = await run_in_threadpool(self._send, self.gen, None)\n+            else:\n+                result = await self.gen.asend(None)\n+   ", "output": "Changes look good. This PR implements: ‚ú® Add possibility to get and modify response in dependencies with yield", "source": "pr", "type": "code_review", "pr_number": 306}
{"instruction": "Review the following code changes: ‚ú® Add support for custom generic classes as dependencies", "input": "```diff\n@@ -0,0 +1,11 @@\n+from typing import Any, Tuple\n+\n+from typing_extensions import Protocol\n+\n+\n+class GenericTypeProtocol(Protocol):\n+    class OriginTypeProtocol(Protocol):\n+        __parameters__: Tuple[Any]\n+\n+    __origin__: OriginTypeProtocol\n+    __args__: Tuple[Any]\n\n```\n\n```diff\n@@ -52,6 +52,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant, SecurityRequirement\n+from fastapi.dependencies.protocols import GenericTypeProtocol\n from fastapi.logger import logger\n from fastapi.security.base import SecurityBase\n from fastapi.security.oauth2 import OAuth2, SecurityScopes\n@@ -228,26 +229,58 @@ def get_flat_params(dependant: Dependant) -> List[ModelField]:\n     return path_params + query_params + header_params + cookie_params\n \n \n+def is_generic_type(obj: Any) -> bool:\n+    return hasattr(obj, \"__origin__\") and hasattr(obj, \"__args__\")\n+\n+\n+def substitute_generic_type(annotation: Any, typevars: Dict[str, Any]) -> Any:\n+    collection_shells = {list: List, set: List, dict: Dict, tuple: Tuple}\n+    if is_generic_type(annotation):\n+        args = tuple(\n+            substitute_generic_type(arg, typevars) for arg in annotation.__args__\n+        )\n+        annotation = collection_shells.get(annotation.__origin__, annotation)\n+        return annotation[args]\n+    return typevars.get(annotation.__name__, annotation)\n+\n+\n def get_typed_signature(call: Callable[..., Any]) -> inspect.Signature:\n+    typevars = None\n+    if is_generic_type(call):\n+        generic: GenericTypeProtocol = cast(GenericTypeProtocol, call)\n+        origin: Any = generic.__origin__\n+        typevars = {\n+            typevar.__name__: value\n+            for typevar, value in zip(origin.__parameters__, generic.__args__)\n+        }\n+        call = origin.__init__\n+\n     signature = inspect.signature(call)\n     globalns = getattr(call, \"__globals__\", {})\n     typed_params = [\n         inspect.Parameter(\n             name=param.name,\n             kind=param.kind,\n             default=param.default,\n-            annotation=get_typed_annotation(param.annotation, globalns),\n+            annotation=get_typed_annotation(param.annotation, globalns, typevars),\n         )\n         for param in signature.parameters.values()\n+        if param.name != \"self\"\n     ]\n     typed_signature = inspect.Signature(typed_params)\n     return typed_signature\n \n \n-def get_typed_annotation(annotation: Any, globalns: Dict[str, Any]) -> Any:\n+def get_typed_annotation(\n+    annotation: Any,\n+    globalns: Dict[str, Any],\n+    typevars: Optional[Dict[str, type]] = None,\n+) -> Any:\n     if isinstance(annotation, str):\n         annotation = ForwardRef(annotation)\n         annotation = evaluate_forwardref(annotation, globalns, globalns)\n+    if typevars:\n+        annotation = substitute_generic_type(annotation, typevars)\n     return annotation\n \n \n\n```\n\n```diff\n@@ -0,0 +1,66 @@\n+from typing import Dict, Generic, List, TypeVar\n+\n+from fastapi import Depends, FastAPI\n+from starlette.testclient import TestClient\n+\n+T = TypeVar(\"T\")\n+C = TypeVar(\"C\")\n+\n+\n+class FirstGenericType(Generic[T]):\n+    def __init__(self, simple: T, lst: List[T]):\n+        self.simple = simple\n+        self.lst = lst\n+\n+\n+class SecondGenericType(Generic[T, C]):\n+    def __init__(\n+        self,\n+        simple: T,\n+        lst: List[T],\n+        dct: Dict[T, C],\n+        custom_class: FirstGenericType[T] = Depends(),\n+    ):\n+        self.simple = simple\n+        self.lst = lst\n+        self.dct = dct\n+        self.custom_class = custom_class\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/test_generic_class\")\n+def depend_generic_type(obj: SecondGenericType[str, int] = Depends()):\n+    return {\n+        \"simple\": obj.simple,\n+        \"lst\": obj.lst,\n+        \"dct\": obj.dct,\n+        \"custom_class\": {\n+            \"simple\": obj.custom_class.simple,\n+            \"lst\": obj.custom_class.lst,\n+        },\n+    }\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_generic_class_dependency():\n+    response = client.post(\n+        \"/test_generic_class?simple=simple\",\n+        json={\n+            \"lst\": [\"string_1\", \"string_2\"],\n+            \"dct\": {\"key\": 1},\n+        },\n+    )\n+    assert response.status_code == 200, response.json()\n+    assert response.json() == {\n+        \"custom_class\": {\n+            \"lst\": [\"string_1\", \"string_2\"],\n+            \"simple\": \"simple\",\n+        },\n+        \"lst\": [\"string_1\", \"string_2\"],\n+        \"dct\": {\"key\": 1},\n+        \"simple\": \"simple\",\n+    }\n\n```", "output": "Changes look good. This PR implements: ‚ú® Add support for custom generic classes as dependencies", "source": "pr", "type": "code_review", "pr_number": 305}
{"instruction": "Review the following code changes: ‚ú® Allow `Response` type hint as dependency annotation", "input": "```diff\n@@ -449,7 +449,9 @@ def analyze_param(\n         depends = dataclasses.replace(depends, dependency=type_annotation)\n \n     # Handle non-param type annotations like Request\n-    if lenient_issubclass(\n+    # Only apply special handling when there's no explicit Depends - if there's a Depends,\n+    # the dependency will be called and its return value used instead of the special injection\n+    if depends is None and lenient_issubclass(\n         type_annotation,\n         (\n             Request,\n@@ -460,7 +462,6 @@ def analyze_param(\n             SecurityScopes,\n         ),\n     ):\n-        assert depends is None, f\"Cannot specify `Depends` for type {type_annotation!r}\"\n         assert field_info is None, (\n             f\"Cannot specify FastAPI annotation for type {type_annotation!r}\"\n         )\n\n```\n\n```diff\n@@ -0,0 +1,173 @@\n+\"\"\"Test using special types (Response, Request, BackgroundTasks) as dependency annotations.\n+\n+These tests verify that special FastAPI types can be used with Depends() annotations\n+and that the dependency injection system properly handles them.\n+\"\"\"\n+\n+from typing import Annotated\n+\n+from fastapi import BackgroundTasks, Depends, FastAPI, Request, Response\n+from fastapi.responses import JSONResponse\n+from fastapi.testclient import TestClient\n+\n+\n+def test_response_with_depends_annotated():\n+    \"\"\"Response type hint should work with Annotated[Response, Depends(...)].\"\"\"\n+    app = FastAPI()\n+\n+    def modify_response(response: Response) -> Response:\n+        response.headers[\"X-Custom\"] = \"modified\"\n+        return response\n+\n+    @app.get(\"/\")\n+    def endpoint(response: Annotated[Response, Depends(modify_response)]):\n+        return {\"status\": \"ok\"}\n+\n+    client = TestClient(app)\n+    resp = client.get(\"/\")\n+\n+    assert resp.status_code == 200\n+    assert resp.json() == {\"status\": \"ok\"}\n+    assert resp.headers.get(\"X-Custom\") == \"modified\"\n+\n+\n+def test_response_with_depends_default():\n+    \"\"\"Response type hint should work with Response = Depends(...).\"\"\"\n+    app = FastAPI()\n+\n+    def modify_response(response: Response) -> Response:\n+        response.headers[\"X-Custom\"] = \"modified\"\n+        return response\n+\n+    @app.get(\"/\")\n+    def endpoint(response: Response = Depends(modify_response)):\n+        return {\"status\": \"ok\"}\n+\n+    client = TestClient(app)\n+    resp = client.get(\"/\")\n+\n+    assert resp.status_code == 200\n+    assert resp.json() == {\"status\": \"ok\"}\n+    assert resp.headers.get(\"X-Custom\") == \"modified\"\n+\n+\n+def test_response_without_depends():\n+    \"\"\"Regular Response injection should still work.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def endpoint(response: Response):\n+        response.headers[\"X-Direct\"] = \"set\"\n+        return {\"status\": \"ok\"}\n+\n+    client = TestClient(app)\n+    resp = client.get(\"/\")\n+\n+    assert resp.status_code == 200\n+    assert resp.json() == {\"status\": \"ok\"}\n+    assert resp.headers.get(\"X-Direct\") == \"set\"\n+\n+\n+def test_response_dependency_chain():\n+    \"\"\"Response dependency should work in a chain of dependencies.\"\"\"\n+    app = FastAPI()\n+\n+    def first_modifier(response: Response) -> Response:\n+        response.headers[\"X-First\"] = \"1\"\n+        return response\n+\n+    def second_modifier(\n+        response: Annotated[Response, Depends(first_modifier)],\n+    ) -> Response:\n+        response.headers[\"X-Second\"] = \"2\"\n+        return response\n+\n+    @app.get(\"/\")\n+    def endpoint(response: Annotated[Response, Depends(second_modifier)]):\n+        return {\"status\": \"ok\"}\n+\n+    client = TestClient(app)\n+    resp = client.get(\"/\")\n+\n+    assert resp.status_code == 200\n+    assert resp.headers.get(\"X-First\") == \"1\"\n+    assert resp.headers.get(\"X-Second\") == \"2\"\n+\n+\n+def test_response_dependency_returns_different_response_instance():\n+    \"\"\"Dependency that returns a dif\n\n```", "output": "Changes look good. This PR implements: ‚ú® Allow `Response` type hint as dependency annotation", "source": "pr", "type": "code_review", "pr_number": 304}
{"instruction": "Review the following code changes: Support Pydantic root model as query parameter", "input": "```diff\n@@ -50,7 +50,7 @@\n \n if PYDANTIC_V2:\n     from pydantic import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n-    from pydantic import TypeAdapter\n+    from pydantic import RootModel, TypeAdapter\n     from pydantic import ValidationError as ValidationError\n     from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n         GetJsonSchemaHandler as GetJsonSchemaHandler,\n@@ -292,6 +292,12 @@ def get_model_fields(model: Type[BaseModel]) -> List[ModelField]:\n             for name, field_info in model.model_fields.items()\n         ]\n \n+    def root_model_inner_type(annotation: Any) -> Any:\n+        if lenient_issubclass(annotation, RootModel):\n+            inner = annotation.model_fields[\"root\"].annotation\n+            return root_model_inner_type(inner) or inner\n+        return None\n+\n else:\n     from fastapi.openapi.constants import REF_PREFIX as REF_PREFIX\n     from pydantic import AnyUrl as Url  # noqa: F401\n@@ -453,7 +459,10 @@ def _model_rebuild(model: Type[BaseModel]) -> None:\n     def _model_dump(\n         model: BaseModel, mode: Literal[\"json\", \"python\"] = \"json\", **kwargs: Any\n     ) -> Any:\n-        return model.dict(**kwargs)\n+        serialized = model.dict(**kwargs)\n+        if isinstance(serialized, dict) and \"__root__\" in serialized:\n+            return serialized[\"__root__\"]\n+        return serialized\n \n     def _get_model_config(model: BaseModel) -> Any:\n         return model.__config__  # type: ignore[attr-defined]\n@@ -495,12 +504,21 @@ def get_definitions(\n         )\n \n     def is_scalar_field(field: ModelField) -> bool:\n+        if (inner := root_model_inner_type(field.type_)) is not None:\n+            return field_annotation_is_scalar(inner)\n+\n         return is_pv1_scalar_field(field)\n \n     def is_sequence_field(field: ModelField) -> bool:\n+        if (inner := root_model_inner_type(field.type_)) is not None:\n+            return field_annotation_is_sequence(inner)\n+\n         return field.shape in sequence_shapes or _annotation_is_sequence(field.type_)  # type: ignore[attr-defined]\n \n     def is_scalar_sequence_field(field: ModelField) -> bool:\n+        if (inner := root_model_inner_type(field.type_)) is not None:\n+            return field_annotation_is_scalar_sequence(inner)\n+\n         return is_pv1_scalar_sequence_field(field)\n \n     def is_bytes_field(field: ModelField) -> bool:\n@@ -531,6 +549,15 @@ def create_body_model(\n     def get_model_fields(model: Type[BaseModel]) -> List[ModelField]:\n         return list(model.__fields__.values())  # type: ignore[attr-defined]\n \n+    def root_model_inner_type(annotation: Any) -> Any:\n+        if (\n+            lenient_issubclass(annotation, BaseModel)\n+            and \"__root__\" in annotation.__fields__\n+        ):\n+            inner = annotation.__fields__[\"__root__\"].annotation\n+            return root_model_inner_type(inner) or inner\n+        return None\n+\n \n def _regenerate_error_with_loc(\n     *, errors: Sequence[Any], loc_prefix\n\n```\n\n```diff\n@@ -31,6 +31,7 @@\n     copy_field_info,\n     create_body_model,\n     evaluate_forwardref,\n+    field_annotation_is_root_model,\n     field_annotation_is_scalar,\n     get_annotation_from_field_info,\n     get_cached_model_fields,\n@@ -43,6 +44,7 @@\n     is_uploadfile_or_nonable_uploadfile_annotation,\n     is_uploadfile_sequence_annotation,\n     lenient_issubclass,\n+    resolves_to_basemodel,\n     sequence_types,\n     serialize_sequence_value,\n     value_is_sequence,\n@@ -219,7 +221,7 @@ def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n     if not fields:\n         return fields\n     first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n+    if len(fields) == 1 and resolves_to_basemodel(first_field.type_):\n         fields_to_extract = get_cached_model_fields(first_field.type_)\n         return fields_to_extract\n     return fields\n@@ -462,7 +464,11 @@ def analyze_param(\n             type_annotation\n         ) or is_uploadfile_sequence_annotation(type_annotation):\n             field_info = params.File(annotation=use_annotation, default=default_value)\n-        elif not field_annotation_is_scalar(annotation=type_annotation):\n+        elif (\n+            not field_annotation_is_scalar(type_annotation)\n+            # Treat root models as Body parameters by default\n+            or field_annotation_is_root_model(type_annotation)\n+        ):\n             field_info = params.Body(annotation=use_annotation, default=default_value)\n         else:\n             field_info = params.Query(annotation=use_annotation, default=default_value)\n@@ -759,7 +765,7 @@ def request_params_to_args(\n     fields_to_extract = fields\n     single_not_embedded_field = False\n     default_convert_underscores = True\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n+    if len(fields) == 1 and resolves_to_basemodel(first_field.type_):\n         fields_to_extract = get_cached_model_fie", "output": "Code Review for: Support Pydantic root model as query parameter\n\nüìù **fastapi/_compat.py**: _compat checks in V1/V2 work quite differently and I'm not sure is it worth trying to support legacy Pydantic. Could just remove these and let it break with legacy `__root__` models like previously\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n            # Treat root models as Body parameters by default\r\n```\n\nüìù **fastapi/_compat.py**: `field_annotation_has_submodel_fields` looks unclear to me..\r\nHow about?\r\n* unwraps_to_model\r\n* unwraps_to_basemodel\r\n* resolves_to_basemodel\r\n* is_or_unwraps_to_basemodel\n\nüìù **fastapi/dependencies/utils.py**: I think we can simplify this part to just:\r\n```py\r\n    if len(fields) == 1 and field_annotation_has_submodel_fields(first_field.type_):\r\n        fields_to_extract = get_cached_model_fields(first_field.type_)\r\n        single_not_embedded_field = True\r\n```\r\nNo need to handle case with `RootModel` that doesn't wrap other model (doesn't have sub-fields) here.\r\nIf we have only one field and we don't change `fields_to_extract`, then `field.field_info` will be the same that `first_field.field_info` here:\r\n\r\n```py\r\n            convert_underscores = getattr(\r\n                field.field_info, \"convert_underscores\", default_convert_underscores\r\n            )\r\n```\n\nüìù **fastapi/encoders.py**: Wouldn't it be better to move this to `_model_dump` implementation?\n\n", "source": "pr", "type": "code_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/_compat.py`", "input": "```diff\n@@ -494,12 +499,21 @@ def get_definitions(\n         )\n \n     def is_scalar_field(field: ModelField) -> bool:\n+        if (inner := root_model_inner_type(field.type_)) is not None:\n\n```", "output": "_compat checks in V1/V2 work quite differently and I'm not sure is it worth trying to support legacy Pydantic. Could just remove these and let it break with legacy `__root__` models like previously", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -454,7 +456,11 @@ def analyze_param(\n             type_annotation\n         ) or is_uploadfile_sequence_annotation(type_annotation):\n             field_info = params.File(annotation=use_annotation, default=default_value)\n-        elif not field_annotation_is_scalar(annotation=type_annotation):\n+        elif (\n+            not field_annotation_is_scalar(type_annotation)\n+            # Root models by default regarded as bodies\n\n```", "output": "```suggestion\r\n            # Treat root models as Body parameters by default\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/_compat.py`", "input": "```diff\n@@ -572,7 +597,25 @@ def _annotation_is_complex(annotation: Union[Type[Any], None]) -> bool:\n     )\n \n \n+def field_annotation_is_root_model(annotation: Union[Type[Any], None]) -> bool:\n+    origin = get_origin(annotation)\n+    if origin is Union or origin is UnionType:\n+        return any(field_annotation_is_root_model(arg) for arg in get_args(annotation))\n+\n+    return root_model_inner_type(annotation) is not None\n+\n+\n+def field_annotation_has_submodel_fields(annotation: Union[Type[Any], None]) -> bool:\n\n```", "output": "`field_annotation_has_submodel_fields` looks unclear to me..\r\nHow about?\r\n* unwraps_to_model\r\n* unwraps_to_basemodel\r\n* resolves_to_basemodel\r\n* is_or_unwraps_to_basemodel", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -752,8 +758,9 @@ def request_params_to_args(\n     single_not_embedded_field = False\n     default_convert_underscores = True\n     if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        single_not_embedded_field = True\n+        if field_annotation_has_submodel_fields(first_field.type_):\n+            fields_to_extract = get_cached_model_fields(first_field.type_)\n+            single_not_embedded_field = True\n\n```", "output": "I think we can simplify this part to just:\r\n```py\r\n    if len(fields) == 1 and field_annotation_has_submodel_fields(first_field.type_):\r\n        fields_to_extract = get_cached_model_fields(first_field.type_)\r\n        single_not_embedded_field = True\r\n```\r\nNo need to handle case with `RootModel` that doesn't wrap other model (doesn't have sub-fields) here.\r\nIf we have only one field and we don't change `fields_to_extract`, then `field.field_info` will be the same that `first_field.field_info` here:\r\n\r\n```py\r\n            convert_underscores = getattr(\r\n                field.field_info, \"convert_underscores\", default_convert_underscores\r\n            )\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/encoders.py`", "input": "```diff\n@@ -230,10 +230,16 @@ def jsonable_encoder(\n             exclude_none=exclude_none,\n             exclude_defaults=exclude_defaults,\n         )\n-        if \"__root__\" in obj_dict:\n-            obj_dict = obj_dict[\"__root__\"]\n+\n+        if (\n+            not PYDANTIC_V2\n+            and isinstance(serialized, dict)\n+            and \"__root__\" in serialized\n+        ):\n+            serialized = serialized[\"__root__\"]\n+\n\n```", "output": "Wouldn't it be better to move this to `_model_dump` implementation?", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/_compat.py`", "input": "```diff\n@@ -292,6 +292,11 @@ def get_model_fields(model: Type[BaseModel]) -> List[ModelField]:\n             for name, field_info in model.model_fields.items()\n         ]\n \n+    def root_model_inner_type(annotation: Any) -> Any:\n+        if lenient_issubclass(annotation, RootModel):\n+            return annotation.model_fields[\"root\"].annotation\n\n```", "output": "Do we need to handle cases with root model that wraps root model?", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -925,7 +931,7 @@ async def request_body_to_args(\n \n     if (\n         single_not_embedded_field\n-        and lenient_issubclass(first_field.type_, BaseModel)\n+        and resolves_to_basemodel(first_field.type_)\n\n```", "output": "This is not covered by tests.\r\nAs this PR aims to support Root models for non-body parameters (Query and Path?), do we need to update this here (it's related to body parameters)? I suggest we do it in a separate PR and add some tests there.\r\nOr, we can update the Title and description to make this PR broader and then cover this case by tests\r", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `fastapi/_compat.py`", "input": "```diff\n@@ -573,7 +603,25 @@ def _annotation_is_complex(annotation: Union[Type[Any], None]) -> bool:\n     )\n \n \n+def field_annotation_is_root_model(annotation: Union[Type[Any], None]) -> bool:\n+    origin = get_origin(annotation)\n+    if origin is Union or origin is UnionType:\n+        return any(field_annotation_is_root_model(arg) for arg in get_args(annotation))\n\n```", "output": "Side note: this condition is not covered by tests. ToDo: think about use cases that it enables", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review this code change in `tests/test_root_model.py`", "input": "```diff\n@@ -0,0 +1,564 @@\n+from datetime import date\n+from typing import Any, Dict, Generic, List, Optional, Sequence, Type, TypeVar, Union\n+\n+import pytest\n+from dirty_equals import IsDict\n+from fastapi import Body, FastAPI, Header, Path, Query\n+from fastapi._compat import PYDANTIC_V2\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+from typing_extensions import Annotated\n+\n+from .utils import needs_pydanticv2\n+\n+app = FastAPI()\n+\n+if PYDANTIC_V2:\n+    from pydantic import RootModel\n+else:\n+    from pydantic import BaseModel\n+\n+    T = TypeVar(\"T\")\n+\n+    class RootModel(Generic[T]):\n+        def __class_getitem__(cls, type_):\n+            class Inner(BaseModel):\n+                __root__: type_\n+\n+            return Inner\n+\n+\n+Basic = RootModel[int]\n+\n+\n+class DictWrap(RootModel[Dict[str, int]]):\n+    pass\n+\n+\n+if PYDANTIC_V2:\n+    from pydantic import ConfigDict, Field, field_validator, model_serializer\n+\n+    class FieldWrap(RootModel[str]):\n+        model_config = ConfigDict(\n+            json_schema_extra={\"description\": \"parameter starts with bar_\"}\n+        )\n+        root: str = Field(pattern=r\"^bar_.*$\")\n\n```", "output": "I did some experiments with `description` and `pattern` parameters and I find it a bit confusing..\r\nWe can specify description in 3 places:\r\n* `json_schema_extra={\"description\": \"...\"}` - will be displayed by Swagger in components->schemas\r\n* `root: str = Field(description=\"...\")` - will be displayed by Swagger in components->schemas, but description from from json_schema_extra overrides it\r\n* `def query_fieldwrap(q: Annotated[FieldWrap, Query(description=\"...\")]):` - will be displayed by Swagger in parameters\r\n\r\nNot sure there is an issue here, but we should make sure why it works this way and decide how we should recommend people specify it.\r\n\r\n---\r\n\r\nFor `pattern` parameter we have 2 options:\r\n* `root: str = Field(pattern=r\"^bar_.*$\")` - will work (displayed in parameters and in components->schemas, and will be used for validation)\r\n* `async def read_root(name: Param = Query(pattern=\"^[a-z]+[0-9]$\")):` - will be used to generate the schema name (`Param_a-z___0-9____`). FastAPI will raise `TypeError: Unable to apply constraint 'pattern' to supplied value root='eee' for schema of type 'model'` on request\r\n\r\nThis doesn't look intuitively for me.. We should probably handle this and raise an error on startup. Or support specifying this parameter this way.\r\n\r\n<details><summary>Code in the details</summary>\r\n\r\n```py\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Query\r\nfrom pydantic import ConfigDict, Field, RootModel\r\n\r\napp = FastAPI()\r\n\r\n\r\nclass Param(RootModel[str]):\r\n    root: Annotated[\r\n        str,\r\n        Field(\r\n            description=\"Description from RootModel root annotation\",  # Displayed in Components, overriden by json_schema_extra\r\n            pattern=\"^[a-z]+$\",  # This works (displayed in parameters and validated)\r\n        ),\r\n    ]\r\n\r\n    model_config = ConfigDict(\r\n        json_schema_extra={\r\n            \"description\": \"Description from model_config\"  # Displayed in Components\r\n        }\r\n    )\r\n\r\n\r\n@app.get(\"/\")\r\nasync def read_root(\r\n    name: Annotated[\r\n        Param,\r\n        Query(\r\n            description=\"Description from function parameter annotation\",  # Works (displayed in parameters)\r\n            # pattern=\"^[a-z]+[0-9]$\",  # Raises \"Unable to apply constraint 'pattern' to supplied value\" on request\r\n        ),\r\n    ],\r\n):\r\n    return {\"Hello\": name}\r\n```\r\n\r\n</details>\r\n\r", "source": "pr_review", "type": "inline_review", "pr_number": 303}
{"instruction": "Review the following code changes: üî® Add max pages to translate to configs", "input": "```diff\n@@ -35,6 +35,11 @@ on:\n         type: boolean\n         required: false\n         default: false\n+      max:\n+        description: Maximum number of items to translate (e.g. 10)\n+        type: number\n+        required: false\n+        default: 10\n \n jobs:\n   langs:\n@@ -115,3 +120,4 @@ jobs:\n           EN_PATH: ${{ github.event.inputs.en_path }}\n           COMMAND: ${{ matrix.command }}\n           COMMIT_IN_PLACE: ${{ github.event.inputs.commit_in_place }}\n+          MAX: ${{ github.event.inputs.max }}\n\n```\n\n```diff\n@@ -347,31 +347,40 @@ def list_outdated(language: str) -> list[Path]:\n \n \n @app.command()\n-def update_outdated(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n+def update_outdated(\n+    language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")],\n+    max: Annotated[int, typer.Option(envvar=\"MAX\")] = 10,\n+) -> None:\n     outdated_paths = list_outdated(language)\n-    for path in outdated_paths:\n+    for path in outdated_paths[:max]:\n         print(f\"Updating lang: {language} path: {path}\")\n         translate_page(language=language, en_path=path)\n         print(f\"Done updating: {path}\")\n     print(\"Done updating all outdated paths\")\n \n \n @app.command()\n-def add_missing(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n+def add_missing(\n+    language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")],\n+    max: Annotated[int, typer.Option(envvar=\"MAX\")] = 10,\n+) -> None:\n     missing_paths = list_missing(language)\n-    for path in missing_paths:\n+    for path in missing_paths[:max]:\n         print(f\"Adding lang: {language} path: {path}\")\n         translate_page(language=language, en_path=path)\n         print(f\"Done adding: {path}\")\n     print(\"Done adding all missing paths\")\n \n \n @app.command()\n-def update_and_add(language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")]) -> None:\n+def update_and_add(\n+    language: Annotated[str, typer.Option(envvar=\"LANGUAGE\")],\n+    max: Annotated[int, typer.Option(envvar=\"MAX\")] = 10,\n+) -> None:\n     print(f\"Updating outdated translations for {language}\")\n-    update_outdated(language=language)\n+    update_outdated(language=language, max=max)\n     print(f\"Adding missing translations for {language}\")\n-    add_missing(language=language)\n+    add_missing(language=language, max=max)\n     print(f\"Done updating and adding for {language}\")\n \n \n\n```", "output": "Changes look good. This PR implements: üî® Add max pages to translate to configs", "source": "pr", "type": "code_review", "pr_number": 302}
{"instruction": "Review the following code changes: üåê Enable French docs translations", "input": "```diff\n@@ -317,6 +317,8 @@ extra:\n     name: de - Deutsch\n   - link: /es/\n     name: es - espa√±ol\n+  - link: /fr/\n+    name: fr - fran√ßais\n   - link: /ja/\n     name: ja - Êó•Êú¨Ë™û\n   - link: /ko/\n\n```\n\n```diff\n@@ -23,7 +23,7 @@\n     \"de\",\n     \"en\",\n     \"es\",\n-    # \"fr\",\n+    \"fr\",\n     \"ja\",\n     \"ko\",\n     \"pt\",\n\n```", "output": "Changes look good. This PR implements: üåê Enable French docs translations", "source": "pr", "type": "code_review", "pr_number": 301}
{"instruction": "Review the following code changes: üåê Enable Traditional Chinese translations", "input": "```diff\n@@ -331,6 +331,8 @@ extra:\n     name: tr - T√ºrk√ße\n   - link: /uk/\n     name: uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞\n+  - link: /zh-hant/\n+    name: zh-hant - ÁπÅÈ´î‰∏≠Êñá\n extra_css:\n - css/termynal.css\n - css/custom.css\n\n```\n\n```diff\n@@ -31,7 +31,7 @@\n     \"tr\",\n     \"uk\",\n     # \"zh\",\n-    # \"zh-hant\",\n+    \"zh-hant\",\n }\n \n \n\n```", "output": "Changes look good. This PR implements: üåê Enable Traditional Chinese translations", "source": "pr", "type": "code_review", "pr_number": 300}
{"instruction": "Review the following code changes: ‚úÖ Add regression test for `ForwardRef` in annotated dependency", "input": "```diff\n@@ -2,6 +2,7 @@\n import sys\n from collections.abc import AsyncGenerator, Generator\n from functools import wraps\n+from typing import Annotated, ForwardRef\n \n import pytest\n from fastapi import Depends, FastAPI\n@@ -447,3 +448,22 @@ def test_class_dependency(route):\n     response = client.get(route)\n     assert response.status_code == 200, response.text\n     assert response.json() is True\n+\n+\n+def test_annotated_forwardref_dependency():\n+    app = FastAPI()\n+\n+    User = ForwardRef(\"User\")\n+\n+    def get_user() -> \"User\":\n+        return {\"name\": \"amulya\"}\n+\n+    @app.get(\"/\")\n+    def read_user(user: Annotated[User, Depends(get_user)]):\n+        return user\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 200\n+    assert response.json() == {\"name\": \"amulya\"}\n\n```\n\n```diff\n@@ -0,0 +1,23 @@\n+from typing import Annotated, ForwardRef\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_annotated_forwardref_dependency():\n+    app = FastAPI()\n+\n+    User = ForwardRef(\"User\")\n+\n+    def get_user() -> \"User\":\n+        return {\"name\": \"amulya\"}\n+\n+    @app.get(\"/\")\n+    def read_user(user: Annotated[User, Depends(get_user)]):\n+        return user\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+\n+    assert response.status_code == 200\n+    assert response.json() == {\"name\": \"amulya\"}\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Add regression test for `ForwardRef` in annotated dependency", "source": "pr", "type": "code_review", "pr_number": 299}
{"instruction": "Review the following code changes: ‚ú® Add support for PEP695 `TypeAliasType`", "input": "```diff\n@@ -66,6 +66,7 @@\n from starlette.responses import Response\n from starlette.websockets import WebSocket\n from typing_extensions import Literal, get_args, get_origin\n+from typing_inspection.typing_objects import is_typealiastype\n \n multipart_not_installed_error = (\n     'Form data requires \"python-multipart\" to be installed. \\n'\n@@ -370,6 +371,9 @@ def analyze_param(\n     depends = None\n     type_annotation: Any = Any\n     use_annotation: Any = Any\n+    if is_typealiastype(annotation):\n+        # unpack in case PEP 695 type syntax is used\n+        annotation = annotation.__value__\n     if annotation is not inspect.Signature.empty:\n         use_annotation = annotation\n         type_annotation = annotation\n\n```\n\n```diff\n@@ -46,6 +46,7 @@ dependencies = [\n     \"starlette>=0.40.0,<0.51.0\",\n     \"pydantic>=2.7.0\",\n     \"typing-extensions>=4.8.0\",\n+    \"typing-inspection>=0.4.2\",\n     \"annotated-doc>=0.0.2\",\n ]\n \n\n```\n\n```diff\n@@ -0,0 +1,27 @@\n+from typing import Annotated\n+\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+from typing_extensions import TypeAliasType\n+\n+\n+async def some_value() -> int:\n+    return 123\n+\n+\n+DependedValue = TypeAliasType(\n+    \"DependedValue\", Annotated[int, Depends(some_value)], type_params=()\n+)\n+\n+\n+def test_pep695_type_dependencies():\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    async def get_with_dep(value: DependedValue) -> str:  # noqa\n+        return f\"value: {value}\"\n+\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    assert response.text == '\"value: 123\"'\n\n```\n\n```diff\n@@ -1021,6 +1021,7 @@ dependencies = [\n     { name = \"starlette\", version = \"0.49.3\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version < '3.10'\" },\n     { name = \"starlette\", version = \"0.50.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n     { name = \"typing-extensions\" },\n+    { name = \"typing-inspection\" },\n ]\n \n [package.optional-dependencies]\n@@ -1202,6 +1203,7 @@ requires-dist = [\n     { name = \"pyyaml\", marker = \"extra == 'all'\", specifier = \">=5.3.1\" },\n     { name = \"starlette\", specifier = \">=0.40.0,<0.51.0\" },\n     { name = \"typing-extensions\", specifier = \">=4.8.0\" },\n+    { name = \"typing-inspection\", specifier = \">=0.4.2\" },\n     { name = \"ujson\", marker = \"extra == 'all'\", specifier = \">=4.0.1,!=4.0.2,!=4.1.0,!=4.2.0,!=4.3.0,!=5.0.0,!=5.1.0\" },\n     { name = \"uvicorn\", extras = [\"standard\"], marker = \"extra == 'all'\", specifier = \">=0.12.0\" },\n     { name = \"uvicorn\", extras = [\"standard\"], marker = \"extra == 'standard'\", specifier = \">=0.12.0\" },\n\n```\n\n```diff\n@@ -1010,3 +1020,26 @@ def get_body_field(\n         field_info=BodyFieldInfo(**BodyFieldInfo_kwargs),\n     )\n     return final_field\n+\n+\n+def _is_typealiastype(tp: Any, /) -> TypeGuard[TypeAliasType]:\n+    in_typing = hasattr(typing, \"TypeAliasType\")\n\n```", "output": "Code Review for: ‚ú® Add support for PEP695 `TypeAliasType`\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n    \"\"\"\r\n    This implementation is in line with the implementation of `is_typealiastype` in `typing-inspection`:\r\n    See:\r\n    - https://github.com/pydantic/typing-inspection/blob/8db011350942f33ac4b5d7db60d4d9ea83ab480f/src/typing_inspection/typing_objects.py#L488-L499\r\n    - https://github.com/pydantic/typing-inspection/blob/8db011350942f33ac4b5d7db60d4d9ea83ab480f/src/typing_inspection/typing_objects.py#L105-L134\r\n    \"\"\"\r\n\r\n    # Check if TypeAliasType exists in typing and/or typing_extensions.\r\n    in_typing = hasattr(typing, \"TypeAliasType\")\r\n```\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n\r\n    is_typealiastype = False  # Default: assume not a TypeAliasType\r\n```\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n            # Case 1: Both implementations are the same object.\r\n            # Checking against one of them.\r\n            is_typealiastype = isinstance(tp, typing.TypeAliasType)  # type: ignore [attr-defined]\r\n```\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n            # Case 2: Implementations are different objects.\r\n            # Need to check against both versions.\r\n            is_typealiastype = isinstance(\r\n```\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n        # Case 3: Only typing.TypeAliasType exists.\r\n        is_typealiastype = isinstance(tp, typing.TypeAliasType)  # type: ignore [attr-defined]\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 298}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -1010,3 +1020,26 @@ def get_body_field(\n         field_info=BodyFieldInfo(**BodyFieldInfo_kwargs),\n     )\n     return final_field\n+\n+\n+def _is_typealiastype(tp: Any, /) -> TypeGuard[TypeAliasType]:\n+    in_typing = hasattr(typing, \"TypeAliasType\")\n\n```", "output": "```suggestion\r\n    \"\"\"\r\n    This implementation is in line with the implementation of `is_typealiastype` in `typing-inspection`:\r\n    See:\r\n    - https://github.com/pydantic/typing-inspection/blob/8db011350942f33ac4b5d7db60d4d9ea83ab480f/src/typing_inspection/typing_objects.py#L488-L499\r\n    - https://github.com/pydantic/typing-inspection/blob/8db011350942f33ac4b5d7db60d4d9ea83ab480f/src/typing_inspection/typing_objects.py#L105-L134\r\n    \"\"\"\r\n\r\n    # Check if TypeAliasType exists in typing and/or typing_extensions.\r\n    in_typing = hasattr(typing, \"TypeAliasType\")\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 298}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -364,6 +371,9 @@ def analyze_param(\n     depends = None\n     type_annotation: Any = Any\n     use_annotation: Any = Any\n+    if _is_typealiastype(annotation):\n+        # unpack in case py3.12 type syntax is used\n\n```", "output": "```suggestion\r\n        # unpack in case PEP 695 type syntax is used\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 298}
{"instruction": "Review this code change in `tests/test_dependency_pep695.py`", "input": "```diff\n@@ -0,0 +1,27 @@\n+from __future__ import annotations\n\n```", "output": "Do we really need this import?", "source": "pr_review", "type": "inline_review", "pr_number": 298}
{"instruction": "Review the following code changes: Docs: clarify SQLite threading and pagination limit in SQL tutorial", "input": "```diff\n@@ -14,7 +14,9 @@ class Hero(SQLModel, table=True):\n sqlite_file_name = \"database.db\"\n sqlite_url = f\"sqlite:///{sqlite_file_name}\"\n \n-connect_args = {\"check_same_thread\": False}\n+connect_args = {\n+    \"check_same_thread\": False\n+}  # needed for SQLite when using the session across threads\n engine = create_engine(sqlite_url, connect_args=connect_args)\n \n \n@@ -49,7 +51,9 @@ def create_hero(hero: Hero, session: SessionDep) -> Hero:\n def read_heroes(\n     session: SessionDep,\n     offset: int = 0,\n-    limit: Annotated[int, Query(le=100)] = 100,\n+    limit: Annotated[\n+        int, Query(le=100)\n+    ] = 100,  # safety cap to avoid returning too many rows\n ) -> list[Hero]:\n     heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n     return heroes\n\n```\n\n```diff\n@@ -14,7 +14,9 @@ class Hero(SQLModel, table=True):\n sqlite_file_name = \"database.db\"\n sqlite_url = f\"sqlite:///{sqlite_file_name}\"\n \n-connect_args = {\"check_same_thread\": False}\n+connect_args = {\n+    \"check_same_thread\": False\n+}  # needed for SQLite when using the session across threads\n engine = create_engine(sqlite_url, connect_args=connect_args)\n \n \n@@ -49,7 +51,9 @@ def create_hero(hero: Hero, session: SessionDep) -> Hero:\n def read_heroes(\n     session: SessionDep,\n     offset: int = 0,\n-    limit: Annotated[int, Query(le=100)] = 100,\n+    limit: Annotated[\n+        int, Query(le=100)\n+    ] = 100,  # safety cap to avoid returning too many rows\n ) -> list[Hero]:\n     heroes = session.exec(select(Hero).offset(offset).limit(limit)).all()\n     return heroes\n\n```", "output": "Changes look good. This PR implements: Docs: clarify SQLite threading and pagination limit in SQL tutorial", "source": "pr", "type": "code_review", "pr_number": 297}
{"instruction": "Review the following code changes: Default dependency scope 20260205", "input": "```diff\n@@ -27,7 +27,7 @@\n )\n from fastapi.openapi.utils import get_openapi\n from fastapi.params import Depends\n-from fastapi.types import DecoratedCallable, IncEx\n+from fastapi.types import DecoratedCallable, DependencyScope, IncEx\n from fastapi.utils import generate_unique_id\n from starlette.applications import Starlette\n from starlette.datastructures import State\n@@ -844,6 +844,12 @@ class Item(BaseModel):\n                 \"\"\"\n             ),\n         ] = None,\n+        default_dependency_scope: Annotated[\n+            DependencyScope,\n+            Doc(\"\"\"\n+                Default scope for dependencies that don't specify a scope.\n+                \"\"\"),\n+        ] = None,\n         **extra: Annotated[\n             Any,\n             Doc(\n@@ -873,6 +879,7 @@ class Item(BaseModel):\n         self.servers = servers or []\n         self.separate_input_output_schemas = separate_input_output_schemas\n         self.openapi_external_docs = openapi_external_docs\n+        self.default_dependency_scope = default_dependency_scope\n         self.extra = extra\n         self.openapi_version: Annotated[\n             str,\n@@ -1135,6 +1142,8 @@ async def redoc_html(req: Request) -> HTMLResponse:\n     async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n         if self.root_path:\n             scope[\"root_path\"] = self.root_path\n+        if self.default_dependency_scope:\n+            scope[\"fastapi_default_dependency_scope\"] = self.default_dependency_scope\n         await super().__call__(scope, receive, send)\n \n     def add_api_route(\n\n```\n\n```diff\n@@ -6,8 +6,7 @@\n \n from fastapi._compat import ModelField\n from fastapi.security.base import SecurityBase\n-from fastapi.types import DependencyCacheKey\n-from typing_extensions import Literal\n+from fastapi.types import DependencyCacheKey, DependencyScope\n \n if sys.version_info >= (3, 13):  # pragma: no cover\n     from inspect import iscoroutinefunction\n@@ -48,7 +47,7 @@ class Dependant:\n     parent_oauth_scopes: Optional[list[str]] = None\n     use_cache: bool = True\n     path: Optional[str] = None\n-    scope: Union[Literal[\"function\", \"request\"], None] = None\n+    scope: DependencyScope = None\n \n     @cached_property\n     def oauth_scopes(self) -> list[str]:\n\n```\n\n```diff\n@@ -49,7 +49,7 @@\n from fastapi.exceptions import DependencyScopeError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n-from fastapi.types import DependencyCacheKey\n+from fastapi.types import DependencyCacheKey, DependencyScope\n from fastapi.utils import create_model_field, get_path_param_names\n from pydantic import BaseModel, Json\n from pydantic.fields import FieldInfo\n@@ -65,7 +65,7 @@\n from starlette.requests import HTTPConnection, Request\n from starlette.responses import Response\n from starlette.websockets import WebSocket\n-from typing_extensions import Literal, get_args, get_origin\n+from typing_extensions import get_args, get_origin\n from typing_inspection.typing_objects import is_typealiastype\n \n multipart_not_installed_error = (\n@@ -262,7 +262,7 @@ def get_dependant(\n     own_oauth_scopes: Optional[list[str]] = None,\n     parent_oauth_scopes: Optional[list[str]] = None,\n     use_cache: bool = True,\n-    scope: Union[Literal[\"function\", \"request\"], None] = None,\n+    scope: DependencyScope = None,\n ) -> Dependant:\n     dependant = Dependant(\n         call=call,\n@@ -428,8 +428,7 @@ def analyze_param(\n     # Get Depends from default value\n     if isinstance(value, params.Depends):\n         assert depends is None, (\n-            \"Cannot specify `Depends` in `Annotated` and default value\"\n-            f\" together for {param_name!r}\"\n+            f\"Cannot specify `Depends` in `Annotated` and default value together for {param_name!r}\"\n         )\n         assert field_info is None, (\n             \"Cannot specify a FastAPI annotation in `Annotated` and `Depends` as a\"\n@@ -439,8 +438,7 @@ def analyze_param(\n     # Get FieldInfo from default value\n     elif isinstance(value, FieldInfo):\n         assert field_info is None, (\n-            \"Cannot specify FastAPI annotations in `Annotated` and default value\"\n-            f\" together for {param_name!r}\"\n+            f\"Cannot specify FastAPI annotations in `Annotated` and default value together for {param_name!r}\"\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n@@ -492,8 +490,7 @@ def analyze_param(\n         # Handle field_info.in_\n         if is_path_param:\n             assert isinstance(field_info, params.Path), (\n-                f\"Cannot use `{field_info.__class__.__name__}` for path param\"\n-                f\" {param_name!r}\"\n+                f\"Cannot use `{field_info.__class__.__name__}` for path param {param_name!r}\"\n             )\n         elif (\n             isinstance(field_info, params.Param)\n@@ -592,6 +589,7 @@ async def solve_dependencies(\n     assert isinstance(function_astack, AsyncExitStack), (\n         \"fastapi_function_astack not found in request scope\"\n     )", "output": "Changes look good. This PR implements: Default dependency scope 20260205", "source": "pr", "type": "code_review", "pr_number": 296}
{"instruction": "Review the following code changes: üë∑ Run tests with lower bound uv sync, upgrade `fastapi[all]` minimum dependencies: `ujson >=5.8.0`, `orjson >=3.9.3`", "input": "```diff\n@@ -49,31 +49,40 @@ jobs:\n       matrix:\n         os: [ windows-latest, macos-latest ]\n         python-version: [ \"3.14\" ]\n+        uv-resolution:\n+          - highest\n         include:\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n             coverage: coverage\n+            uv-resolution: lowest-direct\n           - os: macos-latest\n             python-version: \"3.10\"\n             coverage: coverage\n+            uv-resolution: highest\n           - os: windows-latest\n             python-version: \"3.12\"\n             coverage: coverage\n+            uv-resolution: lowest-direct\n           - os: ubuntu-latest\n             python-version: \"3.13\"\n             coverage: coverage\n+            uv-resolution: highest\n             # Ubuntu with 3.13 needs coverage for CodSpeed benchmarks\n           - os: ubuntu-latest\n             python-version: \"3.13\"\n             coverage: coverage\n+            uv-resolution: highest\n             codspeed: codspeed\n           - os: ubuntu-latest\n             python-version: \"3.14\"\n             coverage: coverage\n+            uv-resolution: highest\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n     env:\n       UV_PYTHON: ${{ matrix.python-version }}\n+      UV_RESOLUTION: ${{ matrix.uv-resolution }}\n     steps:\n       - name: Dump GitHub context\n         env:\n@@ -92,7 +101,7 @@ jobs:\n             pyproject.toml\n             uv.lock\n       - name: Install Dependencies\n-        run: uv sync --locked --no-dev --group tests --extra all\n+        run: uv sync --no-dev --group tests --extra all\n       - run: mkdir coverage\n       - name: Test\n         if: matrix.codspeed != 'codspeed'\n\n```\n\n```diff\n@@ -108,9 +108,9 @@ all = [\n     # For Starlette's schema generation, would not be used with FastAPI\n     \"pyyaml >=5.3.1\",\n     # For UJSONResponse\n-    \"ujson >=4.0.1,!=4.0.2,!=4.1.0,!=4.2.0,!=4.3.0,!=5.0.0,!=5.1.0\",\n+    \"ujson >=5.8.0\",\n     # For ORJSONResponse\n-    \"orjson >=3.2.1\",\n+    \"orjson >=3.9.3\",\n     # To validate email fields\n     \"email-validator >=2.0.0\",\n     # Uvicorn with uvloop\n@@ -167,7 +167,7 @@ tests = [\n     \"anyio[trio]>=3.2.1,<5.0.0\",\n     \"coverage[toml]>=6.5.0,<8.0\",\n     \"dirty-equals==0.9.0\",\n-    \"flask>=1.1.2,<4.0.0\",\n+    \"flask>=3.0.0,<4.0.0\",\n     \"inline-snapshot>=0.21.1\",\n     \"mypy==1.14.1\",\n     \"pwdlib[argon2]>=0.2.1\",\n\n```", "output": "Changes look good. This PR implements: üë∑ Run tests with lower bound uv sync, upgrade `fastapi[all]` minimum dependencies: `ujson >=5.8.0`, `orjson >=3.9.3`", "source": "pr", "type": "code_review", "pr_number": 295}
{"instruction": "Fix the following bug: üë∑ Test the onevent patch will solve next Starlette", "input": "üë∑ Test the onevent patch will solve next Starlette", "output": "```diff\n@@ -51,6 +51,9 @@ jobs:\n         python-version: [ \"3.14\" ]\n         uv-resolution:\n           - highest\n+        starlette-src:\n+          - starlette-pypi\n+          - starlette-git\n         include:\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n@@ -78,11 +81,13 @@ jobs:\n             python-version: \"3.14\"\n             coverage: coverage\n             uv-resolution: highest\n+            starlette-src: starlette-git\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n     env:\n       UV_PYTHON: ${{ matrix.python-version }}\n       UV_RESOLUTION: ${{ matrix.uv-resolution }}\n+      STARLETTE_SRC: ${{ matrix.starlette-src }}\n     steps:\n       - name: Dump GitHub context\n         env:\n@@ -102,10 +107,13 @@ jobs:\n             uv.lock\n       - name: Install Dependencies\n         run: uv sync --no-dev --group tests --extra all\n+      - name: Install Starlette from source\n+        if: matrix.starlette-src == 'starlette-git'\n+        run: uv pip install \"git+https://github.com/Kludex/starlette@main\"\n       - run: mkdir coverage\n       - name: Test\n         if: matrix.codspeed != 'codspeed'\n-        run: uv run bash scripts/test.sh\n+        run: uv run --no-sync bash scripts/test.sh\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n@@ -117,7 +125,7 @@ jobs:\n             CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n         with:\n           mode: simulation\n-          run: uv run coverage run -m pytest tests/ --codspeed\n+          run: uv run --no-sync coverage run -m pytest tests/ --codspeed\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n\n```\n\n```diff\n@@ -1,22 +1,31 @@\n+import contextlib\n import email.message\n import functools\n import inspect\n import json\n+import types\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n     Collection,\n     Coroutine,\n+    Generator,\n     Mapping,\n     Sequence,\n )\n-from contextlib import AsyncExitStack, asynccontextmanager\n+from contextlib import (\n+    AbstractAsyncContextManager,\n+    AbstractContextManager,\n+    AsyncExitStack,\n+    asynccontextmanager,\n+)\n from enum import Enum, IntEnum\n from typing import (\n     Annotated,\n     Any,\n     Callable,\n     Optional,\n+    TypeVar,\n     Union,\n )\n \n@@ -143,6 +152,50 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n     return app\n \n \n+_T = TypeVar(\"_T\")\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+class _AsyncLiftContextManager(AbstractAsyncContextManager[_T]):\n+    \"\"\"\n+    Wraps a synchronous context manager to make it async.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+\n+    def __init__(self, cm: AbstractContextManager[_T]) -> None:\n+        self._cm = cm\n+\n+    async def __aenter__(self) -> _T:\n+        return self._cm.__enter__()\n+\n+    async def __aexit__(\n+        self,\n+        exc_type: Optional[type[BaseException]],\n+        exc_value: Optional[BaseException],\n+        traceback: Optional[types.TracebackType],\n+    ) -> Optional[bool]:\n+        return self._cm.__exit__(exc_type, exc_value, traceback)\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+def _wrap_gen_lifespan_context(\n+    lifespan_context: Callable[[Any], Generator[Any, Any, Any]],\n+) -> Callable[[Any], AbstractAsyncContextManager[Any]]:\n+    \"\"\"\n+    Wrap a generator-based lifespan context into an async context manager.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+    cmgr = contextlib.contextmanager(lifespan_context)\n+\n+    @functools.wraps(cmgr)\n+    def wrapper(app: Any) -> _AsyncLiftContextManager[Any]:\n+        return _AsyncLiftContextManager(cmgr(app))\n+\n+    return wrapper\n+\n+\n def _merge_lifespan_context(\n     original_context: Lifespan[Any], nested_context: Lifespan[Any]\n ) -> Lifespan[Any]:\n@@ -160,6 +213,30 @@ async def merged_lifespan(\n     return merged_lifespan  # type: ignore[return-value]\n \n \n+class _DefaultLifespan:\n+    \"\"\"\n+    Default lifespan context manager that runs on_startup and on_shutdown handlers.\n+\n+    This is a copy of the Starlette _DefaultLifespan class that was removed\n+    in Starlette. FastAPI keeps it to maintain backward compatibility with\n+    on_startup and on_shutdown event handlers.\n+\n+    Ref: https://github.com/Kludex/starlette/pull/3117\n+    \"\"\"\n+\n+    def __init__(self, router: \"APIRouter\") -> None:\n+        self._router = router\n+\n+    async def __aenter__(self) -> None:\n+        await self._router._startup()\n+\n+    async def __aexit__(self, *exc_info: object) -> None:\n+        await self._router._shutdown()\n+\n+    def \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 294}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -51,6 +51,9 @@ jobs:\n         python-version: [ \"3.14\" ]\n         uv-resolution:\n           - highest\n+        starlette-src:\n+          - starlette-pypi\n+          - starlette-git\n         include:\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n@@ -78,11 +81,13 @@ jobs:\n             python-version: \"3.14\"\n             coverage: coverage\n             uv-resolution: highest\n+            starlette-src: starlette-git\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n     env:\n       UV_PYTHON: ${{ matrix.python-version }}\n       UV_RESOLUTION: ${{ matrix.uv-resolution }}\n+      STARLETTE_SRC: ${{ matrix.starlette-src }}\n     steps:\n       - name: Dump GitHub context\n         env:\n@@ -102,10 +107,13 @@ jobs:\n             uv.lock\n       - name: Install Dependencies\n         run: uv sync --no-dev --group tests --extra all\n+      - name: Install Starlette from source\n+        if: matrix.starlette-src == 'starlette-git'\n+        run: uv pip install \"git+https://github.com/Kludex/starlette@main\"\n       - run: mkdir coverage\n       - name: Test\n         if: matrix.codspeed != 'codspeed'\n-        run: uv run bash scripts/test.sh\n+        run: uv run --no-sync bash scripts/test.sh\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n@@ -117,7 +125,7 @@ jobs:\n             CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n         with:\n           mode: simulation\n-          run: uv run coverage run -m pytest tests/ --codspeed\n+          run: uv run --no-sync coverage run -m pytest tests/ --codspeed\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n\n```\n\n```diff\n@@ -1,22 +1,31 @@\n+import contextlib\n import email.message\n import functools\n import inspect\n import json\n+import types\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n     Collection,\n     Coroutine,\n+    Generator,\n     Mapping,\n     Sequence,\n )\n-from contextlib import AsyncExitStack, asynccontextmanager\n+from contextlib import (\n+    AbstractAsyncContextManager,\n+    AbstractContextManager,\n+    AsyncExitStack,\n+    asynccontextmanager,\n+)\n from enum import Enum, IntEnum\n from typing import (\n     Annotated,\n     Any,\n     Callable,\n     Optional,\n+    TypeVar,\n     Union,\n )\n \n@@ -143,6 +152,50 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n     return app\n \n \n+_T = TypeVar(\"_T\")\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+class _AsyncLiftContextManager(AbstractAsyncContextManager[_T]):\n+    \"\"\"\n+    Wraps a synchronous context manager to make it async.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+\n+    def __init__(self, cm: AbstractContextManager[_T]) -> None:\n+        self._cm = cm\n+\n+    async def __aenter__(self) -> _T:\n+        return self._cm.__enter__()\n+\n+    async def __aexit__(\n+        self,\n+        exc_type: Optional[type[BaseException]],\n+        exc_value: Optional[BaseException],\n+        traceback: Optional[types.TracebackType],\n+    ) -> Optional[bool]:\n+        return self._cm.__exit__(exc_type, exc_value, traceback)\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+def _wrap_gen_lifespan_context(\n+    lifespan_context: Callable[[Any], Generator[Any, Any, Any]],\n+) -> Callable[[Any], AbstractAsyncContextManager[Any]]:\n+    \"\"\"\n+    Wrap a generator-based lifespan context into an async context manager.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+    cmgr = contextlib.contextmanager(lifespan_context)\n+\n+    @functools.wraps(cmgr)\n+    def wrapper(app: Any) -> _AsyncLiftContextManager[Any]:\n+        return _AsyncLiftContextManager(cmgr(app))\n+\n+    return wrapper\n+\n+\n def _merge_lifespan_contex", "output": "Bug: üë∑ Test the onevent patch will solve next Starlette\n\nüë∑ Test the onevent patch will solve next Starlette", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 294}
{"instruction": "Review the following code changes: üë∑ Test the onevent patch will solve next Starlette", "input": "```diff\n@@ -51,6 +51,9 @@ jobs:\n         python-version: [ \"3.14\" ]\n         uv-resolution:\n           - highest\n+        starlette-src:\n+          - starlette-pypi\n+          - starlette-git\n         include:\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n@@ -78,11 +81,13 @@ jobs:\n             python-version: \"3.14\"\n             coverage: coverage\n             uv-resolution: highest\n+            starlette-src: starlette-git\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n     env:\n       UV_PYTHON: ${{ matrix.python-version }}\n       UV_RESOLUTION: ${{ matrix.uv-resolution }}\n+      STARLETTE_SRC: ${{ matrix.starlette-src }}\n     steps:\n       - name: Dump GitHub context\n         env:\n@@ -102,10 +107,13 @@ jobs:\n             uv.lock\n       - name: Install Dependencies\n         run: uv sync --no-dev --group tests --extra all\n+      - name: Install Starlette from source\n+        if: matrix.starlette-src == 'starlette-git'\n+        run: uv pip install \"git+https://github.com/Kludex/starlette@main\"\n       - run: mkdir coverage\n       - name: Test\n         if: matrix.codspeed != 'codspeed'\n-        run: uv run bash scripts/test.sh\n+        run: uv run --no-sync bash scripts/test.sh\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n@@ -117,7 +125,7 @@ jobs:\n             CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n         with:\n           mode: simulation\n-          run: uv run coverage run -m pytest tests/ --codspeed\n+          run: uv run --no-sync coverage run -m pytest tests/ --codspeed\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n\n```\n\n```diff\n@@ -1,22 +1,31 @@\n+import contextlib\n import email.message\n import functools\n import inspect\n import json\n+import types\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n     Collection,\n     Coroutine,\n+    Generator,\n     Mapping,\n     Sequence,\n )\n-from contextlib import AsyncExitStack, asynccontextmanager\n+from contextlib import (\n+    AbstractAsyncContextManager,\n+    AbstractContextManager,\n+    AsyncExitStack,\n+    asynccontextmanager,\n+)\n from enum import Enum, IntEnum\n from typing import (\n     Annotated,\n     Any,\n     Callable,\n     Optional,\n+    TypeVar,\n     Union,\n )\n \n@@ -143,6 +152,50 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n     return app\n \n \n+_T = TypeVar(\"_T\")\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+class _AsyncLiftContextManager(AbstractAsyncContextManager[_T]):\n+    \"\"\"\n+    Wraps a synchronous context manager to make it async.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+\n+    def __init__(self, cm: AbstractContextManager[_T]) -> None:\n+        self._cm = cm\n+\n+    async def __aenter__(self) -> _T:\n+        return self._cm.__enter__()\n+\n+    async def __aexit__(\n+        self,\n+        exc_type: Optional[type[BaseException]],\n+        exc_value: Optional[BaseException],\n+        traceback: Optional[types.TracebackType],\n+    ) -> Optional[bool]:\n+        return self._cm.__exit__(exc_type, exc_value, traceback)\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+def _wrap_gen_lifespan_context(\n+    lifespan_context: Callable[[Any], Generator[Any, Any, Any]],\n+) -> Callable[[Any], AbstractAsyncContextManager[Any]]:\n+    \"\"\"\n+    Wrap a generator-based lifespan context into an async context manager.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+    cmgr = contextlib.contextmanager(lifespan_context)\n+\n+    @functools.wraps(cmgr)\n+    def wrapper(app: Any) -> _AsyncLiftContextManager[Any]:\n+        return _AsyncLiftContextManager(cmgr(app))\n+\n+    return wrapper\n+\n+\n def _merge_lifespan_context(\n     original_context: Lifespan[Any], nested_context: Lifespan[Any]\n ) -> Lifespan[Any]:\n@@ -160,6 +213,30 @@ async def merged_lifespan(\n     return merged_lifespan  # type: ignore[return-value]\n \n \n+class _DefaultLifespan:\n+    \"\"\"\n+    Default lifespan context manager that runs on_startup and on_shutdown handlers.\n+\n+    This is a copy of the Starlette _DefaultLifespan class that was removed\n+    in Starlette. FastAPI keeps it to maintain backward compatibility with\n+    on_startup and on_shutdown event handlers.\n+\n+    Ref: https://github.com/Kludex/starlette/pull/3117\n+    \"\"\"\n+\n+    def __init__(self, router: \"APIRouter\") -> None:\n+        self._router = router\n+\n+    async def __aenter__(self) -> None:\n+        await self._router._startup()\n+\n+    async def __aexit__(self, *exc_info: object) -> None:\n+        await self._router._shutdown()\n+\n+    def \n\n```", "output": "Changes look good. This PR implements: üë∑ Test the onevent patch will solve next Starlette", "source": "pr", "type": "code_review", "pr_number": 294}
{"instruction": "Review the following code changes: ‚ú® Add support for Starlette's scoped middleware", "input": "```diff\n@@ -85,6 +85,20 @@ The following arguments are supported:\n * `minimum_size` - Do not GZip responses that are smaller than this minimum size in bytes. Defaults to `500`.\n * `compresslevel` - Used during GZip compression. It is an integer ranging from 1 to 9. Defaults to `9`. Lower value results in faster compression but larger file sizes, while higher value results in slower compression but smaller file sizes.\n \n+## Router and Route-Level Middleware Example\n+\n+**FastAPI supports adding scoped middleware per route and router. Middleware execution order:**\n+\n+- **App‚Äëlevel middleware** runs on *every* request as soon as it enters your application, before any router or route is matched.\n+- **Router‚Äëlevel middleware** runs next, wrapping all requests to routes included on that router.\n+- **Route‚Äëlevel middleware** runs last, just around the specific path operation.\n+\n+This gives better control over where and when logic executes.\n+\n+The example below shows middleware applied at each scope. Notice how the inner route‚Äôs middleware is able to match path params ;)\n+\n+{* ../../docs_src/advanced_middleware/tutorial004.py *}\n+\n ## Other middlewares { #other-middlewares }\n \n There are many other ASGI middlewares.\n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+from fastapi import APIRouter, FastAPI, Request\n+from starlette.middleware import Middleware\n+from starlette.middleware.base import BaseHTTPMiddleware\n+\n+app = FastAPI()\n+\n+\n+@app.middleware(\"http\")\n+async def app_middleware(request: Request, call_next):\n+    print(\"App before\")\n+    response = await call_next(request)\n+    print(\"App after\")\n+    return response\n+\n+\n+async def outer_middleware(request: Request, call_next):\n+    print(\"Outer before\")\n+    response = await call_next(request)\n+    print(\"Outer after\")\n+    return response\n+\n+\n+outer = APIRouter(\n+    prefix=\"/outer\",\n+    middleware=[Middleware(BaseHTTPMiddleware, dispatch=outer_middleware)],\n+)\n+\n+\n+async def name_middleware(request: Request, call_next):\n+    print(f\"Hi {request.path_params.get('name')}!\")\n+    response = await call_next(request)\n+    print(f\"Bye {request.path_params.get('name')}!\")\n+    return response\n+\n+\n+inner = APIRouter(prefix=\"/inner\")\n+\n+\n+@inner.get(\n+    \"/{name}\",\n+    middleware=[Middleware(BaseHTTPMiddleware, dispatch=name_middleware)],\n+)\n+async def hello(name: str):\n+    print(\"Handler\")\n+    return {\"message\": f\"Hello {name} from inner!\"}\n+\n+\n+@outer.get(\"/\")\n+async def outer_hello():\n+    print(\"Handler\")\n+    return {\"message\": \"Hello from outer!\"}\n+\n+\n+@app.get(\"/\")\n+async def app_hello():\n+    print(\"Handler\")\n+    return {\"message\": \"Hello from app!\"}\n+\n+\n+outer.include_router(inner)\n+app.include_router(outer)\n\n```\n\n```diff\n@@ -1084,6 +1084,7 @@ def add_api_route(\n         generate_unique_id_function: Callable[[routing.APIRoute], str] = Default(\n             generate_unique_id\n         ),\n+        middleware: Optional[Sequence[Middleware]] = None,\n     ) -> None:\n         self.router.add_api_route(\n             path,\n@@ -1110,6 +1111,7 @@ def add_api_route(\n             name=name,\n             openapi_extra=openapi_extra,\n             generate_unique_id_function=generate_unique_id_function,\n+            middleware=middleware,\n         )\n \n     def api_route(\n@@ -1140,6 +1142,7 @@ def api_route(\n         generate_unique_id_function: Callable[[routing.APIRoute], str] = Default(\n             generate_unique_id\n         ),\n+        middleware: Optional[Sequence[Middleware]] = None,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         def decorator(func: DecoratedCallable) -> DecoratedCallable:\n             self.router.add_api_route(\n@@ -1167,6 +1170,7 @@ def decorator(func: DecoratedCallable) -> DecoratedCallable:\n                 name=name,\n                 openapi_extra=openapi_extra,\n                 generate_unique_id_function=generate_unique_id_function,\n+                middleware=middleware,\n             )\n             return func\n \n@@ -1788,6 +1792,21 @@ def get(\n                 \"\"\"\n             ),\n         ] = Default(generate_unique_id),\n+        middleware: Annotated[\n+            Optional[Sequence[Middleware]],\n+            Doc(\n+                \"\"\"\n+                List of middleware to apply to all requests handled by this route.\n+\n+                Route-level middleware is executed after application-level and router-level middleware.\n+                Any middleware declared on the router will be called before this route's middleware.\n+                Middleware are applied in reverse order: the last middleware in this list is the first to be called.\n+\n+                Read more about it in the\n+                [FastAPI docs for Middleware](https://fastapi.tiangolo.com/advanced/middleware/)\n+                \"\"\"\n+            ),\n+        ] = None,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         \"\"\"\n         Add a *path operation* using an HTTP GET operation.\n@@ -1828,6 +1847,7 @@ def read_items():\n             callbacks=call", "output": "Changes look good. This PR implements: ‚ú® Add support for Starlette's scoped middleware", "source": "pr", "type": "code_review", "pr_number": 293}
{"instruction": "Review the following code changes: üåê Update translations for ru (update-outdated)", "input": "```diff\n@@ -48,7 +48,7 @@\n checker(q=\"somequery\")\n \n```\n\n```diff\n@@ -6,13 +6,29 @@\n \n ## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `WSGIMiddleware` { #using-wsgimiddleware }\n \n-–ù—É–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WSGIMiddleware`.\n+/// info | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n+\n+–î–ª—è —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `a2wsgi`, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é `pip install a2wsgi`.\n+\n+///\n+\n+–ù—É–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `WSGIMiddleware` –∏–∑ `a2wsgi`.\n \n –ó–∞—Ç–µ–º –æ–±–µ—Ä–Ω–∏—Ç–µ WSGI‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Flask) –≤ middleware (–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π).\n \n –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –Ω–∞ –ø—É—Ç—å.\n \n-{* ../../docs_src/wsgi/tutorial001_py39.py hl[2:3,3] *}\n+{* ../../docs_src/wsgi/tutorial001_py39.py hl[1,3,23] *}\n+\n+/// note | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ\n+\n+–†–∞–Ω–µ–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WSGIMiddleware` –∏–∑ `fastapi.middleware.wsgi`, –Ω–æ —Ç–µ–ø–µ—Ä—å –æ–Ω –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π.\n+\n+–í–º–µ—Å—Ç–æ –Ω–µ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç `a2wsgi`. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ.\n+\n+–ü—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–∫–µ—Ç `a2wsgi` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `WSGIMiddleware` –∏–∑ `a2wsgi`.\n+\n+///\n \n ## –ü—Ä–æ–≤–µ—Ä—å—Ç–µ { #check-it }\n \n\n```\n\n```diff\n@@ -145,8 +145,6 @@ Successfully installed fastapi pydantic\n * –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `main.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:\n \n \n```\n\n```diff\n@@ -161,8 +161,6 @@ $ pip install \"fastapi[standard]\"\n –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `main.py` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:\n \n \n```\n\n```diff\n@@ -101,13 +101,13 @@\n –ü–æ—Å–∫–æ–ª—å–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å `Query`, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫:\n \n \n```", "output": "Changes look good. This PR implements: üåê Update translations for ru (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 292}
{"instruction": "Review the following code changes: üë∑ Run tests with Starlette from git", "input": "```diff\n@@ -51,6 +51,9 @@ jobs:\n         python-version: [ \"3.14\" ]\n         uv-resolution:\n           - highest\n+        starlette-src:\n+          - starlette-pypi\n+          - starlette-git\n         include:\n           - os: ubuntu-latest\n             python-version: \"3.9\"\n@@ -78,11 +81,13 @@ jobs:\n             python-version: \"3.14\"\n             coverage: coverage\n             uv-resolution: highest\n+            starlette-src: starlette-git\n       fail-fast: false\n     runs-on: ${{ matrix.os }}\n     env:\n       UV_PYTHON: ${{ matrix.python-version }}\n       UV_RESOLUTION: ${{ matrix.uv-resolution }}\n+      STARLETTE_SRC: ${{ matrix.starlette-src }}\n     steps:\n       - name: Dump GitHub context\n         env:\n@@ -102,10 +107,13 @@ jobs:\n             uv.lock\n       - name: Install Dependencies\n         run: uv sync --no-dev --group tests --extra all\n+      - name: Install Starlette from source\n+        if: matrix.starlette-src == 'starlette-git'\n+        run: uv pip install \"git+https://github.com/Kludex/starlette@main\"\n       - run: mkdir coverage\n       - name: Test\n         if: matrix.codspeed != 'codspeed'\n-        run: uv run bash scripts/test.sh\n+        run: uv run --no-sync bash scripts/test.sh\n         env:\n           COVERAGE_FILE: coverage/.coverage.${{ runner.os }}-py${{ matrix.python-version }}\n           CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n@@ -117,7 +125,7 @@ jobs:\n             CONTEXT: ${{ runner.os }}-py${{ matrix.python-version }}\n         with:\n           mode: simulation\n-          run: uv run coverage run -m pytest tests/ --codspeed\n+          run: uv run --no-sync coverage run -m pytest tests/ --codspeed\n       # Do not store coverage for all possible combinations to avoid file size max errors in Smokeshow\n       - name: Store coverage files\n         if: matrix.coverage == 'coverage'\n\n```", "output": "Changes look good. This PR implements: üë∑ Run tests with Starlette from git", "source": "pr", "type": "code_review", "pr_number": 291}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è Upgrade Starlette supported version range to `starlette>=0.40.0,<1.0.0`", "input": "```diff\n@@ -43,7 +43,7 @@ classifiers = [\n     \"Topic :: Internet :: WWW/HTTP\",\n ]\n dependencies = [\n-    \"starlette>=0.40.0,<0.51.0\",\n+    \"starlette>=0.40.0,<1.0.0\",\n     \"pydantic>=2.7.0\",\n     \"typing-extensions>=4.8.0\",\n     \"typing-inspection>=0.4.2\",\n\n```\n\n```diff\n@@ -1198,7 +1198,7 @@ requires-dist = [\n     { name = \"python-multipart\", marker = \"extra == 'standard'\", specifier = \">=0.0.18\" },\n     { name = \"python-multipart\", marker = \"extra == 'standard-no-fastapi-cloud-cli'\", specifier = \">=0.0.18\" },\n     { name = \"pyyaml\", marker = \"extra == 'all'\", specifier = \">=5.3.1\" },\n-    { name = \"starlette\", specifier = \">=0.40.0,<0.51.0\" },\n+    { name = \"starlette\", specifier = \">=0.40.0,<1.0.0\" },\n     { name = \"typing-extensions\", specifier = \">=4.8.0\" },\n     { name = \"typing-inspection\", specifier = \">=0.4.2\" },\n     { name = \"ujson\", marker = \"extra == 'all'\", specifier = \">=5.8.0\" },\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è Upgrade Starlette supported version range to `starlette>=0.40.0,<1.0.0`", "source": "pr", "type": "code_review", "pr_number": 290}
{"instruction": "Review the following code changes: üåê Improve LLM prompt of `uk` documentation", "input": "```diff\n@@ -8,6 +8,7 @@ Language code: uk.\n \n - Use polite/formal address consistent with existing Ukrainian docs (use ‚Äú–≤–∏/–≤–∞—à‚Äù).\n - Keep the tone concise and technical.\n+- Use one style of dashes. For example, if text contains \"-\" then use only this symbol to represent a dash.\n \n ### Headings\n \n@@ -32,6 +33,71 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): –≤—ñ–¥–ø–æ–≤—ñ–¥—å\n - path operation: –æ–ø–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—É\n - path operation function: —Ñ—É–Ω–∫—Ü—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É\n+- prompt: –ø—ñ–¥—Å–∫–∞–∑–∫–∞\n+- check: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞\n+- Parallel Server Gateway Interface: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –®–ª—é–∑—É –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –°–µ—Ä–≤–µ—Ä–∞\n+- Mozilla Developer Network: –ú–µ—Ä–µ–∂–∞ –†–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ Mozilla\n+- tutorial: –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫\n+- advanced user guide: –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\n+- deep learning: –≥–ª–∏–±–æ–∫–µ –Ω–∞–≤—á–∞–Ω–Ω—è\n+- machine learning: –º–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è\n+- dependency injection: –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π\n+- digest (HTTP): –¥–∞–π–¥–∂–µ—Å—Ç\n+- basic authentication (HTTP): –±–∞–∑–æ–≤–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è\n+- JSON schema: –°—Ö–µ–º–∞ JSON\n+- password flow: –ø–æ—Ç—ñ–∫ –ø–∞—Ä–æ–ª—é\n+- mobile: –º–æ–±—ñ–ª—å–Ω–∏–π\n+- body: —Ç—ñ–ª–æ\n+- form: —Ñ–æ—Ä–º–∞\n+- path: —à–ª—è—Ö\n+- query: –∑–∞–ø–∏—Ç\n+- cookie: –∫—É–∫—ñ\n+- header: –∑–∞–≥–æ–ª–æ–≤–æ–∫\n+- startup: –∑–∞–ø—É—Å–∫\n+- shutdown: –≤–∏–º–∫–Ω–µ–Ω–Ω—è\n+- lifespan: —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∂–∏—Ç—Ç—è\n+- authorization: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è\n+- forwarded header: –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫\n+- dependable: –∑–∞–ª–µ–∂–Ω–∏–π\n+- dependent: –∑–∞–ª–µ–∂–Ω–∏–π\n+- bound: –º–µ–∂–∞\n+- concurrency: —Ä—ñ–≤–Ω–æ—á–∞—Å–Ω—ñ—Å—Ç—å\n+- parallelism: –ø–∞—Ä–∞–ª–µ–ª—ñ–∑–º\n+- multiprocessing: –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ü–µ—Å–æ—Ä–Ω—ñ—Å—Ç—å\n+- env var: –∑–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è\n+- dict: —Å–ª–æ–≤–Ω–∏–∫\n+- enum: –ø–µ—Ä–µ–ª—ñ–∫\n+- issue: –ø—Ä–æ–±–ª–µ–º–∞\n+- server worker: —Å–µ—Ä–≤–µ—Ä–Ω–∏–π –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫\n+- worker: –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫\n+- software development kit: –Ω–∞–±—ñ—Ä –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è\n+- bearer token: —Ç–æ–∫–µ–Ω –Ω–æ—Å—ñ—è\n+- breaking change: –Ω–µ—Å—É–º—ñ—Å–Ω–∞ –∑–º—ñ–Ω–∞\n+- bug: –ø–æ–º–∏–ª–∫–∞\n+- button: –∫–Ω–æ–ø–∫–∞\n+- callable: –≤–∏–∫–ª–∏–∫–∞—î–º–∏–π\n+- code: –∫–æ–¥\n+- commit: —Ñ—ñ–∫—Å–∞—Ü—ñ—è\n+- context manager: –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç—É\n+- coroutine: —Å–ø—ñ–≤–ø—Ä–æ–≥—Ä–∞–º–∞\n+- engine: —Ä—É—à—ñ–π\n+- fake X: —Ñ–∞–ª—å—à–∏–≤–∏–π X\n+- item: –ø—Ä–µ–¥–º–µ—Ç\n+- lock: –±–ª–æ–∫—É–≤–∞–Ω–Ω—è\n+- middleware: –ø—Ä–æ–º—ñ–∂–Ω–µ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è\n+- mounting: –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è\n+- origin: –¥–∂–µ—Ä–µ–ª–æ\n+- override: –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è\n+- payload: –∫–æ—Ä–∏—Å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è\n+- processor: –ø—Ä–æ—Ü–µ—Å–æ—Ä\n+- property: –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å\n+- proxy: –ø—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏–∫\n+- pull request: –∑–∞–ø–∏—Ç –Ω–∞ –≤–∏—Ç—è–≥\n+- random-access memory: –ø–∞–º'—è—Ç—å –∑ –¥–æ–≤—ñ–ª—å–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º\n+- status code: –∫–æ–¥ —Å—Ç–∞—Ç—É—Å—É\n+- string: —Å—Ç—Ä–æ–∫–∞\n+- tag: –º—ñ—Ç–∫–∞\n+- wildcard: –¥–∏–∫–∞ –∫–∞—Ä—Ç–∞\n \n ### `///` admonitions\n \n@@ -44,3 +110,4 @@ Use the following preferred translations when they apply in documentation prose:\n - `/// warning | –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è`\n - `/// info | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è`\n - `/// danger | –û–±–µ—Ä–µ–∂–Ω–æ`\n+- `/// check | –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ`\n\n```\n\n```diff\n@@ -32,6 +33,77 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): –≤—ñ–¥–ø–æ–≤—ñ–¥—å\n - path operation: –æ–ø–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—É\n - path operation function: —Ñ—É–Ω–∫—Ü—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É\n+- prompt: –ø—ñ–¥—Å–∫–∞–∑–∫–∞\n+- check: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞\n+- Parallel Server Gateway Interface: –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –°–µ—Ä–≤–µ—Ä–Ω–∏–π –í—Ö—ñ–¥–Ω–∏–π –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å\n+- Mozilla Developer Network: –ú–µ—Ä–µ–∂–∞ –†–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ Mozilla\n+- tutorial: –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫\n+- advanced user guide: –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\n+- data science: –Ω–∞—É–∫–∞ –ø—Ä–æ –¥–∞–Ω—ñ\n\n```\n\n```diff\n@@ -32,6 +33,77 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): –≤—ñ–¥–ø–æ–≤—ñ–¥—å\n - path operation: –æ–ø–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—É\n - path operation function: —Ñ—É–Ω–∫—Ü—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É\n+- prompt: –ø—ñ–¥—Å–∫–∞–∑–∫–∞\n+- check: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞\n+- Parallel Server Gateway Interface: –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –°–µ—Ä–≤–µ—Ä–Ω–∏–π –í—Ö—ñ–¥–Ω–∏–π –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å\n+- Mozilla Developer Network: –ú–µ—Ä–µ–∂–∞ –†–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ Mozilla\n+- tutorial: –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫\n+- advanced user guide: –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\n+- data science: –Ω–∞—É–∫–∞ –ø—Ä–æ –¥–∞–Ω—ñ\n+- deep learning: –≥–ª–∏–±–æ–∫–µ –Ω–∞–≤—á–∞–Ω–Ω—è\n+- machine learning: –º–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è\n+- dependency injection: –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π\n+- HTTP Digest: HTTP –î–∞–π–¥–∂–µ—Å—Ç\n+- HTTP Basic authentication: –ë–∞–∑–æ–≤–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è HTTP\n+- JSON schema: –°—Ö–µ–º–∞ JSON\n+- password flow: –ø–æ—Ç—ñ–∫ –ø–∞—Ä–æ–ª—é\n+- mobile: –º–æ–±—ñ–ª—å–Ω–∏–π\n+- body: —Ç—ñ–ª–æ\n+- form: —Ñ–æ—Ä–º–∞\n+- path: —à–ª—è—Ö\n+- query: –∑–∞–ø–∏—Ç\n+- cookie: –∫—É–∫—ñ\n+- header: –∑–∞–≥–æ–ª–æ–≤–æ–∫\n+- startup: –∑–∞–ø—É—Å–∫\n+- shutdown: –≤–∏–º–∫–Ω–µ–Ω–Ω—è\n+- lifespan: —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∂–∏—Ç—Ç—è\n+- authorization: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è\n+- forwarded header: –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫\n+- dependable: –∑–∞–ª–µ–∂–Ω–∏–π\n+- dependent: –∑–∞–ª–µ–∂–Ω–∏–π\n+- bound: –º–µ–∂–∞\n+- concurrency: —Ä—ñ–≤–Ω–æ—á–∞—Å–Ω—ñ—Å—Ç—å\n+- parallelism: –ø–∞—Ä–∞–ª–µ–ª—ñ–∑–º\n+- multiprocessing: –±–∞–≥–∞—Ç–æ–ø—Ä–æ—Ü–µ—Å–æ—Ä–Ω—ñ—Å—Ç—å\n+- env var: –∑–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è\n+- CLI: –Ü–ö–†\n+- dict: —Å–ª–æ–≤–Ω–∏–∫\n+- enum: –ø–µ—Ä–µ–ª—ñ—á–µ–Ω–Ω—è\n\n```", "output": "Code Review for: üåê Improve LLM prompt of `uk` documentation\n\nüìù **docs/uk/llm-prompt.md**: data-science - –Ω–µ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—î—Ç—å—Å—è\n\nüìù **docs/uk/llm-prompt.md**: ```suggestion\r\n- enum: –ø–µ—Ä–µ–ª—ñ–∫\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 289}
{"instruction": "Review this code change in `docs/uk/llm-prompt.md`", "input": "```diff\n@@ -32,6 +33,77 @@ Use the following preferred translations when they apply in documentation prose:\n - response (HTTP): –≤—ñ–¥–ø–æ–≤—ñ–¥—å\n - path operation: –æ–ø–µ—Ä–∞—Ü—ñ—è —à–ª—è—Ö—É\n - path operation function: —Ñ—É–Ω–∫—Ü—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ—ó —à–ª—è—Ö—É\n+- prompt: –ø—ñ–¥—Å–∫–∞–∑–∫–∞\n+- check: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞\n+- Parallel Server Gateway Interface: –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –°–µ—Ä–≤–µ—Ä–Ω–∏–π –í—Ö—ñ–¥–Ω–∏–π –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å\n+- Mozilla Developer Network: –ú–µ—Ä–µ–∂–∞ –†–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ Mozilla\n+- tutorial: –Ω–∞–≤—á–∞–ª—å–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫\n+- advanced user guide: –ø—Ä–æ—Å—É–Ω—É—Ç–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\n+- data science: –Ω–∞—É–∫–∞ –ø—Ä–æ –¥–∞–Ω—ñ\n\n```", "output": "data-science - –Ω–µ –ø–µ—Ä–µ–∫–ª–∞–¥–∞—î—Ç—å—Å—è", "source": "pr_review", "type": "inline_review", "pr_number": 289}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è Upgrade development dependencies", "input": "```diff\n@@ -129,62 +129,62 @@ dev = [\n     { include-group = \"tests\" },\n     { include-group = \"docs\" },\n     { include-group = \"translations\" },\n-    \"playwright>=1.57.0\",\n-    \"prek==0.2.22\",\n+    \"playwright >=1.57.0\",\n+    \"prek >=0.2.22\",\n ]\n docs = [\n     { include-group = \"docs-tests\" },\n-    \"black==25.1.0\",\n-    \"cairosvg==2.8.2\",\n-    \"griffe-typingdoc==0.3.0\",\n-    \"griffe-warnings-deprecated==1.1.0\",\n-    \"jieba==0.42.1\",\n-    \"markdown-include-variants==0.0.8\",\n-    \"mdx-include>=1.4.1,<2.0.0\",\n-    \"mkdocs-macros-plugin==1.5.0\",\n-    \"mkdocs-material==9.7.0\",\n-    \"mkdocs-redirects>=1.2.1,<1.3.0\",\n-    \"mkdocstrings[python]==0.30.1\",\n-    \"pillow==11.3.0\",\n-    \"python-slugify==8.0.4\",\n-    \"pyyaml>=5.3.1,<7.0.0\",\n-    \"typer==0.21.1\",\n+    \"black >=25.1.0\",\n+    \"cairosvg >=2.8.2\",\n+    \"griffe-typingdoc >=0.3.0\",\n+    \"griffe-warnings-deprecated >=1.1.0\",\n+    \"jieba >=0.42.1\",\n+    \"markdown-include-variants >=0.0.8\",\n+    \"mdx-include >=1.4.1,<2.0.0\",\n+    \"mkdocs-macros-plugin >=1.5.0\",\n+    \"mkdocs-material >=9.7.0\",\n+    \"mkdocs-redirects >=1.2.1,<1.3.0\",\n+    \"mkdocstrings[python] >=0.30.1\",\n+    \"pillow >=11.3.0\",\n+    \"python-slugify >=8.0.4\",\n+    \"pyyaml >=5.3.1,<7.0.0\",\n+    \"typer >=0.21.1\",\n ]\n docs-tests = [\n-    \"httpx>=0.23.0,<1.0.0\",\n-    \"ruff==0.14.14\",\n+    \"httpx >=0.23.0,<1.0.0\",\n+    \"ruff >=0.14.14\",\n ]\n github-actions = [\n-    \"httpx>=0.27.0,<1.0.0\",\n-    \"pydantic>=2.5.3,<3.0.0\",\n-    \"pydantic-settings>=2.1.0,<3.0.0\",\n-    \"pygithub>=2.3.0,<3.0.0\",\n-    \"pyyaml>=5.3.1,<7.0.0\",\n-    \"smokeshow>=0.5.0\",\n+    \"httpx >=0.27.0,<1.0.0\",\n+    \"pydantic >=2.5.3,<3.0.0\",\n+    \"pydantic-settings >=2.1.0,<3.0.0\",\n+    \"pygithub >=2.3.0,<3.0.0\",\n+    \"pyyaml >=5.3.1,<7.0.0\",\n+    \"smokeshow >=0.5.0\",\n ]\n tests = [\n     { include-group = \"docs-tests\" },\n-    \"anyio[trio]>=3.2.1,<5.0.0\",\n-    \"coverage[toml]>=6.5.0,<8.0\",\n-    \"dirty-equals==0.9.0\",\n-    \"flask>=3.0.0,<4.0.0\",\n-    \"inline-snapshot>=0.21.1\",\n-    \"mypy==1.14.1\",\n-    \"pwdlib[argon2]>=0.2.1\",\n-    \"pyjwt==2.9.0\",\n-    \"pytest>=7.1.3,<9.0.0\",\n-    \"pytest-codspeed==4.2.0\",\n-    \"pyyaml>=5.3.1,<7.0.0\",\n-    \"sqlmodel==0.0.31\",\n-    \"strawberry-graphql>=0.200.0,<1.0.0\",\n-    \"types-orjson==3.6.2\",\n-    \"types-ujson==5.10.0.20240515\",\n-    \"a2wsgi>=1.9.0,<=2.0.0\",\n+    \"anyio[trio] >=3.2.1,<5.0.0\",\n+    \"coverage[toml] >=6.5.0,<8.0\",\n+    \"dirty-equals >=0.9.0\",\n+    \"flask >=3.0.0,<4.0.0\",\n+    \"inline-snapshot >=0.21.1\",\n+    \"mypy >=1.14.1\",\n+    \"pwdlib[argon2] >=0.2.1\",\n+    \"pyjwt >=2.9.0\",\n+    \"pytest >=7.1.3,<9.0.0\",\n+    \"pytest-codspeed >=4.2.0\",\n+    \"pyyaml >=5.3.1,<7.0.0\",\n+    \"sqlmodel >=0.0.31\",\n+    \"strawberry-graphql >=0.200.0,<1.0.0\",\n+    \"types-orjson >=3.6.2\",\n+    \"types-ujson >=5.10.0.20240515\",\n+    \"a2wsgi >=1.9.0,<=2.0.0\",\n ]\n translations = [\n-    \"gitpython==3.1.46\",\n-    \"pydantic-ai==0.4.10\",\n-    \"pygithub==2.8.1\",\n+    \"gitpython >=3.1.46\",\n+    \"pydantic-ai >=0.4.10\",\n+    \"pygithub >=2.8.1\",\n ]\n \n [tool.pdm]\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è Upgrade development dependencies", "source": "pr", "type": "code_review", "pr_number": 288}
{"instruction": "Review the following code changes: üåê Update translations for tr (outdated and missing)", "input": "```diff\n@@ -78,13 +78,13 @@ Bu detaylar, √∂zellikle 0.121.0'dan eski bir FastAPI uygulamanƒ±z varsa ve `yiel\n \n ### `yield` ve `scope` ile dependency'ler { #dependencies-with-yield-and-scope }\n \n-0.121.0 s√ºr√ºm√ºnde FastAPI, `yield` kullanan dependency'ler i√ßin `Depends(scope=\"function\")` desteƒüini ekledi.\n+0.121.0 s√ºr√ºm√ºnde FastAPI, `Depends(scope=\"function\")` desteƒüini ekledi.\n \n `Depends(scope=\"function\")` kullanƒ±ldƒ±ƒüƒ±nda, `yield` sonrasƒ±ndaki √ßƒ±kƒ±≈ü kodu, *path operation function* biter bitmez, response client'a geri g√∂nderilmeden √∂nce √ßalƒ±≈ütƒ±rƒ±lƒ±r.\n \n `Depends(scope=\"request\")` (varsayƒ±lan) kullanƒ±ldƒ±ƒüƒ±nda ise `yield` sonrasƒ±ndaki √ßƒ±kƒ±≈ü kodu, response g√∂nderildikten sonra √ßalƒ±≈ütƒ±rƒ±lƒ±r.\n \n-Daha fazlasƒ±nƒ± [Dependencies with `yield` - Early exit and `scope`](../tutorial/dependencies/dependencies-with-yield.md#early-exit-and-scope) dok√ºmantasyonunda okuyabilirsiniz.\n+Daha fazlasƒ±nƒ± [`yield` ile Dependency'ler - Erken √ßƒ±kƒ±≈ü ve `scope`](../tutorial/dependencies/dependencies-with-yield.md#early-exit-and-scope) dok√ºmantasyonunda okuyabilirsiniz.\n \n ### `yield` ve `StreamingResponse` ile dependency'ler, Teknik Detaylar { #dependencies-with-yield-and-streamingresponse-technical-details }\n \n@@ -132,7 +132,7 @@ SQLModel (veya SQLAlchemy) kullanarak bu spesifik senaryoya sahipseniz, session'\n \n B√∂ylece session veritabanƒ± baƒülantƒ±sƒ±nƒ± serbest bƒ±rakƒ±r ve diƒüer request'ler bunu kullanabilir.\n \n-`yield` kullanan bir dependency'den erken √ßƒ±kƒ±≈ü gerektiren farklƒ± bir kullanƒ±m senaryonuz varsa, l√ºtfen kullanƒ±m senaryonuzla birlikte ve `yield` kullanan dependency'ler i√ßin erken kapatmadan neden fayda g√∂receƒüinizi a√ßƒ±klayarak bir <a href=\"https://github.com/fastapi/fastapi/discussions/new?category=questions\" class=\"external-link\" target=\"_blank\">GitHub Discussion Question</a> olu≈üturun.\n+`yield` kullanan bir dependency'den erken √ßƒ±kƒ±≈ü gerektiren farklƒ± bir kullanƒ±m senaryonuz varsa, l√ºtfen kullanƒ±m senaryonuzla birlikte ve `yield` kullanan dependency'ler i√ßin erken kapatmadan neden fayda g√∂receƒüinizi a√ßƒ±klayarak bir <a href=\"https://github.com/fastapi/fastapi/discussions/new?category=questions\" class=\"external-link\" target=\"_blank\">GitHub Discussion Sorusu</a> olu≈üturun.\n \n `yield` kullanan dependency'lerde erken kapatma i√ßin ikna edici kullanƒ±m senaryolarƒ± varsa, erken kapatmayƒ± se√ßmeli (opt-in) hale getiren yeni bir y√∂ntem eklemeyi d√º≈ü√ºnebilirim.\n \n@@ -144,7 +144,7 @@ Bu davranƒ±≈ü 0.110.0 s√ºr√ºm√ºnde deƒüi≈ütirildi. Ama√ß, handler olmayan (inter\n \n ### Background Tasks ve `yield` ile dependency'ler, Teknik Detaylar { #background-tasks-and-dependencies-with-yield-technical-details }\n \n-FastAPI 0.106.0 √∂ncesinde, `yield` sonrasƒ±nda exception raise etmek m√ºmk√ºn deƒüildi; √ß√ºnk√º `yield` kullanan dependency'lerdeki √ßƒ±kƒ±≈ü kodu response g√∂nderildikten *sonra* √ßalƒ±≈ütƒ±rƒ±lƒ±yordu. Bu nedenle [Exception Handlers](../tutorial/handling-errors.md#install-custom-exception-handlers){.internal-link target=_blank} zaten √ßalƒ±≈ümƒ±≈ü olurdu.\n+FastAPI 0.106.0 √∂ncesinde, `yield` sonrasƒ±nda exception raise et\n\n```\n\n```diff\n@@ -1,483 +1,483 @@\n-# Alternatifler, ƒ∞lham Kaynaklarƒ± ve Kar≈üƒ±la≈ütƒ±rmalar\n+# Alternatifler, ƒ∞lham Kaynaklarƒ± ve Kar≈üƒ±la≈ütƒ±rmalar { #alternatives-inspiration-and-comparisons }\n \n-**FastAPI**'ya neler ilham verdi? Diƒüer alternatiflerle kar≈üƒ±la≈ütƒ±rƒ±ldƒ±ƒüƒ±nda farklarƒ± neler? **FastAPI** diƒüer alternatiflerinden neler √∂ƒürendi?\n+**FastAPI**'a nelerin ilham verdiƒüi, alternatiflerle nasƒ±l kar≈üƒ±la≈ütƒ±rƒ±ldƒ±ƒüƒ± ve onlardan neler √∂ƒürendiƒüi.\n \n-## Giri≈ü\n+## Giri≈ü { #intro }\n \n Ba≈ükalarƒ±nƒ±n daha √∂nceki √ßalƒ±≈ümalarƒ± olmasaydƒ±, **FastAPI** var olmazdƒ±.\n \n-Ge√ßmi≈üte olu≈üturulan pek √ßok ara√ß **FastAPI**'a ilham kaynaƒüƒ± olmu≈ütur.\n+√ñnceden olu≈üturulan bir√ßok ara√ß, ortaya √ßƒ±kƒ±≈üƒ±na ilham verdi.\n \n-Yƒ±llardƒ±r yeni bir framework olu≈üturmaktan ka√ßƒ±nƒ±yordum. Ba≈ülangƒ±√ßta **FastAPI**'ƒ±n √ß√∂zd√ºƒü√º sorunlarƒ± √ß√∂zebilmek i√ßin pek √ßok farklƒ± framework, <abbr title=\"Eklenti: Plug-In\">eklenti</abbr> ve ara√ß kullanmayƒ± denedim.\n+Yƒ±llarca yeni bir framework olu≈üturmaktan ka√ßƒ±ndƒ±m. √ñnce **FastAPI**‚Äôƒ±n bug√ºn kapsadƒ±ƒüƒ± √∂zelliklerin tamamƒ±nƒ±, bir√ßok farklƒ± framework, eklenti ve ara√ßla √ß√∂zmeyi denedim.\n \n-Ancak bir noktada, ge√ßmi≈üteki diƒüer ara√ßlardan en iyi fikirleri alarak b√ºt√ºn bu √ß√∂z√ºmleri kapsayan, ayrƒ±ca b√ºt√ºn bunlarƒ± Python'ƒ±n daha √∂nce mevcut olmayan √∂zelliklerini (Python 3.6+ ile gelen <abbr title=\"Tip belirte√ßleri: Type Hints\">tip belirte√ßleri</abbr>) kullanarak yapan bir ≈üey √ºretmekten ba≈üka se√ßenek kalmamƒ±≈ütƒ±.\n+Ancak bir noktada, ge√ßmi≈üteki ara√ßlardan en iyi fikirleri alƒ±p, m√ºmk√ºn olan en iyi ≈üekilde birle≈ütiren ve daha √∂nce mevcut olmayan dil √∂zelliklerini (Python 3.6+ tip belirte√ßleri) kullanarak t√ºm bu √∂zellikleri saƒülayan bir ≈üey geli≈ütirmekten ba≈üka se√ßenek kalmadƒ±.\n \n-## Daha √ñnce Geli≈ütirilen Ara√ßlar\n+## Daha √ñnce Geli≈ütirilen Ara√ßlar { #previous-tools }\n \n-### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a>\n+### <a href=\"https://www.djangoproject.com/\" class=\"external-link\" target=\"_blank\">Django</a> { #django }\n \n-Django geni≈ü √ßa", "output": "Changes look good. This PR implements: üåê Update translations for tr (outdated and missing)", "source": "pr", "type": "code_review", "pr_number": 287}
{"instruction": "Review the following code changes: üåê Update translations for fr (outdated pages)", "input": "```diff\n@@ -2,23 +2,23 @@\n \n Maintenant que nous avons vu comment utiliser `Path` et `Query`, voyons des usages plus avanc√©s des d√©clarations de param√®tres du corps de la requ√™te.\n \n-## M√©langer les param√®tres `Path`, `Query` et body { #mix-path-query-and-body-parameters }\n+## M√©langer les param√®tres `Path`, `Query` et du corps de la requ√™te { #mix-path-query-and-body-parameters }\n \n-Tout d'abord, sachez que vous pouvez m√©langer librement les d√©clarations des param√®tres `Path`, `Query` et du body, **FastAPI** saura quoi faire.\n+Tout d'abord, sachez que vous pouvez m√©langer librement les d√©clarations des param√®tres `Path`, `Query` et du corps de la requ√™te, **FastAPI** saura quoi faire.\n \n-Et vous pouvez √©galement d√©clarer des param√®tres du body comme √©tant optionnels, en leur assignant une valeur par d√©faut √† `None` :\n+Et vous pouvez √©galement d√©clarer des param√®tres du corps de la requ√™te comme √©tant optionnels, en leur assignant une valeur par d√©faut √† `None` :\n \n {* ../../docs_src/body_multiple_params/tutorial001_an_py310.py hl[18:20] *}\n \n /// note | Remarque\n \n-Notez que, dans ce cas, l'√©l√©ment `item` r√©cup√©r√© depuis le body est optionnel. Comme sa valeur par d√©faut est `None`.\n+Notez que, dans ce cas, l'√©l√©ment `item` r√©cup√©r√© depuis le corps de la requ√™te est optionnel. Comme sa valeur par d√©faut est `None`.\n \n ///\n \n-## Param√®tres multiples du body { #multiple-body-parameters }\n+## Param√®tres multiples du corps de la requ√™te { #multiple-body-parameters }\n \n-Dans l'exemple pr√©c√©dent, les chemins d'acc√®s attendraient un body JSON avec les attributs d'un `Item`, par exemple :\n+Dans l'exemple pr√©c√©dent, les chemins d'acc√®s attendraient un corps de la requ√™te JSON avec les attributs d'un `Item`, par exemple :\n \n \n```", "output": "Changes look good. This PR implements: üåê Update translations for fr (outdated pages)", "source": "pr", "type": "code_review", "pr_number": 286}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor internals, cleanup unneeded Pydantic v1 specific logic", "input": "```diff\n@@ -1,4 +1,3 @@\n-from .shared import PYDANTIC_V2 as PYDANTIC_V2\n from .shared import PYDANTIC_VERSION_MINOR_TUPLE as PYDANTIC_VERSION_MINOR_TUPLE\n from .shared import annotation_is_pydantic_v1 as annotation_is_pydantic_v1\n from .shared import field_annotation_is_scalar as field_annotation_is_scalar\n\n```\n\n```diff\n@@ -28,7 +28,6 @@\n     )  # pyright: ignore[reportAttributeAccessIssue]\n \n PYDANTIC_VERSION_MINOR_TUPLE = tuple(int(x) for x in PYDANTIC_VERSION.split(\".\")[:2])\n-PYDANTIC_V2 = PYDANTIC_VERSION_MINOR_TUPLE[0] == 2\n \n \n sequence_annotation_to_type = {\n\n```\n\n```diff\n@@ -500,14 +500,8 @@ def get_model_name_map(unique_models: TypeModelSet) -> dict[TypeModelOrEnum, str\n \n \n def get_compat_model_name_map(fields: list[ModelField]) -> ModelNameMap:\n-    all_flat_models: TypeModelSet = set()\n-\n-    v2_model_fields = [field for field in fields if isinstance(field, ModelField)]\n-    v2_flat_models = get_flat_models_from_fields(v2_model_fields, known_models=set())\n-    all_flat_models = all_flat_models.union(v2_flat_models)\n-\n-    model_name_map = get_model_name_map(all_flat_models)\n-    return model_name_map\n+    flat_models = get_flat_models_from_fields(fields, known_models=set())\n+    return get_model_name_map(flat_models)\n \n \n def get_flat_models_from_model(\n\n```\n\n```diff\n@@ -59,7 +59,6 @@\n )\n from fastapi.types import DecoratedCallable, IncEx\n from fastapi.utils import (\n-    create_cloned_field,\n     create_model_field,\n     generate_unique_id,\n     get_value_or_default,\n@@ -652,20 +651,8 @@ def __init__(\n                 type_=self.response_model,\n                 mode=\"serialization\",\n             )\n-            # Create a clone of the field, so that a Pydantic submodel is not returned\n-            # as is just because it's an instance of a subclass of a more limited class\n-            # e.g. UserInDB (containing hashed_password) could be a subclass of User\n-            # that doesn't have the hashed_password. But because it's a subclass, it\n-            # would pass the validation and be returned as is.\n-            # By being a new field, no inheritance will be passed as is. A new model\n-            # will always be created.\n-            # TODO: remove when deprecating Pydantic v1\n-            self.secure_cloned_response_field: Optional[ModelField] = (\n-                create_cloned_field(self.response_field)\n-            )\n         else:\n             self.response_field = None  # type: ignore\n-            self.secure_cloned_response_field = None\n         self.dependencies = list(dependencies or [])\n         self.description = description or inspect.cleandoc(self.endpoint.__doc__ or \"\")\n         # if a \"form feed\" character (page break) is found in the description text,\n@@ -720,7 +707,7 @@ def get_route_handler(self) -> Callable[[Request], Coroutine[Any, Any, Response]\n             body_field=self.body_field,\n             status_code=self.status_code,\n             response_class=self.response_class,\n-            response_field=self.secure_cloned_response_field,\n+            response_field=self.response_field,\n             response_model_include=self.response_model_include,\n             response_model_exclude=self.response_model_exclude,\n             response_model_by_alias=self.response_model_by_alias,\n\n```\n\n```diff\n@@ -1,13 +1,11 @@\n import re\n import warnings\n-from collections.abc import MutableMapping\n from typing import (\n     TYPE_CHECKING,\n     Any,\n     Optional,\n     Union,\n )\n-from weakref import WeakKeyDictionary\n \n import fastapi\n from fastapi._compat import (\n@@ -21,7 +19,6 @@\n )\n from fastapi.datastructures import DefaultPlaceholder, DefaultType\n from fastapi.exceptions import FastAPIDeprecationWarning, PydanticV1NotSupportedError\n-from pydantic import BaseModel\n from pydantic.fields import FieldInfo\n from typing_extensions import Literal\n \n@@ -30,11 +27,6 @@\n if TYPE_CHECKING:  # pragma: nocover\n     from .routing import APIRoute\n \n-# Cache for `create_cloned_field`\n-_CLONED_TYPES_CACHE: MutableMapping[type[BaseModel], type[BaseModel]] = (\n-    WeakKeyDictionary()\n-)\n-\n \n def is_body_allowed_for_status_code(status_code: Union[int, str, None]) -> bool:\n     if status_code is None:\n@@ -97,14 +89,6 @@ def create_model_field(\n         ) from None\n \n \n-def create_cloned_field(\n-    field: ModelField,\n-    *,\n-    cloned_types: Optional[MutableMapping[type[BaseModel], type[BaseModel]]] = None,\n-) -> ModelField:\n-    return field\n-\n-\n def generate_operation_id_for_path(\n     *, name: str, path: str, method: str\n ) -> str:  # pragma: nocover\n\n```", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Refactor internals, cleanup unneeded Pydantic v1 specific logic", "source": "pr", "type": "code_review", "pr_number": 285}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è  Upgrade Starlette supported version range to >=0.40.0, <0.52.0", "input": "```diff\n@@ -43,7 +43,7 @@ classifiers = [\n     \"Topic :: Internet :: WWW/HTTP\",\n ]\n dependencies = [\n-    \"starlette>=0.40.0,<0.51.0\",\n+    \"starlette>=0.40.0,<0.52.0\",\n     \"pydantic>=2.7.0\",\n     \"typing-extensions>=4.8.0\",\n     \"typing-inspection>=0.4.2\",\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è  Upgrade Starlette supported version range to >=0.40.0, <0.52.0", "source": "pr", "type": "code_review", "pr_number": 284}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è Bump Starlette to <`0.53.0`", "input": "```diff\n@@ -43,7 +43,7 @@ classifiers = [\n     \"Topic :: Internet :: WWW/HTTP\",\n ]\n dependencies = [\n-    \"starlette>=0.40.0,<0.51.0\",\n+    \"starlette>=0.40.0,<0.53.0\",\n     \"pydantic>=2.7.0\",\n     \"typing-extensions>=4.8.0\",\n     \"typing-inspection>=0.4.2\",\n\n```\n\n```diff\n@@ -1019,7 +1019,7 @@ dependencies = [\n     { name = \"annotated-doc\" },\n     { name = \"pydantic\" },\n     { name = \"starlette\", version = \"0.49.3\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version < '3.10'\" },\n-    { name = \"starlette\", version = \"0.50.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n+    { name = \"starlette\", version = \"0.52.1\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n     { name = \"typing-extensions\" },\n     { name = \"typing-inspection\" },\n ]\n@@ -1201,7 +1201,7 @@ requires-dist = [\n     { name = \"python-multipart\", marker = \"extra == 'standard'\", specifier = \">=0.0.18\" },\n     { name = \"python-multipart\", marker = \"extra == 'standard-no-fastapi-cloud-cli'\", specifier = \">=0.0.18\" },\n     { name = \"pyyaml\", marker = \"extra == 'all'\", specifier = \">=5.3.1\" },\n-    { name = \"starlette\", specifier = \">=0.40.0,<0.51.0\" },\n+    { name = \"starlette\", specifier = \">=0.40.0,<0.53.0\" },\n     { name = \"typing-extensions\", specifier = \">=4.8.0\" },\n     { name = \"typing-inspection\", specifier = \">=0.4.2\" },\n     { name = \"ujson\", marker = \"extra == 'all'\", specifier = \">=4.0.1,!=4.0.2,!=4.1.0,!=4.2.0,!=4.3.0,!=5.0.0,!=5.1.0\" },\n@@ -2551,7 +2551,7 @@ dependencies = [\n     { name = \"python-multipart\", version = \"0.0.21\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n     { name = \"pywin32\", marker = \"python_full_version >= '3.10' and sys_platform == 'win32'\" },\n     { name = \"sse-starlette\", marker = \"python_full_version >= '3.10'\" },\n-    { name = \"starlette\", version = \"0.50.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n+    { name = \"starlette\", version = \"0.52.1\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n     { name = \"uvicorn\", version = \"0.40.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10' and sys_platform != 'emscripten'\" },\n ]\n sdist = { url = \"https://files.pythonhosted.org/packages/69/2b/916852a5668f45d8787378461eaa1244876d77575ffef024483c94c0649c/mcp-1.19.0.tar.gz\", hash = \"sha256:213de0d3cd63f71bc08ffe9cc8d4409cc87acffd383f6195d2ce0457c021b5c1\", size = 444163, upload-time = \"2025-10-24T01:11:15.839Z\" }\n@@ -3340,7 +3340,7 @@ wheels = [\n ag-ui = [\n     { name = \"ag-ui-protocol\" },\n     { name = \"starlette\", version = \"0.49.3\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version < '3.10'\" },\n-    { name = \"starlette\", version = \"0.50.0\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n+    { name = \"starlette\", version = \"0.52.1\", source = { registry = \"https://pypi.org/simple\" }, marker = \"python_full_version >= '3.10'\" },\n ]\n anthropic = [\n     { name = \"anthropic\" },\n@@ -4450,7 +4450,7 @@ version = \"3.1.2\"\n source = { regis\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è Bump Starlette to <`0.53.0`", "source": "pr", "type": "code_review", "pr_number": 283}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Simplify internals, remove Pydantic v1 only logic, no longer needed", "input": "```diff\n@@ -25,7 +25,6 @@\n from .v2 import create_body_model as create_body_model\n from .v2 import evaluate_forwardref as evaluate_forwardref\n from .v2 import get_cached_model_fields as get_cached_model_fields\n-from .v2 import get_compat_model_name_map as get_compat_model_name_map\n from .v2 import get_definitions as get_definitions\n from .v2 import get_missing_field_error as get_missing_field_error\n from .v2 import get_schema_from_model_field as get_schema_from_model_field\n\n```\n\n```diff\n@@ -1,7 +1,7 @@\n import re\n import warnings\n from collections.abc import Sequence\n-from copy import copy, deepcopy\n+from copy import copy\n from dataclasses import dataclass, is_dataclass\n from enum import Enum\n from functools import lru_cache\n@@ -169,11 +169,11 @@ def validate(\n         values: dict[str, Any] = {},  # noqa: B006\n         *,\n         loc: tuple[Union[int, str], ...] = (),\n-    ) -> tuple[Any, Union[list[dict[str, Any]], None]]:\n+    ) -> tuple[Any, list[dict[str, Any]]]:\n         try:\n             return (\n                 self._type_adapter.validate_python(value, from_attributes=True),\n-                None,\n+                [],\n             )\n         except ValidationError as exc:\n             return None, _regenerate_error_with_loc(\n@@ -305,94 +305,12 @@ def get_definitions(\n         if \"description\" in item_def:\n             item_description = cast(str, item_def[\"description\"]).split(\"\\f\")[0]\n             item_def[\"description\"] = item_description\n-    new_mapping, new_definitions = _remap_definitions_and_field_mappings(\n-        model_name_map=model_name_map,\n-        definitions=definitions,  # type: ignore[arg-type]\n-        field_mapping=field_mapping,\n-    )\n-    return new_mapping, new_definitions\n-\n-\n-def _replace_refs(\n-    *,\n-    schema: dict[str, Any],\n-    old_name_to_new_name_map: dict[str, str],\n-) -> dict[str, Any]:\n-    new_schema = deepcopy(schema)\n-    for key, value in new_schema.items():\n-        if key == \"$ref\":\n-            value = schema[\"$ref\"]\n-            if isinstance(value, str):\n-                ref_name = schema[\"$ref\"].split(\"/\")[-1]\n-                if ref_name in old_name_to_new_name_map:\n-                    new_name = old_name_to_new_name_map[ref_name]\n-                    new_schema[\"$ref\"] = REF_TEMPLATE.format(model=new_name)\n-            continue\n-        if isinstance(value, dict):\n-            new_schema[key] = _replace_refs(\n-                schema=value,\n-                old_name_to_new_name_map=old_name_to_new_name_map,\n-            )\n-        elif isinstance(value, list):\n-            new_value = []\n-            for item in value:\n-                if isinstance(item, dict):\n-                    new_item = _replace_refs(\n-                        schema=item,\n-                        old_name_to_new_name_map=old_name_to_new_name_map,\n-                    )\n-                    new_value.append(new_item)\n-\n-                else:\n-                    new_value.append(item)\n-            new_schema[key] = new_value\n-    return new_schema\n-\n-\n-def _remap_definitions_and_field_mappings(\n-    *,\n-    model_name_map: ModelNameMap,\n-    definitions: dict[str, Any],\n-    field_mapping: dict[\n-        tuple[ModelField, Literal[\"validation\", \"serialization\"]], JsonSchemaValue\n-    ],\n-) -> tuple[\n-    dict[tuple[ModelField, Literal[\"validation\", \"serialization\"]], JsonSchemaValue],\n-    dict[str, Any],\n-]:\n-    old_name_to_new_name_map = {}\n-    for field_key, schema in field_mapping.items():\n-\n\n```\n\n```diff\n@@ -21,7 +21,6 @@\n     ModelField,\n     RequiredParam,\n     Undefined,\n-    _regenerate_error_with_loc,\n     copy_field_info,\n     create_body_model,\n     evaluate_forwardref,\n@@ -718,12 +717,7 @@ def _validate_value_with_model_field(\n             return None, [get_missing_field_error(loc=loc)]\n         else:\n             return deepcopy(field.default), []\n-    v_, errors_ = field.validate(value, values, loc=loc)\n-    if isinstance(errors_, list):\n-        new_errors = _regenerate_error_with_loc(errors=errors_, loc_prefix=())\n-        return None, new_errors\n-    else:\n-        return v_, []\n+    return field.validate(value, values, loc=loc)\n \n \n def _is_json_field(field: ModelField) -> bool:\n\n```\n\n```diff\n@@ -9,11 +9,14 @@\n from fastapi._compat import (\n     ModelField,\n     Undefined,\n-    get_compat_model_name_map,\n     get_definitions,\n     get_schema_from_model_field,\n     lenient_issubclass,\n )\n+from fastapi._compat.v2 import (\n+    get_flat_models_from_fields,\n+    get_model_name_map,\n+)\n from fastapi.datastructures import DefaultPlaceholder\n from fastapi.dependencies.models import Dependant\n from fastapi.dependencies.utils import (\n@@ -512,7 +515,8 @@ def get_openapi(\n     webhook_paths: dict[str, dict[str, Any]] = {}\n     operation_ids: set[str] = set()\n     all_fields = get_fields_from_routes(list(routes or []) + list(webhooks or []))\n-    model_name_map = get_compat_model_name_map(all_fields)\n+    flat_models = get_flat_models_from_fields(all_fields, known_m", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Simplify internals, remove Pydantic v1 only logic, no longer needed", "source": "pr", "type": "code_review", "pr_number": 282}
{"instruction": "Fix the following bug: üêõ Fix deadlock that can occur when closing dependencies during response model validation", "input": "Related to #5122\r\n\r\nIn my project, I had noticed I was getting a sqlalchemy `QueuePool` limit error like others had noted in https://github.com/fastapi/fastapi/discussions/6628. This was marked as probably fixed by https://github.com/fastapi/fastapi/pull/5122.\r\n\r\nEven on fastapi commit `e4727ed2` (> v0.112.2), you can still run into this issue when running the tests created by the author of #5122 - https://github.com/harsh8398/fastapi-dependency-issue. I also notice others running into similar deadlocks after picking up the `0.82.0` patch: https://github.com/vipyrsec/dragonfly-mainframe/issues/235.\r\n\r\nThe author of the issue/discussion #6628 noted that when adding a `response_model` to the endpoint function, they noticed that the suggested quick fixes (i.e. using a contextmanager, async session manager, etc.) didn't seem to work either. It seems like the response model validation runs into the same issue that when using `Depends`, a deadlock can occur when closing sessions.\r\n\r\nI believe this pr fixes this `Depends` issue all the way.\r\n\r\nI tested this pr against https://github.com/harsh8398/fastapi-dependency-issue and notice that all test cases pass equally as fast! This patch also fixes the deadlocks/timeouts I was seeing in my own codebase.\r\n\r\n**UPD YuriiMotov:** related discussion on SQLModel repo (https://github.com/fastapi/sqlmodel/discussions/1417)", "output": "```diff\n@@ -20,7 +20,9 @@\n     Union,\n )\n \n+import anyio\n from annotated_doc import Doc\n+from anyio import CapacityLimiter\n from fastapi import params\n from fastapi._compat import (\n     ModelField,\n@@ -205,8 +207,11 @@ async def serialize_response(\n         if is_coroutine:\n             value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n         else:\n-            value, errors_ = await run_in_threadpool(\n-                field.validate, response_content, {}, loc=(\"response\",)\n+            # Run without a capacity limit for similar reasons as marked in fastapi/concurrency.py\n+            exit_limiter = CapacityLimiter(1)\n+            validate_func = functools.partial(field.validate, loc=(\"response\",))\n+            value, errors_ = await anyio.to_thread.run_sync(\n+                validate_func, response_content, {}, limiter=exit_limiter\n             )\n         if isinstance(errors_, list):\n             errors.extend(errors_)\n\n```\n\n```diff\n@@ -0,0 +1,79 @@\n+import asyncio\n+import threading\n+import time\n+from collections.abc import Generator\n+\n+from fastapi import Depends, FastAPI\n+from httpx import ASGITransport, AsyncClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+# Dummy pydantic model\n+class Item(BaseModel):\n+    name: str\n+    id: int\n+\n+\n+# Mutex, acting as our \"connection pool\" for a database for example\n+mutex_db_connection_pool = threading.Lock()\n+\n+\n+# Simulate a database class that uses a connection pool to manage\n+# active clients for a db. The client needs to perform blocking\n+# calls to connect and disconnect from the db\n+class MyDB:\n+    def __init__(self):\n+        self.lock_acquired = False\n+\n+    def connect(self):\n+        mutex_db_connection_pool.acquire()\n+        self.lock_acquired = True\n+        # Sleep to simulate some blocking IO like connecting to a db\n+        time.sleep(0.001)\n+\n+    def disconnect(self):\n+        if self.lock_acquired:\n+            # Use a sleep to simulate some blocking IO such as a db disconnect\n+            time.sleep(0.001)\n+            mutex_db_connection_pool.release()\n+            self.lock_acquired = False\n+\n+\n+# Simulate getting a connection to a database from a connection pool\n+# using the mutex to act as this limited resource\n+def get_db() -> Generator[MyDB, None, None]:\n+    my_db = MyDB()\n+    try:\n+        yield my_db\n+    finally:\n+        my_db.disconnect()\n+\n+\n+# An endpoint that uses Depends for resource management and also includes\n+# a response_model definition would previously deadlock in the validation\n+# of the model and the cleanup of the Depends\n+@app.get(\"/deadlock\", response_model=Item)\n+def get_deadlock(db: MyDB = Depends(get_db)):\n+    db.connect()\n+    return Item(name=\"foo\", id=1)\n+\n+\n+# Fire off 100 requests in parallel(ish) in order to create contention\n+# over the shared resource (simulating a fastapi server that interacts with\n+# a database connection pool). After the patch, each thread on the server is\n+# able to free the resource without deadlocking, allowing each request to\n+# be handled timely\n+def test_depends_deadlock_patch():\n+    async def make_request(client: AsyncClient):\n+        await client.get(\"/deadlock\")\n+\n+    async def run_requests():\n+        async with AsyncClient(\n+            transport=ASGITransport(app=app), base_url=\"http://testserver\"\n+        ) as aclient:\n+            tasks = [make_request(aclient) for _ in range(100)]\n+            await asyncio.gather(*tasks)\n+\n+    asyncio.run(run_requests())\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 281}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -20,7 +20,9 @@\n     Union,\n )\n \n+import anyio\n from annotated_doc import Doc\n+from anyio import CapacityLimiter\n from fastapi import params\n from fastapi._compat import (\n     ModelField,\n@@ -205,8 +207,11 @@ async def serialize_response(\n         if is_coroutine:\n             value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n         else:\n-            value, errors_ = await run_in_threadpool(\n-                field.validate, response_content, {}, loc=(\"response\",)\n+            # Run without a capacity limit for similar reasons as marked in fastapi/concurrency.py\n+            exit_limiter = CapacityLimiter(1)\n+            validate_func = functools.partial(field.validate, loc=(\"response\",))\n+            value, errors_ = await anyio.to_thread.run_sync(\n+                validate_func, response_content, {}, limiter=exit_limiter\n             )\n         if isinstance(errors_, list):\n             errors.extend(errors_)\n\n```\n\n```diff\n@@ -0,0 +1,79 @@\n+import asyncio\n+import threading\n+import time\n+from collections.abc import Generator\n+\n+from fastapi import Depends, FastAPI\n+from httpx import ASGITransport, AsyncClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+# Dummy pydantic model\n+class Item(BaseModel):\n+    name: str\n+    id: int\n+\n+\n+# Mutex, acting as our \"connection pool\" for a database for example\n+mutex_db_connection_pool = threading.Lock()\n+\n+\n+# Simulate a database class that uses a connection pool to manage\n+# active clients for a db. The client needs to perform blocking\n+# calls to connect and disconnect from the db\n+class MyDB:\n+    def __init__(self):\n+        self.lock_acquired = False\n+\n+    def connect(self):\n+        mutex_db_connection_pool.acquire()\n+        self.lock_acquired = True\n+        # Sleep to simulate some blocking IO like connecting to a db\n+        time.sleep(0.001)\n+\n+    def disconnect(self):\n+        if self.lock_acquired:\n+            # Use a sleep to simulate some blocking IO such as a db disconnect\n+            time.sleep(0.001)\n+            mutex_db_connection_pool.release()\n+            self.lock_acquired = False\n+\n+\n+# Simulate getting a connection to a database from a connection pool\n+# using the mutex to act as this limited resource\n+def get_db() -> Generator[MyDB, None, None]:\n+    my_db = MyDB()\n+    try:\n+        yield my_db\n+    finally:\n+        my_db.disconnect()\n+\n+\n+# An endpoint that uses Depends for resource management and also includes\n+# a response_model definition would previously deadlock in the validation\n+# of the model and the cleanup of the Depends\n+@app.get(\"/deadlock\", response_model=Item)\n+def get_deadlock(db: MyDB = Depends(get_db)):\n+    db.connect()\n+    return Item(name=\"foo\", id=1)\n+\n+\n+# Fire off 100 requests in parallel(ish) in order to create contention\n+# over the shared resource (simulating a fastapi server that interacts with\n+# a database connection pool). After the patch, each thread on the server is\n+# able to free the resource without deadlocking, allowing each request to\n+# be handled timely\n+def test_depends_deadlock_patch():\n+    async def make_request(client: AsyncClient):\n+        await client.get(\"/deadlock\")\n+\n+    async def run_requests():\n+        async with AsyncClient(\n+            transport=ASGITransport(app=app), base_url=\"http://testserver\"\n+        ) as aclient:\n+            tasks = [make_request(aclient) for _ in range(100)]\n+            await asyncio.gather(*tasks)\n+\n+    asyncio.run(run_requests())\n\n```", "output": "Bug: üêõ Fix deadlock that can occur when closing dependencies during response model validation\n\nRelated to #5122\r\n\r\nIn my project, I had noticed I was getting a sqlalchemy `QueuePool` limit error like others had noted in https://github.com/fastapi/fastapi/discussions/6628. This was marked as probably fixed by https://github.com/fastapi/fastapi/pull/5122.\r\n\r\nEven on fastapi commit `e4727ed2` (> v0.112.2), you can still run into this issue when running the tests created by the author of #5122 - https://github.com/harsh8398/fastapi-dependency-issue. I also notice others running into similar deadlocks after picking up the `0.82.0` patch: https://github.com/vipyrsec/dragonfly-mainframe/issues/235.\r\n\r\nThe author of the issue/discussion #6628 noted that when adding a `response_model` to the endpoint function, they noticed that the suggested quick fixes (i.e. using a contextmanager, async session manager, etc.) didn't seem to work either. It seems like the response model validation runs into the same issue that when using `Depends`, a deadlock can occur when closing sessions.\r\n\r\nI believe this pr fixes this `Depends` issue all the way.\r\n\r\nI tested this pr against https://github.com/harsh8398/fastapi-dependency-issue and notice that all test cases pass equally as fast! This patch also fixes the deadlocks/timeouts I was seeing in my own codebase.\r\n\r\n**UPD YuriiMotov:** related discussion on SQLModel repo (https://github.com/fastapi/sqlmodel/discussions/1417)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 281}
{"instruction": "Review the following code changes: üêõ Fix deadlock that can occur when closing dependencies during response model validation", "input": "```diff\n@@ -20,7 +20,9 @@\n     Union,\n )\n \n+import anyio\n from annotated_doc import Doc\n+from anyio import CapacityLimiter\n from fastapi import params\n from fastapi._compat import (\n     ModelField,\n@@ -205,8 +207,11 @@ async def serialize_response(\n         if is_coroutine:\n             value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n         else:\n-            value, errors_ = await run_in_threadpool(\n-                field.validate, response_content, {}, loc=(\"response\",)\n+            # Run without a capacity limit for similar reasons as marked in fastapi/concurrency.py\n+            exit_limiter = CapacityLimiter(1)\n+            validate_func = functools.partial(field.validate, loc=(\"response\",))\n+            value, errors_ = await anyio.to_thread.run_sync(\n+                validate_func, response_content, {}, limiter=exit_limiter\n             )\n         if isinstance(errors_, list):\n             errors.extend(errors_)\n\n```\n\n```diff\n@@ -0,0 +1,79 @@\n+import asyncio\n+import threading\n+import time\n+from collections.abc import Generator\n+\n+from fastapi import Depends, FastAPI\n+from httpx import ASGITransport, AsyncClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+# Dummy pydantic model\n+class Item(BaseModel):\n+    name: str\n+    id: int\n+\n+\n+# Mutex, acting as our \"connection pool\" for a database for example\n+mutex_db_connection_pool = threading.Lock()\n+\n+\n+# Simulate a database class that uses a connection pool to manage\n+# active clients for a db. The client needs to perform blocking\n+# calls to connect and disconnect from the db\n+class MyDB:\n+    def __init__(self):\n+        self.lock_acquired = False\n+\n+    def connect(self):\n+        mutex_db_connection_pool.acquire()\n+        self.lock_acquired = True\n+        # Sleep to simulate some blocking IO like connecting to a db\n+        time.sleep(0.001)\n+\n+    def disconnect(self):\n+        if self.lock_acquired:\n+            # Use a sleep to simulate some blocking IO such as a db disconnect\n+            time.sleep(0.001)\n+            mutex_db_connection_pool.release()\n+            self.lock_acquired = False\n+\n+\n+# Simulate getting a connection to a database from a connection pool\n+# using the mutex to act as this limited resource\n+def get_db() -> Generator[MyDB, None, None]:\n+    my_db = MyDB()\n+    try:\n+        yield my_db\n+    finally:\n+        my_db.disconnect()\n+\n+\n+# An endpoint that uses Depends for resource management and also includes\n+# a response_model definition would previously deadlock in the validation\n+# of the model and the cleanup of the Depends\n+@app.get(\"/deadlock\", response_model=Item)\n+def get_deadlock(db: MyDB = Depends(get_db)):\n+    db.connect()\n+    return Item(name=\"foo\", id=1)\n+\n+\n+# Fire off 100 requests in parallel(ish) in order to create contention\n+# over the shared resource (simulating a fastapi server that interacts with\n+# a database connection pool). After the patch, each thread on the server is\n+# able to free the resource without deadlocking, allowing each request to\n+# be handled timely\n+def test_depends_deadlock_patch():\n+    async def make_request(client: AsyncClient):\n+        await client.get(\"/deadlock\")\n+\n+    async def run_requests():\n+        async with AsyncClient(\n+            transport=ASGITransport(app=app), base_url=\"http://testserver\"\n+        ) as aclient:\n+            tasks = [make_request(aclient) for _ in range(100)]\n+            await asyncio.gather(*tasks)\n+\n+    asyncio.run(run_requests())\n\n```", "output": "Changes look good. This PR implements: üêõ Fix deadlock that can occur when closing dependencies during response model validation", "source": "pr", "type": "code_review", "pr_number": 281}
{"instruction": "Fix the following bug: üêõ Fix non-deterministic openapi schema in case of schema name duplication", "input": "See https://github.com/fastapi/fastapi/discussions/14376\r\n\r\nDuring field remapping stage of openapi schema generation the order of iteration is not consistent across runs. This leads to non-deterministic schema generation\r\n\r\nPreserve the order of this iteration across runs by sorting by the \"new_name\", i.e. the value inserted in this mapping", "output": "```diff\n@@ -302,7 +302,10 @@ def _remap_definitions_and_field_mappings(\n     Dict[str, Any],\n ]:\n     old_name_to_new_name_map = {}\n-    for field_key, schema in field_mapping.items():\n+    for field_key, schema in sorted(\n+        field_mapping.items(),\n+        key=lambda x: model_name_map.get(x[0][0].type_, \"\"),\n+    ):\n         model = field_key[0].type_\n         if model not in model_name_map:\n             continue\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 280}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -302,7 +302,10 @@ def _remap_definitions_and_field_mappings(\n     Dict[str, Any],\n ]:\n     old_name_to_new_name_map = {}\n-    for field_key, schema in field_mapping.items():\n+    for field_key, schema in sorted(\n+        field_mapping.items(),\n+        key=lambda x: model_name_map.get(x[0][0].type_, \"\"),\n+    ):\n         model = field_key[0].type_\n         if model not in model_name_map:\n             continue\n\n```", "output": "Bug: üêõ Fix non-deterministic openapi schema in case of schema name duplication\n\nSee https://github.com/fastapi/fastapi/discussions/14376\r\n\r\nDuring field remapping stage of openapi schema generation the order of iteration is not consistent across runs. This leads to non-deterministic schema generation\r\n\r\nPreserve the order of this iteration across runs by sorting by the \"new_name\", i.e. the value inserted in this mapping", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 280}
{"instruction": "Review the following code changes: üêõ Fix non-deterministic openapi schema in case of schema name duplication", "input": "```diff\n@@ -302,7 +302,10 @@ def _remap_definitions_and_field_mappings(\n     Dict[str, Any],\n ]:\n     old_name_to_new_name_map = {}\n-    for field_key, schema in field_mapping.items():\n+    for field_key, schema in sorted(\n+        field_mapping.items(),\n+        key=lambda x: model_name_map.get(x[0][0].type_, \"\"),\n+    ):\n         model = field_key[0].type_\n         if model not in model_name_map:\n             continue\n\n```", "output": "Changes look good. This PR implements: üêõ Fix non-deterministic openapi schema in case of schema name duplication", "source": "pr", "type": "code_review", "pr_number": 280}
{"instruction": "Fix the following bug: Fix: StreamingResponse doc example needs correction", "input": "Autonomous fix for: Title: StreamingResponse doc example needs correction\n\nBody:\n[`StreamingResponse` docs](https://fastapi.tiangolo.com/advanced/custom-response/?h=responses#streamingresponse) state:\n\n> Takes an async generator or a normal generator/iterator\n\nHowever based on https://github.com/Kludex/starlette/discussions/1776#discussioncomment-3207518 `async` generetors need something `await`ed to work:\n\n```py\nimport asyncio\nfrom time import sleep\nfrom fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\n\napp = FastAPI()\n\nasync def fake_video_streamer():\n    for i in range(10):\n        sleep(0.1)\n        yield b\"some fake video bytes\"\n        # await asyncio.sleep(0)  # <-- uncomment to fix example\n\n@app.get(\"/\")\nasync def main():\n    \"\"\"\n    this is as per\n    https://fastapi.tiangolo.com/advanced/custom-response/?h=responses#streamingresponse\n    but does not to work (blocks for 1 sec, then returns all chunks at once):\n      curl -sNo- localhost:8000\n      wget -qO- localhost:8000\n ...\n\nAnalysis:\nYes, this file contains the code related to the issue. The problem is with the documentation of the `StreamingResponse` in the FastAPI documentation. The documentation states that `StreamingResponse` can take an async generator or a normal generator/iterator. However, it does not mention that when using an async generator, it must include an `await` statement to function properly.\n\nThe specific line in the documentation that needs correction is:\n\n```markdown\nTakes an async generator or a normal generator/iterator\n```\n\nThis should be updated to:\n\n```markdown\nTakes an async generator or a normal generator/iterator. When using an async generator, ensure that it includes an `await` statement to function properly.\n```\n\nThis change is necessary to prevent the blocking behavior observed when using an async generator without an `await` statement, as described in the issue.", "output": "```diff\n@@ -1,3 +1,4 @@\n+markdown\n # Custom Response - HTML, Stream, File, others { #custom-response-html-stream-file-others }\n \n By default, **FastAPI** will return the responses using `JSONResponse`.\n@@ -215,7 +216,7 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n ### `StreamingResponse` { #streamingresponse }\n \n-Takes an async generator or a normal generator/iterator and streams the response body.\n+Takes an async generator or a normal generator/iterator and streams the response body. When using an async generator, ensure that it includes an `await` statement to function properly.\n \n {* ../../docs_src/custom_response/tutorial007_py39.py hl[2,14] *}\n \n@@ -277,37 +278,3 @@ You could create a `CustomORJSONResponse`. The main thing you have to do is crea\n {* ../../docs_src/custom_response/tutorial009c_py39.py hl[9:14,17] *}\n \n Now instead of returning:\n-\n-\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 279}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,3 +1,4 @@\n+markdown\n # Custom Response - HTML, Stream, File, others { #custom-response-html-stream-file-others }\n \n By default, **FastAPI** will return the responses using `JSONResponse`.\n@@ -215,7 +216,7 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n ### `StreamingResponse` { #streamingresponse }\n \n-Takes an async generator or a normal generator/iterator and streams the response body.\n+Takes an async generator or a normal generator/iterator and streams the response body. When using an async generator, ensure that it includes an `await` statement to function properly.\n \n {* ../../docs_src/custom_response/tutorial007_py39.py hl[2,14] *}\n \n@@ -277,37 +278,3 @@ You could create a `CustomORJSONResponse`. The main thing you have to do is crea\n {* ../../docs_src/custom_response/tutorial009c_py39.py hl[9:14,17] *}\n \n Now instead of returning:\n-\n-\n```", "output": "Bug: Fix: StreamingResponse doc example needs correction\n\nAutonomous fix for: Title: StreamingResponse doc example needs correction\n\nBody:\n[`StreamingResponse` docs](https://fastapi.tiangolo.com/advanced/custom-response/?h=responses#streamingresponse) state:\n\n> Takes an async generator or a normal generator/iterator\n\nHowever based on https://github.com/Kludex/starlette/discussions/1776#discussioncomment-3207518 `async` generetors need something `await`ed to work:\n\n```py\nimport asyncio\nfrom time import sleep\nfrom fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\n\napp = FastAPI()\n\nasync def fake_video_streamer():\n    for i in range(10):\n        sleep(0.1)\n        yield b\"some fake video bytes\"\n        # await asyncio.sleep(0)  # <-- uncomment to fix example\n\n@app.get(\"/\")\nasync def main():\n    \"\"\"\n    this is as per\n    https://fastapi.tiangolo.com/advanced/custom-response/?h=responses#streamingresponse\n    but does not to work (blocks for 1 sec, then returns all chunks at once):\n      curl -sNo- localhost:8000\n      wget -qO- localhost:8000\n ...\n\nAnalysis:\nYes, this file contains the code related to the issue. The problem is with the documentation of the `StreamingResponse` in the FastAPI documentation. The documentation states that `StreamingResponse` can take an async generator or a normal generator/iterator. However, it does not mention that when using an async generator, it must include an `await` statement to function properly.\n\nThe specific line in the documentation that needs correction is:\n\n```markdown\nTakes an async generator or a normal generator/iterator\n```\n\nThis should be updated to:\n\n```markdown\nTakes an async generator or a normal generator/iterator. When using an async generator, ensure that it includes an `await` statement to function properly.\n```\n\nThis change is necessary to prevent the blocking behavior observed when using an async generator without an `await` statement, as described in the issue.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 279}
{"instruction": "Review the following code changes: Fix: StreamingResponse doc example needs correction", "input": "```diff\n@@ -1,3 +1,4 @@\n+markdown\n # Custom Response - HTML, Stream, File, others { #custom-response-html-stream-file-others }\n \n By default, **FastAPI** will return the responses using `JSONResponse`.\n@@ -215,7 +216,7 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n ### `StreamingResponse` { #streamingresponse }\n \n-Takes an async generator or a normal generator/iterator and streams the response body.\n+Takes an async generator or a normal generator/iterator and streams the response body. When using an async generator, ensure that it includes an `await` statement to function properly.\n \n {* ../../docs_src/custom_response/tutorial007_py39.py hl[2,14] *}\n \n@@ -277,37 +278,3 @@ You could create a `CustomORJSONResponse`. The main thing you have to do is crea\n {* ../../docs_src/custom_response/tutorial009c_py39.py hl[9:14,17] *}\n \n Now instead of returning:\n-\n-\n```", "output": "Changes look good. This PR implements: Fix: StreamingResponse doc example needs correction", "source": "pr", "type": "code_review", "pr_number": 279}
{"instruction": "Fix the following bug: Fix: Preserve model_fields_set for Form models (issue #13399)", "input": "When using Form() with Pydantic models, FastAPI was preloading default values and passing them to Pydantic, causing all fields to appear in model_fields_set even when not provided. This also caused validation to be enforced on unprovided defaults.\r\n\r\nChanges:\r\n- Modified _get_multidict_value() to check if values is FormData\r\n- For FormData, return None for unprovided fields instead of defaults\r\n- This lets Pydantic handle defaults properly and preserve fields_set\r\n- Updated test expectation in test_forms_single_model.py\r\n- Added comprehensive test suite in test_forms_fields_set.py\r\n\r\nThe fix ensures Form models behave consistently with JSON body models regarding field tracking and validation.\r\n\r\nCloses #13399", "output": "```diff\n@@ -748,6 +748,11 @@ def _get_multidict_value(\n         if field.required:\n             return\n         else:\n+            # For FormData, return None to let Pydantic handle defaults\n+            # This preserves model_fields_set metadata correctly\n+            if isinstance(values, FormData):\n+                return\n+            # For non-FormData (Query, Header, Cookie), keep existing behavior\n             return deepcopy(field.default)\n     return value\n \n\n```\n\n```diff\n@@ -0,0 +1,187 @@\n+\"\"\"\n+Tests for Form fields preserving model_fields_set metadata.\n+Related to issue #13399: https://github.com/fastapi/fastapi/issues/13399\n+\n+This test validates that Form models correctly track which fields were\n+explicitly provided vs. which fields use defaults.\n+\"\"\"\n+\n+import pydantic\n+from fastapi import FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated  # noqa: UP035\n+\n+PYDANTIC_V2 = int(pydantic.VERSION.split(\".\")[0]) >= 2\n+\n+\n+class FormModelFieldsSet(BaseModel):\n+    \"\"\"Model for testing fields_set metadata preservation.\"\"\"\n+\n+    field_1: bool = True\n+    field_2: str = \"default\"\n+    field_3: int = 42\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-fields-set\")\n+async def form_fields_set_endpoint(\n+    model: Annotated[FormModelFieldsSet, Form()],\n+) -> None:\n+    # Works for both Pydantic v1 (__fields_set__) and v2 (model_fields_set)\n+    fields_set = list(\n+        model.model_fields_set\n+        if hasattr(model, \"model_fields_set\")\n+        else model.__fields_set__  # type: ignore[attr-defined]\n+    )\n+    return {\n+        \"fields_set\": fields_set,\n+        \"data\": model.model_dump() if PYDANTIC_V2 else model.dict(),\n+    }\n+\n+\n+@app.post(\"/body-fields-set\")\n+async def body_fields_set_endpoint(model: FormModelFieldsSet) -> None:\n+    # Works for both Pydantic v1 (__fields_set__) and v2 (model_fields_set)\n+    fields_set = list(\n+        model.model_fields_set\n+        if hasattr(model, \"model_fields_set\")\n+        else model.__fields_set__  # type: ignore[attr-defined]\n+    )\n+    return {\"fields_set\": fields_set}\n+\n+\n+@app.get(\"/query/default\")\n+def query_model(\n+    name: Annotated[str, Query()] = \"query_default\",\n+    age: Annotated[int, Query()] = 10,\n+) -> None:\n+    return {\"name\": name, \"age\": age}\n+\n+\n+@app.get(\"/header/default\")\n+def header_model(\n+    x_token: Annotated[str, Header()] = \"header_default\",\n+) -> None:\n+    return {\"x_token\": x_token}\n+\n+\n+client = TestClient(app)\n+\n+\n+class TestFormFieldsSetMetadata:\n+    \"\"\"Test that Form models correctly preserve fields_set metadata.\"\"\"\n+\n+    def test_form_empty_data_has_empty_fields_set(self) -> None:\n+        \"\"\"Form with no data should have empty fields_set (matching JSON behavior).\"\"\"\n+        resp = client.post(\"/form-fields-set\", data={})\n+        assert resp.status_code == 200, resp.text\n+        fields_set = resp.json()[\"fields_set\"]\n+        assert fields_set == []\n+\n+    def test_body_empty_data_has_empty_fields_set(self) -> None:\n+        \"\"\"JSON body with no data should have empty fields_set.\"\"\"\n+        resp = client.post(\"/body-fields-set\", json={})\n+        assert resp.status_code == 200, resp.text\n+        fields_set = resp.json()[\"fields_set\"]\n+        assert fields_set == []\n+\n+    def test_form_partial_data_tracks_provided_fields(self) -> None:\n+        \"\"\"Form with partial data should only show provided fields in fields_set.\"\"\"\n+        resp =\n\n```\n\n```diff\n@@ -99,13 +99,13 @@ def test_no_data():\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"username\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n             {\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"lastname\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n         ]\n     }\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 278}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -748,6 +748,11 @@ def _get_multidict_value(\n         if field.required:\n             return\n         else:\n+            # For FormData, return None to let Pydantic handle defaults\n+            # This preserves model_fields_set metadata correctly\n+            if isinstance(values, FormData):\n+                return\n+            # For non-FormData (Query, Header, Cookie), keep existing behavior\n             return deepcopy(field.default)\n     return value\n \n\n```\n\n```diff\n@@ -0,0 +1,187 @@\n+\"\"\"\n+Tests for Form fields preserving model_fields_set metadata.\n+Related to issue #13399: https://github.com/fastapi/fastapi/issues/13399\n+\n+This test validates that Form models correctly track which fields were\n+explicitly provided vs. which fields use defaults.\n+\"\"\"\n+\n+import pydantic\n+from fastapi import FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated  # noqa: UP035\n+\n+PYDANTIC_V2 = int(pydantic.VERSION.split(\".\")[0]) >= 2\n+\n+\n+class FormModelFieldsSet(BaseModel):\n+    \"\"\"Model for testing fields_set metadata preservation.\"\"\"\n+\n+    field_1: bool = True\n+    field_2: str = \"default\"\n+    field_3: int = 42\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-fields-set\")\n+async def form_fields_set_endpoint(\n+    model: Annotated[FormModelFieldsSet, Form()],\n+) -> None:\n+    # Works for both Pydantic v1 (__fields_set__) and v2 (model_fields_set)\n+    fields_set = list(\n+        model.model_fields_set\n+        if hasattr(model, \"model_fields_set\")\n+        else model.__fields_set__  # type: ignore[attr-defined]\n+    )\n+    return {\n+        \"fields_set\": fields_set,\n+        \"data\": model.model_dump() if PYDANTIC_V2 else model.dict(),\n+    }\n+\n+\n+@app.post(\"/body-fields-set\")\n+async def body_fields_set_endpoint(model: FormModelFieldsSet) -> None:\n+    # Works for both Pydantic v1 (__fields_set__) and v2 (model_fields_set)\n+    fields_set = list(\n+        model.model_fields_set\n+        if hasattr(model, \"model_fields_set\")\n+        else model.__fields_set__  # type: ignore[attr-defined]\n+    )\n+    return {\"fields_set\": fields_set}\n+\n+\n+@app.get(\"/query/default\")\n+def query_model(\n+    name: Annotated[str, Query()] = \"query_default\",\n+    age: Annotated[int, Query()] = 10,\n+) -> None:\n+    return {\"name\": name, \"age\": age}\n+\n+\n+@app.get(\"/header/default\")\n+def header_model(\n+    x_token: Annotated[str, Header()] = \"header_default\",\n+) -> None:\n+    return {\"x_token\": x_token}\n+\n+\n+client = TestClient(app)\n+\n+\n+class TestFormFieldsSetMetadata:\n+    \"\"\"Test that Form models correctly preserve fields_set metadata.\"\"\"\n+\n+    def test_form_empty_data_has_empty_fields_set(self) -> None:\n+        \"\"\"Form with no data should have empty fields_set (matching JSON behavior).\"\"\"\n+        resp = client.post(\"/form-fields-set\", data={})\n+        assert resp.status_code == 200, resp.text\n+        fields_set = resp.json()[\"fields_set\"]\n+        assert fields_set == []\n+\n+    def test_body_empty_data_has_empty_fields_set(self) -> None:\n+        \"\"\"JSON body with no data should have empty fields_set.\"\"\"\n+        resp = client.post(\"/body-fields-set\", json={})\n+        assert resp.status_code == 200, resp.text\n+        fields_set = resp.json()[\"fields_set\"]\n+        assert fields_set == []\n+\n+    def test_form_partial_data_tracks_provided_fields(self) -> None:\n+        \"\"\"Form with partial data should only show provided fields in fields_set.\"\"\"\n+        resp =\n\n```\n\n```diff\n@@ -99,13 +99,13 @@ def test_no_data():\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"username\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n             {\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"lastname\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+        ", "output": "Bug: Fix: Preserve model_fields_set for Form models (issue #13399)\n\nWhen using Form() with Pydantic models, FastAPI was preloading default values and passing them to Pydantic, causing all fields to appear in model_fields_set even when not provided. This also caused validation to be enforced on unprovided defaults.\r\n\r\nChanges:\r\n- Modified _get_multidict_value() to check if values is FormData\r\n- For FormData, return None for unprovided fields instead of defaults\r\n- This lets Pydantic handle defaults properly and preserve fields_set\r\n- Updated test expectation in test_forms_single_model.py\r\n- Added comprehensive test suite in test_forms_fields_set.py\r\n\r\nThe fix ensures Form models behave consistently with JSON body models regarding field tracking and validation.\r\n\r\nCloses #13399", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 278}
{"instruction": "Review the following code changes: Fix: Preserve model_fields_set for Form models (issue #13399)", "input": "```diff\n@@ -748,6 +748,11 @@ def _get_multidict_value(\n         if field.required:\n             return\n         else:\n+            # For FormData, return None to let Pydantic handle defaults\n+            # This preserves model_fields_set metadata correctly\n+            if isinstance(values, FormData):\n+                return\n+            # For non-FormData (Query, Header, Cookie), keep existing behavior\n             return deepcopy(field.default)\n     return value\n \n\n```\n\n```diff\n@@ -0,0 +1,187 @@\n+\"\"\"\n+Tests for Form fields preserving model_fields_set metadata.\n+Related to issue #13399: https://github.com/fastapi/fastapi/issues/13399\n+\n+This test validates that Form models correctly track which fields were\n+explicitly provided vs. which fields use defaults.\n+\"\"\"\n+\n+import pydantic\n+from fastapi import FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from typing_extensions import Annotated  # noqa: UP035\n+\n+PYDANTIC_V2 = int(pydantic.VERSION.split(\".\")[0]) >= 2\n+\n+\n+class FormModelFieldsSet(BaseModel):\n+    \"\"\"Model for testing fields_set metadata preservation.\"\"\"\n+\n+    field_1: bool = True\n+    field_2: str = \"default\"\n+    field_3: int = 42\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-fields-set\")\n+async def form_fields_set_endpoint(\n+    model: Annotated[FormModelFieldsSet, Form()],\n+) -> None:\n+    # Works for both Pydantic v1 (__fields_set__) and v2 (model_fields_set)\n+    fields_set = list(\n+        model.model_fields_set\n+        if hasattr(model, \"model_fields_set\")\n+        else model.__fields_set__  # type: ignore[attr-defined]\n+    )\n+    return {\n+        \"fields_set\": fields_set,\n+        \"data\": model.model_dump() if PYDANTIC_V2 else model.dict(),\n+    }\n+\n+\n+@app.post(\"/body-fields-set\")\n+async def body_fields_set_endpoint(model: FormModelFieldsSet) -> None:\n+    # Works for both Pydantic v1 (__fields_set__) and v2 (model_fields_set)\n+    fields_set = list(\n+        model.model_fields_set\n+        if hasattr(model, \"model_fields_set\")\n+        else model.__fields_set__  # type: ignore[attr-defined]\n+    )\n+    return {\"fields_set\": fields_set}\n+\n+\n+@app.get(\"/query/default\")\n+def query_model(\n+    name: Annotated[str, Query()] = \"query_default\",\n+    age: Annotated[int, Query()] = 10,\n+) -> None:\n+    return {\"name\": name, \"age\": age}\n+\n+\n+@app.get(\"/header/default\")\n+def header_model(\n+    x_token: Annotated[str, Header()] = \"header_default\",\n+) -> None:\n+    return {\"x_token\": x_token}\n+\n+\n+client = TestClient(app)\n+\n+\n+class TestFormFieldsSetMetadata:\n+    \"\"\"Test that Form models correctly preserve fields_set metadata.\"\"\"\n+\n+    def test_form_empty_data_has_empty_fields_set(self) -> None:\n+        \"\"\"Form with no data should have empty fields_set (matching JSON behavior).\"\"\"\n+        resp = client.post(\"/form-fields-set\", data={})\n+        assert resp.status_code == 200, resp.text\n+        fields_set = resp.json()[\"fields_set\"]\n+        assert fields_set == []\n+\n+    def test_body_empty_data_has_empty_fields_set(self) -> None:\n+        \"\"\"JSON body with no data should have empty fields_set.\"\"\"\n+        resp = client.post(\"/body-fields-set\", json={})\n+        assert resp.status_code == 200, resp.text\n+        fields_set = resp.json()[\"fields_set\"]\n+        assert fields_set == []\n+\n+    def test_form_partial_data_tracks_provided_fields(self) -> None:\n+        \"\"\"Form with partial data should only show provided fields in fields_set.\"\"\"\n+        resp =\n\n```\n\n```diff\n@@ -99,13 +99,13 @@ def test_no_data():\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"username\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n             {\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"lastname\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n         ]\n     }\n\n```", "output": "Changes look good. This PR implements: Fix: Preserve model_fields_set for Form models (issue #13399)", "source": "pr", "type": "code_review", "pr_number": 278}
{"instruction": "Review the following code changes: Docs: clarify purpose and behavior of response_model", "input": "```diff\n@@ -47,6 +47,42 @@ Notice that `response_model` is a parameter of the \"decorator\" method (`get`, `p\n \n `response_model` receives the same type you would declare for a Pydantic model field, so, it can be a Pydantic model, but it can also be, e.g. a `list` of Pydantic models, like `List[Item]`.\n \n+### Why use `response_model`\n+\n+The `response_model` parameter is used to **control and validate the data\n+returned in responses**, independently from the request body model.\n+\n+This is useful for several reasons:\n+\n+- To **filter out sensitive fields** (e.g. passwords, internal IDs)\n+- To **guarantee a stable response shape**\n+- To avoid accidentally returning extra data\n+\n+For example:\n+\n+\n```", "output": "Changes look good. This PR implements: Docs: clarify purpose and behavior of response_model", "source": "pr", "type": "code_review", "pr_number": 277}
{"instruction": "Review the following code changes: Docs: clarify runtime vs OpenAPI behavior of responses model", "input": "```diff\n@@ -22,6 +22,16 @@ It receives a `dict`: the keys are status codes for each response (like `200`),\n \n Each of those response `dict`s can have a key `model`, containing a Pydantic model, just like `response_model`.\n \n+/// note\n+The `model` key inside `responses` is used **only for OpenAPI\n+documentation generation**.\n+\n+It does **not** perform runtime response validation or filtering.\n+\n+If you want FastAPI to validate and filter the returned data at\n+runtime, use `response_model` instead.\n+///\n+\n **FastAPI** will take that model, generate its JSON Schema and include it in the correct place in OpenAPI.\n \n For example, to declare another response with a status code `404` and a Pydantic model `Message`, you can write:\n\n```", "output": "Changes look good. This PR implements: Docs: clarify runtime vs OpenAPI behavior of responses model", "source": "pr", "type": "code_review", "pr_number": 276}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor internals, simplify Pydantic v2/v1 utils, `create_model_field`, better types for `lenient_issubclass`", "input": "```diff\n@@ -1,7 +1,6 @@\n from .shared import PYDANTIC_VERSION_MINOR_TUPLE as PYDANTIC_VERSION_MINOR_TUPLE\n from .shared import annotation_is_pydantic_v1 as annotation_is_pydantic_v1\n from .shared import field_annotation_is_scalar as field_annotation_is_scalar\n-from .shared import is_pydantic_v1_model_class as is_pydantic_v1_model_class\n from .shared import is_pydantic_v1_model_instance as is_pydantic_v1_model_instance\n from .shared import (\n     is_uploadfile_or_nonable_uploadfile_annotation as is_uploadfile_or_nonable_uploadfile_annotation,\n@@ -12,21 +11,19 @@\n from .shared import lenient_issubclass as lenient_issubclass\n from .shared import sequence_types as sequence_types\n from .shared import value_is_sequence as value_is_sequence\n-from .v2 import BaseConfig as BaseConfig\n from .v2 import ModelField as ModelField\n from .v2 import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n from .v2 import RequiredParam as RequiredParam\n from .v2 import Undefined as Undefined\n-from .v2 import UndefinedType as UndefinedType\n from .v2 import Url as Url\n-from .v2 import Validator as Validator\n-from .v2 import _regenerate_error_with_loc as _regenerate_error_with_loc\n from .v2 import copy_field_info as copy_field_info\n from .v2 import create_body_model as create_body_model\n from .v2 import evaluate_forwardref as evaluate_forwardref\n from .v2 import get_cached_model_fields as get_cached_model_fields\n from .v2 import get_definitions as get_definitions\n+from .v2 import get_flat_models_from_fields as get_flat_models_from_fields\n from .v2 import get_missing_field_error as get_missing_field_error\n+from .v2 import get_model_name_map as get_model_name_map\n from .v2 import get_schema_from_model_field as get_schema_from_model_field\n from .v2 import is_bytes_field as is_bytes_field\n from .v2 import is_bytes_sequence_field as is_bytes_sequence_field\n\n```\n\n```diff\n@@ -8,14 +8,17 @@\n from typing import (\n     Annotated,\n     Any,\n+    TypeVar,\n     Union,\n )\n \n from fastapi.types import UnionType\n from pydantic import BaseModel\n from pydantic.version import VERSION as PYDANTIC_VERSION\n from starlette.datastructures import UploadFile\n-from typing_extensions import get_args, get_origin\n+from typing_extensions import TypeGuard, get_args, get_origin\n+\n+_T = TypeVar(\"_T\")\n \n # Copy from Pydantic: pydantic/_internal/_typing_extra.py\n if sys.version_info < (3, 10):\n@@ -39,15 +42,13 @@\n     deque: deque,\n }\n \n-sequence_types = tuple(sequence_annotation_to_type.keys())\n-\n-Url: type[Any]\n+sequence_types: tuple[type[Any], ...] = tuple(sequence_annotation_to_type.keys())\n \n \n-# Copy of Pydantic: pydantic/_internal/_utils.py\n+# Copy of Pydantic: pydantic/_internal/_utils.py with added TypeGuard\n def lenient_issubclass(\n-    cls: Any, class_or_tuple: Union[type[Any], tuple[type[Any], ...], None]\n-) -> bool:\n+    cls: Any, class_or_tuple: Union[type[_T], tuple[type[_T], ...], None]\n+) -> TypeGuard[type[_T]]:\n     try:\n         return isinstance(cls, type) and issubclass(cls, class_or_tuple)  # type: ignore[arg-type]\n     except TypeError:  # pragma: no cover\n@@ -177,16 +178,26 @@ def is_uploadfile_sequence_annotation(annotation: Any) -> bool:\n \n \n def is_pydantic_v1_model_instance(obj: Any) -> bool:\n-    with warnings.catch_warnings():\n-        warnings.simplefilter(\"ignore\", UserWarning)\n-        from pydantic import v1\n+    # TODO: remove this function once the required version of Pydantic fully\n+    # removes pydantic.v1\n+    try:\n+        with warnings.catch_warnings():\n+            warnings.simplefilter(\"ignore\", UserWarning)\n+            from pydantic import v1\n+    except ImportError:  # pragma: no cover\n+        return False\n     return isinstance(obj, v1.BaseModel)\n \n \n def is_pydantic_v1_model_class(cls: Any) -> bool:\n-    with warnings.catch_warnings():\n-        warnings.simplefilter(\"ignore\", UserWarning)\n-        from pydantic import v1\n+    # TODO: remove this function once the required version of Pydantic fully\n+    # removes pydantic.v1\n+    try:\n+        with warnings.catch_warnings():\n+            warnings.simplefilter(\"ignore\", UserWarning)\n+            from pydantic import v1\n+    except ImportError:  # pragma: no cover\n+        return False\n     return lenient_issubclass(cls, v1.BaseModel)\n \n \n\n```\n\n```diff\n@@ -12,7 +12,7 @@\n     cast,\n )\n \n-from fastapi._compat import shared\n+from fastapi._compat import lenient_issubclass, shared\n from fastapi.openapi.constants import REF_TEMPLATE\n from fastapi.types import IncEx, ModelNameMap, UnionType\n from pydantic import BaseModel, ConfigDict, Field, TypeAdapter, create_model\n@@ -23,29 +23,20 @@\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n from pydantic._internal._typing_extra import eval_type_lenient\n-from pydantic._internal._utils import lenient_issubclass as lenient_issubclass\n from pydantic.fields import FieldInfo as FieldInfo\n from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchem", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Refactor internals, simplify Pydantic v2/v1 utils, `create_model_field`, better types for `lenient_issubclass`", "source": "pr", "type": "code_review", "pr_number": 275}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor and simplify Pydantic v2 (and v1) compatibility internal utils", "input": "```diff\n@@ -1,6 +1,14 @@\n from .shared import PYDANTIC_VERSION_MINOR_TUPLE as PYDANTIC_VERSION_MINOR_TUPLE\n from .shared import annotation_is_pydantic_v1 as annotation_is_pydantic_v1\n from .shared import field_annotation_is_scalar as field_annotation_is_scalar\n+from .shared import (\n+    field_annotation_is_scalar_sequence as field_annotation_is_scalar_sequence,\n+)\n+from .shared import field_annotation_is_sequence as field_annotation_is_sequence\n+from .shared import (\n+    is_bytes_or_nonable_bytes_annotation as is_bytes_or_nonable_bytes_annotation,\n+)\n+from .shared import is_bytes_sequence_annotation as is_bytes_sequence_annotation\n from .shared import is_pydantic_v1_model_instance as is_pydantic_v1_model_instance\n from .shared import (\n     is_uploadfile_or_nonable_uploadfile_annotation as is_uploadfile_or_nonable_uploadfile_annotation,\n@@ -25,11 +33,7 @@\n from .v2 import get_missing_field_error as get_missing_field_error\n from .v2 import get_model_name_map as get_model_name_map\n from .v2 import get_schema_from_model_field as get_schema_from_model_field\n-from .v2 import is_bytes_field as is_bytes_field\n-from .v2 import is_bytes_sequence_field as is_bytes_sequence_field\n from .v2 import is_scalar_field as is_scalar_field\n-from .v2 import is_scalar_sequence_field as is_scalar_sequence_field\n-from .v2 import is_sequence_field as is_sequence_field\n from .v2 import serialize_sequence_value as serialize_sequence_value\n from .v2 import (\n     with_info_plain_validator_function as with_info_plain_validator_function,\n\n```\n\n```diff\n@@ -102,18 +102,10 @@ def serialization_alias(self) -> Union[str, None]:\n         sa = self.field_info.serialization_alias\n         return sa or None\n \n-    @property\n-    def required(self) -> bool:\n-        return self.field_info.is_required()\n-\n     @property\n     def default(self) -> Any:\n         return self.get_default()\n \n-    @property\n-    def type_(self) -> Any:\n-        return self.field_info.annotation\n-\n     def __post_init__(self) -> None:\n         with warnings.catch_warnings():\n             # Pydantic >= 2.12.0 warns about field specific metadata that is unused\n@@ -267,9 +259,9 @@ def get_definitions(\n         for model in flat_serialization_models\n     ]\n     flat_model_fields = flat_validation_model_fields + flat_serialization_model_fields\n-    input_types = {f.type_ for f in fields}\n+    input_types = {f.field_info.annotation for f in fields}\n     unique_flat_model_fields = {\n-        f for f in flat_model_fields if f.type_ not in input_types\n+        f for f in flat_model_fields if f.field_info.annotation not in input_types\n     }\n     inputs = [\n         (\n@@ -304,22 +296,6 @@ def is_scalar_field(field: ModelField) -> bool:\n     ) and not isinstance(field.field_info, params.Body)\n \n \n-def is_sequence_field(field: ModelField) -> bool:\n-    return shared.field_annotation_is_sequence(field.field_info.annotation)\n-\n-\n-def is_scalar_sequence_field(field: ModelField) -> bool:\n-    return shared.field_annotation_is_scalar_sequence(field.field_info.annotation)\n-\n-\n-def is_bytes_field(field: ModelField) -> bool:\n-    return shared.is_bytes_or_nonable_bytes_annotation(field.type_)\n-\n-\n-def is_bytes_sequence_field(field: ModelField) -> bool:\n-    return shared.is_bytes_sequence_annotation(field.type_)\n-\n-\n def copy_field_info(*, field_info: FieldInfo, annotation: Any) -> FieldInfo:\n     cls = type(field_info)\n     merged_field_info = cls.from_annotation(annotation)\n@@ -428,7 +404,7 @@ def get_flat_models_from_annotation(\n def get_flat_models_from_field(\n     field: ModelField, known_models: TypeModelSet\n ) -> TypeModelSet:\n-    field_type = field.type_\n+    field_type = field.field_info.annotation\n     if lenient_issubclass(field_type, BaseModel):\n         if field_type in known_models:\n             return known_models\n\n```\n\n```diff\n@@ -25,13 +25,13 @@\n     create_body_model,\n     evaluate_forwardref,\n     field_annotation_is_scalar,\n+    field_annotation_is_scalar_sequence,\n+    field_annotation_is_sequence,\n     get_cached_model_fields,\n     get_missing_field_error,\n-    is_bytes_field,\n-    is_bytes_sequence_field,\n+    is_bytes_or_nonable_bytes_annotation,\n+    is_bytes_sequence_annotation,\n     is_scalar_field,\n-    is_scalar_sequence_field,\n-    is_sequence_field,\n     is_uploadfile_or_nonable_uploadfile_annotation,\n     is_uploadfile_sequence_annotation,\n     lenient_issubclass,\n@@ -182,8 +182,10 @@ def _get_flat_fields_from_params(fields: list[ModelField]) -> list[ModelField]:\n     if not fields:\n         return fields\n     first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n+    if len(fields) == 1 and lenient_issubclass(\n+        first_field.field_info.annotation, BaseModel\n+    ):\n+        fields_to_extract = get_cached_model_fields(first_field.field_info.annotation)\n         return fields_to_extract\n     return fields\n \n@@ -521,8 +523,8 @@ def a", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Refactor and simplify Pydantic v2 (and v1) compatibility internal utils", "source": "pr", "type": "code_review", "pr_number": 274}
{"instruction": "Review the following code changes: ‚ú® Support Annotated dependencies in APIRoute, APIRouter, and FastAPI class", "input": "```diff\n@@ -333,7 +333,7 @@ def __init__(\n             ),\n         ] = None,\n         dependencies: Annotated[\n-            Optional[Sequence[Depends]],\n+            Optional[Sequence[Union[Depends, routing.AnnotatedType]]],\n             Doc(\n                 \"\"\"\n                 A list of global dependencies, they will be applied to each\n@@ -345,11 +345,12 @@ def __init__(\n                 **Example**\n \n                 \n```\n\n```diff\n@@ -17,6 +17,7 @@\n     List,\n     Mapping,\n     Optional,\n+    Protocol,\n     Sequence,\n     Set,\n     Tuple,\n@@ -37,6 +38,7 @@\n from fastapi.dependencies.models import Dependant\n from fastapi.dependencies.utils import (\n     _should_embed_body_fields,\n+    analyze_param,\n     get_body_field,\n     get_dependant,\n     get_flat_dependant,\n@@ -463,20 +465,26 @@ async def app(websocket: WebSocket) -> None:\n     return app\n \n \n+class AnnotatedType(Protocol):\n+    \"\"\"this forces mypy to check if Any is handled correctly\"\"\"\n+\n+\n class APIWebSocketRoute(routing.WebSocketRoute):\n     def __init__(\n         self,\n         path: str,\n         endpoint: Callable[..., Any],\n         *,\n         name: Optional[str] = None,\n-        dependencies: Optional[Sequence[params.Depends]] = None,\n+        dependencies: Optional[Sequence[Union[params.Depends, AnnotatedType]]] = None,\n         dependency_overrides_provider: Optional[Any] = None,\n     ) -> None:\n         self.path = path\n         self.endpoint = endpoint\n         self.name = get_name(endpoint) if name is None else name\n-        self.dependencies = list(dependencies or [])\n+        self.dependencies = [\n+            get_depends_from_annotated(dep) for dep in dependencies or []\n+        ]\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         self.dependant = get_dependant(path=self.path_format, call=self.endpoint)\n         for depends in self.dependencies[::-1]:\n@@ -512,7 +520,7 @@ def __init__(\n         response_model: Any = Default(None),\n         status_code: Optional[int] = None,\n         tags: Optional[List[Union[str, Enum]]] = None,\n-        dependencies: Optional[Sequence[params.Depends]] = None,\n+        dependencies: Optional[Sequence[Union[params.Depends, AnnotatedType]]] = None,\n         summary: Optional[str] = None,\n         description: Optional[str] = None,\n         response_description: str = \"Successful Response\",\n@@ -605,7 +613,9 @@ def __init__(\n         else:\n             self.response_field = None  # type: ignore\n             self.secure_cloned_response_field = None\n-        self.dependencies = list(dependencies or [])\n+        self.dependencies = [\n+            get_depends_from_annotated(dep) for dep in dependencies or []\n+        ]\n         self.description = description or inspect.cleandoc(self.endpoint.__doc__ or \"\")\n         # if a \"form feed\" character (page break) is found in the description text,\n         # truncate description text to the content preceding the first \"form feed\"\n@@ -670,6 +680,24 @@ def matches(self, scope: Scope) -> Tuple[Match, Scope]:\n         return match, child_scope\n \n \n+def get_depends_from_annotated(\n+    dep: Union[params.Depends, AnnotatedType],\n+) -> params.Depends:\n+    if isinstance(dep, params.Depends):\n+        return dep\n+    d = analyze_param(\n+        param_name=\"APIRouter Dependency\",\n+        annotation=dep,\n+        value=inspect.Signature.empty,\n+        is_path_param=False,\n+    ).depends\n+\n+    as\n\n```\n\n```diff\n@@ -0,0 +1,40 @@\n+from fastapi import APIRouter, Depends, FastAPI\n+from fastapi.testclient import TestClient\n+from typing_extensions import Annotated\n+\n+\n+def get_value() -> int:\n+    return 1\n+\n+\n+ValueDep = Annotated[int, Depends(get_value)]\n+\n+\n+router = APIRouter(dependencies=[Depends(lambda: \"sdfgh\"), ValueDep])\n+\n+\n+@router.get(\"/\")\n+def read_root(dep: ValueDep):\n+    return {\"dep\": dep}\n+\n+\n+@router.get(\"/no_dep\")\n+def no_dep():\n+    return {\"status\": 200}\n+\n+\n+app = FastAPI()\n+app.include_router(router)\n+\n+router.post(\"/\", dependencies=[Depends(lambda: None)])\n+\n+\n+def test_apirouter_annotated_dependencies():\n+    client = TestClient(app)\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"dep\": 1}\n+\n+    response = client.get(\"/no_dep\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"status\": 200}\n\n```", "output": "Changes look good. This PR implements: ‚ú® Support Annotated dependencies in APIRoute, APIRouter, and FastAPI class", "source": "pr", "type": "code_review", "pr_number": 273}
{"instruction": "Fix the following bug: üêõ Fix status code when malformed JSON", "input": "From https://github.com/fastapi/fastapi/discussions/14399", "output": "```diff\n@@ -14,10 +14,15 @@\n from fastapi.datastructures import Default, DefaultPlaceholder\n from fastapi.exception_handlers import (\n     http_exception_handler,\n+    request_malformed_exception_handler,\n     request_validation_exception_handler,\n     websocket_request_validation_exception_handler,\n )\n-from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n+from fastapi.exceptions import (\n+    RequestMalformedError,\n+    RequestValidationError,\n+    WebSocketRequestValidationError,\n+)\n from fastapi.logger import logger\n from fastapi.middleware.asyncexitstack import AsyncExitStackMiddleware\n from fastapi.openapi.docs import (\n@@ -983,6 +988,9 @@ class Item(BaseModel):\n             Any, Callable[[Request, Any], Union[Response, Awaitable[Response]]]\n         ] = {} if exception_handlers is None else dict(exception_handlers)\n         self.exception_handlers.setdefault(HTTPException, http_exception_handler)\n+        self.exception_handlers.setdefault(\n+            RequestMalformedError, request_malformed_exception_handler\n+        )\n         self.exception_handlers.setdefault(\n             RequestValidationError, request_validation_exception_handler\n         )\n\n```\n\n```diff\n@@ -1,5 +1,9 @@\n from fastapi.encoders import jsonable_encoder\n-from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n+from fastapi.exceptions import (\n+    RequestMalformedError,\n+    RequestValidationError,\n+    WebSocketRequestValidationError,\n+)\n from fastapi.utils import is_body_allowed_for_status_code\n from fastapi.websockets import WebSocket\n from starlette.exceptions import HTTPException\n@@ -17,6 +21,15 @@ async def http_exception_handler(request: Request, exc: HTTPException) -> Respon\n     )\n \n \n+async def request_malformed_exception_handler(\n+    request: Request, exc: RequestMalformedError\n+) -> JSONResponse:\n+    return JSONResponse(\n+        status_code=400,\n+        content={\"detail\": jsonable_encoder(exc.errors())},\n+    )\n+\n+\n async def request_validation_exception_handler(\n     request: Request, exc: RequestValidationError\n ) -> JSONResponse:\n\n```\n\n```diff\n@@ -209,6 +209,18 @@ def __str__(self) -> str:\n         return message.rstrip()\n \n \n+class RequestMalformedError(ValidationException):\n+    def __init__(\n+        self,\n+        errors: Sequence[Any],\n+        *,\n+        body: Any = None,\n+        endpoint_ctx: Optional[EndpointContext] = None,\n+    ) -> None:\n+        super().__init__(errors, endpoint_ctx=endpoint_ctx)\n+        self.body = body\n+\n+\n class RequestValidationError(ValidationException):\n     def __init__(\n         self,\n\n```\n\n```diff\n@@ -51,6 +51,7 @@\n from fastapi.exceptions import (\n     EndpointContext,\n     FastAPIError,\n+    RequestMalformedError,\n     RequestValidationError,\n     ResponseValidationError,\n     WebSocketRequestValidationError,\n@@ -384,7 +385,7 @@ async def app(request: Request) -> Response:\n                         else:\n                             body = body_bytes\n         except json.JSONDecodeError as e:\n-            validation_error = RequestValidationError(\n+            raise RequestMalformedError(\n                 [\n                     {\n                         \"type\": \"json_invalid\",\n@@ -396,8 +397,7 @@ async def app(request: Request) -> Response:\n                 ],\n                 body=e.doc,\n                 endpoint_ctx=endpoint_ctx,\n-            )\n-            raise validation_error from e\n+            ) from e\n         except HTTPException:\n             # If a middleware raises an HTTPException, it should be raised again\n             raise\n\n```\n\n```diff\n@@ -142,7 +142,7 @@ def test_post_broken_body(client: TestClient):\n         headers={\"content-type\": \"application/json\"},\n         content=\"{some broken json}\",\n     )\n-    assert response.status_code == 422, response.text\n+    assert response.status_code == 400, response.text\n     assert response.json() == {\n         \"detail\": [\n             {\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 272}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -14,10 +14,15 @@\n from fastapi.datastructures import Default, DefaultPlaceholder\n from fastapi.exception_handlers import (\n     http_exception_handler,\n+    request_malformed_exception_handler,\n     request_validation_exception_handler,\n     websocket_request_validation_exception_handler,\n )\n-from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n+from fastapi.exceptions import (\n+    RequestMalformedError,\n+    RequestValidationError,\n+    WebSocketRequestValidationError,\n+)\n from fastapi.logger import logger\n from fastapi.middleware.asyncexitstack import AsyncExitStackMiddleware\n from fastapi.openapi.docs import (\n@@ -983,6 +988,9 @@ class Item(BaseModel):\n             Any, Callable[[Request, Any], Union[Response, Awaitable[Response]]]\n         ] = {} if exception_handlers is None else dict(exception_handlers)\n         self.exception_handlers.setdefault(HTTPException, http_exception_handler)\n+        self.exception_handlers.setdefault(\n+            RequestMalformedError, request_malformed_exception_handler\n+        )\n         self.exception_handlers.setdefault(\n             RequestValidationError, request_validation_exception_handler\n         )\n\n```\n\n```diff\n@@ -1,5 +1,9 @@\n from fastapi.encoders import jsonable_encoder\n-from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n+from fastapi.exceptions import (\n+    RequestMalformedError,\n+    RequestValidationError,\n+    WebSocketRequestValidationError,\n+)\n from fastapi.utils import is_body_allowed_for_status_code\n from fastapi.websockets import WebSocket\n from starlette.exceptions import HTTPException\n@@ -17,6 +21,15 @@ async def http_exception_handler(request: Request, exc: HTTPException) -> Respon\n     )\n \n \n+async def request_malformed_exception_handler(\n+    request: Request, exc: RequestMalformedError\n+) -> JSONResponse:\n+    return JSONResponse(\n+        status_code=400,\n+        content={\"detail\": jsonable_encoder(exc.errors())},\n+    )\n+\n+\n async def request_validation_exception_handler(\n     request: Request, exc: RequestValidationError\n ) -> JSONResponse:\n\n```\n\n```diff\n@@ -209,6 +209,18 @@ def __str__(self) -> str:\n         return message.rstrip()\n \n \n+class RequestMalformedError(ValidationException):\n+    def __init__(\n+        self,\n+        errors: Sequence[Any],\n+        *,\n+        body: Any = None,\n+        endpoint_ctx: Optional[EndpointContext] = None,\n+    ) -> None:\n+        super().__init__(errors, endpoint_ctx=endpoint_ctx)\n+        self.body = body\n+\n+\n class RequestValidationError(ValidationException):\n     def __init__(\n         self,\n\n```\n\n```diff\n@@ -51,6 +51,7 @@\n from fastapi.exceptions import (\n     EndpointContext,\n     FastAPIError,\n+    RequestMalformedError,\n     RequestValidationError,\n     ResponseValidationError,\n     WebSocketRequestValidationError,\n@@ -384,7 +385,7 @@ async def app(request: Request) -> Response:\n                         else:\n                             body = body_bytes\n         except json.JSONDecodeError as e:\n-            validation_error = RequestValidationError(\n+            raise RequestMalformedError(\n                 [\n                     {\n                         \"type\": \"json_invalid\",\n@@ -396,8 +397,7 @@ async def app(request: Request) -> Response:\n                 ],\n                 body=e.doc,\n                 endpoint_ctx=endpoint_ctx,\n-            )\n-            raise validation_error from e\n+            ) from e\n         except HTTPException:\n             # If a middleware raises an HTTPException, it should be raised again\n             raise\n\n```\n\n```diff\n@@ -142,7 +142,7 @@ def test_post_broken_body(client: TestClient):\n         headers={\"content-type\": \"application/json\"},\n         content=\"{some broken json}\",\n     )\n-    assert response.status_code == 422, response.text\n+    assert response.status_code == 400, response.text\n     assert response.json() == {\n         \"detail\": [\n             {\n\n```", "output": "Bug: üêõ Fix status code when malformed JSON\n\nFrom https://github.com/fastapi/fastapi/discussions/14399", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 272}
{"instruction": "Review the following code changes: üêõ Fix status code when malformed JSON", "input": "```diff\n@@ -14,10 +14,15 @@\n from fastapi.datastructures import Default, DefaultPlaceholder\n from fastapi.exception_handlers import (\n     http_exception_handler,\n+    request_malformed_exception_handler,\n     request_validation_exception_handler,\n     websocket_request_validation_exception_handler,\n )\n-from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n+from fastapi.exceptions import (\n+    RequestMalformedError,\n+    RequestValidationError,\n+    WebSocketRequestValidationError,\n+)\n from fastapi.logger import logger\n from fastapi.middleware.asyncexitstack import AsyncExitStackMiddleware\n from fastapi.openapi.docs import (\n@@ -983,6 +988,9 @@ class Item(BaseModel):\n             Any, Callable[[Request, Any], Union[Response, Awaitable[Response]]]\n         ] = {} if exception_handlers is None else dict(exception_handlers)\n         self.exception_handlers.setdefault(HTTPException, http_exception_handler)\n+        self.exception_handlers.setdefault(\n+            RequestMalformedError, request_malformed_exception_handler\n+        )\n         self.exception_handlers.setdefault(\n             RequestValidationError, request_validation_exception_handler\n         )\n\n```\n\n```diff\n@@ -1,5 +1,9 @@\n from fastapi.encoders import jsonable_encoder\n-from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError\n+from fastapi.exceptions import (\n+    RequestMalformedError,\n+    RequestValidationError,\n+    WebSocketRequestValidationError,\n+)\n from fastapi.utils import is_body_allowed_for_status_code\n from fastapi.websockets import WebSocket\n from starlette.exceptions import HTTPException\n@@ -17,6 +21,15 @@ async def http_exception_handler(request: Request, exc: HTTPException) -> Respon\n     )\n \n \n+async def request_malformed_exception_handler(\n+    request: Request, exc: RequestMalformedError\n+) -> JSONResponse:\n+    return JSONResponse(\n+        status_code=400,\n+        content={\"detail\": jsonable_encoder(exc.errors())},\n+    )\n+\n+\n async def request_validation_exception_handler(\n     request: Request, exc: RequestValidationError\n ) -> JSONResponse:\n\n```\n\n```diff\n@@ -209,6 +209,18 @@ def __str__(self) -> str:\n         return message.rstrip()\n \n \n+class RequestMalformedError(ValidationException):\n+    def __init__(\n+        self,\n+        errors: Sequence[Any],\n+        *,\n+        body: Any = None,\n+        endpoint_ctx: Optional[EndpointContext] = None,\n+    ) -> None:\n+        super().__init__(errors, endpoint_ctx=endpoint_ctx)\n+        self.body = body\n+\n+\n class RequestValidationError(ValidationException):\n     def __init__(\n         self,\n\n```\n\n```diff\n@@ -51,6 +51,7 @@\n from fastapi.exceptions import (\n     EndpointContext,\n     FastAPIError,\n+    RequestMalformedError,\n     RequestValidationError,\n     ResponseValidationError,\n     WebSocketRequestValidationError,\n@@ -384,7 +385,7 @@ async def app(request: Request) -> Response:\n                         else:\n                             body = body_bytes\n         except json.JSONDecodeError as e:\n-            validation_error = RequestValidationError(\n+            raise RequestMalformedError(\n                 [\n                     {\n                         \"type\": \"json_invalid\",\n@@ -396,8 +397,7 @@ async def app(request: Request) -> Response:\n                 ],\n                 body=e.doc,\n                 endpoint_ctx=endpoint_ctx,\n-            )\n-            raise validation_error from e\n+            ) from e\n         except HTTPException:\n             # If a middleware raises an HTTPException, it should be raised again\n             raise\n\n```\n\n```diff\n@@ -142,7 +142,7 @@ def test_post_broken_body(client: TestClient):\n         headers={\"content-type\": \"application/json\"},\n         content=\"{some broken json}\",\n     )\n-    assert response.status_code == 422, response.text\n+    assert response.status_code == 400, response.text\n     assert response.json() == {\n         \"detail\": [\n             {\n\n```", "output": "Changes look good. This PR implements: üêõ Fix status code when malformed JSON", "source": "pr", "type": "code_review", "pr_number": 272}
{"instruction": "Review the following code changes: ‚ú® Add support for using `@app.api_route()` in user code with multiple `methods`", "input": "```diff\n@@ -235,6 +235,8 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    if len(route.methods) > 1:\n+        operation_id = f\"{operation_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -180,7 +180,10 @@ def generate_unique_id(route: \"APIRoute\") -> str:\n     operation_id = f\"{route.name}{route.path_format}\"\n     operation_id = re.sub(r\"\\W\", \"_\", operation_id)\n     assert route.methods\n-    operation_id = f\"{operation_id}_{list(route.methods)[0].lower()}\"\n+\n+    if len(route.methods) == 1:\n+        operation_id = f\"{operation_id}_{list(route.methods)[0].lower()}\"\n+\n     return operation_id\n \n \n\n```\n\n```diff\n@@ -194,6 +194,11 @@ def get_query_type_frozenset(query: FrozenSet[int] = Query(...)):\n     return \",\".join(map(str, sorted(query)))\n \n \n+@app.api_route(\"/multiple-methods\", methods=[\"GET\", \"POST\"])\n+def multiple_methods():\n+    return {\"message\": \"Hello World\"}\n+\n+\n @app.get(\"/query/list\")\n def get_query_list(device_ids: List[int] = Query()) -> List[int]:\n     return device_ids\n\n```\n\n```diff\n@@ -12,6 +12,7 @@\n     [\n         (\"/api_route\", 200, {\"message\": \"Hello World\"}),\n         (\"/non_decorated_route\", 200, {\"message\": \"Hello World\"}),\n+        (\"/multiple-methods\", 200, {\"message\": \"Hello World\"}),\n         (\"/nonexistent\", 404, {\"detail\": \"Not Found\"}),\n     ],\n )\n@@ -1163,6 +1164,28 @@ def test_openapi_schema():\n                     },\n                 }\n             },\n+            \"/multiple-methods\": {\n+                \"get\": {\n+                    \"summary\": \"Multiple Methods\",\n+                    \"operationId\": \"multiple_methods_multiple_methods_get\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        }\n+                    },\n+                },\n+                \"post\": {\n+                    \"summary\": \"Multiple Methods\",\n+                    \"operationId\": \"multiple_methods_multiple_methods_post\",\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        }\n+                    },\n+                },\n+            },\n             \"/query/list\": {\n                 \"get\": {\n                     \"summary\": \"Get Query List\",\n@@ -1251,6 +1274,17 @@ def test_openapi_schema():\n         },\n         \"components\": {\n             \"schemas\": {\n+                \"HTTPValidationError\": {\n+                    \"title\": \"HTTPValidationError\",\n+                    \"type\": \"object\",\n+                    \"properties\": {\n+                        \"detail\": {\n+                            \"title\": \"Detail\",\n+                            \"type\": \"array\",\n+                            \"items\": {\"$ref\": \"#/components/schemas/ValidationError\"},\n+                        }\n+                    },\n+                },\n                 \"ValidationError\": {\n                     \"title\": \"ValidationError\",\n                     \"required\": [\"loc\", \"msg\", \"type\"],\n@@ -1267,17 +1301,6 @@ def test_openapi_schema():\n                         \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n                     },\n                 },\n-                \"HTTPValidationError\": {\n-                    \"title\": \"HTTPValidationError\",\n-                    \"type\": \"object\",\n-                    \"properties\": {\n-                        \"detail\": {\n-                            \"title\": \"Detail\",\n-                            \"type\": \"array\",\n-                            \"items\": {\"$ref\": \"#/components/schemas/ValidationError\"},\n-                        }\n-                    },\n-                },\n             }\n         },\n     }\n\n```", "output": "Changes look good. This PR implements: ‚ú® Add support for using `@app.api_route()` in user code with multiple `methods`", "source": "pr", "type": "code_review", "pr_number": 271}
{"instruction": "Fix the following bug: Fix #12419: Clarify docs for required query params with None type", "input": "## Summary\nClarifies documentation for the confusing \"Required, can be None\" pattern, which doesn't work as described for HTTP query parameters.\n\n## Problem\nIssue #12419 reported confusion about the \"Required, can be None\" section. The documentation suggested you could force clients to send a `None` value, but:\n\n1. HTTP query parameters cannot send literal `None` - they're either strings or omitted\n2. The example has no default value, making the parameter required\n3. Omitting the parameter causes a validation error (not shown in docs)\n4. The tests for this example are marked as `xfail` with reference to this issue\n\n## Changes\nUpdated `/docs/en/docs/tutorial/query-params-str-validations.md` to:\n\n1. **Rename section**: \"Required with None type\" (more accurate)\n2. **Add detailed note** explaining:\n   - Parameter is required (no default value)\n   - HTTP can't send literal None values  \n   - Omitting parameter causes validation error\n   - Pattern is more useful for dependencies than HTTP endpoints\n   - How to make truly optional parameters\n\n## Example\n**Before (confusing):**\n> \"You can declare that a parameter can accept None, but that it's still required. This would force clients to send a value, even if the value is None.\"\n\n**After (clear):**\n> Explains that while the type includes `None`, the parameter is required and must be provided. Clarifies HTTP limitations and shows the correct pattern for optional parameters.\n\n## Testing\n- No code changes, only documentation\n- Existing tests in `test_tutorial006c.py` are already marked as `xfail` for this issue\n- Documentation now accurately describes the behavior\n\n## Impact\n- Reduces confusion for developers\n- Explains when to use this pattern (dependencies) vs optional parameters (HTTP)\n- Clarifies HTTP query parameter limitations\n\nCloses #12419", "output": "```diff\n@@ -244,14 +244,26 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n {* ../../docs_src/query_params_str_validations/tutorial006_an_py39.py hl[9] *}\n \n-### Required, can be `None` { #required-can-be-none }\n+### Required with `None` type { #required-with-none-type }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n-\n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+You can declare that a parameter has a type that includes `None` (like `str | None`) but without a default value, which makes it required:\n \n {* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n \n+/// note\n+\n+**Important**: Even though the type includes `None`, the parameter is still **required** because there's no default value. This means clients **must** provide the parameter.\n+\n+In practice, HTTP query parameters are sent as strings. While the type annotation `str | None` indicates the parameter could theoretically be `None`, there's no standard way to send a literal `None` value in HTTP query parameters - you can only send string values or omit the parameter entirely.\n+\n+**Omitting the parameter will result in a validation error** since it's required.\n+\n+This pattern is more commonly useful for **dependencies** (where you might pass `None` programmatically) rather than direct HTTP endpoints.\n+\n+For an optional query parameter that can be omitted, use: `q: Annotated[str | None, Query(min_length=3)] = None`\n+\n+///\n+\n ## Query parameter list / multiple values { #query-parameter-list-multiple-values }\n \n When you define a query parameter explicitly with `Query` you can also declare it to receive a list of values, or said in another way, to receive multiple values.\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 270}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -244,14 +244,26 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n {* ../../docs_src/query_params_str_validations/tutorial006_an_py39.py hl[9] *}\n \n-### Required, can be `None` { #required-can-be-none }\n+### Required with `None` type { #required-with-none-type }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n-\n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+You can declare that a parameter has a type that includes `None` (like `str | None`) but without a default value, which makes it required:\n \n {* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n \n+/// note\n+\n+**Important**: Even though the type includes `None`, the parameter is still **required** because there's no default value. This means clients **must** provide the parameter.\n+\n+In practice, HTTP query parameters are sent as strings. While the type annotation `str | None` indicates the parameter could theoretically be `None`, there's no standard way to send a literal `None` value in HTTP query parameters - you can only send string values or omit the parameter entirely.\n+\n+**Omitting the parameter will result in a validation error** since it's required.\n+\n+This pattern is more commonly useful for **dependencies** (where you might pass `None` programmatically) rather than direct HTTP endpoints.\n+\n+For an optional query parameter that can be omitted, use: `q: Annotated[str | None, Query(min_length=3)] = None`\n+\n+///\n+\n ## Query parameter list / multiple values { #query-parameter-list-multiple-values }\n \n When you define a query parameter explicitly with `Query` you can also declare it to receive a list of values, or said in another way, to receive multiple values.\n\n```", "output": "Bug: Fix #12419: Clarify docs for required query params with None type\n\n## Summary\nClarifies documentation for the confusing \"Required, can be None\" pattern, which doesn't work as described for HTTP query parameters.\n\n## Problem\nIssue #12419 reported confusion about the \"Required, can be None\" section. The documentation suggested you could force clients to send a `None` value, but:\n\n1. HTTP query parameters cannot send literal `None` - they're either strings or omitted\n2. The example has no default value, making the parameter required\n3. Omitting the parameter causes a validation error (not shown in docs)\n4. The tests for this example are marked as `xfail` with reference to this issue\n\n## Changes\nUpdated `/docs/en/docs/tutorial/query-params-str-validations.md` to:\n\n1. **Rename section**: \"Required with None type\" (more accurate)\n2. **Add detailed note** explaining:\n   - Parameter is required (no default value)\n   - HTTP can't send literal None values  \n   - Omitting parameter causes validation error\n   - Pattern is more useful for dependencies than HTTP endpoints\n   - How to make truly optional parameters\n\n## Example\n**Before (confusing):**\n> \"You can declare that a parameter can accept None, but that it's still required. This would force clients to send a value, even if the value is None.\"\n\n**After (clear):**\n> Explains that while the type includes `None`, the parameter is required and must be provided. Clarifies HTTP limitations and shows the correct pattern for optional parameters.\n\n## Testing\n- No code changes, only documentation\n- Existing tests in `test_tutorial006c.py` are already marked as `xfail` for this issue\n- Documentation now accurately describes the behavior\n\n## Impact\n- Reduces confusion for developers\n- Explains when to use this pattern (dependencies) vs optional parameters (HTTP)\n- Clarifies HTTP query parameter limitations\n\nCloses #12419", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 270}
{"instruction": "Review the following code changes: Fix #12419: Clarify docs for required query params with None type", "input": "```diff\n@@ -244,14 +244,26 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n {* ../../docs_src/query_params_str_validations/tutorial006_an_py39.py hl[9] *}\n \n-### Required, can be `None` { #required-can-be-none }\n+### Required with `None` type { #required-with-none-type }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n-\n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+You can declare that a parameter has a type that includes `None` (like `str | None`) but without a default value, which makes it required:\n \n {* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n \n+/// note\n+\n+**Important**: Even though the type includes `None`, the parameter is still **required** because there's no default value. This means clients **must** provide the parameter.\n+\n+In practice, HTTP query parameters are sent as strings. While the type annotation `str | None` indicates the parameter could theoretically be `None`, there's no standard way to send a literal `None` value in HTTP query parameters - you can only send string values or omit the parameter entirely.\n+\n+**Omitting the parameter will result in a validation error** since it's required.\n+\n+This pattern is more commonly useful for **dependencies** (where you might pass `None` programmatically) rather than direct HTTP endpoints.\n+\n+For an optional query parameter that can be omitted, use: `q: Annotated[str | None, Query(min_length=3)] = None`\n+\n+///\n+\n ## Query parameter list / multiple values { #query-parameter-list-multiple-values }\n \n When you define a query parameter explicitly with `Query` you can also declare it to receive a list of values, or said in another way, to receive multiple values.\n\n```", "output": "Changes look good. This PR implements: Fix #12419: Clarify docs for required query params with None type", "source": "pr", "type": "code_review", "pr_number": 270}
{"instruction": "Fix the following bug: Fix #13399: Form dependency models preserve model_fields_set correctly", "input": "## Summary\nFixes Form-based dependency models losing `model_fields_set` metadata when default values are not explicitly provided, making Form parameter handling consistent with JSON body parameters.\n\n## Problem\nIssue #13399 reported that Form-based dependency models were pre-filling default values during parsing, causing `model_fields_set` to include all fields with defaults even when they weren't provided in the request. This made it impossible to use `model_fields_set`, `model_dump(exclude_unset=True)`, or `model_dump(exclude_defaults=True)` correctly with Form models.\n\n## Example\n**Before this fix:**\n```python\nclass ExampleModel(BaseModel):\n    field_1: bool = True\n\n@app.post(\"/form\")\nasync def form_endpoint(model: Annotated[ExampleModel, Form()]):\n    return {\"fields_set\": list(model.model_fields_set)}\n\n# POST /form with empty data {}\n# Response: {\"fields_set\": [\"field_1\"]}  # Wrong! field_1 wasn't provided\n```\n\n**After this fix:**\n```python\n# POST /form with empty data {}\n# Response: {\"fields_set\": []}  # Correct! Matches JSON behavior\n```\n\n## Root Cause\nIn `fastapi/dependencies/utils.py`, the `_get_multidict_value()` function was returning `deepcopy(field.default)` when a form field wasn't provided and had a default value. This pre-filled default was then treated as explicitly set by Pydantic.\n\n## Solution\nChanged `_get_multidict_value()` to return `None` instead of the default value when a field is not provided. This allows Pydantic to handle defaults during validation, preserving `model_fields_set` correctly.\n\n## Testing\n- Added comprehensive test suite in `tests/test_form_model_fields_set.py`\n- Tests verify Form and JSON body parameters now have identical `model_fields_set` behavior\n- All existing tests continue to pass\n\n## Impact\n- Makes Form and JSON body parameter handling consistent\n- Enables proper use of `exclude_unset` and `exclude_defaults` with Form models\n- Allows developers to distinguish between explicitly provided values and defaults\n\nCloses #13399", "output": "```diff\n@@ -745,10 +745,9 @@ def _get_multidict_value(\n             and len(value) == 0\n         )\n     ):\n-        if field.field_info.is_required():\n-            return\n-        else:\n-            return deepcopy(field.default)\n+        # Don't pre-fill defaults here - let Pydantic handle them during validation\n+        # This preserves model_fields_set correctly for Form fields\n+        return None\n     return value\n \n \n\n```\n\n```diff\n@@ -0,0 +1,119 @@\n+\"\"\"\n+Test that Form-based dependency models preserve model_fields_set correctly.\n+\n+This test addresses issue https://github.com/fastapi/fastapi/issues/13399\n+where Form models were pre-filling default values, making it impossible\n+to distinguish between explicitly set fields and fields using defaults.\n+\"\"\"\n+\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class ModelWithDefaults(BaseModel):\n+    field_bool: bool = True\n+    field_str: str = \"default_value\"\n+    field_int: int = 42\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/json\")\n+async def json_endpoint(model: ModelWithDefaults):\n+    return {\n+        \"fields_set\": list(model.model_fields_set),\n+        \"field_bool\": model.field_bool,\n+        \"field_str\": model.field_str,\n+        \"field_int\": model.field_int,\n+    }\n+\n+\n+@app.post(\"/form\")\n+async def form_endpoint(model: Annotated[ModelWithDefaults, Form()]):\n+    return {\n+        \"fields_set\": list(model.model_fields_set),\n+        \"field_bool\": model.field_bool,\n+        \"field_str\": model.field_str,\n+        \"field_int\": model.field_int,\n+    }\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_empty_preserves_fields_set():\n+    \"\"\"JSON with empty dict should have empty fields_set\"\"\"\n+    response = client.post(\"/json\", json={})\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data[\"fields_set\"] == []\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"default_value\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def test_json_partial_preserves_fields_set():\n+    \"\"\"JSON with partial data should only set provided fields\"\"\"\n+    response = client.post(\"/json\", json={\"field_str\": \"custom\"})\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data[\"fields_set\"] == [\"field_str\"]\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"custom\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def test_json_all_fields_preserves_fields_set():\n+    \"\"\"JSON with all fields should mark all as set\"\"\"\n+    response = client.post(\n+        \"/json\",\n+        json={\"field_bool\": False, \"field_str\": \"custom\", \"field_int\": 100},\n+    )\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert set(data[\"fields_set\"]) == {\"field_bool\", \"field_str\", \"field_int\"}\n+    assert data[\"field_bool\"] is False\n+    assert data[\"field_str\"] == \"custom\"\n+    assert data[\"field_int\"] == 100\n+\n+\n+def test_form_empty_preserves_fields_set():\n+    \"\"\"Form with empty data should have empty fields_set (matching JSON behavior)\"\"\"\n+    response = client.post(\"/form\", data={})\n+    assert response.status_code == 200\n+    data = response.json()\n+    # This is the key fix: Form should behave like JSON\n+    assert data[\"fields_set\"] == []\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"default_value\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def t\n\n```\n\n```diff\n@@ -99,13 +99,13 @@ def test_no_data():\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"username\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n             {\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"lastname\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n         ]\n     }\n\n```\n\n```diff\n@@ -67,7 +67,6 @@ def test_header_param_model_invalid(client: TestClient):\n                     \"loc\": [\"header\", \"save_data\"],\n                     \"msg\": \"Field required\",\n                     \"input\": {\n-                        \"x_tag\": [],\n                         \"host\": \"testserver\",\n                         \"accept\": \"*/*\",\n                         \"accept-encoding\": \"gzip, deflate\",\n\n```\n\n```diff\n@@ -67,7 +67,7 @@ def test_header_param_model_invalid(client: TestClient):\n                     \"type\": \"missing\",\n                     \"loc\": [\"header\", \"save_data\"],\n                     \"msg\": \"Field required\",\n-                    \"input\": {\"x_tag\": [], \"host\": \"testserver\"},\n+                    \"input\": {\"host\": \"testserver\"},\n                 }\n             ]\n         }\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 269}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -745,10 +745,9 @@ def _get_multidict_value(\n             and len(value) == 0\n         )\n     ):\n-        if field.field_info.is_required():\n-            return\n-        else:\n-            return deepcopy(field.default)\n+        # Don't pre-fill defaults here - let Pydantic handle them during validation\n+        # This preserves model_fields_set correctly for Form fields\n+        return None\n     return value\n \n \n\n```\n\n```diff\n@@ -0,0 +1,119 @@\n+\"\"\"\n+Test that Form-based dependency models preserve model_fields_set correctly.\n+\n+This test addresses issue https://github.com/fastapi/fastapi/issues/13399\n+where Form models were pre-filling default values, making it impossible\n+to distinguish between explicitly set fields and fields using defaults.\n+\"\"\"\n+\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class ModelWithDefaults(BaseModel):\n+    field_bool: bool = True\n+    field_str: str = \"default_value\"\n+    field_int: int = 42\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/json\")\n+async def json_endpoint(model: ModelWithDefaults):\n+    return {\n+        \"fields_set\": list(model.model_fields_set),\n+        \"field_bool\": model.field_bool,\n+        \"field_str\": model.field_str,\n+        \"field_int\": model.field_int,\n+    }\n+\n+\n+@app.post(\"/form\")\n+async def form_endpoint(model: Annotated[ModelWithDefaults, Form()]):\n+    return {\n+        \"fields_set\": list(model.model_fields_set),\n+        \"field_bool\": model.field_bool,\n+        \"field_str\": model.field_str,\n+        \"field_int\": model.field_int,\n+    }\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_empty_preserves_fields_set():\n+    \"\"\"JSON with empty dict should have empty fields_set\"\"\"\n+    response = client.post(\"/json\", json={})\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data[\"fields_set\"] == []\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"default_value\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def test_json_partial_preserves_fields_set():\n+    \"\"\"JSON with partial data should only set provided fields\"\"\"\n+    response = client.post(\"/json\", json={\"field_str\": \"custom\"})\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data[\"fields_set\"] == [\"field_str\"]\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"custom\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def test_json_all_fields_preserves_fields_set():\n+    \"\"\"JSON with all fields should mark all as set\"\"\"\n+    response = client.post(\n+        \"/json\",\n+        json={\"field_bool\": False, \"field_str\": \"custom\", \"field_int\": 100},\n+    )\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert set(data[\"fields_set\"]) == {\"field_bool\", \"field_str\", \"field_int\"}\n+    assert data[\"field_bool\"] is False\n+    assert data[\"field_str\"] == \"custom\"\n+    assert data[\"field_int\"] == 100\n+\n+\n+def test_form_empty_preserves_fields_set():\n+    \"\"\"Form with empty data should have empty fields_set (matching JSON behavior)\"\"\"\n+    response = client.post(\"/form\", data={})\n+    assert response.status_code == 200\n+    data = response.json()\n+    # This is the key fix: Form should behave like JSON\n+    assert data[\"fields_set\"] == []\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"default_value\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def t\n\n```\n\n```diff\n@@ -99,13 +99,13 @@ def test_no_data():\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"username\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n             {\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"lastname\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n       ", "output": "Bug: Fix #13399: Form dependency models preserve model_fields_set correctly\n\n## Summary\nFixes Form-based dependency models losing `model_fields_set` metadata when default values are not explicitly provided, making Form parameter handling consistent with JSON body parameters.\n\n## Problem\nIssue #13399 reported that Form-based dependency models were pre-filling default values during parsing, causing `model_fields_set` to include all fields with defaults even when they weren't provided in the request. This made it impossible to use `model_fields_set`, `model_dump(exclude_unset=True)`, or `model_dump(exclude_defaults=True)` correctly with Form models.\n\n## Example\n**Before this fix:**\n```python\nclass ExampleModel(BaseModel):\n    field_1: bool = True\n\n@app.post(\"/form\")\nasync def form_endpoint(model: Annotated[ExampleModel, Form()]):\n    return {\"fields_set\": list(model.model_fields_set)}\n\n# POST /form with empty data {}\n# Response: {\"fields_set\": [\"field_1\"]}  # Wrong! field_1 wasn't provided\n```\n\n**After this fix:**\n```python\n# POST /form with empty data {}\n# Response: {\"fields_set\": []}  # Correct! Matches JSON behavior\n```\n\n## Root Cause\nIn `fastapi/dependencies/utils.py`, the `_get_multidict_value()` function was returning `deepcopy(field.default)` when a form field wasn't provided and had a default value. This pre-filled default was then treated as explicitly set by Pydantic.\n\n## Solution\nChanged `_get_multidict_value()` to return `None` instead of the default value when a field is not provided. This allows Pydantic to handle defaults during validation, preserving `model_fields_set` correctly.\n\n## Testing\n- Added comprehensive test suite in `tests/test_form_model_fields_set.py`\n- Tests verify Form and JSON body parameters now have identical `model_fields_set` behavior\n- All existing tests continue to pass\n\n## Impact\n- Makes Form and JSON body parameter handling consistent\n- Enables proper use of `exclude_unset` and `exclude_defaults` with Form models\n- Allows developers to distinguish between explicitly provided values and defaults\n\nCloses #13399", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 269}
{"instruction": "Review the following code changes: Fix #13399: Form dependency models preserve model_fields_set correctly", "input": "```diff\n@@ -745,10 +745,9 @@ def _get_multidict_value(\n             and len(value) == 0\n         )\n     ):\n-        if field.field_info.is_required():\n-            return\n-        else:\n-            return deepcopy(field.default)\n+        # Don't pre-fill defaults here - let Pydantic handle them during validation\n+        # This preserves model_fields_set correctly for Form fields\n+        return None\n     return value\n \n \n\n```\n\n```diff\n@@ -0,0 +1,119 @@\n+\"\"\"\n+Test that Form-based dependency models preserve model_fields_set correctly.\n+\n+This test addresses issue https://github.com/fastapi/fastapi/issues/13399\n+where Form models were pre-filling default values, making it impossible\n+to distinguish between explicitly set fields and fields using defaults.\n+\"\"\"\n+\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class ModelWithDefaults(BaseModel):\n+    field_bool: bool = True\n+    field_str: str = \"default_value\"\n+    field_int: int = 42\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/json\")\n+async def json_endpoint(model: ModelWithDefaults):\n+    return {\n+        \"fields_set\": list(model.model_fields_set),\n+        \"field_bool\": model.field_bool,\n+        \"field_str\": model.field_str,\n+        \"field_int\": model.field_int,\n+    }\n+\n+\n+@app.post(\"/form\")\n+async def form_endpoint(model: Annotated[ModelWithDefaults, Form()]):\n+    return {\n+        \"fields_set\": list(model.model_fields_set),\n+        \"field_bool\": model.field_bool,\n+        \"field_str\": model.field_str,\n+        \"field_int\": model.field_int,\n+    }\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_json_empty_preserves_fields_set():\n+    \"\"\"JSON with empty dict should have empty fields_set\"\"\"\n+    response = client.post(\"/json\", json={})\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data[\"fields_set\"] == []\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"default_value\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def test_json_partial_preserves_fields_set():\n+    \"\"\"JSON with partial data should only set provided fields\"\"\"\n+    response = client.post(\"/json\", json={\"field_str\": \"custom\"})\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert data[\"fields_set\"] == [\"field_str\"]\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"custom\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def test_json_all_fields_preserves_fields_set():\n+    \"\"\"JSON with all fields should mark all as set\"\"\"\n+    response = client.post(\n+        \"/json\",\n+        json={\"field_bool\": False, \"field_str\": \"custom\", \"field_int\": 100},\n+    )\n+    assert response.status_code == 200\n+    data = response.json()\n+    assert set(data[\"fields_set\"]) == {\"field_bool\", \"field_str\", \"field_int\"}\n+    assert data[\"field_bool\"] is False\n+    assert data[\"field_str\"] == \"custom\"\n+    assert data[\"field_int\"] == 100\n+\n+\n+def test_form_empty_preserves_fields_set():\n+    \"\"\"Form with empty data should have empty fields_set (matching JSON behavior)\"\"\"\n+    response = client.post(\"/form\", data={})\n+    assert response.status_code == 200\n+    data = response.json()\n+    # This is the key fix: Form should behave like JSON\n+    assert data[\"fields_set\"] == []\n+    assert data[\"field_bool\"] is True\n+    assert data[\"field_str\"] == \"default_value\"\n+    assert data[\"field_int\"] == 42\n+\n+\n+def t\n\n```\n\n```diff\n@@ -99,13 +99,13 @@ def test_no_data():\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"username\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n             {\n                 \"type\": \"missing\",\n                 \"loc\": [\"body\", \"lastname\"],\n                 \"msg\": \"Field required\",\n-                \"input\": {\"tags\": [\"foo\", \"bar\"], \"with\": \"nothing\"},\n+                \"input\": {},\n             },\n         ]\n     }\n\n```\n\n```diff\n@@ -67,7 +67,6 @@ def test_header_param_model_invalid(client: TestClient):\n                     \"loc\": [\"header\", \"save_data\"],\n                     \"msg\": \"Field required\",\n                     \"input\": {\n-                        \"x_tag\": [],\n                         \"host\": \"testserver\",\n                         \"accept\": \"*/*\",\n                         \"accept-encoding\": \"gzip, deflate\",\n\n```\n\n```diff\n@@ -67,7 +67,7 @@ def test_header_param_model_invalid(client: TestClient):\n                     \"type\": \"missing\",\n                     \"loc\": [\"header\", \"save_data\"],\n                     \"msg\": \"Field required\",\n-                    \"input\": {\"x_tag\": [], \"host\": \"testserver\"},\n+                    \"input\": {\"host\": \"testserver\"},\n                 }\n             ]\n         }\n\n```", "output": "Changes look good. This PR implements: Fix #13399: Form dependency models preserve model_fields_set correctly", "source": "pr", "type": "code_review", "pr_number": 269}
{"instruction": "Fix the following bug: Fix #13175: Generate unique operation IDs for routes with multiple methods", "input": "## Summary\nFixes #13175 by ensuring routes with multiple HTTP methods generate unique operation IDs for each method in the OpenAPI schema.\n\n## Problem\nWhen using `add_api_route()` or `@api_route()` with multiple methods (e.g., `methods=[\"POST\", \"DELETE\"]`), all methods shared the same operation ID, causing \"Duplicate Operation ID\" warnings.\n\nExample that triggered the warning:\n```python\nrouter.add_api_route(\"/clear\", clear, methods=[\"POST\", \"DELETE\"])\n# Warning: Duplicate Operation ID clear_clear_post\n```\n\n## Solution\nModified `get_openapi_operation_metadata()` in `fastapi/openapi/utils.py`:\n- When a route has multiple methods and no explicit `operation_id`\n- Append the actual HTTP method to the base operation ID\n- Ensures each method gets a unique operation ID: `clear_clear_post`, `clear_clear_delete`\n- Maintains backward compatibility for single-method routes and explicit operation IDs\n\n## Test Plan\nAdded comprehensive test suite in `tests/test_duplicate_operation_id.py`:\n- ‚úÖ No duplicate warnings for multi-method routes\n- ‚úÖ Operation IDs are unique for each method\n- ‚úÖ Multiple routes with multiple methods all get unique IDs\n- ‚úÖ Single-method routes unchanged (backward compatibility)\n- ‚úÖ Direct `add_api_route()` usage works correctly\n\nAll tests pass:\n- New tests: 4/4 passed\n- Existing OpenAPI tests: all passed\n- Application tests: all passed\n\nGenerated with [Claude Code](https://claude.com/claude-code)", "output": "```diff\n@@ -244,6 +244,15 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    # If the route has multiple methods and operation_id was not explicitly set,\n+    # append the method to make each operation ID unique\n+    if not route.operation_id and route.methods and len(route.methods) > 1:\n+        # unique_id already includes a method suffix, so we need to replace it\n+        # with the actual method being processed\n+        # unique_id format: \"{name}_{path}_{first_method}\"\n+        # We need to replace the last method suffix with the current method\n+        base_id = operation_id.rsplit(\"_\", 1)[0]\n+        operation_id = f\"{base_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -0,0 +1,186 @@\n+\"\"\"\n+Test that routes with multiple methods get unique operation IDs.\n+Related to issue #13175\n+\"\"\"\n+\n+import warnings\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_multiple_methods_unique_operation_ids():\n+    \"\"\"Test that a route with multiple methods generates unique operation IDs\"\"\"\n+    app = FastAPI()\n+\n+    @app.api_route(\"/clear\", methods=[\"POST\", \"DELETE\"])\n+    def clear():\n+        return {\"message\": \"cleared\"}\n+\n+    client = TestClient(app)\n+\n+    # Test that the endpoints work\n+    response = client.post(\"/clear\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"cleared\"}\n+\n+    response = client.delete(\"/clear\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"cleared\"}\n+\n+    # Capture warnings\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        # Get OpenAPI schema which triggers operation ID generation\n+        openapi_schema = app.openapi()\n+\n+        # Check that no duplicate operation ID warning was raised\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings) == 0, (\n+            f\"Found {len(duplicate_warnings)} duplicate operation ID warnings: \"\n+            f\"{[str(w.message) for w in duplicate_warnings]}\"\n+        )\n+\n+    # Verify both methods are in the schema with different operation IDs\n+    assert \"/clear\" in openapi_schema[\"paths\"]\n+    clear_path = openapi_schema[\"paths\"][\"/clear\"]\n+\n+    # Both POST and DELETE should be present\n+    assert \"post\" in clear_path\n+    assert \"delete\" in clear_path\n+\n+    # Operation IDs should be different\n+    post_op_id = clear_path[\"post\"][\"operationId\"]\n+    delete_op_id = clear_path[\"delete\"][\"operationId\"]\n+\n+    assert post_op_id != delete_op_id, (\n+        f\"Operation IDs should be different: POST={post_op_id}, DELETE={delete_op_id}\"\n+    )\n+\n+\n+def test_multiple_routes_with_multiple_methods():\n+    \"\"\"Test multiple routes each with multiple methods\"\"\"\n+    app = FastAPI()\n+\n+    @app.api_route(\"/clear\", methods=[\"POST\", \"DELETE\"])\n+    def clear():\n+        return {\"message\": \"cleared\"}\n+\n+    @app.api_route(\"/reset\", methods=[\"POST\", \"PUT\"])\n+    def reset():\n+        return {\"message\": \"reset\"}\n+\n+    client = TestClient(app)\n+\n+    # Test that all endpoints work\n+    assert client.post(\"/clear\").status_code == 200\n+    assert client.delete(\"/clear\").status_code == 200\n+    assert client.post(\"/reset\").status_code == 200\n+    assert client.put(\"/reset\").status_code == 200\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+        openapi_schema = app.openapi()\n+\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 268}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -244,6 +244,15 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    # If the route has multiple methods and operation_id was not explicitly set,\n+    # append the method to make each operation ID unique\n+    if not route.operation_id and route.methods and len(route.methods) > 1:\n+        # unique_id already includes a method suffix, so we need to replace it\n+        # with the actual method being processed\n+        # unique_id format: \"{name}_{path}_{first_method}\"\n+        # We need to replace the last method suffix with the current method\n+        base_id = operation_id.rsplit(\"_\", 1)[0]\n+        operation_id = f\"{base_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -0,0 +1,186 @@\n+\"\"\"\n+Test that routes with multiple methods get unique operation IDs.\n+Related to issue #13175\n+\"\"\"\n+\n+import warnings\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_multiple_methods_unique_operation_ids():\n+    \"\"\"Test that a route with multiple methods generates unique operation IDs\"\"\"\n+    app = FastAPI()\n+\n+    @app.api_route(\"/clear\", methods=[\"POST\", \"DELETE\"])\n+    def clear():\n+        return {\"message\": \"cleared\"}\n+\n+    client = TestClient(app)\n+\n+    # Test that the endpoints work\n+    response = client.post(\"/clear\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"cleared\"}\n+\n+    response = client.delete(\"/clear\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"cleared\"}\n+\n+    # Capture warnings\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        # Get OpenAPI schema which triggers operation ID generation\n+        openapi_schema = app.openapi()\n+\n+        # Check that no duplicate operation ID warning was raised\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings) == 0, (\n+            f\"Found {len(duplicate_warnings)} duplicate operation ID warnings: \"\n+            f\"{[str(w.message) for w in duplicate_warnings]}\"\n+        )\n+\n+    # Verify both methods are in the schema with different operation IDs\n+    assert \"/clear\" in openapi_schema[\"paths\"]\n+    clear_path = openapi_schema[\"paths\"][\"/clear\"]\n+\n+    # Both POST and DELETE should be present\n+    assert \"post\" in clear_path\n+    assert \"delete\" in clear_path\n+\n+    # Operation IDs should be different\n+    post_op_id = clear_path[\"post\"][\"operationId\"]\n+    delete_op_id = clear_path[\"delete\"][\"operationId\"]\n+\n+    assert post_op_id != delete_op_id, (\n+        f\"Operation IDs should be different: POST={post_op_id}, DELETE={delete_op_id}\"\n+    )\n+\n+\n+def test_multiple_routes_with_multiple_methods():\n+    \"\"\"Test multiple routes each with multiple methods\"\"\"\n+    app = FastAPI()\n+\n+    @app.api_route(\"/clear\", methods=[\"POST\", \"DELETE\"])\n+    def clear():\n+        return {\"message\": \"cleared\"}\n+\n+    @app.api_route(\"/reset\", methods=[\"POST\", \"PUT\"])\n+    def reset():\n+        return {\"message\": \"reset\"}\n+\n+    client = TestClient(app)\n+\n+    # Test that all endpoints work\n+    assert client.post(\"/clear\").status_code == 200\n+    assert client.delete(\"/clear\").status_code == 200\n+    assert client.post(\"/reset\").status_code == 200\n+    assert client.put(\"/reset\").status_code == 200\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+        openapi_schema = app.openapi()\n+\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings\n\n```", "output": "Bug: Fix #13175: Generate unique operation IDs for routes with multiple methods\n\n## Summary\nFixes #13175 by ensuring routes with multiple HTTP methods generate unique operation IDs for each method in the OpenAPI schema.\n\n## Problem\nWhen using `add_api_route()` or `@api_route()` with multiple methods (e.g., `methods=[\"POST\", \"DELETE\"]`), all methods shared the same operation ID, causing \"Duplicate Operation ID\" warnings.\n\nExample that triggered the warning:\n```python\nrouter.add_api_route(\"/clear\", clear, methods=[\"POST\", \"DELETE\"])\n# Warning: Duplicate Operation ID clear_clear_post\n```\n\n## Solution\nModified `get_openapi_operation_metadata()` in `fastapi/openapi/utils.py`:\n- When a route has multiple methods and no explicit `operation_id`\n- Append the actual HTTP method to the base operation ID\n- Ensures each method gets a unique operation ID: `clear_clear_post`, `clear_clear_delete`\n- Maintains backward compatibility for single-method routes and explicit operation IDs\n\n## Test Plan\nAdded comprehensive test suite in `tests/test_duplicate_operation_id.py`:\n- ‚úÖ No duplicate warnings for multi-method routes\n- ‚úÖ Operation IDs are unique for each method\n- ‚úÖ Multiple routes with multiple methods all get unique IDs\n- ‚úÖ Single-method routes unchanged (backward compatibility)\n- ‚úÖ Direct `add_api_route()` usage works correctly\n\nAll tests pass:\n- New tests: 4/4 passed\n- Existing OpenAPI tests: all passed\n- Application tests: all passed\n\nGenerated with [Claude Code](https://claude.com/claude-code)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 268}
{"instruction": "Review the following code changes: Fix #13175: Generate unique operation IDs for routes with multiple methods", "input": "```diff\n@@ -244,6 +244,15 @@ def get_openapi_operation_metadata(\n     if route.description:\n         operation[\"description\"] = route.description\n     operation_id = route.operation_id or route.unique_id\n+    # If the route has multiple methods and operation_id was not explicitly set,\n+    # append the method to make each operation ID unique\n+    if not route.operation_id and route.methods and len(route.methods) > 1:\n+        # unique_id already includes a method suffix, so we need to replace it\n+        # with the actual method being processed\n+        # unique_id format: \"{name}_{path}_{first_method}\"\n+        # We need to replace the last method suffix with the current method\n+        base_id = operation_id.rsplit(\"_\", 1)[0]\n+        operation_id = f\"{base_id}_{method.lower()}\"\n     if operation_id in operation_ids:\n         message = (\n             f\"Duplicate Operation ID {operation_id} for function \"\n\n```\n\n```diff\n@@ -0,0 +1,186 @@\n+\"\"\"\n+Test that routes with multiple methods get unique operation IDs.\n+Related to issue #13175\n+\"\"\"\n+\n+import warnings\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+\n+\n+def test_multiple_methods_unique_operation_ids():\n+    \"\"\"Test that a route with multiple methods generates unique operation IDs\"\"\"\n+    app = FastAPI()\n+\n+    @app.api_route(\"/clear\", methods=[\"POST\", \"DELETE\"])\n+    def clear():\n+        return {\"message\": \"cleared\"}\n+\n+    client = TestClient(app)\n+\n+    # Test that the endpoints work\n+    response = client.post(\"/clear\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"cleared\"}\n+\n+    response = client.delete(\"/clear\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"message\": \"cleared\"}\n+\n+    # Capture warnings\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+\n+        # Get OpenAPI schema which triggers operation ID generation\n+        openapi_schema = app.openapi()\n+\n+        # Check that no duplicate operation ID warning was raised\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings) == 0, (\n+            f\"Found {len(duplicate_warnings)} duplicate operation ID warnings: \"\n+            f\"{[str(w.message) for w in duplicate_warnings]}\"\n+        )\n+\n+    # Verify both methods are in the schema with different operation IDs\n+    assert \"/clear\" in openapi_schema[\"paths\"]\n+    clear_path = openapi_schema[\"paths\"][\"/clear\"]\n+\n+    # Both POST and DELETE should be present\n+    assert \"post\" in clear_path\n+    assert \"delete\" in clear_path\n+\n+    # Operation IDs should be different\n+    post_op_id = clear_path[\"post\"][\"operationId\"]\n+    delete_op_id = clear_path[\"delete\"][\"operationId\"]\n+\n+    assert post_op_id != delete_op_id, (\n+        f\"Operation IDs should be different: POST={post_op_id}, DELETE={delete_op_id}\"\n+    )\n+\n+\n+def test_multiple_routes_with_multiple_methods():\n+    \"\"\"Test multiple routes each with multiple methods\"\"\"\n+    app = FastAPI()\n+\n+    @app.api_route(\"/clear\", methods=[\"POST\", \"DELETE\"])\n+    def clear():\n+        return {\"message\": \"cleared\"}\n+\n+    @app.api_route(\"/reset\", methods=[\"POST\", \"PUT\"])\n+    def reset():\n+        return {\"message\": \"reset\"}\n+\n+    client = TestClient(app)\n+\n+    # Test that all endpoints work\n+    assert client.post(\"/clear\").status_code == 200\n+    assert client.delete(\"/clear\").status_code == 200\n+    assert client.post(\"/reset\").status_code == 200\n+    assert client.put(\"/reset\").status_code == 200\n+\n+    with warnings.catch_warnings(record=True) as w:\n+        warnings.simplefilter(\"always\")\n+        openapi_schema = app.openapi()\n+\n+        duplicate_warnings = [\n+            warning for warning in w if \"Duplicate Operation ID\" in str(warning.message)\n+        ]\n+        assert len(duplicate_warnings\n\n```", "output": "Changes look good. This PR implements: Fix #13175: Generate unique operation IDs for routes with multiple methods", "source": "pr", "type": "code_review", "pr_number": 268}
{"instruction": "Fix the following bug: Fix issue #13056: Handle ForwardRef in Annotated types", "input": "## Summary\n\nFixes issue #13056: Annotated types with ForwardRef cause errors when used as FastAPI parameters.\n\nThe problem was that when using `Annotated['ModelName', Query()]` syntax with a forward reference string, FastAPI would fail with a Pydantic error stating the type was not fully defined.\n\n## Root Cause\n\nThe `analyze_param()` function extracted the type from `Annotated` but did not resolve `ForwardRef` objects before passing them to Pydantic. When Pydantic tried to validate the type, it couldn't resolve the forward reference and failed.\n\n## Solution\n\nModified the parameter analysis logic to:\n1. Resolve `ForwardRef` when extracting from `Annotated` types\n2. Pass the function's global namespace to enable proper forward reference resolution\n3. Reconstruct the `Annotated` type with the resolved type instead of the unresolved ForwardRef\n\n## Test Coverage\n\nAdded comprehensive tests covering:\n- Query parameters with ForwardRef\n- Path parameters with ForwardRef  \n- Header parameters with ForwardRef\n- Request body with ForwardRef\n- Optional types with ForwardRef\n- Multiple annotations with ForwardRef\n- OpenAPI schema generation with ForwardRef types\n\nAll existing tests pass with no breaking changes.\n\n## Files Changed\n\n- `fastapi/dependencies/utils.py`: Modified `analyze_param()` and `get_dependant()` to handle ForwardRef resolution\n- `tests/test_annotated_forwardref.py`: Added 11 comprehensive tests for ForwardRef support", "output": "```diff\n@@ -278,13 +278,16 @@ def get_dependant(\n     path_param_names = get_path_param_names(path)\n     endpoint_signature = get_typed_signature(call)\n     signature_params = endpoint_signature.parameters\n+    unwrapped = inspect.unwrap(call)\n+    globalns = getattr(unwrapped, \"__globals__\", {})\n     for param_name, param in signature_params.items():\n         is_path_param = param_name in path_param_names\n         param_details = analyze_param(\n             param_name=param_name,\n             annotation=param.annotation,\n             value=param.default,\n             is_path_param=is_path_param,\n+            globalns=globalns,\n         )\n         if param_details.depends is not None:\n             assert param_details.depends.dependency\n@@ -367,6 +370,7 @@ def analyze_param(\n     annotation: Any,\n     value: Any,\n     is_path_param: bool,\n+    globalns: Optional[dict[str, Any]] = None,\n ) -> ParamDetails:\n     field_info = None\n     depends = None\n@@ -382,6 +386,17 @@ def analyze_param(\n     if get_origin(use_annotation) is Annotated:\n         annotated_args = get_args(annotation)\n         type_annotation = annotated_args[0]\n+        # Resolve ForwardRef if present in the extracted type annotation\n+        if isinstance(type_annotation, ForwardRef) and globalns is not None:\n+            try:\n+                resolved_type = evaluate_forwardref(type_annotation, globalns, globalns)\n+                type_annotation = resolved_type\n+                # Reconstruct Annotated with resolved type for use_annotation\n+                use_annotation = Annotated[resolved_type, *annotated_args[1:]]\n+            except (NameError, AttributeError):\n+                # If resolution fails, keep the ForwardRef as-is\n+                # Pydantic will attempt to resolve it with its own logic\n+                pass\n         fastapi_annotations = [\n             arg\n             for arg in annotated_args[1:]\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+\"\"\"\n+Tests for Annotated types with ForwardRef support.\n+Tests for issue #13056: Annotated types with ForwardRef cause errors.\n+\"\"\"\n+\n+from typing import Annotated, Optional\n+\n+import pytest\n+from fastapi import Body, FastAPI, Header, Path, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class UserModel(BaseModel):\n+    \"\"\"User model for testing ForwardRef.\"\"\"\n+\n+    name: str = \"test_user\"\n+    age: int = 25\n+\n+\n+class Item(BaseModel):\n+    \"\"\"Item model for testing ForwardRef.\"\"\"\n+\n+    title: str = \"test_item\"\n+    description: Optional[str] = None\n+\n+\n+def test_annotated_forwardref_query_param():\n+    \"\"\"Test Annotated with ForwardRef in query parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users\")\n+    async def get_user(user: Annotated[\"UserModel\", Query()]):\n+        return {\"user\": user}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users?name=John&age=30\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user\": {\"name\": \"John\", \"age\": 30}}\n+\n+\n+def test_annotated_forwardref_query_param_default():\n+    \"\"\"Test Annotated with ForwardRef in query parameter with default.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users-default\")\n+    async def get_user_default(user: Annotated[\"UserModel\", Query()] = UserModel()):\n+        return {\"user\": user}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users-default\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user\": {\"name\": \"test_user\", \"age\": 25}}\n+\n+\n+def test_annotated_forwardref_optional():\n+    \"\"\"Test Annotated with ForwardRef in Optional parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/items\")\n+    async def get_item(item: Annotated[Optional[\"Item\"], Query()] = None):\n+        return {\"item\": item}\n+\n+    client = TestClient(app)\n+\n+    # Test with no parameter\n+    response = client.get(\"/items\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"item\": None}\n+\n+\n+def test_annotated_forwardref_path_param():\n+    \"\"\"Test Annotated with ForwardRef in path parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users/{user_id}\")\n+    async def get_user_by_id(user_id: Annotated[\"int\", Path()]):\n+        return {\"user_id\": user_id}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users/123\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user_id\": 123}\n+\n+\n+def test_annotated_forwardref_header():\n+    \"\"\"Test Annotated with ForwardRef in header parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/headers\")\n+    async def get_headers(x_token: Annotated[\"str\", Header()]):\n+        return {\"x_token\": x_token}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/headers\", headers={\"x-token\": \"test-token\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"x_token\": \"test-token\"}\n+\n+\n+def test_annotated_forwardref_body():\n+    \"\"\"Test Annotated with ForwardRef in request b\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 267}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -278,13 +278,16 @@ def get_dependant(\n     path_param_names = get_path_param_names(path)\n     endpoint_signature = get_typed_signature(call)\n     signature_params = endpoint_signature.parameters\n+    unwrapped = inspect.unwrap(call)\n+    globalns = getattr(unwrapped, \"__globals__\", {})\n     for param_name, param in signature_params.items():\n         is_path_param = param_name in path_param_names\n         param_details = analyze_param(\n             param_name=param_name,\n             annotation=param.annotation,\n             value=param.default,\n             is_path_param=is_path_param,\n+            globalns=globalns,\n         )\n         if param_details.depends is not None:\n             assert param_details.depends.dependency\n@@ -367,6 +370,7 @@ def analyze_param(\n     annotation: Any,\n     value: Any,\n     is_path_param: bool,\n+    globalns: Optional[dict[str, Any]] = None,\n ) -> ParamDetails:\n     field_info = None\n     depends = None\n@@ -382,6 +386,17 @@ def analyze_param(\n     if get_origin(use_annotation) is Annotated:\n         annotated_args = get_args(annotation)\n         type_annotation = annotated_args[0]\n+        # Resolve ForwardRef if present in the extracted type annotation\n+        if isinstance(type_annotation, ForwardRef) and globalns is not None:\n+            try:\n+                resolved_type = evaluate_forwardref(type_annotation, globalns, globalns)\n+                type_annotation = resolved_type\n+                # Reconstruct Annotated with resolved type for use_annotation\n+                use_annotation = Annotated[resolved_type, *annotated_args[1:]]\n+            except (NameError, AttributeError):\n+                # If resolution fails, keep the ForwardRef as-is\n+                # Pydantic will attempt to resolve it with its own logic\n+                pass\n         fastapi_annotations = [\n             arg\n             for arg in annotated_args[1:]\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+\"\"\"\n+Tests for Annotated types with ForwardRef support.\n+Tests for issue #13056: Annotated types with ForwardRef cause errors.\n+\"\"\"\n+\n+from typing import Annotated, Optional\n+\n+import pytest\n+from fastapi import Body, FastAPI, Header, Path, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class UserModel(BaseModel):\n+    \"\"\"User model for testing ForwardRef.\"\"\"\n+\n+    name: str = \"test_user\"\n+    age: int = 25\n+\n+\n+class Item(BaseModel):\n+    \"\"\"Item model for testing ForwardRef.\"\"\"\n+\n+    title: str = \"test_item\"\n+    description: Optional[str] = None\n+\n+\n+def test_annotated_forwardref_query_param():\n+    \"\"\"Test Annotated with ForwardRef in query parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users\")\n+    async def get_user(user: Annotated[\"UserModel\", Query()]):\n+        return {\"user\": user}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users?name=John&age=30\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user\": {\"name\": \"John\", \"age\": 30}}\n+\n+\n+def test_annotated_forwardref_query_param_default():\n+    \"\"\"Test Annotated with ForwardRef in query parameter with default.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users-default\")\n+    async def get_user_default(user: Annotated[\"UserModel\", Query()] = UserModel()):\n+        return {\"user\": user}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users-default\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user\": {\"name\": \"test_user\", \"age\": 25}}\n+\n+\n+def test_annotated_forwardref_optional():\n+    \"\"\"Test Annotated with ForwardRef in Optional parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/items\")\n+    async def get_item(item: Annotated[Optional[\"Item\"], Query()] = None):\n+        return {\"item\": item}\n+\n+    client = TestClient(app)\n+\n+    # Test with no parameter\n+    response = client.get(\"/items\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"item\": None}\n+\n+\n+def test_annotated_forwardref_path_param():\n+    \"\"\"T", "output": "Bug: Fix issue #13056: Handle ForwardRef in Annotated types\n\n## Summary\n\nFixes issue #13056: Annotated types with ForwardRef cause errors when used as FastAPI parameters.\n\nThe problem was that when using `Annotated['ModelName', Query()]` syntax with a forward reference string, FastAPI would fail with a Pydantic error stating the type was not fully defined.\n\n## Root Cause\n\nThe `analyze_param()` function extracted the type from `Annotated` but did not resolve `ForwardRef` objects before passing them to Pydantic. When Pydantic tried to validate the type, it couldn't resolve the forward reference and failed.\n\n## Solution\n\nModified the parameter analysis logic to:\n1. Resolve `ForwardRef` when extracting from `Annotated` types\n2. Pass the function's global namespace to enable proper forward reference resolution\n3. Reconstruct the `Annotated` type with the resolved type instead of the unresolved ForwardRef\n\n## Test Coverage\n\nAdded comprehensive tests covering:\n- Query parameters with ForwardRef\n- Path parameters with ForwardRef  \n- Header parameters with ForwardRef\n- Request body with ForwardRef\n- Optional types with ForwardRef\n- Multiple annotations with ForwardRef\n- OpenAPI schema generation with ForwardRef types\n\nAll existing tests pass with no breaking changes.\n\n## Files Changed\n\n- `fastapi/dependencies/utils.py`: Modified `analyze_param()` and `get_dependant()` to handle ForwardRef resolution\n- `tests/test_annotated_forwardref.py`: Added 11 comprehensive tests for ForwardRef support", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 267}
{"instruction": "Review the following code changes: Fix issue #13056: Handle ForwardRef in Annotated types", "input": "```diff\n@@ -278,13 +278,16 @@ def get_dependant(\n     path_param_names = get_path_param_names(path)\n     endpoint_signature = get_typed_signature(call)\n     signature_params = endpoint_signature.parameters\n+    unwrapped = inspect.unwrap(call)\n+    globalns = getattr(unwrapped, \"__globals__\", {})\n     for param_name, param in signature_params.items():\n         is_path_param = param_name in path_param_names\n         param_details = analyze_param(\n             param_name=param_name,\n             annotation=param.annotation,\n             value=param.default,\n             is_path_param=is_path_param,\n+            globalns=globalns,\n         )\n         if param_details.depends is not None:\n             assert param_details.depends.dependency\n@@ -367,6 +370,7 @@ def analyze_param(\n     annotation: Any,\n     value: Any,\n     is_path_param: bool,\n+    globalns: Optional[dict[str, Any]] = None,\n ) -> ParamDetails:\n     field_info = None\n     depends = None\n@@ -382,6 +386,17 @@ def analyze_param(\n     if get_origin(use_annotation) is Annotated:\n         annotated_args = get_args(annotation)\n         type_annotation = annotated_args[0]\n+        # Resolve ForwardRef if present in the extracted type annotation\n+        if isinstance(type_annotation, ForwardRef) and globalns is not None:\n+            try:\n+                resolved_type = evaluate_forwardref(type_annotation, globalns, globalns)\n+                type_annotation = resolved_type\n+                # Reconstruct Annotated with resolved type for use_annotation\n+                use_annotation = Annotated[resolved_type, *annotated_args[1:]]\n+            except (NameError, AttributeError):\n+                # If resolution fails, keep the ForwardRef as-is\n+                # Pydantic will attempt to resolve it with its own logic\n+                pass\n         fastapi_annotations = [\n             arg\n             for arg in annotated_args[1:]\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+\"\"\"\n+Tests for Annotated types with ForwardRef support.\n+Tests for issue #13056: Annotated types with ForwardRef cause errors.\n+\"\"\"\n+\n+from typing import Annotated, Optional\n+\n+import pytest\n+from fastapi import Body, FastAPI, Header, Path, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+class UserModel(BaseModel):\n+    \"\"\"User model for testing ForwardRef.\"\"\"\n+\n+    name: str = \"test_user\"\n+    age: int = 25\n+\n+\n+class Item(BaseModel):\n+    \"\"\"Item model for testing ForwardRef.\"\"\"\n+\n+    title: str = \"test_item\"\n+    description: Optional[str] = None\n+\n+\n+def test_annotated_forwardref_query_param():\n+    \"\"\"Test Annotated with ForwardRef in query parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users\")\n+    async def get_user(user: Annotated[\"UserModel\", Query()]):\n+        return {\"user\": user}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users?name=John&age=30\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user\": {\"name\": \"John\", \"age\": 30}}\n+\n+\n+def test_annotated_forwardref_query_param_default():\n+    \"\"\"Test Annotated with ForwardRef in query parameter with default.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users-default\")\n+    async def get_user_default(user: Annotated[\"UserModel\", Query()] = UserModel()):\n+        return {\"user\": user}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users-default\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user\": {\"name\": \"test_user\", \"age\": 25}}\n+\n+\n+def test_annotated_forwardref_optional():\n+    \"\"\"Test Annotated with ForwardRef in Optional parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/items\")\n+    async def get_item(item: Annotated[Optional[\"Item\"], Query()] = None):\n+        return {\"item\": item}\n+\n+    client = TestClient(app)\n+\n+    # Test with no parameter\n+    response = client.get(\"/items\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"item\": None}\n+\n+\n+def test_annotated_forwardref_path_param():\n+    \"\"\"Test Annotated with ForwardRef in path parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/users/{user_id}\")\n+    async def get_user_by_id(user_id: Annotated[\"int\", Path()]):\n+        return {\"user_id\": user_id}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/users/123\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"user_id\": 123}\n+\n+\n+def test_annotated_forwardref_header():\n+    \"\"\"Test Annotated with ForwardRef in header parameter.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/headers\")\n+    async def get_headers(x_token: Annotated[\"str\", Header()]):\n+        return {\"x_token\": x_token}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/headers\", headers={\"x-token\": \"test-token\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"x_token\": \"test-token\"}\n+\n+\n+def test_annotated_forwardref_body():\n+    \"\"\"Test Annotated with ForwardRef in request b\n\n```", "output": "Changes look good. This PR implements: Fix issue #13056: Handle ForwardRef in Annotated types", "source": "pr", "type": "code_review", "pr_number": 267}
{"instruction": "Fix the following bug: Fix typos in contributing and migration docs", "input": "Fix two small typos in the English documentation:\n\n- `docs/en/docs/how-to/migrate-from-pydantic-v1-to-pydantic-v2.md`: \"fist\" -> \"first\"\n- `docs/en/docs/contributing.md`: \"that scripts does\" -> \"that the script does\"", "output": "```diff\n@@ -92,7 +92,7 @@ That way, you can edit the documentation/source files and see the changes live.\n \n /// tip\n \n-Alternatively, you can perform the same steps that scripts does manually.\n+Alternatively, you can perform the same steps that the script does manually.\n \n Go into the language directory, for the main docs in English it's at `docs/en/`:\n \n\n```\n\n```diff\n@@ -130,6 +130,6 @@ First try with `bump-pydantic`, if your tests pass and that works, then you're d\n \n If `bump-pydantic` doesn't work for your use case, you can use the support for both Pydantic v1 and v2 models in the same app to do the migration to Pydantic v2 gradually.\n \n-You could fist upgrade Pydantic to use the latest version 2, and change the imports to use `pydantic.v1` for all your models.\n+You could first upgrade Pydantic to use the latest version 2, and change the imports to use `pydantic.v1` for all your models.\n \n Then, you can start migrating your models from Pydantic v1 to v2 in groups, in gradual steps. üö∂\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 266}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -92,7 +92,7 @@ That way, you can edit the documentation/source files and see the changes live.\n \n /// tip\n \n-Alternatively, you can perform the same steps that scripts does manually.\n+Alternatively, you can perform the same steps that the script does manually.\n \n Go into the language directory, for the main docs in English it's at `docs/en/`:\n \n\n```\n\n```diff\n@@ -130,6 +130,6 @@ First try with `bump-pydantic`, if your tests pass and that works, then you're d\n \n If `bump-pydantic` doesn't work for your use case, you can use the support for both Pydantic v1 and v2 models in the same app to do the migration to Pydantic v2 gradually.\n \n-You could fist upgrade Pydantic to use the latest version 2, and change the imports to use `pydantic.v1` for all your models.\n+You could first upgrade Pydantic to use the latest version 2, and change the imports to use `pydantic.v1` for all your models.\n \n Then, you can start migrating your models from Pydantic v1 to v2 in groups, in gradual steps. üö∂\n\n```", "output": "Bug: Fix typos in contributing and migration docs\n\nFix two small typos in the English documentation:\n\n- `docs/en/docs/how-to/migrate-from-pydantic-v1-to-pydantic-v2.md`: \"fist\" -> \"first\"\n- `docs/en/docs/contributing.md`: \"that scripts does\" -> \"that the script does\"", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 266}
{"instruction": "Review the following code changes: Fix typos in contributing and migration docs", "input": "```diff\n@@ -92,7 +92,7 @@ That way, you can edit the documentation/source files and see the changes live.\n \n /// tip\n \n-Alternatively, you can perform the same steps that scripts does manually.\n+Alternatively, you can perform the same steps that the script does manually.\n \n Go into the language directory, for the main docs in English it's at `docs/en/`:\n \n\n```\n\n```diff\n@@ -130,6 +130,6 @@ First try with `bump-pydantic`, if your tests pass and that works, then you're d\n \n If `bump-pydantic` doesn't work for your use case, you can use the support for both Pydantic v1 and v2 models in the same app to do the migration to Pydantic v2 gradually.\n \n-You could fist upgrade Pydantic to use the latest version 2, and change the imports to use `pydantic.v1` for all your models.\n+You could first upgrade Pydantic to use the latest version 2, and change the imports to use `pydantic.v1` for all your models.\n \n Then, you can start migrating your models from Pydantic v1 to v2 in groups, in gradual steps. üö∂\n\n```", "output": "Changes look good. This PR implements: Fix typos in contributing and migration docs", "source": "pr", "type": "code_review", "pr_number": 266}
{"instruction": "Review the following code changes: üåê Update translations for zh (update-outdated)", "input": "```diff\n@@ -331,6 +331,8 @@ extra:\n     name: tr - T√ºrk√ße\n   - link: /uk/\n     name: uk - —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞\n+  - link: /zh/\n+    name: zh - ÁÆÄ‰Ωì‰∏≠Êñá\n   - link: /zh-hant/\n     name: zh-hant - ÁπÅÈ´î‰∏≠Êñá\n extra_css:\n\n```\n\n```diff\n@@ -1,44 +1,57 @@\n-# OPENAPI ‰∏≠ÁöÑÂÖ∂‰ªñÂìçÂ∫î\n+# OpenAPI ‰∏≠ÁöÑÈôÑÂä†ÂìçÂ∫î { #additional-responses-in-openapi }\n \n-ÊÇ®ÂèØ‰ª•Â£∞ÊòéÈôÑÂä†ÂìçÂ∫îÔºåÂåÖÊã¨ÈôÑÂä†Áä∂ÊÄÅ‰ª£Á†Å„ÄÅÂ™í‰ΩìÁ±ªÂûã„ÄÅÊèèËø∞Á≠â„ÄÇ\n+/// warning | Ë≠¶Âëä\n \n-Ëøô‰∫õÈ¢ùÂ§ñÁöÑÂìçÂ∫îÂ∞ÜÂåÖÂê´Âú®OpenAPIÊ®°Âºè‰∏≠ÔºåÂõ†Ê≠§ÂÆÉ‰ª¨‰πüÂ∞ÜÂá∫Áé∞Âú®APIÊñáÊ°£‰∏≠„ÄÇ\n+ËøôÊòØ‰∏Ä‰∏™Áõ∏ÂØπÈ´òÁ∫ßÁöÑËØùÈ¢ò„ÄÇ\n \n-‰ΩÜÊòØÂØπ‰∫éÈÇ£‰∫õÈ¢ùÂ§ñÁöÑÂìçÂ∫îÔºå‰Ω†ÂøÖÈ°ªÁ°Æ‰øù‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂÉè `JSONResponse` ‰∏ÄÊ†∑ÁöÑ `Response` ÔºåÂπ∂ÂåÖÂê´‰Ω†ÁöÑÁä∂ÊÄÅ‰ª£Á†ÅÂíåÂÜÖÂÆπ„ÄÇ\n+Â¶ÇÊûú‰Ω†ÂàöÂºÄÂßã‰ΩøÁî® **FastAPI**ÔºåÂèØËÉΩÊöÇÊó∂Áî®‰∏çÂà∞„ÄÇ\n \n-## `model`ÈôÑÂä†ÂìçÂ∫î\n-ÊÇ®ÂèØ‰ª•ÂêëË∑ØÂæÑÊìç‰ΩúË£ÖÈ•∞Âô®‰º†ÈÄíÂèÇÊï∞ `responses` „ÄÇ\n+///\n+\n+‰Ω†ÂèØ‰ª•Â£∞ÊòéÈôÑÂä†ÂìçÂ∫îÔºåÂåÖÊã¨È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å„ÄÅÂ™í‰ΩìÁ±ªÂûã„ÄÅÊèèËø∞Á≠â„ÄÇ\n+\n+Ëøô‰∫õÈôÑÂä†ÂìçÂ∫î‰ºöË¢´ÂåÖÂê´Âú® OpenAPI Ê®°Âºè‰∏≠ÔºåÂõ†Ê≠§ÂÆÉ‰ª¨‰πü‰ºöÂá∫Áé∞Âú® API ÊñáÊ°£‰∏≠„ÄÇ\n+\n+‰ΩÜÊòØÂØπ‰∫éËøô‰∫õÈôÑÂä†ÂìçÂ∫îÔºå‰Ω†ÂøÖÈ°ªÁ°Æ‰øùÁõ¥Êé•ËøîÂõû‰∏Ä‰∏™ `Response`Ôºà‰æãÂ¶Ç `JSONResponse`ÔºâÔºåÂπ∂Êê∫Â∏¶‰Ω†ÁöÑÁä∂ÊÄÅÁ†ÅÂíåÂÜÖÂÆπ„ÄÇ\n+\n+## Â∏¶Êúâ `model` ÁöÑÈôÑÂä†ÂìçÂ∫î { #additional-response-with-model }\n+\n+‰Ω†ÂèØ‰ª•Âêë‰Ω†ÁöÑ*Ë∑ØÂæÑÊìç‰ΩúË£ÖÈ•∞Âô®*‰º†ÂÖ•ÂèÇÊï∞ `responses`„ÄÇ\n+\n+ÂÆÉÊé•Êî∂‰∏Ä‰∏™ `dict`ÔºöÈîÆÊòØÊØè‰∏™ÂìçÂ∫îÁöÑÁä∂ÊÄÅÁ†ÅÔºà‰æãÂ¶Ç `200`ÔºâÔºåÂÄºÊòØÂåÖÂê´ËØ•ÂìçÂ∫î‰ø°ÊÅØÁöÑÂè¶‰∏Ä‰∏™ `dict`„ÄÇ\n \n-ÂÆÉÊé•Êî∂‰∏Ä‰∏™ `dict`ÔºåÈîÆÊòØÊØè‰∏™ÂìçÂ∫îÁöÑÁä∂ÊÄÅ‰ª£Á†ÅÔºàÂ¶Ç`200`ÔºâÔºåÂÄºÊòØÂåÖÂê´ÊØè‰∏™ÂìçÂ∫î‰ø°ÊÅØÁöÑÂÖ∂‰ªñ `dict`„ÄÇ\n+Ëøô‰∫õÂìçÂ∫îÁöÑÊØè‰∏™ `dict` ÈÉΩÂèØ‰ª•Êúâ‰∏Ä‰∏™ÈîÆ `model`ÔºåÂåÖÂê´‰∏Ä‰∏™ Pydantic Ê®°ÂûãÔºåÂ∞±ÂÉè `response_model` ‰∏ÄÊ†∑„ÄÇ\n \n-ÊØè‰∏™ÂìçÂ∫îÂ≠óÂÖ∏ÈÉΩÂèØ‰ª•Êúâ‰∏Ä‰∏™ÂÖ≥ÈîÆÊ®°ÂûãÔºåÂÖ∂‰∏≠ÂåÖÂê´‰∏Ä‰∏™ `Pydantic` Ê®°ÂûãÔºåÂ∞±ÂÉè `response_model` ‰∏ÄÊ†∑„ÄÇ\n+**FastAPI** ‰ºöËé∑ÂèñËØ•Ê®°ÂûãÔºåÁîüÊàêÂÆÉÁöÑ JSON SchemaÔºåÂπ∂Â∞ÜÂÖ∂ÊîæÂú® OpenAPI ‰∏≠ÁöÑÊ≠£Á°Æ‰ΩçÁΩÆ„ÄÇ\n \n-**FastAPI**Â∞ÜÈááÁî®ËØ•Ê®°ÂûãÔºåÁîüÊàêÂÖ∂`JSON Schema`Âπ∂Â∞ÜÂÖ∂ÂåÖÂê´Âú®`OpenAPI`‰∏≠ÁöÑÊ≠£Á°Æ‰ΩçÁΩÆ„ÄÇ\n+‰æãÂ¶ÇÔºåË¶ÅÂ£∞ÊòéÂè¶‰∏Ä‰∏™Áä∂ÊÄÅÁ†Å‰∏∫ `404` ‰∏îÂÖ∑Êúâ Pydantic Ê®°Âûã `Message` ÁöÑÂìçÂ∫îÔºå‰Ω†ÂèØ‰ª•ËøôÊ†∑ÂÜôÔºö\n \n-‰æãÂ¶ÇÔºåË¶ÅÂ£∞ÊòéÂè¶‰∏Ä‰∏™ÂÖ∑ÊúâÁä∂ÊÄÅÁ†Å `404` Âíå`Pydantic`Ê®°Âûã `Message` ÁöÑÂìçÂ∫îÔºåÂèØ‰ª•ÂÜôÔºö\n-{* ../../docs_src/additional_responses/tutorial001.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n \n-/// note\n+/// note | Ê≥®ÊÑè\n \n-ËØ∑ËÆ∞‰ΩèÔºåÊÇ®ÂøÖÈ°ªÁõ¥Êé•ËøîÂõû `JSONResponse` „ÄÇ\n+ËÆ∞‰Ωè‰Ω†ÈúÄË¶ÅÁõ¥Êé•ËøîÂõû `JSONResponse`„ÄÇ\n \n ///\n \n-/// info\n+/// info | ‰ø°ÊÅØ\n \n-`model` ÂØÜÈí•‰∏çÊòØOpenAPIÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ\n-**FastAPI**Â∞Ü‰ªéÈÇ£ÈáåËé∑Âèñ`Pydantic`Ê®°ÂûãÔºåÁîüÊàê` JSON Schema` ÔºåÂπ∂Â∞ÜÂÖ∂ÊîæÂú®Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇ\n-- Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆÊòØÔºö\n-    - Âú®ÈîÆ `content` ‰∏≠ÔºåÂÖ∂ÂÖ∑ÊúâÂè¶‰∏Ä‰∏™`JSON`ÂØπË±°Ôºà `dict` Ôºâ‰Ωú‰∏∫ÂÄºÔºåËØ•`JSON`ÂØπË±°ÂåÖÂê´Ôºö\n-        - Â™í‰ΩìÁ±ªÂûãÁöÑÂØÜÈí•Ôºå‰æãÂ¶Ç `application/json` ÔºåÂÆÉÂåÖÂê´Âè¶‰∏Ä‰∏™`JSON`ÂØπË±°‰Ωú‰∏∫ÂÄºÔºåËØ•ÂØπË±°ÂåÖÂê´Ôºö\n-            - ‰∏Ä‰∏™ÈîÆ` schema` ÔºåÂÆÉÁöÑÂÄºÊòØÊù•Ëá™Ê®°ÂûãÁöÑ`JSON Schema`ÔºåÊ≠£Á°ÆÁöÑ‰ΩçÁΩÆÂú®ËøôÈáå„ÄÇ\n-                - **FastAPI**Âú®ËøôÈáåÊ∑ªÂä†‰∫ÜÂØπOpenAPI‰∏≠Âè¶‰∏Ä‰∏™Âú∞ÊñπÁöÑÂÖ®Â±ÄJSONÊ®°ÂºèÁöÑÂºïÁî®ÔºåËÄå‰∏çÊòØÁõ¥Êé•ÂåÖÂê´ÂÆÉ„ÄÇËøôÊ†∑ÔºåÂÖ∂‰ªñÂ∫îÁî®Á®ãÂ∫èÂíåÂÆ¢Êà∑Á´ØÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ëøô‰∫õJSONÊ®°ÂºèÔºåÊèê‰æõÊõ¥Â•ΩÁöÑ‰ª£Á†ÅÁîüÊàêÂ∑•ÂÖ∑Á≠â„ÄÇ\n+`model` ÈîÆ‰∏çÊòØ OpenAPI ÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇ\n+\n+**FastAPI** ‰ºö‰ªéËøôÈáåËé∑Âèñ Pydantic Ê®°ÂûãÔºåÁîüÊàê JSON SchemaÔºåÂπ∂ÊääÂÆÉÊîæÂà∞Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇ\n+\n+Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆÊòØÔºö\n+\n+* Âú®ÈîÆ `content` ‰∏≠ÔºåÂÆÉÁöÑÂÄºÊòØÂè¶‰∏Ä‰∏™ JSON ÂØπË±°Ôºà`dict`ÔºâÔºåËØ•ÂØπË±°ÂåÖÂê´Ôºö\n+    * ‰∏Ä‰∏™Â™í‰ΩìÁ±ªÂûã‰Ωú‰∏∫ÈîÆÔºå‰æãÂ¶Ç `application/json`ÔºåÂÆÉÁöÑÂÄºÊòØÂè¶‰∏Ä‰∏™ JSON ÂØπË±°ÔºåËØ•ÂØπË±°ÂåÖÂê´Ôºö\n+        * ‰∏Ä‰∏™ÈîÆ `schema`ÔºåÂÆÉÁöÑÂÄºÊòØÊù•Ëá™ËØ•Ê®°ÂûãÁöÑ JSON SchemaÔºåËøôÈáåÂ∞±ÊòØÊ≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇ\n+            * **FastAPI** ‰ºöÂú®ËøôÈáåÊ∑ªÂä†‰∏Ä‰∏™ÂºïÁî®ÔºåÊåáÂêë‰Ω† OpenAPI ‰∏≠Âè¶‰∏Ä‰∏™‰ΩçÁΩÆÁöÑÂÖ®Â±Ä JSON SchemasÔºåËÄå‰∏çÊòØÁõ¥Êé•ÂÜÖËÅî„ÄÇËøôÊ†∑ÔºåÂÖ∂‰ªñÂ∫îÁî®ÂíåÂÆ¢Êà∑Á´ØÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Ëøô‰∫õ JSON SchemasÔºåÊèê‰æõÊõ¥Â•ΩÁöÑ‰ª£Á†ÅÁîüÊàêÂ∑•ÂÖ∑Á≠â„ÄÇ\n \n ///\n \n-**Âú®OpenAPI‰∏≠‰∏∫ËØ•Ë∑ØÂæÑÊìç‰ΩúÁîüÊàêÁöÑÂìçÂ∫îÂ∞ÜÊòØÔºö**\n+‰∏∫ËØ•*Ë∑ØÂæÑÊìç‰Ωú*Âú® OpenAPI ‰∏≠ÁîüÊàêÁöÑÂìçÂ∫îÂ∞ÜÊòØÔºö\n \n-\n```\n\n```diff\n@@ -1,26 +1,26 @@\n-# È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å\n+# È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å { #additional-status-codes }\n \n **FastAPI** ÈªòËÆ§‰ΩøÁî® `JSONResponse` ËøîÂõû‰∏Ä‰∏™ÂìçÂ∫îÔºåÂ∞Ü‰Ω†ÁöÑ *Ë∑ØÂæÑÊìç‰Ωú* ‰∏≠ÁöÑËøîÂõûÂÜÖÂÆπÊîæÂà∞ËØ• `JSONResponse` ‰∏≠„ÄÇ\n \n **FastAPI** ‰ºöËá™Âä®‰ΩøÁî®ÈªòËÆ§ÁöÑÁä∂ÊÄÅÁ†ÅÊàñËÄÖ‰ΩøÁî®‰Ω†Âú® *Ë∑ØÂæÑÊìç‰Ωú* ‰∏≠ËÆæÁΩÆÁöÑÁä∂ÊÄÅÁ†Å„ÄÇ\n \n-## È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å\n+## È¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å { #additional-status-codes_1 }\n \n Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅËøîÂõû‰∏ªË¶ÅÁä∂ÊÄÅÁ†Å‰πãÂ§ñÁöÑÁä∂ÊÄÅÁ†ÅÔºå‰Ω†ÂèØ‰ª•ÈÄöËøáÁõ¥Êé•ËøîÂõû‰∏Ä‰∏™ `Response` Êù•ÂÆûÁé∞ÔºåÊØîÂ¶Ç `JSONResponse`ÔºåÁÑ∂ÂêéÁõ¥Êé•ËÆæÁΩÆÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†Å„ÄÇ\n \n ‰æãÂ¶ÇÔºåÂÅáËÆæ‰Ω†ÊÉ≥Êúâ‰∏Ä‰∏™ *Ë∑ØÂæÑÊìç‰Ωú* ËÉΩÂ§üÊõ¥Êñ∞Êù°ÁõÆÔºåÂπ∂‰∏îÊõ¥Êñ∞ÊàêÂäüÊó∂ËøîÂõû 200 „ÄåÊàêÂäü„Äç ÁöÑ HTTP Áä∂ÊÄÅÁ†Å„ÄÇ\n \n ‰ΩÜÊòØ‰Ω†‰πüÂ∏åÊúõÂÆÉËÉΩÂ§üÊé•ÂèóÊñ∞ÁöÑÊù°ÁõÆ„ÄÇÂπ∂‰∏îÂΩìËøô‰∫õÊù°ÁõÆ‰∏çÂ≠òÂú®Êó∂Ôºå‰ºöËá™Âä®ÂàõÂª∫Âπ∂ËøîÂõû 201 „ÄåÂàõÂª∫„ÄçÁöÑ HTTP Áä∂ÊÄÅÁ†Å„ÄÇ\n \n-Ë¶ÅÂÆûÁé∞ÂÆÉÔºåÂØºÂÖ• `JSONResponse`ÔºåÁÑ∂ÂêéÂú®ÂÖ∂‰∏≠Áõ¥Êé•ËøîÂõû‰Ω†ÁöÑÂÜÖÂÆπÔºåÂπ∂Â∞Ü `status_code` ËÆæÁΩÆ‰∏∫‰∏∫‰Ω†Ë¶ÅÁöÑÂÄº„ÄÇ\n+Ë¶ÅÂÆûÁé∞ÂÆÉÔºåÂØºÂÖ• `JSONResponse`ÔºåÁÑ∂ÂêéÂú®ÂÖ∂‰∏≠Áõ¥Êé•ËøîÂõû‰Ω†ÁöÑÂÜÖÂÆπÔºåÂπ∂Â∞Ü `status_code` ËÆæÁΩÆ‰∏∫‰Ω†Ë¶ÅÁöÑÂÄº„ÄÇ\n \n-{* ../../docs_src/additional_status_codes/tutorial001.py hl[4,25] *}\n+{* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n-/// warning | Ë≠¶Âëä\n+/// warning\n \n ÂΩì‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂÉè‰∏äÈù¢‰æãÂ≠ê‰∏≠ÁöÑ `Response` ÂØπË±°Êó∂ÔºåÂÆÉ‰ºöÁõ¥Êé•ËøîÂõû„ÄÇ\n \n-FastAPI ‰∏ç‰ºöÁî®Ê®°ÂûãÁ≠âÂØπËØ•ÂìçÂ∫îËøõË°åÂ∫èÂàóÂåñ„ÄÇ\n+ÂÆÉ‰∏ç‰ºöÁî®Ê®°ÂûãÁ≠âËøõË°åÂ∫èÂàóÂåñ„ÄÇ\n \n Á°Æ‰øùÂÖ∂‰∏≠Êúâ‰Ω†ÊÉ≥Ë¶ÅÁöÑÊï∞ÊçÆÔºå‰∏îËøîÂõûÁöÑÂÄº‰∏∫ÂêàÊ≥ïÁöÑ JSONÔºàÂ¶ÇÊûú‰Ω†‰ΩøÁî® `JSONResponse` ÁöÑËØùÔºâ„ÄÇ\n \n@@ -34,7 +34,7 @@ FastAPI ‰∏ç‰ºöÁî®Ê®°ÂûãÁ≠âÂØπËØ•ÂìçÂ∫îËøõË°åÂ∫èÂàóÂåñ„ÄÇ\n \n ///\n \n-## OpenAPI Âíå API ÊñáÊ°£\n+## OpenAPI Âíå API ÊñáÊ°£ { #openapi-and-api-docs }\n \n Â¶ÇÊûú‰Ω†Áõ¥Êé•ËøîÂõûÈ¢ùÂ§ñÁöÑÁä∂ÊÄÅÁ†ÅÂíåÂìçÂ∫îÔºåÂÆÉ‰ª¨‰∏ç‰ºöÂåÖÂê´Âú® OpenAPI ÊñπÊ°àÔºàAPI ÊñáÊ°£Ôºâ‰∏≠ÔºåÂõ†‰∏∫ FastAPI Ê≤°ÂäûÊ≥ïÈ¢ÑÂÖàÁü•ÈÅì‰Ω†Ë¶ÅËøîÂõû‰ªÄ‰πà„ÄÇ\n \n\n```\n\n```diff\n@@ -1,65 +1,163 @@\n-# È´òÁ∫ß‰æùËµñÈ°π\n+# È´òÁ∫ß‰æùËµñÈ°π { #advanced-dependencies }\n \n-## ÂèÇÊï∞ÂåñÁöÑ‰æùËµñÈ°π\n+## ÂèÇÊï∞ÂåñÁöÑ‰æùËµñÈ°π { #parameterized-dependencies }\n \n-Êàë‰ª¨‰πãÂâçÁúãÂà∞ÁöÑÊâÄÊúâ‰æùËµñÈ°πÈÉΩÊòØÂÜôÊ≠ªÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n+ÁõÆÂâçÊàë‰ª¨ÁúãÂà∞ÁöÑ‰æùËµñÈ°πÈÉΩÊòØÂõ∫ÂÆöÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n \n-‰ΩÜ‰πüÂèØ‰ª•‰∏∫‰æùËµñÈ°πËÆæÁΩÆÂèÇÊï∞ÔºåÈÅøÂÖçÂ£∞ÊòéÂ§ö‰∏™‰∏çÂêåÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n+‰ΩÜÊúâÊó∂‰Ω†ÂèØËÉΩÂ∏åÊúõ‰∏∫‰æùËµñÈ°πËÆæÁΩÆÂèÇÊï∞ÔºåËÄå‰∏çÂøÖÂ£∞ÊòéËÆ∏Â§ö‰∏çÂêåÁöÑÂáΩÊï∞ÊàñÁ±ª„ÄÇ\n \n-ÂÅáËÆæË¶ÅÂàõÂª∫Ê†°È™åÊü•ËØ¢ÂèÇÊï∞ `q` ÊòØÂê¶ÂåÖÂê´Âõ∫ÂÆöÂÜÖÂÆπÁöÑ‰æùËµñÈ°π„ÄÇ\n+ÂÅáËÆæÊàë‰ª¨Ë¶ÅÊúâ‰∏Ä‰∏™‰æùËµñÈ°πÔºåÁî®Êù•Ê£ÄÊü•Êü•ËØ¢ÂèÇÊï∞ `q` ÊòØÂê¶ÂåÖÂê´Êüê‰∏™Âõ∫ÂÆöÂÜÖÂÆπ„ÄÇ\n \n-‰ΩÜÊ≠§Â§ÑË¶ÅÊääÂæÖÊ£ÄÈ™åÁöÑÂõ∫ÂÆöÂÜÖÂÆπÂÆö‰πâ‰∏∫ÂèÇÊï∞„ÄÇ\n+‰ΩÜÊàë‰ª¨Â∏åÊúõËÉΩÂ§üÊääËøô‰∏™Âõ∫ÂÆöÂÜÖÂÆπÂèÇÊï∞Âåñ„ÄÇ\n \n-## **ÂèØË∞ÉÁî®**ÂÆû‰æã\n+## ‚ÄúÂèØË∞ÉÁî®‚ÄùÁöÑÂÆû‰æã { #a-callable-instance }\n \n-Python ÂèØ‰ª•ÊääÁ±ªÂÆû‰æãÂèò‰∏∫**ÂèØË∞ÉÁî®È°π**„ÄÇ\n+Âú® Python ‰∏≠ÔºåÂèØ‰ª•ËÆ©Êüê‰∏™Á±ªÁöÑÂÆû‰æãÂèòÊàê‚ÄúÂèØË∞ÉÁî®ÂØπË±°‚ÄùÔºàcallableÔºâ„ÄÇ\n \n-ËøôÈáåËØ¥ÁöÑ‰∏çÊòØÁ±ªÊú¨Ë∫´ÔºàÁ±ªÊú¨Â∞±ÊòØÂèØË∞ÉÁî®È°πÔºâÔºåËÄåÊòØÁ±ªÂÆû‰æã„ÄÇ\n+ËøôÈáåÊåáÁöÑÊòØÁ±ªÁöÑÂÆû‰æãÔºàÁ±ªÊú¨Ë∫´Â∑≤ÁªèÊòØÂèØË∞ÉÁî®ÁöÑÔºâÔºåËÄå‰∏çÊòØÁ±ªÊú¨Ë∫´„ÄÇ\n \n-‰∏∫Ê≠§ÔºåÈúÄË¶ÅÂ£∞Êòé `__call__` ÊñπÊ≥ïÔºö\n+‰∏∫Ê≠§ÔºåÂ£∞Êòé‰∏Ä‰∏™ `__call__` ÊñπÊ≥ïÔºö\n \n-{* ../../docs_src/dependencies/tutorial011.py hl[10] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n \n-Êú¨‰æã‰∏≠Ôºå**FastAPI**  ‰ΩøÁî® `__call__` Ê£ÄÊü•ÈôÑÂä†ÂèÇÊï∞ÂèäÂ≠ê‰æùËµñÈ°πÔºåÁ®çÂêéÔºåËøòË¶ÅË∞ÉÁî®ÂÆÉÂêë*Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞*‰º†ÈÄíÂÄº„ÄÇ\n+Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºå**FastAPI** ‰ºö‰ΩøÁî®Ëøô‰∏™ `__call__` Êù•Ê£ÄÊü•ÈôÑÂä†ÂèÇÊï∞ÂíåÂ≠ê‰æùËµñÔºåÂπ∂‰∏îÁ®çÂêé‰ºöË∞ÉÁî®ÂÆÉÔºåÊääËøîÂõûÂÄº‰º†ÈÄíÁªô‰Ω†ÁöÑ*Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞*‰∏≠ÁöÑÂèÇÊï∞„ÄÇ\n \n-## ÂèÇÊï∞ÂåñÂÆû‰æã\n+## ÂèÇÊï∞ÂåñÂÆû‰æã { #parameterize-the-instance }\n \n-Êé•‰∏ãÊù•Ôºå‰ΩøÁî® `__init__` Â£∞ÊòéÁî®‰∫é**ÂèÇÊï∞Âåñ**‰æùËµñÈ°πÁöÑÂÆû‰æãÂèÇÊï∞Ôºö\n+Áé∞Âú®ÔºåÊàë‰ª¨ÂèØ‰ª•Áî® `__init__` Â£∞ÊòéÂÆû‰æãÁöÑÂèÇÊï∞ÔºåÁî®Êù•‚ÄúÂèÇÊï∞Âåñ‚ÄùËøô‰∏™‰æùËµñÈ°πÔºö\n \n-{* ../../docs_src/dependencies/tutorial011.py hl[7] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n \n-Êú¨‰æã‰∏≠Ôºå**FastAPI** ‰∏ç‰ΩøÁî® `__init__`ÔºåÊàë‰ª¨Ë¶ÅÁõ¥Êé•Âú®‰ª£Á†Å‰∏≠‰ΩøÁî®„ÄÇ\n+Âú®Êú¨‰æã‰∏≠Ôºå**FastAPI** ‰∏ç‰ºöÊé•Ëß¶ÊàñÂÖ≥ÂøÉ `__init__`ÔºåÊàë‰ª¨‰ºöÂú®Ëá™Â∑±ÁöÑ‰ª£Á†Å‰∏≠Áõ¥Êé•‰ΩøÁî®ÂÆÉ„ÄÇ\n \n-## ÂàõÂª∫ÂÆû‰æã\n+## ÂàõÂª∫ÂÆû‰æã { #create-an-instance }\n \n-‰ΩøÁî®‰ª•‰∏ã‰ª£Á†ÅÂàõÂª∫Á±ªÂÆû‰æãÔºö\n+Êàë‰ª¨ÂèØ‰ª•ËøôÊ†∑ÂàõÂª∫ËØ•Á±ªÁöÑÂÆû‰æãÔºö\n \n-{* ../../docs_src/dependencies/tutorial011.py hl[16] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n \n-ËøôÊ†∑Â∞±ÂèØ‰ª•*", "output": "Changes look good. This PR implements: üåê Update translations for zh (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 265}
{"instruction": "Fix the following bug: Fix #11215: Merge background tasks from dependency injection with Response.background", "input": "## Summary\nFixes #11215 by merging background tasks from dependency injection with tasks provided in `Response.background`, ensuring both are executed instead of silently discarding injected tasks.\n\n## Problem\nWhen a user returns a `Response` object with a `background` parameter and also uses injected `BackgroundTasks`, the injected tasks were being silently overwritten and never executed. This confusing behavior led to background tasks being mysteriously swallowed.\n\n## Solution\nModified `fastapi/routing.py` to merge background tasks:\n- If `Response.background` is `None`, use injected tasks (existing behavior)\n- If both exist, merge them:\n  - For `BackgroundTasks`, prepend injected tasks to response tasks\n  - For single `BackgroundTask`, convert to `BackgroundTasks` and merge\n- Maintains full backward compatibility\n\n## Test Plan\nAdded comprehensive test suite in `tests/test_background_tasks_merge.py`:\n- ‚úÖ Test injected tasks not lost when Response has empty background\n- ‚úÖ Test both tasks executed when both populated  \n- ‚úÖ Test only injected tasks work (existing behavior)\n- ‚úÖ Test only response tasks work (existing behavior)\n\nAll new tests pass, and all existing related tests pass:\n- `tests/test_response_dependency.py` - 7 tests passed\n- `tests/test_dependency_contextmanager.py` - 22 tests passed\n- `tests/test_default_response_class.py` - 14 tests passed\n- `tests/test_default_response_class_router.py` - 14 tests passed\n\nGenerated with [Claude Code](https://claude.com/claude-code)", "output": "```diff\n@@ -431,6 +431,40 @@ async def app(request: Request) -> Response:\n             if isinstance(raw_response, Response):\n                 if raw_response.background is None:\n                     raw_response.background = solved_result.background_tasks\n+                elif solved_result.background_tasks is not None:\n+                    # Merge background tasks from dependency injection with tasks from Response\n+                    # The Response's background can be either a BackgroundTask or BackgroundTasks\n+                    from starlette.background import BackgroundTask\n+                    from starlette.background import (\n+                        BackgroundTasks as StarletteBackgroundTasks,\n+                    )\n+\n+                    if isinstance(raw_response.background, StarletteBackgroundTasks):\n+                        # If Response has BackgroundTasks, prepend the injected tasks\n+                        if isinstance(\n+                            solved_result.background_tasks, StarletteBackgroundTasks\n+                        ):\n+                            # Prepend all injected tasks before the response tasks\n+                            raw_response.background.tasks = (\n+                                solved_result.background_tasks.tasks\n+                                + raw_response.background.tasks\n+                            )\n+                    elif isinstance(raw_response.background, BackgroundTask):\n+                        # If Response has a single BackgroundTask, convert to BackgroundTasks\n+                        response_task = raw_response.background\n+                        if isinstance(\n+                            solved_result.background_tasks, StarletteBackgroundTasks\n+                        ):\n+                            # Create new BackgroundTasks with injected tasks + response task\n+                            raw_response.background = StarletteBackgroundTasks(\n+                                tasks=solved_result.background_tasks.tasks\n+                                + [response_task]\n+                            )\n+                        else:\n+                            # Both are single tasks\n+                            raw_response.background = StarletteBackgroundTasks(\n+                                tasks=[solved_result.background_tasks, response_task]\n+                            )\n                 response = raw_response\n             else:\n                 response_args: dict[str, Any] = {\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+\"\"\"\n+Test that background tasks from injected BackgroundTasks and Response.background are both executed.\n+Related to issue #11215\n+\"\"\"\n+\n+from fastapi import BackgroundTasks, FastAPI\n+from fastapi.responses import Response\n+from fastapi.testclient import TestClient\n+from starlette.background import BackgroundTask\n+\n+app = FastAPI()\n+\n+# Track which background tasks were executed\n+executed_tasks = []\n+\n+\n+def task_from_injected():\n+    executed_tasks.append(\"injected\")\n+\n+\n+def task_from_response():\n+    executed_tasks.append(\"response\")\n+\n+\n+@app.get(\"/both-tasks\")\n+async def endpoint_with_both_tasks(tasks: BackgroundTasks):\n+    \"\"\"Endpoint that uses both injected BackgroundTasks and Response.background\"\"\"\n+    tasks.add_task(task_from_injected)\n+    return Response(\n+        content=\"Custom response\",\n+        background=BackgroundTasks(tasks=[]),\n+    )\n+\n+\n+@app.get(\"/both-tasks-populated\")\n+async def endpoint_with_both_tasks_populated(tasks: BackgroundTasks):\n+    \"\"\"Endpoint where both injected and response have background tasks\"\"\"\n+    tasks.add_task(task_from_injected)\n+    response_bg = BackgroundTasks()\n+    response_bg.add_task(task_from_response)\n+    return Response(\n+        content=\"Custom response\",\n+        background=response_bg,\n+    )\n+\n+\n+@app.get(\"/only-injected\")\n+async def endpoint_with_only_injected(tasks: BackgroundTasks):\n+    \"\"\"Endpoint that only uses injected BackgroundTasks\"\"\"\n+    tasks.add_task(task_from_injected)\n+    return Response(content=\"Custom response\")\n+\n+\n+@app.get(\"/only-response\")\n+async def endpoint_with_only_response():\n+    \"\"\"Endpoint that only uses Response.background\"\"\"\n+    response_bg = BackgroundTasks()\n+    response_bg.add_task(task_from_response)\n+    return Response(\n+        content=\"Custom response\",\n+        background=response_bg,\n+    )\n+\n+\n+def test_injected_tasks_not_lost_when_response_has_empty_background():\n+    \"\"\"Test that injected background tasks are preserved even when Response has empty background\"\"\"\n+    global executed_tasks\n+    executed_tasks = []\n+\n+    client = TestClient(app)\n+    response = client.get(\"/both-tasks\")\n+\n+    assert response.status_code == 200\n+    # Both tasks should be executed\n+    assert \"injected\" in executed_tasks, \"Injected task was not executed\"\n+\n+\n+def test_both_tasks_executed_when_both_populated():\n+    \"\"\"Test that both injected and response background tasks are executed\"\"\"\n+    global executed_tasks\n+    executed_tasks = []\n+\n+    client = TestClient(app)\n+    response = client.get(\"/both-tasks-populated\")\n+\n+    assert response.status_code == 200\n+    # Both tasks should be executed\n+    assert \"injected\" in executed_tasks, \"Injected task was not executed\"\n+    assert \"response\" in executed_tasks, \"Response task was not executed\"\n+\n+\n+def test_only_injected_tasks_work():\n+    \"\"\"Test that only injected background tasks work when no Response.background\"\"\"\n+    global executed_tasks\n+    executed_tasks = []\n+\n+    client = \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 264}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -431,6 +431,40 @@ async def app(request: Request) -> Response:\n             if isinstance(raw_response, Response):\n                 if raw_response.background is None:\n                     raw_response.background = solved_result.background_tasks\n+                elif solved_result.background_tasks is not None:\n+                    # Merge background tasks from dependency injection with tasks from Response\n+                    # The Response's background can be either a BackgroundTask or BackgroundTasks\n+                    from starlette.background import BackgroundTask\n+                    from starlette.background import (\n+                        BackgroundTasks as StarletteBackgroundTasks,\n+                    )\n+\n+                    if isinstance(raw_response.background, StarletteBackgroundTasks):\n+                        # If Response has BackgroundTasks, prepend the injected tasks\n+                        if isinstance(\n+                            solved_result.background_tasks, StarletteBackgroundTasks\n+                        ):\n+                            # Prepend all injected tasks before the response tasks\n+                            raw_response.background.tasks = (\n+                                solved_result.background_tasks.tasks\n+                                + raw_response.background.tasks\n+                            )\n+                    elif isinstance(raw_response.background, BackgroundTask):\n+                        # If Response has a single BackgroundTask, convert to BackgroundTasks\n+                        response_task = raw_response.background\n+                        if isinstance(\n+                            solved_result.background_tasks, StarletteBackgroundTasks\n+                        ):\n+                            # Create new BackgroundTasks with injected tasks + response task\n+                            raw_response.background = StarletteBackgroundTasks(\n+                                tasks=solved_result.background_tasks.tasks\n+                                + [response_task]\n+                            )\n+                        else:\n+                            # Both are single tasks\n+                            raw_response.background = StarletteBackgroundTasks(\n+                                tasks=[solved_result.background_tasks, response_task]\n+                            )\n                 response = raw_response\n             else:\n                 response_args: dict[str, Any] = {\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+\"\"\"\n+Test that background tasks from injected BackgroundTasks and Response.background are both executed.\n+Related to issue #11215\n+\"\"\"\n+\n+from fastapi import BackgroundTasks, FastAPI\n+from fastapi.responses import Response\n+from fastapi.testclient import TestClient\n+from starlette.background import BackgroundTask\n+\n+app = FastAPI()\n+\n+# Track which background tasks were executed\n+executed_tasks = []\n+\n+\n+def task_from_injected():\n+    executed_tasks.append(\"injected\")\n+\n+\n+def task_from_response():\n+    executed_tasks.append(\"response\")\n+\n+\n+@app.get(\"/both-tasks\")\n+async def endpoint_with_both_tasks(tasks: BackgroundTasks):\n+    \"\"\"Endpoint that uses both injected BackgroundTasks and Response.background\"\"\"\n+    tasks.add_task(task_from_injected)\n+    return Response(\n+        content=\"Custom response\",\n+        background=BackgroundTasks(tasks=[]),\n+    )\n+\n+\n+@app.get(\"/both-tasks-populated\")\n+async def endpoint_with_both_tasks_populated(tasks: BackgroundTasks):\n+    \"\"\"Endpoint where both injected and response have background tasks\"\"\"\n+    tasks.add_task(task_from_injected)\n+    response_bg = BackgroundTasks()\n+    response_bg.add_task(task_from_response)\n+    return Response(\n+        content=\"Custom response\",\n+        background=response_bg,\n+    )\n+\n+\n+@app.get(\"/only-injected\")\n+async def endpoint_with_only_injected(tasks: BackgroundTasks):\n+    \"\"\"Endpoint that only uses injected BackgroundTasks\"\"\"\n+    tasks.add_task(task_from_inject", "output": "Bug: Fix #11215: Merge background tasks from dependency injection with Response.background\n\n## Summary\nFixes #11215 by merging background tasks from dependency injection with tasks provided in `Response.background`, ensuring both are executed instead of silently discarding injected tasks.\n\n## Problem\nWhen a user returns a `Response` object with a `background` parameter and also uses injected `BackgroundTasks`, the injected tasks were being silently overwritten and never executed. This confusing behavior led to background tasks being mysteriously swallowed.\n\n## Solution\nModified `fastapi/routing.py` to merge background tasks:\n- If `Response.background` is `None`, use injected tasks (existing behavior)\n- If both exist, merge them:\n  - For `BackgroundTasks`, prepend injected tasks to response tasks\n  - For single `BackgroundTask`, convert to `BackgroundTasks` and merge\n- Maintains full backward compatibility\n\n## Test Plan\nAdded comprehensive test suite in `tests/test_background_tasks_merge.py`:\n- ‚úÖ Test injected tasks not lost when Response has empty background\n- ‚úÖ Test both tasks executed when both populated  \n- ‚úÖ Test only injected tasks work (existing behavior)\n- ‚úÖ Test only response tasks work (existing behavior)\n\nAll new tests pass, and all existing related tests pass:\n- `tests/test_response_dependency.py` - 7 tests passed\n- `tests/test_dependency_contextmanager.py` - 22 tests passed\n- `tests/test_default_response_class.py` - 14 tests passed\n- `tests/test_default_response_class_router.py` - 14 tests passed\n\nGenerated with [Claude Code](https://claude.com/claude-code)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 264}
{"instruction": "Review the following code changes: Fix #11215: Merge background tasks from dependency injection with Response.background", "input": "```diff\n@@ -431,6 +431,40 @@ async def app(request: Request) -> Response:\n             if isinstance(raw_response, Response):\n                 if raw_response.background is None:\n                     raw_response.background = solved_result.background_tasks\n+                elif solved_result.background_tasks is not None:\n+                    # Merge background tasks from dependency injection with tasks from Response\n+                    # The Response's background can be either a BackgroundTask or BackgroundTasks\n+                    from starlette.background import BackgroundTask\n+                    from starlette.background import (\n+                        BackgroundTasks as StarletteBackgroundTasks,\n+                    )\n+\n+                    if isinstance(raw_response.background, StarletteBackgroundTasks):\n+                        # If Response has BackgroundTasks, prepend the injected tasks\n+                        if isinstance(\n+                            solved_result.background_tasks, StarletteBackgroundTasks\n+                        ):\n+                            # Prepend all injected tasks before the response tasks\n+                            raw_response.background.tasks = (\n+                                solved_result.background_tasks.tasks\n+                                + raw_response.background.tasks\n+                            )\n+                    elif isinstance(raw_response.background, BackgroundTask):\n+                        # If Response has a single BackgroundTask, convert to BackgroundTasks\n+                        response_task = raw_response.background\n+                        if isinstance(\n+                            solved_result.background_tasks, StarletteBackgroundTasks\n+                        ):\n+                            # Create new BackgroundTasks with injected tasks + response task\n+                            raw_response.background = StarletteBackgroundTasks(\n+                                tasks=solved_result.background_tasks.tasks\n+                                + [response_task]\n+                            )\n+                        else:\n+                            # Both are single tasks\n+                            raw_response.background = StarletteBackgroundTasks(\n+                                tasks=[solved_result.background_tasks, response_task]\n+                            )\n                 response = raw_response\n             else:\n                 response_args: dict[str, Any] = {\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+\"\"\"\n+Test that background tasks from injected BackgroundTasks and Response.background are both executed.\n+Related to issue #11215\n+\"\"\"\n+\n+from fastapi import BackgroundTasks, FastAPI\n+from fastapi.responses import Response\n+from fastapi.testclient import TestClient\n+from starlette.background import BackgroundTask\n+\n+app = FastAPI()\n+\n+# Track which background tasks were executed\n+executed_tasks = []\n+\n+\n+def task_from_injected():\n+    executed_tasks.append(\"injected\")\n+\n+\n+def task_from_response():\n+    executed_tasks.append(\"response\")\n+\n+\n+@app.get(\"/both-tasks\")\n+async def endpoint_with_both_tasks(tasks: BackgroundTasks):\n+    \"\"\"Endpoint that uses both injected BackgroundTasks and Response.background\"\"\"\n+    tasks.add_task(task_from_injected)\n+    return Response(\n+        content=\"Custom response\",\n+        background=BackgroundTasks(tasks=[]),\n+    )\n+\n+\n+@app.get(\"/both-tasks-populated\")\n+async def endpoint_with_both_tasks_populated(tasks: BackgroundTasks):\n+    \"\"\"Endpoint where both injected and response have background tasks\"\"\"\n+    tasks.add_task(task_from_injected)\n+    response_bg = BackgroundTasks()\n+    response_bg.add_task(task_from_response)\n+    return Response(\n+        content=\"Custom response\",\n+        background=response_bg,\n+    )\n+\n+\n+@app.get(\"/only-injected\")\n+async def endpoint_with_only_injected(tasks: BackgroundTasks):\n+    \"\"\"Endpoint that only uses injected BackgroundTasks\"\"\"\n+    tasks.add_task(task_from_injected)\n+    return Response(content=\"Custom response\")\n+\n+\n+@app.get(\"/only-response\")\n+async def endpoint_with_only_response():\n+    \"\"\"Endpoint that only uses Response.background\"\"\"\n+    response_bg = BackgroundTasks()\n+    response_bg.add_task(task_from_response)\n+    return Response(\n+        content=\"Custom response\",\n+        background=response_bg,\n+    )\n+\n+\n+def test_injected_tasks_not_lost_when_response_has_empty_background():\n+    \"\"\"Test that injected background tasks are preserved even when Response has empty background\"\"\"\n+    global executed_tasks\n+    executed_tasks = []\n+\n+    client = TestClient(app)\n+    response = client.get(\"/both-tasks\")\n+\n+    assert response.status_code == 200\n+    # Both tasks should be executed\n+    assert \"injected\" in executed_tasks, \"Injected task was not executed\"\n+\n+\n+def test_both_tasks_executed_when_both_populated():\n+    \"\"\"Test that both injected and response background tasks are executed\"\"\"\n+    global executed_tasks\n+    executed_tasks", "output": "Changes look good. This PR implements: Fix #11215: Merge background tasks from dependency injection with Response.background", "source": "pr", "type": "code_review", "pr_number": 264}
{"instruction": "Review the following code changes: ‚ú® Allow to have multiple Query parameter models", "input": "```diff\n@@ -181,13 +181,13 @@ def get_flat_dependant(\n def _get_flat_fields_from_params(fields: list[ModelField]) -> list[ModelField]:\n     if not fields:\n         return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(\n-        first_field.field_info.annotation, BaseModel\n-    ):\n-        fields_to_extract = get_cached_model_fields(first_field.field_info.annotation)\n-        return fields_to_extract\n-    return fields\n+    fields_to_extract = []\n+    for f in fields:\n+        if lenient_issubclass(f.field_info.annotation, BaseModel):\n+            fields_to_extract.extend(get_cached_model_fields(f.field_info.annotation))\n+        else:\n+            fields_to_extract.append(f)\n+    return fields_to_extract\n \n \n def get_flat_params(dependant: Dependant) -> list[ModelField]:\n@@ -762,32 +762,27 @@ def request_params_to_args(\n     if not fields:\n         return values, errors\n \n-    first_field = fields[0]\n-    fields_to_extract = fields\n-    single_not_embedded_field = False\n     default_convert_underscores = True\n-    if len(fields) == 1 and lenient_issubclass(\n-        first_field.field_info.annotation, BaseModel\n-    ):\n-        fields_to_extract = get_cached_model_fields(first_field.field_info.annotation)\n-        single_not_embedded_field = True\n-        # If headers are in a Pydantic model, the way to disable convert_underscores\n-        # would be with Header(convert_underscores=False) at the Pydantic model level\n-        default_convert_underscores = getattr(\n-            first_field.field_info, \"convert_underscores\", True\n-        )\n-\n     params_to_process: dict[str, Any] = {}\n \n+    fields_to_extract = [\n+        (field, cached_field)\n+        for field in fields\n+        if lenient_issubclass(field.field_info.annotation, BaseModel)\n+        for cached_field in get_cached_model_fields(field.field_info.annotation)\n+    ]\n+\n     processed_keys = set()\n \n-    for field in fields_to_extract:\n+    for parent_field, field in fields_to_extract:\n         alias = None\n         if isinstance(received_params, Headers):\n             # Handle fields extracted from a Pydantic Model for a header, each field\n             # doesn't have a FieldInfo of type Header with the default convert_underscores=True\n             convert_underscores = getattr(\n-                field.field_info, \"convert_underscores\", default_convert_underscores\n+                parent_field.field_info,\n+                \"convert_underscores\",\n+                default_convert_underscores,\n             )\n             if convert_underscores:\n                 alias = get_validation_alias(field)\n@@ -809,27 +804,24 @@ def request_params_to_args(\n             else:\n                 params_to_process[key] = received_params.get(key)\n \n-    if single_not_embedded_field:\n-        field_info = first_field.field_info\n-        assert isinstance(field_info, params.Param), (\n-            \"Params must be subclasses of Param\"\n-        )\n-        loc: tuple[str, ...] = (field_i\n\n```\n\n```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Any, Callable\n+\n+import pytest\n+from fastapi import APIRouter, Cookie, FastAPI, Header, Query, status\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+client = TestClient(app)\n+\n+\n+class NameModel(BaseModel):\n+    name: str\n+\n+\n+class AgeModel(BaseModel):\n+    age: int\n+\n+\n+def add_routes(\n+    in_: Callable[..., Any],\n+    prefix: str,\n+) -> None:\n+    router = APIRouter(prefix=prefix)\n+\n+    @router.get(\"/models\")\n+    async def route_models(\n+        name_model: Annotated[NameModel, in_()],\n+        age_model: Annotated[AgeModel, in_()],\n+    ):\n+        return {\n+            \"name\": name_model.name,\n+            \"age\": age_model.age,\n+        }\n+\n+    @router.get(\"/mixed\")\n+    async def route_mixed(\n+        name_model: Annotated[NameModel, in_()],\n+        age: Annotated[int, in_()],\n+    ):\n+        return {\n+            \"name\": name_model.name,\n+            \"age\": age,\n+        }\n+\n+    app.include_router(router)\n+\n+\n+add_routes(Query, \"/query\")\n+add_routes(Header, \"/header\")\n+add_routes(Cookie, \"/cookie\")\n+\n+\n+@pytest.mark.parametrize(\n+    (\"in_\", \"prefix\", \"call_arg\"),\n+    [\n+        (Query, \"/query\", \"params\"),\n+        (Header, \"/header\", \"headers\"),\n+        (Cookie, \"/cookie\", \"cookies\"),\n+    ],\n+    ids=[\n+        \"query\",\n+        \"header\",\n+        \"cookie\",\n+    ],\n+)\n+@pytest.mark.parametrize(\n+    \"type_\",\n+    [\n+        \"models\",\n+        \"mixed\",\n+    ],\n+    ids=[\n+        \"models\",\n+        \"mixed\",\n+    ],\n+)\n+def test_multiple_params(in_, prefix, call_arg, type_):\n+    params = {\"name\": \"John\", \"age\": \"42\"}\n+    kwargs = {}\n+\n+    if call_arg == \"cookies\":\n+        client.cookies = params\n+    else:\n+        kwargs[call_arg] = params\n+\n+    response = client.get(f\"{prefix}/{type_}\", **kwargs)\n+\n+    assert response.status_code == status.HTTP_200_OK\n+    assert response.json() == {\"name\": \"John\", \"age\": 42}\n+\n+\n+@pytest.m", "output": "Code Review for: ‚ú® Allow to have multiple Query parameter models\n\nüìù **fastapi/dependencies/utils.py**: I'm not sure it will work, because we will have both base model and all fields, we want to remove based model and keep only it fields.\n\nüìù **fastapi/dependencies/utils.py**: Yup, it looks better, thanks for suggestion\n\nüìù **fastapi/dependencies/utils.py**: The variable `first_field` is referenced here but it's not defined in this function. This should be `f` instead, which is the loop variable iterating over the fields.\n```suggestion\n        if _is_model_class(f.type_):\n```\n\nüìù **fastapi/dependencies/utils.py**: This line has incorrect indentation with extra leading spaces before `fields_to_extract`. The indentation should be consistent with the rest of the function.\n```suggestion\n    fields_to_extract = []\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 263}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -212,11 +212,14 @@ def get_flat_dependant(\n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n     if not fields:\n         return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+\n+    fields_to_extract = []\n+    for f in fields:\n+        if lenient_issubclass(f.type_, BaseModel):\n+            fields_to_extract.extend(get_cached_model_fields(f.type_))\n+        else:\n+            fields_to_extract.append(f)\n+    return fields_to_extract\n\n```", "output": "I'm not sure it will work, because we will have both base model and all fields, we want to remove based model and keep only it fields.", "source": "pr_review", "type": "inline_review", "pr_number": 263}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -747,15 +750,19 @@ def request_params_to_args(\n     if not fields:\n         return values, errors\n \n-    first_field = fields[0]\n     fields_to_extract = fields\n-    single_not_embedded_field = False\n-    if len(fields) == 1 and lenient_issubclass(first_field.type_, BaseModel):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        single_not_embedded_field = True\n-\n     params_to_process: Dict[str, Any] = {}\n \n+    model_fields = [\n+        field for field in fields if lenient_issubclass(field.type_, BaseModel)\n+    ]\n+    if model_fields:\n+        fields_to_extract = [\n+            cached_field\n+            for field in model_fields\n+            for cached_field in get_cached_model_fields(field.type_)\n+        ]\n\n```", "output": "Yup, it looks better, thanks for suggestion", "source": "pr_review", "type": "inline_review", "pr_number": 263}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -193,11 +193,14 @@ def get_flat_dependant(\n def _get_flat_fields_from_params(fields: List[ModelField]) -> List[ModelField]:\n     if not fields:\n         return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and _is_model_class(first_field.type_):\n-        fields_to_extract = get_cached_model_fields(first_field.type_)\n-        return fields_to_extract\n-    return fields\n+\n+      fields_to_extract = []\n+    for f in fields:\n+        if _is_model_class(first_field.type_):\n\n```", "output": "The variable `first_field` is referenced here but it's not defined in this function. This should be `f` instead, which is the loop variable iterating over the fields.\n```suggestion\n        if _is_model_class(f.type_):\n```", "source": "pr_review", "type": "inline_review", "pr_number": 263}
{"instruction": "Review the following code changes: ‚úÖ Add tests for nullable parameters and defaults", "input": "```diff\n@@ -0,0 +1,1072 @@\n+from typing import Annotated, Any, Union\n+from unittest.mock import Mock, patch\n+\n+import pytest\n+from dirty_equals import IsList, IsOneOf, IsPartialDict\n+from fastapi import Body, FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, BeforeValidator, field_validator\n+\n+from .utils import get_body_model_name\n+\n+app = FastAPI()\n+\n+\n+def convert(v: Any) -> Any:\n+    return v\n+\n+\n+# =====================================================================================\n+# Nullable required\n+\n+\n+@app.post(\"/nullable-required\")\n+async def read_nullable_required(\n+    int_val: Annotated[Union[int, None], Body(), BeforeValidator(lambda v: convert(v))],\n+    str_val: Annotated[Union[str, None], Body(), BeforeValidator(lambda v: convert(v))],\n+    list_val: Annotated[\n+        Union[list[int], None],\n+        Body(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+):\n+    return {\n+        \"int_val\": int_val,\n+        \"str_val\": str_val,\n+        \"list_val\": list_val,\n+        \"fields_set\": None,\n+    }\n+\n+\n+class ModelNullableRequired(BaseModel):\n+    int_val: Union[int, None]\n+    str_val: Union[str, None]\n+    list_val: Union[list[int], None]\n+\n+    @field_validator(\"*\", mode=\"before\")\n+    def validate_all(cls, v):\n+        return convert(v)\n+\n+\n+@app.post(\"/model-nullable-required\")\n+async def read_model_nullable_required(params: ModelNullableRequired):\n+    return {\n+        \"int_val\": params.int_val,\n+        \"str_val\": params.str_val,\n+        \"list_val\": params.list_val,\n+        \"fields_set\": params.model_fields_set,\n+    }\n+\n+\n+@app.post(\"/nullable-required-str\")\n+async def read_nullable_required_no_embed_str(\n+    str_val: Annotated[Union[str, None], Body(), BeforeValidator(lambda v: convert(v))],\n+):\n+    return {\"val\": str_val}\n+\n+\n+@app.post(\"/nullable-required-int\")\n+async def read_nullable_required_no_embed_int(\n+    int_val: Annotated[Union[int, None], Body(), BeforeValidator(lambda v: convert(v))],\n+):\n+    return {\"val\": int_val}\n+\n+\n+@app.post(\"/nullable-required-list\")\n+async def read_nullable_required_no_embed_list(\n+    list_val: Annotated[\n+        Union[list[int], None], Body(), BeforeValidator(lambda v: convert(v))\n+    ],\n+):\n+    return {\"val\": list_val}\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required\",\n+        \"/model-nullable-required\",\n+    ],\n+)\n+def test_nullable_required_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n+        \"properties\": {\n+            \"int_val\": {\n+                \"title\": \"Int Val\",\n+                \"anyOf\": [{\"type\": \"integer\"}, {\"type\": \"null\"}],\n+            },\n+            \"str_val\": {\n+                \"title\": \"Str Val\",\n+                \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"null\"}],\n+            },\n+            \"list_val\": {\n+                \"title\": \"List Val\",\n+         \n\n```\n\n```diff\n@@ -0,0 +1,402 @@\n+from typing import Annotated, Any, Union\n+from unittest.mock import Mock, patch\n+\n+import pytest\n+from dirty_equals import IsList, IsOneOf\n+from fastapi import Cookie, FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, BeforeValidator, field_validator\n+\n+app = FastAPI()\n+\n+\n+def convert(v: Any) -> Any:\n+    return v\n+\n+\n+# =====================================================================================\n+# Nullable required\n+\n+\n+@app.get(\"/nullable-required\")\n+async def read_nullable_required(\n+    int_val: Annotated[\n+        Union[int, None],\n+        Cookie(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+    str_val: Annotated[\n+        Union[str, None],\n+        Cookie(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+):\n+    return {\n+        \"int_val\": int_val,\n+        \"str_val\": str_val,\n+        \"fields_set\": None,\n+    }\n+\n+\n+class ModelNullableRequired(BaseModel):\n+    int_val: Union[int, None]\n+    str_val: Union[str, None]\n+\n+    @field_validator(\"*\", mode=\"before\")\n+    @classmethod\n+    def convert_fields(cls, v):\n+        return convert(v)\n+\n+\n+@app.get(\"/model-nullable-required\")\n+async def read_model_nullable_required(\n+    params: Annotated[ModelNullableRequired, Cookie()],\n+):\n+    return {\n+        \"int_val\": params.int_val,\n+        \"str_val\": params.str_val,\n+        \"fields_set\": params.model_fields_set,\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required\",\n+        \"/model-nullable-required\",\n+    ],\n+)\n+def test_nullable_required_schema(path: str):\n+    assert app.openapi()[\"paths\"][path][\"get\"][\"parameters\"] == [\n+        {\n+            \"required\": True,\n+            \"schema\": {\n+                \"title\": \"Int Val\",\n+                \"anyOf\": [{\"type\": \"integer\"}, {\"type\": \"null\"}],\n+            },\n+            \"name\": \"int_val\",\n+            \"in\": \"cookie\",\n+        },\n+        {\n+            \"required\": Tr", "output": "Code Review for: ‚úÖ Add tests for nullable parameters and defaults\n\nüìù **tests/test_request_params/test_body/test_nullable_and_defaults.py**: I think ideally we should fix this as well - make parameters declared as model and non-model parameters return the same value. And, it should be probably `{}`.\nThis will likely be fixed as a side effect if we address all other issues\n\nüìù **tests/test_request_params/test_file/test_nullable_and_defaults.py**: ```suggestion\n                \"default\": \"default\",\n```\nDoes it make sense to have default value for `File` field?\n\n", "source": "pr", "type": "code_review", "pr_number": 262}
{"instruction": "Review this code change in `tests/test_request_params/test_body/test_nullable_and_defaults.py`", "input": "```diff\n@@ -0,0 +1,1072 @@\n+from typing import Annotated, Any, Union\n+from unittest.mock import Mock, patch\n+\n+import pytest\n+from dirty_equals import IsList, IsOneOf, IsPartialDict\n+from fastapi import Body, FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, BeforeValidator, field_validator\n+\n+from .utils import get_body_model_name\n+\n+app = FastAPI()\n+\n+\n+def convert(v: Any) -> Any:\n+    return v\n+\n+\n+# =====================================================================================\n+# Nullable required\n+\n+\n+@app.post(\"/nullable-required\")\n+async def read_nullable_required(\n+    int_val: Annotated[Union[int, None], Body(), BeforeValidator(lambda v: convert(v))],\n+    str_val: Annotated[Union[str, None], Body(), BeforeValidator(lambda v: convert(v))],\n+    list_val: Annotated[\n+        Union[list[int], None],\n+        Body(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+):\n+    return {\n+        \"int_val\": int_val,\n+        \"str_val\": str_val,\n+        \"list_val\": list_val,\n+        \"fields_set\": None,\n+    }\n+\n+\n+class ModelNullableRequired(BaseModel):\n+    int_val: Union[int, None]\n+    str_val: Union[str, None]\n+    list_val: Union[list[int], None]\n+\n+    @field_validator(\"*\", mode=\"before\")\n+    def validate_all(cls, v):\n+        return convert(v)\n+\n+\n+@app.post(\"/model-nullable-required\")\n+async def read_model_nullable_required(params: ModelNullableRequired):\n+    return {\n+        \"int_val\": params.int_val,\n+        \"str_val\": params.str_val,\n+        \"list_val\": params.list_val,\n+        \"fields_set\": params.model_fields_set,\n+    }\n+\n+\n+@app.post(\"/nullable-required-str\")\n+async def read_nullable_required_no_embed_str(\n+    str_val: Annotated[Union[str, None], Body(), BeforeValidator(lambda v: convert(v))],\n+):\n+    return {\"val\": str_val}\n+\n+\n+@app.post(\"/nullable-required-int\")\n+async def read_nullable_required_no_embed_int(\n+    int_val: Annotated[Union[int, None], Body(), BeforeValidator(lambda v: convert(v))],\n+):\n+    return {\"val\": int_val}\n+\n+\n+@app.post(\"/nullable-required-list\")\n+async def read_nullable_required_no_embed_list(\n+    list_val: Annotated[\n+        Union[list[int], None], Body(), BeforeValidator(lambda v: convert(v))\n+    ],\n+):\n+    return {\"val\": list_val}\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required\",\n+        \"/model-nullable-required\",\n+    ],\n+)\n+def test_nullable_required_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n+        \"properties\": {\n+            \"int_val\": {\n+                \"title\": \"Int Val\",\n+                \"anyOf\": [{\"type\": \"integer\"}, {\"type\": \"null\"}],\n+            },\n+            \"str_val\": {\n+                \"title\": \"Str Val\",\n+                \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"null\"}],\n+            },\n+            \"list_val\": {\n+                \"title\": \"List Val\",\n+                \"anyOf\": [\n+                    {\"type\": \"array\", \"items\": {\"type\": \"integer\"}},\n+                    {\"type\": \"null\"},\n+                ],\n+            },\n+        },\n+        \"required\": [\"int_val\", \"str_val\", \"list_val\"],\n+        \"title\": body_model_name,\n+        \"type\": \"object\",\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    (\"path\", \"schema\"),\n+    [\n+        (\n+            \"/nullable-required-str\",\n+            {\n+                \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"null\"}],\n+                \"title\": \"Str Val\",\n+            },\n+        ),\n+        (\n+            \"/nullable-required-int\",\n+            {\n+                \"anyOf\": [{\"type\": \"integer\"}, {\"type\": \"null\"}],\n+                \"title\": \"Int Val\",\n+            },\n+        ),\n+        (\n+            \"/nullable-required-list\",\n+            {\n+                \"anyOf\": [\n+                    {\"type\": \"array\", \"items\": {\"type\": \"integer\"}},\n+                    {\"type\": \"null\"},\n+                ],\n+                \"title\": \"List Val\",\n+            },\n+        ),\n+    ],\n+)\n+def test_nullable_required_no_embed_schema(path: str, schema: dict):\n+    openapi = app.openapi()\n+    path_operation = openapi[\"paths\"][path][\"post\"]\n+    assert (\n+        path_operation[\"requestBody\"][\"content\"][\"application/json\"][\"schema\"] == schema\n+    )\n+    assert path_operation[\"requestBody\"][\"required\"] is True\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required\",\n+        \"/model-nullable-required\",\n+    ],\n+)\n+def test_nullable_required_missing(path: str):\n+    client = TestClient(app)\n+    response = client.post(path, json={})\n+    assert response.status_code == 422\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"body\", \"int_val\"],\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n\n```", "output": "I think ideally we should fix this as well - make parameters declared as model and non-model parameters return the same value. And, it should be probably `{}`.\nThis will likely be fixed as a side effect if we address all other issues", "source": "pr_review", "type": "inline_review", "pr_number": 262}
{"instruction": "Review this code change in `tests/test_request_params/test_file/test_nullable_and_defaults.py`", "input": "```diff\n@@ -0,0 +1,480 @@\n+from typing import Annotated, Any, Union\n+from unittest.mock import Mock, patch\n+\n+import pytest\n+from dirty_equals import IsOneOf\n+from fastapi import FastAPI, File, UploadFile\n+from fastapi.testclient import TestClient\n+from pydantic import BeforeValidator\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+from .utils import get_body_model_name\n+\n+app = FastAPI()\n+\n+\n+def convert(v: Any) -> Any:\n+    return v\n+\n+\n+# =====================================================================================\n+# Nullable required\n+\n+\n+@app.post(\"/nullable-required-bytes\")\n+async def read_nullable_required_bytes(\n+    file: Annotated[\n+        Union[bytes, None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+    files: Annotated[\n+        Union[list[bytes], None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+):\n+    return {\n+        \"file\": len(file) if file is not None else None,\n+        \"files\": [len(f) for f in files] if files is not None else None,\n+    }\n+\n+\n+@app.post(\"/nullable-required-uploadfile\")\n+async def read_nullable_required_uploadfile(\n+    file: Annotated[\n+        Union[UploadFile, None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+    files: Annotated[\n+        Union[list[UploadFile], None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+):\n+    return {\n+        \"file\": file.size if file is not None else None,\n+        \"files\": [f.size for f in files] if files is not None else None,\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required-bytes\",\n+        \"/nullable-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_required_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n+        \"properties\": {\n+            \"file\": {\n+                \"title\": \"File\",\n+                \"anyOf\": [{\"type\": \"string\", \"format\": \"binary\"}, {\"type\": \"null\"}],\n+            },\n+            \"files\": {\n+                \"title\": \"Files\",\n+                \"anyOf\": [\n+                    {\"type\": \"array\", \"items\": {\"type\": \"string\", \"format\": \"binary\"}},\n+                    {\"type\": \"null\"},\n+                ],\n+            },\n+        },\n+        \"required\": [\"file\", \"files\"],\n+        \"title\": body_model_name,\n+        \"type\": \"object\",\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required-bytes\",\n+        \"/nullable-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_required_missing(path: str):\n+    client = TestClient(app)\n+\n+    with patch(f\"{__name__}.convert\", Mock(wraps=convert)) as mock_convert:\n+        response = client.post(path)\n+\n+    assert mock_convert.call_count == 0, (\n+        \"Validator should not be called if the value is missing\"\n+    )\n+    assert response.status_code == 422\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"body\", \"file\"],\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n+            },\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"body\", \"files\"],\n+                \"msg\": \"Field required\",\n+                \"input\": IsOneOf(None, {}),\n+            },\n+        ]\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required-bytes\",\n+        \"/nullable-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_required_pass_empty_file(path: str):\n+    client = TestClient(app)\n+\n+    with patch(f\"{__name__}.convert\", Mock(wraps=convert)) as mock_convert:\n+        response = client.post(\n+            path,\n+            files=[(\"file\", b\"\"), (\"files\", b\"\"), (\"files\", b\"\")],\n+        )\n+\n+    assert mock_convert.call_count == 2, \"Validator should be called for each field\"\n+    call_args = [call_args_item.args for call_args_item in mock_convert.call_args_list]\n+    file_call_arg_1 = call_args[0][0]\n+    files_call_arg_1 = call_args[1][0]\n+\n+    assert (\n+        (file_call_arg_1 == b\"\")  # file as bytes\n+        or isinstance(file_call_arg_1, StarletteUploadFile)  # file as UploadFile\n+    )\n+    assert (\n+        (files_call_arg_1 == [b\"\", b\"\"])  # files as bytes\n+        or all(  # files as UploadFile\n+            isinstance(f, StarletteUploadFile) for f in files_call_arg_1\n+        )\n+    )\n+\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\n+        \"file\": 0,\n+        \"files\": [0, 0],\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-required-bytes\",\n+        \"/nullable-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_required_pass_file(path: str):\n+    client = TestClient(app)\n+\n+    with patch(f\"{__name__}.convert\", Mock(wraps=convert)) as mock_convert:\n+        response = client.post(\n+            path,\n+            files=[\n+                (\"file\", b\"test 1\"),\n+                (\"files\", b\"test 2\"),\n+                (\"files\", b\"test 3\"),\n+            ],\n+        )\n+\n+    assert mock_convert.call_count == 2, \"Validator should be called for each field\"\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"file\": 6, \"files\": [6, 6]}\n+\n+\n+# =====================================================================================\n+# Nullable with default=None\n+\n+\n+@app.post(\"/nullable-non-required-bytes\")\n+async def read_nullable_non_required_bytes(\n+    file: Annotated[\n+        Union[bytes, None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ] = None,\n+    files: Annotated[\n+        Union[list[bytes], None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ] = None,\n+):\n+    return {\n+        \"file\": len(file) if file is not None else None,\n+        \"files\": [len(f) for f in files] if files is not None else None,\n+    }\n+\n+\n+@app.post(\"/nullable-non-required-uploadfile\")\n+async def read_nullable_non_required_uploadfile(\n+    file: Annotated[\n+        Union[UploadFile, None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ] = None,\n+    files: Annotated[\n+        Union[list[UploadFile], None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ] = None,\n+):\n+    return {\n+        \"file\": file.size if file is not None else None,\n+        \"files\": [f.size for f in files] if files is not None else None,\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-non-required-bytes\",\n+        \"/nullable-non-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_non_required_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n+        \"properties\": {\n+            \"file\": {\n+                \"title\": \"File\",\n+                \"anyOf\": [{\"type\": \"string\", \"format\": \"binary\"}, {\"type\": \"null\"}],\n+                # \"default\": None, # `None` values are omitted in OpenAPI schema\n+            },\n+            \"files\": {\n+                \"title\": \"Files\",\n+                \"anyOf\": [\n+                    {\"type\": \"array\", \"items\": {\"type\": \"string\", \"format\": \"binary\"}},\n+                    {\"type\": \"null\"},\n+                ],\n+                # \"default\": None, # `None` values are omitted in OpenAPI schema\n+            },\n+        },\n+        \"title\": body_model_name,\n+        \"type\": \"object\",\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-non-required-bytes\",\n+        \"/nullable-non-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_non_required_missing(path: str):\n+    client = TestClient(app)\n+\n+    with patch(f\"{__name__}.convert\", Mock(wraps=convert)) as mock_convert:\n+        response = client.post(path)\n+\n+    assert mock_convert.call_count == 0, (\n+        \"Validator should not be called if the value is missing\"\n+    )\n+    assert response.status_code == 200\n+    assert response.json() == {\n+        \"file\": None,\n+        \"files\": None,\n+    }\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-non-required-bytes\",\n+        \"/nullable-non-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_non_required_pass_empty_file(path: str):\n+    client = TestClient(app)\n+\n+    with patch(f\"{__name__}.convert\", Mock(wraps=convert)) as mock_convert:\n+        response = client.post(\n+            path,\n+            files=[(\"file\", b\"\"), (\"files\", b\"\"), (\"files\", b\"\")],\n+        )\n+\n+    assert mock_convert.call_count == 2, \"Validator should be called for each field\"\n+    call_args = [call_args_item.args for call_args_item in mock_convert.call_args_list]\n+    file_call_arg_1 = call_args[0][0]\n+    files_call_arg_1 = call_args[1][0]\n+\n+    assert (\n+        (file_call_arg_1 == b\"\")  # file as bytes\n+        or isinstance(file_call_arg_1, StarletteUploadFile)  # file as UploadFile\n+    )\n+    assert (\n+        (files_call_arg_1 == [b\"\", b\"\"])  # files as bytes\n+        or all(  # files as UploadFile\n+            isinstance(f, StarletteUploadFile) for f in files_call_arg_1\n+        )\n+    )\n+\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"file\": 0, \"files\": [0, 0]}\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-non-required-bytes\",\n+        \"/nullable-non-required-uploadfile\",\n+    ],\n+)\n+def test_nullable_non_required_pass_file(path: str):\n+    client = TestClient(app)\n+\n+    with patch(f\"{__name__}.convert\", Mock(wraps=convert)) as mock_convert:\n+        response = client.post(\n+            path,\n+            files=[(\"file\", b\"test 1\"), (\"files\", b\"test 2\"), (\"files\", b\"test 3\")],\n+        )\n+\n+    assert mock_convert.call_count == 2, \"Validator should be called for each field\"\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"file\": 6, \"files\": [6, 6]}\n+\n+\n+# =====================================================================================\n+# Nullable with not-None default\n+\n+\n+@app.post(\"/nullable-with-non-null-default-bytes\")\n+async def read_nullable_with_non_null_default_bytes(\n+    *,\n+    file: Annotated[\n+        Union[bytes, None],\n+        File(),\n+        BeforeValidator(lambda v: convert(v)),\n+    ] = b\"default\",\n+    files: Annotated[\n+        Union[list[bytes], None],\n+        File(default_factory=lambda: [b\"default\"]),\n+        BeforeValidator(lambda v: convert(v)),\n+    ],\n+):\n+    return {\n+        \"file\": len(file) if file is not None else None,\n+        \"files\": [len(f) for f in files] if files is not None else None,\n+    }\n+\n+\n+# Note: It seems to be not possible to create endpoint with UploadFile and non-None default\n+\n+\n+@pytest.mark.parametrize(\n+    \"path\",\n+    [\n+        \"/nullable-with-non-null-default-bytes\",\n+    ],\n+)\n+def test_nullable_with_non_null_default_schema(path: str):\n+    openapi = app.openapi()\n+    body_model_name = get_body_model_name(openapi, path)\n+\n+    assert app.openapi()[\"components\"][\"schemas\"][body_model_name] == {\n+        \"properties\": {\n+            \"file\": {\n+                \"title\": \"File\",\n+                \"anyOf\": [{\"type\": \"string\", \"format\": \"binary\"}, {\"type\": \"null\"}],\n+                \"default\": \"default\",  # <= Default value for file looks strange to me\n\n```", "output": "```suggestion\n                \"default\": \"default\",\n```\nDoes it make sense to have default value for `File` field?", "source": "pr_review", "type": "inline_review", "pr_number": 262}
{"instruction": "Fix the following bug: Improve error message for missing dependency type annotation", "input": "This PR improves the error raised when a dependency parameter is missing a type annotation.\r\n\r\nPreviously, FastAPI would raise a generic AssertionError during dependency resolution, which made it difficult to understand what went wrong and how to fix it.\r\n\r\nChanges in this PR:\r\n- Replace the assertion with a FastAPIError that includes:\r\n  - the dependency parameter name\r\n  - a clear explanation of the issue\r\n  - an example of the correct annotation syntax\r\n- Ensure the error is only enforced in appropriate contexts to avoid breaking\r\n  parameter-less dependencies, dependency overrides, and WebSocket sub-dependencies\r\n- Add a test covering the missing type annotation case\r\n\r\nAll existing tests pass.", "output": "```diff\n@@ -46,7 +46,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -121,6 +121,7 @@ def get_parameterless_sub_dependant(*, depends: params.Depends, path: str) -> De\n         call=depends.dependency,\n         scope=depends.scope,\n         own_oauth_scopes=own_oauth_scopes,\n+        enforce_annotation=False,\n     )\n \n \n@@ -248,6 +249,13 @@ def get_typed_return_annotation(call: Callable[..., Any]) -> Any:\n     return get_typed_annotation(annotation, globalns)\n \n \n+def _dependency_defines_type(depends: params.Depends) -> bool:\n+    dependency = depends.dependency\n+    if inspect.isclass(dependency):\n+        return True\n+    return get_typed_return_annotation(dependency) is not None\n+\n+\n def get_dependant(\n     *,\n     path: str,\n@@ -257,6 +265,7 @@ def get_dependant(\n     parent_oauth_scopes: Optional[list[str]] = None,\n     use_cache: bool = True,\n     scope: Union[Literal[\"function\", \"request\"], None] = None,\n+    enforce_annotation: bool = True,\n ) -> Dependant:\n     dependant = Dependant(\n         call=call,\n@@ -281,6 +290,15 @@ def get_dependant(\n         )\n         if param_details.depends is not None:\n             assert param_details.depends.dependency\n+            if (\n+                enforce_annotation\n+                and param.annotation is inspect.Signature.empty\n+                and not _dependency_defines_type(param_details.depends)\n+            ):\n+                raise FastAPIError(\n+                    f'Dependency parameter \"{param_name}\" must have a type annotation. '\n+                    f\"For example: `{param_name}: SomeType = Depends(...)`\"\n+                )\n             if (\n                 (dependant.is_gen_callable or dependant.is_async_gen_callable)\n                 and dependant.computed_scope == \"request\"\n@@ -303,6 +321,7 @@ def get_dependant(\n                 parent_oauth_scopes=current_scopes,\n                 use_cache=param_details.depends.use_cache,\n                 scope=param_details.depends.scope,\n+                enforce_annotation=False,\n             )\n             dependant.dependencies.append(sub_dependant)\n             continue\n@@ -315,7 +334,11 @@ def get_dependant(\n                 f\"Cannot specify multiple FastAPI annotations for {param_name!r}\"\n             )\n             continue\n-        assert param_details.field is not None\n+        if enforce_annotation and param_details.field is None:\n+            raise FastAPIError(\n+                f'Dependency parameter \"{param_name}\" must have a type annotation. '\n+                f\"For example: `{param_name}: SomeType = Depends(...)`\"\n+            )\n         if isinstance(param_details.field.field_info, params.Body):\n             dependant.body_params.append(param_de\n\n```\n\n```diff\n@@ -456,7 +456,10 @@ def __init__(\n         self.dependencies = list(dependencies or [])\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         self.dependant = get_dependant(\n-            path=self.path_format, call=self.endpoint, scope=\"function\"\n+            path=self.path_format,\n+            call=self.endpoint,\n+            scope=\"function\",\n+            enforce_annotation=False,\n         )\n         for depends in self.dependencies[::-1]:\n             self.dependant.dependencies.insert(\n\n```\n\n```diff\n@@ -2,6 +2,7 @@\n \n import pytest\n from fastapi import APIRouter, Depends, FastAPI\n+from fastapi.exceptions import FastAPIError\n from fastapi.testclient import TestClient\n \n app = FastAPI()\n@@ -389,3 +390,23 @@ def test_override_with_sub_router_decorator_depends_k_bar():\n     assert response.status_code == 200\n     assert response.json() == {\"in\": \"router-decorator-depends\"}\n     app.dependency_overrides = {}\n+\n+\n+def test_missing_type_annotation_dependency():\n+    local_app = FastAPI()\n+\n+    def get_db():\n+        return \"db\"\n+\n+    with pytest.raises(FastAPIError) as exc:\n+\n+        @local_app.get(\"/bad\")\n+        def bad(dep=Depends(get_db)):\n+            return dep\n+\n+        TestClient(local_app)\n+\n+    msg = str(exc.value)\n+    assert \"Dependency parameter\" in msg\n+    assert \"type annotation\" in msg\n+    assert \"Depends\" in msg\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 261}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -46,7 +46,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -121,6 +121,7 @@ def get_parameterless_sub_dependant(*, depends: params.Depends, path: str) -> De\n         call=depends.dependency,\n         scope=depends.scope,\n         own_oauth_scopes=own_oauth_scopes,\n+        enforce_annotation=False,\n     )\n \n \n@@ -248,6 +249,13 @@ def get_typed_return_annotation(call: Callable[..., Any]) -> Any:\n     return get_typed_annotation(annotation, globalns)\n \n \n+def _dependency_defines_type(depends: params.Depends) -> bool:\n+    dependency = depends.dependency\n+    if inspect.isclass(dependency):\n+        return True\n+    return get_typed_return_annotation(dependency) is not None\n+\n+\n def get_dependant(\n     *,\n     path: str,\n@@ -257,6 +265,7 @@ def get_dependant(\n     parent_oauth_scopes: Optional[list[str]] = None,\n     use_cache: bool = True,\n     scope: Union[Literal[\"function\", \"request\"], None] = None,\n+    enforce_annotation: bool = True,\n ) -> Dependant:\n     dependant = Dependant(\n         call=call,\n@@ -281,6 +290,15 @@ def get_dependant(\n         )\n         if param_details.depends is not None:\n             assert param_details.depends.dependency\n+            if (\n+                enforce_annotation\n+                and param.annotation is inspect.Signature.empty\n+                and not _dependency_defines_type(param_details.depends)\n+            ):\n+                raise FastAPIError(\n+                    f'Dependency parameter \"{param_name}\" must have a type annotation. '\n+                    f\"For example: `{param_name}: SomeType = Depends(...)`\"\n+                )\n             if (\n                 (dependant.is_gen_callable or dependant.is_async_gen_callable)\n                 and dependant.computed_scope == \"request\"\n@@ -303,6 +321,7 @@ def get_dependant(\n                 parent_oauth_scopes=current_scopes,\n                 use_cache=param_details.depends.use_cache,\n                 scope=param_details.depends.scope,\n+                enforce_annotation=False,\n             )\n             dependant.dependencies.append(sub_dependant)\n             continue\n@@ -315,7 +334,11 @@ def get_dependant(\n                 f\"Cannot specify multiple FastAPI annotations for {param_name!r}\"\n             )\n             continue\n-        assert param_details.field is not None\n+        if enforce_annotation and param_details.field is None:\n+            raise FastAPIError(\n+                f'Dependency parameter \"{param_name}\" must have a type annotation. '\n+                f\"For example: `{param_name}: SomeType = Depends(...)`\"\n+            )\n         if isinstance(param_details.field.field_info, params.Body):\n             dependant.body_params.append(param_de\n\n```\n\n```diff\n@@ -456,7 +456,10 @@ def __init__(\n         self.dependencies = list(dependencies or [])\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         self.dependant = get_dependant(\n-            path=self.path_format, call=self.endpoint, scope=\"function\"\n+            path=self.path_format,\n+            call=self.endpoint,\n+            scope=\"function\",\n+            enforce_annotation=False,\n         )\n         for depends in self.dependencies[::-1]:\n             self.dependant.dependencies.insert(\n\n```\n\n```diff\n@@ -2,6 +2,7 @@\n \n import pytest\n from fastapi import APIRouter, Depends, FastAPI\n+from fastapi.exceptions import FastAPIError\n from fastapi.testclient import TestClient\n \n app = FastAPI()\n@@ -389,3 +390,23 @@ def test_override_with_sub_router_decorator_depends_k_bar():\n     assert response.status_code == 200\n     assert response.json() == {\"in\": \"router-decorator-depends\"}\n     app.dependency_overrides = {}\n+\n+\n+def test", "output": "Bug: Improve error message for missing dependency type annotation\n\nThis PR improves the error raised when a dependency parameter is missing a type annotation.\r\n\r\nPreviously, FastAPI would raise a generic AssertionError during dependency resolution, which made it difficult to understand what went wrong and how to fix it.\r\n\r\nChanges in this PR:\r\n- Replace the assertion with a FastAPIError that includes:\r\n  - the dependency parameter name\r\n  - a clear explanation of the issue\r\n  - an example of the correct annotation syntax\r\n- Ensure the error is only enforced in appropriate contexts to avoid breaking\r\n  parameter-less dependencies, dependency overrides, and WebSocket sub-dependencies\r\n- Add a test covering the missing type annotation case\r\n\r\nAll existing tests pass.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 261}
{"instruction": "Review the following code changes: Improve error message for missing dependency type annotation", "input": "```diff\n@@ -46,7 +46,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -121,6 +121,7 @@ def get_parameterless_sub_dependant(*, depends: params.Depends, path: str) -> De\n         call=depends.dependency,\n         scope=depends.scope,\n         own_oauth_scopes=own_oauth_scopes,\n+        enforce_annotation=False,\n     )\n \n \n@@ -248,6 +249,13 @@ def get_typed_return_annotation(call: Callable[..., Any]) -> Any:\n     return get_typed_annotation(annotation, globalns)\n \n \n+def _dependency_defines_type(depends: params.Depends) -> bool:\n+    dependency = depends.dependency\n+    if inspect.isclass(dependency):\n+        return True\n+    return get_typed_return_annotation(dependency) is not None\n+\n+\n def get_dependant(\n     *,\n     path: str,\n@@ -257,6 +265,7 @@ def get_dependant(\n     parent_oauth_scopes: Optional[list[str]] = None,\n     use_cache: bool = True,\n     scope: Union[Literal[\"function\", \"request\"], None] = None,\n+    enforce_annotation: bool = True,\n ) -> Dependant:\n     dependant = Dependant(\n         call=call,\n@@ -281,6 +290,15 @@ def get_dependant(\n         )\n         if param_details.depends is not None:\n             assert param_details.depends.dependency\n+            if (\n+                enforce_annotation\n+                and param.annotation is inspect.Signature.empty\n+                and not _dependency_defines_type(param_details.depends)\n+            ):\n+                raise FastAPIError(\n+                    f'Dependency parameter \"{param_name}\" must have a type annotation. '\n+                    f\"For example: `{param_name}: SomeType = Depends(...)`\"\n+                )\n             if (\n                 (dependant.is_gen_callable or dependant.is_async_gen_callable)\n                 and dependant.computed_scope == \"request\"\n@@ -303,6 +321,7 @@ def get_dependant(\n                 parent_oauth_scopes=current_scopes,\n                 use_cache=param_details.depends.use_cache,\n                 scope=param_details.depends.scope,\n+                enforce_annotation=False,\n             )\n             dependant.dependencies.append(sub_dependant)\n             continue\n@@ -315,7 +334,11 @@ def get_dependant(\n                 f\"Cannot specify multiple FastAPI annotations for {param_name!r}\"\n             )\n             continue\n-        assert param_details.field is not None\n+        if enforce_annotation and param_details.field is None:\n+            raise FastAPIError(\n+                f'Dependency parameter \"{param_name}\" must have a type annotation. '\n+                f\"For example: `{param_name}: SomeType = Depends(...)`\"\n+            )\n         if isinstance(param_details.field.field_info, params.Body):\n             dependant.body_params.append(param_de\n\n```\n\n```diff\n@@ -456,7 +456,10 @@ def __init__(\n         self.dependencies = list(dependencies or [])\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n         self.dependant = get_dependant(\n-            path=self.path_format, call=self.endpoint, scope=\"function\"\n+            path=self.path_format,\n+            call=self.endpoint,\n+            scope=\"function\",\n+            enforce_annotation=False,\n         )\n         for depends in self.dependencies[::-1]:\n             self.dependant.dependencies.insert(\n\n```\n\n```diff\n@@ -2,6 +2,7 @@\n \n import pytest\n from fastapi import APIRouter, Depends, FastAPI\n+from fastapi.exceptions import FastAPIError\n from fastapi.testclient import TestClient\n \n app = FastAPI()\n@@ -389,3 +390,23 @@ def test_override_with_sub_router_decorator_depends_k_bar():\n     assert response.status_code == 200\n     assert response.json() == {\"in\": \"router-decorator-depends\"}\n     app.dependency_overrides = {}\n+\n+\n+def test_missing_type_annotation_dependency():\n+    local_app = FastAPI()\n+\n+    def get_db():\n+        return \"db\"\n+\n+    with pytest.raises(FastAPIError) as exc:\n+\n+        @local_app.get(\"/bad\")\n+        def bad(dep=Depends(get_db)):\n+            return dep\n+\n+        TestClient(local_app)\n+\n+    msg = str(exc.value)\n+    assert \"Dependency parameter\" in msg\n+    assert \"type annotation\" in msg\n+    assert \"Depends\" in msg\n\n```", "output": "Changes look good. This PR implements: Improve error message for missing dependency type annotation", "source": "pr", "type": "code_review", "pr_number": 261}
{"instruction": "Review the following code changes: Add route-level middleware decorator with tests and docs example", "input": "```diff\n@@ -0,0 +1,29 @@\n+from fastapi import FastAPI, Request, route_middleware\n+\n+app = FastAPI()\n+\n+\n+# You can define your own middlewares\n+async def verify_jwt(req: Request):\n+    if req.query_params.get(\"token\") != \"secret\":\n+        from fastapi import HTTPException, status\n+\n+        raise HTTPException(\n+            status_code=status.HTTP_403_FORBIDDEN, detail=\"Invalid Token\"\n+        )\n+    req.scope[\"user\"] = \"admin\"\n+\n+\n+def log_route(req: Request):\n+    print(f\"Request to: {req.url.path}\")\n+\n+\n+@app.post(\"/secure\")\n+@route_middleware(verify_jwt, log_route)\n+async def secure_route(req: Request, is_true: bool):\n+    return {\"status\": \"ok\", \"is_true\": is_true, \"user\": req.scope.get(\"user\")}\n+\n+\n+@app.post(\"/open\")\n+async def open_route(is_true: bool):\n+    return {\"status\": \"open\", \"is_true\": is_true}\n\n```\n\n```diff\n@@ -20,6 +20,7 @@\n from .param_functions import Security as Security\n from .requests import Request as Request\n from .responses import Response as Response\n+from .route_middleware import route_middleware as route_middleware\n from .routing import APIRouter as APIRouter\n from .websockets import WebSocket as WebSocket\n from .websockets import WebSocketDisconnect as WebSocketDisconnect\n\n```\n\n```diff\n@@ -0,0 +1,22 @@\n+from functools import wraps\n+from typing import Any, Callable\n+\n+\n+def route_middleware(*middlewares: Callable[..., Any]) -> Callable[..., Any]:\n+    def decorator(route_func: Callable[..., Any]) -> Callable[..., Any]:\n+        @wraps(route_func)\n+        async def wrapper(*args: Any, **kwargs: Any) -> Any:\n+            req = kwargs.get(\"req\")\n+            if req is None:\n+                raise ValueError(\"Route must have 'request: Request' parameter\")\n+\n+            for middleware in middlewares:\n+                result = middleware(req)\n+                if callable(getattr(result, \"__await__\", None)):\n+                    await result\n+\n+            return await route_func(*args, **kwargs)\n+\n+        return wrapper\n+\n+    return decorator\n\n```\n\n```diff\n@@ -0,0 +1,65 @@\n+import pytest\n+from fastapi import FastAPI, Request\n+from fastapi.route_middleware import route_middleware\n+from fastapi.testclient import TestClient\n+\n+\n+# Example middlewares for testing\n+async def verify_jwt(req: Request):\n+    if not (req.query_params.get(\"is_true\") == \"true\"):\n+        req.scope[\"user\"] = {\"name\": \"xyz\", \"admin\": True}\n+        from fastapi import HTTPException, status\n+\n+        raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail=\"Invalid JWT\")\n+\n+\n+def log_route(req: Request):\n+    print(f\"[LOG] Path: {req.url.path}\")\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/secure\")\n+@route_middleware(verify_jwt, log_route)\n+async def secure_route(req: Request, is_true: bool):\n+    return {\"status\": \"ok\", \"is_true\": is_true, \"user\": req.scope.get(\"user\")}\n+\n+\n+@app.post(\"/open\")\n+async def open_route(is_true: bool):\n+    return {\"status\": \"open\", \"is_true\": is_true}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_secure_route_pass():\n+    response = client.post(\"/secure?is_true=true\")\n+    assert response.status_code == 200\n+\n+\n+def test_secure_route_fail():\n+    response = client.post(\"/secure?is_true=false\")\n+    assert response.status_code == 403\n+\n+\n+def test_open_route():\n+    response = client.post(\"/open?is_true=false\")\n+    assert response.status_code == 200\n+\n+\n+def test_route_middleware_wrong_param_name():\n+    # If the param name is not 'req', it should fail\n+    # We use a separate app to avoid polluting the main 'app'\n+    local_app = FastAPI()\n+\n+    @local_app.get(\"/wrong-param\")\n+    @route_middleware(log_route)\n+    async def wrong_param_handler(request: Request):\n+        return {\"msg\": \"ok\"}  # pragma: no cover\n+\n+    with pytest.raises(\n+        ValueError, match=\"Route must have 'request: Request' parameter\"\n+    ):\n+        TestClient(local_app).get(\"/wrong-param\")\n\n```\n\n```diff\n@@ -0,0 +1,29 @@\n+from fastapi import FastAPI, Request, route_middleware\n+\n+app = FastAPI()\n+\n+\n+# You can define your own middlewares\n+async def verify_jwt(req: Request):\n+    if req.query_params.get(\"token\") != \"secret\":\n\n```", "output": "Code Review for: Add route-level middleware decorator with tests and docs example\n\nüìù **docs_src/route_middleware/tutorial001.py**: We shouldn't teach people pass tokens via Query parameters..\n\nüìù **fastapi/route_middleware.py**: This requires the `Request` parameter to have specific name (`req`). This is inapropriate\n\n", "source": "pr", "type": "code_review", "pr_number": 260}
{"instruction": "Review this code change in `docs_src/route_middleware/tutorial001.py`", "input": "```diff\n@@ -0,0 +1,29 @@\n+from fastapi import FastAPI, Request, route_middleware\n+\n+app = FastAPI()\n+\n+\n+# You can define your own middlewares\n+async def verify_jwt(req: Request):\n+    if req.query_params.get(\"token\") != \"secret\":\n\n```", "output": "We shouldn't teach people pass tokens via Query parameters..", "source": "pr_review", "type": "inline_review", "pr_number": 260}
{"instruction": "Review this code change in `fastapi/route_middleware.py`", "input": "```diff\n@@ -0,0 +1,22 @@\n+from functools import wraps\n+from typing import Any, Callable\n+\n+\n+def route_middleware(*middlewares: Callable[..., Any]) -> Callable[..., Any]:\n+    def decorator(route_func: Callable[..., Any]) -> Callable[..., Any]:\n+        @wraps(route_func)\n+        async def wrapper(*args: Any, **kwargs: Any) -> Any:\n+            req = kwargs.get(\"req\")\n\n```", "output": "This requires the `Request` parameter to have specific name (`req`). This is inapropriate", "source": "pr_review", "type": "inline_review", "pr_number": 260}
{"instruction": "Review the following code changes: Feature/uploadfile read text", "input": "```diff\n@@ -137,6 +137,32 @@ async def close(self) -> None:\n         \"\"\"\n         return await super().close()\n \n+    async def read_text(\n+        self,\n+        encoding: Annotated[\n+            str,\n+            Doc(\"The text encoding to use when decoding bytes. Defaults to 'utf-8'.\"),\n+        ] = \"utf-8\",\n+    ) -> str:\n+        \"\"\"\n+        Read the entire file as a text string.\n+        This is a convenience wrapper around `await self.read()`\n+        that decodes the bytes using the given encoding.\n+        ## Example\n+        \n```\n\n```diff\n@@ -172,6 +172,9 @@ addopts = [\n ]\n xfail_strict = true\n junit_family = \"xunit2\"\n+markers = [\n+    \"asyncio: mark test to run with asyncio event loop\",\n+]\n filterwarnings = [\n     \"error\",\n     'ignore:starlette.middleware.wsgi is deprecated and will be removed in a future release\\..*:DeprecationWarning:starlette',\n\n```\n\n```diff\n@@ -1,6 +1,7 @@\n -e .[all]\n -r requirements-docs-tests.txt\n pytest >=7.1.3,<9.0.0\n+pytest-asyncio >=0.21.0,<0.25.0\n coverage[toml] >= 6.5.0,< 8.0\n mypy ==1.14.1\n dirty-equals ==0.9.0\n\n```\n\n```diff\n@@ -70,3 +70,17 @@ async def test_upload_file():\n     await file.seek(0)\n     assert await file.read() == b\"data and more data!\"\n     await file.close()\n+\n+\n+@pytest.mark.asyncio\n+async def test_uploadfile_read_text(tmp_path):\n+    file_path = tmp_path / \"sample.txt\"\n+    file_path.write_text(\"Hello FastAPI!\")\n+\n+    with open(file_path, \"rb\") as f:\n+        upload = UploadFile(filename=\"sample.txt\", file=f)\n+        content = await upload.read_text()\n+        assert content == \"Hello FastAPI!\"\n+        assert (\n+            upload.filename == \"sample.txt\"\n+        )  # make sure .read_text() doesn't modify filename or headers\n\n```", "output": "Changes look good. This PR implements: Feature/uploadfile read text", "source": "pr", "type": "code_review", "pr_number": 259}
{"instruction": "Review the following code changes: ‚ú® Support for mixed and multiple Pydantic models for parameters using Query, Cookie and Header", "input": "```diff\n@@ -181,13 +181,30 @@ def get_flat_dependant(\n def _get_flat_fields_from_params(fields: list[ModelField]) -> list[ModelField]:\n     if not fields:\n         return fields\n-    first_field = fields[0]\n-    if len(fields) == 1 and lenient_issubclass(\n-        first_field.field_info.annotation, BaseModel\n-    ):\n-        fields_to_extract = get_cached_model_fields(first_field.field_info.annotation)\n-        return fields_to_extract\n-    return fields\n+\n+    return [field for field, _ in _get_flat_fields_from_params_with_origin(fields)]\n+\n+\n+def _get_flat_fields_from_params_with_origin(\n+    fields: Sequence[ModelField],\n+) -> Sequence[tuple[ModelField, ModelField]]:\n+    \"\"\"Same as :func:`_get_flat_fields_from_params`, but returns the result\n+    as tuples ``(flat_field, origin_field)``.\n+    \"\"\"\n+    result = []\n+    for field in fields:\n+        if lenient_issubclass(field.field_info.annotation, BaseModel):\n+            result.extend(\n+                [\n+                    (model_field, field)\n+                    for model_field in get_cached_model_fields(\n+                        field.field_info.annotation\n+                    )\n+                ]\n+            )\n+        else:\n+            result.append((field, field))\n+    return result\n \n \n def get_flat_params(dependant: Dependant) -> list[ModelField]:\n@@ -762,32 +779,23 @@ def request_params_to_args(\n     if not fields:\n         return values, errors\n \n-    first_field = fields[0]\n-    fields_to_extract = fields\n-    single_not_embedded_field = False\n-    default_convert_underscores = True\n-    if len(fields) == 1 and lenient_issubclass(\n-        first_field.field_info.annotation, BaseModel\n-    ):\n-        fields_to_extract = get_cached_model_fields(first_field.field_info.annotation)\n-        single_not_embedded_field = True\n-        # If headers are in a Pydantic model, the way to disable convert_underscores\n-        # would be with Header(convert_underscores=False) at the Pydantic model level\n-        default_convert_underscores = getattr(\n-            first_field.field_info, \"convert_underscores\", True\n-        )\n-\n+    fields_to_extract = _get_flat_fields_from_params_with_origin(fields)\n     params_to_process: dict[str, Any] = {}\n \n     processed_keys = set()\n \n-    for field in fields_to_extract:\n+    for field, base_field in fields_to_extract:\n         alias = None\n         if isinstance(received_params, Headers):\n             # Handle fields extracted from a Pydantic Model for a header, each field\n             # doesn't have a FieldInfo of type Header with the default convert_underscores=True\n+\n+            # If headers are in a Pydantic model, the way to disable convert_underscores\n+            # would be with Header(convert_underscores=False) at the Pydantic model level\n             convert_underscores = getattr(\n-                field.field_info, \"convert_underscores\", default_convert_underscores\n+                field.field_info,\n+                \"convert_underscores\",\n+         \n\n```\n\n```diff\n@@ -18,7 +18,7 @@\n from fastapi.datastructures import DefaultPlaceholder\n from fastapi.dependencies.models import Dependant\n from fastapi.dependencies.utils import (\n-    _get_flat_fields_from_params,\n+    _get_flat_fields_from_params_with_origin,\n     get_flat_dependant,\n     get_flat_params,\n     get_validation_alias,\n@@ -35,7 +35,6 @@\n     generate_operation_id_for_path,\n     is_body_allowed_for_status_code,\n )\n-from pydantic import BaseModel\n from starlette.responses import JSONResponse\n from starlette.routing import BaseRoute\n from typing_extensions import Literal\n@@ -116,25 +115,22 @@ def _get_openapi_operation_parameters(\n ) -> list[dict[str, Any]]:\n     parameters = []\n     flat_dependant = get_flat_dependant(dependant, skip_repeats=True)\n-    path_params = _get_flat_fields_from_params(flat_dependant.path_params)\n-    query_params = _get_flat_fields_from_params(flat_dependant.query_params)\n-    header_params = _get_flat_fields_from_params(flat_dependant.header_params)\n-    cookie_params = _get_flat_fields_from_params(flat_dependant.cookie_params)\n+    path_params = _get_flat_fields_from_params_with_origin(flat_dependant.path_params)\n+    query_params = _get_flat_fields_from_params_with_origin(flat_dependant.query_params)\n+    header_params = _get_flat_fields_from_params_with_origin(\n+        flat_dependant.header_params\n+    )\n+    cookie_params = _get_flat_fields_from_params_with_origin(\n+        flat_dependant.cookie_params\n+    )\n     parameter_groups = [\n         (ParamTypes.path, path_params),\n         (ParamTypes.query, query_params),\n         (ParamTypes.header, header_params),\n         (ParamTypes.cookie, cookie_params),\n     ]\n-    default_convert_underscores = True\n-    if len(flat_dependant.header_params) == 1:\n-        first_field = flat_dependant.header_params[0]\n-        if lenient_issubclass(first_field.field_info.annotation, BaseModel):\n-            default_convert_underscores = getattr(\n-                first_field.fie", "output": "Changes look good. This PR implements: ‚ú® Support for mixed and multiple Pydantic models for parameters using Query, Cookie and Header", "source": "pr", "type": "code_review", "pr_number": 258}
{"instruction": "Review the following code changes: ‚úÖ Add inline snapshot tests for OpenAPI before changes from Pydantic v2", "input": "```diff\n@@ -1,5 +1,6 @@\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n from pydantic import BaseModel\n \n app = FastAPI()\n@@ -26,84 +27,88 @@ def test_additional_properties_post():\n def test_openapi_schema():\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n-    assert response.json() == {\n-        \"openapi\": \"3.1.0\",\n-        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n-        \"paths\": {\n-            \"/foo\": {\n-                \"post\": {\n-                    \"responses\": {\n-                        \"200\": {\n-                            \"description\": \"Successful Response\",\n-                            \"content\": {\"application/json\": {\"schema\": {}}},\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/foo\": {\n+                    \"post\": {\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\"application/json\": {\"schema\": {}}},\n+                            },\n+                            \"422\": {\n+                                \"description\": \"Validation Error\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/HTTPValidationError\"\n+                                        }\n+                                    }\n+                                },\n+                            },\n                         },\n-                        \"422\": {\n-                            \"description\": \"Validation Error\",\n+                        \"summary\": \"Foo\",\n+                        \"operationId\": \"foo_foo_post\",\n+                        \"requestBody\": {\n                             \"content\": {\n                                 \"application/json\": {\n-                                    \"schema\": {\n-                                        \"$ref\": \"#/components/schemas/HTTPValidationError\"\n-                                    }\n+                                    \"schema\": {\"$ref\": \"#/components/schemas/Items\"}\n                                 }\n                             },\n+                            \"required\": True,\n                         },\n-                    },\n-                    \"summary\": \"Foo\",\n-                    \"operationId\": \"foo_foo_post\",\n-                    \"requestBody\": {\n-                        \"content\": {\n-                            \"application/json\": {\n-                                \"schema\": {\"$ref\": \"#/components/schemas/Items\"}\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+              \n\n```\n\n```diff\n@@ -2,6 +2,7 @@\n \n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n from pydantic import BaseModel, ConfigDict\n \n \n@@ -40,83 +41,87 @@ def test_call_valid():\n def test_openapi_schema():\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n-    assert response.json() == {\n-        \"openapi\": \"3.1.0\",\n-        \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n-        \"paths\": {\n-            \"/\": {\n-                \"post\": {\n-                    \"summary\": \"Post\",\n-                    \"operationId\": \"post__post\",\n-                    \"requestBody\": {\n-                        \"content\": {\n-                            \"application/json\": {\n-                                \"schema\": {\n-                                    \"anyOf\": [\n-                                        {\"$ref\": \"#/components/schemas/Foo\"},\n-                                        {\"type\": \"null\"},\n-                                    ],\n-                                    \"title\": \"Foo\",\n-                                }\n-                            }\n-                        }\n-                    },\n-                    \"responses\": {\n-                        \"200\": {\n-                            \"description\": \"Successful Response\",\n-                            \"content\": {\"application/json\": {\"schema\": {}}},\n-                        },\n-                        \"422\": {\n-                            \"description\": \"Validation Error\",\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"post\": {\n+                        \"summary\": \"Post\",\n+                        \"operationId\": \"post__post\",\n+                        \"requestBody\": {\n                             \"content\": {\n                                 \"a", "output": "Changes look good. This PR implements: ‚úÖ Add inline snapshot tests for OpenAPI before changes from Pydantic v2", "source": "pr", "type": "code_review", "pr_number": 257}
{"instruction": "Fix the following bug: ‚úÖ Fix parameterized tests with snapshots", "input": "Currently tests fail if we try running them locally as reported in https://github.com/fastapi/fastapi/pull/14864#issuecomment-3871166659\r\n\r\nIn CI tests pass because `inline-snapshot` can detect CI environment and runs with `--inline-snapshot=disable`.\r\nSee: https://15r10nk.github.io/inline-snapshot/latest/pytest/#-inline-snapshotdisable\r\n\r\n---\r\n\r\nTo prevent this from happening again, I think we should set the `INLINE_SNAPSHOT_DEFAULT_FLAGS=review` in CI.\r\nSee: [docs](https://15r10nk.github.io/inline-snapshot/latest/configuration/) and [sources](https://github.com/15r10nk/inline-snapshot/blob/8e3d926ada6ef411f8a3e747caa97ba9324bca54/src/inline_snapshot/_snapshot_session.py#L284-L295)", "output": "```diff\n@@ -3,7 +3,7 @@\n import pytest\n from fastapi import FastAPI, Path\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n app = FastAPI()\n \n@@ -58,8 +58,8 @@ def test_schema(path: str, expected_name: str, expected_title: str):\n         [\n             {\n                 \"required\": True,\n-                \"schema\": {\"title\": expected_title, \"type\": \"string\"},\n-                \"name\": expected_name,\n+                \"schema\": {\"title\": Is(expected_title), \"type\": \"string\"},\n+                \"name\": Is(expected_name),\n                 \"in\": \"path\",\n             }\n         ]\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import pytest\n from dirty_equals import IsList\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -212,7 +212,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                                 \"title\": \"Tax\",\n                                 \"anyOf\": [{\"type\": \"number\"}, {\"type\": \"null\"}],\n                             },\n-                            \"tags\": tags_schema,\n+                            \"tags\": Is(tags_schema),\n                         },\n                         \"required\": [\n                             \"name\",\n\n```\n\n```diff\n@@ -2,7 +2,7 @@\n \n import pytest\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n \n @pytest.fixture(\n@@ -59,7 +59,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                         \"responses\": {\n                             \"200\": {\n                                 \"description\": \"Successful Response\",\n-                                \"content\": response_content,\n+                                \"content\": Is(response_content),\n                             }\n                         },\n                         \"summary\": \"Read Items\",\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n import pytest\n from dirty_equals import IsList\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -75,7 +75,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                 \"/items/\": {\n                     \"post\": {\n                         \"summary\": \"Create an item\",\n-                        \"description\": DESCRIPTIONS[mod_name],\n+                        \"description\": Is(DESCRIPTIONS[mod_name]),\n                         \"operationId\": \"create_item_items__post\",\n                         \"requestBody\": {\n                             \"content\": {\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import pytest\n from fastapi._compat import PYDANTIC_VERSION_MINOR_TUPLE\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -66,6 +66,23 @@ def test_query_params_str_validations_item_query_nonregexquery(client: TestClien\n def test_openapi_schema(client: TestClient):\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n+\n+    parameters_schema = {\n+        \"anyOf\": [\n+            {\n+                \"type\": \"string\",\n+                \"minLength\": 3,\n+                \"maxLength\": 50,\n+                \"pattern\": \"^fixedquery$\",\n+            },\n+            {\"type\": \"null\"},\n+        ],\n+        \"title\": \"Query string\",\n+        \"description\": \"Query string for the items to search in the database that have a good match\",\n+        # See https://github.com/pydantic/pydantic/blob/80353c29a824c55dea4667b328ba8f329879ac9f/tests/test_fastapi.sh#L25-L34.\n+        **({\"deprecated\": True} if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 10) else {}),\n+    }\n+\n     assert response.json() == snapshot(\n         {\n             \"openapi\": \"3.1.0\",\n@@ -96,25 +113,7 @@ def test_openapi_schema(client: TestClient):\n                                 \"description\": \"Query string for the items to search in the database that have a good match\",\n                                 \"required\": False,\n                                 \"deprecated\": True,\n-                                \"schema\": {\n-                                    \"anyOf\": [\n-                                        {\n-                                            \"type\": \"string\",\n-                                            \"minLength\": 3,\n-                                            \"maxLength\": 50,\n-                                            \"pattern\": \"^fixedquery$\",\n-                                        },\n-                                        {\"type\": \"null\"},\n-                                    ],\n-                                    \"title\": \"Query string\",\n-                                    \"description\": \"Query string for the items to search in the database that have a good match\",\n-                                    # See https://github.com/pydantic/pydantic/blob/80353c29a824c55dea4667b328ba8f329879ac9f/tests/test_fastapi.sh#L25-L34.\n-                                    **(\n-                                        {\"deprecated\": True}\n-                                        if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 10)\n-                                        else {}\n-                                    ),\n-                                },\n+                                \"schema\": Is(parameters_schema),\n                                 \"name\": \"item-query\",\n                                 \"in\": \"query\",\n                             }\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 256}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -3,7 +3,7 @@\n import pytest\n from fastapi import FastAPI, Path\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n app = FastAPI()\n \n@@ -58,8 +58,8 @@ def test_schema(path: str, expected_name: str, expected_title: str):\n         [\n             {\n                 \"required\": True,\n-                \"schema\": {\"title\": expected_title, \"type\": \"string\"},\n-                \"name\": expected_name,\n+                \"schema\": {\"title\": Is(expected_title), \"type\": \"string\"},\n+                \"name\": Is(expected_name),\n                 \"in\": \"path\",\n             }\n         ]\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import pytest\n from dirty_equals import IsList\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -212,7 +212,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                                 \"title\": \"Tax\",\n                                 \"anyOf\": [{\"type\": \"number\"}, {\"type\": \"null\"}],\n                             },\n-                            \"tags\": tags_schema,\n+                            \"tags\": Is(tags_schema),\n                         },\n                         \"required\": [\n                             \"name\",\n\n```\n\n```diff\n@@ -2,7 +2,7 @@\n \n import pytest\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n \n @pytest.fixture(\n@@ -59,7 +59,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                         \"responses\": {\n                             \"200\": {\n                                 \"description\": \"Successful Response\",\n-                                \"content\": response_content,\n+                                \"content\": Is(response_content),\n                             }\n                         },\n                         \"summary\": \"Read Items\",\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n import pytest\n from dirty_equals import IsList\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -75,7 +75,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                 \"/items/\": {\n                     \"post\": {\n                         \"summary\": \"Create an item\",\n-                        \"description\": DESCRIPTIONS[mod_name],\n+                        \"description\": Is(DESCRIPTIONS[mod_name]),\n                         \"operationId\": \"create_item_items__post\",\n                         \"requestBody\": {\n                             \"content\": {\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import pytest\n from fastapi._compat import PYDANTIC_VERSION_MINOR_TUPLE\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -66,6 +66,23 @@ def test_query_params_str_validations_item_query_nonregexquery(client: TestClien\n def test_openapi_schema(client: TestClient):\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n+\n+    parameters_schema = {\n+        \"anyOf\": [\n+            {\n+                \"type\": \"string\",\n+                \"minLength\": 3,\n+                \"maxLength\": 50,\n+                \"pattern\": \"^fixedquery$\",\n+            },\n+            {\"type\": \"null\"},\n+        ],\n+        \"title\": \"Query string\",\n+        \"description\": \"Query string for the items to search in the database that have a good match\",\n+        # See https://github.com/pydantic/pydantic/blob/80353c29a824c55dea4667b328ba8f329879ac9f/tests/test_fastapi.sh#L25-L34.\n+        **({\"deprecated\": True} if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 10) else {}),\n+    }\n+\n     assert response.json() == snapshot(\n         {\n             \"openapi\": \"3.1.0\",\n@@ -96,25 +113,7 @@ def test_openapi_schema(client: TestClie", "output": "Bug: ‚úÖ Fix parameterized tests with snapshots\n\nCurrently tests fail if we try running them locally as reported in https://github.com/fastapi/fastapi/pull/14864#issuecomment-3871166659\r\n\r\nIn CI tests pass because `inline-snapshot` can detect CI environment and runs with `--inline-snapshot=disable`.\r\nSee: https://15r10nk.github.io/inline-snapshot/latest/pytest/#-inline-snapshotdisable\r\n\r\n---\r\n\r\nTo prevent this from happening again, I think we should set the `INLINE_SNAPSHOT_DEFAULT_FLAGS=review` in CI.\r\nSee: [docs](https://15r10nk.github.io/inline-snapshot/latest/configuration/) and [sources](https://github.com/15r10nk/inline-snapshot/blob/8e3d926ada6ef411f8a3e747caa97ba9324bca54/src/inline_snapshot/_snapshot_session.py#L284-L295)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 256}
{"instruction": "Review the following code changes: ‚úÖ Fix parameterized tests with snapshots", "input": "```diff\n@@ -3,7 +3,7 @@\n import pytest\n from fastapi import FastAPI, Path\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n app = FastAPI()\n \n@@ -58,8 +58,8 @@ def test_schema(path: str, expected_name: str, expected_title: str):\n         [\n             {\n                 \"required\": True,\n-                \"schema\": {\"title\": expected_title, \"type\": \"string\"},\n-                \"name\": expected_name,\n+                \"schema\": {\"title\": Is(expected_title), \"type\": \"string\"},\n+                \"name\": Is(expected_name),\n                 \"in\": \"path\",\n             }\n         ]\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import pytest\n from dirty_equals import IsList\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -212,7 +212,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                                 \"title\": \"Tax\",\n                                 \"anyOf\": [{\"type\": \"number\"}, {\"type\": \"null\"}],\n                             },\n-                            \"tags\": tags_schema,\n+                            \"tags\": Is(tags_schema),\n                         },\n                         \"required\": [\n                             \"name\",\n\n```\n\n```diff\n@@ -2,7 +2,7 @@\n \n import pytest\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n \n @pytest.fixture(\n@@ -59,7 +59,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                         \"responses\": {\n                             \"200\": {\n                                 \"description\": \"Successful Response\",\n-                                \"content\": response_content,\n+                                \"content\": Is(response_content),\n                             }\n                         },\n                         \"summary\": \"Read Items\",\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n import pytest\n from dirty_equals import IsList\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -75,7 +75,7 @@ def test_openapi_schema(client: TestClient, mod_name: str):\n                 \"/items/\": {\n                     \"post\": {\n                         \"summary\": \"Create an item\",\n-                        \"description\": DESCRIPTIONS[mod_name],\n+                        \"description\": Is(DESCRIPTIONS[mod_name]),\n                         \"operationId\": \"create_item_items__post\",\n                         \"requestBody\": {\n                             \"content\": {\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import pytest\n from fastapi._compat import PYDANTIC_VERSION_MINOR_TUPLE\n from fastapi.testclient import TestClient\n-from inline_snapshot import snapshot\n+from inline_snapshot import Is, snapshot\n \n from ...utils import needs_py310\n \n@@ -66,6 +66,23 @@ def test_query_params_str_validations_item_query_nonregexquery(client: TestClien\n def test_openapi_schema(client: TestClient):\n     response = client.get(\"/openapi.json\")\n     assert response.status_code == 200, response.text\n+\n+    parameters_schema = {\n+        \"anyOf\": [\n+            {\n+                \"type\": \"string\",\n+                \"minLength\": 3,\n+                \"maxLength\": 50,\n+                \"pattern\": \"^fixedquery$\",\n+            },\n+            {\"type\": \"null\"},\n+        ],\n+        \"title\": \"Query string\",\n+        \"description\": \"Query string for the items to search in the database that have a good match\",\n+        # See https://github.com/pydantic/pydantic/blob/80353c29a824c55dea4667b328ba8f329879ac9f/tests/test_fastapi.sh#L25-L34.\n+        **({\"deprecated\": True} if PYDANTIC_VERSION_MINOR_TUPLE >= (2, 10) else {}),\n+    }\n+\n     assert response.json() == snapshot(\n         {\n             \"openapi\": \"3.1.0\",\n@@ -96,25 +113,7 @@ def test_openapi_schema(client: TestClient):\n                                 \"description\": \"Query string for the items to search in the database that have a good match\",\n                                 \"required\": False,\n                                 \"deprecated\": True,\n-                                \"schema\": {\n-                                    \"anyOf\": [\n-                                        {\n-                                            \"type\": \"string\",\n-                                            \"minLength\": 3,\n-                                            \"maxLength\": 50,\n-                                            \"pattern\": \"^fixedquery$\",\n-                                        },\n-                                        {\"type\": \"null\"},\n-                                    ],\n-                                    \"title\": \"Query string\",\n-                                    \"description\": \"Query string for the items to search in the database that have a good match\",\n-                                ", "output": "Changes look good. This PR implements: ‚úÖ Fix parameterized tests with snapshots", "source": "pr", "type": "code_review", "pr_number": 256}
{"instruction": "Fix the following bug: üêõ Fix `on_startup` and `on_shutdown` parameters of `APIRouter`", "input": "This fixes the issue reported in this comment: https://github.com/fastapi/fastapi/pull/14851#issuecomment-3863896385\r\n\r\n```py\r\nfrom fastapi import FastAPI\r\n\r\n\r\ndef s_start():\r\n    print(\"SYNC START\", flush=True)\r\n\r\n\r\napp = FastAPI(on_startup=[s_start])\r\n\r\n\r\n@app.get(\"/health\")\r\nasync def health():\r\n    return {\"ok\": True}\r\n```\r\n\r\nStartup event is not called because `APIRouter.on_startup` is set in `APIRouter.__init__` before calling `super().__init__` and  is overridden by `router.__init__` (https://github.com/Kludex/starlette/blob/e5b8a5d200504a2608bed11fe6f66b1d20b9ae2c/starlette/routing.py#L597-L598)", "output": "```diff\n@@ -952,16 +952,6 @@ def __init__(\n             ),\n         ] = Default(generate_unique_id),\n     ) -> None:\n-        # Handle on_startup/on_shutdown locally since Starlette removed support\n-        # Ref: https://github.com/Kludex/starlette/pull/3117\n-        # TODO: deprecate this once the lifespan (or alternative) interface is improved\n-        self.on_startup: list[Callable[[], Any]] = (\n-            [] if on_startup is None else list(on_startup)\n-        )\n-        self.on_shutdown: list[Callable[[], Any]] = (\n-            [] if on_shutdown is None else list(on_shutdown)\n-        )\n-\n         # Determine the lifespan context to use\n         if lifespan is None:\n             # Use the default lifespan that runs on_startup/on_shutdown handlers\n@@ -985,6 +975,17 @@ def __init__(\n             assert not prefix.endswith(\"/\"), (\n                 \"A path prefix must not end with '/', as the routes will start with '/'\"\n             )\n+\n+        # Handle on_startup/on_shutdown locally since Starlette removed support\n+        # Ref: https://github.com/Kludex/starlette/pull/3117\n+        # TODO: deprecate this once the lifespan (or alternative) interface is improved\n+        self.on_startup: list[Callable[[], Any]] = (\n+            [] if on_startup is None else list(on_startup)\n+        )\n+        self.on_shutdown: list[Callable[[], Any]] = (\n+            [] if on_shutdown is None else list(on_shutdown)\n+        )\n+\n         self.prefix = prefix\n         self.tags: list[Union[str, Enum]] = tags or []\n         self.dependencies = list(dependencies or [])\n\n```\n\n```diff\n@@ -317,3 +317,63 @@ def main() -> dict[str, str]:\n         assert response.json() == {\"message\": \"Hello World\"}\n     assert state.app_startup is True\n     assert state.app_shutdown is True\n+\n+\n+def test_startup_shutdown_handlers_as_parameters(state: State) -> None:\n+    \"\"\"Test that startup/shutdown handlers passed as parameters to FastAPI are called correctly.\"\"\"\n+\n+    def app_startup() -> None:\n+        state.app_startup = True\n+\n+    def app_shutdown() -> None:\n+        state.app_shutdown = True\n+\n+    app = FastAPI(on_startup=[app_startup], on_shutdown=[app_shutdown])\n+\n+    @app.get(\"/\")\n+    def main() -> dict[str, str]:\n+        return {\"message\": \"Hello World\"}\n+\n+    def router_startup() -> None:\n+        state.router_startup = True\n+\n+    def router_shutdown() -> None:\n+        state.router_shutdown = True\n+\n+    router = APIRouter(on_startup=[router_startup], on_shutdown=[router_shutdown])\n+\n+    def sub_router_startup() -> None:\n+        state.sub_router_startup = True\n+\n+    def sub_router_shutdown() -> None:\n+        state.sub_router_shutdown = True\n+\n+    sub_router = APIRouter(\n+        on_startup=[sub_router_startup], on_shutdown=[sub_router_shutdown]\n+    )\n+\n+    router.include_router(sub_router)\n+    app.include_router(router)\n+\n+    assert state.app_startup is False\n+    assert state.router_startup is False\n+    assert state.sub_router_startup is False\n+    assert state.app_shutdown is False\n+    assert state.router_shutdown is False\n+    assert state.sub_router_shutdown is False\n+    with TestClient(app) as client:\n+        assert state.app_startup is True\n+        assert state.router_startup is True\n+        assert state.sub_router_startup is True\n+        assert state.app_shutdown is False\n+        assert state.router_shutdown is False\n+        assert state.sub_router_shutdown is False\n+        response = client.get(\"/\")\n+        assert response.status_code == 200, response.text\n+        assert response.json() == {\"message\": \"Hello World\"}\n+    assert state.app_startup is True\n+    assert state.router_startup is True\n+    assert state.sub_router_startup is True\n+    assert state.app_shutdown is True\n+    assert state.router_shutdown is True\n+    assert state.sub_router_shutdown is True\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 255}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -952,16 +952,6 @@ def __init__(\n             ),\n         ] = Default(generate_unique_id),\n     ) -> None:\n-        # Handle on_startup/on_shutdown locally since Starlette removed support\n-        # Ref: https://github.com/Kludex/starlette/pull/3117\n-        # TODO: deprecate this once the lifespan (or alternative) interface is improved\n-        self.on_startup: list[Callable[[], Any]] = (\n-            [] if on_startup is None else list(on_startup)\n-        )\n-        self.on_shutdown: list[Callable[[], Any]] = (\n-            [] if on_shutdown is None else list(on_shutdown)\n-        )\n-\n         # Determine the lifespan context to use\n         if lifespan is None:\n             # Use the default lifespan that runs on_startup/on_shutdown handlers\n@@ -985,6 +975,17 @@ def __init__(\n             assert not prefix.endswith(\"/\"), (\n                 \"A path prefix must not end with '/', as the routes will start with '/'\"\n             )\n+\n+        # Handle on_startup/on_shutdown locally since Starlette removed support\n+        # Ref: https://github.com/Kludex/starlette/pull/3117\n+        # TODO: deprecate this once the lifespan (or alternative) interface is improved\n+        self.on_startup: list[Callable[[], Any]] = (\n+            [] if on_startup is None else list(on_startup)\n+        )\n+        self.on_shutdown: list[Callable[[], Any]] = (\n+            [] if on_shutdown is None else list(on_shutdown)\n+        )\n+\n         self.prefix = prefix\n         self.tags: list[Union[str, Enum]] = tags or []\n         self.dependencies = list(dependencies or [])\n\n```\n\n```diff\n@@ -317,3 +317,63 @@ def main() -> dict[str, str]:\n         assert response.json() == {\"message\": \"Hello World\"}\n     assert state.app_startup is True\n     assert state.app_shutdown is True\n+\n+\n+def test_startup_shutdown_handlers_as_parameters(state: State) -> None:\n+    \"\"\"Test that startup/shutdown handlers passed as parameters to FastAPI are called correctly.\"\"\"\n+\n+    def app_startup() -> None:\n+        state.app_startup = True\n+\n+    def app_shutdown() -> None:\n+        state.app_shutdown = True\n+\n+    app = FastAPI(on_startup=[app_startup], on_shutdown=[app_shutdown])\n+\n+    @app.get(\"/\")\n+    def main() -> dict[str, str]:\n+        return {\"message\": \"Hello World\"}\n+\n+    def router_startup() -> None:\n+        state.router_startup = True\n+\n+    def router_shutdown() -> None:\n+        state.router_shutdown = True\n+\n+    router = APIRouter(on_startup=[router_startup], on_shutdown=[router_shutdown])\n+\n+    def sub_router_startup() -> None:\n+        state.sub_router_startup = True\n+\n+    def sub_router_shutdown() -> None:\n+        state.sub_router_shutdown = True\n+\n+    sub_router = APIRouter(\n+        on_startup=[sub_router_startup], on_shutdown=[sub_router_shutdown]\n+    )\n+\n+    router.include_router(sub_router)\n+    app.include_router(router)\n+\n+    assert state.app_startup is False\n+    assert state.router_startup is False\n+    assert state.sub_router_startup is False\n+    assert state.app_shutdown is False\n+    assert state.router_shutdown is False\n+    assert state.sub_router_shutdown is False\n+    with TestClient(app) as client:\n+        assert state.app_startup is True\n+        assert state.router_startup is True\n+        assert state.sub_router_startup is True\n+        assert state.app_shutdown is False\n+        assert state.router_shutdown is False\n+        assert state.sub_router_shutdown is False\n+        response = client.get(\"/\")\n+        assert response.status_code == 200, response.text\n+        assert response.json() == {\"message\": \"Hello World\"}\n+    assert state.app_startup is True\n+    assert state.router_startup is True\n+    assert state.sub_router_startup is True\n+    assert state.app_shutdown is True\n+    assert state.router_shutdown is True\n+    assert state.sub_router_shutdown is True\n\n```", "output": "Bug: üêõ Fix `on_startup` and `on_shutdown` parameters of `APIRouter`\n\nThis fixes the issue reported in this comment: https://github.com/fastapi/fastapi/pull/14851#issuecomment-3863896385\r\n\r\n```py\r\nfrom fastapi import FastAPI\r\n\r\n\r\ndef s_start():\r\n    print(\"SYNC START\", flush=True)\r\n\r\n\r\napp = FastAPI(on_startup=[s_start])\r\n\r\n\r\n@app.get(\"/health\")\r\nasync def health():\r\n    return {\"ok\": True}\r\n```\r\n\r\nStartup event is not called because `APIRouter.on_startup` is set in `APIRouter.__init__` before calling `super().__init__` and  is overridden by `router.__init__` (https://github.com/Kludex/starlette/blob/e5b8a5d200504a2608bed11fe6f66b1d20b9ae2c/starlette/routing.py#L597-L598)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 255}
{"instruction": "Review the following code changes: üêõ Fix `on_startup` and `on_shutdown` parameters of `APIRouter`", "input": "```diff\n@@ -952,16 +952,6 @@ def __init__(\n             ),\n         ] = Default(generate_unique_id),\n     ) -> None:\n-        # Handle on_startup/on_shutdown locally since Starlette removed support\n-        # Ref: https://github.com/Kludex/starlette/pull/3117\n-        # TODO: deprecate this once the lifespan (or alternative) interface is improved\n-        self.on_startup: list[Callable[[], Any]] = (\n-            [] if on_startup is None else list(on_startup)\n-        )\n-        self.on_shutdown: list[Callable[[], Any]] = (\n-            [] if on_shutdown is None else list(on_shutdown)\n-        )\n-\n         # Determine the lifespan context to use\n         if lifespan is None:\n             # Use the default lifespan that runs on_startup/on_shutdown handlers\n@@ -985,6 +975,17 @@ def __init__(\n             assert not prefix.endswith(\"/\"), (\n                 \"A path prefix must not end with '/', as the routes will start with '/'\"\n             )\n+\n+        # Handle on_startup/on_shutdown locally since Starlette removed support\n+        # Ref: https://github.com/Kludex/starlette/pull/3117\n+        # TODO: deprecate this once the lifespan (or alternative) interface is improved\n+        self.on_startup: list[Callable[[], Any]] = (\n+            [] if on_startup is None else list(on_startup)\n+        )\n+        self.on_shutdown: list[Callable[[], Any]] = (\n+            [] if on_shutdown is None else list(on_shutdown)\n+        )\n+\n         self.prefix = prefix\n         self.tags: list[Union[str, Enum]] = tags or []\n         self.dependencies = list(dependencies or [])\n\n```\n\n```diff\n@@ -317,3 +317,63 @@ def main() -> dict[str, str]:\n         assert response.json() == {\"message\": \"Hello World\"}\n     assert state.app_startup is True\n     assert state.app_shutdown is True\n+\n+\n+def test_startup_shutdown_handlers_as_parameters(state: State) -> None:\n+    \"\"\"Test that startup/shutdown handlers passed as parameters to FastAPI are called correctly.\"\"\"\n+\n+    def app_startup() -> None:\n+        state.app_startup = True\n+\n+    def app_shutdown() -> None:\n+        state.app_shutdown = True\n+\n+    app = FastAPI(on_startup=[app_startup], on_shutdown=[app_shutdown])\n+\n+    @app.get(\"/\")\n+    def main() -> dict[str, str]:\n+        return {\"message\": \"Hello World\"}\n+\n+    def router_startup() -> None:\n+        state.router_startup = True\n+\n+    def router_shutdown() -> None:\n+        state.router_shutdown = True\n+\n+    router = APIRouter(on_startup=[router_startup], on_shutdown=[router_shutdown])\n+\n+    def sub_router_startup() -> None:\n+        state.sub_router_startup = True\n+\n+    def sub_router_shutdown() -> None:\n+        state.sub_router_shutdown = True\n+\n+    sub_router = APIRouter(\n+        on_startup=[sub_router_startup], on_shutdown=[sub_router_shutdown]\n+    )\n+\n+    router.include_router(sub_router)\n+    app.include_router(router)\n+\n+    assert state.app_startup is False\n+    assert state.router_startup is False\n+    assert state.sub_router_startup is False\n+    assert state.app_shutdown is False\n+    assert state.router_shutdown is False\n+    assert state.sub_router_shutdown is False\n+    with TestClient(app) as client:\n+        assert state.app_startup is True\n+        assert state.router_startup is True\n+        assert state.sub_router_startup is True\n+        assert state.app_shutdown is False\n+        assert state.router_shutdown is False\n+        assert state.sub_router_shutdown is False\n+        response = client.get(\"/\")\n+        assert response.status_code == 200, response.text\n+        assert response.json() == {\"message\": \"Hello World\"}\n+    assert state.app_startup is True\n+    assert state.router_startup is True\n+    assert state.sub_router_startup is True\n+    assert state.app_shutdown is True\n+    assert state.router_shutdown is True\n+    assert state.sub_router_shutdown is True\n\n```", "output": "Changes look good. This PR implements: üêõ Fix `on_startup` and `on_shutdown` parameters of `APIRouter`", "source": "pr", "type": "code_review", "pr_number": 255}
{"instruction": "Review the following code changes: Docs: clarify handling of extra fields in request body", "input": "```diff\n@@ -55,6 +55,12 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n }\n \n```", "output": "Changes look good. This PR implements: Docs: clarify handling of extra fields in request body", "source": "pr", "type": "code_review", "pr_number": 254}
{"instruction": "Fix the following bug: üêõ Fix using `Json[list[str]]` type (issue #10997)", "input": "Fixes Form() not working with Pydantic `Json[T]` types when T is a sequence type (list, set, tuple).\r\n\r\nCloses #10997\r\n\r\nWhen using `Form()` with `Json[list[str]]`, FastAPI incorrectly treated it as a sequence field and used `getlist()`, wrapping the JSON string in a list. This caused Pydantic to fail parsing with:\r\n```\r\nTypeError: JSON input should be string, bytes or bytearray\r\n```\r\n\r\n**Before fix:**\r\n```python\r\n# Client sends\r\ndata = {\"items\": '[\"abc\", \"def\"]'}  # JSON string\r\n\r\n# FastAPI incorrectly does\r\nvalue = values.getlist(\"items\")  # ['[\"abc\", \"def\"]']  ‚ùå\r\n```\r\n\r\n**After fix:**\r\n```python\r\n# FastAPI correctly does\r\nvalue = values.get(\"items\")  # '[\"abc\", \"def\"]'  ‚úÖ\r\n```\r\n\r\nThis fix enables legitimate use cases like file uploads with JSON metadata:\r\n\r\n```python\r\n@app.post(\"/upload\")\r\ndef upload(\r\n    file: UploadFile,\r\n    tags: Annotated[Json[list[str]], Form()]\r\n):\r\n    return {\"file\": file.filename, \"tags\": tags}\r\n```\r\n\r\nPydantic v1 support for `Json[T]` with `Form()` is not included in this PR because `metadata` attribute does not exist in Pydantic v1's `FieldInfo`.\r\n\r\n## Related\r\n- Issue #10997", "output": "```diff\n@@ -51,7 +51,7 @@\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n from fastapi.utils import create_model_field, get_path_param_names\n-from pydantic import BaseModel\n+from pydantic import BaseModel, Json\n from pydantic.fields import FieldInfo\n from starlette.background import BackgroundTasks as StarletteBackgroundTasks\n from starlette.concurrency import run_in_threadpool\n@@ -726,11 +726,19 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    return any(type(item) is Json for item in field.field_info.metadata)\n+\n+\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n-    if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n+    if (\n+        (not _is_json_field(field))\n+        and is_sequence_field(field)\n+        and isinstance(values, (ImmutableMultiDict, Headers))\n+    ):\n         value = values.getlist(alias)\n     else:\n         value = values.get(alias, None)\n\n```\n\n```diff\n@@ -0,0 +1,63 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import Cookie, FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Json\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(items: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/query-json-list\")\n+def query_json_list(items: Annotated[Json[list[str]], Query()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/header-json-list\")\n+def header_json_list(x_items: Annotated[Json[list[str]], Header()]) -> list[str]:\n+    return x_items\n+\n+\n+@app.get(\"/cookie-json-list\")\n+def cookie_json_list(items: Annotated[Json[list[str]], Cookie()]) -> list[str]:\n+    return items\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_json_list():\n+    response = client.post(\n+        \"/form-json-list\", data={\"items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_query_json_list():\n+    response = client.get(\n+        \"/query-json-list\", params={\"items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_header_json_list():\n+    response = client.get(\n+        \"/header-json-list\", headers={\"x-items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_cookie_json_list():\n+    client.cookies.set(\"items\", json.dumps([\"abc\", \"def\"]))\n+    response = client.get(\"/cookie-json-list\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+    client.cookies.clear()\n\n```\n\n```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n\n```\n\n```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n+\n+\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n-    if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n+    if _is_json_field(field):\n+        value = values.get(alias, None)\n+    elif is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Json\n+\n+app = FastAPI()\n+\n+\n+class JsonListModel(BaseModel):\n+    json_list: Json[list[str]]\n+\n+\n+@app.post(\"/form-str\")\n+def form_str(json_list: Annotated[str, Form()]) -> list[str]:\n+    model = JsonListModel(json_list=json_list)  # type: ignore[arg-type]\n+    return model.json_list\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(json_list: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return json_list\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_str():\n+    response = client.post(\n+        \"/form-str\",\n+        data={\"json_list\": json.dumps([\"abc\", \"def\"])},\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 253}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -51,7 +51,7 @@\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n from fastapi.utils import create_model_field, get_path_param_names\n-from pydantic import BaseModel\n+from pydantic import BaseModel, Json\n from pydantic.fields import FieldInfo\n from starlette.background import BackgroundTasks as StarletteBackgroundTasks\n from starlette.concurrency import run_in_threadpool\n@@ -726,11 +726,19 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    return any(type(item) is Json for item in field.field_info.metadata)\n+\n+\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n-    if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n+    if (\n+        (not _is_json_field(field))\n+        and is_sequence_field(field)\n+        and isinstance(values, (ImmutableMultiDict, Headers))\n+    ):\n         value = values.getlist(alias)\n     else:\n         value = values.get(alias, None)\n\n```\n\n```diff\n@@ -0,0 +1,63 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import Cookie, FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Json\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(items: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/query-json-list\")\n+def query_json_list(items: Annotated[Json[list[str]], Query()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/header-json-list\")\n+def header_json_list(x_items: Annotated[Json[list[str]], Header()]) -> list[str]:\n+    return x_items\n+\n+\n+@app.get(\"/cookie-json-list\")\n+def cookie_json_list(items: Annotated[Json[list[str]], Cookie()]) -> list[str]:\n+    return items\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_json_list():\n+    response = client.post(\n+        \"/form-json-list\", data={\"items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_query_json_list():\n+    response = client.get(\n+        \"/query-json-list\", params={\"items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_header_json_list():\n+    response = client.get(\n+        \"/header-json-list\", headers={\"x-items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_cookie_json_list():\n+    client.cookies.set(\"items\", json.dumps([\"abc\", \"def\"]))\n+    response = client.get(\"/cookie-json-list\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+    client.cookies.clear()\n\n```\n\n```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n\n```\n\n```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n+\n+\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n-    if is_sequence_field(field) and isinstance(values, (ImmutableMultiDic", "output": "Bug: üêõ Fix using `Json[list[str]]` type (issue #10997)\n\nFixes Form() not working with Pydantic `Json[T]` types when T is a sequence type (list, set, tuple).\r\n\r\nCloses #10997\r\n\r\nWhen using `Form()` with `Json[list[str]]`, FastAPI incorrectly treated it as a sequence field and used `getlist()`, wrapping the JSON string in a list. This caused Pydantic to fail parsing with:\r\n```\r\nTypeError: JSON input should be string, bytes or bytearray\r\n```\r\n\r\n**Before fix:**\r\n```python\r\n# Client sends\r\ndata = {\"items\": '[\"abc\", \"def\"]'}  # JSON string\r\n\r\n# FastAPI incorrectly does\r\nvalue = values.getlist(\"items\")  # ['[\"abc\", \"def\"]']  ‚ùå\r\n```\r\n\r\n**After fix:**\r\n```python\r\n# FastAPI correctly does\r\nvalue = values.get(\"items\")  # '[\"abc\", \"def\"]'  ‚úÖ\r\n```\r\n\r\nThis fix enables legitimate use cases like file uploads with JSON metadata:\r\n\r\n```python\r\n@app.post(\"/upload\")\r\ndef upload(\r\n    file: UploadFile,\r\n    tags: Annotated[Json[list[str]], Form()]\r\n):\r\n    return {\"file\": file.filename, \"tags\": tags}\r\n```\r\n\r\nPydantic v1 support for `Json[T]` with `Form()` is not included in this PR because `metadata` attribute does not exist in Pydantic v1's `FieldInfo`.\r\n\r\n## Related\r\n- Issue #10997", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 253}
{"instruction": "Review the following code changes: üêõ Fix using `Json[list[str]]` type (issue #10997)", "input": "```diff\n@@ -51,7 +51,7 @@\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n from fastapi.utils import create_model_field, get_path_param_names\n-from pydantic import BaseModel\n+from pydantic import BaseModel, Json\n from pydantic.fields import FieldInfo\n from starlette.background import BackgroundTasks as StarletteBackgroundTasks\n from starlette.concurrency import run_in_threadpool\n@@ -726,11 +726,19 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    return any(type(item) is Json for item in field.field_info.metadata)\n+\n+\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n-    if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n+    if (\n+        (not _is_json_field(field))\n+        and is_sequence_field(field)\n+        and isinstance(values, (ImmutableMultiDict, Headers))\n+    ):\n         value = values.getlist(alias)\n     else:\n         value = values.get(alias, None)\n\n```\n\n```diff\n@@ -0,0 +1,63 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import Cookie, FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Json\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(items: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/query-json-list\")\n+def query_json_list(items: Annotated[Json[list[str]], Query()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/header-json-list\")\n+def header_json_list(x_items: Annotated[Json[list[str]], Header()]) -> list[str]:\n+    return x_items\n+\n+\n+@app.get(\"/cookie-json-list\")\n+def cookie_json_list(items: Annotated[Json[list[str]], Cookie()]) -> list[str]:\n+    return items\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_json_list():\n+    response = client.post(\n+        \"/form-json-list\", data={\"items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_query_json_list():\n+    response = client.get(\n+        \"/query-json-list\", params={\"items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_header_json_list():\n+    response = client.get(\n+        \"/header-json-list\", headers={\"x-items\": json.dumps([\"abc\", \"def\"])}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+\n+\n+def test_cookie_json_list():\n+    client.cookies.set(\"items\", json.dumps([\"abc\", \"def\"]))\n+    response = client.get(\"/cookie-json-list\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n+    client.cookies.clear()\n\n```\n\n```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n\n```\n\n```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n+\n+\n def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: Union[str, None] = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n-    if is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n+    if _is_json_field(field):\n+        value = values.get(alias, None)\n+    elif is_sequence_field(field) and isinstance(values, (ImmutableMultiDict, Headers)):\n\n```\n\n```diff\n@@ -0,0 +1,44 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Json\n+\n+app = FastAPI()\n+\n+\n+class JsonListModel(BaseModel):\n+    json_list: Json[list[str]]\n+\n+\n+@app.post(\"/form-str\")\n+def form_str(json_list: Annotated[str, Form()]) -> list[str]:\n+    model = JsonListModel(json_list=json_list)  # type: ignore[arg-type]\n+    return model.json_list\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(json_list: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return json_list\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_str():\n+    response = client.post(\n+        \"/form-str\",\n+        data={\"json_list\": json.dumps([\"abc\", \"def\"])},\n+    )\n+    assert response.status_code == 200, re", "output": "Code Review for: üêõ Fix using `Json[list[str]]` type (issue #10997)\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n    return any(isinstance(item, Json) for item in field.field_info.metadata)\r\n```\r\n\r\nFastAPI dropped the support of Pydantic V1 recently.\r\nWe can now simplify this.\r\nAlso, we should use `isinstance` to check type\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n    if (\r\n        (not _is_json_field(field))\r\n        and is_sequence_field(field)\r\n        and isinstance(values, (ImmutableMultiDict, Headers))\r\n    ):\r\n```\n\nüìù **tests/test_form_json_type.py**: ```suggestion\r\n```\r\nI think we don't need this test\n\nüìù **tests/test_form_json_type.py**: ```suggestion\r\n```\r\nI think we don't need this\n\nüìù **tests/test_form_json_type.py**: Could you please explain why you used `dict` here, not `list`?\r\nWith `dict` this test passes on `master` branch.\n\n", "source": "pr", "type": "code_review", "pr_number": 253}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -716,11 +716,22 @@ def _validate_value_with_model_field(\n         return v_, []\n \n \n+def _is_json_field(field: ModelField) -> bool:\n+    # Pydantic v1 FieldInfo doesn't have metadata attribute\n+    metadata = getattr(field.field_info, \"metadata\", [])\n+    return any(\n+        type(item).__name__ == \"Json\" and type(item).__module__ == \"pydantic.types\"\n+        for item in metadata\n+    )\n\n```", "output": "```suggestion\r\n    return any(isinstance(item, Json) for item in field.field_info.metadata)\r\n```\r\n\r\nFastAPI dropped the support of Pydantic V1 recently.\r\nWe can now simplify this.\r\nAlso, we should use `isinstance` to check type", "source": "pr_review", "type": "inline_review", "pr_number": 253}
{"instruction": "Review this code change in `tests/test_form_json_type.py`", "input": "```diff\n@@ -0,0 +1,44 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Json\n+\n+app = FastAPI()\n+\n+\n+class JsonListModel(BaseModel):\n+    json_list: Json[list[str]]\n+\n+\n+@app.post(\"/form-str\")\n+def form_str(json_list: Annotated[str, Form()]) -> list[str]:\n+    model = JsonListModel(json_list=json_list)  # type: ignore[arg-type]\n+    return model.json_list\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(json_list: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return json_list\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_str():\n+    response = client.post(\n+        \"/form-str\",\n+        data={\"json_list\": json.dumps([\"abc\", \"def\"])},\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\"abc\", \"def\"]\n\n```", "output": "```suggestion\r\n```\r\nI think we don't need this test", "source": "pr_review", "type": "inline_review", "pr_number": 253}
{"instruction": "Review this code change in `tests/test_form_json_type.py`", "input": "```diff\n@@ -0,0 +1,64 @@\n+import json\n+from typing import Annotated\n+\n+from fastapi import Cookie, FastAPI, Form, Header, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Json\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-json-list\")\n+def form_json_list(items: Annotated[Json[list[str]], Form()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/query-json-list\")\n+def query_json_list(items: Annotated[Json[list[str]], Query()]) -> list[str]:\n+    return items\n+\n+\n+@app.get(\"/header-json-list\")\n+def header_json_list(x_items: Annotated[Json[list[str]], Header()]) -> list[str]:\n+    return x_items\n+\n+\n+@app.get(\"/cookie-json-dict\")\n+def cookie_json_dict(\n+    session: Annotated[Json[dict[str, str]], Cookie()],\n\n```", "output": "Could you please explain why you used `dict` here, not `list`?\r\nWith `dict` this test passes on `master` branch.", "source": "pr_review", "type": "inline_review", "pr_number": 253}
{"instruction": "Review the following code changes: üîß Configure `test` workflow to run tests with `inline-snapshot=review`", "input": "```diff\n@@ -14,6 +14,7 @@ on:\n \n env:\n   UV_NO_SYNC: true\n+  INLINE_SNAPSHOT_DEFAULT_FLAGS: review\n \n jobs:\n   changes:\n\n```", "output": "Changes look good. This PR implements: üîß Configure `test` workflow to run tests with `inline-snapshot=review`", "source": "pr", "type": "code_review", "pr_number": 252}
{"instruction": "Fix the following bug: Fix annotations", "input": "", "output": "```diff\n@@ -445,7 +445,7 @@ def analyze_param(\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n-            field_info.annotation = type_annotation\n+            field_info.annotation = use_annotation\n \n     # Get Depends from type annotation\n     if depends is not None and depends.dependency is None:\n\n```\n\n```diff\n@@ -1393,6 +1393,10 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -0,0 +1,12 @@\n+import pytest\n+from fastapi import APIRouter\n+\n+\n+def test_router_circular_import():\n+    router = APIRouter()\n+\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Cannot include the same APIRouter instance into itself. Did you mean to include a different router?\",\n+    ):\n+        router.include_router(router)\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 251}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -445,7 +445,7 @@ def analyze_param(\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n-            field_info.annotation = type_annotation\n+            field_info.annotation = use_annotation\n \n     # Get Depends from type annotation\n     if depends is not None and depends.dependency is None:\n\n```\n\n```diff\n@@ -1393,6 +1393,10 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -0,0 +1,12 @@\n+import pytest\n+from fastapi import APIRouter\n+\n+\n+def test_router_circular_import():\n+    router = APIRouter()\n+\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Cannot include the same APIRouter instance into itself. Did you mean to include a different router?\",\n+    ):\n+        router.include_router(router)\n\n```", "output": "Bug: Fix annotations\n\n", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 251}
{"instruction": "Review the following code changes: Fix annotations", "input": "```diff\n@@ -445,7 +445,7 @@ def analyze_param(\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n-            field_info.annotation = type_annotation\n+            field_info.annotation = use_annotation\n \n     # Get Depends from type annotation\n     if depends is not None and depends.dependency is None:\n\n```\n\n```diff\n@@ -1393,6 +1393,10 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -0,0 +1,12 @@\n+import pytest\n+from fastapi import APIRouter\n+\n+\n+def test_router_circular_import():\n+    router = APIRouter()\n+\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Cannot include the same APIRouter instance into itself. Did you mean to include a different router?\",\n+    ):\n+        router.include_router(router)\n\n```", "output": "Changes look good. This PR implements: Fix annotations", "source": "pr", "type": "code_review", "pr_number": 251}
{"instruction": "Review the following code changes: ‚ú® Add `TypedState` special dependency", "input": "```diff\n@@ -21,5 +21,6 @@\n from .requests import Request as Request\n from .responses import Response as Response\n from .routing import APIRouter as APIRouter\n+from .types import TypedState as TypedState\n from .websockets import WebSocket as WebSocket\n from .websockets import WebSocketDisconnect as WebSocketDisconnect\n\n```\n\n```diff\n@@ -39,6 +39,7 @@ class Dependant:\n     background_tasks_param_name: Optional[str] = None\n     security_scopes_param_name: Optional[str] = None\n     security_scopes: Optional[List[str]] = None\n+    state_param_name: Optional[str] = None\n     use_cache: bool = True\n     path: Optional[str] = None\n     scope: Union[Literal[\"function\", \"request\"], None] = None\n\n```\n\n```diff\n@@ -59,7 +59,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.oauth2 import OAuth2, SecurityScopes\n from fastapi.security.open_id_connect_url import OpenIdConnect\n-from fastapi.types import DependencyCacheKey\n+from fastapi.types import DependencyCacheKey, RequestState, TypedState\n from fastapi.utils import create_model_field, get_path_param_names\n from pydantic import BaseModel\n from pydantic.fields import FieldInfo\n@@ -325,6 +325,9 @@ def add_non_field_param_to_dependency(\n     elif lenient_issubclass(type_annotation, SecurityScopes):\n         dependant.security_scopes_param_name = param_name\n         return True\n+    elif lenient_issubclass(type_annotation, RequestState):\n+        dependant.state_param_name = param_name\n+        return True\n     return None\n \n \n@@ -350,7 +353,10 @@ def analyze_param(\n         use_annotation = annotation\n         type_annotation = annotation\n     # Extract Annotated info\n-    if get_origin(use_annotation) is Annotated:\n+    origin = get_origin(annotation)\n+    if origin is TypedState:\n+        type_annotation = RequestState\n+    if origin is Annotated:\n         annotated_args = get_args(annotation)\n         type_annotation = annotated_args[0]\n         fastapi_annotations = [\n@@ -437,6 +443,7 @@ def analyze_param(\n             Response,\n             StarletteBackgroundTasks,\n             SecurityScopes,\n+            RequestState,\n         ),\n     ):\n         assert depends is None, f\"Cannot specify `Depends` for type {type_annotation!r}\"\n@@ -689,6 +696,8 @@ async def solve_dependencies(\n         values[dependant.security_scopes_param_name] = SecurityScopes(\n             scopes=dependant.security_scopes\n         )\n+    if dependant.state_param_name:\n+        values[dependant.state_param_name] = TypedState(_state=request.state._state)\n     return SolvedDependency(\n         values=values,\n         errors=errors,\n\n```\n\n```diff\n@@ -1,11 +1,53 @@\n import types\n from enum import Enum\n-from typing import Any, Callable, Dict, Optional, Set, Tuple, Type, TypeVar, Union\n+from typing import (\n+    Any,\n+    Callable,\n+    Dict,\n+    Generic,\n+    Optional,\n+    Set,\n+    Tuple,\n+    Type,\n+    TypeVar,\n+    Union,\n+)\n \n from pydantic import BaseModel\n \n DecoratedCallable = TypeVar(\"DecoratedCallable\", bound=Callable[..., Any])\n UnionType = getattr(types, \"UnionType\", Union)\n ModelNameMap = Dict[Union[Type[BaseModel], Type[Enum]], str]\n IncEx = Union[Set[int], Set[str], Dict[int, Any], Dict[str, Any]]\n+\n+\n+StateType = TypeVar(\"StateType\", bound=Dict[str, Any])\n+\n+\n+class RequestState:\n+    pass\n+\n+\n+class TypedState(RequestState, Generic[StateType]):\n+    def __init__(self, _state: StateType) -> None:\n+        super().__init__()\n+        self._state = _state\n+\n+    def __getattr__(self, item: str) -> Any:\n+        if item.startswith(\"_\"):\n+            # TODO: Restrict overriding of the _state attribute\n+            return object.__getattribute__(self, item)\n+        if item in self._state:\n+            return self._state[item]\n+        raise AttributeError(\n+            f\"'{self.__class__.__name__}' object has no attribute '{item}'\"\n+        )\n+\n+    def __setattr__(self, key: str, value: Any) -> None:\n+        if key.startswith(\"_\"):\n+            super().__setattr__(key, value)\n+        else:\n+            self._state[key] = value\n+\n+\n DependencyCacheKey = Tuple[Optional[Callable[..., Any]], Tuple[str, ...], str]\n\n```\n\n```diff\n@@ -0,0 +1,167 @@\n+from contextlib import asynccontextmanager\n+from typing import TypedDict\n+\n+import pytest\n+from fastapi import Depends, FastAPI, TypedState\n+from fastapi.testclient import TestClient\n+\n+\n+class MyState(TypedDict):\n+    param_1: str\n+    param_2: int\n+\n+\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    state = MyState(param_1=\"example\", param_2=42)\n+    yield state\n+\n+\n+app = FastAPI(lifespan=lifespan)\n+\n+\n+@app.get(\"/read\")\n+async def read_state(state: TypedState[MyState]):\n+    return {\"param_1\": state._state[\"param_1\"], \"param_2\": state._state[\"param_2\"]}\n+\n+\n+async def update_state(state: TypedState[MyState]):\n+    state._state[\"param_1\"] = \"Updated\"\n+\n+\n+@app.get(\"/updated-state\", dependencies=[Depends(update_state)])\n+async def read_updated_state(state: TypedState[MyState]):\n+    return {\"param_1\": state._st", "output": "Changes look good. This PR implements: ‚ú® Add `TypedState` special dependency", "source": "pr", "type": "code_review", "pr_number": 250}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Re-implement `on_event` in FastAPI for compatibility with the next Starlette, while keeping backwards compatibility", "input": "```diff\n@@ -1,22 +1,31 @@\n+import contextlib\n import email.message\n import functools\n import inspect\n import json\n+import types\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n     Collection,\n     Coroutine,\n+    Generator,\n     Mapping,\n     Sequence,\n )\n-from contextlib import AsyncExitStack, asynccontextmanager\n+from contextlib import (\n+    AbstractAsyncContextManager,\n+    AbstractContextManager,\n+    AsyncExitStack,\n+    asynccontextmanager,\n+)\n from enum import Enum, IntEnum\n from typing import (\n     Annotated,\n     Any,\n     Callable,\n     Optional,\n+    TypeVar,\n     Union,\n )\n \n@@ -143,6 +152,50 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n     return app\n \n \n+_T = TypeVar(\"_T\")\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+class _AsyncLiftContextManager(AbstractAsyncContextManager[_T]):\n+    \"\"\"\n+    Wraps a synchronous context manager to make it async.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+\n+    def __init__(self, cm: AbstractContextManager[_T]) -> None:\n+        self._cm = cm\n+\n+    async def __aenter__(self) -> _T:\n+        return self._cm.__enter__()\n+\n+    async def __aexit__(\n+        self,\n+        exc_type: Optional[type[BaseException]],\n+        exc_value: Optional[BaseException],\n+        traceback: Optional[types.TracebackType],\n+    ) -> Optional[bool]:\n+        return self._cm.__exit__(exc_type, exc_value, traceback)\n+\n+\n+# Vendored from starlette.routing to avoid importing private symbols\n+def _wrap_gen_lifespan_context(\n+    lifespan_context: Callable[[Any], Generator[Any, Any, Any]],\n+) -> Callable[[Any], AbstractAsyncContextManager[Any]]:\n+    \"\"\"\n+    Wrap a generator-based lifespan context into an async context manager.\n+\n+    This is vendored from Starlette to avoid importing private symbols.\n+    \"\"\"\n+    cmgr = contextlib.contextmanager(lifespan_context)\n+\n+    @functools.wraps(cmgr)\n+    def wrapper(app: Any) -> _AsyncLiftContextManager[Any]:\n+        return _AsyncLiftContextManager(cmgr(app))\n+\n+    return wrapper\n+\n+\n def _merge_lifespan_context(\n     original_context: Lifespan[Any], nested_context: Lifespan[Any]\n ) -> Lifespan[Any]:\n@@ -160,6 +213,30 @@ async def merged_lifespan(\n     return merged_lifespan  # type: ignore[return-value]\n \n \n+class _DefaultLifespan:\n+    \"\"\"\n+    Default lifespan context manager that runs on_startup and on_shutdown handlers.\n+\n+    This is a copy of the Starlette _DefaultLifespan class that was removed\n+    in Starlette. FastAPI keeps it to maintain backward compatibility with\n+    on_startup and on_shutdown event handlers.\n+\n+    Ref: https://github.com/Kludex/starlette/pull/3117\n+    \"\"\"\n+\n+    def __init__(self, router: \"APIRouter\") -> None:\n+        self._router = router\n+\n+    async def __aenter__(self) -> None:\n+        await self._router._startup()\n+\n+    async def __aexit__(self, *exc_info: object) -> None:\n+        await self._router._shutdown()\n+\n+    def \n\n```\n\n```diff\n@@ -241,3 +241,79 @@ async def sub_router_lifespan(app: FastAPI) -> AsyncGenerator[None, None]:\n \n     with TestClient(app) as client:\n         assert client.app_state == {\"router\": True}\n+\n+\n+@pytest.mark.filterwarnings(\n+    r\"ignore:\\s*on_event is deprecated, use lifespan event handlers instead.*:DeprecationWarning\"\n+)\n+def test_router_async_shutdown_handler(state: State) -> None:\n+    \"\"\"Test that async on_shutdown event handlers are called correctly, for coverage.\"\"\"\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def main() -> dict[str, str]:\n+        return {\"message\": \"Hello World\"}\n+\n+    @app.on_event(\"shutdown\")\n+    async def app_shutdown() -> None:\n+        state.app_shutdown = True\n+\n+    assert state.app_shutdown is False\n+    with TestClient(app) as client:\n+        assert state.app_shutdown is False\n+        response = client.get(\"/\")\n+        assert response.status_code == 200, response.text\n+    assert state.app_shutdown is True\n+\n+\n+def test_router_sync_generator_lifespan(state: State) -> None:\n+    \"\"\"Test that a sync generator lifespan works via _wrap_gen_lifespan_context.\"\"\"\n+    from collections.abc import Generator\n+\n+    def lifespan(app: FastAPI) -> Generator[None, None, None]:\n+        state.app_startup = True\n+        yield\n+        state.app_shutdown = True\n+\n+    app = FastAPI(lifespan=lifespan)  # type: ignore[arg-type]\n+\n+    @app.get(\"/\")\n+    def main() -> dict[str, str]:\n+        return {\"message\": \"Hello World\"}\n+\n+    assert state.app_startup is False\n+    assert state.app_shutdown is False\n+    with TestClient(app) as client:\n+        assert state.app_startup is True\n+        assert state.app_shutdown is False\n+        response = client.get(\"/\")\n+        assert response.status_code == 200, response.text\n+        assert response.json() == {\"message\": \"Hello World\"}\n+    assert state.app_startup is True\n+    assert state.app_shutdown is True\n+\n+\n+def test_router_async_generator_lifespan(state: State) -> None", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Re-implement `on_event` in FastAPI for compatibility with the next Starlette, while keeping backwards compatibility", "source": "pr", "type": "code_review", "pr_number": 249}
{"instruction": "Review the following code changes: Add default dependency scope", "input": "```diff\n@@ -27,7 +27,7 @@\n )\n from fastapi.openapi.utils import get_openapi\n from fastapi.params import Depends\n-from fastapi.types import DecoratedCallable, IncEx\n+from fastapi.types import DecoratedCallable, DependencyScope, IncEx\n from fastapi.utils import generate_unique_id\n from starlette.applications import Starlette\n from starlette.datastructures import State\n@@ -844,6 +844,12 @@ class Item(BaseModel):\n                 \"\"\"\n             ),\n         ] = None,\n+        default_dependency_scope: Annotated[\n+            DependencyScope,\n+            Doc(\"\"\"\n+                Default scope for dependencies that don't specify a scope.\n+                \"\"\"),\n+        ] = None,\n         **extra: Annotated[\n             Any,\n             Doc(\n@@ -873,6 +879,7 @@ class Item(BaseModel):\n         self.servers = servers or []\n         self.separate_input_output_schemas = separate_input_output_schemas\n         self.openapi_external_docs = openapi_external_docs\n+        self.default_dependency_scope = default_dependency_scope\n         self.extra = extra\n         self.openapi_version: Annotated[\n             str,\n@@ -1135,6 +1142,8 @@ async def redoc_html(req: Request) -> HTMLResponse:\n     async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n         if self.root_path:\n             scope[\"root_path\"] = self.root_path\n+        if self.default_dependency_scope:\n+            scope[\"fastapi_default_dependency_scope\"] = self.default_dependency_scope\n         await super().__call__(scope, receive, send)\n \n     def add_api_route(\n\n```\n\n```diff\n@@ -6,8 +6,7 @@\n \n from fastapi._compat import ModelField\n from fastapi.security.base import SecurityBase\n-from fastapi.types import DependencyCacheKey\n-from typing_extensions import Literal\n+from fastapi.types import DependencyCacheKey, DependencyScope\n \n if sys.version_info >= (3, 13):  # pragma: no cover\n     from inspect import iscoroutinefunction\n@@ -48,7 +47,7 @@ class Dependant:\n     parent_oauth_scopes: Optional[list[str]] = None\n     use_cache: bool = True\n     path: Optional[str] = None\n-    scope: Union[Literal[\"function\", \"request\"], None] = None\n+    scope: DependencyScope = None\n \n     @cached_property\n     def oauth_scopes(self) -> list[str]:\n\n```\n\n```diff\n@@ -49,7 +49,7 @@\n from fastapi.exceptions import DependencyScopeError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n-from fastapi.types import DependencyCacheKey\n+from fastapi.types import DependencyCacheKey, DependencyScope\n from fastapi.utils import create_model_field, get_path_param_names\n from pydantic import BaseModel, Json\n from pydantic.fields import FieldInfo\n@@ -65,7 +65,7 @@\n from starlette.requests import HTTPConnection, Request\n from starlette.responses import Response\n from starlette.websockets import WebSocket\n-from typing_extensions import Literal, get_args, get_origin\n+from typing_extensions import get_args, get_origin\n from typing_inspection.typing_objects import is_typealiastype\n \n multipart_not_installed_error = (\n@@ -262,7 +262,7 @@ def get_dependant(\n     own_oauth_scopes: Optional[list[str]] = None,\n     parent_oauth_scopes: Optional[list[str]] = None,\n     use_cache: bool = True,\n-    scope: Union[Literal[\"function\", \"request\"], None] = None,\n+    scope: DependencyScope = None,\n ) -> Dependant:\n     dependant = Dependant(\n         call=call,\n@@ -428,8 +428,7 @@ def analyze_param(\n     # Get Depends from default value\n     if isinstance(value, params.Depends):\n         assert depends is None, (\n-            \"Cannot specify `Depends` in `Annotated` and default value\"\n-            f\" together for {param_name!r}\"\n+            f\"Cannot specify `Depends` in `Annotated` and default value together for {param_name!r}\"\n         )\n         assert field_info is None, (\n             \"Cannot specify a FastAPI annotation in `Annotated` and `Depends` as a\"\n@@ -439,8 +438,7 @@ def analyze_param(\n     # Get FieldInfo from default value\n     elif isinstance(value, FieldInfo):\n         assert field_info is None, (\n-            \"Cannot specify FastAPI annotations in `Annotated` and default value\"\n-            f\" together for {param_name!r}\"\n+            f\"Cannot specify FastAPI annotations in `Annotated` and default value together for {param_name!r}\"\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n@@ -492,8 +490,7 @@ def analyze_param(\n         # Handle field_info.in_\n         if is_path_param:\n             assert isinstance(field_info, params.Path), (\n-                f\"Cannot use `{field_info.__class__.__name__}` for path param\"\n-                f\" {param_name!r}\"\n+                f\"Cannot use `{field_info.__class__.__name__}` for path param {param_name!r}\"\n             )\n         elif (\n             isinstance(field_info, params.Param)\n@@ -592,6 +589,7 @@ async def solve_dependencies(\n     assert isinstance(function_astack, AsyncExitStack), (\n         \"fastapi_function_astack not found in request scope\"\n     )", "output": "Changes look good. This PR implements: Add default dependency scope", "source": "pr", "type": "code_review", "pr_number": 248}
{"instruction": "Fix the following bug: Fix ModelField alias property", "input": "Hello!\r\n\r\nI've encountered an issue in FastAPI's `openapi.json` generation for parameter inputs (`Query`, `Header`, `Cookie`). When using `alias` for field names in Pydantic models, the alias appears correctly in the generated schema. However, when using `validation_alias`, it is ignored and the original field name is shown instead.\r\n\r\nTo demonstrate this behavior, I‚Äôve included minimal reproducible examples along with corresponding Swagger UI screenshots.\r\n\r\n\r\n### With alias\r\n```python\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Header, Query, Cookie\r\n\r\n\r\nclass DataModel(BaseModel):\r\n    foo: str = Field(..., alias=\"bar\")\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/test\")\r\ndef test(\r\n        query: Annotated[DataModel, Query(...)],\r\n        header: Annotated[DataModel, Header(...)],\r\n        cookie: Annotated[DataModel, Cookie(...)]\r\n):\r\n    return \"Received: \" + str(query) + \", \" + str(header) + \", \" + str(cookie)\r\n```\r\n<img width=\"386\" alt=\"image\" src=\"https://github.com/user-attachments/assets/23487069-f62b-4848-82c9-9f124a20553c\" />\r\n\r\n### With validation_alias\r\n```python\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Header, Query, Cookie\r\n\r\n\r\nclass DataModel(BaseModel):\r\n    foo: str = Field(..., validation_alias=\"bar\")\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/test\")\r\ndef test(\r\n        query: Annotated[DataModel, Query(...)],\r\n        header: Annotated[DataModel, Header(...)],\r\n        cookie: Annotated[DataModel, Cookie(...)]\r\n):\r\n    return \"Received: \" + str(query) + \", \" + str(header) + \", \" + str(cookie)\r\n```\r\n<img width=\"989\" alt=\"image\" src=\"https://github.com/user-attachments/assets/8737a452-2f4f-4c8b-a6a3-ff8426fb5284\" />\r\n\r\nAs shown above, even though validation_alias=\"bar\" is set, the OpenAPI schema still uses \"foo\".\r\n\r\nUpon inspecting the parameter generation logic, I found that the name used in the schema is determined via the field alias:\r\nhttps://github.com/fastapi/fastapi/blob/ebdeda2de6e17036e3048940b7a9e725ef6a95b7/fastapi/openapi/utils.py#L137\r\n\r\nThis uses Pydantic‚Äôs ModelField logic, where alias is returned if present; otherwise, the field name is used:\r\nhttps://github.com/fastapi/fastapi/blob/ebdeda2de6e17036e3048940b7a9e725ef6a95b7/fastapi/_compat.py#L88-L97\r\n\r\n### Proposed Change\r\nThis PR modifies the alias resolution logic in ModelField to prioritize validation_alias or serialization_alias, depending on mode, instead of defaulting to alias alone.\r\n\r\nThanks for taking the time to review this!", "output": "```diff\n@@ -93,7 +93,18 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            if (\n+                self.mode == \"validation\"\n+                and self.field_info.validation_alias is not None\n+            ):\n+                a = self.field_info.validation_alias\n+            elif (\n+                self.mode == \"serialization\"\n+                and self.field_info.serialization_alias is not None\n+            ):\n+                a = self.field_info.serialization_alias\n+            else:\n+                a = self.field_info.alias\n             return a if a is not None else self.name\n \n         @property\n\n```\n\n```diff\n@@ -26,6 +26,61 @@ def test_model_field_default_required():\n     assert field.default is Undefined\n \n \n+@needs_pydanticv2\n+def test_model_field_alias():\n+    field_info = FieldInfo(annotation=str, alias=\"foo\")\n+    field = ModelField(name=\"bar\", field_info=field_info)\n+    assert field.alias == \"foo\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_serialization_alias():\n+    field_info = FieldInfo(annotation=str, serialization_alias=\"foo\")\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"bar\"\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"foo\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_validation_alias():\n+    field_info = FieldInfo(annotation=str, validation_alias=\"foo\")\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"foo\"\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"bar\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_both_specialized_alias():\n+    field_info = FieldInfo(\n+        annotation=str, validation_alias=\"bar\", serialization_alias=\"baz\"\n+    )\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"bar\"\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"baz\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_alias_and_both_specialized_alias():\n+    field_info = FieldInfo(\n+        annotation=str, alias=\"bar\", validation_alias=\"baz\", serialization_alias=\"qux\"\n+    )\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"baz\"\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"qux\"\n+\n+\n @needs_pydanticv1\n def test_upload_file_dummy_with_info_plain_validator_function():\n     # For coverage\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI()\n+client = TestClient(app)\n+\n+\n+class DataModelWithoutAlias(BaseModel):\n+    foo: str = Field(...)\n+\n+\n+@app.get(\n+    \"/without-alias\",\n+    response_model=DataModelWithoutAlias,\n+)\n+def without_alias(data: Annotated[DataModelWithoutAlias, Query(...)]):\n+    return data\n+\n+\n+def test_openapi_param_name_without_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    openapi_schema = response.json()\n+\n+    assert (\n+        openapi_schema[\"paths\"][\"/without-alias\"][\"get\"][\"parameters\"][0][\"name\"]\n+        == \"foo\"\n+    )\n+    assert (\n+        openapi_schema[\"paths\"][\"/without-alias\"][\"get\"][\"parameters\"][0][\"in\"]\n+        == \"query\"\n+    )\n+    assert openapi_schema[\"components\"][\"schemas\"][\"DataModelWithoutAlias\"][\n+        \"properties\"\n+    ][\"foo\"] == {\"title\": \"Foo\", \"type\": \"string\"}\n+\n+\n+class DataModelWithAlias(BaseModel):\n+    foo: str = Field(..., alias=\"bar\")\n+\n+\n+@app.get(\n+    \"/with-alias\",\n+    response_model=DataModelWithAlias,\n+)\n+def with_alias(data: Annotated[DataModelWithAlias, Query(...)]):\n+    return data\n+\n+\n+def test_openapi_param_name_with_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    openapi_schema = response.json()\n+\n+    assert (\n+        openapi_schema[\"paths\"][\"/with-alias\"][\"get\"][\"parameters\"][0][\"name\"] == \"bar\"\n+    )\n+    assert (\n+        openapi_schema[\"paths\"][\"/with-alias\"][\"get\"][\"parameters\"][0][\"in\"] == \"query\"\n+    )\n+    assert openapi_schema[\"components\"][\"schemas\"][\"DataModelWithAlias\"][\"properties\"][\n+        \"bar\"\n+    ] == {\"title\": \"Bar\", \"type\": \"string\"}\n+\n+\n+class DataModelWithSerializationAlias(BaseModel):\n+    foo: str = Field(..., serialization_alias=\"bar\")\n+\n+\n+@app.get(\n+    \"/with-serialization-alias\",\n+    response_model=DataModelWithSerializationAlias,\n+)\n+def with_serialization_alias(\n+    data: Annotated[DataModelWithSerializationAlias, Query(...)],\n+):\n+    return data\n+\n+\n+def test_openapi_param_name_with_serialization_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    openapi_schema = response.json()\n+\n+    assert (\n+        openapi_schema[\"paths\"][\"/with-serialization-alias\"][\"get\"][\"parameters\"][0][\n+            \"name\"\n+        ]\n+        == \"foo\"\n+    )\n+    assert (\n+        openapi_schema[\"paths\"][\"/with-serialization-alias\"][\"get\"][\"parameters\"][0][\n+            \"in\"\n+        ]\n+        == \"query\"\n+    )\n+    assert openapi_schema[\"components\"][\"schemas\"][\"DataModelWithSerializationAlias\"][\n+        \"properties\"\n+    ][\"bar\"] == {\"title\": \"Bar\", \"type\": \"string\"}\n+\n+\n+class DataModelWithValidationAlias(BaseModel):\n+    foo: str = Field(..., validation_alias=\"bar\")\n+\n+\n+@app.get(\n+    \"/with-validation-alias\",\n+\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 247}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -93,7 +93,18 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            if (\n+                self.mode == \"validation\"\n+                and self.field_info.validation_alias is not None\n+            ):\n+                a = self.field_info.validation_alias\n+            elif (\n+                self.mode == \"serialization\"\n+                and self.field_info.serialization_alias is not None\n+            ):\n+                a = self.field_info.serialization_alias\n+            else:\n+                a = self.field_info.alias\n             return a if a is not None else self.name\n \n         @property\n\n```\n\n```diff\n@@ -26,6 +26,61 @@ def test_model_field_default_required():\n     assert field.default is Undefined\n \n \n+@needs_pydanticv2\n+def test_model_field_alias():\n+    field_info = FieldInfo(annotation=str, alias=\"foo\")\n+    field = ModelField(name=\"bar\", field_info=field_info)\n+    assert field.alias == \"foo\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_serialization_alias():\n+    field_info = FieldInfo(annotation=str, serialization_alias=\"foo\")\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"bar\"\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"foo\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_validation_alias():\n+    field_info = FieldInfo(annotation=str, validation_alias=\"foo\")\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"foo\"\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"bar\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_both_specialized_alias():\n+    field_info = FieldInfo(\n+        annotation=str, validation_alias=\"bar\", serialization_alias=\"baz\"\n+    )\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"bar\"\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"baz\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_alias_and_both_specialized_alias():\n+    field_info = FieldInfo(\n+        annotation=str, alias=\"bar\", validation_alias=\"baz\", serialization_alias=\"qux\"\n+    )\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"baz\"\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"qux\"\n+\n+\n @needs_pydanticv1\n def test_upload_file_dummy_with_info_plain_validator_function():\n     # For coverage\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI()\n+client = TestClient(app)\n+\n+\n+class DataModelWithoutAlias(BaseModel):\n+    foo: str = Field(...)\n+\n+\n+@app.get(\n+    \"/without-alias\",\n+    response_model=DataModelWithoutAlias,\n+)\n+def without_alias(data: Annotated[DataModelWithoutAlias, Query(...)]):\n+    return data\n+\n+\n+def test_openapi_param_name_without_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    openapi_schema = response.json()\n+\n+    assert (\n+        openapi_schema[\"paths\"][\"/without-alias\"][\"get\"][\"parameters\"][0][\"name\"]\n+        == \"foo\"\n+    )\n+    assert (\n+        openapi_schema[\"paths\"][\"/without-alias\"][\"get\"][\"parameters\"][0][\"in\"]\n+        == \"query\"\n+    )\n+    assert openapi_schema[\"components\"][\"schemas\"][\"DataModelWithoutAlias\"][\n+        \"properties\"\n+    ][\"foo\"] == {\"title\": \"Foo\", \"type\": \"string\"}\n+\n+\n+class DataModelWithAlias(BaseModel):\n+    foo: str = Field(..., alias=\"bar\")\n+\n+\n+@app.get(\n+    \"/with-alias\",\n+    response_model=DataModelWithAlias,\n+)\n+def with_alias(data: Annotated[DataModelWithAlias, Query(...)]):\n+    return data\n+\n+\n+def test_openap", "output": "Bug: Fix ModelField alias property\n\nHello!\r\n\r\nI've encountered an issue in FastAPI's `openapi.json` generation for parameter inputs (`Query`, `Header`, `Cookie`). When using `alias` for field names in Pydantic models, the alias appears correctly in the generated schema. However, when using `validation_alias`, it is ignored and the original field name is shown instead.\r\n\r\nTo demonstrate this behavior, I‚Äôve included minimal reproducible examples along with corresponding Swagger UI screenshots.\r\n\r\n\r\n### With alias\r\n```python\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Header, Query, Cookie\r\n\r\n\r\nclass DataModel(BaseModel):\r\n    foo: str = Field(..., alias=\"bar\")\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/test\")\r\ndef test(\r\n        query: Annotated[DataModel, Query(...)],\r\n        header: Annotated[DataModel, Header(...)],\r\n        cookie: Annotated[DataModel, Cookie(...)]\r\n):\r\n    return \"Received: \" + str(query) + \", \" + str(header) + \", \" + str(cookie)\r\n```\r\n<img width=\"386\" alt=\"image\" src=\"https://github.com/user-attachments/assets/23487069-f62b-4848-82c9-9f124a20553c\" />\r\n\r\n### With validation_alias\r\n```python\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Header, Query, Cookie\r\n\r\n\r\nclass DataModel(BaseModel):\r\n    foo: str = Field(..., validation_alias=\"bar\")\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/test\")\r\ndef test(\r\n        query: Annotated[DataModel, Query(...)],\r\n        header: Annotated[DataModel, Header(...)],\r\n        cookie: Annotated[DataModel, Cookie(...)]\r\n):\r\n    return \"Received: \" + str(query) + \", \" + str(header) + \", \" + str(cookie)\r\n```\r\n<img width=\"989\" alt=\"image\" src=\"https://github.com/user-attachments/assets/8737a452-2f4f-4c8b-a6a3-ff8426fb5284\" />\r\n\r\nAs shown above, even though validation_alias=\"bar\" is set, the OpenAPI schema still uses \"foo\".\r\n\r\nUpon inspecting the parameter generation logic, I found that the name used in the schema is determined via the field alias:\r\nhttps://github.com/fastapi/fastapi/blob/ebdeda2de6e17036e3048940b7a9e725ef6a95b7/fastapi/openapi/utils.py#L137\r\n\r\nThis uses Pydantic‚Äôs ModelField logic, where alias is returned if present; otherwise, the field name is used:\r\nhttps://github.com/fastapi/fastapi/blob/ebdeda2de6e17036e3048940b7a9e725ef6a95b7/fastapi/_compat.py#L88-L97\r\n\r\n### Proposed Change\r\nThis PR modifies the alias resolution logic in ModelField to prioritize validation_alias or serialization_alias, depending on mode, instead of defaulting to alias alone.\r\n\r\nThanks for taking the time to review this!", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 247}
{"instruction": "Review the following code changes: Fix ModelField alias property", "input": "```diff\n@@ -93,7 +93,18 @@ class ModelField:\n \n         @property\n         def alias(self) -> str:\n-            a = self.field_info.alias\n+            if (\n+                self.mode == \"validation\"\n+                and self.field_info.validation_alias is not None\n+            ):\n+                a = self.field_info.validation_alias\n+            elif (\n+                self.mode == \"serialization\"\n+                and self.field_info.serialization_alias is not None\n+            ):\n+                a = self.field_info.serialization_alias\n+            else:\n+                a = self.field_info.alias\n             return a if a is not None else self.name\n \n         @property\n\n```\n\n```diff\n@@ -26,6 +26,61 @@ def test_model_field_default_required():\n     assert field.default is Undefined\n \n \n+@needs_pydanticv2\n+def test_model_field_alias():\n+    field_info = FieldInfo(annotation=str, alias=\"foo\")\n+    field = ModelField(name=\"bar\", field_info=field_info)\n+    assert field.alias == \"foo\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_serialization_alias():\n+    field_info = FieldInfo(annotation=str, serialization_alias=\"foo\")\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"bar\"\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"foo\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_validation_alias():\n+    field_info = FieldInfo(annotation=str, validation_alias=\"foo\")\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"foo\"\n+\n+    field = ModelField(name=\"bar\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"bar\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_both_specialized_alias():\n+    field_info = FieldInfo(\n+        annotation=str, validation_alias=\"bar\", serialization_alias=\"baz\"\n+    )\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"bar\"\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"baz\"\n+\n+\n+@needs_pydanticv2\n+def test_model_field_alias_and_both_specialized_alias():\n+    field_info = FieldInfo(\n+        annotation=str, alias=\"bar\", validation_alias=\"baz\", serialization_alias=\"qux\"\n+    )\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"validation\")\n+    assert field.alias == \"baz\"\n+\n+    field = ModelField(name=\"foo\", field_info=field_info, mode=\"serialization\")\n+    assert field.alias == \"qux\"\n+\n+\n @needs_pydanticv1\n def test_upload_file_dummy_with_info_plain_validator_function():\n     # For coverage\n\n```\n\n```diff\n@@ -0,0 +1,208 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI()\n+client = TestClient(app)\n+\n+\n+class DataModelWithoutAlias(BaseModel):\n+    foo: str = Field(...)\n+\n+\n+@app.get(\n+    \"/without-alias\",\n+    response_model=DataModelWithoutAlias,\n+)\n+def without_alias(data: Annotated[DataModelWithoutAlias, Query(...)]):\n+    return data\n+\n+\n+def test_openapi_param_name_without_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    openapi_schema = response.json()\n+\n+    assert (\n+        openapi_schema[\"paths\"][\"/without-alias\"][\"get\"][\"parameters\"][0][\"name\"]\n+        == \"foo\"\n+    )\n+    assert (\n+        openapi_schema[\"paths\"][\"/without-alias\"][\"get\"][\"parameters\"][0][\"in\"]\n+        == \"query\"\n+    )\n+    assert openapi_schema[\"components\"][\"schemas\"][\"DataModelWithoutAlias\"][\n+        \"properties\"\n+    ][\"foo\"] == {\"title\": \"Foo\", \"type\": \"string\"}\n+\n+\n+class DataModelWithAlias(BaseModel):\n+    foo: str = Field(..., alias=\"bar\")\n+\n+\n+@app.get(\n+    \"/with-alias\",\n+    response_model=DataModelWithAlias,\n+)\n+def with_alias(data: Annotated[DataModelWithAlias, Query(...)]):\n+    return data\n+\n+\n+def test_openapi_param_name_with_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    openapi_schema = response.json()\n+\n+    assert (\n+        openapi_schema[\"paths\"][\"/with-alias\"][\"get\"][\"parameters\"][0][\"name\"] == \"bar\"\n+    )\n+    assert (\n+        openapi_schema[\"paths\"][\"/with-alias\"][\"get\"][\"parameters\"][0][\"in\"] == \"query\"\n+    )\n+    assert openapi_schema[\"components\"][\"schemas\"][\"DataModelWithAlias\"][\"properties\"][\n+        \"bar\"\n+    ] == {\"title\": \"Bar\", \"type\": \"string\"}\n+\n+\n+class DataModelWithSerializationAlias(BaseModel):\n+    foo: str = Field(..., serialization_alias=\"bar\")\n+\n+\n+@app.get(\n+    \"/with-serialization-alias\",\n+    response_model=DataModelWithSerializationAlias,\n+)\n+def with_serialization_alias(\n+    data: Annotated[DataModelWithSerializationAlias, Query(...)],\n+):\n+    return data\n+\n+\n+def test_openapi_param_name_with_serialization_alias():\n+    response = client.get(\"/openapi.json\")\n+    assert response.status", "output": "Changes look good. This PR implements: Fix ModelField alias property", "source": "pr", "type": "code_review", "pr_number": 247}
{"instruction": "Fix the following bug: Improve error handling for item retrieval", "input": "Fix: Return 404 for non-existent items instead of null response\r\n\r\nPreviously, valid ID formats with non-existent items returned 200 OK  with null values, creating ambiguous API responses. Now properly returns  404 Not Found when items don't exist in the database.", "output": "```diff\n@@ -1,7 +1,7 @@\n import random\n from typing import Annotated\n \n-from fastapi import FastAPI\n+from fastapi import FastAPI, HTTPException\n from pydantic import AfterValidator\n \n app = FastAPI()\n@@ -25,6 +25,10 @@ async def read_items(\n ):\n     if id:\n         item = data.get(id)\n+        if item is None:\n+            raise HTTPException(\n+                status_code=404, detail=f\"Item with id '{id}' not found\"\n+            )\n     else:\n         id, item = random.choice(list(data.items()))\n     return {\"id\": id, \"name\": item}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 246}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,7 +1,7 @@\n import random\n from typing import Annotated\n \n-from fastapi import FastAPI\n+from fastapi import FastAPI, HTTPException\n from pydantic import AfterValidator\n \n app = FastAPI()\n@@ -25,6 +25,10 @@ async def read_items(\n ):\n     if id:\n         item = data.get(id)\n+        if item is None:\n+            raise HTTPException(\n+                status_code=404, detail=f\"Item with id '{id}' not found\"\n+            )\n     else:\n         id, item = random.choice(list(data.items()))\n     return {\"id\": id, \"name\": item}\n\n```", "output": "Bug: Improve error handling for item retrieval\n\nFix: Return 404 for non-existent items instead of null response\r\n\r\nPreviously, valid ID formats with non-existent items returned 200 OK  with null values, creating ambiguous API responses. Now properly returns  404 Not Found when items don't exist in the database.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 246}
{"instruction": "Review the following code changes: Improve error handling for item retrieval", "input": "```diff\n@@ -1,7 +1,7 @@\n import random\n from typing import Annotated\n \n-from fastapi import FastAPI\n+from fastapi import FastAPI, HTTPException\n from pydantic import AfterValidator\n \n app = FastAPI()\n@@ -25,6 +25,10 @@ async def read_items(\n ):\n     if id:\n         item = data.get(id)\n+        if item is None:\n+            raise HTTPException(\n+                status_code=404, detail=f\"Item with id '{id}' not found\"\n+            )\n     else:\n         id, item = random.choice(list(data.items()))\n     return {\"id\": id, \"name\": item}\n\n```", "output": "Changes look good. This PR implements: Improve error handling for item retrieval", "source": "pr", "type": "code_review", "pr_number": 246}
{"instruction": "Review the following code changes: openapi: add test for mixed Pydantic v1/v2 models", "input": "```diff\n@@ -0,0 +1,144 @@\n+from typing import List\n+\n+from fastapi import FastAPI\n+from fastapi._compat import may_v1\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+from .utils import PYDANTIC_V2, needs_py_lt_314, needs_pydanticv2\n+\n+\n+class AddressV1(may_v1.BaseModel):\n+    street: str\n+\n+\n+class UserV1(may_v1.BaseModel):\n+    name: str\n+    addresses: List[AddressV1] = []\n+\n+\n+class AddressV2(BaseModel):\n+    street: str\n+\n+\n+class UserV2(BaseModel):\n+    name: str\n+    primary_address: AddressV1\n+    secondary_address: AddressV2 | None = None\n+\n+    if PYDANTIC_V2:\n+        # Match the pattern used in other tests to force separate input/output schemas\n+        model_config = {\"json_schema_serialization_defaults_required\": True}\n+\n+\n+def _collect_refs(obj):\n+    if isinstance(obj, dict):\n+        for key, value in obj.items():\n+            if key == \"$ref\" and isinstance(value, str):\n+                yield value\n+            else:\n+                yield from _collect_refs(value)\n+    elif isinstance(obj, list):\n+        for item in obj:\n+            yield from _collect_refs(item)\n+\n+\n+@needs_pydanticv2\n+@needs_py_lt_314\n+def test_openapi_mixed_pydantic_models_with_separate_input_output_schemas() -> None:\n+    app = FastAPI(separate_input_output_schemas=True)\n+\n+    @app.post(\"/v1-users/\", response_model=UserV1)\n+    def create_v1_user(\n+        user: UserV1,\n+    ) -> UserV1:  # pragma: no cover - behavior tested via OpenAPI\n+        return user\n+\n+    @app.post(\"/v2-users/\", response_model=UserV2)\n+    def create_v2_user(\n+        user: UserV2,\n+    ) -> UserV2:  # pragma: no cover - behavior tested via OpenAPI\n+        return user\n+\n+    client = TestClient(app)\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+\n+    openapi_schema = response.json()\n+    schemas = openapi_schema[\"components\"][\"schemas\"]\n+\n+    # Ensure both Pydantic v1 and v2 models are present in the components\n+    user_v1_keys = [name for name in schemas if \"UserV1\" in name]\n+    user_v2_keys = [name for name in schemas if \"UserV2\" in name]\n+    address_v1_keys = [name for name in schemas if \"AddressV1\" in name]\n+    address_v2_keys = [name for name in schemas if \"AddressV2\" in name]\n+\n+    assert user_v1_keys, \"Expected at least one schema for UserV1 (Pydantic v1 model).\"\n+    assert user_v2_keys, \"Expected at least one schema for UserV2 (Pydantic v2 model).\"\n+    assert address_v1_keys, (\n+        \"Expected at least one schema for AddressV1 (Pydantic v1 model).\"\n+    )\n+    assert address_v2_keys, (\n+        \"Expected at least one schema for AddressV2 (Pydantic v2 model).\"\n+    )\n+\n+    # Ensure that references in the OpenAPI document point to schemas for both versions\n+    all_refs = list(_collect_refs(openapi_schema))\n+    assert any(\"UserV1\" in ref for ref in all_refs), (\n+        \"Expected at least one $ref to a UserV1 schema.\"\n+    )\n+    assert any(\"UserV2\" in ref for ref in all_refs), (\n+    \n\n```", "output": "Changes look good. This PR implements: openapi: add test for mixed Pydantic v1/v2 models", "source": "pr", "type": "code_review", "pr_number": 245}
{"instruction": "Review the following code changes: Make default operation IDs deterministic for multi-method routes", "input": "```diff\n@@ -98,7 +98,8 @@ def generate_unique_id(route: \"APIRoute\") -> str:\n     operation_id = f\"{route.name}{route.path_format}\"\n     operation_id = re.sub(r\"\\W\", \"_\", operation_id)\n     assert route.methods\n-    operation_id = f\"{operation_id}_{list(route.methods)[0].lower()}\"\n+    method = sorted(route.methods)[0].lower()\n+    operation_id = f\"{operation_id}_{method}\"\n     return operation_id\n \n \n\n```\n\n```diff\n@@ -29,6 +29,14 @@ class Message(BaseModel):\n     description: str\n \n \n+def test_generate_unique_id_is_deterministic_with_multiple_methods():\n+    def read_items():  # pragma: nocover - used for name only\n+        return None\n+\n+    route = APIRoute(\"/items\", read_items, methods=[\"POST\", \"GET\"])\n+    assert route.unique_id == \"read_items_items_get\"\n+\n+\n def test_top_level_generate_unique_id():\n     app = FastAPI(generate_unique_id_function=custom_generate_unique_id)\n     router = APIRouter()\n\n```", "output": "Changes look good. This PR implements: Make default operation IDs deterministic for multi-method routes", "source": "pr", "type": "code_review", "pr_number": 244}
{"instruction": "Review the following code changes: ‚ú® Replace `dict` by `Mapping` on `HTTPException.headers`", "input": "```diff\n@@ -1,4 +1,4 @@\n-from collections.abc import Sequence\n+from collections.abc import Mapping, Sequence\n from typing import Annotated, Any, Optional, TypedDict, Union\n \n from annotated_doc import Doc\n@@ -68,7 +68,7 @@ def __init__(\n             ),\n         ] = None,\n         headers: Annotated[\n-            Optional[dict[str, str]],\n+            Optional[Mapping[str, str]],\n             Doc(\n                 \"\"\"\n                 Any headers to send to the client in the response.\n\n```\n\n```diff\n@@ -54,7 +54,7 @@ def __init__(\n             ),\n         ] = None,\n         headers: Annotated[\n-            Optional[Dict[str, str]],\n+            Optional[Mapping[str, str]],\n\n```\n\n```diff\n@@ -54,7 +54,7 @@ def __init__(\n             ),\n         ] = None,\n         headers: Annotated[\n-            Optional[Dict[str, str]],\n+            Optional[Mapping[str, str]],\n\n```", "output": "Code Review for: ‚ú® Replace `dict` by `Mapping` on `HTTPException.headers`\n\nüìù **fastapi/exceptions.py**: `Mapping` (like `Dict`) doesn't inherently support duplicate keys. This change wouldn't solve the problem. To handle this scenario properly, I suggest replacing \r\n\r\n`Optional[Mapping[str, str]]` \r\n\r\nwith \r\n\r\n`Optional[List[Tuple[str, str]]]`\r\n\r\nLet me know your thoughts.\n\nüìù **fastapi/exceptions.py**: `Mapping` was chosen because starlette already uses it in every place where a generic header type is required:\r\n- `starlette.datastructures.Headers` inherits from `Mapping[str, str]` and receives an optional `headers: Mapping[str, str]` in its `__init__`: https://github.com/encode/starlette/blob/8a99adfb5839b37efee33f2f49c1ba27a954fcbd/starlette/datastructures.py#L490-L500\r\n- `starlette.responses.Response` also receives `Mapping[str, str]` in its `__init__`: https://github.com/encode/starlette/blob/8a99adfb5839b37efee33f2f49c1ba27a954fcbd/starlette/responses.py#L36\r\n\r\nAlso, `Mapping` is commonly used as a base class for such containers with non-unique keys:\r\n- httpx: https://github.com/encode/httpx/blob/26d48e0634e6ee9cdc0533996db289ce4b430177/httpx/_types.py#L44-L50 (also features `Sequence[Tuple[str, str]]` though)\r\n- requests: https://github.com/python/typeshed/blob/b0768596d2f7b2c12aa61d8a9714325284410b4b/stubs/requests/requests/api.pyi#L9\r\n- django: https://github.com/django/django/blob/5e998d717f7b4220a1728bd49b66ca0162e2a6cb/django/http/request.py#L468 (`CaseInsensitiveMapping` inherits from `Mapping`)\r\n\r\nI think being compatible with starlette is an important reason in and of itself.\n\n", "source": "pr", "type": "code_review", "pr_number": 243}
{"instruction": "Review this code change in `fastapi/exceptions.py`", "input": "```diff\n@@ -54,7 +54,7 @@ def __init__(\n             ),\n         ] = None,\n         headers: Annotated[\n-            Optional[Dict[str, str]],\n+            Optional[Mapping[str, str]],\n\n```", "output": "`Mapping` (like `Dict`) doesn't inherently support duplicate keys. This change wouldn't solve the problem. To handle this scenario properly, I suggest replacing \r\n\r\n`Optional[Mapping[str, str]]` \r\n\r\nwith \r\n\r\n`Optional[List[Tuple[str, str]]]`\r\n\r\nLet me know your thoughts.", "source": "pr_review", "type": "inline_review", "pr_number": 243}
{"instruction": "Fix the following bug: ‚ú® Show a clear error on attempt to include router into itself", "input": "Previously discussed in https://github.com/fastapi/fastapi/discussions/11424 with the PR at https://github.com/fastapi/fastapi/pull/11425\r\n\r\nSince I made modifications in the fork of the repo, the PR was automatically closed. This PR serves to add the circular reference check again. Discussed again in https://github.com/fastapi/fastapi/discussions/14251", "output": "```diff\n@@ -1393,6 +1393,10 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -0,0 +1,12 @@\n+import pytest\n+from fastapi import APIRouter\n+\n+\n+def test_router_circular_import():\n+    router = APIRouter()\n+\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Cannot include the same APIRouter instance into itself. Did you mean to include a different router?\",\n+    ):\n+        router.include_router(router)\n\n```\n\n```diff\n@@ -0,0 +1,11 @@\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+\n+\n+def test_router_circular_import():\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    app.include_router(router)\n+    with pytest.raises(AssertionError, match=\"Cannot include router into itself\"):\n+        router.include_router(router)\n\n```\n\n```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         \n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 242}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1393,6 +1393,10 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -0,0 +1,12 @@\n+import pytest\n+from fastapi import APIRouter\n+\n+\n+def test_router_circular_import():\n+    router = APIRouter()\n+\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Cannot include the same APIRouter instance into itself. Did you mean to include a different router?\",\n+    ):\n+        router.include_router(router)\n\n```\n\n```diff\n@@ -0,0 +1,11 @@\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+\n+\n+def test_router_circular_import():\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    app.include_router(router)\n+    with pytest.raises(AssertionError, match=\"Cannot include router into itself\"):\n+        router.include_router(router)\n\n```\n\n```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         \n```", "output": "Bug: ‚ú® Show a clear error on attempt to include router into itself\n\nPreviously discussed in https://github.com/fastapi/fastapi/discussions/11424 with the PR at https://github.com/fastapi/fastapi/pull/11425\r\n\r\nSince I made modifications in the fork of the repo, the PR was automatically closed. This PR serves to add the circular reference check again. Discussed again in https://github.com/fastapi/fastapi/discussions/14251", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 242}
{"instruction": "Review the following code changes: ‚ú® Show a clear error on attempt to include router into itself", "input": "```diff\n@@ -1393,6 +1393,10 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -0,0 +1,12 @@\n+import pytest\n+from fastapi import APIRouter\n+\n+\n+def test_router_circular_import():\n+    router = APIRouter()\n+\n+    with pytest.raises(\n+        AssertionError,\n+        match=\"Cannot include the same APIRouter instance into itself. Did you mean to include a different router?\",\n+    ):\n+        router.include_router(router)\n\n```\n\n```diff\n@@ -0,0 +1,11 @@\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+\n+\n+def test_router_circular_import():\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    app.include_router(router)\n+    with pytest.raises(AssertionError, match=\"Cannot include router into itself\"):\n+        router.include_router(router)\n\n```\n\n```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         \n```\n\n```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         \n```", "output": "Code Review for: ‚ú® Show a clear error on attempt to include router into itself\n\nüìù **tests/test_router_circular_import.py**: ```suggestion\r\nimport pytest\r\nfrom fastapi import APIRouter\r\n\r\n\r\ndef test_router_circular_import():\r\n    router = APIRouter()\r\n\r\n    with pytest.raises(AssertionError, match=\"Cannot include router into itself\"):\r\n        router.include_router(router)\r\n```\r\n\r\n`app` is not needed here, and calling `router.include_router` after `app.include_router(router)` wrong\n\nüìù **fastapi/routing.py**: ```suggestion\r\n        assert self is not router, (\r\n            \"Cannot include the same APIRouter instance into itself. \"\r\n            \"Did you mean to include a different router?\"\r\n        )\r\n```\r\nHow about this version?\n\nüìù **fastapi/routing.py**: Also, we should probably raise [`FastAPIError`](https://github.com/fastapi/fastapi/blob/1fc586c3a5ae457457c5c70adddb07c7e9185f16/fastapi/exceptions.py#L144) instead of `assert`.\r\n\r\nUPD: maybe not. In other cases just `assert` is used..\n\n", "source": "pr", "type": "code_review", "pr_number": 242}
{"instruction": "Review this code change in `tests/test_router_circular_import.py`", "input": "```diff\n@@ -0,0 +1,11 @@\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+\n+\n+def test_router_circular_import():\n+    app = FastAPI()\n+    router = APIRouter()\n+\n+    app.include_router(router)\n+    with pytest.raises(AssertionError, match=\"Cannot include router into itself\"):\n+        router.include_router(router)\n\n```", "output": "```suggestion\r\nimport pytest\r\nfrom fastapi import APIRouter\r\n\r\n\r\ndef test_router_circular_import():\r\n    router = APIRouter()\r\n\r\n    with pytest.raises(AssertionError, match=\"Cannot include router into itself\"):\r\n        router.include_router(router)\r\n```\r\n\r\n`app` is not needed here, and calling `router.include_router` after `app.include_router(router)` wrong", "source": "pr_review", "type": "inline_review", "pr_number": 242}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -1333,6 +1333,7 @@ def read_users():\n         app.include_router(internal_router)\n         ```\n         \"\"\"\n+        assert self is not router, \"Cannot include router into itself\"\n\n```", "output": "```suggestion\r\n        assert self is not router, (\r\n            \"Cannot include the same APIRouter instance into itself. \"\r\n            \"Did you mean to include a different router?\"\r\n        )\r\n```\r\nHow about this version?", "source": "pr_review", "type": "inline_review", "pr_number": 242}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Simplify reading files in memory, do it sequentially instead of (fake) parallel", "input": "```diff\n@@ -1,7 +1,7 @@\n import dataclasses\n import inspect\n import sys\n-from collections.abc import Coroutine, Mapping, Sequence\n+from collections.abc import Mapping, Sequence\n from contextlib import AsyncExitStack, contextmanager\n from copy import copy, deepcopy\n from dataclasses import dataclass\n@@ -15,7 +15,6 @@\n     cast,\n )\n \n-import anyio\n from fastapi import params\n from fastapi._compat import (\n     ModelField,\n@@ -903,16 +902,8 @@ async def _extract_form_body(\n             # For types\n             assert isinstance(value, sequence_types)\n             results: list[Union[bytes, str]] = []\n-\n-            async def process_fn(\n-                fn: Callable[[], Coroutine[Any, Any, Any]],\n-            ) -> None:\n-                result = await fn()\n-                results.append(result)  # noqa: B023\n-\n-            async with anyio.create_task_group() as tg:\n-                for sub_value in value:\n-                    tg.start_soon(process_fn, sub_value.read)\n+            for sub_value in value:\n+                results.append(await sub_value.read())\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n             values[get_validation_alias(field)] = value\n\n```", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Simplify reading files in memory, do it sequentially instead of (fake) parallel", "source": "pr", "type": "code_review", "pr_number": 241}
{"instruction": "Review the following code changes: ‚úÖ Test order for the submitted byte Files", "input": "```diff\n@@ -0,0 +1,46 @@\n+\"\"\"\n+Regression test: preserve order when using list[bytes] + File()\n+See https://github.com/fastapi/fastapi/discussions/14811\n+Related: PR #3372\n+\"\"\"\n+\n+from typing import Annotated\n+\n+import anyio\n+import pytest\n+from fastapi import FastAPI, File\n+from fastapi.testclient import TestClient\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+\n+def test_list_bytes_file_preserves_order(\n+    monkeypatch: pytest.MonkeyPatch,\n+) -> None:\n+    app = FastAPI()\n+\n+    @app.post(\"/upload\")\n+    async def upload(files: Annotated[list[bytes], File()]):\n+        # return something that makes order obvious\n+        return [b[0] for b in files]\n+\n+    original_read = StarletteUploadFile.read\n+\n+    async def patched_read(self: StarletteUploadFile, size: int = -1) -> bytes:\n+        # Make the FIRST file slower *deterministically*\n+        if self.filename == \"slow.txt\":\n+            await anyio.sleep(0.05)\n+        return await original_read(self, size)\n+\n+    monkeypatch.setattr(StarletteUploadFile, \"read\", patched_read)\n+\n+    client = TestClient(app)\n+\n+    files = [\n+        (\"files\", (\"slow.txt\", b\"A\" * 10, \"text/plain\")),\n+        (\"files\", (\"fast.txt\", b\"B\" * 10, \"text/plain\")),\n+    ]\n+    r = client.post(\"/upload\", files=files)\n+    assert r.status_code == 200, r.text\n+\n+    # Must preserve request order: slow first, fast second\n+    assert r.json() == [ord(\"A\"), ord(\"B\")]\n\n```\n\n```diff\n@@ -0,0 +1,46 @@\n+\"\"\"\n+Regression test: preserve order when using list[bytes] + File()\n+See https://github.com/fastapi/fastapi/discussions/14811\n+Related: PR #3372\n+\"\"\"\n+\n+from typing import Annotated\n+\n+import anyio\n+import pytest\n+from fastapi import FastAPI, File\n+from fastapi.testclient import TestClient\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+\n+def test_list_bytes_file_preserves_order_issue_14811(\n\n```", "output": "Code Review for: ‚úÖ Test order for the submitted byte Files\n\nüìù **tests/test_list_bytes_file_order_preserved_issue_14811.py**: ```suggestion\ndef test_list_bytes_file_preserves_order(\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 240}
{"instruction": "Review this code change in `tests/test_list_bytes_file_order_preserved_issue_14811.py`", "input": "```diff\n@@ -0,0 +1,46 @@\n+\"\"\"\n+Regression test: preserve order when using list[bytes] + File()\n+See https://github.com/fastapi/fastapi/discussions/14811\n+Related: PR #3372\n+\"\"\"\n+\n+from typing import Annotated\n+\n+import anyio\n+import pytest\n+from fastapi import FastAPI, File\n+from fastapi.testclient import TestClient\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+\n+def test_list_bytes_file_preserves_order_issue_14811(\n\n```", "output": "```suggestion\ndef test_list_bytes_file_preserves_order(\n```", "source": "pr_review", "type": "inline_review", "pr_number": 240}
{"instruction": "Review the following code changes: üìù Use `dfn` tag for definitions instead of `abbr` in docs", "input": "```diff\n@@ -34,7 +34,7 @@ The key features are:\n * **Fast**: Very high performance, on par with **NodeJS** and **Go** (thanks to Starlette and Pydantic). [One of the fastest Python frameworks available](#performance).\n * **Fast to code**: Increase the speed to develop features by about 200% to 300%. *\n * **Fewer bugs**: Reduce about 40% of human (developer) induced errors. *\n-* **Intuitive**: Great editor support. <abbr title=\"also known as auto-complete, autocompletion, IntelliSense\">Completion</abbr> everywhere. Less time debugging.\n+* **Intuitive**: Great editor support. <dfn title=\"also known as auto-complete, autocompletion, IntelliSense\">Completion</dfn> everywhere. Less time debugging.\n * **Easy**: Designed to be easy to use and learn. Less time reading docs.\n * **Short**: Minimize code duplication. Multiple features from each parameter declaration. Fewer bugs.\n * **Robust**: Get production-ready code. With automatic interactive documentation.\n@@ -377,15 +377,15 @@ item: Item\n * Validation of data:\n     * Automatic and clear errors when the data is invalid.\n     * Validation even for deeply nested JSON objects.\n-* <abbr title=\"also known as: serialization, parsing, marshalling\">Conversion</abbr> of input data: coming from the network to Python data and types. Reading from:\n+* <dfn title=\"also known as: serialization, parsing, marshalling\">Conversion</dfn> of input data: coming from the network to Python data and types. Reading from:\n     * JSON.\n     * Path parameters.\n     * Query parameters.\n     * Cookies.\n     * Headers.\n     * Forms.\n     * Files.\n-* <abbr title=\"also known as: serialization, parsing, marshalling\">Conversion</abbr> of output data: converting from Python data and types to network data (as JSON):\n+* <dfn title=\"also known as: serialization, parsing, marshalling\">Conversion</dfn> of output data: converting from Python data and types to network data (as JSON):\n     * Convert Python types (`str`, `int`, `float`, `bool`, `list`, etc).\n     * `datetime` objects.\n     * `UUID` objects.\n@@ -448,7 +448,7 @@ For a more complete example including more features, see the <a href=\"https://fa\n \n * Declaration of **parameters** from other different places as: **headers**, **cookies**, **form fields** and **files**.\n * How to set **validation constraints** as `maximum_length` or `regex`.\n-* A very powerful and easy to use **<abbr title=\"also known as components, resources, providers, services, injectables\">Dependency Injection</abbr>** system.\n+* A very powerful and easy to use **<dfn title=\"also known as components, resources, providers, services, injectables\">Dependency Injection</dfn>** system.\n * Security and authentication, including support for **OAuth2** with **JWT tokens** and **HTTP Basic** auth.\n * More advanced (but equally easy) techniques for declaring **deeply nested JSON models** (thanks to Pydantic).\n * **GraphQL** integration with <a href=\"https://strawberry.rocks\" class=\"external-link\" target=\"_blank\">Strawberry</a> and other\n\n```\n\n```diff\n@@ -64,7 +64,7 @@ In that case, you can simply swap the standard `dataclasses` with `pydantic.data\n \n 6. Here we are returning a dictionary that contains `items` which is a list of dataclasses.\n \n-    FastAPI is still capable of <abbr title=\"converting the data to a format that can be transmitted\">serializing</abbr> the data to JSON.\n+    FastAPI is still capable of <dfn title=\"converting the data to a format that can be transmitted\">serializing</dfn> the data to JSON.\n \n 7. Here the `response_model` is using a type annotation of a list of `Author` dataclasses.\n \n\n```\n\n```diff\n@@ -141,7 +141,7 @@ You could do that with `openapi_extra`:\n \n {* ../../docs_src/path_operation_advanced_configuration/tutorial006_py39.py hl[19:36, 39:40] *}\n \n-In this example, we didn't declare any Pydantic model. In fact, the request body is not even <abbr title=\"converted from some plain format, like bytes, into Python objects\">parsed</abbr> as JSON, it is read directly as `bytes`, and the function `magic_data_reader()` would be in charge of parsing it in some way.\n+In this example, we didn't declare any Pydantic model. In fact, the request body is not even <dfn title=\"converted from some plain format, like bytes, into Python objects\">parsed</dfn> as JSON, it is read directly as `bytes`, and the function `magic_data_reader()` would be in charge of parsing it in some way.\n \n Nevertheless, we can declare the expected schema for the request body.\n \n\n```\n\n```diff\n@@ -137,15 +137,15 @@ There are several Flask REST frameworks, but after investing the time and work i\n \n ### <a href=\"https://marshmallow.readthedocs.io/en/stable/\" class=\"external-link\" target=\"_blank\">Marshmallow</a> { #marshmallow }\n \n-One of the main features needed by API systems is data \"<abbr title=\"also called marshalling, conversion\">serialization</abbr>\" which is taking data from the code (Python) and converting it into something that can be sent through the network. For example, converting an object", "output": "Code Review for: üìù Use `dfn` tag for definitions instead of `abbr` in docs\n\nüìù **docs/en/docs/deployment/https.md**: ```suggestion\nYou would probably get a cloud server (a virtual machine) or something similar, and it would have a <dfn title=\"Doesn't change over time. Not dynamic.\">fixed</dfn> **public IP address**.\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 239}
{"instruction": "Review this code change in `docs/en/docs/deployment/https.md`", "input": "```diff\n@@ -65,7 +65,7 @@ Here's an example of how an HTTPS API could look like, step by step, paying atte\n \n It would probably all start by you **acquiring** some **domain name**. Then, you would configure it in a DNS server (possibly your same cloud provider).\n \n-You would probably get a cloud server (a virtual machine) or something similar, and it would have a <abbr title=\"That doesn't change\">fixed</abbr> **public IP address**.\n+You would probably get a cloud server (a virtual machine) or something similar, and it would have a <dfn title=\"Doesn't change over time. Not dynamic\">fixed</dfn> **public IP address**.\n\n```", "output": "```suggestion\nYou would probably get a cloud server (a virtual machine) or something similar, and it would have a <dfn title=\"Doesn't change over time. Not dynamic.\">fixed</dfn> **public IP address**.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 239}
{"instruction": "Review the following code changes: üîß Update LLM-prompt for `abbr` and `dfn` tags", "input": "```diff\n@@ -35,7 +35,7 @@ Siehe Abschnitt `### Content of code snippets` im allgemeinen Prompt in `scripts\n \n //// tab | Test\n \n-Gestern schrieb mein Freund: ‚ÄûWenn man unkorrekt korrekt schreibt, hat man es unkorrekt geschrieben‚Äú. Worauf ich antwortete: ‚ÄûKorrekt, aber ‚Äöunkorrekt‚Äò ist unkorrekterweise nicht ‚Äö‚Äûunkorrekt‚Äú‚Äò‚Äú.\n+Gestern schrieb mein Freund: ‚ÄûWenn man ‚Äöincorrectly‚Äò korrekt schreibt, hat man es falsch geschrieben‚Äú. Worauf ich antwortete: ‚ÄûKorrekt, aber ‚Äöincorrectly‚Äò ist inkorrekterweise nicht ‚Äö‚Äûincorrectly‚Äú‚Äò‚Äú.\n \n /// note | Hinweis\n \n@@ -202,11 +202,6 @@ Hier einige Dinge, die in HTML-‚Äûabbr‚Äú-Elemente gepackt sind (einige sind erf\n * <abbr title=\"XML Web Token\">XWT</abbr>\n * <abbr title=\"Paralleles Server-Gateway-Interface\">PSGI</abbr>\n \n-### Das abbr gibt eine Erkl√§rung { #the-abbr-gives-an-explanation }\n-\n-* <abbr title=\"Eine Gruppe von Maschinen, die so konfiguriert sind, dass sie verbunden sind und in irgendeiner Weise zusammenarbeiten.\">Cluster</abbr>\n-* <abbr title=\"Eine Methode des Machine Learning, die k√ºnstliche neuronale Netze mit zahlreichen versteckten Schichten zwischen Eingabe- und Ausgabeschicht verwendet und so eine umfassende interne Struktur entwickelt\">Deep Learning</abbr>\n-\n ### Das abbr gibt eine vollst√§ndige Phrase und eine Erkl√§rung { #the-abbr-gives-a-full-phrase-and-an-explanation }\n \n * <abbr title=\"Mozilla Developer Network ‚Äì Mozilla-Entwicklernetzwerk: Dokumentation f√ºr Entwickler, geschrieben von den Firefox-Leuten\">MDN</abbr>\n@@ -224,6 +219,11 @@ Siehe Abschnitt `### HTML abbr elements` im allgemeinen Prompt in `scripts/trans\n \n ////\n \n+## HTML ‚Äûdfn‚Äú-Elemente { #html-dfn-elements }\n+\n+* <dfn title=\"Eine Gruppe von Maschinen, die so konfiguriert sind, dass sie verbunden sind und in irgendeiner Weise zusammenarbeiten.\">Cluster</dfn>\n+* <dfn title=\"Eine Methode des Machine Learning, die k√ºnstliche neuronale Netze mit zahlreichen versteckten Schichten zwischen Eingabe- und Ausgabeschicht verwendet und so eine umfassende interne Struktur entwickelt\">Deep Learning</dfn>\n+\n ## √úberschriften { #headings }\n \n //// tab | Test\n@@ -248,7 +248,7 @@ Die einzige strenge Regel f√ºr √úberschriften ist, dass das LLM den Hash-Teil in\n \n Siehe Abschnitt `### Headings` im allgemeinen Prompt in `scripts/translate.py`.\n \n-F√ºr einige sprachspezifische Anweisungen, siehe z. B. den Abschnitt `### Headings` in `docs/de/llm-prompt.md`.\n+F√ºr einige sprachsspezifische Anweisungen, siehe z. B. den Abschnitt `### Headings` in `docs/de/llm-prompt.md`.\n \n ////\n \n\n```\n\n```diff\n@@ -202,11 +202,6 @@ Here some things wrapped in HTML \"abbr\" elements (Some are invented):\n * <abbr title=\"XML Web Token\">XWT</abbr>\n * <abbr title=\"Parallel Server Gateway Interface\">PSGI</abbr>\n \n-### The abbr gives an explanation { #the-abbr-gives-an-explanation }\n-\n-* <abbr title=\"A group of machines that are configured to be connected and work together in some way.\">cluster</abbr>\n-* <abbr title=\"A method of machine learning that uses artificial neural networks with numerous hidden layers between input and output layers, thereby developing a comprehensive internal structure\">Deep Learning</abbr>\n-\n ### The abbr gives a full phrase and an explanation { #the-abbr-gives-a-full-phrase-and-an-explanation }\n \n * <abbr title=\"Mozilla Developer Network: documentation for developers, written by the Firefox people\">MDN</abbr>\n@@ -224,6 +219,11 @@ See section `### HTML abbr elements` in the general prompt in `scripts/translate\n \n ////\n \n+## HTML \"dfn\" elements { #html-dfn-elements }\n+\n+* <dfn title=\"A group of machines that are configured to be connected and work together in some way.\">cluster</dfn>\n+* <dfn title=\"A method of machine learning that uses artificial neural networks with numerous hidden layers between input and output layers, thereby developing a comprehensive internal structure\">Deep Learning</dfn>\n+\n ## Headings { #headings }\n \n //// tab | Test\n\n```\n\n```diff\n@@ -202,15 +202,10 @@ Aqu√≠ algunas cosas envueltas en elementos HTML \"abbr\" (algunas son inventadas):\n * <abbr title=\"XML Web Token - Token web XML\">XWT</abbr>\n * <abbr title=\"Parallel Server Gateway Interface - Interfaz de pasarela de servidor paralela\">PSGI</abbr>\n \n-### El abbr da una explicaci√≥n { #the-abbr-gives-an-explanation }\n-\n-* <abbr title=\"Un grupo de m√°quinas configuradas para estar conectadas y trabajar juntas de alguna manera.\">cl√∫ster</abbr>\n-* <abbr title=\"Un m√©todo de machine learning que usa redes neuronales artificiales con numerosas capas ocultas entre las capas de entrada y salida, desarrollando as√≠ una estructura interna completa\">Deep Learning</abbr>\n-\n ### El abbr da una frase completa y una explicaci√≥n { #the-abbr-gives-a-full-phrase-and-an-explanation }\n \n * <abbr title=\"Mozilla Developer Network - Red de Desarrolladores de Mozilla: documentaci√≥n para desarrolladores, escrita por la gente de Firefox\">MDN</abbr>\n-* <abbr title=\"Input/Output: lectura o escritura de disco, comunicaciones de red.\">I/O</abbr>.\n+* <abbr title=\"Input/Output - Entrada/", "output": "Code Review for: üîß Update LLM-prompt for `abbr` and `dfn` tags\n\nüìù **scripts/general-llm-prompt.md**: ```suggestion\n- If the title of abbr element contains a full phrase for that abbreviation, and other information, separated by a colon (`:`), then append a dash (`-`) and the translation of the full phrase to the original full phrase and translate the other information.\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 238}
{"instruction": "Review this code change in `scripts/general-llm-prompt.md`", "input": "```diff\n@@ -421,45 +423,7 @@ Result (German):\n <abbr title=\"Asynchrones Server-Gateway-Interface\">ASGI</abbr>\n ```\n \n-- If the description is not a full phrase for an abbreviation which the abbr element surrounds, but some other information, then just translate the description.\n-\n-Conversion scheme:\n-\n-Source (English):\n-\n-```\n-<abbr title=\"{description}\">{text}</abbr>\n-```\n-\n-Result:\n-\n-```\n-<abbr title=\"{translation of description}\">{translation of text}</abbr>\n-```\n-\n-Examples:\n-\n-    Source (English):\n-\n-```\n-<abbr title=\"also known as: endpoints, routes\">path</abbr>\n-<abbr title=\"a program that checks for code errors\">linter</abbr>\n-<abbr title=\"converting the string that comes from an HTTP request into Python data\">parsing</abbr>\n-<abbr title=\"before 2023-03\">0.95.0</abbr>\n-<abbr title=\"2023-08-26\">at the time of writing this</abbr>\n-```\n-\n-Result (German):\n-\n-```\n-<abbr title=\"auch bekannt als: Endpunkte, Routen\">Pfad</abbr>\n-<abbr title=\"Programm das auf Fehler im Code pr√ºft\">Linter</abbr>\n-<abbr title=\"Konvertieren des Strings eines HTTP-Requests in Python-Daten\">Parsen</abbr>\n-<abbr title=\"vor 2023-03\">0.95.0</abbr>\n-<abbr title=\"2023-08-26\">zum Zeitpunkt als das hier geschrieben wurde</abbr>\n-```\n-\n-- If the text surrounded by the abbr element is an abbreviation and the description contains both the full phrase for that abbreviation, and other information, separated by a colon (`:`), then append a dash (`-`) and the translation of the full phrase to the original full phrase and translate the other information.\n+- If the title of abbr element contains full phrase for that abbreviation, and other information, separated by a colon (`:`), then append a dash (`-`) and the translation of the full phrase to the original full phrase and translate the other information.\n\n```", "output": "```suggestion\n- If the title of abbr element contains a full phrase for that abbreviation, and other information, separated by a colon (`:`), then append a dash (`-`) and the translation of the full phrase to the original full phrase and translate the other information.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 238}
{"instruction": "Review the following code changes: ‚úÖ Tweak comment in test to reference PR", "input": "```diff\n@@ -1,7 +1,7 @@\n \"\"\"\n Regression test: preserve order when using list[bytes] + File()\n See https://github.com/fastapi/fastapi/discussions/14811\n-Related: PR #3372\n+Fixed in PR: https://github.com/fastapi/fastapi/pull/14884\n \"\"\"\n \n from typing import Annotated\n\n```", "output": "Changes look good. This PR implements: ‚úÖ Tweak comment in test to reference PR", "source": "pr", "type": "code_review", "pr_number": 237}
{"instruction": "Fix the following bug: üìù Fix grammar in `docs/en/docs/tutorial/first-steps.md`", "input": "Fixes a minor grammatical issue in the First Steps documentation.", "output": "```diff\n@@ -54,7 +54,7 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n \n```\n\n```diff\n@@ -54,7 +54,8 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n \n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 236}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -54,7 +54,7 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n \n```\n\n```diff\n@@ -54,7 +54,8 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n \n```", "output": "Bug: üìù Fix grammar in `docs/en/docs/tutorial/first-steps.md`\n\nFixes a minor grammatical issue in the First Steps documentation.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 236}
{"instruction": "Review the following code changes: üìù Fix grammar in `docs/en/docs/tutorial/first-steps.md`", "input": "```diff\n@@ -54,7 +54,7 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n \n```\n\n```diff\n@@ -54,7 +54,8 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n \n```", "output": "Code Review for: üìù Fix grammar in `docs/en/docs/tutorial/first-steps.md`\n\nüìù **docs/en/docs/tutorial/first-steps.md**: remove white line\r\n```suggestion\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 236}
{"instruction": "Review this code change in `docs/en/docs/tutorial/first-steps.md`", "input": "```diff\n@@ -54,7 +54,8 @@ In the output, there's a line with something like:\n INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n ```\n \n-That line shows the URL where your app is being served, in your local machine.\n+That line shows the URL where your app is being served on your local machine.\n+\n\n```", "output": "remove white line\r\n```suggestion\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 236}
{"instruction": "Review the following code changes: üìù Update `docs/en/docs/tutorial/security/oauth2-jwt.md`", "input": "```diff\n@@ -18,7 +18,7 @@ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4\n \n It is not encrypted, so, anyone could recover the information from the contents.\n \n-But it's signed. So, when you receive a token that you emitted, you can verify that you actually emitted it.\n+But it's signed. So, when you receive a token that you originally issued, you can verify that it actually came from you and has not been tampered with in-transit.\n \n That way, you can create a token with an expiration of, let's say, 1 week. And then when the user comes back the next day with the token, you know that user is still logged in to your system.\n \n\n```\n\n```diff\n@@ -18,7 +18,7 @@ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4\n \n It is not encrypted, so, anyone could recover the information from the contents.\n \n-But it's signed. So, when you receive a token that you emitted, you can verify that you actually emitted it.\n+But it's signed. So, when you receive a token that you originally issued, you can verify that it actually came from you and has not been tampered with in-transit.\n\n```", "output": "Code Review for: üìù Update `docs/en/docs/tutorial/security/oauth2-jwt.md`\n\nüìù **docs/en/docs/tutorial/security/oauth2-jwt.md**: ```suggestion\nBut it's signed. So, when you receive a token that you issued, you can verify that it was you who issued it.\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 235}
{"instruction": "Review this code change in `docs/en/docs/tutorial/security/oauth2-jwt.md`", "input": "```diff\n@@ -18,7 +18,7 @@ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4\n \n It is not encrypted, so, anyone could recover the information from the contents.\n \n-But it's signed. So, when you receive a token that you emitted, you can verify that you actually emitted it.\n+But it's signed. So, when you receive a token that you originally issued, you can verify that it actually came from you and has not been tampered with in-transit.\n\n```", "output": "```suggestion\nBut it's signed. So, when you receive a token that you issued, you can verify that it was you who issued it.\n```", "source": "pr_review", "type": "inline_review", "pr_number": 235}
{"instruction": "Review the following code changes: üìù Clarify required but nullable request body fields", "input": "```diff\n@@ -54,6 +54,29 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n     \"price\": 45.2\n }\n \n```", "output": "Changes look good. This PR implements: üìù Clarify required but nullable request body fields", "source": "pr", "type": "code_review", "pr_number": 234}
{"instruction": "Review the following code changes: üìù Add exception handling guidance for BackgroundTasks", "input": "```diff\n@@ -45,6 +45,60 @@ Inside of your *path operation function*, pass your task function to the *backgr\n * Any sequence of arguments that should be passed to the task function in order (`email`).\n * Any keyword arguments that should be passed to the task function (`message=\"some notification\"`).\n \n+## Important: Exception Handling { #important-exception-handling }\n+\n+Background tasks run **after** the response is sent. If an exception occurs in a background task, it won't affect the response (which already succeeded), and **the exception will not be propagated to the request handler and may go unnoticed unless explicitly handled (e.g. logging, retries, alerts)**.\n+\n+This is expected behavior, but it is easy to overlook when building production systems.\n+\n+### Silent Failure Example { #silent-failure-example }\n+\n```\n\n```diff\n@@ -45,6 +45,60 @@ Inside of your *path operation function*, pass your task function to the *backgr\n * Any sequence of arguments that should be passed to the task function in order (`email`).\n * Any keyword arguments that should be passed to the task function (`message=\"some notification\"`).\n \n+## Important: Exception Handling { #important-exception-handling }\n+\n+Background tasks run **after** the response is sent. If an exception occurs in a background task, it won't affect the response (which already succeeded), and **the exception will not be propagated to the request handler and may go unnoticed unless explicitly handled (e.g. logging, retries, alerts)**.\n+\n+This is expected behavior, but it is easy to overlook when building production systems.\n+\n+### Silent Failure Example { #silent-failure-example }\n+\n```", "output": "Code Review for: üìù Add exception handling guidance for BackgroundTasks\n\nüìù **docs/en/docs/tutorial/background-tasks.md**: ```suggestion\r\n/// tip\r\nFor production systems with complex background jobs, consider:\r\n\r\n- [Celery](https://docs.celeryq.dev) - Distributed task queue\r\n- [arq](https://arq-docs.helpmanual.io/) - Async task queue for Python\r\n- [Dramatiq](https://dramatiq.io/) - Fast and reliable task processing\r\n\r\n///\r\n\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 233}
{"instruction": "Review this code change in `docs/en/docs/tutorial/background-tasks.md`", "input": "```diff\n@@ -45,6 +45,60 @@ Inside of your *path operation function*, pass your task function to the *backgr\n * Any sequence of arguments that should be passed to the task function in order (`email`).\n * Any keyword arguments that should be passed to the task function (`message=\"some notification\"`).\n \n+## Important: Exception Handling { #important-exception-handling }\n+\n+Background tasks run **after** the response is sent. If an exception occurs in a background task, it won't affect the response (which already succeeded), and **the exception will not be propagated to the request handler and may go unnoticed unless explicitly handled (e.g. logging, retries, alerts)**.\n+\n+This is expected behavior, but it is easy to overlook when building production systems.\n+\n+### Silent Failure Example { #silent-failure-example }\n+```python\n+def send_email(email: str):\n+    # If this fails, the exception goes unnoticed\n+    smtp_client.send(to=email, subject=\"Hello\")\n+    # User gets 200 OK, but email may never be sent!\n+\n+@app.post(\"/notify/\")\n+async def notify(background_tasks: BackgroundTasks, email: str):\n+    background_tasks.add_task(send_email, email)\n+    return {\"message\": \"Notification sent\"}\n+    # Returns success even if email fails!\n+```\n+\n+### Proper Error Handling { #proper-error-handling }\n+```python\n+import logging\n+\n+logger = logging.getLogger(__name__)\n+\n+def send_email(email: str):\n+    try:\n+        smtp_client.send(to=email, subject=\"Hello\")\n+        logger.info(f\"Email sent successfully to {email}\")\n+    except Exception as e:\n+        # Now the error is visible\n+        logger.error(f\"Failed to send email to {email}: {e}\")\n+        # You can: retry, alert ops, save to dead-letter queue, etc.\n+\n+@app.post(\"/notify/\")\n+async def notify(background_tasks: BackgroundTasks, email: str):\n+    background_tasks.add_task(send_email, email)\n+    return {\"message\": \"Notification queued\"}\n+```\n+\n+This example uses logging for simplicity. In production, you might also:\n+\n+- Trigger retries\n+- Notify operators\n+- Persist failures for later inspection\n+\n+!!! tip\n+    For production systems with complex background jobs, consider:\n+\n+    - [Celery](https://docs.celeryq.dev) - Distributed task queue\n+    - [arq](https://arq-docs.helpmanual.io/) - Async task queue for Python\n+    - [Dramatiq](https://dramatiq.io/) - Fast and reliable task processing\n+\n\n```", "output": "```suggestion\r\n/// tip\r\nFor production systems with complex background jobs, consider:\r\n\r\n- [Celery](https://docs.celeryq.dev) - Distributed task queue\r\n- [arq](https://arq-docs.helpmanual.io/) - Async task queue for Python\r\n- [Dramatiq](https://dramatiq.io/) - Fast and reliable task processing\r\n\r\n///\r\n\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 233}
{"instruction": "Fix the following bug: üìù Fix StreamingResponse doc example to actually stream", "input": "## Summary\n\nFix the `StreamingResponse` async generator doc example so it actually demonstrates streaming behavior.\n\n## Problem\n\nThe current example in `docs_src/custom_response/tutorial007_py39.py` uses an async generator that yields all chunks synchronously without ever awaiting, so the event loop never gets a chance to send intermediate chunks ‚Äî the response is buffered and returned all at once.\n\nAs discussed in [encode/starlette#1776](https://github.com/Kludex/starlette/discussions/1776#discussioncomment-3207518), async generators need an `await` point to actually stream.\n\n## Fix\n\nAdded `await asyncio.sleep(1)` inside the async generator loop so it yields control back to the event loop between chunks, making the streaming behavior observable.\n\nCloses #14680", "output": "```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -6,6 +8,7 @@\n \n async def fake_video_streamer():\n     for i in range(10):\n+        await asyncio.sleep(1)\n         yield b\"some fake video bytes\"\n \n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 232}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -6,6 +8,7 @@\n \n async def fake_video_streamer():\n     for i in range(10):\n+        await asyncio.sleep(1)\n         yield b\"some fake video bytes\"\n \n \n\n```", "output": "Bug: üìù Fix StreamingResponse doc example to actually stream\n\n## Summary\n\nFix the `StreamingResponse` async generator doc example so it actually demonstrates streaming behavior.\n\n## Problem\n\nThe current example in `docs_src/custom_response/tutorial007_py39.py` uses an async generator that yields all chunks synchronously without ever awaiting, so the event loop never gets a chance to send intermediate chunks ‚Äî the response is buffered and returned all at once.\n\nAs discussed in [encode/starlette#1776](https://github.com/Kludex/starlette/discussions/1776#discussioncomment-3207518), async generators need an `await` point to actually stream.\n\n## Fix\n\nAdded `await asyncio.sleep(1)` inside the async generator loop so it yields control back to the event loop between chunks, making the streaming behavior observable.\n\nCloses #14680", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 232}
{"instruction": "Review the following code changes: üìù Fix StreamingResponse doc example to actually stream", "input": "```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -6,6 +8,7 @@\n \n async def fake_video_streamer():\n     for i in range(10):\n+        await asyncio.sleep(1)\n         yield b\"some fake video bytes\"\n \n \n\n```", "output": "Changes look good. This PR implements: üìù Fix StreamingResponse doc example to actually stream", "source": "pr", "type": "code_review", "pr_number": 232}
{"instruction": "Fix the following bug: fix: use await asyncio.sleep() in StreamingResponse async generator example", "input": "## Summary\n\nThe async generator in the StreamingResponse docs example (`docs_src/custom_response/tutorial007_py39.py`) did not `await` anything, causing all chunks to be buffered and returned at once instead of streaming incrementally.\n\n## Fix\n\n- Added `import asyncio`\n- Added `await asyncio.sleep(0)` inside the async generator loop so the event loop yields between chunks, enabling proper streaming behavior\n\nCloses #14680", "output": "```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -6,6 +8,7 @@\n \n async def fake_video_streamer():\n     for i in range(10):\n+        await asyncio.sleep(0)\n         yield b\"some fake video bytes\"\n \n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 231}
{"instruction": "Review the following code changes: fix: use await asyncio.sleep() in StreamingResponse async generator example", "input": "```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -6,6 +8,7 @@\n \n async def fake_video_streamer():\n     for i in range(10):\n+        await asyncio.sleep(0)\n         yield b\"some fake video bytes\"\n \n \n\n```", "output": "Changes look good. This PR implements: fix: use await asyncio.sleep() in StreamingResponse async generator example", "source": "pr", "type": "code_review", "pr_number": 231}
{"instruction": "Fix the following bug: Fix use_annotated", "input": "", "output": "```diff\n@@ -445,7 +445,7 @@ def analyze_param(\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n-            field_info.annotation = type_annotation\n+            field_info.annotation = use_annotation\n \n     # Get Depends from type annotation\n     if depends is not None and depends.dependency is None:\n\n```\n\n```diff\n@@ -0,0 +1,184 @@\n+\"\"\"Test Pydantic validators in Annotated work correctly with FastAPI.\n+\n+This test ensures that Pydantic v2 validators like AfterValidator, BeforeValidator\n+work correctly in Annotated types with FastAPI parameters.\n+\n+Context: PR #13314 broke AfterValidator support and was reverted.\n+We need to ensure new changes preserve validator functionality.\n+\"\"\"\n+\n+from typing import Annotated\n+\n+from fastapi import Body, FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import AfterValidator, BeforeValidator\n+\n+\n+def validate_positive(v: int) -> int:\n+    \"\"\"Validator that ensures value is positive.\"\"\"\n+    if v <= 0:\n+        raise ValueError(\"must be positive\")\n+    return v\n+\n+\n+def double_value(v) -> int:\n+    \"\"\"Validator that doubles the input value.\"\"\"\n+    # BeforeValidator receives the raw value before Pydantic coercion\n+    # For query params, this is a string\n+    v_int = int(v) if isinstance(v, str) else v\n+    return v_int * 2\n+\n+\n+def strip_whitespace(v: str) -> str:\n+    \"\"\"Validator that strips whitespace.\"\"\"\n+    return v.strip()\n+\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/query-after-validator\")\n+def query_after_validator(\n+    value: Annotated[int, AfterValidator(validate_positive), Query()],\n+) -> int:\n+    return value\n+\n+\n+@app.get(\"/query-before-validator\")\n+def query_before_validator(\n+    value: Annotated[int, BeforeValidator(double_value), Query()],\n+) -> int:\n+    return value\n+\n+\n+@app.post(\"/body-after-validator\")\n+def body_after_validator(\n+    value: Annotated[int, AfterValidator(validate_positive), Body()],\n+) -> int:\n+    return value\n+\n+\n+@app.post(\"/body-before-validator\")\n+def body_before_validator(\n+    name: Annotated[str, BeforeValidator(strip_whitespace), Body()],\n+) -> str:\n+    return name\n+\n+\n+@app.get(\"/query-multiple-validators\")\n+def query_multiple_validators(\n+    value: Annotated[\n+        int,\n+        BeforeValidator(double_value),\n+        AfterValidator(validate_positive),\n+        Query(),\n+    ],\n+) -> int:\n+    return value\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_query_after_validator_valid():\n+    \"\"\"Test AfterValidator in Query with valid value.\"\"\"\n+    response = client.get(\"/query-after-validator?value=5\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == 5\n+\n+\n+def test_query_after_validator_invalid():\n+    \"\"\"Test AfterValidator in Query with invalid value.\"\"\"\n+    response = client.get(\"/query-after-validator?value=-1\")\n+    assert response.status_code == 422, response.text\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"value_error\",\n+                \"loc\": [\"query\", \"value\"],\n+                \"msg\": \"Value error, must be positive\",\n+                \"input\": \"-1\",\n+                \"ctx\": {\"error\": {}},\n+            }\n+        ]\n+    }\n+\n+\n+def test_query_before_validator():\n+    \"\"\"Test BeforeValidator in Query doubles the value.\"\"\"\n+    response = client.get(\"/query-before\n\n```\n\n```diff\n@@ -0,0 +1,133 @@\n+import json\n+from typing import Annotated, Any\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import Json\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-json-equals-syntax\")\n+def form_json_equals_syntax(data: Json[dict[str, Any]] = Form()) -> dict[str, Any]:\n+    return data\n+\n+\n+@app.post(\"/form-json-annotated-syntax\")\n+def form_json_annotated_syntax(\n+    data: Annotated[Json[dict[str, Any]], Form()],\n+) -> dict[str, Any]:\n+    return data\n+\n+\n+@app.post(\"/form-json-list-equals\")\n+def form_json_list_equals(items: Json[list[str]] = Form()) -> list[str]:\n+    return items\n+\n+\n+@app.post(\"/form-json-list-annotated\")\n+def form_json_list_annotated(\n+    items: Annotated[Json[list[str]], Form()],\n+) -> list[str]:\n+    return items\n+\n+\n+@app.post(\"/form-json-nested-equals\")\n+def form_json_nested_equals(\n+    config: Json[dict[str, list[int]]] = Form(),\n+) -> dict[str, list[int]]:\n+    return config\n+\n+\n+@app.post(\"/form-json-nested-annotated\")\n+def form_json_nested_annotated(\n+    config: Annotated[Json[dict[str, list[int]]], Form()],\n+) -> dict[str, list[int]]:\n+    return config\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_json_equals_syntax():\n+    test_data = {\"key\": \"value\", \"nested\": {\"inner\": 123}}\n+    response = client.post(\n+        \"/form-json-equals-syntax\", data={\"data\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def test_form_json_annotated_syntax():\n+    test_data = {\"key\": \"value\", \"nested\": {\"inner\": 123}}\n+    response = client.post(\n+        \"/form-json-annotated-syntax\", data={\"data\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def test_form_json_list_equals():\n+    test_data = [\"abc\", \"def\", \"ghi\"]\n+    response = client.post(\n+        \"/form-json-list-equals\", data={\"items\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def test_form_json_list_annotated():\n+    test_data = [\"abc\", \"def\", \"ghi\"]\n+    response = client.post(\n+        \"/form-json-list-annotated\", data={\"items\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def test_form_json_nested_equals():\n+    test_data = {\"groups\": [1, 2, 3], \"ids\": [4, 5]}\n+    response = client.post(\n+        \"/form-json-nested-equals\", data={\"config\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def test_form_json_nested_annotated():\n+    test_data = {\"groups\": [1, 2, 3], \"ids\": [4, 5]}\n+    response = client.post(\n+        \"/form-json-nested-annotated\", data={\"config\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def tes\n\n```\n\n```diff\n@@ -73,7 +73,7 @@ def test_openapi_schema(client: TestClient) -> None:\n                             \"content\": {\n                                 \"application/json\": {\n                                     \"schema\": {\n-                                        \"anyOf\": [\n+                                        \"oneOf\": [\n                                             {\"$ref\": \"#/components/schemas/Cat\"},\n                                             {\"$ref\": \"#/components/schemas/Dog\"},\n                                         ],\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 230}
{"instruction": "Review the following code changes: Fix use_annotated", "input": "```diff\n@@ -445,7 +445,7 @@ def analyze_param(\n         )\n         field_info = value\n         if isinstance(field_info, FieldInfo):\n-            field_info.annotation = type_annotation\n+            field_info.annotation = use_annotation\n \n     # Get Depends from type annotation\n     if depends is not None and depends.dependency is None:\n\n```\n\n```diff\n@@ -0,0 +1,184 @@\n+\"\"\"Test Pydantic validators in Annotated work correctly with FastAPI.\n+\n+This test ensures that Pydantic v2 validators like AfterValidator, BeforeValidator\n+work correctly in Annotated types with FastAPI parameters.\n+\n+Context: PR #13314 broke AfterValidator support and was reverted.\n+We need to ensure new changes preserve validator functionality.\n+\"\"\"\n+\n+from typing import Annotated\n+\n+from fastapi import Body, FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import AfterValidator, BeforeValidator\n+\n+\n+def validate_positive(v: int) -> int:\n+    \"\"\"Validator that ensures value is positive.\"\"\"\n+    if v <= 0:\n+        raise ValueError(\"must be positive\")\n+    return v\n+\n+\n+def double_value(v) -> int:\n+    \"\"\"Validator that doubles the input value.\"\"\"\n+    # BeforeValidator receives the raw value before Pydantic coercion\n+    # For query params, this is a string\n+    v_int = int(v) if isinstance(v, str) else v\n+    return v_int * 2\n+\n+\n+def strip_whitespace(v: str) -> str:\n+    \"\"\"Validator that strips whitespace.\"\"\"\n+    return v.strip()\n+\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/query-after-validator\")\n+def query_after_validator(\n+    value: Annotated[int, AfterValidator(validate_positive), Query()],\n+) -> int:\n+    return value\n+\n+\n+@app.get(\"/query-before-validator\")\n+def query_before_validator(\n+    value: Annotated[int, BeforeValidator(double_value), Query()],\n+) -> int:\n+    return value\n+\n+\n+@app.post(\"/body-after-validator\")\n+def body_after_validator(\n+    value: Annotated[int, AfterValidator(validate_positive), Body()],\n+) -> int:\n+    return value\n+\n+\n+@app.post(\"/body-before-validator\")\n+def body_before_validator(\n+    name: Annotated[str, BeforeValidator(strip_whitespace), Body()],\n+) -> str:\n+    return name\n+\n+\n+@app.get(\"/query-multiple-validators\")\n+def query_multiple_validators(\n+    value: Annotated[\n+        int,\n+        BeforeValidator(double_value),\n+        AfterValidator(validate_positive),\n+        Query(),\n+    ],\n+) -> int:\n+    return value\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_query_after_validator_valid():\n+    \"\"\"Test AfterValidator in Query with valid value.\"\"\"\n+    response = client.get(\"/query-after-validator?value=5\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == 5\n+\n+\n+def test_query_after_validator_invalid():\n+    \"\"\"Test AfterValidator in Query with invalid value.\"\"\"\n+    response = client.get(\"/query-after-validator?value=-1\")\n+    assert response.status_code == 422, response.text\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"value_error\",\n+                \"loc\": [\"query\", \"value\"],\n+                \"msg\": \"Value error, must be positive\",\n+                \"input\": \"-1\",\n+                \"ctx\": {\"error\": {}},\n+            }\n+        ]\n+    }\n+\n+\n+def test_query_before_validator():\n+    \"\"\"Test BeforeValidator in Query doubles the value.\"\"\"\n+    response = client.get(\"/query-before\n\n```\n\n```diff\n@@ -0,0 +1,133 @@\n+import json\n+from typing import Annotated, Any\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+from pydantic import Json\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/form-json-equals-syntax\")\n+def form_json_equals_syntax(data: Json[dict[str, Any]] = Form()) -> dict[str, Any]:\n+    return data\n+\n+\n+@app.post(\"/form-json-annotated-syntax\")\n+def form_json_annotated_syntax(\n+    data: Annotated[Json[dict[str, Any]], Form()],\n+) -> dict[str, Any]:\n+    return data\n+\n+\n+@app.post(\"/form-json-list-equals\")\n+def form_json_list_equals(items: Json[list[str]] = Form()) -> list[str]:\n+    return items\n+\n+\n+@app.post(\"/form-json-list-annotated\")\n+def form_json_list_annotated(\n+    items: Annotated[Json[list[str]], Form()],\n+) -> list[str]:\n+    return items\n+\n+\n+@app.post(\"/form-json-nested-equals\")\n+def form_json_nested_equals(\n+    config: Json[dict[str, list[int]]] = Form(),\n+) -> dict[str, list[int]]:\n+    return config\n+\n+\n+@app.post(\"/form-json-nested-annotated\")\n+def form_json_nested_annotated(\n+    config: Annotated[Json[dict[str, list[int]]], Form()],\n+) -> dict[str, list[int]]:\n+    return config\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_form_json_equals_syntax():\n+    test_data = {\"key\": \"value\", \"nested\": {\"inner\": 123}}\n+    response = client.post(\n+        \"/form-json-equals-syntax\", data={\"data\": json.dumps(test_data)}\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == test_data\n+\n+\n+def test_form_json_annotated_syntax():\n+    test_data = {\"key\": \"value\", \"nested\": {\"inner\": 123}}\n+    response = client.post(\n+      ", "output": "Changes look good. This PR implements: Fix use_annotated", "source": "pr", "type": "code_review", "pr_number": 230}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Update build setup for `fastapi-slim`, deprecate it, and make it only depend on `fastapi`", "input": "```diff\n@@ -12,11 +12,6 @@ on:\n jobs:\n   test-redistribute:\n     runs-on: ubuntu-latest\n-    strategy:\n-      matrix:\n-        package:\n-          - fastapi\n-          - fastapi-slim\n     steps:\n       - name: Dump GitHub context\n         env:\n@@ -30,8 +25,6 @@ jobs:\n       - name: Install build dependencies\n         run: pip install build\n       - name: Build source distribution\n-        env:\n-          TIANGOLO_BUILD_PACKAGE: ${{ matrix.package }}\n         run: python -m build --sdist\n       - name: Decompress source distribution\n         run: |\n@@ -41,8 +34,6 @@ jobs:\n         run: |\n           cd dist/fastapi*/\n           pip install --group tests --editable .[all]\n-        env:\n-          TIANGOLO_BUILD_PACKAGE: ${{ matrix.package }}\n       - name: Run source distribution tests\n         run: |\n           cd dist/fastapi*/\n\n```\n\n```diff\n@@ -0,0 +1,54 @@\n+<p align=\"center\">\n+  <a href=\"https://fastapi.tiangolo.com\"><img src=\"https://fastapi.tiangolo.com/img/logo-margin/logo-teal.png\" alt=\"FastAPI\"></a>\n+</p>\n+<p align=\"center\">\n+    <em>FastAPI framework, high performance, easy to learn, fast to code, ready for production</em>\n+</p>\n+<p align=\"center\">\n+<a href=\"https://github.com/fastapi/fastapi/actions?query=workflow%3ATest+event%3Apush+branch%3Amaster\" target=\"_blank\">\n+    <img src=\"https://github.com/fastapi/fastapi/actions/workflows/test.yml/badge.svg?event=push&branch=master\" alt=\"Test\">\n+</a>\n+<a href=\"https://coverage-badge.samuelcolvin.workers.dev/redirect/fastapi/fastapi\" target=\"_blank\">\n+    <img src=\"https://coverage-badge.samuelcolvin.workers.dev/fastapi/fastapi.svg\" alt=\"Coverage\">\n+</a>\n+<a href=\"https://pypi.org/project/fastapi\" target=\"_blank\">\n+    <img src=\"https://img.shields.io/pypi/v/fastapi?color=%2334D058&label=pypi%20package\" alt=\"Package version\">\n+</a>\n+<a href=\"https://pypi.org/project/fastapi\" target=\"_blank\">\n+    <img src=\"https://img.shields.io/pypi/pyversions/fastapi.svg?color=%2334D058\" alt=\"Supported Python versions\">\n+</a>\n+</p>\n+\n+---\n+\n+**Documentation**: <a href=\"https://fastapi.tiangolo.com\" target=\"_blank\">https://fastapi.tiangolo.com</a>\n+\n+**Source Code**: <a href=\"https://github.com/fastapi/fastapi\" target=\"_blank\">https://github.com/fastapi/fastapi</a>\n+\n+---\n+\n+FastAPI is a modern, fast (high-performance), web framework for building APIs with Python based on standard Python type hints.\n+\n+## `fastapi-slim`\n+\n+‚ö†Ô∏è Do not install this package. ‚ö†Ô∏è\n+\n+This package, `fastapi-slim`, does nothing other than depend on `fastapi`.\n+\n+All the functionality has been integrated into `fastapi`.\n+\n+The only reason this package exists is as a migration path for old projects that used to depend on `fastapi-slim`, so that they can get the latest version of `fastapi`.\n+\n+You **should not** install this package.\n+\n+Install instead:\n+\n+\n```\n\n```diff\n@@ -3,18 +3,38 @@\n \n from pdm.backend.hooks import Context\n \n-TIANGOLO_BUILD_PACKAGE = os.getenv(\"TIANGOLO_BUILD_PACKAGE\", \"fastapi\")\n+TIANGOLO_BUILD_PACKAGE = os.getenv(\"TIANGOLO_BUILD_PACKAGE\", \"typer\")\n \n \n def pdm_build_initialize(context: Context) -> None:\n     metadata = context.config.metadata\n+    # Get main version\n+    version = metadata[\"version\"]\n     # Get custom config for the current package, from the env var\n-    config: dict[str, Any] = context.config.data[\"tool\"][\"tiangolo\"][\n+    all_configs_config: dict[str, Any] = context.config.data[\"tool\"][\"tiangolo\"][\n         \"_internal-slim-build\"\n-    ][\"packages\"].get(TIANGOLO_BUILD_PACKAGE)\n-    if not config:\n+    ][\"packages\"]\n+\n+    if TIANGOLO_BUILD_PACKAGE not in all_configs_config:\n         return\n+\n+    config = all_configs_config[TIANGOLO_BUILD_PACKAGE]\n     project_config: dict[str, Any] = config[\"project\"]\n     # Override main [project] configs with custom configs for this package\n     for key, value in project_config.items():\n         metadata[key] = value\n+    # Get custom build config for the current package\n+    build_config: dict[str, Any] = (\n+        config.get(\"tool\", {}).get(\"pdm\", {}).get(\"build\", {})\n+    )\n+    # Override PDM build config with custom build config for this package\n+    for key, value in build_config.items():\n+        context.config.build_config[key] = value\n+    # Get main dependencies\n+    dependencies: list[str] = metadata.get(\"dependencies\", [])\n+    # Sync versions in dependencies\n+    new_dependencies = []\n+    for dep in dependencies:\n+        new_dep = f\"{dep}>={version}\"\n+        new_dependencies.append(new_dep)\n+    metadata[\"dependencies\"] = new_dependencies\n\n```\n\n```diff\n@@ -202,6 +202,29 @@ source-includes = [\n \n [tool.tiangolo._internal-slim-build.packages.fastapi-slim.project]\n name = \"fastapi-slim\"\n+readme = \"fastapi-slim/README.md\"\n+dependencies = [\n+    \"fastapi\",\n+]\n+optional-dependencies = {}\n+scripts = {}\n+\n+[tool.tiangolo._internal-slim-build.packages.fastapi-slim.tool.pdm.build]\n+# excludes needs to explicitly exclude the top level python packages,\n+# otherwise PDM includes them by default\n+# A \"*\" glob pattern c", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Update build setup for `fastapi-slim`, deprecate it, and make it only depend on `fastapi`", "source": "pr", "type": "code_review", "pr_number": 229}
{"instruction": "Review the following code changes: üî® Tweak PDM hook script", "input": "```diff\n@@ -3,7 +3,7 @@\n \n from pdm.backend.hooks import Context\n \n-TIANGOLO_BUILD_PACKAGE = os.getenv(\"TIANGOLO_BUILD_PACKAGE\", \"typer\")\n+TIANGOLO_BUILD_PACKAGE = os.getenv(\"TIANGOLO_BUILD_PACKAGE\")\n \n \n def pdm_build_initialize(context: Context) -> None:\n\n```", "output": "Changes look good. This PR implements: üî® Tweak PDM hook script", "source": "pr", "type": "code_review", "pr_number": 228}
{"instruction": "Review the following code changes: ‚ûñ Drop support for Python 3.9", "input": "```diff\n@@ -56,14 +56,10 @@ jobs:\n           - starlette-pypi\n           - starlette-git\n         include:\n-          - os: ubuntu-latest\n-            python-version: \"3.9\"\n-            coverage: coverage\n-            uv-resolution: lowest-direct\n           - os: macos-latest\n             python-version: \"3.10\"\n             coverage: coverage\n-            uv-resolution: highest\n+            uv-resolution: lowest-direct\n           - os: windows-latest\n             python-version: \"3.12\"\n             coverage: coverage\n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+# Advanced Python Types { #advanced-python-types }\n+\n+Here are some additional ideas that might be useful when working with Python types.\n+\n+## Using `Union` or `Optional` { #using-union-or-optional }\n+\n+If your code for some reason can't use `|`, for example if it's not in a type annotation but in something like `response_model=`, instead of using the vertical bar (`|`) you can use `Union` from `typing`.\n+\n+For example, you could declare that something could be a `str` or `None`:\n+\n+\n```\n\n```diff\n@@ -14,7 +14,7 @@ In a hurry and already know this stuff? Jump to the [`Dockerfile` below üëá](#b\n <summary>Dockerfile Preview üëÄ</summary>\n \n \n```\n\n```diff\n@@ -135,27 +135,30 @@ You can use, for example:\n \n {* ../../docs_src/python_types/tutorial005_py39.py hl[1] *}\n \n-### Generic types with type parameters { #generic-types-with-type-parameters }\n+### `typing` module { #typing-module }\n \n-There are some data structures that can contain other values, like `dict`, `list`, `set` and `tuple`. And the internal values can have their own type too.\n+For some additional use cases, you might need to import some things from the standard library `typing` module, for example when you want to declare that something has \"any type\", you can use `Any` from `typing`:\n \n-These types that have internal types are called \"**generic**\" types. And it's possible to declare them, even with their internal types.\n+\n```\n\n```diff\n@@ -106,13 +106,6 @@ As, by default, singular values are interpreted as query parameters, you don't h\n q: str | None = None\n \n```", "output": "Changes look good. This PR implements: ‚ûñ Drop support for Python 3.9", "source": "pr", "type": "code_review", "pr_number": 227}
{"instruction": "Review the following code changes: Params - add style & explode parameter for deepObject/‚Ä¶ encoding", "input": "```diff\n@@ -1,5 +1,7 @@\n+import collections\n import dataclasses\n import inspect\n+import re\n import sys\n from collections.abc import Coroutine, Mapping, Sequence\n from contextlib import AsyncExitStack, contextmanager\n@@ -752,6 +754,62 @@ def _get_multidict_value(\n     return value\n \n \n+class ParameterCodec:\n+    @staticmethod\n+    def _default() -> dict[str, Any]:\n+        return collections.defaultdict(lambda: ParameterCodec._default())\n+\n+    @staticmethod\n+    def decode(\n+        field_info: params.Param,\n+        received_params: Union[Mapping[str, Any], QueryParams, Headers],\n+        field: ModelField,\n+    ) -> dict[str, Any]:\n+        fn: Callable[\n+            [params.Param, Union[Mapping[str, Any], QueryParams, Headers], ModelField],\n+            dict[str, Any],\n+        ]\n+        fn = getattr(ParameterCodec, f\"decode_{field_info.style}\")\n+        return fn(field_info, received_params, field)\n+\n+    @staticmethod\n+    def decode_deepObject(\n+        field_info: params.Param,\n+        received_params: Union[Mapping[str, Any], QueryParams, Headers],\n+        field: ModelField,\n+    ) -> dict[str, Any]:\n+        data: list[tuple[str, str]] = []\n+        for k, v in received_params.items():\n+            if k.startswith(f\"{field.alias}[\"):\n+                data.append((k, v))\n+\n+        r = ParameterCodec._default()\n+\n+        for k, v in data:\n+            \"\"\"\n+            k: name[attr0][attr1]\n+            v: \"5\"\n+            -> {\"name\":{\"attr0\":{\"attr1\":\"5\"}}}\n+            \"\"\"\n+            # p = tuple(map(lambda x: x[:-1] if x[-1] == ']' else x, k.split(\"[\")))\n+            # would do as well, but add basic validation ‚Ä¶\n+            p0 = re.split(r\"(\\[|\\]\\[|\\]$)\", k)\n+            s = p0[1::2]\n+            assert (\n+                p0[-1] == \"\"\n+                and s[0] == \"[\"\n+                and s[-1] == \"]\"\n+                and all(x == \"][\" for x in s[1:-1])\n+            )\n+            p1 = tuple(p0[::2][:-1])\n+\n+            o = r\n+            for i in p1[:-1]:\n+                o = o[i]\n+            o[p1[-1]] = v\n+        return r\n+\n+\n def request_params_to_args(\n     fields: Sequence[ModelField],\n     received_params: Union[Mapping[str, Any], QueryParams, Headers],\n@@ -813,17 +871,30 @@ def request_params_to_args(\n             \"Params must be subclasses of Param\"\n         )\n         loc: tuple[str, ...] = (field_info.in_.value,)\n-        v_, errors_ = _validate_value_with_model_field(\n-            field=first_field, value=params_to_process, values=values, loc=loc\n-        )\n+\n+        if field_info.style == \"deepObject\":\n+            value = ParameterCodec.decode(field_info, received_params, first_field)\n+            value = value[first_field.alias]\n+            v_, errors_ = _validate_value_with_model_field(\n+                field=first_field, value=value, values=value, loc=loc\n+            )\n+        else:\n+            v_, errors_ = _validate_value_with_model_field(\n+                field=first_field, value=params_to_process, values=values,\n\n```\n\n```diff\n@@ -70,6 +70,8 @@ def __init__(\n         deprecated: Union[deprecated, str, bool, None] = None,\n         include_in_schema: bool = True,\n         json_schema_extra: Union[dict[str, Any], None] = None,\n+        style: str = _Unset,\n+        explode: bool = _Unset,\n         **extra: Any,\n     ):\n         if example is not _Unset:\n@@ -130,6 +132,8 @@ def __init__(\n         use_kwargs = {k: v for k, v in kwargs.items() if v is not _Unset}\n \n         super().__init__(**use_kwargs)\n+        self.style = style\n+        self.explode = explode\n \n     def __repr__(self) -> str:\n         return f\"{self.__class__.__name__}({self.default})\"\n@@ -181,6 +185,8 @@ def __init__(\n         deprecated: Union[deprecated, str, bool, None] = None,\n         include_in_schema: bool = True,\n         json_schema_extra: Union[dict[str, Any], None] = None,\n+        style: Literal[\"matrix\", \"label\", \"simple\"] = \"simple\",\n+        explode: bool = False,\n         **extra: Any,\n     ):\n         assert default is ..., \"Path parameters cannot have a default value\"\n@@ -215,6 +221,8 @@ def __init__(\n             openapi_examples=openapi_examples,\n             include_in_schema=include_in_schema,\n             json_schema_extra=json_schema_extra,\n+            style=style,\n+            explode=explode,\n             **extra,\n         )\n \n@@ -265,8 +273,14 @@ def __init__(\n         deprecated: Union[deprecated, str, bool, None] = None,\n         include_in_schema: bool = True,\n         json_schema_extra: Union[dict[str, Any], None] = None,\n+        style: Literal[\n+            \"form\", \"spaceDelimited\", \"pipeDelimited\", \"deepObject\"\n+        ] = \"form\",\n+        explode: bool = _Unset,\n         **extra: Any,\n     ):\n+        if explode is _Unset:\n+            explode = False if style != \"form\" else True\n         super().__init__(\n             default=default,\n             default_factory=default_factory,\n@@ -297,6 +311,8 @@ def __init__(\n             openapi_examples=openapi_examples,\n  ", "output": "Changes look good. This PR implements: Params - add style & explode parameter for deepObject/‚Ä¶ encoding", "source": "pr", "type": "code_review", "pr_number": 226}
{"instruction": "Review the following code changes: üé® Update internal types for Python 3.10", "input": "```diff\n@@ -8,8 +8,11 @@\n from typing import (\n     Annotated,\n     Any,\n+    Literal,\n     Union,\n     cast,\n+    get_args,\n+    get_origin,\n )\n \n from fastapi._compat import lenient_issubclass, shared\n@@ -32,7 +35,6 @@\n from pydantic_core.core_schema import (\n     with_info_plain_validator_function as with_info_plain_validator_function,\n )\n-from typing_extensions import Literal, get_args, get_origin\n \n RequiredParam = PydanticUndefined\n Undefined = PydanticUndefined\n@@ -83,22 +85,22 @@ class ModelField:\n     field_info: FieldInfo\n     name: str\n     mode: Literal[\"validation\", \"serialization\"] = \"validation\"\n-    config: Union[ConfigDict, None] = None\n+    config: ConfigDict | None = None\n \n     @property\n     def alias(self) -> str:\n         a = self.field_info.alias\n         return a if a is not None else self.name\n \n     @property\n-    def validation_alias(self) -> Union[str, None]:\n+    def validation_alias(self) -> str | None:\n         va = self.field_info.validation_alias\n         if isinstance(va, str) and va:\n             return va\n         return None\n \n     @property\n-    def serialization_alias(self) -> Union[str, None]:\n+    def serialization_alias(self) -> str | None:\n         sa = self.field_info.serialization_alias\n         return sa or None\n \n@@ -143,7 +145,7 @@ def validate(\n         value: Any,\n         values: dict[str, Any] = {},  # noqa: B006\n         *,\n-        loc: tuple[Union[int, str], ...] = (),\n+        loc: tuple[int | str, ...] = (),\n     ) -> tuple[Any, list[dict[str, Any]]]:\n         try:\n             return (\n@@ -160,8 +162,8 @@ def serialize(\n         value: Any,\n         *,\n         mode: Literal[\"json\", \"python\"] = \"json\",\n-        include: Union[IncEx, None] = None,\n-        exclude: Union[IncEx, None] = None,\n+        include: IncEx | None = None,\n+        exclude: IncEx | None = None,\n         by_alias: bool = True,\n         exclude_unset: bool = False,\n         exclude_defaults: bool = False,\n@@ -202,7 +204,7 @@ def get_schema_from_model_field(\n     ],\n     separate_input_output_schemas: bool = True,\n ) -> dict[str, Any]:\n-    override_mode: Union[Literal[\"validation\"], None] = (\n+    override_mode: Literal[\"validation\"] | None = (\n         None\n         if (separate_input_output_schemas or _has_computed_fields(field))\n         else \"validation\"\n@@ -318,7 +320,7 @@ def serialize_sequence_value(*, field: ModelField, value: Any) -> Sequence[Any]:\n     return shared.sequence_annotation_to_type[origin_type](value)  # type: ignore[no-any-return,index]\n \n \n-def get_missing_field_error(loc: tuple[Union[int, str], ...]) -> dict[str, Any]:\n+def get_missing_field_error(loc: tuple[int | str, ...]) -> dict[str, Any]:\n     error = ValidationError.from_exception_data(\n         \"Field required\", [{\"type\": \"missing\", \"loc\": loc, \"input\": {}}]\n     ).errors(include_url=False)[0]\n@@ -360,7 +362,7 @@ def get_cached_model_fields(model: type[BaseModel]) -> list[ModelField]:\n # Duplicate of several schema functions from Pydantic v1 to\n\n```\n\n```diff\n@@ -1,12 +1,9 @@\n-from collections.abc import Awaitable, Coroutine, Sequence\n+from collections.abc import Awaitable, Callable, Coroutine, Sequence\n from enum import Enum\n from typing import (\n     Annotated,\n     Any,\n-    Callable,\n-    Optional,\n     TypeVar,\n-    Union,\n )\n \n from annotated_doc import Doc\n@@ -77,7 +74,7 @@ def __init__(\n             ),\n         ] = False,\n         routes: Annotated[\n-            Optional[list[BaseRoute]],\n+            list[BaseRoute] | None,\n             Doc(\n                 \"\"\"\n                 **Note**: you probably shouldn't use this parameter, it is inherited\n@@ -120,7 +117,7 @@ def __init__(\n             ),\n         ] = \"FastAPI\",\n         summary: Annotated[\n-            Optional[str],\n+            str | None,\n             Doc(\n                 \"\"\"\n                 A short summary of the API.\n@@ -203,7 +200,7 @@ def __init__(\n             ),\n         ] = \"0.1.0\",\n         openapi_url: Annotated[\n-            Optional[str],\n+            str | None,\n             Doc(\n                 \"\"\"\n                 The URL where the OpenAPI schema will be served from.\n@@ -226,7 +223,7 @@ def __init__(\n             ),\n         ] = \"/openapi.json\",\n         openapi_tags: Annotated[\n-            Optional[list[dict[str, Any]]],\n+            list[dict[str, Any]] | None,\n             Doc(\n                 \"\"\"\n                 A list of tags used by OpenAPI, these are the same `tags` you can set\n@@ -286,7 +283,7 @@ def __init__(\n             ),\n         ] = None,\n         servers: Annotated[\n-            Optional[list[dict[str, Union[str, Any]]]],\n+            list[dict[str, str | Any]] | None,\n             Doc(\n                 \"\"\"\n                 A `list` of `dict`s with connectivity information to a target server.\n@@ -335,7 +332,7 @@ def __init__(\n             ),\n         ] = None,\n         dependencies: Annotated[\n-            Optional[Sequence[Depends]],\n+            Sequence[Depends] | None,\n             Doc(\n   ", "output": "Changes look good. This PR implements: üé® Update internal types for Python 3.10", "source": "pr", "type": "code_review", "pr_number": 225}
{"instruction": "Review the following code changes: Add overloads to param functions", "input": "```diff\n@@ -1,5 +1,13 @@\n-from collections.abc import Sequence\n-from typing import Annotated, Any, Callable, Optional, Union\n+from collections.abc import AsyncIterator, Awaitable, Iterator, Sequence\n+from typing import (\n+    Annotated,\n+    Any,\n+    Callable,\n+    Optional,\n+    TypeVar,\n+    Union,\n+    overload,\n+)\n \n from annotated_doc import Doc\n from fastapi import params\n@@ -2206,6 +2214,54 @@ def File(  # noqa: N802\n     )\n \n \n+T = TypeVar(\"T\")\n+\n+\n+@overload\n+def Depends(  # noqa: N802\n+    dependency: None = None,\n+    *,\n+    use_cache: bool = True,\n+) -> Any:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Depends(  # noqa: N802\n+    dependency: Callable[..., Awaitable[T]],\n+    *,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Depends(  # noqa: N802\n+    dependency: Callable[..., Iterator[T]],\n+    *,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Depends(  # noqa: N802\n+    dependency: Callable[..., AsyncIterator[T]],\n+    *,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Depends(  # noqa: N802\n+    dependency: Callable[..., T],\n+    *,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n def Depends(  # noqa: N802\n     dependency: Annotated[\n         Optional[Callable[..., Any]],\n@@ -2286,6 +2342,56 @@ async def read_items(commons: Annotated[dict, Depends(common_parameters)]):\n     return params.Depends(dependency=dependency, use_cache=use_cache, scope=scope)\n \n \n+@overload\n+def Security(  # noqa: N802\n+    dependency: None = None,\n+    *,\n+    scopes: Optional[Sequence[str]] = None,\n+    use_cache: bool = True,\n+) -> Any:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Security(  # noqa: N802\n+    dependency: Callable[..., Awaitable[T]],\n+    *,\n+    scopes: Optional[Sequence[str]] = None,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Security(  # noqa: N802\n+    dependency: Callable[..., Iterator[T]],\n+    *,\n+    scopes: Optional[Sequence[str]] = None,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Security(  # noqa: N802\n+    dependency: Callable[..., AsyncIterator[T]],\n+    *,\n+    scopes: Optional[Sequence[str]] = None,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n+@overload\n+def Security(  # noqa: N802\n+    dependency: Callable[..., T],\n+    *,\n+    scopes: Optional[Sequence[str]] = None,\n+    use_cache: bool = True,\n+) -> T:  # pragma: nocover\n+    pass\n+\n+\n def Security(  # noqa: N802\n     dependency: Annotated[\n         Optional[Callable[..., Any]],\n\n```", "output": "Changes look good. This PR implements: Add overloads to param functions", "source": "pr", "type": "code_review", "pr_number": 224}
{"instruction": "Review the following code changes: ‚ú® Support Free From query parameters", "input": "```diff\n@@ -186,3 +186,17 @@ In this case, there are 3 query parameters:\n You could also use `Enum`s the same way as with [Path Parameters](path-params.md#predefined-values){.internal-link target=_blank}.\n \n ///\n+\n+## Free Form Query Parameters { #free-form-query-parameters }\n+\n+Sometimes you want to receive some query parameters, but you don't know in advance what they are called. **FastAPI** provides support for this use case as well.\n+\n+=== \"Python 3.10+\"\n+\n+    \n```\n\n```diff\n@@ -0,0 +1,20 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Query\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/query/mixed-type-params\")\n+def get_mixed_mapping_mixed_type_query_params(\n+    query: Annotated[int, Query()] = None,\n+    mapping_query_str: Annotated[dict[str, str], Query()] = None,\n+    mapping_query_int: Annotated[dict[str, int], Query()] = None,\n+    sequence_mapping_int: Annotated[dict[str, list[int]], Query()] = None,\n+):\n+    return {\n+        \"query\": query,\n+        \"mapping_query_str\": mapping_query_str,\n+        \"mapping_query_int\": mapping_query_int,\n+        \"sequence_mapping_int\": sequence_mapping_int,\n+    }\n\n```\n\n```diff\n@@ -1,9 +1,15 @@\n from .shared import PYDANTIC_VERSION_MINOR_TUPLE as PYDANTIC_VERSION_MINOR_TUPLE\n from .shared import annotation_is_pydantic_v1 as annotation_is_pydantic_v1\n from .shared import field_annotation_is_scalar as field_annotation_is_scalar\n+from .shared import (\n+    field_annotation_is_scalar_mapping as field_annotation_is_scalar_mapping,\n+)\n from .shared import (\n     field_annotation_is_scalar_sequence as field_annotation_is_scalar_sequence,\n )\n+from .shared import (\n+    field_annotation_is_scalar_sequence_mapping as field_annotation_is_scalar_sequence_mapping,\n+)\n from .shared import field_annotation_is_sequence as field_annotation_is_sequence\n from .shared import (\n     is_bytes_or_nonable_bytes_annotation as is_bytes_or_nonable_bytes_annotation,\n@@ -34,6 +40,7 @@\n from .v2 import get_model_name_map as get_model_name_map\n from .v2 import get_schema_from_model_field as get_schema_from_model_field\n from .v2 import is_scalar_field as is_scalar_field\n+from .v2 import omit_by_default as omit_by_default\n from .v2 import serialize_sequence_value as serialize_sequence_value\n from .v2 import (\n     with_info_plain_validator_function as with_info_plain_validator_function,\n\n```\n\n```diff\n@@ -125,6 +125,52 @@ def field_annotation_is_scalar_sequence(annotation: Union[type[Any], None]) -> b\n     )\n \n \n+def field_annotation_is_scalar_mapping(\n+    annotation: Union[type[Any], None],\n+) -> bool:\n+    origin = get_origin(annotation)\n+    if origin is Annotated:\n+        return field_annotation_is_scalar_mapping(get_args(annotation)[0])\n+    if origin is Union or origin is UnionType:\n+        at_least_one_scalar_mapping = False\n+        for arg in get_args(annotation):\n+            if field_annotation_is_scalar_mapping(arg):\n+                at_least_one_scalar_mapping = True\n+                continue\n+            elif not field_annotation_is_scalar(arg):\n+                return False\n+        return at_least_one_scalar_mapping\n+    return lenient_issubclass(origin, Mapping) and all(\n+        field_annotation_is_scalar(sub_annotation)\n+        for sub_annotation in get_args(annotation)\n+    )\n+\n+\n+def field_annotation_is_scalar_sequence_mapping(\n+    annotation: Union[type[Any], None],\n+) -> bool:\n+    origin = get_origin(annotation)\n+    if origin is Annotated:\n+        return field_annotation_is_scalar_sequence_mapping(get_args(annotation)[0])\n+    if origin is Union or origin is UnionType:\n+        at_least_one_scalar_mapping = False\n+        for arg in get_args(annotation):\n+            if field_annotation_is_scalar_sequence_mapping(arg):\n+                at_least_one_scalar_mapping = True\n+                continue\n+            elif not (\n+                field_annotation_is_scalar_sequence_mapping(arg)\n+                or field_annotation_is_scalar_mapping(arg)\n+            ):\n+                return False\n+        return at_least_one_scalar_mapping\n+    return lenient_issubclass(origin, Mapping) and all(\n+        field_annotation_is_scalar_sequence(sub_annotation)\n+        or field_annotation_is_scalar(sub_annotation)\n+        for sub_annotation in get_args(annotation)\n+    )\n+\n+\n def is_bytes_or_nonable_bytes_annotation(annotation: Any) -> bool:\n     if lenient_issubclass(annotation, bytes):\n         return True\n\n```\n\n```diff\n@@ -5,17 +5,20 @@\n from dataclasses import dataclass, is_dataclass\n from enum import Enum\n from functools import lru_cache\n-from typing import (\n-    Annotated,\n-    Any,\n-    Union,\n-    cast,\n-)\n+from typing import Annotated, Any, Callable, Union, cast\n \n from fastapi._compat import lenient_issubclass, shared\n from fastapi.openapi.constants import REF_TEMPLATE\n from fastapi.types import IncEx, ModelNameMap, UnionType\n-from pydantic import BaseModel, ConfigDict, Field, TypeAdapter, create_model\n+from pydantic import (\n+    BaseModel,\n+    ConfigDict,\n", "output": "Code Review for: ‚ú® Support Free From query parameters\n\nüìù **docs/en/docs/tutorial/query-params.md**: ```suggestion\r\nSometimes you want to receive some query parameters, but you don't know in advance what they are called. **FastAPI** provides support for this use case.\r\n```\n\nüìù **tests/test_query.py**: I would expect explicitly specified `query` parameter not be included in `sequence_mapping_queries`, `mapping_query_str` and `mapping_query_int`.\r\nBut maybe this is not a problem if documented\n\nüìù **tests/main.py**: ```suggestion\r\n    return {\r\n        \"queries\": queries,\r\n    }\r\n```\r\n\r\nAnd then test it in `` as:\r\n```py\r\nassert response.json() == {\"foo\": \"fuzz\", \"bar\":  \"buzz\"}\r\n```\r\n\r\nAnd the same for all other enptoints\n\nüìù **tests/test_query.py**: added logic in to cover this and removed the section from the docs.\n\nüìù **tests/main.py**: updated them\n\n", "source": "pr", "type": "code_review", "pr_number": 223}
{"instruction": "Review this code change in `docs/en/docs/tutorial/query-params.md`", "input": "```diff\n@@ -223,3 +223,45 @@ In this case, there are 3 query parameters:\n \n !!! tip\n     You could also use `Enum`s the same way as with [Path Parameters](path-params.md#predefined-values){.internal-link target=_blank}.\n+\n+## Free Form Query Parameters\n+\n+Sometimes you want to receive some query parameters, but you don't know in advance what they are called. **FastAPI** supports provides support for this use case.\n\n```", "output": "```suggestion\r\nSometimes you want to receive some query parameters, but you don't know in advance what they are called. **FastAPI** provides support for this use case.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 223}
{"instruction": "Review this code change in `tests/test_query.py`", "input": "```diff\n@@ -408,3 +408,36 @@ def test_query_frozenset_query_1_query_1_query_2():\n     response = client.get(\"/query/frozenset/?query=1&query=1&query=2\")\n     assert response.status_code == 200\n     assert response.json() == \"1,2\"\n+\n+\n+def test_mapping_query():\n+    response = client.get(\"/query/mapping-params/?foo=fuzz&bar=buzz\")\n+    assert response.status_code == 200\n+    assert response.json() == \"foo bar fuzz buzz\"\n+\n+\n+def test_mapping_with_non_mapping_query():\n+    response = client.get(\"/query/mixed-params/?foo=fuzz&foo=baz&bar=buzz&query=fizz\")\n+    assert response.status_code == 200\n+    assert response.json() == \"foo bar fuzz baz baz buzz fizz\"\n+\n+\n+def test_mapping_with_non_mapping_query_mixed_types():\n+    response = client.get(\"/query/mixed-type-params/?foo=fuzz&foo=baz&bar=buzz&query=1\")\n+    assert response.status_code == 200\n+    assert (\n+        response.json()\n+        == \"foo bar 1 {'foo': 'baz', 'bar': 'buzz', 'query': '1'}  {'query': 1} {'foo': [], 'bar': [], 'query': [1]}\"\n\n```", "output": "I would expect explicitly specified `query` parameter not be included in `sequence_mapping_queries`, `mapping_query_str` and `mapping_query_int`.\r\nBut maybe this is not a problem if documented", "source": "pr_review", "type": "inline_review", "pr_number": 223}
{"instruction": "Review this code change in `tests/main.py`", "input": "```diff\n@@ -184,6 +184,38 @@ def get_query_param_required_type(query: int = Query()):\n     return f\"foo bar {query}\"\n \n \n+@app.get(\"/query/mapping-params\")\n+def get_mapping_query_params(queries: Dict[str, str] = Query({})):\n+    return f\"foo bar {queries['foo']} {queries['bar']}\"\n\n```", "output": "```suggestion\r\n    return {\r\n        \"queries\": queries,\r\n    }\r\n```\r\n\r\nAnd then test it in `` as:\r\n```py\r\nassert response.json() == {\"foo\": \"fuzz\", \"bar\":  \"buzz\"}\r\n```\r\n\r\nAnd the same for all other enptoints", "source": "pr_review", "type": "inline_review", "pr_number": 223}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -819,6 +850,14 @@ def request_params_to_args(\n             errors.extend(errors_)\n         else:\n             values[field.name] = v_\n+    # remove keys which were captured by a mapping query field but were\n+    # specified as individual fields\n+    for field in fields:\n+        if isinstance(values.get(field.name), dict) and (\n+            is_scalar_mapping_field(field) or is_scalar_sequence_mapping_field(field)\n+        ):\n+            for f_ in fields:\n+                values[field.name].pop(f_.alias, None)\n\n```", "output": "This could also be moved to inside `_get_multidict_value` so the field types are only checked once if we don't mind passing `fields` into that function", "source": "pr_review", "type": "inline_review", "pr_number": 223}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Flexible router args", "input": "```diff\n@@ -1469,7 +1469,7 @@ def get(\n                 \"\"\"\n             ),\n         ],\n-        *,\n+        *args: Any,\n         response_model: Annotated[\n             Any,\n             Doc(\n@@ -1788,6 +1788,7 @@ def get(\n                 \"\"\"\n             ),\n         ] = Default(generate_unique_id),\n+        **kwargs: Any,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         \"\"\"\n         Add a *path operation* using an HTTP GET operation.\n@@ -1806,6 +1807,7 @@ def read_items():\n         \"\"\"\n         return self.router.get(\n             path,\n+            *args,\n             response_model=response_model,\n             status_code=status_code,\n             tags=tags,\n@@ -1828,6 +1830,7 @@ def read_items():\n             callbacks=callbacks,\n             openapi_extra=openapi_extra,\n             generate_unique_id_function=generate_unique_id_function,\n+            **kwargs,\n         )\n \n     def put(\n@@ -1842,7 +1845,7 @@ def put(\n                 \"\"\"\n             ),\n         ],\n-        *,\n+        *args: Any,\n         response_model: Annotated[\n             Any,\n             Doc(\n@@ -2161,6 +2164,7 @@ def put(\n                 \"\"\"\n             ),\n         ] = Default(generate_unique_id),\n+        **kwargs: Any,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         \"\"\"\n         Add a *path operation* using an HTTP PUT operation.\n@@ -2184,6 +2188,7 @@ def replace_item(item_id: str, item: Item):\n         \"\"\"\n         return self.router.put(\n             path,\n+            *args,\n             response_model=response_model,\n             status_code=status_code,\n             tags=tags,\n@@ -2206,6 +2211,7 @@ def replace_item(item_id: str, item: Item):\n             callbacks=callbacks,\n             openapi_extra=openapi_extra,\n             generate_unique_id_function=generate_unique_id_function,\n+            **kwargs,\n         )\n \n     def post(\n@@ -2220,7 +2226,7 @@ def post(\n                 \"\"\"\n             ),\n         ],\n-        *,\n+        *args: Any,\n         response_model: Annotated[\n             Any,\n             Doc(\n@@ -2539,6 +2545,7 @@ def post(\n                 \"\"\"\n             ),\n         ] = Default(generate_unique_id),\n+        **kwargs: Any,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         \"\"\"\n         Add a *path operation* using an HTTP POST operation.\n@@ -2562,6 +2569,7 @@ def create_item(item: Item):\n         \"\"\"\n         return self.router.post(\n             path,\n+            *args,\n             response_model=response_model,\n             status_code=status_code,\n             tags=tags,\n@@ -2584,6 +2592,7 @@ def create_item(item: Item):\n             callbacks=callbacks,\n             openapi_extra=openapi_extra,\n             generate_unique_id_function=generate_unique_id_function,\n+            **kwargs,\n         )\n \n     def delete(\n@@ -2598,7 +2607,7 @@ def delete(\n                 \"\"\"\n             ),\n         ],\n-        *,\n+        *args: Any,\n         response_model: Annotated[\n      \n\n```\n\n```diff\n@@ -430,7 +430,7 @@ def __init__(\n         self,\n         path: str,\n         endpoint: Callable[..., Any],\n-        *,\n+        *args: Any,\n         response_model: Any = Default(None),\n         status_code: Optional[int] = None,\n         tags: Optional[List[Union[str, Enum]]] = None,\n@@ -459,6 +459,7 @@ def __init__(\n         generate_unique_id_function: Union[\n             Callable[[\"APIRoute\"], str], DefaultPlaceholder\n         ] = Default(generate_unique_id),\n+        **kwargs: Any,\n     ) -> None:\n         self.path = path\n         self.endpoint = endpoint\n@@ -621,7 +622,7 @@ async def read_users():\n \n     def __init__(\n         self,\n-        *,\n+        *args: Any,\n         prefix: Annotated[str, Doc(\"An optional path prefix for the router.\")] = \"\",\n         tags: Annotated[\n             Optional[List[Union[str, Enum]]],\n@@ -833,6 +834,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = Default(generate_unique_id),\n+        **kwargs: Any,\n     ) -> None:\n         super().__init__(\n             routes=routes,\n@@ -882,7 +884,7 @@ def add_api_route(\n         self,\n         path: str,\n         endpoint: Callable[..., Any],\n-        *,\n+        *args: Any,\n         response_model: Any = Default(None),\n         status_code: Optional[int] = None,\n         tags: Optional[List[Union[str, Enum]]] = None,\n@@ -911,6 +913,7 @@ def add_api_route(\n         generate_unique_id_function: Union[\n             Callable[[APIRoute], str], DefaultPlaceholder\n         ] = Default(generate_unique_id),\n+        **kwargs: Any,\n     ) -> None:\n         route_class = route_class_override or self.route_class\n         responses = responses or {}\n@@ -932,7 +935,8 @@ def add_api_route(\n         )\n         route = route_class(\n             self.prefix + path,\n-            endpoint=endpoint,\n+            endpoint,\n+            *args,\n             response_model=response_model,\n             status_code=status_code,\n             tags=current_tags,\n@@ -957,", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Flexible router args", "source": "pr", "type": "code_review", "pr_number": 222}
{"instruction": "Review the following code changes: Add PydanticJSONResponse", "input": "```diff\n@@ -205,6 +205,27 @@ def serialize(\n             exclude_none=exclude_none,\n         )\n \n+    def serialize_json(\n+        self,\n+        value: Any,\n+        *,\n+        include: Union[IncEx, None] = None,\n+        exclude: Union[IncEx, None] = None,\n+        by_alias: bool = True,\n+        exclude_unset: bool = False,\n+        exclude_defaults: bool = False,\n+        exclude_none: bool = False,\n+    ) -> bytes:\n+        return self._type_adapter.dump_json(\n+            value,\n+            include=include,\n+            exclude=exclude,\n+            by_alias=by_alias,\n+            exclude_unset=exclude_unset,\n+            exclude_defaults=exclude_defaults,\n+            exclude_none=exclude_none,\n+        )\n+\n     def __hash__(self) -> int:\n         # Each ModelField is unique for our purposes, to allow making a dict from\n         # ModelField to its JSON Schema.\n\n```\n\n```diff\n@@ -46,3 +46,15 @@ def render(self, content: Any) -> bytes:\n         return orjson.dumps(\n             content, option=orjson.OPT_NON_STR_KEYS | orjson.OPT_SERIALIZE_NUMPY\n         )\n+\n+\n+class PydanticJSONResponse(JSONResponse):\n+    \"\"\"\n+    JSON response using Pydantic v2's built-in JSON serialization\n+    \"\"\"\n+\n+    def render(self, content: Any) -> bytes:\n+        assert isinstance(content, bytes), (\n+            \"PydanticJSONResponse must be used with a response model\"\n+        )\n+        return content\n\n```\n\n```diff\n@@ -48,6 +48,7 @@\n     ResponseValidationError,\n     WebSocketRequestValidationError,\n )\n+from fastapi.responses import JSONResponse, PydanticJSONResponse, Response\n from fastapi.types import DecoratedCallable, IncEx\n from fastapi.utils import (\n     create_cloned_field,\n@@ -62,7 +63,6 @@\n from starlette.concurrency import run_in_threadpool\n from starlette.exceptions import HTTPException\n from starlette.requests import Request\n-from starlette.responses import JSONResponse, Response\n from starlette.routing import (\n     BaseRoute,\n     Match,\n@@ -191,6 +191,7 @@ async def serialize_response(\n     *,\n     field: Optional[ModelField] = None,\n     response_content: Any,\n+    to_json: bool = False,\n     include: Optional[IncEx] = None,\n     exclude: Optional[IncEx] = None,\n     by_alias: bool = True,\n@@ -218,6 +219,16 @@ async def serialize_response(\n                 endpoint_ctx=ctx,\n             )\n \n+        if to_json:\n+            return field.serialize_json(\n+                value,\n+                include=include,\n+                exclude=exclude,\n+                by_alias=by_alias,\n+                exclude_unset=exclude_unset,\n+                exclude_defaults=exclude_defaults,\n+                exclude_none=exclude_none,\n+            )\n         return field.serialize(\n             value,\n             include=include,\n@@ -377,6 +388,7 @@ async def app(request: Request) -> Response:\n                 content = await serialize_response(\n                     field=response_field,\n                     response_content=raw_response,\n+                    to_json=issubclass(actual_response_class, PydanticJSONResponse),\n                     include=response_model_include,\n                     exclude=response_model_exclude,\n                     by_alias=response_model_by_alias,\n\n```\n\n```diff\n@@ -0,0 +1,155 @@\n+import math\n+from typing import Optional\n+\n+import pytest\n+from dirty_equals import IsFloatNan\n+from fastapi import FastAPI\n+from fastapi.responses import PydanticJSONResponse\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel, Field\n+\n+app = FastAPI(default_response_class=PydanticJSONResponse)\n+\n+\n+class CustomResponse(PydanticJSONResponse):\n+    media_type = \"application/x-custom\"\n+\n+\n+class Item(BaseModel):\n+    name: str\n+    price: float\n+    category: str = Field(\"food\", alias=\"CAT\")\n+    tax: float = 8.875\n+    description: Optional[str] = None\n+\n+\n+@app.get(\"/response-model\", response_model=Item)\n+@app.get(\n+    \"/response-model-include\",\n+    response_model=Item,\n+    response_model_include={\"name\", \"category\"},\n+)\n+@app.get(\n+    \"/response-model-exclude\",\n+    response_model=Item,\n+    response_model_exclude={\"tax\", \"description\"},\n+)\n+@app.get(\n+    \"/response-model-by-alias-false\",\n+    response_model=Item,\n+    response_model_by_alias=False,\n+)\n+@app.get(\n+    \"/response-model-exclude-unset\",\n+    response_model=Item,\n+    response_model_exclude_unset=True,\n+)\n+@app.get(\n+    \"/response-model-exclude-defaults\",\n+    response_model=Item,\n+    response_model_exclude_defaults=True,\n+)\n+@app.get(\n+    \"/response-model-exclude-none\",\n+    response_model=Item,\n+    response_model_exclude_none=True,\n+)\n+def get_response_model_params():\n+    return {\"name\": \"cheese\", \"price\": 1.23, \"tax\": 8.875, \"description\": None}\n+\n+\n+class FloatsNone(BaseModel):\n+    # pydantic converts inf/nan to None by default\n+    numbers: list[float]\n+\n+\n+class FloatsNum(FloatsNone):\n+    model_config = {\"ser_json_inf_nan\": \"constants\"}\n+\n+\n+class FloatsStr(FloatsNone):\n+    model_config = {\"ser_json_inf_n", "output": "Code Review for: Add PydanticJSONResponse\n\nüìù **fastapi/routing.py**: ```suggestion\r\n            assert not to_json, \"PydanticJSONResponse only works with pydantic v2 models\"\r\n```\r\nIt's possible to have Pydantic V2 installed, but use V1 models (from pydantic.v1 import BaseModel).\r\nThis way the message will be clearer about it\n\nüìù **tests/test_pydantic_json_response_class.py**: ```suggestion\r\nclass ResponseModel(BaseModel):\r\n```\n\nüìù **tests/test_pydantic_json_response_class.py**: ```suggestion\r\ndef get_basic_response() -> ResponseModel:\r\n    return ResponseModel(\r\n```\r\n\r\n`Response` is very confusing, it took me some time to notice that this is not `Response` imported from `fastapi` but user-defined model\n\n", "source": "pr", "type": "code_review", "pr_number": 221}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -229,11 +229,13 @@ async def serialize_response(\n     exclude_defaults: bool = False,\n     exclude_none: bool = False,\n     is_coroutine: bool = True,\n+    to_json: bool = False,\n ) -> Any:\n     if field:\n         errors = []\n         if not hasattr(field, \"serialize\"):\n             # pydantic v1\n+            assert not to_json, \"PydanticJSONResponse requires pydantic v2\"\n\n```", "output": "```suggestion\r\n            assert not to_json, \"PydanticJSONResponse only works with pydantic v2 models\"\r\n```\r\nIt's possible to have Pydantic V2 installed, but use V1 models (from pydantic.v1 import BaseModel).\r\nThis way the message will be clearer about it", "source": "pr_review", "type": "inline_review", "pr_number": 221}
{"instruction": "Review this code change in `tests/test_pydantic_json_response_class.py`", "input": "```diff\n@@ -0,0 +1,39 @@\n+import math\n+from datetime import date\n+from typing import List\n+\n+from fastapi import FastAPI\n+from fastapi.responses import PydanticJSONResponse\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+from .utils import needs_pydanticv2\n+\n+app = FastAPI(default_response_class=PydanticJSONResponse)\n+\n+\n+class Response(BaseModel):\n\n```", "output": "```suggestion\r\nclass ResponseModel(BaseModel):\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 221}
{"instruction": "Review the following code changes: Security dependencies compatibility with websockets", "input": "```diff\n@@ -4,7 +4,7 @@\n from fastapi.openapi.models import APIKey, APIKeyIn\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n \n@@ -137,7 +137,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         api_key = request.query_params.get(self.model.name)\n         return self.check_api_key(api_key)\n \n@@ -225,7 +225,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         api_key = request.headers.get(self.model.name)\n         return self.check_api_key(api_key)\n \n@@ -313,6 +313,6 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         api_key = request.cookies.get(self.model.name)\n         return self.check_api_key(api_key)\n\n```\n\n```diff\n@@ -9,7 +9,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n \n@@ -92,7 +92,7 @@ def make_not_authenticated_error(self) -> HTTPException:\n         )\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n@@ -202,7 +202,7 @@ def make_authenticate_headers(self) -> dict[str, str]:\n         return {\"WWW-Authenticate\": \"Basic\"}\n \n     async def __call__(  # type: ignore\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPBasicCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n@@ -303,7 +303,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n@@ -406,7 +406,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n     ) -> Optional[HTTPAuthorizationCredentials]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.param_functions import Form\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n \n@@ -396,7 +396,7 @@ def make_not_authenticated_error(self) -> HTTPException:\n             headers={\"WWW-Authenticate\": \"Bearer\"},\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         authorization = request.headers.get(\"Authorization\")\n         if not authorization:\n             if self.auto_error:\n@@ -503,7 +503,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n         if not authorization or scheme.lower() != \"bearer\":\n@@ -609,7 +609,7 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> Optional[str]:\n+    async def __call__(self, request: HTTPConnection) -> Optional[str]:\n         authorization = request.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n         if not authorization or scheme.lower() != \"bearer\":\n\n```\n\n```diff\n@@ -4,7 +4,7 @@\n from fastapi.openapi.models import OpenIdConnect as OpenIdConnectModel\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTT", "output": "Changes look good. This PR implements: Security dependencies compatibility with websockets", "source": "pr", "type": "code_review", "pr_number": 220}
{"instruction": "Review the following code changes: ‚ú® Allow specifying `max_field`, `max_files` and `max_part_size` for routers and path operations", "input": "```diff\n@@ -2624,6 +2624,36 @@ def post(\n                 \"\"\"\n             ),\n         ] = Default(generate_unique_id),\n+        form_max_fields: Annotated[\n+            int,\n+            Doc(\n+                \"\"\"\n+                Maximum number of form fields to accept.\n+\n+                This limits the number of fields in a form submission to prevent\n+                potential denial-of-service attacks.\n+                \"\"\"\n+            ),\n+        ] = 1000,\n+        form_max_files: Annotated[\n+            int,\n+            Doc(\n+                \"\"\"\n+                Maximum number of files to accept in a form submission.\n+\n+                This limits the number of files in a form submission to prevent\n+                potential denial-of-service attacks.\n+                \"\"\"\n+            ),\n+        ] = 1000,\n+        max_part_size: Annotated[\n+            int,\n+            Doc(\n+                \"\"\"\n+                Maximum size (in bytes) for each part in a multipart form submission.\n+                \"\"\"\n+            ),\n+        ] = 1024 * 1024,\n     ) -> Callable[[DecoratedCallable], DecoratedCallable]:\n         \"\"\"\n         Add a *path operation* using an HTTP POST operation.\n@@ -2669,6 +2699,9 @@ def create_item(item: Item):\n             callbacks=callbacks,\n             openapi_extra=openapi_extra,\n             generate_unique_id_function=generate_unique_id_function,\n+            form_max_fields=form_max_fields,\n+            form_max_files=form_max_files,\n+            max_part_size=max_part_size,\n         )\n \n     def delete(\n\n```\n\n```diff\n@@ -300,6 +300,9 @@ def get_request_handler(\n     response_model_exclude_none: bool = False,\n     dependency_overrides_provider: Optional[Any] = None,\n     embed_body_fields: bool = False,\n+    form_max_fields: int = 1000,\n+    form_max_files: int = 1000,\n+    max_part_size: int = 1024 * 1024,\n ) -> Callable[[Request], Coroutine[Any, Any, Response]]:\n     assert dependant.call is not None, \"dependant.call must be a function\"\n     is_coroutine = dependant.is_coroutine_callable\n@@ -323,7 +326,11 @@ async def app(request: Request) -> Response:\n             body: Any = None\n             if body_field:\n                 if is_body_form:\n-                    body = await request.form()\n+                    body = await request.form(\n+                        max_fields=form_max_fields,\n+                        max_files=form_max_files,\n+                        max_part_size=max_part_size,\n+                    )\n                     file_stack.push_async_callback(body.close)\n                 else:\n                     body_bytes = await request.body()\n@@ -535,6 +542,9 @@ def __init__(\n         generate_unique_id_function: Union[\n             Callable[[\"APIRoute\"], str], DefaultPlaceholder\n         ] = Default(generate_unique_id),\n+        form_max_fields: int = 1000,\n+        form_max_files: int = 1000,\n+        max_part_size: int = 1024 * 1024,\n     ) -> None:\n         self.path = path\n         self.endpoint = endpoint\n@@ -565,6 +575,9 @@ def __init__(\n         self.responses = responses or {}\n         self.name = get_name(endpoint) if name is None else name\n         self.path_regex, self.path_format, self.param_convertors = compile_path(path)\n+        self.form_max_fields = form_max_fields\n+        self.form_max_files = form_max_files\n+        self.max_part_size = max_part_size\n         if methods is None:\n             methods = [\"GET\"]\n         self.methods: Set[str] = {method.upper() for method in methods}\n@@ -661,6 +674,9 @@ def get_route_handler(self) -> Callable[[Request], Coroutine[Any, Any, Response]\n             response_model_exclude_none=self.response_model_exclude_none,\n             dependency_overrides_provider=self.dependency_overrides_provider,\n             embed_body_fields=self._embed_body_fields,\n+            form_max_fields=self.form_max_fields,\n+            form_max_files=self.form_max_files,\n+            max_part_size=self.max_part_size,\n         )\n \n     def matches(self, scope: Scope) -> Tuple[Match, Scope]:\n@@ -989,6 +1005,9 @@ def add_api_route(\n         generate_unique_id_function: Union[\n             Callable[[APIRoute], str], DefaultPlaceholder\n         ] = Default(generate_unique_id),\n+        form_max_fields: int = 1000,\n+        form_max_files: int = 1000,\n+        form_max_part_size: int = 1024 * 1024,\n     ) -> None:\n         route_class = route_class_override or self.route_class\n         responses = responses or {}\n@@ -1035,6 +1054,9 @@ def add_api_route(\n             callbacks=current_callbacks,\n             openapi_ext\n\n```\n\n```diff\n@@ -0,0 +1,89 @@\n+from typing import List\n+\n+from fastapi import FastAPI, File, UploadFile\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/\", form_max_files=2, max_part_size=1024, form_max_fields=2)\n+async def upload_files(files: List[UploadFile] = File(...)):\n+    return {\"filenames\": [file.filename for file in files]}\n+\n+\n+def test_form_max_files_send_one():\n+    client = Te", "output": "Code Review for: ‚ú® Allow specifying `max_field`, `max_files` and `max_part_size` for routers and path operations\n\nüìù **tests/test_form_max_fields_files_part_size.py**: Would it make more sense to have it be `1KB +1` instead of `1MB +1`, to ensure the 1KB limit is precise, or am I misunderstanding something (quite possible!)?\n\nüìù **tests/test_form_max_fields_files_part_size.py**: Good catch!\r\nThank you!\n\n", "source": "pr", "type": "code_review", "pr_number": 219}
{"instruction": "Review this code change in `tests/test_form_max_fields_files_part_size.py`", "input": "```diff\n@@ -0,0 +1,89 @@\n+from typing import List\n+\n+from fastapi import FastAPI, File, UploadFile\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/\", form_max_files=2, form_max_part_size=1024, form_max_fields=2)\n+async def upload_files(files: List[UploadFile] = File(...)):\n+    return {\"filenames\": [file.filename for file in files]}\n+\n+\n+def test_form_max_files_send_one():\n+    client = TestClient(app)\n+\n+    response = client.post(\n+        \"/\",\n+        files=[\n+            (\"files\", (\"file1.txt\", b\"file1 content\", \"text/plain\")),\n+        ],\n+    )\n+\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"filenames\": [\"file1.txt\"]}\n+\n+\n+def test_form_max_files_send_too_many():\n+    client = TestClient(app)\n+\n+    response = client.post(\n+        \"/\",\n+        files=[\n+            (\"files\", (\"file1.txt\", b\"file1 content\", \"text/plain\")),\n+            (\"files\", (\"file2.txt\", b\"file2 content\", \"text/plain\")),\n+            (\"files\", (\"file3.txt\", b\"file3 content\", \"text/plain\")),\n+        ],\n+    )\n+\n+    assert response.status_code == 400, response.text\n+    assert response.json() == {\n+        \"detail\": \"Too many files. Maximum number of files is 2.\"\n+    }\n+\n+\n+def test_max_part_size_exceeds_custom_limit():\n+    client = TestClient(app)\n+\n+    boundary = \"------------------------4K1ON9fZkj9uCUmqLHRbbR\"\n+\n+    multipart_data = (\n+        f\"--{boundary}\\r\\n\"\n+        f'Content-Disposition: form-data; name=\"small\"\\r\\n\\r\\n'\n+        \"small content\\r\\n\"\n+        f\"--{boundary}\\r\\n\"\n+        f'Content-Disposition: form-data; name=\"large\"\\r\\n\\r\\n'\n+        + (\"x\" * 1024 * 10 + \"x\")  # 1MB + 1 byte of data\n\n```", "output": "Would it make more sense to have it be `1KB +1` instead of `1MB +1`, to ensure the 1KB limit is precise, or am I misunderstanding something (quite possible!)?", "source": "pr_review", "type": "inline_review", "pr_number": 219}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Refactor `jsonable_encoder` to optimize subclass encoder resolution using MRO", "input": "```diff\n@@ -1,6 +1,6 @@\n import dataclasses\n import datetime\n-from collections import defaultdict, deque\n+from collections import deque\n from collections.abc import Callable\n from decimal import Decimal\n from enum import Enum\n@@ -95,20 +95,6 @@ def decimal_encoder(dec_value: Decimal) -> int | float:\n }\n \n \n-def generate_encoders_by_class_tuples(\n-    type_encoder_map: dict[Any, Callable[[Any], Any]],\n-) -> dict[Callable[[Any], Any], tuple[Any, ...]]:\n-    encoders_by_class_tuples: dict[Callable[[Any], Any], tuple[Any, ...]] = defaultdict(\n-        tuple\n-    )\n-    for type_, encoder in type_encoder_map.items():\n-        encoders_by_class_tuples[encoder] += (type_,)\n-    return encoders_by_class_tuples\n-\n-\n-encoders_by_class_tuples = generate_encoders_by_class_tuples(ENCODERS_BY_TYPE)\n-\n-\n def jsonable_encoder(\n     obj: Annotated[\n         Any,\n@@ -314,11 +300,9 @@ def jsonable_encoder(\n             )\n         return encoded_list\n \n-    if type(obj) in ENCODERS_BY_TYPE:\n-        return ENCODERS_BY_TYPE[type(obj)](obj)\n-    for encoder, classes_tuple in encoders_by_class_tuples.items():\n-        if isinstance(obj, classes_tuple):\n-            return encoder(obj)\n+    for base in obj.__class__.__mro__[:-1]:\n+        if base in ENCODERS_BY_TYPE:\n+            return ENCODERS_BY_TYPE[base](obj)\n     if is_pydantic_v1_model_instance(obj):\n         raise PydanticV1NotSupportedError(\n             \"pydantic.v1 models are no longer supported by FastAPI.\"\n\n```\n\n```diff\n@@ -312,11 +298,9 @@ def jsonable_encoder(\n             )\n         return encoded_list\n \n-    if type(obj) in ENCODERS_BY_TYPE:\n-        return ENCODERS_BY_TYPE[type(obj)](obj)\n-    for encoder, classes_tuple in encoders_by_class_tuples.items():\n-        if isinstance(obj, classes_tuple):\n-            return encoder(obj)\n+    for base in obj.__class__.__mro__[:-1]:\n+        if base in ENCODERS_BY_TYPE:\n+            return ENCODERS_BY_TYPE[base](obj)\n\n```\n\n```diff\n@@ -312,11 +298,9 @@ def jsonable_encoder(\n             )\n         return encoded_list\n \n-    if type(obj) in ENCODERS_BY_TYPE:\n-        return ENCODERS_BY_TYPE[type(obj)](obj)\n-    for encoder, classes_tuple in encoders_by_class_tuples.items():\n-        if isinstance(obj, classes_tuple):\n-            return encoder(obj)\n+    for base in obj.__class__.__mro__[:-1]:\n+        if base in ENCODERS_BY_TYPE:\n+            return ENCODERS_BY_TYPE[base](obj)\n\n```\n\n```diff\n@@ -312,11 +298,9 @@ def jsonable_encoder(\n             )\n         return encoded_list\n \n-    if type(obj) in ENCODERS_BY_TYPE:\n-        return ENCODERS_BY_TYPE[type(obj)](obj)\n-    for encoder, classes_tuple in encoders_by_class_tuples.items():\n-        if isinstance(obj, classes_tuple):\n-            return encoder(obj)\n+    for base in obj.__class__.__mro__[:-1]:\n+        if base in ENCODERS_BY_TYPE:\n+            return ENCODERS_BY_TYPE[base](obj)\n\n```\n\n```diff\n@@ -312,11 +298,9 @@ def jsonable_encoder(\n             )\n         return encoded_list\n \n-    if type(obj) in ENCODERS_BY_TYPE:\n-        return ENCODERS_BY_TYPE[type(obj)](obj)\n-    for encoder, classes_tuple in encoders_by_class_tuples.items():\n-        if isinstance(obj, classes_tuple):\n-            return encoder(obj)\n+    for base in obj.__class__.__mro__[:-1]:\n+        if base in ENCODERS_BY_TYPE:\n+            return ENCODERS_BY_TYPE[base](obj)\n\n```", "output": "Code Review for: ‚ôªÔ∏è Refactor `jsonable_encoder` to optimize subclass encoder resolution using MRO\n\nüìù **fastapi/encoders.py**: Are you sure that `ENCODERS_BY_TYPE` always include the root class of the inheritance tree, and cannot include more nested classes?\n\nüìù **fastapi/encoders.py**: I'm not sure to understand, what problem do you have in mind? Can you give an example?\n\nüìù **fastapi/encoders.py**: Sorry, my bad, there is a `for` loop for all classes in inheritance tree, not just the root one\n\nüìù **fastapi/encoders.py**: No problem! Better safe than sorry. :)\n\n", "source": "pr", "type": "code_review", "pr_number": 218}
{"instruction": "Review this code change in `fastapi/encoders.py`", "input": "```diff\n@@ -312,11 +298,9 @@ def jsonable_encoder(\n             )\n         return encoded_list\n \n-    if type(obj) in ENCODERS_BY_TYPE:\n-        return ENCODERS_BY_TYPE[type(obj)](obj)\n-    for encoder, classes_tuple in encoders_by_class_tuples.items():\n-        if isinstance(obj, classes_tuple):\n-            return encoder(obj)\n+    for base in obj.__class__.__mro__[:-1]:\n+        if base in ENCODERS_BY_TYPE:\n+            return ENCODERS_BY_TYPE[base](obj)\n\n```", "output": "Are you sure that `ENCODERS_BY_TYPE` always include the root class of the inheritance tree, and cannot include more nested classes?", "source": "pr_review", "type": "inline_review", "pr_number": 218}
{"instruction": "Review the following code changes: ‚ú® Pass none instead of the default value for optional parameters when null is received", "input": "```diff\n@@ -23,6 +23,7 @@\n from .v2 import PydanticSchemaGenerationError as PydanticSchemaGenerationError\n from .v2 import RequiredParam as RequiredParam\n from .v2 import Undefined as Undefined\n+from .v2 import UndefinedType as UndefinedType\n from .v2 import Url as Url\n from .v2 import copy_field_info as copy_field_info\n from .v2 import create_body_model as create_body_model\n\n```\n\n```diff\n@@ -30,14 +30,15 @@\n from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n from pydantic_core import CoreSchema as CoreSchema\n-from pydantic_core import PydanticUndefined\n+from pydantic_core import PydanticUndefined, PydanticUndefinedType\n from pydantic_core import Url as Url\n from pydantic_core.core_schema import (\n     with_info_plain_validator_function as with_info_plain_validator_function,\n )\n \n RequiredParam = PydanticUndefined\n Undefined = PydanticUndefined\n+UndefinedType = PydanticUndefinedType\n evaluate_forwardref = eval_type_lenient\n \n # TODO: remove when dropping support for Pydantic < v2.12.3\n\n```\n\n```diff\n@@ -1,6 +1,7 @@\n import dataclasses\n import inspect\n import sys\n+import types\n from collections.abc import Callable, Mapping, Sequence\n from contextlib import AsyncExitStack, contextmanager\n from copy import copy, deepcopy\n@@ -21,6 +22,7 @@\n     ModelField,\n     RequiredParam,\n     Undefined,\n+    UndefinedType,\n     copy_field_info,\n     create_body_model,\n     evaluate_forwardref,\n@@ -566,7 +568,7 @@ async def solve_dependencies(\n     *,\n     request: Request | WebSocket,\n     dependant: Dependant,\n-    body: dict[str, Any] | FormData | None = None,\n+    body: dict[str, Any] | FormData | UndefinedType | None = None,\n     background_tasks: StarletteBackgroundTasks | None = None,\n     response: Response | None = None,\n     dependency_overrides_provider: Any | None = None,\n@@ -702,10 +704,32 @@ async def solve_dependencies(\n     )\n \n \n+if sys.hexversion >= 0x030A0000 and sys.hexversion < 0x030E0000:\n+\n+    def _allows_none(field: ModelField) -> bool:\n+        origin = get_origin(field.field_info.annotation)\n+        return (origin is Union or origin is types.UnionType) and type(\n+            None\n+        ) in get_args(field.field_info.annotation)\n+\n+else:\n+\n+    def _allows_none(field: ModelField) -> bool:\n+        origin = get_origin(field.field_info.annotation)\n+        return origin is Union and type(None) in get_args(field.field_info.annotation)\n+\n+\n def _validate_value_with_model_field(\n     *, field: ModelField, value: Any, values: dict[str, Any], loc: tuple[str, ...]\n ) -> tuple[Any, list[Any]]:\n+    if value is Undefined:\n+        if field.field_info.is_required():\n+            return None, [get_missing_field_error(loc=loc)]\n+        else:\n+            return deepcopy(field.default), []\n     if value is None:\n+        if _allows_none(field):\n+            return value, []\n         if field.field_info.is_required():\n             return None, [get_missing_field_error(loc=loc)]\n         else:\n@@ -721,16 +745,17 @@ def _get_multidict_value(\n     field: ModelField, values: Mapping[str, Any], alias: str | None = None\n ) -> Any:\n     alias = alias or get_validation_alias(field)\n+    value: Any\n     if (\n         (not _is_json_field(field))\n         and field_annotation_is_sequence(field.field_info.annotation)\n         and isinstance(values, (ImmutableMultiDict, Headers))\n     ):\n         value = values.getlist(alias)\n     else:\n-        value = values.get(alias, None)\n+        value = values.get(alias, Undefined)\n     if (\n-        value is None\n+        value is Undefined\n         or (\n             isinstance(field.field_info, params.Form)\n             and isinstance(value, str)  # For type checks\n@@ -742,7 +767,7 @@ def _get_multidict_value(\n         )\n     ):\n         if field.field_info.is_required():\n-            return\n+            return Undefined\n         else:\n             return deepcopy(field.default)\n     return value\n@@ -790,7 +815,7 @@ def request_params_to_args(\n                 if alias == field.name:\n                     alias = \n\n```\n\n```diff\n@@ -0,0 +1,100 @@\n+import sys\n+\n+import pytest\n+from dirty_equals import IsDict\n+from fastapi import Body, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+DEFAULT = 1234567890\n+\n+endpoints = []\n+\n+if sys.hexversion >= 0x30A0000:\n+    from typing import Annotated\n+\n+    @app.post(\"/api1\")\n+    def api1(\n+        integer_or_null: Annotated[int | None, Body(embed=True)] = DEFAULT,\n+    ) -> dict:\n+        return {\"received\": integer_or_null}\n+\n+    endpoints.append(\"/api1\")\n+\n+\n+if sys.hexversion >= 0x3090000:\n+    from typing import Annotated\n+\n+    @app.post(\"/api2\")\n+    def api2(\n+        integer_or_null: Annotated[int | None, Body(embed=True)] = DEFAULT,\n+    ) -> dict:\n+        return {\"received\": integer_or_null}\n+\n+    endpoints.append(\"/api2\")\n+\n+    @app.post(\"/api3\")\n+    def api3(\n+        integer_or_null: Annotated[int | None, Body(e", "output": "Changes look good. This PR implements: ‚ú® Pass none instead of the default value for optional parameters when null is received", "source": "pr", "type": "code_review", "pr_number": 217}
{"instruction": "Fix the following bug: üêõ Fix openapi for response model with nested computed field", "input": "When model with computed field is used for both, input and output validation, and this model is included as nested into response model, generated openapi schema is wrong (reference to `input` schema is used in response model schema).\r\n\r\nTo reason is that `_has_computed_fields` only checks the current model has computed fields, but we need to also check if any nested models has computed fields.\r\n\r\nSee: https://github.com/fastapi/fastapi/discussions/14489", "output": "```diff\n@@ -188,11 +188,17 @@ def __hash__(self) -> int:\n         return id(self)\n \n \n+def _model_has_computed_fields(model_or_enum: Any) -> bool:\n+    if lenient_issubclass(model_or_enum, BaseModel):\n+        model_schema = model_or_enum.__pydantic_core_schema__.get(\"schema\", {})\n+        computed_fields = model_schema.get(\"computed_fields\", [])\n+        return len(computed_fields) > 0\n+    return False  # pragma: no cover\n+\n+\n def _has_computed_fields(field: ModelField) -> bool:\n-    computed_fields = field._type_adapter.core_schema.get(\"schema\", {}).get(\n-        \"computed_fields\", []\n-    )\n-    return len(computed_fields) > 0\n+    models = get_flat_models_from_field(field, known_models=set())\n+    return any(_model_has_computed_fields(model) for model in models)\n \n \n def get_schema_from_model_field(\n@@ -204,17 +210,18 @@ def get_schema_from_model_field(\n     ],\n     separate_input_output_schemas: bool = True,\n ) -> dict[str, Any]:\n-    override_mode: Literal[\"validation\"] | None = (\n-        None\n-        if (separate_input_output_schemas or _has_computed_fields(field))\n-        else \"validation\"\n-    )\n+    override_mode: Literal[\"validation\"] | None = None\n+    if not separate_input_output_schemas:\n+        override_mode = (\n+            None\n+            if (separate_input_output_schemas or _has_computed_fields(field))\n+            else \"validation\"\n+        )\n     field_alias = (\n         (field.validation_alias or field.alias)\n         if field.mode == \"validation\"\n         else (field.serialization_alias or field.alias)\n     )\n-\n     # This expects that GenerateJsonSchema was already used to generate the definitions\n     json_schema = field_mapping[(field, override_mode or field.mode)]\n     if \"$ref\" not in json_schema:\n\n```\n\n```diff\n@@ -0,0 +1,234 @@\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+@pytest.fixture(name=\"client\", params=[True, False])\n+def get_client(request: pytest.FixtureRequest):\n+    from pydantic import computed_field\n+\n+    class MyModel(BaseModel):\n+        id: int\n+        name: str\n+        age: int\n+\n+        @computed_field\n+        @property\n+        def is_adult(self) -> bool:\n+            return self.age >= 18\n+\n+    app = FastAPI(separate_input_output_schemas=request.param)\n+\n+    @app.get(\"/list\")\n+    def get_items() -> list[MyModel]:\n+        return [MyModel(id=1, name=\"Alice\", age=30), MyModel(id=2, name=\"Bob\", age=17)]\n+\n+    @app.post(\"/item\")\n+    def create_item(item: MyModel) -> MyModel:\n+        return item\n+\n+    yield TestClient(app)\n+\n+\n+def test_create_item(client: TestClient):\n+    response = client.post(\n+        \"/item\",\n+        json={\"id\": 1, \"name\": \"Alice\", \"age\": 30},\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"id\": 1, \"name\": \"Alice\", \"age\": 30, \"is_adult\": True}\n+\n+\n+def test_get_items(client: TestClient):\n+    response = client.get(\"/list\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\n+        {\"id\": 1, \"name\": \"Alice\", \"age\": 30, \"is_adult\": True},\n+        {\"id\": 2, \"name\": \"Bob\", \"age\": 17, \"is_adult\": False},\n+    ]\n+\n+\n+def test_openapi(client: TestClient):\n+    response = client.get(\"/openapi.json\")\n+    openapi_schema = response.json()\n+    expected_schema = {\n+        \"info\": {\n+            \"title\": \"FastAPI\",\n+            \"version\": \"0.1.0\",\n+        },\n+        \"openapi\": \"3.1.0\",\n+        \"paths\": {\n+            \"/item\": {\n+                \"post\": {\n+                    \"operationId\": \"create_item_item_post\",\n+                    \"requestBody\": {\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/MyModel-Input\",\n+                                },\n+                            },\n+                        },\n+                        \"required\": True,\n+                    },\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"$ref\": \"#/components/schemas/MyModel-Output\",\n+                                    },\n+                                },\n+                            },\n+                            \"description\": \"Successful Response\",\n+                        },\n+                        \"422\": {\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"$ref\": \"#\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 216}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -188,11 +188,17 @@ def __hash__(self) -> int:\n         return id(self)\n \n \n+def _model_has_computed_fields(model_or_enum: Any) -> bool:\n+    if lenient_issubclass(model_or_enum, BaseModel):\n+        model_schema = model_or_enum.__pydantic_core_schema__.get(\"schema\", {})\n+        computed_fields = model_schema.get(\"computed_fields\", [])\n+        return len(computed_fields) > 0\n+    return False  # pragma: no cover\n+\n+\n def _has_computed_fields(field: ModelField) -> bool:\n-    computed_fields = field._type_adapter.core_schema.get(\"schema\", {}).get(\n-        \"computed_fields\", []\n-    )\n-    return len(computed_fields) > 0\n+    models = get_flat_models_from_field(field, known_models=set())\n+    return any(_model_has_computed_fields(model) for model in models)\n \n \n def get_schema_from_model_field(\n@@ -204,17 +210,18 @@ def get_schema_from_model_field(\n     ],\n     separate_input_output_schemas: bool = True,\n ) -> dict[str, Any]:\n-    override_mode: Literal[\"validation\"] | None = (\n-        None\n-        if (separate_input_output_schemas or _has_computed_fields(field))\n-        else \"validation\"\n-    )\n+    override_mode: Literal[\"validation\"] | None = None\n+    if not separate_input_output_schemas:\n+        override_mode = (\n+            None\n+            if (separate_input_output_schemas or _has_computed_fields(field))\n+            else \"validation\"\n+        )\n     field_alias = (\n         (field.validation_alias or field.alias)\n         if field.mode == \"validation\"\n         else (field.serialization_alias or field.alias)\n     )\n-\n     # This expects that GenerateJsonSchema was already used to generate the definitions\n     json_schema = field_mapping[(field, override_mode or field.mode)]\n     if \"$ref\" not in json_schema:\n\n```\n\n```diff\n@@ -0,0 +1,234 @@\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+@pytest.fixture(name=\"client\", params=[True, False])\n+def get_client(request: pytest.FixtureRequest):\n+    from pydantic import computed_field\n+\n+    class MyModel(BaseModel):\n+        id: int\n+        name: str\n+        age: int\n+\n+        @computed_field\n+        @property\n+        def is_adult(self) -> bool:\n+            return self.age >= 18\n+\n+    app = FastAPI(separate_input_output_schemas=request.param)\n+\n+    @app.get(\"/list\")\n+    def get_items() -> list[MyModel]:\n+        return [MyModel(id=1, name=\"Alice\", age=30), MyModel(id=2, name=\"Bob\", age=17)]\n+\n+    @app.post(\"/item\")\n+    def create_item(item: MyModel) -> MyModel:\n+        return item\n+\n+    yield TestClient(app)\n+\n+\n+def test_create_item(client: TestClient):\n+    response = client.post(\n+        \"/item\",\n+        json={\"id\": 1, \"name\": \"Alice\", \"age\": 30},\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"id\": 1, \"name\": \"Alice\", \"age\": 30, \"is_adult\": True}\n+\n+\n+def test_get_items(client: TestClient):\n+    response = client.get(\"/list\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\n+        {\"id\": 1, \"name\": \"Alice\", \"age\": 30, \"is_adult\": True},\n+        {\"id\": 2, \"name\": \"Bob\", \"age\": 17, \"is_adult\": False},\n+    ]\n+\n+\n+def test_openapi(client: TestClient):\n+    response = client.get(\"/openapi.json\")\n+    openapi_schema = response.json()\n+    expected_schema = {\n+        \"info\": {\n+            \"title\": \"FastAPI\",\n+            \"version\": \"0.1.0\",\n+        },\n+        \"openapi\": \"3.1.0\",\n+        \"paths\": {\n+            \"/item\": {\n+                \"post\": {\n+                    \"operationId\": \"create_item_item_post\",\n+                    \"requestBody\": {\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/MyModel-Input\",\n+                                },\n+                            },\n+                        },\n+                        \"requ", "output": "Bug: üêõ Fix openapi for response model with nested computed field\n\nWhen model with computed field is used for both, input and output validation, and this model is included as nested into response model, generated openapi schema is wrong (reference to `input` schema is used in response model schema).\r\n\r\nTo reason is that `_has_computed_fields` only checks the current model has computed fields, but we need to also check if any nested models has computed fields.\r\n\r\nSee: https://github.com/fastapi/fastapi/discussions/14489", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 216}
{"instruction": "Review the following code changes: üêõ Fix openapi for response model with nested computed field", "input": "```diff\n@@ -188,11 +188,17 @@ def __hash__(self) -> int:\n         return id(self)\n \n \n+def _model_has_computed_fields(model_or_enum: Any) -> bool:\n+    if lenient_issubclass(model_or_enum, BaseModel):\n+        model_schema = model_or_enum.__pydantic_core_schema__.get(\"schema\", {})\n+        computed_fields = model_schema.get(\"computed_fields\", [])\n+        return len(computed_fields) > 0\n+    return False  # pragma: no cover\n+\n+\n def _has_computed_fields(field: ModelField) -> bool:\n-    computed_fields = field._type_adapter.core_schema.get(\"schema\", {}).get(\n-        \"computed_fields\", []\n-    )\n-    return len(computed_fields) > 0\n+    models = get_flat_models_from_field(field, known_models=set())\n+    return any(_model_has_computed_fields(model) for model in models)\n \n \n def get_schema_from_model_field(\n@@ -204,17 +210,18 @@ def get_schema_from_model_field(\n     ],\n     separate_input_output_schemas: bool = True,\n ) -> dict[str, Any]:\n-    override_mode: Literal[\"validation\"] | None = (\n-        None\n-        if (separate_input_output_schemas or _has_computed_fields(field))\n-        else \"validation\"\n-    )\n+    override_mode: Literal[\"validation\"] | None = None\n+    if not separate_input_output_schemas:\n+        override_mode = (\n+            None\n+            if (separate_input_output_schemas or _has_computed_fields(field))\n+            else \"validation\"\n+        )\n     field_alias = (\n         (field.validation_alias or field.alias)\n         if field.mode == \"validation\"\n         else (field.serialization_alias or field.alias)\n     )\n-\n     # This expects that GenerateJsonSchema was already used to generate the definitions\n     json_schema = field_mapping[(field, override_mode or field.mode)]\n     if \"$ref\" not in json_schema:\n\n```\n\n```diff\n@@ -0,0 +1,234 @@\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+\n+@pytest.fixture(name=\"client\", params=[True, False])\n+def get_client(request: pytest.FixtureRequest):\n+    from pydantic import computed_field\n+\n+    class MyModel(BaseModel):\n+        id: int\n+        name: str\n+        age: int\n+\n+        @computed_field\n+        @property\n+        def is_adult(self) -> bool:\n+            return self.age >= 18\n+\n+    app = FastAPI(separate_input_output_schemas=request.param)\n+\n+    @app.get(\"/list\")\n+    def get_items() -> list[MyModel]:\n+        return [MyModel(id=1, name=\"Alice\", age=30), MyModel(id=2, name=\"Bob\", age=17)]\n+\n+    @app.post(\"/item\")\n+    def create_item(item: MyModel) -> MyModel:\n+        return item\n+\n+    yield TestClient(app)\n+\n+\n+def test_create_item(client: TestClient):\n+    response = client.post(\n+        \"/item\",\n+        json={\"id\": 1, \"name\": \"Alice\", \"age\": 30},\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"id\": 1, \"name\": \"Alice\", \"age\": 30, \"is_adult\": True}\n+\n+\n+def test_get_items(client: TestClient):\n+    response = client.get(\"/list\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == [\n+        {\"id\": 1, \"name\": \"Alice\", \"age\": 30, \"is_adult\": True},\n+        {\"id\": 2, \"name\": \"Bob\", \"age\": 17, \"is_adult\": False},\n+    ]\n+\n+\n+def test_openapi(client: TestClient):\n+    response = client.get(\"/openapi.json\")\n+    openapi_schema = response.json()\n+    expected_schema = {\n+        \"info\": {\n+            \"title\": \"FastAPI\",\n+            \"version\": \"0.1.0\",\n+        },\n+        \"openapi\": \"3.1.0\",\n+        \"paths\": {\n+            \"/item\": {\n+                \"post\": {\n+                    \"operationId\": \"create_item_item_post\",\n+                    \"requestBody\": {\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"$ref\": \"#/components/schemas/MyModel-Input\",\n+                                },\n+                            },\n+                        },\n+                        \"required\": True,\n+                    },\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"$ref\": \"#/components/schemas/MyModel-Output\",\n+                                    },\n+                                },\n+                            },\n+                            \"description\": \"Successful Response\",\n+                        },\n+                        \"422\": {\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"$ref\": \"#\n\n```", "output": "Changes look good. This PR implements: üêõ Fix openapi for response model with nested computed field", "source": "pr", "type": "code_review", "pr_number": 216}
{"instruction": "Review the following code changes: ‚ú® Add PropertyNames constraint support for JSON Schema propertyNames", "input": "```diff\n@@ -205,6 +205,23 @@ def get_schema_from_model_field(\n             json_schema[\"title\"] = (\n                 field.field_info.title or field.alias.title().replace(\"_\", \" \")\n             )\n+\n+        # Check for PropertyNames constraint in field metadata\n+        try:\n+            from fastapi.schema import (\n+                apply_property_names_to_schema,\n+                get_property_names_constraint,\n+            )\n+\n+            property_names_constraint = get_property_names_constraint(field.field_info)\n+            if property_names_constraint:\n+                json_schema = apply_property_names_to_schema(\n+                    json_schema, property_names_constraint\n+                )\n+        except ImportError:\n+            # Gracefully handle if schema module is not available\n+            pass\n+\n         return json_schema\n \n     def get_compat_model_name_map(fields: List[ModelField]) -> ModelNameMap:\n@@ -236,6 +253,12 @@ def get_definitions(\n             if \"description\" in item_def:\n                 item_description = cast(str, item_def[\"description\"]).split(\"\\f\")[0]\n                 item_def[\"description\"] = item_description\n+\n+        # Apply PropertyNames constraints to model definitions\n+        # Convert DefsRef keys to strings for compatibility\n+        string_definitions = {str(k): v for k, v in definitions.items()}\n+        _apply_property_names_to_definitions(string_definitions, fields)\n+\n         return field_mapping, definitions  # type: ignore[return-value]\n \n     def is_scalar_field(field: ModelField) -> bool:\n@@ -469,13 +492,34 @@ def get_schema_from_model_field(\n         separate_input_output_schemas: bool = True,\n     ) -> Dict[str, Any]:\n         # This expects that GenerateJsonSchema was already used to generate the definitions\n-        return field_schema(  # type: ignore[no-any-return]\n-            field, model_name_map=model_name_map, ref_prefix=REF_PREFIX\n-        )[0]\n+        json_schema = cast(\n+            Dict[str, Any],\n+            field_schema(field, model_name_map=model_name_map, ref_prefix=REF_PREFIX)[\n+                0\n+            ],\n+        )\n+\n+        # Check for PropertyNames constraint in field metadata\n+        try:\n+            from fastapi.schema import (\n+                apply_property_names_to_schema,\n+                get_property_names_constraint,\n+            )\n+\n+            property_names_constraint = get_property_names_constraint(field.field_info)\n+            if property_names_constraint:\n+                json_schema = apply_property_names_to_schema(\n+                    json_schema, property_names_constraint\n+                )\n+        except ImportError:\n+            # Gracefully handle if schema module is not available\n+            pass\n+\n+        return json_schema\n \n     def get_compat_model_name_map(fields: List[ModelField]) -> ModelNameMap:\n         models = get_flat_models_from_fields(fields, known_models=set())\n-        return get_model_name_map(models)  # type: ignore[no-any-r\n\n```\n\n```diff\n@@ -0,0 +1,113 @@\n+\"\"\"\n+FastAPI schema utilities including PropertyNames constraint support.\n+\"\"\"\n+\n+from typing import Any, Dict, Optional\n+\n+from pydantic.fields import FieldInfo\n+\n+\n+class PropertyNames:\n+    \"\"\"\n+    A constraint class for specifying propertyNames validation in JSON Schema.\n+\n+    This allows developers to specify patterns or schemas that all property names\n+    in a dictionary/object must match.\n+\n+    Examples:\n+        # Pattern-based constraint\n+        PropertyNames(pattern=\"^prefix_\")\n+\n+        # Schema-based constraint\n+        PropertyNames(min_length=3, max_length=50)\n+\n+        # Complex schema constraint\n+        PropertyNames(schema={\"type\": \"string\", \"enum\": [\"key1\", \"key2\", \"key3\"]})\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        pattern: Optional[str] = None,\n+        min_length: Optional[int] = None,\n+        max_length: Optional[int] = None,\n+        schema: Optional[Dict[str, Any]] = None,\n+        **kwargs: Any,\n+    ):\n+        \"\"\"\n+        Initialize PropertyNames constraint.\n+\n+        Args:\n+            pattern: Regular expression pattern that property names must match\n+            min_length: Minimum length for property names\n+            max_length: Maximum length for property names\n+            schema: Custom JSON schema for property names validation\n+            **kwargs: Additional JSON schema properties\n+        \"\"\"\n+        self.constraint_schema: Dict[str, Any] = {}\n+\n+        if pattern is not None:\n+            self.constraint_schema[\"pattern\"] = pattern\n+\n+        if min_length is not None:\n+            self.constraint_schema[\"minLength\"] = min_length\n+\n+        if max_length is not None:\n+            self.constraint_schema[\"maxLength\"] = max_length\n+\n+        if schema is not None:\n+            self.constraint_schema.update(schema)\n+\n+        # Add any additional properties\n+        for key, value in kwargs.items():\n+            if value is not None:\n+                self.constrai", "output": "Changes look good. This PR implements: ‚ú® Add PropertyNames constraint support for JSON Schema propertyNames", "source": "pr", "type": "code_review", "pr_number": 215}
{"instruction": "Fix the following bug: ‚ú® Raise error with clear error message when generator didn't yield anything", "input": "If an async generator dependency raises `RuntimeError: generator didn't yield`, make `solve_dependencies` catch and re-raise it, to more easily identify the dependency responsible for the error, and to provide more information on how to fix the dependency.", "output": "```diff\n@@ -45,7 +45,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -554,7 +554,23 @@ async def _solve_generator(\n         cm = asynccontextmanager(dependant.call)(**sub_values)\n     elif dependant.is_gen_callable:\n         cm = contextmanager_in_threadpool(contextmanager(dependant.call)(**sub_values))\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if str(ex) != \"generator didn't yield\":\n+            raise ex\n+\n+        dependency_name = getattr(dependant.call, \"__name__\", \"(unknown)\")\n+        raise FastAPIError(\n+            f\"Dependency {dependency_name} raised: {ex}. There's a high chance that \"\n+            \"this is a dependency with yield that catches an exception using except, \"\n+            \"but doesn't raise the exception again. Read more about it in the docs: \"\n+            \"https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield\"\n+            \"/#dependencies-with-yield-and-except\"\n+        ) from ex\n+\n+    return solved\n \n \n @dataclass\n\n```\n\n```diff\n@@ -0,0 +1,89 @@\n+import pytest\n+from anyio import open_file\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+def get_username_reraises():\n+    try:\n+        with open(\"/nonexistent/path.txt\") as f:\n+            yield f.read()  # pragma: no cover\n+    except OSError as ex:\n+        raise RuntimeError(\"File read error\") from ex\n+\n+\n+def get_username_doesnt_reraise():\n+    try:\n+        with open(\"/nonexistent/path.txt\") as f:\n+            yield f.read()  # pragma: no cover\n+    except OSError:\n+        print(\"Didn't re-raise\")\n+\n+\n+async def get_username_reraises_async():\n+    try:\n+        async with await open_file(\"/nonexistent/path.txt\", \"r\") as f:\n+            yield await f.read()  # pragma: no cover\n+    except OSError as ex:\n+        raise RuntimeError(\"File read error\") from ex\n+\n+\n+async def get_username_doesnt_reraise_async():\n+    try:\n+        async with await open_file(\"/nonexistent/path.txt\", \"r\") as f:\n+            yield await f.read()  # pragma: no cover\n+    except OSError:\n+        print(\"Didn't re-raise\")\n+\n+\n+@app.get(\"/reraises\")\n+def get_me_reraises(username: str = Depends(get_username_reraises)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/doesnt-reraise\")\n+def get_me_doesnt_reraise(username: str = Depends(get_username_doesnt_reraise)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/reraises-async\")\n+def get_me_reraises_async(username: str = Depends(get_username_reraises_async)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/doesnt-reraise-async\")\n+def get_me_doesnt_reraise_async(\n+    username: str = Depends(get_username_doesnt_reraise_async),\n+):\n+    return username  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+@pytest.mark.anyio\n+@pytest.mark.parametrize(\"path\", [\"/reraises\", \"/reraises-async\"])\n+def test_runtime_error_reraises(path: str):\n+    with pytest.raises(RuntimeError) as exc_info:\n+        client.get(path)\n+    assert str(exc_info.value) == \"File read error\"\n+\n+\n+@pytest.mark.anyio\n+@pytest.mark.parametrize(\n+    (\"path\", \"fn_name\"),\n+    [\n+        (\"/doesnt-reraise\", \"get_username_doesnt_reraise\"),\n+        (\"/doesnt-reraise-async\", \"get_username_doesnt_reraise_async\"),\n+    ],\n+)\n+def test_runtime_error_doesnt_reraise(path: str, fn_name: str):\n+    with pytest.raises(RuntimeError) as exc_info:\n+        client.get(path)\n+    assert str(exc_info.value).startswith(\n+        f\"Dependency {fn_name} raised: generator didn't yield. \"\n+        \"There's a high chance that this is a dependency with yield that catches an \"\n+        \"exception using except, but doesn't raise the exception again.\"\n+    )\n\n```\n\n```diff\n@@ -557,7 +558,24 @@ async def solve_generator(\n         cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))\n     elif is_async_gen_callable(call):\n         cm = asynccontextmanager(call)(**sub_values)\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if \"generator didn't yield\" not in f\"{ex}\":\n\n```\n\n```diff\n@@ -557,7 +558,24 @@ async def solve_generator(\n         cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))\n     elif is_async_gen_callable(call):\n         cm = asynccontextmanager(call)(**sub_values)\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if \"generator didn't yield\" not in f\"{ex}\":\n+            raise ex\n+\n+        dependency_name = getattr(call, \"__name__\", \"(unknown)\")\n+        raise FastAPIError(\n+            f\"Dependency {dependency_name} raised: {ex}. There's a high chance that \"\n+            \"this is a dependency with yield that has a block with a bare except, or a \"\n+            \"block with except Exception, and is not raising the exception again. Read \"\n+            \"more about it in the docs: \"\n\n```\n\n```diff\n@@ -557,7 +558,24 @@ async def solve_generator(\n         cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))\n     elif is_async_gen_callable(call):\n         cm = asynccontextmanager(call)(**sub_values)\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if \"generator didn't yield\" not in f\"{ex}\":\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 214}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -45,7 +45,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -554,7 +554,23 @@ async def _solve_generator(\n         cm = asynccontextmanager(dependant.call)(**sub_values)\n     elif dependant.is_gen_callable:\n         cm = contextmanager_in_threadpool(contextmanager(dependant.call)(**sub_values))\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if str(ex) != \"generator didn't yield\":\n+            raise ex\n+\n+        dependency_name = getattr(dependant.call, \"__name__\", \"(unknown)\")\n+        raise FastAPIError(\n+            f\"Dependency {dependency_name} raised: {ex}. There's a high chance that \"\n+            \"this is a dependency with yield that catches an exception using except, \"\n+            \"but doesn't raise the exception again. Read more about it in the docs: \"\n+            \"https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield\"\n+            \"/#dependencies-with-yield-and-except\"\n+        ) from ex\n+\n+    return solved\n \n \n @dataclass\n\n```\n\n```diff\n@@ -0,0 +1,89 @@\n+import pytest\n+from anyio import open_file\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+def get_username_reraises():\n+    try:\n+        with open(\"/nonexistent/path.txt\") as f:\n+            yield f.read()  # pragma: no cover\n+    except OSError as ex:\n+        raise RuntimeError(\"File read error\") from ex\n+\n+\n+def get_username_doesnt_reraise():\n+    try:\n+        with open(\"/nonexistent/path.txt\") as f:\n+            yield f.read()  # pragma: no cover\n+    except OSError:\n+        print(\"Didn't re-raise\")\n+\n+\n+async def get_username_reraises_async():\n+    try:\n+        async with await open_file(\"/nonexistent/path.txt\", \"r\") as f:\n+            yield await f.read()  # pragma: no cover\n+    except OSError as ex:\n+        raise RuntimeError(\"File read error\") from ex\n+\n+\n+async def get_username_doesnt_reraise_async():\n+    try:\n+        async with await open_file(\"/nonexistent/path.txt\", \"r\") as f:\n+            yield await f.read()  # pragma: no cover\n+    except OSError:\n+        print(\"Didn't re-raise\")\n+\n+\n+@app.get(\"/reraises\")\n+def get_me_reraises(username: str = Depends(get_username_reraises)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/doesnt-reraise\")\n+def get_me_doesnt_reraise(username: str = Depends(get_username_doesnt_reraise)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/reraises-async\")\n+def get_me_reraises_async(username: str = Depends(get_username_reraises_async)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/doesnt-reraise-async\")\n+def get_me_doesnt_reraise_async(\n+    username: str = Depends(get_username_doesnt_reraise_async),\n+):\n+    return username  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+@pytest.mark.anyio\n+@pytest.mark.parametrize(\"path\", [\"/reraises\", \"/reraises-async\"])\n+def test_runtime_error_reraises(path: str):\n+    with pytest.raises(RuntimeError) as exc_info:\n+        client.get(path)\n+    assert str(exc_info.value) == \"File read error\"\n+\n+\n+@pytest.mark.anyio\n+@pytest.mark.parametrize(\n+    (\"path\", \"fn_name\"),\n+    [\n+        (\"/doesnt-reraise\", \"get_username_doesnt_reraise\"),\n+        (\"/doesnt-reraise-async\", \"get_username_doesnt_reraise_async\"),\n+    ],\n+)\n+def test_runtime_error_doesnt_reraise(path: str, fn_name: str):\n+    with pytest.raises(RuntimeError) as exc_info:\n+        client.get(path)\n+    assert str(exc_info.value).startswith(\n+        f\"Dependency {fn_name} raised: generator didn't yield. \"\n+        \"There's a high chance that this is a dependency with yield that catches an \"\n+ ", "output": "Bug: ‚ú® Raise error with clear error message when generator didn't yield anything\n\nIf an async generator dependency raises `RuntimeError: generator didn't yield`, make `solve_dependencies` catch and re-raise it, to more easily identify the dependency responsible for the error, and to provide more information on how to fix the dependency.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 214}
{"instruction": "Review the following code changes: ‚ú® Raise error with clear error message when generator didn't yield anything", "input": "```diff\n@@ -45,7 +45,7 @@\n     contextmanager_in_threadpool,\n )\n from fastapi.dependencies.models import Dependant\n-from fastapi.exceptions import DependencyScopeError\n+from fastapi.exceptions import DependencyScopeError, FastAPIError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n from fastapi.types import DependencyCacheKey\n@@ -554,7 +554,23 @@ async def _solve_generator(\n         cm = asynccontextmanager(dependant.call)(**sub_values)\n     elif dependant.is_gen_callable:\n         cm = contextmanager_in_threadpool(contextmanager(dependant.call)(**sub_values))\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if str(ex) != \"generator didn't yield\":\n+            raise ex\n+\n+        dependency_name = getattr(dependant.call, \"__name__\", \"(unknown)\")\n+        raise FastAPIError(\n+            f\"Dependency {dependency_name} raised: {ex}. There's a high chance that \"\n+            \"this is a dependency with yield that catches an exception using except, \"\n+            \"but doesn't raise the exception again. Read more about it in the docs: \"\n+            \"https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield\"\n+            \"/#dependencies-with-yield-and-except\"\n+        ) from ex\n+\n+    return solved\n \n \n @dataclass\n\n```\n\n```diff\n@@ -0,0 +1,89 @@\n+import pytest\n+from anyio import open_file\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+def get_username_reraises():\n+    try:\n+        with open(\"/nonexistent/path.txt\") as f:\n+            yield f.read()  # pragma: no cover\n+    except OSError as ex:\n+        raise RuntimeError(\"File read error\") from ex\n+\n+\n+def get_username_doesnt_reraise():\n+    try:\n+        with open(\"/nonexistent/path.txt\") as f:\n+            yield f.read()  # pragma: no cover\n+    except OSError:\n+        print(\"Didn't re-raise\")\n+\n+\n+async def get_username_reraises_async():\n+    try:\n+        async with await open_file(\"/nonexistent/path.txt\", \"r\") as f:\n+            yield await f.read()  # pragma: no cover\n+    except OSError as ex:\n+        raise RuntimeError(\"File read error\") from ex\n+\n+\n+async def get_username_doesnt_reraise_async():\n+    try:\n+        async with await open_file(\"/nonexistent/path.txt\", \"r\") as f:\n+            yield await f.read()  # pragma: no cover\n+    except OSError:\n+        print(\"Didn't re-raise\")\n+\n+\n+@app.get(\"/reraises\")\n+def get_me_reraises(username: str = Depends(get_username_reraises)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/doesnt-reraise\")\n+def get_me_doesnt_reraise(username: str = Depends(get_username_doesnt_reraise)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/reraises-async\")\n+def get_me_reraises_async(username: str = Depends(get_username_reraises_async)):\n+    return username  # pragma: no cover\n+\n+\n+@app.get(\"/doesnt-reraise-async\")\n+def get_me_doesnt_reraise_async(\n+    username: str = Depends(get_username_doesnt_reraise_async),\n+):\n+    return username  # pragma: no cover\n+\n+\n+client = TestClient(app)\n+\n+\n+@pytest.mark.anyio\n+@pytest.mark.parametrize(\"path\", [\"/reraises\", \"/reraises-async\"])\n+def test_runtime_error_reraises(path: str):\n+    with pytest.raises(RuntimeError) as exc_info:\n+        client.get(path)\n+    assert str(exc_info.value) == \"File read error\"\n+\n+\n+@pytest.mark.anyio\n+@pytest.mark.parametrize(\n+    (\"path\", \"fn_name\"),\n+    [\n+        (\"/doesnt-reraise\", \"get_username_doesnt_reraise\"),\n+        (\"/doesnt-reraise-async\", \"get_username_doesnt_reraise_async\"),\n+    ],\n+)\n+def test_runtime_error_doesnt_reraise(path: str, fn_name: str):\n+    with pytest.raises(RuntimeError) as exc_info:\n+        client.get(path)\n+    assert str(exc_info.value).startswith(\n+        f\"Dependency {fn_name} raised: generator didn't yield. \"\n+        \"There's a high chance that this is a dependency with yield that catches an \"\n+        \"exception using except, but doesn't raise the exception again.\"\n+    )\n\n```\n\n```diff\n@@ -557,7 +558,24 @@ async def solve_generator(\n         cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))\n     elif is_async_gen_callable(call):\n         cm = asynccontextmanager(call)(**sub_values)\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if \"generator didn't yield\" not in f\"{ex}\":\n\n```\n\n```diff\n@@ -557,7 +558,24 @@ async def solve_generator(\n         cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))\n     elif is_async_gen_callable(call):\n         cm = asynccontextmanager(call)(**sub_values)\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if \"generator didn't yield\" not in f\"{ex}\":\n+            raise ex\n+\n+        dependency_name = geta", "output": "Code Review for: ‚ú® Raise error with clear error message when generator didn't yield anything\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n        if str(ex) == \"generator didn't yield\":\r\n```\r\nThis should be faster\n\nüìù **fastapi/dependencies/utils.py**: ```suggestion\r\n            \"this is a dependency with yield that catches an exception using except, \"\r\n            \"but doesn't raise the exception again. Read more about it in the docs: \"\r\n```\n\nüìù **fastapi/dependencies/utils.py**: I guess you meant `if str(ex) != \"generator didn't yield\":` . I've updated it to that.\n\nüìù **tests/test_dependency_runtime_errors.py**: ```suggestion\r\n        async with await open_file(\"/non_existing/path.txt\", \"r\") as f:\r\n```\r\nMaybe better use self-descriptive path?\n\nüìù **tests/test_dependency_runtime_errors.py**: ```suggestion\r\n        raise RuntimeError(\"File read error\") from ex\r\n```\r\nI think more neutral text would be better\n\n", "source": "pr", "type": "code_review", "pr_number": 214}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -557,7 +558,24 @@ async def solve_generator(\n         cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))\n     elif is_async_gen_callable(call):\n         cm = asynccontextmanager(call)(**sub_values)\n-    return await stack.enter_async_context(cm)\n+\n+    try:\n+        solved = await stack.enter_async_context(cm)\n+    except RuntimeError as ex:\n+        if \"generator didn't yield\" not in f\"{ex}\":\n\n```", "output": "```suggestion\r\n        if str(ex) == \"generator didn't yield\":\r\n```\r\nThis should be faster", "source": "pr_review", "type": "inline_review", "pr_number": 214}
{"instruction": "Review this code change in `tests/test_dependency_runtime_errors.py`", "input": "```diff\n@@ -0,0 +1,55 @@\n+import pytest\n+from anyio import open_file\n+from fastapi import Depends, FastAPI\n+from fastapi.testclient import TestClient\n+\n+app_reraises = FastAPI()\n+app_doesnt_reraise = FastAPI()\n+\n+\n+async def get_username_reraises():\n+    try:\n+        async with await open_file(\"/path/to/sanchez.txt\", \"r\") as f:\n\n```", "output": "```suggestion\r\n        async with await open_file(\"/non_existing/path.txt\", \"r\") as f:\r\n```\r\nMaybe better use self-descriptive path?", "source": "pr_review", "type": "inline_review", "pr_number": 214}
{"instruction": "Review the following code changes: üî• Remove unnecessary `is_async_callable` check in `request_response`", "input": "```diff\n@@ -79,18 +79,15 @@\n from typing_extensions import deprecated\n \n \n-# Copy of starlette.routing.request_response modified to include the\n-# dependencies' AsyncExitStack\n+# Copy of starlette.routing.request_response, modified to include the\n+# dependencies' AsyncExitStack and to remove support for non-awaitable\n+# functions.\n def request_response(\n-    func: Callable[[Request], Awaitable[Response] | Response],\n+    func: Callable[[Request], Awaitable[Response]],\n ) -> ASGIApp:\n     \"\"\"\n-    Takes a function or coroutine `func(request) -> response`,\n-    and returns an ASGI application.\n+    Takes a coroutine `func(request) -> response` and returns an ASGI application.\n     \"\"\"\n-    f: Callable[[Request], Awaitable[Response]] = (\n-        func if is_async_callable(func) else functools.partial(run_in_threadpool, func)  # type:ignore\n-    )\n \n     async def app(scope: Scope, receive: Receive, send: Send) -> None:\n         request = Request(scope, receive, send)\n@@ -102,7 +99,7 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n                 scope[\"fastapi_inner_astack\"] = request_stack\n                 async with AsyncExitStack() as function_stack:\n                     scope[\"fastapi_function_astack\"] = function_stack\n-                    response = await f(request)\n+                    response = await func(request)\n                 await response(scope, receive, send)\n                 # Continues customization\n                 response_awaited = True\n\n```", "output": "Changes look good. This PR implements: üî• Remove unnecessary `is_async_callable` check in `request_response`", "source": "pr", "type": "code_review", "pr_number": 213}
{"instruction": "Fix the following bug: üêõ Ensure that ASGIApp is mounted correctly to the sub-routes", "input": "During the use of FastAPI, I noticed a problem with sub-routes, My project structure is as follows:\r\n```\r\n‚îå‚îÄexample\r\n‚îÇ ‚îú‚îÄmain.py\r\n‚îÇ ‚îî‚îÄsub_dir\r\n‚îÇ   ‚îú‚îÄ__init__.py\r\n‚îÇ   ‚îî‚îÄstatic\r\n‚îÇ     ‚îî‚îÄindex.html\r\n```\r\nThe code is as follows:\r\n\r\n```python\r\n# example/main.py\r\nfrom fastapi import FastAPI\r\n\r\nfrom sub_dir import sub_dir\r\n\r\napp = FastAPI()\r\napp.include_router(sub_dir, prefix=\"/app\")\r\n\r\nif __name__ == \"__main__\":\r\n    import uvicorn\r\n\r\n    uvicorn.run(app, host=\"127.0.0.1\", port=8000)\r\n\r\n```\r\n\r\n```python\r\n# example/sub_dir/__init__.py\r\nfrom pathlib import Path as libPath\r\n\r\nfrom fastapi import APIRouter\r\nfrom fastapi.staticfiles import StaticFiles\r\n\r\nskip = APIRouter()\r\nskip.mount(\"/static\", StaticFiles(directory=libPath(__file__).resolve().parent / \"static\"), name=\"skip\")\r\n\r\n__all__ = [\"skip\"]\r\n```\r\n\r\nAfter running `main.py` and accessing `http://127.0.0.1:8000/app/sub_dir/index.html`, one should have seen the content of `example/sub_dir/static/index.html`. However, it did not display as expected, Log entry as follows:\r\n```\r\nINFO:     Started server process [60576]\r\nINFO:     Waiting for application startup.\r\nINFO:     Application startup complete.\r\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\r\nINFO:     127.0.0.1:59030 - \"GET /app/sub_dir/index.html HTTP/1.1\" 404 Not Found\r\n```\r\n\r\nBy examining the source code, it was discovered that `APIRouter.include_router` failed to properly handle `routing.Mount`.\r\n\r\nAfter the repair, we ran `main.py`, and we could see that the content in `example/sub_dir/static/index.html` could be displayed normally. The log is as follows:\r\n```\r\nINFO:     Started server process [78196]\r\nINFO:     Waiting for application startup.\r\nINFO:     Application startup complete.\r\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\r\nINFO:     127.0.0.1:58825 - \"GET /app/sub_dir/index.html HTTP/1.1\" 200 OK\r\n```\r\n\r\nThis will be extremely useful in complex routing scenarios!!!", "output": "```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                self.mount(prefix + route.path, route.app, name=route.name)\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -1,4 +1,7 @@\n+from pathlib import Path as libPath\n+\n from fastapi import APIRouter, FastAPI\n+from fastapi.staticfiles import StaticFiles\n from fastapi.testclient import TestClient\n \n router = APIRouter()\n@@ -8,6 +11,11 @@\n app = FastAPI()\n \n \n+sub_router.mount(\n+    \"/static\", StaticFiles(directory=libPath(__file__).resolve().parent), name=\"static\"\n+)\n+\n+\n @sub_router.get(\"/\")\n def read_item():\n     return {\"id\": \"foo\"}\n@@ -20,6 +28,14 @@ def read_item():\n client = TestClient(app)\n \n \n+def test_sub_router_mount():\n+    response = client.get(f\"/items/static/{libPath(__file__).resolve().stem}.py\")\n+    assert response.status_code == 200, response.text\n+\n+\n+test_sub_router_mount()\n+\n+\n def test_path_operation():\n     response = client.get(\"/items/\")\n     assert response.status_code == 200, response.text\n\n```\n\n```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 212}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                self.mount(prefix + route.path, route.app, name=route.name)\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -1,4 +1,7 @@\n+from pathlib import Path as libPath\n+\n from fastapi import APIRouter, FastAPI\n+from fastapi.staticfiles import StaticFiles\n from fastapi.testclient import TestClient\n \n router = APIRouter()\n@@ -8,6 +11,11 @@\n app = FastAPI()\n \n \n+sub_router.mount(\n+    \"/static\", StaticFiles(directory=libPath(__file__).resolve().parent), name=\"static\"\n+)\n+\n+\n @sub_router.get(\"/\")\n def read_item():\n     return {\"id\": \"foo\"}\n@@ -20,6 +28,14 @@ def read_item():\n client = TestClient(app)\n \n \n+def test_sub_router_mount():\n+    response = client.get(f\"/items/static/{libPath(__file__).resolve().stem}.py\")\n+    assert response.status_code == 200, response.text\n+\n+\n+test_sub_router_mount()\n+\n+\n def test_path_operation():\n     response = client.get(\"/items/\")\n     assert response.status_code == 200, response.text\n\n```\n\n```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n\n```", "output": "Bug: üêõ Ensure that ASGIApp is mounted correctly to the sub-routes\n\nDuring the use of FastAPI, I noticed a problem with sub-routes, My project structure is as follows:\r\n```\r\n‚îå‚îÄexample\r\n‚îÇ ‚îú‚îÄmain.py\r\n‚îÇ ‚îî‚îÄsub_dir\r\n‚îÇ   ‚îú‚îÄ__init__.py\r\n‚îÇ   ‚îî‚îÄstatic\r\n‚îÇ     ‚îî‚îÄindex.html\r\n```\r\nThe code is as follows:\r\n\r\n```python\r\n# example/main.py\r\nfrom fastapi import FastAPI\r\n\r\nfrom sub_dir import sub_dir\r\n\r\napp = FastAPI()\r\napp.include_router(sub_dir, prefix=\"/app\")\r\n\r\nif __name__ == \"__main__\":\r\n    import uvicorn\r\n\r\n    uvicorn.run(app, host=\"127.0.0.1\", port=8000)\r\n\r\n```\r\n\r\n```python\r\n# example/sub_dir/__init__.py\r\nfrom pathlib import Path as libPath\r\n\r\nfrom fastapi import APIRouter\r\nfrom fastapi.staticfiles import StaticFiles\r\n\r\nskip = APIRouter()\r\nskip.mount(\"/static\", StaticFiles(directory=libPath(__file__).resolve().parent / \"static\"), name=\"skip\")\r\n\r\n__all__ = [\"skip\"]\r\n```\r\n\r\nAfter running `main.py` and accessing `http://127.0.0.1:8000/app/sub_dir/index.html`, one should have seen the content of `example/sub_dir/static/index.html`. However, it did not display as expected, Log entry as follows:\r\n```\r\nINFO:     Started server process [60576]\r\nINFO:     Waiting for application startup.\r\nINFO:     Application startup complete.\r\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\r\nINFO:     127.0.0.1:59030 - \"GET /app/sub_dir/index.html HTTP/1.1\" 404 Not Found\r\n```\r\n\r\nBy examining the source code, it was discovered that `APIRouter.include_router` failed to properly handle `routing.Mount`.\r\n\r\nAfter the repair, we ran `main.py`, and we could see that the content in `example/sub_dir/static/index.html` could be displayed normally. The log is as follows:\r\n```\r\nINFO:     Started server process [78196]\r\nINFO:     Waiting for application startup.\r\nINFO:     Application startup complete.\r\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\r\nINFO:     127.0.0.1:58825 - \"GET /app/sub_dir/index.html HTTP/1.1\" 200 OK\r\n```\r\n\r\nThis will be extremely useful in complex routing scenarios!!!", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 212}
{"instruction": "Review the following code changes: üêõ Ensure that ASGIApp is mounted correctly to the sub-routes", "input": "```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                self.mount(prefix + route.path, route.app, name=route.name)\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -1,4 +1,7 @@\n+from pathlib import Path as libPath\n+\n from fastapi import APIRouter, FastAPI\n+from fastapi.staticfiles import StaticFiles\n from fastapi.testclient import TestClient\n \n router = APIRouter()\n@@ -8,6 +11,11 @@\n app = FastAPI()\n \n \n+sub_router.mount(\n+    \"/static\", StaticFiles(directory=libPath(__file__).resolve().parent), name=\"static\"\n+)\n+\n+\n @sub_router.get(\"/\")\n def read_item():\n     return {\"id\": \"foo\"}\n@@ -20,6 +28,14 @@ def read_item():\n client = TestClient(app)\n \n \n+def test_sub_router_mount():\n+    response = client.get(f\"/items/static/{libPath(__file__).resolve().stem}.py\")\n+    assert response.status_code == 200, response.text\n+\n+\n+test_sub_router_mount()\n+\n+\n def test_path_operation():\n     response = client.get(\"/items/\")\n     assert response.status_code == 200, response.text\n\n```\n\n```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n\n```", "output": "Code Review for: üêõ Ensure that ASGIApp is mounted correctly to the sub-routes\n\nüìù **fastapi/routing.py**: ```suggestion\r\n            elif isinstance(route, routing.Mount) and isinstance(\r\n                route.app, StaticFiles\r\n            ):\r\n```\r\nI'm not sure we should add this for any `mount`. Mounted apps can also have sub-apps. If we want to support this I think we should add much more tests.\r\nI suggest we only support this for `StaticFiles` for now\r\n\n", "source": "pr", "type": "code_review", "pr_number": 212}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -1355,6 +1355,8 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n\n```", "output": "```suggestion\r\n            elif isinstance(route, routing.Mount) and isinstance(\r\n                route.app, StaticFiles\r\n            ):\r\n```\r\nI'm not sure we should add this for any `mount`. Mounted apps can also have sub-apps. If we want to support this I think we should add much more tests.\r\nI suggest we only support this for `StaticFiles` for now\r", "source": "pr_review", "type": "inline_review", "pr_number": 212}
{"instruction": "Fix the following bug: üêõ Fix duplicate special dependency handling", "input": "See the bug description [here](https://github.com/fastapi/fastapi/discussions/12403)", "output": "```diff\n@@ -38,12 +38,12 @@ class Dependant:\n     dependencies: list[\"Dependant\"] = field(default_factory=list)\n     name: str | None = None\n     call: Callable[..., Any] | None = None\n-    request_param_name: str | None = None\n-    websocket_param_name: str | None = None\n-    http_connection_param_name: str | None = None\n-    response_param_name: str | None = None\n-    background_tasks_param_name: str | None = None\n-    security_scopes_param_name: str | None = None\n+    request_param_names: set[str] = field(default_factory=set)\n+    websocket_param_names: set[str] = field(default_factory=set)\n+    http_connection_param_names: set[str] = field(default_factory=set)\n+    response_param_names: set[str] = field(default_factory=set)\n+    background_tasks_param_names: set[str] = field(default_factory=set)\n+    security_scopes_param_names: set[str] = field(default_factory=set)\n     own_oauth_scopes: list[str] | None = None\n     parent_oauth_scopes: list[str] | None = None\n     use_cache: bool = True\n@@ -74,7 +74,7 @@ def cache_key(self) -> DependencyCacheKey:\n     def _uses_scopes(self) -> bool:\n         if self.own_oauth_scopes:\n             return True\n-        if self.security_scopes_param_name is not None:\n+        if self.security_scopes_param_names:\n             return True\n         if self._is_security_scheme:\n             return True\n\n```\n\n```diff\n@@ -145,12 +145,12 @@ def get_flat_dependant(\n         body_params=dependant.body_params.copy(),\n         name=dependant.name,\n         call=dependant.call,\n-        request_param_name=dependant.request_param_name,\n-        websocket_param_name=dependant.websocket_param_name,\n-        http_connection_param_name=dependant.http_connection_param_name,\n-        response_param_name=dependant.response_param_name,\n-        background_tasks_param_name=dependant.background_tasks_param_name,\n-        security_scopes_param_name=dependant.security_scopes_param_name,\n+        request_param_names=dependant.request_param_names.copy(),\n+        websocket_param_names=dependant.websocket_param_names.copy(),\n+        http_connection_param_names=dependant.http_connection_param_names.copy(),\n+        response_param_names=dependant.response_param_names.copy(),\n+        background_tasks_param_names=dependant.background_tasks_param_names.copy(),\n+        security_scopes_param_names=dependant.security_scopes_param_names.copy(),\n         own_oauth_scopes=dependant.own_oauth_scopes,\n         parent_oauth_scopes=use_parent_oauth_scopes,\n         use_cache=dependant.use_cache,\n@@ -330,22 +330,22 @@ def add_non_field_param_to_dependency(\n     *, param_name: str, type_annotation: Any, dependant: Dependant\n ) -> bool | None:\n     if lenient_issubclass(type_annotation, Request):\n-        dependant.request_param_name = param_name\n+        dependant.request_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, WebSocket):\n-        dependant.websocket_param_name = param_name\n+        dependant.websocket_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, HTTPConnection):\n-        dependant.http_connection_param_name = param_name\n+        dependant.http_connection_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, Response):\n-        dependant.response_param_name = param_name\n+        dependant.response_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, StarletteBackgroundTasks):\n-        dependant.background_tasks_param_name = param_name\n+        dependant.background_tasks_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, SecurityScopes):\n-        dependant.security_scopes_param_name = param_name\n+        dependant.security_scopes_param_names.add(param_name)\n         return True\n     return None\n \n@@ -677,22 +677,25 @@ async def solve_dependencies(\n         )\n         values.update(body_values)\n         errors.extend(body_errors)\n-    if dependant.http_connection_param_name:\n-        values[dependant.http_connection_param_name] = request\n-    if dependant.request_param_name and isinstance(request, Request):\n-        values[dependant.request_param_name] = request\n-    elif dependant.websocket_param_name and isinstance(request, WebSocket):\n-        values[dependant.webso\n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+import pytest\n+from fastapi import BackgroundTasks, FastAPI, Request, Response, WebSocket\n+from fastapi.security import SecurityScopes\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/request\")\n+def request(r1: Request, r2: Request) -> str:\n+    assert r1 is not None\n+    assert r1 is r2\n+    return \"success\"\n+\n+\n+@app.get(\"/response\")\n+def response(r1: Response, r2: Response) -> str:\n+    assert r1 is not None\n+    assert r1 is r2\n+    return \"success\"\n+\n+\n+@app.get(\"/background-tasks\")\n+def background_tasks(t1: BackgroundTasks, t2: BackgroundTasks) -> str:\n+    assert t1 is not None\n+    assert t1 is t2\n+    return \"success\"\n+\n+\n+@app.get(\"/security-scopes\")\n+def security_scopes(sc1: SecurityScopes, sc2: SecurityScopes) -> str:\n+    assert sc1 is not None\n+    assert sc1 is sc2\n+    return \"success\"\n+\n+\n+@app.websocket(\"/websocket\")\n+async def websocket(ws1: WebSocket, ws2: WebSocket) -> str:\n+    assert ws1 is ws2\n+    await ws1.accept()\n+    await ws1.send_text(\"success\")\n+    await ws1.close()\n+\n+\n+@pytest.mark.parametrize(\n+    \"url\",\n+    (\n+        \"/request\",\n+        \"/response\",\n+        \"/background-tasks\",\n+        \"/security-scopes\",\n+    ),\n+)\n+def test_duplicate_special_dependency(url: str) -> None:\n+    assert TestClient(app).get(url).text == '\"success\"'\n+\n+\n+def test_duplicate_websocket_dependency() -> None:\n+    with TestClient(app).websocket_connect(\"/websocket\") as ws:\n+        text = ws.receive_text()\n+        assert text == \"success\"\n\n```\n\n```diff\n@@ -22,12 +22,12 @@ class Dependant:\n     security_requirements: List[SecurityRequirement] = field(default_factory=list)\n     name: Optional[str] = None\n     call: Optional[Callable[..., Any]] = None\n-    request_param_name: Optional[str] = None\n-    websocket_param_name: Optional[str] = None\n-    http_connection_param_name: Optional[str] = None\n-    response_param_name: Optional[str] = None\n-    background_tasks_param_name: Optional[str] = None\n-    security_scopes_param_name: Optional[str] = None\n+    request_param_names: List[str] = field(default_factory=list)\n\n```\n\n```diff\n@@ -22,12 +22,12 @@ class Dependant:\n     security_requirements: List[SecurityRequirement] = field(default_factory=list)\n     name: Optional[str] = None\n     call: Optional[Callable[..., Any]] = None\n-    request_param_name: Optional[str] = None\n-    websocket_param_name: Optional[str] = None\n-    http_connection_param_name: Optional[str] = None\n-    response_param_name: Optional[str] = None\n-    background_tasks_param_name: Optional[str] = None\n-    security_scopes_param_name: Optional[str] = None\n+    request_param_names: List[str] = field(default_factory=list)\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 211}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -38,12 +38,12 @@ class Dependant:\n     dependencies: list[\"Dependant\"] = field(default_factory=list)\n     name: str | None = None\n     call: Callable[..., Any] | None = None\n-    request_param_name: str | None = None\n-    websocket_param_name: str | None = None\n-    http_connection_param_name: str | None = None\n-    response_param_name: str | None = None\n-    background_tasks_param_name: str | None = None\n-    security_scopes_param_name: str | None = None\n+    request_param_names: set[str] = field(default_factory=set)\n+    websocket_param_names: set[str] = field(default_factory=set)\n+    http_connection_param_names: set[str] = field(default_factory=set)\n+    response_param_names: set[str] = field(default_factory=set)\n+    background_tasks_param_names: set[str] = field(default_factory=set)\n+    security_scopes_param_names: set[str] = field(default_factory=set)\n     own_oauth_scopes: list[str] | None = None\n     parent_oauth_scopes: list[str] | None = None\n     use_cache: bool = True\n@@ -74,7 +74,7 @@ def cache_key(self) -> DependencyCacheKey:\n     def _uses_scopes(self) -> bool:\n         if self.own_oauth_scopes:\n             return True\n-        if self.security_scopes_param_name is not None:\n+        if self.security_scopes_param_names:\n             return True\n         if self._is_security_scheme:\n             return True\n\n```\n\n```diff\n@@ -145,12 +145,12 @@ def get_flat_dependant(\n         body_params=dependant.body_params.copy(),\n         name=dependant.name,\n         call=dependant.call,\n-        request_param_name=dependant.request_param_name,\n-        websocket_param_name=dependant.websocket_param_name,\n-        http_connection_param_name=dependant.http_connection_param_name,\n-        response_param_name=dependant.response_param_name,\n-        background_tasks_param_name=dependant.background_tasks_param_name,\n-        security_scopes_param_name=dependant.security_scopes_param_name,\n+        request_param_names=dependant.request_param_names.copy(),\n+        websocket_param_names=dependant.websocket_param_names.copy(),\n+        http_connection_param_names=dependant.http_connection_param_names.copy(),\n+        response_param_names=dependant.response_param_names.copy(),\n+        background_tasks_param_names=dependant.background_tasks_param_names.copy(),\n+        security_scopes_param_names=dependant.security_scopes_param_names.copy(),\n         own_oauth_scopes=dependant.own_oauth_scopes,\n         parent_oauth_scopes=use_parent_oauth_scopes,\n         use_cache=dependant.use_cache,\n@@ -330,22 +330,22 @@ def add_non_field_param_to_dependency(\n     *, param_name: str, type_annotation: Any, dependant: Dependant\n ) -> bool | None:\n     if lenient_issubclass(type_annotation, Request):\n-        dependant.request_param_name = param_name\n+        dependant.request_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, WebSocket):\n-        dependant.websocket_param_name = param_name\n+        dependant.websocket_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, HTTPConnection):\n-        dependant.http_connection_param_name = param_name\n+        dependant.http_connection_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, Response):\n-        dependant.response_param_name = param_name\n+        dependant.response_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, StarletteBackgroundTasks):\n-        dependant.background_tasks_param_name = param_name\n+        dependant.background_tasks_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, SecurityScopes):\n-        dependant.security_scopes_param_name = param_name\n+        dependant.security_scopes_param_names.add(param_name)\n         return True\n     return None\n \n@@ -677,22 +677,25 @@ async def solve_dependencies(\n         )\n         values.update(body_values)\n         e", "output": "Bug: üêõ Fix duplicate special dependency handling\n\nSee the bug description [here](https://github.com/fastapi/fastapi/discussions/12403)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 211}
{"instruction": "Review the following code changes: üêõ Fix duplicate special dependency handling", "input": "```diff\n@@ -38,12 +38,12 @@ class Dependant:\n     dependencies: list[\"Dependant\"] = field(default_factory=list)\n     name: str | None = None\n     call: Callable[..., Any] | None = None\n-    request_param_name: str | None = None\n-    websocket_param_name: str | None = None\n-    http_connection_param_name: str | None = None\n-    response_param_name: str | None = None\n-    background_tasks_param_name: str | None = None\n-    security_scopes_param_name: str | None = None\n+    request_param_names: set[str] = field(default_factory=set)\n+    websocket_param_names: set[str] = field(default_factory=set)\n+    http_connection_param_names: set[str] = field(default_factory=set)\n+    response_param_names: set[str] = field(default_factory=set)\n+    background_tasks_param_names: set[str] = field(default_factory=set)\n+    security_scopes_param_names: set[str] = field(default_factory=set)\n     own_oauth_scopes: list[str] | None = None\n     parent_oauth_scopes: list[str] | None = None\n     use_cache: bool = True\n@@ -74,7 +74,7 @@ def cache_key(self) -> DependencyCacheKey:\n     def _uses_scopes(self) -> bool:\n         if self.own_oauth_scopes:\n             return True\n-        if self.security_scopes_param_name is not None:\n+        if self.security_scopes_param_names:\n             return True\n         if self._is_security_scheme:\n             return True\n\n```\n\n```diff\n@@ -145,12 +145,12 @@ def get_flat_dependant(\n         body_params=dependant.body_params.copy(),\n         name=dependant.name,\n         call=dependant.call,\n-        request_param_name=dependant.request_param_name,\n-        websocket_param_name=dependant.websocket_param_name,\n-        http_connection_param_name=dependant.http_connection_param_name,\n-        response_param_name=dependant.response_param_name,\n-        background_tasks_param_name=dependant.background_tasks_param_name,\n-        security_scopes_param_name=dependant.security_scopes_param_name,\n+        request_param_names=dependant.request_param_names.copy(),\n+        websocket_param_names=dependant.websocket_param_names.copy(),\n+        http_connection_param_names=dependant.http_connection_param_names.copy(),\n+        response_param_names=dependant.response_param_names.copy(),\n+        background_tasks_param_names=dependant.background_tasks_param_names.copy(),\n+        security_scopes_param_names=dependant.security_scopes_param_names.copy(),\n         own_oauth_scopes=dependant.own_oauth_scopes,\n         parent_oauth_scopes=use_parent_oauth_scopes,\n         use_cache=dependant.use_cache,\n@@ -330,22 +330,22 @@ def add_non_field_param_to_dependency(\n     *, param_name: str, type_annotation: Any, dependant: Dependant\n ) -> bool | None:\n     if lenient_issubclass(type_annotation, Request):\n-        dependant.request_param_name = param_name\n+        dependant.request_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, WebSocket):\n-        dependant.websocket_param_name = param_name\n+        dependant.websocket_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, HTTPConnection):\n-        dependant.http_connection_param_name = param_name\n+        dependant.http_connection_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, Response):\n-        dependant.response_param_name = param_name\n+        dependant.response_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, StarletteBackgroundTasks):\n-        dependant.background_tasks_param_name = param_name\n+        dependant.background_tasks_param_names.add(param_name)\n         return True\n     elif lenient_issubclass(type_annotation, SecurityScopes):\n-        dependant.security_scopes_param_name = param_name\n+        dependant.security_scopes_param_names.add(param_name)\n         return True\n     return None\n \n@@ -677,22 +677,25 @@ async def solve_dependencies(\n         )\n         values.update(body_values)\n         errors.extend(body_errors)\n-    if dependant.http_connection_param_name:\n-        values[dependant.http_connection_param_name] = request\n-    if dependant.request_param_name and isinstance(request, Request):\n-        values[dependant.request_param_name] = request\n-    elif dependant.websocket_param_name and isinstance(request, WebSocket):\n-        values[dependant.webso\n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+import pytest\n+from fastapi import BackgroundTasks, FastAPI, Request, Response, WebSocket\n+from fastapi.security import SecurityScopes\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/request\")\n+def request(r1: Request, r2: Request) -> str:\n+    assert r1 is not None\n+    assert r1 is r2\n+    return \"success\"\n+\n+\n+@app.get(\"/response\")\n+def response(r1: Response, r2: Response) -> str:\n+    assert r1 is not None\n+    assert r1 is r2\n+    return \"success\"\n+\n+\n+@app.get(\"/background-tasks\")\n+def background_tasks(t1: BackgroundTasks, t2: BackgroundTasks) -> str:\n+ ", "output": "Code Review for: üêõ Fix duplicate special dependency handling\n\nüìù **fastapi/dependencies/models.py**: Is there a reason not to use `set` here?\r\nSeems like `set` should work a bit faster\n\nüìù **fastapi/dependencies/models.py**: No, you're totally right. I'll update it tomorrow.\n\nüìù **fastapi/dependencies/models.py**: Done. Thanks for your review! I really should have thought about it...\n\nüìù **fastapi/dependencies/models.py**: Thank you!\n\nüìù **fastapi/dependencies/utils.py**: Not sure about this part.\r\nThis way for flat dependant we have:\r\n* `path_params` (and other params) will include all path params of sub-dependants\r\n*  `request_param_names` (and other \"param names\") will only include param names of this dependant (will not include param names from sub-dependants)\r\n\r\nThis doesn't affect us currently, but maybe we should think how to prevent confusion in the future\n\n", "source": "pr", "type": "code_review", "pr_number": 211}
{"instruction": "Review this code change in `fastapi/dependencies/models.py`", "input": "```diff\n@@ -22,12 +22,12 @@ class Dependant:\n     security_requirements: List[SecurityRequirement] = field(default_factory=list)\n     name: Optional[str] = None\n     call: Optional[Callable[..., Any]] = None\n-    request_param_name: Optional[str] = None\n-    websocket_param_name: Optional[str] = None\n-    http_connection_param_name: Optional[str] = None\n-    response_param_name: Optional[str] = None\n-    background_tasks_param_name: Optional[str] = None\n-    security_scopes_param_name: Optional[str] = None\n+    request_param_names: List[str] = field(default_factory=list)\n\n```", "output": "Is there a reason not to use `set` here?\r\nSeems like `set` should work a bit faster", "source": "pr_review", "type": "inline_review", "pr_number": 211}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -158,12 +158,12 @@ def get_flat_dependant(\n         body_params=dependant.body_params.copy(),\n         name=dependant.name,\n         call=dependant.call,\n-        request_param_name=dependant.request_param_name,\n-        websocket_param_name=dependant.websocket_param_name,\n-        http_connection_param_name=dependant.http_connection_param_name,\n-        response_param_name=dependant.response_param_name,\n-        background_tasks_param_name=dependant.background_tasks_param_name,\n-        security_scopes_param_name=dependant.security_scopes_param_name,\n+        request_param_names=dependant.request_param_names.copy(),\n+        websocket_param_names=dependant.websocket_param_names.copy(),\n+        http_connection_param_names=dependant.http_connection_param_names.copy(),\n+        response_param_names=dependant.response_param_names.copy(),\n+        background_tasks_param_names=dependant.background_tasks_param_names.copy(),\n+        security_scopes_param_names=dependant.security_scopes_param_names.copy(),\n\n```", "output": "Not sure about this part.\r\nThis way for flat dependant we have:\r\n* `path_params` (and other params) will include all path params of sub-dependants\r\n*  `request_param_names` (and other \"param names\") will only include param names of this dependant (will not include param names from sub-dependants)\r\n\r\nThis doesn't affect us currently, but maybe we should think how to prevent confusion in the future", "source": "pr_review", "type": "inline_review", "pr_number": 211}
{"instruction": "Fix the following bug: üêõ Ensure handlers receive `fastapi.UploadFile` instances, not Starlette's", "input": "To start, thank you all for FastAPI! It's been a a joy to use FastAPI at $DAYJOB.\r\n\r\n## The problem\r\nWhile writing a unit test for an endpoint that handles a file, I stumbled across a discrepancy in what FastAPI [documentation describes](https://fastapi.tiangolo.com/tutorial/request-files/#file-parameters-with-uploadfile) and what actually gets passed to the handler (a `starlette.datastructures.UploadFile` via `starlette.requests.Request.form`).\r\n\r\nThe coding standard at $DAYJOB includes [typeguard](https://github.com/agronholm/typeguard) (via the `pytest-typeguard` plugin). In the unit test, typeguard enforcement fails because the upload file was not a FastAPI instance, but a Starlette instance. (Of course, bypassing typeguard allows the tests to pass, as expected.)\r\n> typeguard.TypeCheckError: argument \"file\" (starlette.datastructures.UploadFile) is not an instance of fastapi.datastructures.UploadFile\r\n\r\nA quick look at the implementation reveals the `UploadFile` creation is handled by `starlette.requests` and then passed to FastAPI's `run_function_endpoint`, without any transforms to a `fastapi.datastructures.UploadFile`. Thankfully, in practice, this doesn't appear to be an issue at runtime, since the FastAPI UploadFile merely extends the Starlette UploadFile to add Pydantic support.\r\n\r\n## A solution\r\n- An `UploadFile.from_starlette` classmethod is added to transform from a `StarletteUploadFile` to Starlette's `UploadFile`. FastAPI is already aware of the Starlette UploadFile implementation because it's extending it, so adding the transform to the FastAPI class felt like adding a missing puzzle piece\r\n- This can be applied in `fastapi.routing.run_endpoint_function` to check the `values` dict for non-FastAPI `UploadFile`s and convert them prior to handling off to any endpoint function\r\n- Finally, a quick test that doesn't require typeguard to demonstrate the type signature is consistent\r\n\r\n## Thanks again!\r\n\r\nI look forward to feedback!", "output": "```diff\n@@ -63,6 +63,17 @@ async def create_upload_file(file: UploadFile):\n         str | None, Doc(\"The content type of the request, from the headers.\")\n     ]\n \n+    @classmethod\n+    def from_starlette(\n+        cls: type[\"UploadFile\"], starlette_uploadfile: StarletteUploadFile\n+    ) -> \"UploadFile\":\n+        return cls(\n+            file=starlette_uploadfile.file,\n+            size=starlette_uploadfile.size,\n+            filename=starlette_uploadfile.filename,\n+            headers=starlette_uploadfile.headers,\n+        )\n+\n     async def write(\n         self,\n         data: Annotated[\n\n```\n\n```diff\n@@ -44,6 +44,7 @@\n     asynccontextmanager,\n     contextmanager_in_threadpool,\n )\n+from fastapi.datastructures import UploadFile as FastAPIUploadFile\n from fastapi.dependencies.models import Dependant\n from fastapi.exceptions import DependencyScopeError\n from fastapi.logger import logger\n@@ -885,23 +886,25 @@ async def _extract_form_body(\n     for field in body_fields:\n         value = _get_multidict_value(field, received_body)\n         field_info = field.field_info\n-        if (\n-            isinstance(field_info, params.File)\n-            and is_bytes_or_nonable_bytes_annotation(field.field_info.annotation)\n-            and isinstance(value, UploadFile)\n-        ):\n-            value = await value.read()\n-        elif (\n-            is_bytes_sequence_annotation(field.field_info.annotation)\n-            and isinstance(field_info, params.File)\n-            and value_is_sequence(value)\n-        ):\n-            # For types\n-            assert isinstance(value, sequence_types)\n-            results: list[bytes | str] = []\n-            for sub_value in value:\n-                results.append(await sub_value.read())\n-            value = serialize_sequence_value(field=field, value=results)\n+        if isinstance(field_info, params.File) and isinstance(value, UploadFile):\n+            if is_bytes_or_nonable_bytes_annotation(field.field_info.annotation):\n+                value = await value.read()\n+            else:\n+                value = FastAPIUploadFile.from_starlette(value)\n+        elif isinstance(field_info, params.File) and value_is_sequence(value):\n+            if is_bytes_sequence_annotation(field.field_info.annotation):\n+                # For types\n+                assert isinstance(value, sequence_types)\n+                results: list[bytes | str] = []\n+                for sub_value in value:\n+                    results.append(await sub_value.read())\n+                value = serialize_sequence_value(field=field, value=results)\n+            else:\n+                value = [\n+                    FastAPIUploadFile.from_starlette(sub_value)\n+                    for sub_value in value\n+                    if isinstance(sub_value, UploadFile)\n+                ]\n         if value is not None:\n             values[get_validation_alias(field)] = value\n     field_aliases = {get_validation_alias(field) for field in body_fields}\n\n```\n\n```diff\n@@ -0,0 +1,109 @@\n+import io\n+from typing import Any\n+\n+import pytest\n+from fastapi import Depends, FastAPI, File, UploadFile\n+from fastapi.testclient import TestClient\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/uploadfile\")\n+async def uploadfile(uploadfile: UploadFile = File(...)) -> dict[str, Any]:\n+    return {\n+        \"filename\": uploadfile.filename,\n+        \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+        \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+        \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+    }\n+\n+\n+@app.post(\"/uploadfiles\")\n+async def uploadfiles(\n+    uploadfiles: list[UploadFile] = File(...),\n+) -> list[dict[str, Any]]:\n+    return [\n+        {\n+            \"filename\": uploadfile.filename,\n+            \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+            \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+            \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+        }\n+        for uploadfile in uploadfiles\n+    ]\n+\n+\n+async def get_uploadfile_info(uploadfile: UploadFile = File(...)) -> dict[str, Any]:\n+    return {\n+        \"filename\": uploadfile.filename,\n+        \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+        \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+        \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+    }\n+\n+\n+@app.post(\"/uploadfile-dep\")\n+async def uploadfile_dep(\n+    uploadfile_info: dict[str, Any] = Depends(get_uploadfile_info),\n+) -> dict[str, Any]:\n+    return uploadfile_info\n+\n+\n+async def get_uploadfiles_info(\n+    uploadfiles: list[UploadFile] = File(...),\n+) -> list[dict[str, Any]]:\n+    return [\n+        {\n+            \"filename\": uploadfile.filename,\n+            \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+            \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+            \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+        }\n+        for uploadfile in uploadfiles\n+    ]\n+\n+\n+@app.post(\"/uploadfiles-dep\")\n+async def uploadfiles_dep(\n+    uploadfiles_info: list[dict[str, Any]] = Depends(get_uploadfiles_info),\n+) -> list[dict[str, Any]]:\n+    return uploadfiles_info\n+\n+\n+@pytest.mark.parametrize(\"endpoint\", [\"/uploadfile\", \"/uploadfile-dep\"])\n+def test_uploadfile_type(endpoint: str) -> None:\n+    client = TestClient(app)\n+    files = {\"uploadfile\": (\"example.txt\", io.BytesIO(b\"test content\"), \"text/plain\")}\n+    response = client.post(f\"{endpoint}\", files=files)\n+    data = response.json()\n+\n+    assert data[\"filename\"] == \"example.txt\"\n+    assert data[\"is_fastapi_uploadfile\"] is True\n+    assert data[\"is_starlette_uploadfile\"] is True\n+    assert data[\"class\"].startswith(\"fastapi.\")\n+\n+\n+@pytest.mark.parametrize(\"\n\n```\n\n```diff\n@@ -215,6 +216,19 @@ async def run_endpoint_function(\n     # facilitate profiling endpoints, since inner functions are harder to profile.\n     assert dependant.call is not None, \"dependant.call must be a function\"\n \n+    # Convert all Starlette UploadFiles to FastAPI UploadFiles\n+    for key, value in values.items():\n+        if isinstance(value, StarletteUploadFile) and not isinstance(value, UploadFile):\n\n```\n\n```diff\n@@ -215,6 +216,19 @@ async def run_endpoint_function(\n     # facilitate profiling endpoints, since inner functions are harder to profile.\n     assert dependant.call is not None, \"dependant.call must be a function\"\n \n+    # Convert all Starlette UploadFiles to FastAPI UploadFiles\n+    for key, value in values.items():\n+        if isinstance(value, StarletteUploadFile) and not isinstance(value, UploadFile):\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 210}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -63,6 +63,17 @@ async def create_upload_file(file: UploadFile):\n         str | None, Doc(\"The content type of the request, from the headers.\")\n     ]\n \n+    @classmethod\n+    def from_starlette(\n+        cls: type[\"UploadFile\"], starlette_uploadfile: StarletteUploadFile\n+    ) -> \"UploadFile\":\n+        return cls(\n+            file=starlette_uploadfile.file,\n+            size=starlette_uploadfile.size,\n+            filename=starlette_uploadfile.filename,\n+            headers=starlette_uploadfile.headers,\n+        )\n+\n     async def write(\n         self,\n         data: Annotated[\n\n```\n\n```diff\n@@ -44,6 +44,7 @@\n     asynccontextmanager,\n     contextmanager_in_threadpool,\n )\n+from fastapi.datastructures import UploadFile as FastAPIUploadFile\n from fastapi.dependencies.models import Dependant\n from fastapi.exceptions import DependencyScopeError\n from fastapi.logger import logger\n@@ -885,23 +886,25 @@ async def _extract_form_body(\n     for field in body_fields:\n         value = _get_multidict_value(field, received_body)\n         field_info = field.field_info\n-        if (\n-            isinstance(field_info, params.File)\n-            and is_bytes_or_nonable_bytes_annotation(field.field_info.annotation)\n-            and isinstance(value, UploadFile)\n-        ):\n-            value = await value.read()\n-        elif (\n-            is_bytes_sequence_annotation(field.field_info.annotation)\n-            and isinstance(field_info, params.File)\n-            and value_is_sequence(value)\n-        ):\n-            # For types\n-            assert isinstance(value, sequence_types)\n-            results: list[bytes | str] = []\n-            for sub_value in value:\n-                results.append(await sub_value.read())\n-            value = serialize_sequence_value(field=field, value=results)\n+        if isinstance(field_info, params.File) and isinstance(value, UploadFile):\n+            if is_bytes_or_nonable_bytes_annotation(field.field_info.annotation):\n+                value = await value.read()\n+            else:\n+                value = FastAPIUploadFile.from_starlette(value)\n+        elif isinstance(field_info, params.File) and value_is_sequence(value):\n+            if is_bytes_sequence_annotation(field.field_info.annotation):\n+                # For types\n+                assert isinstance(value, sequence_types)\n+                results: list[bytes | str] = []\n+                for sub_value in value:\n+                    results.append(await sub_value.read())\n+                value = serialize_sequence_value(field=field, value=results)\n+            else:\n+                value = [\n+                    FastAPIUploadFile.from_starlette(sub_value)\n+                    for sub_value in value\n+                    if isinstance(sub_value, UploadFile)\n+                ]\n         if value is not None:\n             values[get_validation_alias(field)] = value\n     field_aliases = {get_validation_alias(field) for field in body_fields}\n\n```\n\n```diff\n@@ -0,0 +1,109 @@\n+import io\n+from typing import Any\n+\n+import pytest\n+from fastapi import Depends, FastAPI, File, UploadFile\n+from fastapi.testclient import TestClient\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/uploadfile\")\n+async def uploadfile(uploadfile: UploadFile = File(...)) -> dict[str, Any]:\n+    return {\n+        \"filename\": uploadfile.filename,\n+        \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+        \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+        \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+    }\n+\n+\n+@app.post(\"/uploadfiles\")\n+async def uploadfiles(\n+    uploadfiles: list[UploadFile] = File(...),\n+) -> list[dict[str, Any]]:\n+    return [\n+        {\n+            \"filename\": uploadfile.filename,\n+            \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+            \"is_starlette_uploadfile\": isinstance(uploadfile, Starle", "output": "Bug: üêõ Ensure handlers receive `fastapi.UploadFile` instances, not Starlette's\n\nTo start, thank you all for FastAPI! It's been a a joy to use FastAPI at $DAYJOB.\r\n\r\n## The problem\r\nWhile writing a unit test for an endpoint that handles a file, I stumbled across a discrepancy in what FastAPI [documentation describes](https://fastapi.tiangolo.com/tutorial/request-files/#file-parameters-with-uploadfile) and what actually gets passed to the handler (a `starlette.datastructures.UploadFile` via `starlette.requests.Request.form`).\r\n\r\nThe coding standard at $DAYJOB includes [typeguard](https://github.com/agronholm/typeguard) (via the `pytest-typeguard` plugin). In the unit test, typeguard enforcement fails because the upload file was not a FastAPI instance, but a Starlette instance. (Of course, bypassing typeguard allows the tests to pass, as expected.)\r\n> typeguard.TypeCheckError: argument \"file\" (starlette.datastructures.UploadFile) is not an instance of fastapi.datastructures.UploadFile\r\n\r\nA quick look at the implementation reveals the `UploadFile` creation is handled by `starlette.requests` and then passed to FastAPI's `run_function_endpoint`, without any transforms to a `fastapi.datastructures.UploadFile`. Thankfully, in practice, this doesn't appear to be an issue at runtime, since the FastAPI UploadFile merely extends the Starlette UploadFile to add Pydantic support.\r\n\r\n## A solution\r\n- An `UploadFile.from_starlette` classmethod is added to transform from a `StarletteUploadFile` to Starlette's `UploadFile`. FastAPI is already aware of the Starlette UploadFile implementation because it's extending it, so adding the transform to the FastAPI class felt like adding a missing puzzle piece\r\n- This can be applied in `fastapi.routing.run_endpoint_function` to check the `values` dict for non-FastAPI `UploadFile`s and convert them prior to handling off to any endpoint function\r\n- Finally, a quick test that doesn't require typeguard to demonstrate the type signature is consistent\r\n\r\n## Thanks again!\r\n\r\nI look forward to feedback!", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 210}
{"instruction": "Review the following code changes: üêõ Ensure handlers receive `fastapi.UploadFile` instances, not Starlette's", "input": "```diff\n@@ -63,6 +63,17 @@ async def create_upload_file(file: UploadFile):\n         str | None, Doc(\"The content type of the request, from the headers.\")\n     ]\n \n+    @classmethod\n+    def from_starlette(\n+        cls: type[\"UploadFile\"], starlette_uploadfile: StarletteUploadFile\n+    ) -> \"UploadFile\":\n+        return cls(\n+            file=starlette_uploadfile.file,\n+            size=starlette_uploadfile.size,\n+            filename=starlette_uploadfile.filename,\n+            headers=starlette_uploadfile.headers,\n+        )\n+\n     async def write(\n         self,\n         data: Annotated[\n\n```\n\n```diff\n@@ -44,6 +44,7 @@\n     asynccontextmanager,\n     contextmanager_in_threadpool,\n )\n+from fastapi.datastructures import UploadFile as FastAPIUploadFile\n from fastapi.dependencies.models import Dependant\n from fastapi.exceptions import DependencyScopeError\n from fastapi.logger import logger\n@@ -885,23 +886,25 @@ async def _extract_form_body(\n     for field in body_fields:\n         value = _get_multidict_value(field, received_body)\n         field_info = field.field_info\n-        if (\n-            isinstance(field_info, params.File)\n-            and is_bytes_or_nonable_bytes_annotation(field.field_info.annotation)\n-            and isinstance(value, UploadFile)\n-        ):\n-            value = await value.read()\n-        elif (\n-            is_bytes_sequence_annotation(field.field_info.annotation)\n-            and isinstance(field_info, params.File)\n-            and value_is_sequence(value)\n-        ):\n-            # For types\n-            assert isinstance(value, sequence_types)\n-            results: list[bytes | str] = []\n-            for sub_value in value:\n-                results.append(await sub_value.read())\n-            value = serialize_sequence_value(field=field, value=results)\n+        if isinstance(field_info, params.File) and isinstance(value, UploadFile):\n+            if is_bytes_or_nonable_bytes_annotation(field.field_info.annotation):\n+                value = await value.read()\n+            else:\n+                value = FastAPIUploadFile.from_starlette(value)\n+        elif isinstance(field_info, params.File) and value_is_sequence(value):\n+            if is_bytes_sequence_annotation(field.field_info.annotation):\n+                # For types\n+                assert isinstance(value, sequence_types)\n+                results: list[bytes | str] = []\n+                for sub_value in value:\n+                    results.append(await sub_value.read())\n+                value = serialize_sequence_value(field=field, value=results)\n+            else:\n+                value = [\n+                    FastAPIUploadFile.from_starlette(sub_value)\n+                    for sub_value in value\n+                    if isinstance(sub_value, UploadFile)\n+                ]\n         if value is not None:\n             values[get_validation_alias(field)] = value\n     field_aliases = {get_validation_alias(field) for field in body_fields}\n\n```\n\n```diff\n@@ -0,0 +1,109 @@\n+import io\n+from typing import Any\n+\n+import pytest\n+from fastapi import Depends, FastAPI, File, UploadFile\n+from fastapi.testclient import TestClient\n+from starlette.datastructures import UploadFile as StarletteUploadFile\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/uploadfile\")\n+async def uploadfile(uploadfile: UploadFile = File(...)) -> dict[str, Any]:\n+    return {\n+        \"filename\": uploadfile.filename,\n+        \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+        \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+        \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+    }\n+\n+\n+@app.post(\"/uploadfiles\")\n+async def uploadfiles(\n+    uploadfiles: list[UploadFile] = File(...),\n+) -> list[dict[str, Any]]:\n+    return [\n+        {\n+            \"filename\": uploadfile.filename,\n+            \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+            \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+            \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+        }\n+        for uploadfile in uploadfiles\n+    ]\n+\n+\n+async def get_uploadfile_info(uploadfile: UploadFile = File(...)) -> dict[str, Any]:\n+    return {\n+        \"filename\": uploadfile.filename,\n+        \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+        \"is_starlette_uploadfile\": isinstance(uploadfile, StarletteUploadFile),\n+        \"class\": f\"{uploadfile.__class__.__module__}.{uploadfile.__class__.__name__}\",\n+    }\n+\n+\n+@app.post(\"/uploadfile-dep\")\n+async def uploadfile_dep(\n+    uploadfile_info: dict[str, Any] = Depends(get_uploadfile_info),\n+) -> dict[str, Any]:\n+    return uploadfile_info\n+\n+\n+async def get_uploadfiles_info(\n+    uploadfiles: list[UploadFile] = File(...),\n+) -> list[dict[str, Any]]:\n+    return [\n+        {\n+            \"filename\": uploadfile.filename,\n+            \"is_fastapi_uploadfile\": isinstance(uploadfile, UploadFile),\n+    ", "output": "Code Review for: üêõ Ensure handlers receive `fastapi.UploadFile` instances, not Starlette's\n\nüìù **fastapi/routing.py**: Do we really need that `and not isinstance(value, UploadFile)` part in condition?\n\nüìù **fastapi/routing.py**: I investigated a bit more and came up with the following use case (quite unrealistic):\r\n\r\n```py\r\nfrom fastapi import Depends, FastAPI, File, UploadFile\r\n\r\napp = FastAPI()\r\n\r\nasync def dep(uploadfile: UploadFile = File(...)):\r\n    return UploadFile.from_starlette(uploadfile)\r\n\r\n@app.post(\"/uploadfile\")\r\nasync def uploadfile(uploadfile: UploadFile = Depends(dep)):\r\n    assert isinstance(uploadfile, UploadFile)\r\n    return {}\r\n```\r\n\r\nIn this case, the value passed to endpoint function will already be `fastapi.UploadFile`.\r\n\r\nAnd, this use case exposed an issue in this implementation - it only converts values for endpoint function, but in dependencies we will still have `starlette.UploadFile`.\r\n\r\n@mlb-, will you be able to take a look at this?\n\n", "source": "pr", "type": "code_review", "pr_number": 210}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -215,6 +216,19 @@ async def run_endpoint_function(\n     # facilitate profiling endpoints, since inner functions are harder to profile.\n     assert dependant.call is not None, \"dependant.call must be a function\"\n \n+    # Convert all Starlette UploadFiles to FastAPI UploadFiles\n+    for key, value in values.items():\n+        if isinstance(value, StarletteUploadFile) and not isinstance(value, UploadFile):\n\n```", "output": "Do we really need that `and not isinstance(value, UploadFile)` part in condition?", "source": "pr_review", "type": "inline_review", "pr_number": 210}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Simplify code in `fastapi/routing.py`", "input": "```diff\n@@ -338,7 +338,6 @@ def get_request_handler(\n         actual_response_class = response_class\n \n     async def app(request: Request) -> Response:\n-        response: Response | None = None\n         file_stack = request.scope.get(\"fastapi_middleware_astack\")\n         assert isinstance(file_stack, AsyncExitStack), (\n             \"fastapi_middleware_astack not found in request scope\"\n@@ -406,7 +405,6 @@ async def app(request: Request) -> Response:\n             raise http_error from e\n \n         # Solve dependencies and run path operation function, auto-closing dependencies\n-        errors: list[Any] = []\n         async_exit_stack = request.scope.get(\"fastapi_inner_astack\")\n         assert isinstance(async_exit_stack, AsyncExitStack), (\n             \"fastapi_inner_astack not found in request scope\"\n@@ -420,53 +418,42 @@ async def app(request: Request) -> Response:\n             embed_body_fields=embed_body_fields,\n         )\n         errors = solved_result.errors\n-        if not errors:\n-            raw_response = await run_endpoint_function(\n-                dependant=dependant,\n-                values=solved_result.values,\n-                is_coroutine=is_coroutine,\n-            )\n-            if isinstance(raw_response, Response):\n-                if raw_response.background is None:\n-                    raw_response.background = solved_result.background_tasks\n-                response = raw_response\n-            else:\n-                response_args: dict[str, Any] = {\n-                    \"background\": solved_result.background_tasks\n-                }\n-                # If status_code was set, use it, otherwise use the default from the\n-                # response class, in the case of redirect it's 307\n-                current_status_code = (\n-                    status_code if status_code else solved_result.response.status_code\n-                )\n-                if current_status_code is not None:\n-                    response_args[\"status_code\"] = current_status_code\n-                if solved_result.response.status_code:\n-                    response_args[\"status_code\"] = solved_result.response.status_code\n-                content = await serialize_response(\n-                    field=response_field,\n-                    response_content=raw_response,\n-                    include=response_model_include,\n-                    exclude=response_model_exclude,\n-                    by_alias=response_model_by_alias,\n-                    exclude_unset=response_model_exclude_unset,\n-                    exclude_defaults=response_model_exclude_defaults,\n-                    exclude_none=response_model_exclude_none,\n-                    is_coroutine=is_coroutine,\n-                    endpoint_ctx=endpoint_ctx,\n-                )\n-                response = actual_response_class(content, **response_args)\n-                if not is_body_allowed_for_status_code(response.status_code):\n-                    response.body = b\"\"\n-                response.headers.raw\n\n```\n\n```diff\n@@ -372,7 +372,6 @@ async def app(request: Request) -> Response:\n             raise http_error from e\n \n         # Solve dependencies and run path operation function, auto-closing dependencies\n-        errors: List[Any] = []\n\n```\n\n```diff\n@@ -277,6 +278,63 @@ async def serialize_response(\n     else:\n         return jsonable_encoder(response_content)\n \n+async def get_request_body(\n+    request: Request,\n+    body_field: Optional[ModelField],\n+    file_stack: AsyncExitStack[bool | None]\n+) -> Optional[Union[Dict[str, Any], FormData, bytes]]:\n+    # Read body and auto-close files\n+    if not body_field:\n+        return None\n+    try:\n+        is_body_form = body_field and isinstance(\n+            body_field.field_info, (params.Form, temp_pydantic_v1_params.Form)\n+        )\n+        if is_body_form:\n\n```\n\n```diff\n@@ -308,71 +366,20 @@ def get_request_handler(\n ) -> Callable[[Request], Coroutine[Any, Any, Response]]:\n     assert dependant.call is not None, \"dependant.call must be a function\"\n     is_coroutine = iscoroutinefunction(dependant.call)\n-    is_body_form = body_field and isinstance(\n\n```\n\n```diff\n@@ -386,52 +393,41 @@ async def app(request: Request) -> Response:\n             embed_body_fields=embed_body_fields,\n         )\n         errors = solved_result.errors\n-        if not errors:\n-            raw_response = await run_endpoint_function(\n-                dependant=dependant,\n-                values=solved_result.values,\n-                is_coroutine=is_coroutine,\n-            )\n-            if isinstance(raw_response, Response):\n-                if raw_response.background is None:\n-                    raw_response.background = solved_result.background_tasks\n-                response = raw_response\n-            else:\n-                response_args: Dict[str, Any] = {\n-                    \"background\": solved_result.background_tasks\n-                }\n-                # If status_code was set, use it, otherwise use the default from the\n- ", "output": "Code Review for: ‚ôªÔ∏è Simplify code in `fastapi/routing.py`\n\nüìù **fastapi/routing.py**: variable is overwritten by `errors = solved_result.errors` a bit lower\n\nüìù **fastapi/routing.py**: doesn't change internal rules, just simplify code removing nesting\n\nüìù **fastapi/routing.py**: moved to get_request_body, where actually used\n\nüìù **fastapi/routing.py**: `assert response` was used to avoid forget response assignment inside if-else-branches, not required in proposed changes\n\nüìù **fastapi/routing.py**: This was removed from this PR\n\n", "source": "pr", "type": "code_review", "pr_number": 209}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -372,7 +372,6 @@ async def app(request: Request) -> Response:\n             raise http_error from e\n \n         # Solve dependencies and run path operation function, auto-closing dependencies\n-        errors: List[Any] = []\n\n```", "output": "variable is overwritten by `errors = solved_result.errors` a bit lower", "source": "pr_review", "type": "inline_review", "pr_number": 209}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -277,6 +278,63 @@ async def serialize_response(\n     else:\n         return jsonable_encoder(response_content)\n \n+async def get_request_body(\n+    request: Request,\n+    body_field: Optional[ModelField],\n+    file_stack: AsyncExitStack[bool | None]\n+) -> Optional[Union[Dict[str, Any], FormData, bytes]]:\n+    # Read body and auto-close files\n+    if not body_field:\n+        return None\n+    try:\n+        is_body_form = body_field and isinstance(\n+            body_field.field_info, (params.Form, temp_pydantic_v1_params.Form)\n+        )\n+        if is_body_form:\n\n```", "output": "doesn't change internal rules, just simplify code removing nesting", "source": "pr_review", "type": "inline_review", "pr_number": 209}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -308,71 +366,20 @@ def get_request_handler(\n ) -> Callable[[Request], Coroutine[Any, Any, Response]]:\n     assert dependant.call is not None, \"dependant.call must be a function\"\n     is_coroutine = iscoroutinefunction(dependant.call)\n-    is_body_form = body_field and isinstance(\n\n```", "output": "moved to get_request_body, where actually used", "source": "pr_review", "type": "inline_review", "pr_number": 209}
{"instruction": "Review this code change in `fastapi/routing.py`", "input": "```diff\n@@ -386,52 +393,41 @@ async def app(request: Request) -> Response:\n             embed_body_fields=embed_body_fields,\n         )\n         errors = solved_result.errors\n-        if not errors:\n-            raw_response = await run_endpoint_function(\n-                dependant=dependant,\n-                values=solved_result.values,\n-                is_coroutine=is_coroutine,\n-            )\n-            if isinstance(raw_response, Response):\n-                if raw_response.background is None:\n-                    raw_response.background = solved_result.background_tasks\n-                response = raw_response\n-            else:\n-                response_args: Dict[str, Any] = {\n-                    \"background\": solved_result.background_tasks\n-                }\n-                # If status_code was set, use it, otherwise use the default from the\n-                # response class, in the case of redirect it's 307\n-                current_status_code = (\n-                    status_code if status_code else solved_result.response.status_code\n-                )\n-                if current_status_code is not None:\n-                    response_args[\"status_code\"] = current_status_code\n-                if solved_result.response.status_code:\n-                    response_args[\"status_code\"] = solved_result.response.status_code\n-                content = await serialize_response(\n-                    field=response_field,\n-                    response_content=raw_response,\n-                    include=response_model_include,\n-                    exclude=response_model_exclude,\n-                    by_alias=response_model_by_alias,\n-                    exclude_unset=response_model_exclude_unset,\n-                    exclude_defaults=response_model_exclude_defaults,\n-                    exclude_none=response_model_exclude_none,\n-                    is_coroutine=is_coroutine,\n-                )\n-                response = actual_response_class(content, **response_args)\n-                if not is_body_allowed_for_status_code(response.status_code):\n-                    response.body = b\"\"\n-                response.headers.raw.extend(solved_result.response.headers.raw)\n         if errors:\n-            validation_error = RequestValidationError(\n-                _normalize_errors(errors), body=body\n-            )\n-            raise validation_error\n+            raise RequestValidationError(_normalize_errors(errors), body=body)\n \n-        # Return response\n-        assert response\n\n```", "output": "`assert response` was used to avoid forget response assignment inside if-else-branches, not required in proposed changes", "source": "pr_review", "type": "inline_review", "pr_number": 209}
{"instruction": "Review the following code changes: ‚ú® Implement `OAuth2ClientCredentials` class", "input": "```diff\n@@ -21,6 +21,7 @@ from fastapi.security import (\n     OAuth2,\n     OAuth2AuthorizationCodeBearer,\n     OAuth2PasswordBearer,\n+    OAuth2ClientCredentials,\n     OAuth2PasswordRequestForm,\n     OAuth2PasswordRequestFormStrict,\n     OpenIdConnect,\n@@ -60,6 +61,8 @@ Read more about them in the [FastAPI docs about Security](https://fastapi.tiango\n \n ::: fastapi.security.OAuth2PasswordBearer\n \n+::: fastapi.security.OAuth2ClientCredentials\n+\n ## OAuth2 Password Form\n \n ::: fastapi.security.OAuth2PasswordRequestForm\n\n```\n\n```diff\n@@ -8,6 +8,7 @@\n from .http import HTTPDigest as HTTPDigest\n from .oauth2 import OAuth2 as OAuth2\n from .oauth2 import OAuth2AuthorizationCodeBearer as OAuth2AuthorizationCodeBearer\n+from .oauth2 import OAuth2ClientCredentials as OAuth2ClientCredentials\n from .oauth2 import OAuth2PasswordBearer as OAuth2PasswordBearer\n from .oauth2 import OAuth2PasswordRequestForm as OAuth2PasswordRequestForm\n from .oauth2 import OAuth2PasswordRequestFormStrict as OAuth2PasswordRequestFormStrict\n\n```\n\n```diff\n@@ -650,6 +650,101 @@ async def __call__(self, request: Request) -> str | None:\n         return param\n \n \n+class OAuth2ClientCredentials(OAuth2):\n+    \"\"\"\n+    OAuth2 flow for authentication using a bearer token obtained with an OAuth2 client\n+    credentials flow. An instance of it would be used as a dependency.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        tokenUrl: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL to obtain the OAuth2 token.\n+                \"\"\"\n+            ),\n+        ],\n+        scheme_name: Annotated[\n+            str | None,\n+            Doc(\n+                \"\"\"\n+                Security scheme name.\n+\n+                It will be included in the generated OpenAPI (e.g. visible at `/docs`).\n+                \"\"\"\n+            ),\n+        ] = None,\n+        scopes: Annotated[\n+            dict[str, str] | None,\n+            Doc(\n+                \"\"\"\n+                The OAuth2 scopes that would be required by the *path operations* that\n+                use this dependency.\n+                \"\"\"\n+            ),\n+        ] = None,\n+        description: Annotated[\n+            str | None,\n+            Doc(\n+                \"\"\"\n+                Security scheme description.\n+\n+                It will be included in the generated OpenAPI (e.g. visible at `/docs`).\n+                \"\"\"\n+            ),\n+        ] = None,\n+        auto_error: Annotated[\n+            bool,\n+            Doc(\n+                \"\"\"\n+                By default, if no HTTP Authorization header is provided, required for\n+                OAuth2 authentication, it will automatically cancel the request and\n+                send the client an error.\n+\n+                If `auto_error` is set to `False`, when the HTTP Authorization header\n+                is not available, instead of erroring out, the dependency result will\n+                be `None`.\n+\n+                This is useful when you want to have optional authentication.\n+\n+                It is also useful when you want to have authentication that can be\n+                provided in one of multiple optional ways (for example, with OAuth2\n+                or in a cookie).\n+                \"\"\"\n+            ),\n+        ] = True,\n+    ):\n+        if not scopes:\n+            scopes = {}\n+        flows = OAuthFlowsModel(\n+            clientCredentials=cast(\n+                Any,\n+                {\n+                    \"tokenUrl\": tokenUrl,\n+                    \"scopes\": scopes,\n+                },\n+            )\n+        )\n+        super().__init__(\n+            flows=flows,\n+            scheme_name=scheme_name,\n+            description=description,\n+            auto_error=auto_error,\n+        )\n+\n+    async def __call__(self, request: Request) -> str | None:\n+        authorization = request.headers.get(\"Authorization\")\n+        scheme, param = get_authorization_scheme_param(authorization)\n+        if not authorization or scheme.lower() != \"bearer\":\n+         \n\n```\n\n```diff\n@@ -0,0 +1,72 @@\n+from typing import Annotated\n+\n+from fastapi import FastAPI, Security\n+from fastapi.security import OAuth2ClientCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+oauth2_scheme = OAuth2ClientCredentials(tokenUrl=\"token\", auto_error=True)\n+\n+\n+@app.get(\"/items/\")\n+async def read_items(token: Annotated[str, Security(oauth2_scheme)]):\n+    return {\"token\": token}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_no_token():\n+    response = client.get(\"/items\")\n+    assert response.status_code == 401, response.text\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+\n+def test_incorrect_token():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Non-existent testtoken\"})\n+    assert response.status_code == 401, response.text\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+\n+def test_token():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Beare", "output": "Code Review for: ‚ú® Implement `OAuth2ClientCredentials` class\n\nüìù **fastapi/security/oauth2.py**: Client Credentials do not have the concept of refresh (the refresh is done by obtaining a new token) so this parameter should be absent\n\nüìù **fastapi/security/oauth2.py**: Thanks for spotting this I've removed this now. I originally included it as the `OAuthFlowClientCredentials` model includes this field (inherited from the OAuthFlow model) not sure if this should be changed too.\r\n\r\nhttps://github.com/tiangolo/fastapi/blob/master/fastapi/openapi/models.py#L365-L379\n\nüìù **tests/test_security_oauth2_authorization_client_credentials_description.py**: Why are we not setting the `testtoken` in a const file instead of duplicating it everywhere?\n\nüìù **tests/test_security_oauth2_authorization_client_credentials_description.py**: I followed the existing structure of the other oauth2 tests. I agree `test_token` and possibly the `test_client` should probably be move into fixtures but I think that is beyond the scope of this pull request. I could create a new issue for \"reducing code duplication in tests\"?\n\nüìù **fastapi/security/oauth2.py**: `By default, if no HTTP Authorization header is provided, required for`\r\ntypo in Authorization\n\n", "source": "pr", "type": "code_review", "pr_number": 208}
{"instruction": "Review this code change in `fastapi/security/oauth2.py`", "input": "```diff\n@@ -595,6 +595,114 @@ async def __call__(self, request: Request) -> Optional[str]:\n         return param\n \n \n+class OAuth2ClientCredentials(OAuth2):\n+    \"\"\"\n+    OAuth2 flow for authentication using a bearer token obtained with an OAuth2 client\n+    credentials flow. An instance of it would be used as a dependency.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        tokenUrl: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL to obtain the OAuth2 token.\n+                \"\"\"\n+            ),\n+        ],\n+        refreshUrl: Annotated[\n\n```", "output": "Client Credentials do not have the concept of refresh (the refresh is done by obtaining a new token) so this parameter should be absent", "source": "pr_review", "type": "inline_review", "pr_number": 208}
{"instruction": "Review this code change in `tests/test_security_oauth2_authorization_client_credentials_description.py`", "input": "```diff\n@@ -0,0 +1,77 @@\n+from typing import Optional\n+\n+from fastapi import FastAPI, Security\n+from fastapi.security import OAuth2ClientCredentials\n+from fastapi.testclient import TestClient\n+\n+app = FastAPI()\n+\n+oauth2_scheme = OAuth2ClientCredentials(\n+    tokenUrl=\"token\",\n+    description=\"OAuth2 Client Credentials Flow\",\n+    auto_error=True,\n+)\n+\n+\n+@app.get(\"/items/\")\n+async def read_items(token: Optional[str] = Security(oauth2_scheme)):\n+    return {\"token\": token}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_no_token():\n+    response = client.get(\"/items\")\n+    assert response.status_code == 401, response.text\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+\n+def test_incorrect_token():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Non-existent testtoken\"})\n+    assert response.status_code == 401, response.text\n+    assert response.json() == {\"detail\": \"Not authenticated\"}\n+\n+\n+def test_token():\n+    response = client.get(\"/items\", headers={\"Authorization\": \"Bearer testtoken\"})\n\n```", "output": "Why are we not setting the `testtoken` in a const file instead of duplicating it everywhere?", "source": "pr_review", "type": "inline_review", "pr_number": 208}
{"instruction": "Review this code change in `fastapi/security/oauth2.py`", "input": "```diff\n@@ -595,6 +595,105 @@ async def __call__(self, request: Request) -> Optional[str]:\n         return param\n \n \n+class OAuth2ClientCredentials(OAuth2):\n+    \"\"\"\n+    OAuth2 flow for authentication using a bearer token obtained with an OAuth2 client\n+    credentials flow. An instance of it would be used as a dependency.\n+    \"\"\"\n+\n+    def __init__(\n+        self,\n+        tokenUrl: Annotated[\n+            str,\n+            Doc(\n+                \"\"\"\n+                The URL to obtain the OAuth2 token.\n+                \"\"\"\n+            ),\n+        ],\n+        scheme_name: Annotated[\n+            Optional[str],\n+            Doc(\n+                \"\"\"\n+                Security scheme name.\n+\n+                It will be included in the generated OpenAPI (e.g. visible at `/docs`).\n+                \"\"\"\n+            ),\n+        ] = None,\n+        scopes: Annotated[\n+            Optional[Dict[str, str]],\n+            Doc(\n+                \"\"\"\n+                The OAuth2 scopes that would be required by the *\"path\" operations* that\n+                use this dependency.\n+                \"\"\"\n+            ),\n+        ] = None,\n+        description: Annotated[\n+            Optional[str],\n+            Doc(\n+                \"\"\"\n+                Security scheme description.\n+\n+                It will be included in the generated OpenAPI (e.g. visible at `/docs`).\n+                \"\"\"\n+            ),\n+        ] = None,\n+        auto_error: Annotated[\n+            bool,\n+            Doc(\n+                \"\"\"\n+                By default, if no HTTP Auhtorization header is provided, required for\n\n```", "output": "`By default, if no HTTP Authorization header is provided, required for`\r\ntypo in Authorization", "source": "pr_review", "type": "inline_review", "pr_number": 208}
{"instruction": "Fix the following bug: Fix grammar in `docs/fr/docs`", "input": "Just some minor grammar issues found in the French docs while skimming through it.", "output": "```diff\n@@ -39,7 +39,7 @@ def results():\n \n ---\n \n-Si votre application n'a pas √† communiquer avec une biblioth√®que externe et pas √† attendre de r√©ponse, utilisez `async def`.\n+Si votre application n'a pas √† communiquer avec une biblioth√®que externe et n'a pas √† attendre de r√©ponse, utilisez `async def`.\n \n ---\n \n\n```\n\n```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 207}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -39,7 +39,7 @@ def results():\n \n ---\n \n-Si votre application n'a pas √† communiquer avec une biblioth√®que externe et pas √† attendre de r√©ponse, utilisez `async def`.\n+Si votre application n'a pas √† communiquer avec une biblioth√®que externe et n'a pas √† attendre de r√©ponse, utilisez `async def`.\n \n ---\n \n\n```\n\n```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "output": "Bug: Fix grammar in `docs/fr/docs`\n\nJust some minor grammar issues found in the French docs while skimming through it.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 207}
{"instruction": "Review the following code changes: Fix grammar in `docs/fr/docs`", "input": "```diff\n@@ -39,7 +39,7 @@ def results():\n \n ---\n \n-Si votre application n'a pas √† communiquer avec une biblioth√®que externe et pas √† attendre de r√©ponse, utilisez `async def`.\n+Si votre application n'a pas √† communiquer avec une biblioth√®que externe et n'a pas √† attendre de r√©ponse, utilisez `async def`.\n \n ---\n \n\n```\n\n```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "output": "Changes look good. This PR implements: Fix grammar in `docs/fr/docs`", "source": "pr", "type": "code_review", "pr_number": 207}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -11,6 +11,10 @@ hide:\n \n * ‚ûñ Drop support for Python 3.9. PR [#14897](https://github.com/fastapi/fastapi/pull/14897) by [@tiangolo](https://github.com/tiangolo).\n \n+### Refactors\n+\n+* üé® Update internal types for Python 3.10. PR [#14898](https://github.com/fastapi/fastapi/pull/14898) by [@tiangolo](https://github.com/tiangolo).\n+\n ## 0.128.8\n \n ### Docs\n\n```\n\n```diff\n@@ -39,7 +39,7 @@ def results():\n \n ---\n \n-Si votre application n'a pas √† communiquer avec une biblioth√®que externe et pas √† attendre de r√©ponse, utilisez `async def`.\n+Si votre application n'a pas √† communiquer avec une biblioth√®que externe et n'a pas √† attendre de r√©ponse, utilisez `async def`.\n \n ---\n \n\n```\n\n```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "output": "Bug: Fix grammar in `docs/fr/docs`\n\nJust some minor grammar issues found in the French docs while skimming through it.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 206}
{"instruction": "Review the following code changes: Fix grammar in `docs/fr/docs`", "input": "```diff\n@@ -11,6 +11,10 @@ hide:\n \n * ‚ûñ Drop support for Python 3.9. PR [#14897](https://github.com/fastapi/fastapi/pull/14897) by [@tiangolo](https://github.com/tiangolo).\n \n+### Refactors\n+\n+* üé® Update internal types for Python 3.10. PR [#14898](https://github.com/fastapi/fastapi/pull/14898) by [@tiangolo](https://github.com/tiangolo).\n+\n ## 0.128.8\n \n ### Docs\n\n```\n\n```diff\n@@ -39,7 +39,7 @@ def results():\n \n ---\n \n-Si votre application n'a pas √† communiquer avec une biblioth√®que externe et pas √† attendre de r√©ponse, utilisez `async def`.\n+Si votre application n'a pas √† communiquer avec une biblioth√®que externe et n'a pas √† attendre de r√©ponse, utilisez `async def`.\n \n ---\n \n\n```\n\n```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "output": "Changes look good. This PR implements: Fix grammar in `docs/fr/docs`", "source": "pr", "type": "code_review", "pr_number": 206}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "output": "Bug: Fix grammar in `docs/fr/docs`\n\nJust some minor grammar issues found in the French docs while skimming through it.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 205}
{"instruction": "Review the following code changes: Fix grammar in `docs/fr/docs`", "input": "```diff\n@@ -1,17 +1,17 @@\n-# Fonctionnalit√©s\n+# Fonctionnalit√©s { #features }\n \n-## Fonctionnalit√©s de FastAPI\n+## Fonctionnalit√©s de FastAPI { #fastapi-features }\n \n-**FastAPI** vous offre ceci:\n+**FastAPI** vous offre ceci :\n \n-### Bas√© sur des standards ouverts\n+### Bas√© sur des standards ouverts { #based-on-open-standards }\n \n * <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> pour la cr√©ation d'API, incluant la d√©claration de <abbr title=\"en fran√ßais: routes. Aussi connu sous le nom anglais endpoints ou routes\">path</abbr> <abbr title=\"Aussi connu sous le nom de m√©thodes HTTP. √Ä savoir POST, GET, PUT, DELETE\">operations</abbr>, param√®tres, corps de requ√™tes, s√©curit√©, etc.\n-* Documentation automatique des mod√®les de donn√©es avec <a href=\"http://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n+* Documentation automatique des mod√®les de donn√©es avec <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (comme OpenAPI est aussi bas√©e sur JSON Schema).\n * Con√ßue avec ces standards apr√®s une analyse m√©ticuleuse. Plut√¥t qu'en rajoutant des surcouches apr√®s coup.\n * Cela permet d'utiliser de la **g√©n√©ration automatique de code client** dans beaucoup de langages.\n \n-### Documentation automatique\n+### Documentation automatique { #automatic-docs }\n \n Documentation d'API interactive et interface web d'exploration. Comme le framework est bas√© sur OpenAPI, de nombreuses options sont disponibles. Deux d'entre-elles sont incluses par d√©faut.\n \n@@ -23,7 +23,7 @@ Documentation d'API interactive et interface web d'exploration. Comme le framewo\n \n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-06-redoc-02.png)\n \n-### Faite en python moderne\n+### √âcrit en python moderne { #just-modern-python }\n \n Tout est bas√© sur la d√©claration de type standard de **Python 3.8** (gr√¢ce √† Pydantic). Pas de nouvelles syntaxes √† apprendre. Juste du Python standard et moderne.\n \n@@ -48,7 +48,7 @@ class User(BaseModel):\n     name: str\n     joined: date\n \n```", "output": "Changes look good. This PR implements: Fix grammar in `docs/fr/docs`", "source": "pr", "type": "code_review", "pr_number": 205}
{"instruction": "Review the following code changes: üè∑Ô∏è Add typing for `dependency_overrides_provider` in `solve_dependencies`", "input": "```diff\n@@ -48,7 +48,7 @@\n from fastapi.exceptions import DependencyScopeError\n from fastapi.logger import logger\n from fastapi.security.oauth2 import SecurityScopes\n-from fastapi.types import DependencyCacheKey\n+from fastapi.types import DependencyCacheKey, DependencyOverridesProvider\n from fastapi.utils import create_model_field, get_path_param_names\n from pydantic import BaseModel, Json\n from pydantic.fields import FieldInfo\n@@ -569,7 +569,7 @@ async def solve_dependencies(\n     body: dict[str, Any] | FormData | None = None,\n     background_tasks: StarletteBackgroundTasks | None = None,\n     response: Response | None = None,\n-    dependency_overrides_provider: Any | None = None,\n+    dependency_overrides_provider: DependencyOverridesProvider | None = None,\n     dependency_cache: dict[DependencyCacheKey, Any] | None = None,\n     # TODO: remove this parameter later, no longer used, not removing it yet as some\n     # people might be monkey patching this function (although that's not supported)\n@@ -601,9 +601,9 @@ async def solve_dependencies(\n             and dependency_overrides_provider.dependency_overrides\n         ):\n             original_call = sub_dependant.call\n-            call = getattr(\n-                dependency_overrides_provider, \"dependency_overrides\", {}\n-            ).get(original_call, original_call)\n+            call = dependency_overrides_provider.dependency_overrides.get(\n+                original_call, original_call\n+            )\n             use_path: str = sub_dependant.path  # type: ignore\n             use_sub_dependant = get_dependant(\n                 path=use_path,\n\n```\n\n```diff\n@@ -53,7 +53,7 @@\n     ResponseValidationError,\n     WebSocketRequestValidationError,\n )\n-from fastapi.types import DecoratedCallable, IncEx\n+from fastapi.types import DecoratedCallable, DependencyOverridesProvider, IncEx\n from fastapi.utils import (\n     create_model_field,\n     generate_unique_id,\n@@ -326,7 +326,7 @@ def get_request_handler(\n     response_model_exclude_unset: bool = False,\n     response_model_exclude_defaults: bool = False,\n     response_model_exclude_none: bool = False,\n-    dependency_overrides_provider: Any | None = None,\n+    dependency_overrides_provider: DependencyOverridesProvider | None = None,\n     embed_body_fields: bool = False,\n ) -> Callable[[Request], Coroutine[Any, Any, Response]]:\n     assert dependant.call is not None, \"dependant.call must be a function\"\n@@ -474,7 +474,7 @@ async def app(request: Request) -> Response:\n \n def get_websocket_app(\n     dependant: Dependant,\n-    dependency_overrides_provider: Any | None = None,\n+    dependency_overrides_provider: DependencyOverridesProvider | None = None,\n     embed_body_fields: bool = False,\n ) -> Callable[[WebSocket], Coroutine[Any, Any, Any]]:\n     async def app(websocket: WebSocket) -> None:\n@@ -517,7 +517,7 @@ def __init__(\n         *,\n         name: str | None = None,\n         dependencies: Sequence[params.Depends] | None = None,\n-        dependency_overrides_provider: Any | None = None,\n+        dependency_overrides_provider: DependencyOverridesProvider | None = None,\n     ) -> None:\n         self.path = path\n         self.endpoint = endpoint\n@@ -577,7 +577,7 @@ def __init__(\n         response_model_exclude_none: bool = False,\n         include_in_schema: bool = True,\n         response_class: type[Response] | DefaultPlaceholder = Default(JSONResponse),\n-        dependency_overrides_provider: Any | None = None,\n+        dependency_overrides_provider: DependencyOverridesProvider | None = None,\n         callbacks: list[BaseRoute] | None = None,\n         openapi_extra: dict[str, Any] | None = None,\n         generate_unique_id_function: Callable[[\"APIRoute\"], str]\n@@ -844,7 +844,7 @@ def __init__(\n             ),\n         ] = None,\n         dependency_overrides_provider: Annotated[\n-            Any | None,\n+            DependencyOverridesProvider | None,\n             Doc(\n                 \"\"\"\n                 Only used internally by FastAPI to handle dependency overrides.\n\n```\n\n```diff\n@@ -1,7 +1,7 @@\n import types\n from collections.abc import Callable\n from enum import Enum\n-from typing import Any, TypeVar, Union\n+from typing import Any, Protocol, TypeVar, Union\n \n from pydantic import BaseModel\n from pydantic.main import IncEx as IncEx\n@@ -10,3 +10,7 @@\n UnionType = getattr(types, \"UnionType\", Union)\n ModelNameMap = dict[type[BaseModel] | type[Enum], str]\n DependencyCacheKey = tuple[Callable[..., Any] | None, tuple[str, ...], str]\n+\n+\n+class DependencyOverridesProvider(Protocol):\n+    dependency_overrides: dict[Callable[..., Any], Any]\n\n```", "output": "Changes look good. This PR implements: üè∑Ô∏è Add typing for `dependency_overrides_provider` in `solve_dependencies`", "source": "pr", "type": "code_review", "pr_number": 204}
{"instruction": "Fix the following bug: üêõ Fix handling sequences with nested Annotated types", "input": "Currently on `master` branch the following code example fails on startup:\r\n\r\n```py\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Query\r\nfrom pydantic import Field\r\n\r\nMaxSizedSet = Annotated[set[str], Field(max_length=3)]\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef read_root(foo: Annotated[MaxSizedSet | None, Query()] = None):\r\n    return {\"foo\": foo}\r\n```\r\n\r\n```\r\n  File \"/home/yurii/code/fastapi/fastapi/dependencies/utils.py\", line 521, in analyze_param\r\n    is_scalar_field(field)\r\nAssertionError: Query parameter 'foo' must be one of the supported types\r\n```\r\n_(the error traceback is a bit misleading - the issue is actually not in `is_scalar_field`, but in `field_annotation_is_scalar_sequence` which is a part of the same `assert`)_\r\n\r\nThis is because `field_annotation_is_scalar_sequence` doesn't unwrap `Annotated`.\r\n\r\nWe also need to unwrap `Annotated` in `field_annotation_is_sequence` to make `_get_multidict_value` correctly recognize this parameter as sequence and extract the value using `get_list`.\r\n\r\n---\r\n\r\nSee: https://github.com/fastapi/fastapi/discussions/14852", "output": "```diff\n@@ -63,6 +63,10 @@ def _annotation_is_sequence(annotation: type[Any] | None) -> bool:\n \n def field_annotation_is_sequence(annotation: type[Any] | None) -> bool:\n     origin = get_origin(annotation)\n+\n+    if origin is Annotated:\n+        return field_annotation_is_sequence(get_args(annotation)[0])\n+\n     if origin is Union or origin is UnionType:\n         for arg in get_args(annotation):\n             if field_annotation_is_sequence(arg):\n@@ -108,6 +112,10 @@ def field_annotation_is_scalar(annotation: Any) -> bool:\n \n def field_annotation_is_scalar_sequence(annotation: type[Any] | None) -> bool:\n     origin = get_origin(annotation)\n+\n+    if origin is Annotated:\n+        return field_annotation_is_scalar_sequence(get_args(annotation)[0])\n+\n     if origin is Union or origin is UnionType:\n         at_least_one_scalar_sequence = False\n         for arg in get_args(annotation):\n\n```\n\n```diff\n@@ -0,0 +1,143 @@\n+from typing import Annotated\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[MaxSizedSet | None, Query()] = None):\n+    return {\"foo\": foo}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_endpoint_none():\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": None}\n+\n+\n+def test_endpoint_valid():\n+    response = client.get(\"/\", params={\"foo\": [\"a\", \"b\"]})\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": IsList(\"a\", \"b\", check_order=False)}\n+\n+\n+def test_endpoint_too_long():\n+    response = client.get(\"/\", params={\"foo\": [\"a\", \"b\", \"c\", \"d\"]})\n+    assert response.status_code == 422\n+    assert response.json() == snapshot(\n+        {\n+            \"detail\": [\n+                {\n+                    \"type\": \"too_long\",\n+                    \"loc\": [\"query\", \"foo\"],\n+                    \"msg\": \"Set should have at most 3 items after validation, not more\",\n+                    \"input\": IsList(\"a\", \"b\", \"c\", \"d\", check_order=False),\n+                    \"ctx\": {\n+                        \"actual_length\": None,\n+                        \"field_type\": \"Set\",\n+                        \"max_length\": 3,\n+                    },\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+def test_openapi():\n+    assert app.openapi() == snapshot(\n+        {\n+            \"components\": {\n+                \"schemas\": {\n+                    \"HTTPValidationError\": {\n+                        \"properties\": {\n+                            \"detail\": {\n+                                \"items\": {\n+                                    \"$ref\": \"#/components/schemas/ValidationError\"\n+                                },\n+                                \"title\": \"Detail\",\n+                                \"type\": \"array\",\n+                            },\n+                        },\n+                        \"title\": \"HTTPValidationError\",\n+                        \"type\": \"object\",\n+                    },\n+                    \"ValidationError\": {\n+                        \"properties\": {\n+                            \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                            \"input\": {\"title\": \"Input\"},\n+                            \"loc\": {\n+                                \"items\": {\n+                                    \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}],\n+                                },\n+                                \"title\": \"Location\",\n+                                \"type\": \"array\",\n+                            },\n+                            \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n+                            \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        },\n+   \n\n```\n\n```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Union\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[Union[MaxSizedSet, None], Query()] = None):\n\n```\n\n```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Union\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[Union[MaxSizedSet, None], Query()] = None):\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 203}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -63,6 +63,10 @@ def _annotation_is_sequence(annotation: type[Any] | None) -> bool:\n \n def field_annotation_is_sequence(annotation: type[Any] | None) -> bool:\n     origin = get_origin(annotation)\n+\n+    if origin is Annotated:\n+        return field_annotation_is_sequence(get_args(annotation)[0])\n+\n     if origin is Union or origin is UnionType:\n         for arg in get_args(annotation):\n             if field_annotation_is_sequence(arg):\n@@ -108,6 +112,10 @@ def field_annotation_is_scalar(annotation: Any) -> bool:\n \n def field_annotation_is_scalar_sequence(annotation: type[Any] | None) -> bool:\n     origin = get_origin(annotation)\n+\n+    if origin is Annotated:\n+        return field_annotation_is_scalar_sequence(get_args(annotation)[0])\n+\n     if origin is Union or origin is UnionType:\n         at_least_one_scalar_sequence = False\n         for arg in get_args(annotation):\n\n```\n\n```diff\n@@ -0,0 +1,143 @@\n+from typing import Annotated\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[MaxSizedSet | None, Query()] = None):\n+    return {\"foo\": foo}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_endpoint_none():\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": None}\n+\n+\n+def test_endpoint_valid():\n+    response = client.get(\"/\", params={\"foo\": [\"a\", \"b\"]})\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": IsList(\"a\", \"b\", check_order=False)}\n+\n+\n+def test_endpoint_too_long():\n+    response = client.get(\"/\", params={\"foo\": [\"a\", \"b\", \"c\", \"d\"]})\n+    assert response.status_code == 422\n+    assert response.json() == snapshot(\n+        {\n+            \"detail\": [\n+                {\n+                    \"type\": \"too_long\",\n+                    \"loc\": [\"query\", \"foo\"],\n+                    \"msg\": \"Set should have at most 3 items after validation, not more\",\n+                    \"input\": IsList(\"a\", \"b\", \"c\", \"d\", check_order=False),\n+                    \"ctx\": {\n+                        \"actual_length\": None,\n+                        \"field_type\": \"Set\",\n+                        \"max_length\": 3,\n+                    },\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+def test_openapi():\n+    assert app.openapi() == snapshot(\n+        {\n+            \"components\": {\n+                \"schemas\": {\n+                    \"HTTPValidationError\": {\n+                        \"properties\": {\n+                            \"detail\": {\n+                                \"items\": {\n+                                    \"$ref\": \"#/components/schemas/ValidationError\"\n+                                },\n+                                \"title\": \"Detail\",\n+                                \"type\": \"array\",\n+                            },\n+                        },\n+                        \"title\": \"HTTPValidationError\",\n+                        \"type\": \"object\",\n+                    },\n+                    \"ValidationError\": {\n+                        \"properties\": {\n+                            \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                            \"input\": {\"title\": \"Input\"},\n+                            \"loc\": {\n+                                \"items\": {\n+                                    \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}],\n+                                },\n+                                \"title\": \"Location\",\n+                                \"type\": \"array\",\n+                            },\n+                            \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n+                            \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        },\n+   \n\n```\n\n```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Union\n+\n+from dirty_equals im", "output": "Bug: üêõ Fix handling sequences with nested Annotated types\n\nCurrently on `master` branch the following code example fails on startup:\r\n\r\n```py\r\nfrom typing import Annotated\r\n\r\nfrom fastapi import FastAPI, Query\r\nfrom pydantic import Field\r\n\r\nMaxSizedSet = Annotated[set[str], Field(max_length=3)]\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef read_root(foo: Annotated[MaxSizedSet | None, Query()] = None):\r\n    return {\"foo\": foo}\r\n```\r\n\r\n```\r\n  File \"/home/yurii/code/fastapi/fastapi/dependencies/utils.py\", line 521, in analyze_param\r\n    is_scalar_field(field)\r\nAssertionError: Query parameter 'foo' must be one of the supported types\r\n```\r\n_(the error traceback is a bit misleading - the issue is actually not in `is_scalar_field`, but in `field_annotation_is_scalar_sequence` which is a part of the same `assert`)_\r\n\r\nThis is because `field_annotation_is_scalar_sequence` doesn't unwrap `Annotated`.\r\n\r\nWe also need to unwrap `Annotated` in `field_annotation_is_sequence` to make `_get_multidict_value` correctly recognize this parameter as sequence and extract the value using `get_list`.\r\n\r\n---\r\n\r\nSee: https://github.com/fastapi/fastapi/discussions/14852", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 203}
{"instruction": "Review the following code changes: üêõ Fix handling sequences with nested Annotated types", "input": "```diff\n@@ -63,6 +63,10 @@ def _annotation_is_sequence(annotation: type[Any] | None) -> bool:\n \n def field_annotation_is_sequence(annotation: type[Any] | None) -> bool:\n     origin = get_origin(annotation)\n+\n+    if origin is Annotated:\n+        return field_annotation_is_sequence(get_args(annotation)[0])\n+\n     if origin is Union or origin is UnionType:\n         for arg in get_args(annotation):\n             if field_annotation_is_sequence(arg):\n@@ -108,6 +112,10 @@ def field_annotation_is_scalar(annotation: Any) -> bool:\n \n def field_annotation_is_scalar_sequence(annotation: type[Any] | None) -> bool:\n     origin = get_origin(annotation)\n+\n+    if origin is Annotated:\n+        return field_annotation_is_scalar_sequence(get_args(annotation)[0])\n+\n     if origin is Union or origin is UnionType:\n         at_least_one_scalar_sequence = False\n         for arg in get_args(annotation):\n\n```\n\n```diff\n@@ -0,0 +1,143 @@\n+from typing import Annotated\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[MaxSizedSet | None, Query()] = None):\n+    return {\"foo\": foo}\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_endpoint_none():\n+    response = client.get(\"/\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": None}\n+\n+\n+def test_endpoint_valid():\n+    response = client.get(\"/\", params={\"foo\": [\"a\", \"b\"]})\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": IsList(\"a\", \"b\", check_order=False)}\n+\n+\n+def test_endpoint_too_long():\n+    response = client.get(\"/\", params={\"foo\": [\"a\", \"b\", \"c\", \"d\"]})\n+    assert response.status_code == 422\n+    assert response.json() == snapshot(\n+        {\n+            \"detail\": [\n+                {\n+                    \"type\": \"too_long\",\n+                    \"loc\": [\"query\", \"foo\"],\n+                    \"msg\": \"Set should have at most 3 items after validation, not more\",\n+                    \"input\": IsList(\"a\", \"b\", \"c\", \"d\", check_order=False),\n+                    \"ctx\": {\n+                        \"actual_length\": None,\n+                        \"field_type\": \"Set\",\n+                        \"max_length\": 3,\n+                    },\n+                }\n+            ]\n+        }\n+    )\n+\n+\n+def test_openapi():\n+    assert app.openapi() == snapshot(\n+        {\n+            \"components\": {\n+                \"schemas\": {\n+                    \"HTTPValidationError\": {\n+                        \"properties\": {\n+                            \"detail\": {\n+                                \"items\": {\n+                                    \"$ref\": \"#/components/schemas/ValidationError\"\n+                                },\n+                                \"title\": \"Detail\",\n+                                \"type\": \"array\",\n+                            },\n+                        },\n+                        \"title\": \"HTTPValidationError\",\n+                        \"type\": \"object\",\n+                    },\n+                    \"ValidationError\": {\n+                        \"properties\": {\n+                            \"ctx\": {\"title\": \"Context\", \"type\": \"object\"},\n+                            \"input\": {\"title\": \"Input\"},\n+                            \"loc\": {\n+                                \"items\": {\n+                                    \"anyOf\": [{\"type\": \"string\"}, {\"type\": \"integer\"}],\n+                                },\n+                                \"title\": \"Location\",\n+                                \"type\": \"array\",\n+                            },\n+                            \"msg\": {\"title\": \"Message\", \"type\": \"string\"},\n+                            \"type\": {\"title\": \"Error Type\", \"type\": \"string\"},\n+                        },\n+   \n\n```\n\n```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Union\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[Union[MaxSizedSet, None], Query()] = None):\n\n```\n\n```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Union\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[Union[MaxSizedSet, None], Query()] = None):\n\n```", "output": "Code Review for: üêõ Fix handling sequences with nested Annotated types\n\nüìù **tests/test_nested_annotated_in_sequence.py**: Why don't you use `MaxSizedSet | None`?\n\nüìù **tests/test_nested_annotated_in_sequence.py**: Because FastAPI still supports Python 3.9, but `MaxSizedSet | None` only works on Python 3.10+\n\n", "source": "pr", "type": "code_review", "pr_number": 203}
{"instruction": "Review this code change in `tests/test_nested_annotated_in_sequence.py`", "input": "```diff\n@@ -0,0 +1,136 @@\n+from typing import Annotated, Union\n+\n+from dirty_equals import IsList\n+from fastapi import FastAPI, Query\n+from fastapi.testclient import TestClient\n+from pydantic import Field\n+\n+MaxSizedSet = Annotated[set[str], Field(max_length=3)]\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/\")\n+def read_root(foo: Annotated[Union[MaxSizedSet, None], Query()] = None):\n\n```", "output": "Why don't you use `MaxSizedSet | None`?", "source": "pr_review", "type": "inline_review", "pr_number": 203}
{"instruction": "Review the following code changes: üìù Update source examples and docs from Python 3.9 to 3.10", "input": "```diff\n@@ -26,7 +26,7 @@ Each of those response `dict`s can have a key `model`, containing a Pydantic mod\n \n For example, to declare another response with a status code `404` and a Pydantic model `Message`, you can write:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note\n \n@@ -203,7 +203,7 @@ For example, you can declare a response with a status code `404` that uses a Pyd\n \n And a response with a status code `200` that uses your `response_model`, but includes a custom `example`:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n It will all be combined and included in your OpenAPI, and shown in the API docs:\n \n\n```\n\n```diff\n@@ -18,23 +18,23 @@ Not the class itself (which is already a callable), but an instance of that clas\n \n To do that, we declare a method `__call__`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n In this case, this `__call__` is what **FastAPI** will use to check for additional parameters and sub-dependencies, and this is what will be called to pass a value to the parameter in your *path operation function* later.\n \n ## Parameterize the instance { #parameterize-the-instance }\n \n And now, we can use `__init__` to declare the parameters of the instance that we can use to \"parameterize\" the dependency:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n In this case, **FastAPI** won't ever touch or care about `__init__`, we will use it directly in our code.\n \n ## Create an instance { #create-an-instance }\n \n We could create an instance of this class with:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n And that way we are able to \"parameterize\" our dependency, that now has `\"bar\"` inside of it, as the attribute `checker.fixed_content`.\n \n@@ -50,7 +50,7 @@ checker(q=\"somequery\")\n \n ...and pass whatever that returns as the value of the dependency in our *path operation function* as the parameter `fixed_content_included`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip\n \n\n```\n\n```diff\n@@ -32,11 +32,11 @@ For a simple example, let's consider a file structure similar to the one describ\n \n The file `main.py` would have:\n \n-{* ../../docs_src/async_tests/app_a_py39/main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/main.py *}\n \n The file `test_main.py` would have the tests for `main.py`, it could look like this now:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py *}\n \n ## Run it { #run-it }\n \n@@ -56,7 +56,7 @@ $ pytest\n \n The marker `@pytest.mark.anyio` tells pytest that this test function should be called asynchronously:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[7] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[7] *}\n \n /// tip\n \n@@ -66,7 +66,7 @@ Note that the test function is now `async def` instead of just `def` as before w\n \n Then we can create an `AsyncClient` with the app, and send async requests to it, using `await`.\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[9:12] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[9:12] *}\n \n This is the equivalent to:\n \n\n```\n\n```diff\n@@ -44,7 +44,7 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n For example, let's say you define a *path operation* `/items/`:\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_01_py310.py hl[6] *}\n \n If the client tries to go to `/items`, by default, it would be redirected to `/items/`.\n \n@@ -115,7 +115,7 @@ In this case, the original path `/app` would actually be served at `/api/v1/app`\n \n Even though all your code is written assuming there's just `/app`.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py310.py hl[6] *}\n \n And the proxy would be **\"stripping\"** the **path prefix** on the fly before transmitting the request to the app server (probably Uvicorn via FastAPI CLI), keeping your application convinced that it is being served at `/app`, so that you don't have to update all your code to include the prefix `/api/v1`.\n \n@@ -193,7 +193,7 @@ You can get the current `root_path` used by your application for each request, i\n \n Here we are including it in the message just for demonstration purposes.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[8] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py310.py hl[8] *}\n \n Then, if you start Uvicorn with:\n \n@@ -220,7 +220,7 @@ The response would be something li", "output": "Changes look good. This PR implements: üìù Update source examples and docs from Python 3.9 to 3.10", "source": "pr", "type": "code_review", "pr_number": 202}
{"instruction": "Review the following code changes: üìù Update highlights in webhooks docs", "input": "```diff\n@@ -32,7 +32,7 @@ Webhooks are available in OpenAPI 3.1.0 and above, supported by FastAPI `0.99.0`\n \n When you create a **FastAPI** application, there is a `webhooks` attribute that you can use to define *webhooks*, the same way you would define *path operations*, for example with `@app.webhooks.post()`.\n \n-{* ../../docs_src/openapi_webhooks/tutorial001_py310.py hl[9:13,36:53] *}\n+{* ../../docs_src/openapi_webhooks/tutorial001_py310.py hl[9:12,15:20] *}\n \n The webhooks that you define will end up in the **OpenAPI** schema and the automatic **docs UI**.\n \n\n```", "output": "Changes look good. This PR implements: üìù Update highlights in webhooks docs", "source": "pr", "type": "code_review", "pr_number": 201}
{"instruction": "Review the following code changes: üî® Update docs.py scripts to migrate Python 3.9 to Python 3.10", "input": "```diff\n@@ -8,7 +8,7 @@\n from http.server import HTTPServer, SimpleHTTPRequestHandler\n from multiprocessing import Pool\n from pathlib import Path\n-from typing import Any, Optional, Union\n+from typing import Any\n \n import mkdocs.utils\n import typer\n@@ -103,7 +103,7 @@ def get_lang_paths() -> list[Path]:\n     return sorted(docs_path.iterdir())\n \n \n-def lang_callback(lang: Optional[str]) -> Union[str, None]:\n+def lang_callback(lang: str | None) -> str | None:\n     if lang is None:\n         return None\n     lang = lang.lower()\n@@ -412,6 +412,13 @@ def langs_json():\n @app.command()\n def generate_docs_src_versions_for_file(file_path: Path) -> None:\n     target_versions = [\"py39\", \"py310\"]\n+    full_path_str = str(file_path)\n+    for target_version in target_versions:\n+        if f\"_{target_version}\" in full_path_str:\n+            logging.info(\n+                f\"Skipping {file_path}, already a version file for {target_version}\"\n+            )\n+            return\n     base_content = file_path.read_text(encoding=\"utf-8\")\n     previous_content = {base_content}\n     for target_version in target_versions:\n@@ -438,13 +445,207 @@ def generate_docs_src_versions_for_file(file_path: Path) -> None:\n         if content_format in previous_content:\n             continue\n         previous_content.add(content_format)\n-        version_file = file_path.with_name(\n-            file_path.name.replace(\".py\", f\"_{target_version}.py\")\n-        )\n+        # Determine where the version label should go: in the parent directory\n+        # name or in the file name, matching the source structure.\n+        label_in_parent = False\n+        for v in target_versions:\n+            if f\"_{v}\" in file_path.parent.name:\n+                label_in_parent = True\n+                break\n+        if label_in_parent:\n+            parent_name = file_path.parent.name\n+            for v in target_versions:\n+                parent_name = parent_name.replace(f\"_{v}\", \"\")\n+            new_parent = file_path.parent.parent / f\"{parent_name}_{target_version}\"\n+            new_parent.mkdir(parents=True, exist_ok=True)\n+            version_file = new_parent / file_path.name\n+        else:\n+            base_name = file_path.stem\n+            for v in target_versions:\n+                if base_name.endswith(f\"_{v}\"):\n+                    base_name = base_name[: -len(f\"_{v}\")]\n+                    break\n+            version_file = file_path.with_name(f\"{base_name}_{target_version}.py\")\n         logging.info(f\"Writing to {version_file}\")\n         version_file.write_text(content_format, encoding=\"utf-8\")\n \n \n+@app.command()\n+def generate_docs_src_versions() -> None:\n+    \"\"\"\n+    Generate Python version-specific files for all .py files in docs_src.\n+    \"\"\"\n+    docs_src_path = Path(\"docs_src\")\n+    for py_file in sorted(docs_src_path.rglob(\"*.py\")):\n+        generate_docs_src_versions_for_file(py_file)\n+\n+\n+@app.command()\n+def copy_py39_to_py310() -> None:\n+    \"\"\"\n+    For each docs_src file/directory with a _py39 lab\n\n```", "output": "Changes look good. This PR implements: üî® Update docs.py scripts to migrate Python 3.9 to Python 3.10", "source": "pr", "type": "code_review", "pr_number": 200}
{"instruction": "Review the following code changes: üìù Clarify misleading \"Required, can be `None`\" section in `query-params-str-validations.md`", "input": "```diff\n@@ -222,11 +222,22 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n ### Required, can be `None` { #required-can-be-none }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n+You might want to declare a parameter that can accept `None` but is still required.\n \n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+However, because of how **HTTP query parameters** work, clients can not actually send a real `None` (or `null`) value - query parameters are always sent as **strings**.\n+That means you cannot truly have a *required* parameter that also allows a real `None` value.\n \n-{* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n+For example, you might try:\n+\n+\n```\n\n```diff\n@@ -1,12 +1,21 @@\n from typing import Annotated\n \n from fastapi import FastAPI, Query\n+from pydantic import BeforeValidator\n \n app = FastAPI()\n \n \n+def nullable_str(val: str) -> str | None:\n+    if val in (\"None\", \"\", \"null\"):\n+        return None\n+    return val\n+\n+\n @app.get(\"/items/\")\n-async def read_items(q: Annotated[str | None, Query(min_length=3)]):\n+async def read_items(\n+    q: Annotated[str | None, Query(min_length=3), BeforeValidator(nullable_str)],\n+):\n     results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n     if q:\n         results.update({\"q\": q})\n\n```\n\n```diff\n@@ -1,11 +0,0 @@\n-from fastapi import FastAPI, Query\n-\n-app = FastAPI()\n-\n-\n-@app.get(\"/items/\")\n-async def read_items(q: str | None = Query(min_length=3)):\n-    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n-    if q:\n-        results.update({\"q\": q})\n-    return results\n\n```\n\n```diff\n@@ -4,14 +4,11 @@\n from fastapi.testclient import TestClient\n from inline_snapshot import snapshot\n \n-from ...utils import needs_py310\n-\n \n @pytest.fixture(\n     name=\"client\",\n     params=[\n-        pytest.param(\"tutorial006c_py310\", marks=needs_py310),\n-        pytest.param(\"tutorial006c_an_py310\", marks=needs_py310),\n+        \"tutorial006c_an_py310\",\n     ],\n )\n def get_client(request: pytest.FixtureRequest):\n@@ -22,24 +19,28 @@ def get_client(request: pytest.FixtureRequest):\n     return client\n \n \n-@pytest.mark.xfail(\n-    reason=\"Code example is not valid. See https://github.com/fastapi/fastapi/issues/12419\"\n-)\n def test_query_params_str_validations_no_query(client: TestClient):\n     response = client.get(\"/items/\")\n-    assert response.status_code == 200\n-    assert response.json() == {  # pragma: no cover\n-        \"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}],\n+    assert response.status_code == 422\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"query\", \"q\"],\n+                \"msg\": \"Field required\",\n+                \"input\": None,\n+            }\n+        ]\n     }\n \n \n-@pytest.mark.xfail(\n-    reason=\"Code example is not valid. See https://github.com/fastapi/fastapi/issues/12419\"\n-)\n-def test_query_params_str_validations_empty_str(client: TestClient):\n-    response = client.get(\"/items/?q=\")\n+@pytest.mark.parametrize(\"q_value\", [\"None\", \"null\", \"\"])\n+def test_query_params_str_validations_send_explicit_none(\n+    client: TestClient, q_value: str\n+):\n+    response = client.get(\"/items/\", params={\"q\": q_value})\n     assert response.status_code == 200\n-    assert response.json() == {  # pragma: no cover\n+    assert response.json() == {\n         \"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}],\n     }\n \n\n```\n\n```diff\n@@ -0,0 +1,10 @@\n+from fastapi import FastAPI, Query\n+from typing import Annotated\n+\n+app = FastAPI()\n+\n+@app.get(\"/items/\")\n+async def read_items(q: Annotated[str | None, Query()] = ...):\n\n```", "output": "Code Review for: üìù Clarify misleading \"Required, can be `None`\" section in `query-params-str-validations.md`\n\nüìù **docs_src/query_params_str_validations/tutorial006d_an_py310.py**: ```suggestion\r\nasync def read_items(q: Annotated[str | None, Query()]):\r\n```\r\nEllipsis is not needed here\n\nüìù **docs/en/docs/tutorial/query-params-str-validations.md**: ```suggestion\r\nBut this will still expect a **string** value, and if the client omits `q` or tries to send `q=None`, FastAPI will raise a request validation error.\r\n```\n\nüìù **docs_src/query_params_str_validations/tutorial006d_an_py310.py**: Another thing is that this code changes `Query(min_length=3)` that is mentioned earlier to just `Query()`.\r\nWe should update previous code\r\n````\r\n```Python\r\nq: Annotated[str | None, Query(min_length=3)] = ...\r\n```\r\n````\r\nto\r\n````\r\n```Python\r\nq: Annotated[str | None, Query()]\r\n```\r\n````\r\nFor consistency.\r\n\r\nAnd then we can add something like \"Stop, but what about `min_length=3`?\" and introduce alternative approach with `BeforeValidator` that we can use **with Pydantic V2**:\r\n\r\n```py\r\n\r\n...\r\nfrom pydantic import BeforeValidator\r\n\r\ndef nullable_str(val: str) -> Union[str, None]:\r\n    if val in (\"None\", \"\", \"null\"):\r\n        return None\r\n    return val\r\n\r\nasync def read_items(q: Annotated[str | None, Query(min_length=3), BeforeValidator(nullable_str)]):\r\n    return {\"q\": q}\r\n```\r\n(I haven't checked the code example, but should work)\n\nüìù **tests/test_tutorial/test_query_params_str_validations/test_tutorial006d_an_py310.py**: We should parameterize this test to pass all possible values: `(\"None\", \"\", \"null\")`, not just `\"None\"`.\r\nAnd, I think we should add test with not-null parameter value\r\n\nüìù **docs/en/docs/tutorial/query-params-str-validations.md**: ```suggestion\r\n{* ../../docs_src/query_params_str_validations/tutorial006d_an_py310.py hl[9:11] *}\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 199}
{"instruction": "Review this code change in `docs_src/query_params_str_validations/tutorial006d_an_py310.py`", "input": "```diff\n@@ -0,0 +1,10 @@\n+from fastapi import FastAPI, Query\n+from typing import Annotated\n+\n+app = FastAPI()\n+\n+@app.get(\"/items/\")\n+async def read_items(q: Annotated[str | None, Query()] = ...):\n\n```", "output": "```suggestion\r\nasync def read_items(q: Annotated[str | None, Query()]):\r\n```\r\nEllipsis is not needed here", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `docs/en/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -271,23 +271,12 @@ For example, you might try:\n q: Annotated[str | None, Query(min_length=3)] = ...\n ```\n \n-But this will still expect a string value, and if the client omits q or tries to send q=None, FastAPI will raise a validation error.\n-In other words, None is not an acceptable runtime value for query parameters ‚Äî only strings are.\n+But this will still expect a **string** value, and if the client omits `q` or tries to send `q=None`, FastAPI will raise a validation error.  \n\n```", "output": "```suggestion\r\nBut this will still expect a **string** value, and if the client omits `q` or tries to send `q=None`, FastAPI will raise a request validation error.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `tests/test_tutorial/test_query_params_str_validations/test_tutorial006d_an_py310.py`", "input": "```diff\n@@ -0,0 +1,9 @@\n+from fastapi.testclient import TestClient\n+from docs_src.query_params_str_validations.tutorial006d_an_py310 import app\n+\n+client = TestClient(app)\n+\n+def test_read_items():\n+    response = client.get(\"/items/\", params={\"q\": \"None\"})\n\n```", "output": "We should parameterize this test to pass all possible values: `(\"None\", \"\", \"null\")`, not just `\"None\"`.\r\nAnd, I think we should add test with not-null parameter value\r", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `docs_src/query_params_str_validations/tutorial006d_an_py310.py`", "input": "```diff\n@@ -0,0 +1,19 @@\n+from typing import Annotated, Optional, Union\n\n```", "output": "```suggestion\r\nfrom typing import Optional, Union\r\nfrom typing_extensions import Annotated\r\n```\r\n\r\nOtherwise it fails for Python 3.8", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `tests/test_tutorial/test_query_params_str_validations/test_tutorial006d_an_py310.py`", "input": "```diff\n@@ -0,0 +1,21 @@\n+import pytest\n+from fastapi.testclient import TestClient\n+\n+from docs_src.query_params_str_validations.tutorial006d_an_py310 import app\n+\n+client = TestClient(app)\n\n```", "output": "We can't import it like this because this way tests will fail in the environment with Pydantic v1.\r\nWe should create a fixture like his:\r\n```py\r\n@pytest.fixture\r\ndef client():\r\n    from docs_src.query_params_str_validations.tutorial006d_an_py310 import app\r\n    yield TestClient(app)\r\n```\r\n\r\nAnd use it in `test_read_items`.\r\nWe should also mark `test_read_items` with `@needs_pydanticv2` to skip that test for env with Pydantic v1:\r\n\r\n\r\n```\r\nfrom .utils import needs_pydanticv2\r\n\r\n...\r\n@needs_pydanticv2\r\ndef test_read_items(q_value, expected, client: TestClient):\r\n    ...\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `docs/en/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -260,11 +260,25 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n ### Required, can be `None` { #required-can-be-none }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n+You might want to declare that a parameter can accept `None`, but is still required.\n \n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+However, because of how **HTTP query parameters** work, clients cannot actually send a real `None` (or `null`) value ‚Äî query parameters are always sent as **strings**.\n+That means you cannot truly have a *required* parameter that also allows a real `None` value.\n \n-{* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n+For example, you might try:\n+\n+```Python\n+q: Annotated[str | None, Query(min_length=3)] = ...\n+```\n+\n+But this will still expect a **string** value, and if the client omits `q` or tries to send `q=None`, FastAPI will raise a **request validation error**.\n+In other words, `None` is not an acceptable runtime value for query parameters ‚Äî only strings are.\n+\n+If you want to accept special values (like `\"None\"` or an empty string) and interpret them as `None` in your application, you can handle them manually in your function:\n+\n+{* ../../docs_src/query_params_str_validations/tutorial006d_an_py310.py hl[9,11] *}\n+\n+> **Note**: This example uses `BeforeValidator`, which is only available in **Pydantic v2**.\n\n```", "output": "```suggestion\r\n/// note\r\n\r\nThis example uses `BeforeValidator`, which is only available in **Pydantic v2**.\r\n\r\n///\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `docs/en/docs/tutorial/query-params-str-validations.md`", "input": "```diff\n@@ -260,11 +260,29 @@ So, when you need to declare a value as required while using `Query`, you can si\n \n ### Required, can be `None` { #required-can-be-none }\n \n-You can declare that a parameter can accept `None`, but that it's still required. This would force clients to send a value, even if the value is `None`.\n+You might want to declare that a parameter can accept `None`, but is still required.\n \n-To do that, you can declare that `None` is a valid type but simply do not declare a default value:\n+However, because of how **HTTP query parameters** work, clients cannot actually send a real `None` (or `null`) value ‚Äî query parameters are always sent as **strings**.\n+That means you cannot truly have a *required* parameter that also allows a real `None` value.\n \n-{* ../../docs_src/query_params_str_validations/tutorial006c_an_py310.py hl[9] *}\n+For example, you might try:\n+\n+```Python\n+q: Annotated[str | None, Query(min_length=3)] = ...\n+```\n+\n+But this will still expect a **string** value, and if the client omits `q` or tries to send `q=None`, FastAPI will raise a **request validation error**.\n+In other words, `None` is not an acceptable runtime value for query parameters ‚Äî only strings are.\n+\n+If you want to accept special values (like `\"None\"` or an empty string) and interpret them as `None` in your application, you can handle them manually in your function:\n+\n+{* ../../docs_src/query_params_str_validations/tutorial006d_an_py310.py hl[9:13 18] *}\n\n```", "output": "```suggestion\r\n{* ../../docs_src/query_params_str_validations/tutorial006d_an_py310.py hl[9:13,18] *}\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Review this code change in `tests/test_tutorial/test_query_params_str_validations/test_tutorial006c.py`", "input": "```diff\n@@ -23,24 +21,28 @@ def get_client(request: pytest.FixtureRequest):\n     return client\n \n \n-@pytest.mark.xfail(\n-    reason=\"Code example is not valid. See https://github.com/fastapi/fastapi/issues/12419\"\n-)\n def test_query_params_str_validations_no_query(client: TestClient):\n     response = client.get(\"/items/\")\n-    assert response.status_code == 200\n-    assert response.json() == {  # pragma: no cover\n-        \"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}],\n+    assert response.status_code == 422\n+    assert response.json() == {\n+        \"detail\": [\n+            {\n+                \"type\": \"missing\",\n+                \"loc\": [\"query\", \"q\"],\n+                \"msg\": \"Field required\",\n+                \"input\": None,\n+            }\n+        ]\n     }\n \n \n-@pytest.mark.xfail(\n-    reason=\"Code example is not valid. See https://github.com/fastapi/fastapi/issues/12419\"\n-)\n-def test_query_params_str_validations_empty_str(client: TestClient):\n-    response = client.get(\"/items/?q=\")\n+@pytest.mark.parametrize(\"q_value\", [\"None\", \"null\", \"\"])\n+def test_query_params_str_validations_send_explicit_none(\n\n```", "output": "The test function name 'send_explicit_none' is somewhat misleading because it tests three different string values (\"None\", \"null\", and \"\"), not just \"None\". Consider renaming to something like 'test_query_params_str_validations_send_none_like_strings' or 'test_query_params_str_validations_nullable_strings' to better reflect what the test covers.\n```suggestion\ndef test_query_params_str_validations_send_none_like_strings(\n```", "source": "pr_review", "type": "inline_review", "pr_number": 199}
{"instruction": "Fix the following bug: üêõ Fix handling of empty value for `byte` file list parameter", "input": "Fixes https://github.com/tiangolo/fastapi/discussions/9364\r\n\r\nIt appears that the value list extracted from the `FormData` is not necessarily composed of only `UploadFile` instances.\r\n\r\nOP said that it was happening when using the Swagger UI, I haven't tested without. ~~Let me know if you'd like a test for this issue.~~ seems to be required for coverage, I'll take a deeper look", "output": "```diff\n@@ -900,7 +900,10 @@ async def _extract_form_body(\n             assert isinstance(value, sequence_types)\n             results: list[bytes | str] = []\n             for sub_value in value:\n-                results.append(await sub_value.read())\n+                if isinstance(sub_value, UploadFile):\n+                    results.append(await sub_value.read())\n+                else:\n+                    results.append(sub_value)\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n             values[get_validation_alias(field)] = value\n\n```\n\n```diff\n@@ -1,13 +1,11 @@\n-from typing import Optional\n-\n from fastapi import FastAPI, File\n from fastapi.testclient import TestClient\n \n app = FastAPI()\n \n \n @app.post(\"/files\")\n-async def upload_files(files: Optional[list[bytes]] = File(None)):\n+async def upload_files(files: list[bytes] | None = File(None)):\n     if files is None:\n         return {\"files_count\": 0}\n     return {\"files_count\": len(files), \"sizes\": [len(f) for f in files]}\n@@ -28,3 +26,13 @@ def test_optional_bytes_list_no_files():\n     response = client.post(\"/files\")\n     assert response.status_code == 200\n     assert response.json() == {\"files_count\": 0}\n+\n+\n+def test_optional_bytes_list_send_empty_str():\n+    client = TestClient(app)\n+    response = client.post(\n+        \"/files\",\n+        data={\"files\": \"\"},\n+    )\n+    assert response.status_code == 200\n+    assert response.json() == {\"files_count\": 1, \"sizes\": [0]}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 198}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -900,7 +900,10 @@ async def _extract_form_body(\n             assert isinstance(value, sequence_types)\n             results: list[bytes | str] = []\n             for sub_value in value:\n-                results.append(await sub_value.read())\n+                if isinstance(sub_value, UploadFile):\n+                    results.append(await sub_value.read())\n+                else:\n+                    results.append(sub_value)\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n             values[get_validation_alias(field)] = value\n\n```\n\n```diff\n@@ -1,13 +1,11 @@\n-from typing import Optional\n-\n from fastapi import FastAPI, File\n from fastapi.testclient import TestClient\n \n app = FastAPI()\n \n \n @app.post(\"/files\")\n-async def upload_files(files: Optional[list[bytes]] = File(None)):\n+async def upload_files(files: list[bytes] | None = File(None)):\n     if files is None:\n         return {\"files_count\": 0}\n     return {\"files_count\": len(files), \"sizes\": [len(f) for f in files]}\n@@ -28,3 +26,13 @@ def test_optional_bytes_list_no_files():\n     response = client.post(\"/files\")\n     assert response.status_code == 200\n     assert response.json() == {\"files_count\": 0}\n+\n+\n+def test_optional_bytes_list_send_empty_str():\n+    client = TestClient(app)\n+    response = client.post(\n+        \"/files\",\n+        data={\"files\": \"\"},\n+    )\n+    assert response.status_code == 200\n+    assert response.json() == {\"files_count\": 1, \"sizes\": [0]}\n\n```", "output": "Bug: üêõ Fix handling of empty value for `byte` file list parameter\n\nFixes https://github.com/tiangolo/fastapi/discussions/9364\r\n\r\nIt appears that the value list extracted from the `FormData` is not necessarily composed of only `UploadFile` instances.\r\n\r\nOP said that it was happening when using the Swagger UI, I haven't tested without. ~~Let me know if you'd like a test for this issue.~~ seems to be required for coverage, I'll take a deeper look", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 198}
{"instruction": "Review the following code changes: üêõ Fix handling of empty value for `byte` file list parameter", "input": "```diff\n@@ -900,7 +900,10 @@ async def _extract_form_body(\n             assert isinstance(value, sequence_types)\n             results: list[bytes | str] = []\n             for sub_value in value:\n-                results.append(await sub_value.read())\n+                if isinstance(sub_value, UploadFile):\n+                    results.append(await sub_value.read())\n+                else:\n+                    results.append(sub_value)\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n             values[get_validation_alias(field)] = value\n\n```\n\n```diff\n@@ -1,13 +1,11 @@\n-from typing import Optional\n-\n from fastapi import FastAPI, File\n from fastapi.testclient import TestClient\n \n app = FastAPI()\n \n \n @app.post(\"/files\")\n-async def upload_files(files: Optional[list[bytes]] = File(None)):\n+async def upload_files(files: list[bytes] | None = File(None)):\n     if files is None:\n         return {\"files_count\": 0}\n     return {\"files_count\": len(files), \"sizes\": [len(f) for f in files]}\n@@ -28,3 +26,13 @@ def test_optional_bytes_list_no_files():\n     response = client.post(\"/files\")\n     assert response.status_code == 200\n     assert response.json() == {\"files_count\": 0}\n+\n+\n+def test_optional_bytes_list_send_empty_str():\n+    client = TestClient(app)\n+    response = client.post(\n+        \"/files\",\n+        data={\"files\": \"\"},\n+    )\n+    assert response.status_code == 200\n+    assert response.json() == {\"files_count\": 1, \"sizes\": [0]}\n\n```", "output": "Changes look good. This PR implements: üêõ Fix handling of empty value for `byte` file list parameter", "source": "pr", "type": "code_review", "pr_number": 198}
{"instruction": "Review the following code changes: üìù Update docs for JWT to prevent timing attacks", "input": "```diff\n@@ -116,7 +116,11 @@ And another utility to verify if a received password matches the hash stored.\n \n And another one to authenticate and return a user.\n \n-{* ../../docs_src/security/tutorial004_an_py310.py hl[8,49,56:57,60:61,70:76] *}\n+{* ../../docs_src/security/tutorial004_an_py310.py hl[8,49,51,58:59,62:63,72:79] *}\n+\n+When `authenticate_user` is called with a username that doesn't exist in the database, we still run `verify_password` against a dummy hash.\n+\n+This ensures the endpoint takes roughly the same amount of time to respond whether the username is valid or not, preventing **timing attacks** that could be used to enumerate existing usernames.\n \n /// note\n \n@@ -152,7 +156,7 @@ Define a Pydantic Model that will be used in the token endpoint for the response\n \n Create a utility function to generate a new access token.\n \n-{* ../../docs_src/security/tutorial004_an_py310.py hl[4,7,13:15,29:31,79:87] *}\n+{* ../../docs_src/security/tutorial004_an_py310.py hl[4,7,13:15,29:31,82:90] *}\n \n ## Update the dependencies { #update-the-dependencies }\n \n@@ -162,15 +166,15 @@ Decode the received token, verify it, and return the current user.\n \n If the token is invalid, return an HTTP error right away.\n \n-{* ../../docs_src/security/tutorial004_an_py310.py hl[90:107] *}\n+{* ../../docs_src/security/tutorial004_an_py310.py hl[93:110] *}\n \n ## Update the `/token` *path operation* { #update-the-token-path-operation }\n \n Create a `timedelta` with the expiration time of the token.\n \n Create a real JWT access token and return it.\n \n-{* ../../docs_src/security/tutorial004_an_py310.py hl[118:133] *}\n+{* ../../docs_src/security/tutorial004_an_py310.py hl[121:136] *}\n \n ### Technical details about the JWT \"subject\" `sub` { #technical-details-about-the-jwt-subject-sub }\n \n\n```\n\n```diff\n@@ -48,6 +48,8 @@ class UserInDB(User):\n \n password_hash = PasswordHash.recommended()\n \n+DUMMY_HASH = password_hash.hash(\"dummypassword\")\n+\n oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n \n app = FastAPI()\n@@ -70,6 +72,7 @@ def get_user(db, username: str):\n def authenticate_user(fake_db, username: str, password: str):\n     user = get_user(fake_db, username)\n     if not user:\n+        verify_password(password, DUMMY_HASH)\n         return False\n     if not verify_password(password, user.hashed_password):\n         return False\n\n```\n\n```diff\n@@ -47,6 +47,8 @@ class UserInDB(User):\n \n password_hash = PasswordHash.recommended()\n \n+DUMMY_HASH = password_hash.hash(\"dummypassword\")\n+\n oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n \n app = FastAPI()\n@@ -69,6 +71,7 @@ def get_user(db, username: str):\n def authenticate_user(fake_db, username: str, password: str):\n     user = get_user(fake_db, username)\n     if not user:\n+        verify_password(password, DUMMY_HASH)\n         return False\n     if not verify_password(password, user.hashed_password):\n         return False\n\n```\n\n```diff\n@@ -60,6 +60,8 @@ class UserInDB(User):\n \n password_hash = PasswordHash.recommended()\n \n+DUMMY_HASH = password_hash.hash(\"dummypassword\")\n+\n oauth2_scheme = OAuth2PasswordBearer(\n     tokenUrl=\"token\",\n     scopes={\"me\": \"Read information about the current user.\", \"items\": \"Read items.\"},\n@@ -85,6 +87,7 @@ def get_user(db, username: str):\n def authenticate_user(fake_db, username: str, password: str):\n     user = get_user(fake_db, username)\n     if not user:\n+        verify_password(password, DUMMY_HASH)\n         return False\n     if not verify_password(password, user.hashed_password):\n         return False\n\n```\n\n```diff\n@@ -59,6 +59,8 @@ class UserInDB(User):\n \n password_hash = PasswordHash.recommended()\n \n+DUMMY_HASH = password_hash.hash(\"dummypassword\")\n+\n oauth2_scheme = OAuth2PasswordBearer(\n     tokenUrl=\"token\",\n     scopes={\"me\": \"Read information about the current user.\", \"items\": \"Read items.\"},\n@@ -84,6 +86,7 @@ def get_user(db, username: str):\n def authenticate_user(fake_db, username: str, password: str):\n     user = get_user(fake_db, username)\n     if not user:\n+        verify_password(password, DUMMY_HASH)\n         return False\n     if not verify_password(password, user.hashed_password):\n         return False\n\n```", "output": "Changes look good. This PR implements: üìù Update docs for JWT to prevent timing attacks", "source": "pr", "type": "code_review", "pr_number": 197}
{"instruction": "Review the following code changes: üåê Update translations for ru (update-outdated)", "input": "```diff\n@@ -26,7 +26,7 @@\n \n –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –æ–±—ä—è–≤–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–æ–º `404` –∏ Pydantic-–º–æ–¥–µ–ª—å—é `Message`, –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ\n \n@@ -203,7 +203,7 @@\n \n –ê —Ç–∞–∫–∂–µ –æ—Ç–≤–µ—Ç —Å–æ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–æ–º `200`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞—à `response_model`, –Ω–æ –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π `example`:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n –í—Å—ë —ç—Ç–æ –±—É–¥–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ –∏ –≤–∫–ª—é—á–µ–Ω–æ –≤ –≤–∞—à OpenAPI –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API:\n \n\n```\n\n```diff\n@@ -18,23 +18,23 @@\n \n –î–ª—è —ç—Ç–æ–≥–æ –æ–±—ä—è–≤–ª—è–µ–º –º–µ—Ç–æ–¥ `__call__`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –∏–º–µ–Ω–Ω–æ `__call__` **FastAPI** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø–æ–¥–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∏ –∏–º–µ–Ω–Ω–æ –æ–Ω –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω, —á—Ç–æ–±—ã –ø–æ–∑–∂–µ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—É –≤ –≤–∞—à–µ–π *—Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –ø—É—Ç–∏*.\n \n ## –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä { #parameterize-the-instance }\n \n –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `__init__`, —á—Ç–æ–±—ã –æ–±—ä—è–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–∫–∑–µ–º–ø–ª—è—Ä–∞, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ–º ¬´–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞—Ç—å¬ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ **FastAPI** –≤–æ–≤—Å–µ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç `__init__` –∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–µ–≥–æ ‚Äî –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –Ω–∞–ø—Ä—è–º—É—é –≤ –Ω–∞—à–µ–º –∫–æ–¥–µ.\n \n ## –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä { #create-an-instance }\n \n –ú—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —Ç–∞–∫:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n –¢–∞–∫ –º—ã ¬´–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ–º¬ª –Ω–∞—à—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: —Ç–µ–ø–µ—Ä—å –≤–Ω—É—Ç—Ä–∏ –Ω–µ—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è \"bar\" –≤ –∞—Ç—Ä–∏–±—É—Ç–µ `checker.fixed_content`.\n \n@@ -50,7 +50,7 @@ checker(q=\"somequery\")\n \n ‚Ä¶–∏ –ø–µ—Ä–µ–¥–∞—Å—Ç –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `fixed_content_included` –Ω–∞—à–µ–π *—Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—É—Ç–∏*:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip | –°–æ–≤–µ—Ç\n \n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+# –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–∏–ø—ã Python { #advanced-python-types }\n+\n+–ù–∏–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–∏–ø–∞–º–∏ Python.\n+\n+## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Union` –∏–ª–∏ `Optional` { #using-union-or-optional }\n+\n+–ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –≤–∞—à –∫–æ–¥ –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `|`, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–æ–≤, –∞ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `response_model=`, –≤–º–µ—Å—Ç–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π —á–µ—Ä—Ç—ã (`|`) –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Union` –∏–∑ `typing`.\n+\n+–ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—ä—è–≤–∏—Ç—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `str` –∏–ª–∏ `None`:\n+\n+\n```\n\n```diff\n@@ -32,11 +32,11 @@\n \n –§–∞–π–ª `main.py`:\n \n-{* ../../docs_src/async_tests/app_a_py39/main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/main.py *}\n \n –§–∞–π–ª `test_main.py` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç—ã –¥–ª—è `main.py`, —Ç–µ–ø–µ—Ä—å –æ–Ω –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py *}\n \n ## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ { #run-it }\n \n@@ -56,7 +56,7 @@ $ pytest\n \n –ú–∞—Ä–∫–µ—Ä `@pytest.mark.anyio` –≥–æ–≤–æ—Ä–∏—Ç pytest, —á—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[7] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[7] *}\n \n /// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞\n \n@@ -66,7 +66,7 @@ $ pytest\n \n –ó–∞—Ç–µ–º –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å `AsyncClient` —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ—Å—ã–ª–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—è `await`.\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[9:12] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[9:12] *}\n \n –≠—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ —Å–ª–µ–¥—É—é—â–µ–º—É:\n \n@@ -94,6 +94,6 @@ response = client.get('/')\n \n /// tip | –ü–æ–¥—Å–∫–∞–∑–∫–∞\n \n-–ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å `RuntimeError: Task attached to a different loop` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ <a href=\"https://stackoverflow.com/questions/41584243/runtimeerror-task-attached-to-a-different-loop\" class=\"external-link\" target=\"_blank\">MongoDB's MotorClient</a>), —Ç–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–µ–Ω —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π (event loop), —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `'@app.on_event(\"startup\")` callback.\n+–ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å `RuntimeError: Task attached to a different loop` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ <a href=\"https://stackoverflow.com/questions/41584243/runtimeerror-task-attached-to-a-different-loop\" class=\"external-link\" target=\"_blank\">MongoDB's MotorClient</a>), —Ç–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–µ–Ω —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π (event loop), —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `@app.on_event(\"startup\")` callback.\n \n ///\n\n```\n\n```diff\n@@ -44,7 +44,7 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –æ–±—ä—è–≤–∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—é –ø—É—Ç–∏ `/items/`:\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6]", "output": "Changes look good. This PR implements: üåê Update translations for ru (update-outdated)", "source": "pr", "type": "code_review", "pr_number": 196}
{"instruction": "Review the following code changes: ‚¨Ü Bump pillow from 12.1.0 to 12.1.1", "input": "```diff\n@@ -3511,100 +3511,100 @@ wheels = [\n \n [[package]]\n name = \"pillow\"\n-version = \"12.1.0\"\n-source = { registry = \"https://pypi.org/simple\" }\n-sdist = { url = \"https://files.pythonhosted.org/packages/d0/02/d52c733a2452ef1ffcc123b68e6606d07276b0e358db70eabad7e40042b7/pillow-12.1.0.tar.gz\", hash = \"sha256:5c5ae0a06e9ea030ab786b0251b32c7e4ce10e58d983c0d5c56029455180b5b9\", size = 46977283, upload-time = \"2026-01-02T09:13:29.892Z\" }\n-wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/fe/41/f73d92b6b883a579e79600d391f2e21cb0df767b2714ecbd2952315dfeef/pillow-12.1.0-cp310-cp310-macosx_10_10_x86_64.whl\", hash = \"sha256:fb125d860738a09d363a88daa0f59c4533529a90e564785e20fe875b200b6dbd\", size = 5304089, upload-time = \"2026-01-02T09:10:24.953Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/94/55/7aca2891560188656e4a91ed9adba305e914a4496800da6b5c0a15f09edf/pillow-12.1.0-cp310-cp310-macosx_11_0_arm64.whl\", hash = \"sha256:cad302dc10fac357d3467a74a9561c90609768a6f73a1923b0fd851b6486f8b0\", size = 4657815, upload-time = \"2026-01-02T09:10:27.063Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/e9/d2/b28221abaa7b4c40b7dba948f0f6a708bd7342c4d47ce342f0ea39643974/pillow-12.1.0-cp310-cp310-manylinux2014_aarch64.manylinux_2_17_aarch64.whl\", hash = \"sha256:a40905599d8079e09f25027423aed94f2823adaf2868940de991e53a449e14a8\", size = 6222593, upload-time = \"2026-01-02T09:10:29.115Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/71/b8/7a61fb234df6a9b0b479f69e66901209d89ff72a435b49933f9122f94cac/pillow-12.1.0-cp310-cp310-manylinux2014_x86_64.manylinux_2_17_x86_64.whl\", hash = \"sha256:92a7fe4225365c5e3a8e598982269c6d6698d3e783b3b1ae979e7819f9cd55c1\", size = 8027579, upload-time = \"2026-01-02T09:10:31.182Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/ea/51/55c751a57cc524a15a0e3db20e5cde517582359508d62305a627e77fd295/pillow-12.1.0-cp310-cp310-manylinux_2_27_aarch64.manylinux_2_28_aarch64.whl\", hash = \"sha256:f10c98f49227ed8383d28174ee95155a675c4ed7f85e2e573b04414f7e371bda\", size = 6335760, upload-time = \"2026-01-02T09:10:33.02Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/dc/7c/60e3e6f5e5891a1a06b4c910f742ac862377a6fe842f7184df4a274ce7bf/pillow-12.1.0-cp310-cp310-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl\", hash = \"sha256:8637e29d13f478bc4f153d8daa9ffb16455f0a6cb287da1b432fdad2bfbd66c7\", size = 7027127, upload-time = \"2026-01-02T09:10:35.009Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/06/37/49d47266ba50b00c27ba63a7c898f1bb41a29627ced8c09e25f19ebec0ff/pillow-12.1.0-cp310-cp310-musllinux_1_2_aarch64.whl\", hash = \"sha256:21e686a21078b0f9cb8c8a961d99e6a4ddb88e0fc5ea6e130172ddddc2e5221a\", size = 6449896, upload-time = \"2026-01-02T09:10:36.793Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/f9/e5/67fd87d2913902462cd9b79c6211c25bfe95fcf5783d06e1367d6d9a741f/pillow-12.1.0-cp310-cp310-musllinux_1_2_x86_64.whl\", hash = \"sha256:2415373395a831f53933c23ce051021e79c8cd7979822d8cc478547a3f4da8ef\", \n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump pillow from 12.1.0 to 12.1.1", "source": "pr", "type": "code_review", "pr_number": 195}
{"instruction": "Review the following code changes: ‚¨Ü Bump cryptography from 46.0.4 to 46.0.5", "input": "```diff\n@@ -843,62 +843,62 @@ wheels = [\n \n [[package]]\n name = \"cryptography\"\n-version = \"46.0.4\"\n+version = \"46.0.5\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"cffi\", marker = \"platform_python_implementation != 'PyPy'\" },\n     { name = \"typing-extensions\", marker = \"python_full_version < '3.11'\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/78/19/f748958276519adf6a0c1e79e7b8860b4830dda55ccdf29f2719b5fc499c/cryptography-46.0.4.tar.gz\", hash = \"sha256:bfd019f60f8abc2ed1b9be4ddc21cfef059c841d86d710bb69909a688cbb8f59\", size = 749301, upload-time = \"2026-01-28T00:24:37.379Z\" }\n-wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/8d/99/157aae7949a5f30d51fcb1a9851e8ebd5c74bf99b5285d8bb4b8b9ee641e/cryptography-46.0.4-cp311-abi3-macosx_10_9_universal2.whl\", hash = \"sha256:281526e865ed4166009e235afadf3a4c4cba6056f99336a99efba65336fd5485\", size = 7173686, upload-time = \"2026-01-28T00:23:07.515Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/87/91/874b8910903159043b5c6a123b7e79c4559ddd1896e38967567942635778/cryptography-46.0.4-cp311-abi3-manylinux2014_aarch64.manylinux_2_17_aarch64.whl\", hash = \"sha256:5f14fba5bf6f4390d7ff8f086c566454bff0411f6d8aa7af79c88b6f9267aecc\", size = 4275871, upload-time = \"2026-01-28T00:23:09.439Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/c0/35/690e809be77896111f5b195ede56e4b4ed0435b428c2f2b6d35046fbb5e8/cryptography-46.0.4-cp311-abi3-manylinux2014_x86_64.manylinux_2_17_x86_64.whl\", hash = \"sha256:47bcd19517e6389132f76e2d5303ded6cf3f78903da2158a671be8de024f4cd0\", size = 4423124, upload-time = \"2026-01-28T00:23:11.529Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/1a/5b/a26407d4f79d61ca4bebaa9213feafdd8806dc69d3d290ce24996d3cfe43/cryptography-46.0.4-cp311-abi3-manylinux_2_28_aarch64.whl\", hash = \"sha256:01df4f50f314fbe7009f54046e908d1754f19d0c6d3070df1e6268c5a4af09fa\", size = 4277090, upload-time = \"2026-01-28T00:23:13.123Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/0c/d8/4bb7aec442a9049827aa34cee1aa83803e528fa55da9a9d45d01d1bb933e/cryptography-46.0.4-cp311-abi3-manylinux_2_28_ppc64le.whl\", hash = \"sha256:5aa3e463596b0087b3da0dbe2b2487e9fc261d25da85754e30e3b40637d61f81\", size = 4947652, upload-time = \"2026-01-28T00:23:14.554Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/2b/08/f83e2e0814248b844265802d081f2fac2f1cbe6cd258e72ba14ff006823a/cryptography-46.0.4-cp311-abi3-manylinux_2_28_x86_64.whl\", hash = \"sha256:0a9ad24359fee86f131836a9ac3bffc9329e956624a2d379b613f8f8abaf5255\", size = 4455157, upload-time = \"2026-01-28T00:23:16.443Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/0a/05/19d849cf4096448779d2dcc9bb27d097457dac36f7273ffa875a93b5884c/cryptography-46.0.4-cp311-abi3-manylinux_2_31_armv7l.whl\", hash = \"sha256:dc1272e25ef673efe72f2096e92ae39dea1a1a450dd44918b15351f72c5a168e\", size = 3981078, upload-time = \"2026-01-28T00:23:17.838Z\" },\n-    { url = \"https://files.pythonhosted.org/packages/e\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump cryptography from 46.0.4 to 46.0.5", "source": "pr", "type": "code_review", "pr_number": 194}
{"instruction": "Review the following code changes: üåê Update translations for tr (update-all)", "input": "```diff\n@@ -27,7 +27,7 @@ Bu bir code snippet: `foo`. Bu da ba≈üka bir code snippet: `bar`. Bir tane daha:\n \n Code snippet'lerin i√ßeriƒüi olduƒüu gibi bƒ±rakƒ±lmalƒ±dƒ±r.\n \n-`script/translate.py` i√ßindeki genel prompt'ta `### Content of code snippets` b√∂l√ºm√ºne bakƒ±n.\n+`scripts/translate.py` i√ßindeki genel prompt'ta `### Content of code snippets` b√∂l√ºm√ºne bakƒ±n.\n \n ////\n \n@@ -116,7 +116,7 @@ works(foo=\"bar\")  # This works üéâ\n \n Code block'larƒ±n i√ßindeki code deƒüi≈ütirilmemelidir; tek istisna yorumlardƒ±r (comments).\n \n-`script/translate.py` i√ßindeki genel prompt'ta `### Content of code blocks` b√∂l√ºm√ºne bakƒ±n.\n+`scripts/translate.py` i√ßindeki genel prompt'ta `### Content of code blocks` b√∂l√ºm√ºne bakƒ±n.\n \n ////\n \n@@ -125,31 +125,31 @@ Code block'larƒ±n i√ßindeki code deƒüi≈ütirilmemelidir; tek istisna yorumlardƒ±r\n //// tab | Test\n \n /// info | Bilgi\n-Some text\n+Bazƒ± metin\n ///\n \n /// note | Not\n-Some text\n+Bazƒ± metin\n ///\n \n /// note | Teknik Detaylar\n-Some text\n+Bazƒ± metin\n ///\n \n /// check | Ek bilgi\n-Some text\n+Bazƒ± metin\n ///\n \n /// tip | ƒ∞pucu\n-Some text\n+Bazƒ± metin\n ///\n \n /// warning | Uyarƒ±\n-Some text\n+Bazƒ± metin\n ///\n \n /// danger | Tehlike\n-Some text\n+Bazƒ± metin\n ///\n \n ////\n@@ -158,7 +158,7 @@ Some text\n \n Sekmelerin ve `Info`/`Note`/`Warning`/vb. bloklarƒ±n ba≈ülƒ±ƒüƒ±, dikey √ßizgiden (`|`) sonra √ßeviri olarak eklenmelidir.\n \n-`script/translate.py` i√ßindeki genel prompt'ta `### Special blocks` ve `### Tab blocks` b√∂l√ºmlerine bakƒ±n.\n+`scripts/translate.py` i√ßindeki genel prompt'ta `### Special blocks` ve `### Tab blocks` b√∂l√ºmlerine bakƒ±n.\n \n ////\n \n@@ -170,10 +170,10 @@ Link metni √ßevrilmelidir, link adresi deƒüi≈ümeden kalmalƒ±dƒ±r:\n \n * [Yukarƒ±daki ba≈ülƒ±ƒüa link](#code-snippets)\n * [Internal link](index.md#installation){.internal-link target=_blank}\n-* <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">External link</a>\n-* <a href=\"https://fastapi.tiangolo.com/css/styles.css\" class=\"external-link\" target=\"_blank\">Link to a style</a>\n-* <a href=\"https://fastapi.tiangolo.com/js/logic.js\" class=\"external-link\" target=\"_blank\">Link to a script</a>\n-* <a href=\"https://fastapi.tiangolo.com/img/foo.jpg\" class=\"external-link\" target=\"_blank\">Link to an image</a>\n+* <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">Harici link</a>\n+* <a href=\"https://fastapi.tiangolo.com/css/styles.css\" class=\"external-link\" target=\"_blank\">Bir stile baƒülantƒ±</a>\n+* <a href=\"https://fastapi.tiangolo.com/js/logic.js\" class=\"external-link\" target=\"_blank\">Bir betiƒüe baƒülantƒ±</a>\n+* <a href=\"https://fastapi.tiangolo.com/img/foo.jpg\" class=\"external-link\" target=\"_blank\">Bir g√∂rsele baƒülantƒ±</a>\n \n Link metni √ßevrilmelidir, link adresi √ßeviriye i≈üaret etmelidir:\n \n@@ -185,7 +185,7 @@ Link metni √ßevrilmelidir, link adresi √ßeviriye i≈üaret etmelidir:\n \n Link'ler √ßevrilmelidir, ancak adresleri deƒüi≈ümeden kalmalƒ±dƒ±r. Bir istisna, FastAPI dok√ºmantasyonunun sayfalarƒ±na verilen mutlak link'lerdir. Bu durumda link, √ßeviriye i≈üaret etmelidir.\n \n-`scr\n\n```\n\n```diff\n@@ -26,7 +26,7 @@ Bu response `dict`'lerinin her birinde, `response_model`'e benzer ≈üekilde bir P\n \n √ñrneƒüin, `404` status code'u ve `Message` Pydantic model'i ile ba≈üka bir response tanƒ±mlamak i√ßin ≈üunu yazabilirsiniz:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Not\n \n@@ -203,7 +203,7 @@ Varsayƒ±lan `200` status code'unu (ya da gerekiyorsa √∂zel bir tane) kullanarak\n \n Ayrƒ±ca `response_model`'inizi kullanan, ancak √∂zel bir `example` i√ßeren `200` status code'lu bir response da tanƒ±mlayabilirsiniz:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n Bunlarƒ±n hepsi OpenAPI'nize birle≈ütirilerek dahil edilir ve API dok√ºmanlarƒ±nda g√∂sterilir:\n \n\n```\n\n```diff\n@@ -18,23 +18,23 @@ Class'ƒ±n kendisini deƒüil (zaten callable'dƒ±r), o class'ƒ±n bir instance'ƒ±nƒ±\n \n Bunu yapmak i√ßin `__call__` adƒ±nda bir method tanƒ±mlarƒ±z:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n Bu durumda, ek parametreleri ve alt-dependency'leri kontrol etmek i√ßin **FastAPI**'nin kullanacaƒüƒ± ≈üey bu `__call__` olacaktƒ±r; ayrƒ±ca daha sonra *path operation function* i√ßindeki parametreye bir deƒüer ge√ßmek i√ßin √ßaƒürƒ±lacak olan da budur.\n \n ## Instance'ƒ± parametrele≈ütirme { #parameterize-the-instance }\n \n Ve ≈üimdi, dependency'yi \"parametrele≈ütirmek\" i√ßin kullanacaƒüƒ±mƒ±z instance parametrelerini tanƒ±mlamak √ºzere `__init__` kullanabiliriz:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n Bu durumda **FastAPI**, `__init__` ile asla uƒüra≈ümaz veya onu √∂nemsemez; onu doƒürudan kendi kodumuzda kullanƒ±rƒ±z.\n \n ## Bir instance olu≈üturma { #create-an-instance }\n \n Bu class'tan bir instance'ƒ± ≈ü√∂yle olu≈üturabiliriz:\n \n-{* .", "output": "Changes look good. This PR implements: üåê Update translations for tr (update-all)", "source": "pr", "type": "code_review", "pr_number": 193}
{"instruction": "Review the following code changes: üåê Update translations for uk (update-all)", "input": "```diff\n@@ -58,9 +58,9 @@ Flask ‚Äî —Ü–µ ¬´–º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫¬ª, –≤—ñ–Ω –Ω–µ –≤–∫–ª—é—á–∞—î —ñ–Ω\n \n /// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n \n-–ë—É—Ç–∏ –º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–æ–≤–æ—Ä–∫–æ–º. –ó—Ä–æ–±–∏—Ç–∏ –ª–µ–≥–∫–∏–º –∫–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—î–¥–Ω–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ —á–∞—Å—Ç–∏–Ω.\n+–ë—É—Ç–∏ –º—ñ–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º. –ó—Ä–æ–±–∏—Ç–∏ –ª–µ–≥–∫–∏–º –∫–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—î–¥–Ω–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ —á–∞—Å—Ç–∏–Ω.\n \n- –ú–∞—Ç–∏ –ø—Ä–æ—Å—Ç—É —Ç–∞ –ª–µ–≥–∫—É —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å–∏—Å—Ç–µ–º—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó.\n+–ú–∞—Ç–∏ –ø—Ä–æ—Å—Ç—É —Ç–∞ –ª–µ–≥–∫—É —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å–∏—Å—Ç–µ–º—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—ó.\n \n ///\n \n@@ -100,9 +100,9 @@ def read_url():\n \n /// check | –ù–∞–¥–∏—Ö–Ω—É–ª–æ **FastAPI** –Ω–∞\n \n-* –ú–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–∏–π —Ç–∞ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π API.\n-* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–º–µ–Ω–∞ (–æ–ø–µ—Ä–∞—Ü—ñ—ó) –º–µ—Ç–æ–¥—ñ–≤ HTTP –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, –ø—Ä–æ—Å—Ç–∏–º —Ç–∞ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É–º—ñ–ª–∏–º —Å–ø–æ—Å–æ–±–æ–º.\n-* –†–æ–∑—É–º–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –∞–ª–µ –ø–æ—Ç—É–∂–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.\n+* –ú–∞—Ç–∏ –ø—Ä–æ—Å—Ç–∏–π —Ç–∞ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π API.\n+* –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ñ–º–µ–Ω–∞ (–æ–ø–µ—Ä–∞—Ü—ñ—ó) –º–µ—Ç–æ–¥—ñ–≤ HTTP –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, –ø—Ä–æ—Å—Ç–∏–º —Ç–∞ —ñ–Ω—Ç—É—ó—Ç–∏–≤–Ω–æ –∑—Ä–æ–∑—É–º—ñ–ª–∏–º —Å–ø–æ—Å–æ–±–æ–º.\n+* –ú–∞—Ç–∏ —Ä–æ–∑—É–º–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, –∞–ª–µ –ø–æ—Ç—É–∂–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.\n \n ///\n \n@@ -122,12 +122,12 @@ def read_url():\n \n –ü—Ä–∏–π–Ω—è—Ç–∏ —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ–π API –∑–∞–º—ñ—Å—Ç—å —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—ó —Å—Ö–µ–º–∏.\n \n- –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:\n+–Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:\n \n * <a href=\"https://github.com/swagger-api/swagger-ui\" class=\"external-link\" target=\"_blank\">–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å Swagger</a>\n * <a href=\"https://github.com/Rebilly/ReDoc\" class=\"external-link\" target=\"_blank\">ReDoc</a>\n \n- –¶—ñ –¥–≤–∞ –±—É–ª–æ –æ–±—Ä–∞–Ω–æ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ –≤–æ–Ω–∏ –¥–æ—Å–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ñ —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ, –∞–ª–µ, –≤–∏–∫–æ–Ω–∞–≤—à–∏ —à–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–µ—Å—è—Ç–∫–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ –¥–ª—è OpenAPI (—è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ **FastAPI**).\n+–¶—ñ –¥–≤–∞ –±—É–ª–æ –æ–±—Ä–∞–Ω–æ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ –≤–æ–Ω–∏ –¥–æ—Å–∏—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ñ —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ, –∞–ª–µ, –≤–∏–∫–æ–Ω–∞–≤—à–∏ —à–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–µ—Å—è—Ç–∫–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ –¥–ª—è OpenAPI (—è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ **FastAPI**).\n \n ///\n \n@@ -137,15 +137,15 @@ def read_url():\n \n ### <a href=\"https://marshmallow.readthedocs.io/en/stable/\" class=\"external-link\" target=\"_blank\">Marshmallow</a> { #marshmallow }\n \n-–û–¥–Ω—ñ—î—é –∑ –≥–æ–ª–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º API, —î \"<abbr title=\"—Ç–∞–∫–æ–∂ –∑–≤–∞–Ω–∞ marshalling, conversion\">—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è</abbr>\", —è–∫–∞ –±–µ—Ä–µ –¥–∞–Ω—ñ –∑ –∫–æ–¥—É (Python) —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —ó—Ö –Ω–∞ —â–æ—Å—å, —â–æ –º–æ–∂–Ω–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç–∞, —â–æ –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –Ω–∞ –æ–±‚Äô—î–∫—Ç JSON. –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç—ñ–≤ `datetime` –Ω–∞ —Å—Ç—Ä–æ–∫–∏ —Ç–æ—â–æ.\n+–û–¥–Ω—ñ—î—é –∑ –≥–æ–ª–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –¥–ª—è —Å–∏—Å—Ç–µ–º API, —î \"<dfn title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–∞ —è–∫: marshalling, –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è\">—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è</dfn>\", —è–∫–∞ –±–µ—Ä–µ –¥–∞–Ω—ñ –∑ –∫–æ–¥—É (Python) —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —ó—Ö –Ω–∞ —â–æ—Å—å, —â–æ –º–æ–∂–Ω–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç–∞, —â–æ –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, –Ω–∞ –æ–±‚Äô—î–∫—Ç JSON. –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±‚Äô—î–∫—Ç—ñ–≤ `datetime` –Ω–∞ —Å—Ç—Ä–æ–∫–∏ —Ç–æ—â–æ.\n \n –Ü–Ω—à–æ—é –≤–∞–∂–ª–∏–≤–æ—é —Ñ—É–Ω–∫—Ü—ñ—î—é, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—é –¥–ª—è API, —î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞–Ω–∏—Ö, —è–∫–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –¥—ñ–π—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö –∑–∞ –ø–µ–≤–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ –¥–µ—è–∫–µ –ø–æ–ª–µ —î `int`, –∞ –Ω–µ –¥–µ—è–∫–∞ –≤–∏–ø–∞–¥–∫–æ–≤–∞ —Å—Ç—Ä–æ–∫–∞. –¶–µ –æ—Å–æ–±–ª–∏–≤–æ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö.\n \n –ë–µ–∑ —Å–∏—Å—Ç–µ–º–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥\n\n```\n\n```diff\n@@ -6,7 +6,7 @@\n \n ### –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ { #based-on-open-standards }\n \n-* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: endpoints, –º–∞—Ä—à—Ä—É—Ç–∏\">—à–ª—è—Ö—ñ–≤</abbr>, <abbr title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ HTTP-–º–µ—Ç–æ–¥–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</abbr>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification\" class=\"external-link\" target=\"_blank\"><strong>OpenAPI</strong></a> –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è <dfn title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫: –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏, –º–∞—Ä—à—Ä—É—Ç–∏\">—à–ª—è—Ö—ñ–≤</dfn>, <dfn title=\"—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º—ñ —è–∫ –º–µ—Ç–æ–¥–∏ HTTP, —è–∫-–æ—Ç POST, GET, PUT, DELETE\">–æ–ø–µ—Ä–∞—Ü—ñ–π</dfn>, –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, —Ç—ñ–ª –∑–∞–ø–∏—Ç—ñ–≤, –±–µ–∑–ø–µ–∫–∏ —Ç–æ—â–æ.\n * –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é <a href=\"https://json-schema.org/\" class=\"external-link\" target=\"_blank\"><strong>JSON Schema</strong></a> (–æ—Å–∫—ñ–ª—å–∫–∏ OpenAPI –±–∞–∑—É—î—Ç—å—Å—è —Å–∞–º–µ –Ω–∞ JSON Schema).\n * –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ü–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ –ø—ñ—Å–ª—è —Ä–µ—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É, –∞ –Ω–µ —è–∫ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ä—ñ–≤–µ–Ω—å –ø–æ–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏.\n * –¶–µ —Ç–∞–∫–æ–∂ –¥–∞—î –∑–º–æ–≥—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É **–≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–≥–æ –∫–æ–¥—É** –±–∞–≥–∞—Ç—å–º–∞ –º–æ–≤–∞–º–∏.\n@@ -136,7 +136,7 @@ FastAPI –º–∞—î —Ä–æ–∑—É–º–Ω—ñ **–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞\n \n ### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π { #dependency-injection }\n \n-FastAPI –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø—Ä–æ—Å—Ç—É —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ, –∞–ª–µ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø–æ—Ç—É–∂–Ω—É —Å–∏—Å—Ç–µ–º—É <abbr title='—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–µ —è–∫: \"components\", \"resources\", \"services\", \"providers\"'><strong>Dependency Injection</strong></abbr>.\n+FastAPI –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø—Ä–æ—Å—Ç—É —É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ, –∞–ª–µ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–æ –ø–æ—Ç—É–∂–Ω—É —Å–∏—Å—Ç–µ–º—É <dfn title='—Ç–∞–∫–æ–∂ –≤—ñ–¥–æ–º–µ —è–∫ ¬´components¬ª, ¬´resources¬ª, ¬´services¬ª, ¬´providers¬ª'><strong>–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π</strong></dfn>.\n \n * –ù–∞–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ, —É—Ç–≤–æ—Ä—é—é—á–∏ —ñ—î—Ä–∞—Ä—Ö—ñ—é –∞–±–æ **¬´–≥—Ä–∞—Ñ¬ª –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π**.\n * –£—Å–µ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è** —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–º.\n@@ -153,8 +153,8 @@ FastAPI –º—ñ—Å—Ç–∏—Ç—å ", "output": "Changes look good. This PR implements: üåê Update translations for uk (update-all)", "source": "pr", "type": "code_review", "pr_number": 192}
{"instruction": "Review the following code changes: üåê Update translations for zh (update-all)", "input": "```diff\n@@ -0,0 +1,755 @@\n+# LLM ÊµãËØïÊñá‰ª∂ { #llm-test-file }\n+\n+Êú¨ÊñáÁî®‰∫éÊµãËØïÁî®‰∫éÁøªËØëÊñáÊ°£ÁöÑ <abbr title=\"Large Language Model - Â§ßÂûãËØ≠Ë®ÄÊ®°Âûã\">LLM</abbr> ÊòØÂê¶ÁêÜËß£ `scripts/translate.py` ‰∏≠ÁöÑ `general_prompt` ‰ª•Âèä `docs/{language code}/llm-prompt.md` ‰∏≠ÁöÑËØ≠Ë®ÄÁâπÂÆöÊèêÁ§∫„ÄÇËØ≠Ë®ÄÁâπÂÆöÊèêÁ§∫‰ºöËøΩÂä†Âà∞ `general_prompt` ‰πãÂêé„ÄÇ\n+\n+ËøôÈáåÊ∑ªÂä†ÁöÑÊµãËØï‰ºöË¢´ÊâÄÊúâËØ≠Ë®ÄÁâπÂÆöÊèêÁ§∫ÁöÑËÆæËÆ°ËÄÖÁúãÂà∞„ÄÇ\n+\n+Áî®Ê≥ïÂ¶Ç‰∏ãÔºö\n+\n+* ÂáÜÂ§áËØ≠Ë®ÄÁâπÂÆöÊèêÁ§∫‚Äî‚Äî`docs/{language code}/llm-prompt.md`„ÄÇ\n+* Â∞ÜÊú¨ÊñáÈáçÊñ∞ÁøªËØë‰∏∫‰Ω†ÁöÑÁõÆÊ†áËØ≠Ë®ÄÔºà‰æãÂ¶Ç‰ΩøÁî® `translate.py` ÁöÑ `translate-page` ÂëΩ‰ª§Ôºâ„ÄÇËøô‰ºöÂú® `docs/{language code}/docs/_llm-test.md` ‰∏ãÂàõÂª∫ÁøªËØë„ÄÇ\n+* Ê£ÄÊü•ÁøªËØëÊòØÂê¶Ê≠£Á°Æ„ÄÇ\n+* Â¶ÇÊúâÈúÄË¶ÅÔºåÊîπËøõ‰Ω†ÁöÑËØ≠Ë®ÄÁâπÂÆöÊèêÁ§∫„ÄÅÈÄöÁî®ÊèêÁ§∫ÔºåÊàñËã±ÊñáÊñáÊ°£„ÄÇ\n+* ÁÑ∂ÂêéÊâãÂä®‰øÆÊ≠£ÁøªËØë‰∏≠Ââ©‰ΩôÁöÑÈóÆÈ¢òÔºåÁ°Æ‰øùËøôÊòØ‰∏Ä‰∏™‰ºòÁßÄÁöÑËØëÊñá„ÄÇ\n+* ÈáçÊñ∞ÁøªËØëÔºåÂú®Â∑≤ÊúâÁöÑ‰ºòÁßÄËØëÊñáÂü∫Á°Ä‰∏äËøõË°å„ÄÇÁêÜÊÉ≥ÊÉÖÂÜµÊòØ LLM ‰∏çÂÜçÂØπËØëÊñáÂÅö‰ªª‰ΩïÊõ¥Êîπ„ÄÇËøôÊÑèÂë≥ÁùÄÈÄöÁî®ÊèêÁ§∫Âíå‰Ω†ÁöÑËØ≠Ë®ÄÁâπÂÆöÊèêÁ§∫Â∑≤ÁªèÂ∞ΩÂèØËÉΩÂÆåÂñÑÔºàÊúâÊó∂ÂÆÉ‰ªç‰ºöÂÅö‰∏Ä‰∫õÁúã‰ººÈöèÊú∫ÁöÑÊîπÂä®ÔºåÂéüÂõ†ÊòØ<a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM ‰∏çÊòØÁ°ÆÂÆöÊÄßÁÆóÊ≥ï</a>Ôºâ„ÄÇ\n+\n+ÊµãËØïÂ¶Ç‰∏ãÔºö\n+\n+## ‰ª£Á†ÅÁâáÊÆµ { #code-snippets }\n+\n+//// tab | ÊµãËØï\n+\n+ËøôÊòØ‰∏Ä‰∏™‰ª£Á†ÅÁâáÊÆµÔºö`foo`„ÄÇËøôÊòØÂè¶‰∏Ä‰∏™‰ª£Á†ÅÁâáÊÆµÔºö`bar`„ÄÇËøòÊúâ‰∏Ä‰∏™Ôºö`baz quux`„ÄÇ\n+\n+////\n+\n+//// tab | ‰ø°ÊÅØ\n+\n+‰ª£Á†ÅÁâáÊÆµÁöÑÂÜÖÂÆπÂ∫î‰øùÊåÅ‰∏çÂèò„ÄÇ\n+\n+ÂèÇËßÅ `scripts/translate.py` ‰∏≠ÈÄöÁî®ÊèêÁ§∫ÁöÑ `### Content of code snippets` ÈÉ®ÂàÜ„ÄÇ\n+\n+////\n+\n+## ÂºïÂè∑ { #quotes }\n+\n+//// tab | ÊµãËØï\n+\n+Êò®Â§©ÔºåÊàëÁöÑÊúãÂèãÂÜôÈÅìÔºö\"Â¶ÇÊûú‰Ω†Êää incorrectly ÊãºÂØπ‰∫ÜÔºå‰Ω†Â∞±ÊääÂÆÉÊãºÈîô‰∫Ü\"„ÄÇÊàëÂõûÁ≠îÔºö\"Ê≤°ÈîôÔºå‰ΩÜ 'incorrectly' ÈîôÁöÑ‰∏çÊòØ '\"incorrectly\"'\"„ÄÇ\n+\n+/// note | Ê≥®ÊÑè\n+\n+LLM ÂæàÂèØËÉΩ‰ºöÊääËøôÊÆµÁøªÈîô„ÄÇÊàë‰ª¨Âè™ÂÖ≥ÂøÉÂú®ÈáçÊñ∞ÁøªËØëÊó∂ÂÆÉÊòØÂê¶ËÉΩ‰øùÊåÅ‰øÆÊ≠£ÂêéÁöÑËØëÊñá„ÄÇ\n+\n+///\n+\n+////\n+\n+//// tab | ‰ø°ÊÅØ\n+\n+ÊèêÁ§∫ËØçËÆæËÆ°ËÄÖÂèØ‰ª•ÈÄâÊã©ÊòØÂê¶Â∞Ü‰∏≠ÊÄßÂºïÂè∑ËΩ¨Êç¢‰∏∫ÊéíÁâàÂºïÂè∑„ÄÇ‰πüÂèØ‰ª•‰øùÊåÅ‰∏çÂèò„ÄÇ\n+\n+‰æãÂ¶ÇÂèÇËßÅ `docs/de/llm-prompt.md` ‰∏≠ÁöÑ `### Quotes` ÈÉ®ÂàÜ„ÄÇ\n+\n+////\n+\n+## ‰ª£Á†ÅÁâáÊÆµ‰∏≠ÁöÑÂºïÂè∑ { #quotes-in-code-snippets }\n+\n+//// tab | ÊµãËØï\n+\n+`pip install \"foo[bar]\"`\n+\n+‰ª£Á†ÅÁâáÊÆµ‰∏≠ÁöÑÂ≠óÁ¨¶‰∏≤Â≠óÈù¢ÈáèÁ§∫‰æãÔºö`\"this\"`Ôºå`'that'`„ÄÇ\n+\n+‰∏Ä‰∏™ËæÉÈöæÁöÑÂ≠óÁ¨¶‰∏≤Â≠óÈù¢ÈáèÁ§∫‰æãÔºö`f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+Á°¨Ê†∏Ôºö`Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | ‰ø°ÊÅØ\n+\n+... ‰ΩÜÊòØÔºå‰ª£Á†ÅÁâáÊÆµÂÜÖÁöÑÂºïÂè∑ÂøÖÈ°ª‰øùÊåÅ‰∏çÂèò„ÄÇ\n+\n+////\n+\n+## ‰ª£Á†ÅÂùó { #code-blocks }\n+\n+//// tab | ÊµãËØï\n+\n+‰∏Ä‰∏™ Bash ‰ª£Á†ÅÁ§∫‰æã...\n+\n+\n```\n\n```diff\n@@ -0,0 +1,3 @@\n+# ÂÖ≥‰∫é { #about }\n+\n+ÂÖ≥‰∫é FastAPI„ÄÅÂÖ∂ËÆæËÆ°„ÄÅÁÅµÊÑüÁ≠â„ÄÇü§ì\n\n```\n\n```diff\n@@ -26,7 +26,7 @@\n \n ‰æãÂ¶ÇÔºåË¶ÅÂ£∞ÊòéÂè¶‰∏Ä‰∏™Áä∂ÊÄÅÁ†Å‰∏∫ `404` ‰∏îÂÖ∑Êúâ Pydantic Ê®°Âûã `Message` ÁöÑÂìçÂ∫îÔºå‰Ω†ÂèØ‰ª•ËøôÊ†∑ÂÜôÔºö\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Ê≥®ÊÑè\n \n@@ -203,7 +203,7 @@\n \n ‰ª•Âèä‰∏Ä‰∏™Áä∂ÊÄÅÁ†Å‰∏∫ `200` ÁöÑÂìçÂ∫îÔºåÂÆÉ‰ΩøÁî®‰Ω†ÁöÑ `response_model`Ôºå‰ΩÜÂåÖÂê´Ëá™ÂÆö‰πâÁöÑ `example`Ôºö\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n ÊâÄÊúâËøô‰∫õÈÉΩ‰ºöË¢´ÂêàÂπ∂Âπ∂ÂåÖÂê´Âà∞‰Ω†ÁöÑ OpenAPI ‰∏≠ÔºåÂπ∂ÊòæÁ§∫Âú® API ÊñáÊ°£ÈáåÔºö\n \n\n```\n\n```diff\n@@ -16,7 +16,7 @@\n \n {* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n-/// warning\n+/// warning | Ë≠¶Âëä\n \n ÂΩì‰Ω†Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™ÂÉè‰∏äÈù¢‰æãÂ≠ê‰∏≠ÁöÑ `Response` ÂØπË±°Êó∂ÔºåÂÆÉ‰ºöÁõ¥Êé•ËøîÂõû„ÄÇ\n \n@@ -26,7 +26,7 @@\n \n ///\n \n-/// note | ÊäÄÊúØÁªÜËäÇ\n+/// note | Ê≥®ÊÑè\n \n ‰Ω†‰πüÂèØ‰ª•‰ΩøÁî® `from starlette.responses import JSONResponse`„ÄÇ„ÄÄ\n \n\n```\n\n```diff\n@@ -18,23 +18,23 @@\n \n ‰∏∫Ê≠§ÔºåÂ£∞Êòé‰∏Ä‰∏™ `__call__` ÊñπÊ≥ïÔºö\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n Âú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºå**FastAPI** ‰ºö‰ΩøÁî®Ëøô‰∏™ `__call__` Êù•Ê£ÄÊü•ÈôÑÂä†ÂèÇÊï∞ÂíåÂ≠ê‰æùËµñÔºåÂπ∂‰∏îÁ®çÂêé‰ºöË∞ÉÁî®ÂÆÉÔºåÊääËøîÂõûÂÄº‰º†ÈÄíÁªô‰Ω†ÁöÑ*Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞*‰∏≠ÁöÑÂèÇÊï∞„ÄÇ\n \n ## ÂèÇÊï∞ÂåñÂÆû‰æã { #parameterize-the-instance }\n \n Áé∞Âú®ÔºåÊàë‰ª¨ÂèØ‰ª•Áî® `__init__` Â£∞ÊòéÂÆû‰æãÁöÑÂèÇÊï∞ÔºåÁî®Êù•‚ÄúÂèÇÊï∞Âåñ‚ÄùËøô‰∏™‰æùËµñÈ°πÔºö\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n Âú®Êú¨‰æã‰∏≠Ôºå**FastAPI** ‰∏ç‰ºöÊé•Ëß¶ÊàñÂÖ≥ÂøÉ `__init__`ÔºåÊàë‰ª¨‰ºöÂú®Ëá™Â∑±ÁöÑ‰ª£Á†Å‰∏≠Áõ¥Êé•‰ΩøÁî®ÂÆÉ„ÄÇ\n \n ## ÂàõÂª∫ÂÆû‰æã { #create-an-instance }\n \n Êàë‰ª¨ÂèØ‰ª•ËøôÊ†∑ÂàõÂª∫ËØ•Á±ªÁöÑÂÆû‰æãÔºö\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n ËøôÊ†∑Â∞±Êää‰æùËµñÈ°π‚ÄúÂèÇÊï∞Âåñ‚Äù‰∫ÜÔºåÁé∞Âú®ÂÆÉÂÜÖÈÉ®Â∏¶ÊúâÂ±ûÊÄß `checker.fixed_content` ÁöÑÂÄº `\"bar\"`„ÄÇ\n \n@@ -50,7 +50,7 @@ checker(q=\"somequery\")\n \n ...Âπ∂Â∞ÜÂÖ∂ËøîÂõûÂÄº‰Ωú‰∏∫‰æùËµñÈ°πÁöÑÂÄºÔºå‰º†ÁªôÊàë‰ª¨ÁöÑ*Ë∑ØÂæÑÊìç‰ΩúÂáΩÊï∞*‰∏≠ÁöÑÂèÇÊï∞ `fixed_content_included`Ôºö\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip | ÊèêÁ§∫\n \n\n```", "output": "Changes look good. This PR implements: üåê Update translations for zh (update-all)", "source": "pr", "type": "code_review", "pr_number": 191}
{"instruction": "Review the following code changes: üåê Update translations for es (update-all and add-missing)", "input": "```diff\n@@ -26,7 +26,7 @@ Cada uno de esos `dict`s de response puede tener una clave `model`, conteniendo\n \n Por ejemplo, para declarar otro response con un c√≥digo de estado `404` y un modelo Pydantic `Message`, puedes escribir:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Nota\n \n@@ -203,7 +203,7 @@ Por ejemplo, puedes declarar un response con un c√≥digo de estado `404` que usa\n \n Y un response con un c√≥digo de estado `200` que usa tu `response_model`, pero incluye un `example` personalizado:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n Todo se combinar√° e incluir√° en tu OpenAPI, y se mostrar√° en la documentaci√≥n de la API:\n \n\n```\n\n```diff\n@@ -18,23 +18,23 @@ No la clase en s√≠ (que ya es un callable), sino una instance de esa clase.\n \n Para hacer eso, declaramos un m√©todo `__call__`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n En este caso, este `__call__` es lo que **FastAPI** usar√° para comprobar par√°metros adicionales y sub-dependencias, y es lo que llamar√° para pasar un valor al par√°metro en tu *path operation function* m√°s adelante.\n \n ## Parametrizar la instance { #parameterize-the-instance }\n \n Y ahora, podemos usar `__init__` para declarar los par√°metros de la instance que podemos usar para \"parametrizar\" la dependencia:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n En este caso, **FastAPI** nunca tocar√° ni se preocupar√° por `__init__`, lo usaremos directamente en nuestro c√≥digo.\n \n ## Crear una instance { #create-an-instance }\n \n Podr√≠amos crear una instance de esta clase con:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n Y de esa manera podemos \"parametrizar\" nuestra dependencia, que ahora tiene `\"bar\"` dentro de ella, como el atributo `checker.fixed_content`.\n \n@@ -50,7 +50,7 @@ checker(q=\"somequery\")\n \n ...y pasar√° lo que eso retorne como el valor de la dependencia en nuestra *path operation function* como el par√°metro `fixed_content_included`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip | Consejo\n \n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+# Tipos avanzados de Python { #advanced-python-types }\n+\n+Aqu√≠ tienes algunas ideas adicionales que podr√≠an ser √∫tiles al trabajar con tipos de Python.\n+\n+## Usar `Union` u `Optional` { #using-union-or-optional }\n+\n+Si por alguna raz√≥n tu c√≥digo no puede usar `|`, por ejemplo si no est√° en una anotaci√≥n de tipos sino en algo como `response_model=`, en lugar de usar la barra vertical (`|`) puedes usar `Union` de `typing`.\n+\n+Por ejemplo, podr√≠as declarar que algo podr√≠a ser un `str` o `None`:\n+\n+\n```\n\n```diff\n@@ -32,11 +32,11 @@ Para un ejemplo simple, consideremos una estructura de archivos similar a la des\n \n El archivo `main.py` tendr√≠a:\n \n-{* ../../docs_src/async_tests/app_a_py39/main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/main.py *}\n \n El archivo `test_main.py` tendr√≠a los tests para `main.py`, podr√≠a verse as√≠ ahora:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py *}\n \n ## Ejec√∫talo { #run-it }\n \n@@ -56,7 +56,7 @@ $ pytest\n \n El marcador `@pytest.mark.anyio` le dice a pytest que esta funci√≥n de test debe ser llamada as√≠ncronamente:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[7] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[7] *}\n \n /// tip | Consejo\n \n@@ -66,7 +66,7 @@ Nota que la funci√≥n de test ahora es `async def` en lugar de solo `def` como an\n \n Luego podemos crear un `AsyncClient` con la app y enviar requests as√≠ncronos a ella, usando `await`.\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[9:12] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[9:12] *}\n \n Esto es equivalente a:\n \n\n```\n\n```diff\n@@ -44,7 +44,7 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n Por ejemplo, digamos que defines una *path operation* `/items/`:\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_01_py310.py hl[6] *}\n \n Si el cliente intenta ir a `/items`, por defecto, ser√≠a redirigido a `/items/`.\n \n@@ -115,7 +115,7 @@ En este caso, el path original `/app` realmente ser√≠a servido en `/api/v1/app`.\n \n Aunque todo tu c√≥digo est√© escrito asumiendo que solo existe `/app`.\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_py39.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_py310.py hl[6] *}\n \n Y el proxy estar√≠a **\"eliminando\"** el **prefijo del path** sobre la marcha antes de transmitir el request al ser", "output": "Changes look good. This PR implements: üåê Update translations for es (update-all and add-missing)", "source": "pr", "type": "code_review", "pr_number": 190}
{"instruction": "Review the following code changes: üåê Update translations for pt (update-all)", "input": "```diff\n@@ -104,8 +104,8 @@ $ cd code\n ...e um exemplo de c√≥digo Python...\n \n \n```\n\n```diff\n@@ -26,7 +26,7 @@ O **FastAPI** pegar√° este modelo, gerar√° o esquema JSON dele e incluir√° no lo\n \n Por exemplo, para declarar um outro retorno com o status code `404` e um modelo do Pydantic chamado `Message`, voc√™ pode escrever:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Nota\n \n@@ -203,7 +203,7 @@ Por exemplo, voc√™ pode declarar um retorno com o c√≥digo de status `404` que ut\n \n E um retorno com o c√≥digo de status `200` que utiliza o seu `response_model`, por√©m inclui um `example` customizado:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n Isso ser√° combinado e inclu√≠do em seu OpenAPI, e disponibilizado na documenta√ß√£o da sua API:\n \n@@ -243,5 +243,5 @@ Por exemplo:\n \n Para verificar exatamente o que voc√™ pode incluir nos retornos, voc√™ pode conferir estas se√ß√µes na especifica√ß√£o do OpenAPI:\n \n-* <a href=\"https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.1.0.md#responses-object\" class=\"external-link\" target=\"_blank\">Objeto de Retorno OpenAPI</a>, inclui o `Response Object`.\n-* <a href=\"https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.1.0.md#response-object\" class=\"external-link\" target=\"_blank\">Objeto de Retorno OpenAPI</a>, voc√™ pode incluir qualquer coisa dele diretamente em cada retorno dentro do seu par√¢metro `responses`. Incluindo `description`, `headers`, `content` (dentro dele que voc√™ declara diferentes media types e esquemas JSON), e `links`.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.1.0.md#responses-object\" class=\"external-link\" target=\"_blank\">Objeto de Retornos do OpenAPI</a>, inclui o `Response Object`.\n+* <a href=\"https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.1.0.md#response-object\" class=\"external-link\" target=\"_blank\">Objeto de Retorno do OpenAPI</a>, voc√™ pode incluir qualquer coisa dele diretamente em cada retorno dentro do seu par√¢metro `responses`. Incluindo `description`, `headers`, `content` (dentro dele que voc√™ declara diferentes media types e esquemas JSON), e `links`.\n\n```\n\n```diff\n@@ -18,23 +18,23 @@ N√£o propriamente a classe (que j√° √© um cham√°vel), mas a inst√¢ncia desta cla\n \n Para fazer isso, n√≥s declaramos o m√©todo `__call__`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n Neste caso, o `__call__` √© o que o **FastAPI** utilizar√° para verificar par√¢metros adicionais e sub depend√™ncias, e isso √© o que ser√° chamado para passar o valor ao par√¢metro na sua *fun√ß√£o de opera√ß√£o de rota* posteriormente.\n \n ## Parametrizar a inst√¢ncia { #parameterize-the-instance }\n \n E agora, n√≥s podemos utilizar o `__init__` para declarar os par√¢metros da inst√¢ncia que podemos utilizar para \"parametrizar\" a depend√™ncia:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n Neste caso, o **FastAPI** nunca tocar√° ou se importar√° com o `__init__`, n√≥s vamos utilizar diretamente em nosso c√≥digo.\n \n ## Crie uma inst√¢ncia { #create-an-instance }\n \n N√≥s poder√≠amos criar uma inst√¢ncia desta classe com:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n E deste modo n√≥s podemos \"parametrizar\" a nossa depend√™ncia, que agora possui `\"bar\"` dentro dele, como o atributo `checker.fixed_content`.\n \n@@ -50,7 +50,7 @@ checker(q=\"somequery\")\n \n ...e passar o que quer que isso retorne como valor da depend√™ncia em nossa *fun√ß√£o de opera√ß√£o de rota* como o par√¢metro `fixed_content_included`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip | Dica\n \n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+# Tipos Avan√ßados de Python { #advanced-python-types }\n+\n+Aqui est√£o algumas ideias adicionais que podem ser √∫teis ao trabalhar com tipos em Python.\n+\n+## Usando `Union` ou `Optional` { #using-union-or-optional }\n+\n+Se, por algum motivo, seu c√≥digo n√£o puder usar `|`, por exemplo, se n√£o for em uma anota√ß√£o de tipo, mas em algo como `response_model=`, em vez de usar a barra vertical (`|`) voc√™ pode usar `Union` do `typing`.\n+\n+Por exemplo, voc√™ poderia declarar que algo pode ser `str` ou `None`:\n+\n+\n```\n\n```diff\n@@ -32,11 +32,11 @@ Para um exemplos simples, vamos considerar uma estrutura de arquivos semelhante\n \n O arquivo `main.py` teria:\n \n-{* ../../docs_src/async_tests/app_a_py39/main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/main.py *}\n \n O arquivo `test_main.py` teria os testes para para o arquivo `main.py`, ele poderia ficar assim:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.p", "output": "Changes look good. This PR implements: üåê Update translations for pt (update-all)", "source": "pr", "type": "code_review", "pr_number": 189}
{"instruction": "Review the following code changes: üåê Update translations for ja (update-all)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# LLM „ÉÜ„Çπ„Éà„Éï„Ç°„Ç§„É´ { #llm-test-file }\n+\n+„Åì„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÅØ„ÄÅ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÁøªË®≥„Åô„Çã <abbr title=\"Large Language Model - Â§ßË¶èÊ®°Ë®ÄË™û„É¢„Éá„É´\">LLM</abbr> „Åå„ÄÅ`scripts/translate.py` „ÅÆ `general_prompt` „Å®„ÄÅ`docs/{language code}/llm-prompt.md` „ÅÆË®ÄË™ûÂõ∫Êúâ„Éó„É≠„É≥„Éó„Éà„ÇíÁêÜËß£„Åó„Å¶„ÅÑ„Çã„Åã„Çí„ÉÜ„Çπ„Éà„Åó„Åæ„Åô„ÄÇË®ÄË™ûÂõ∫Êúâ„Éó„É≠„É≥„Éó„Éà„ÅØ `general_prompt` „ÅÆÊú´Â∞æ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô„ÄÇ\n+\n+„Åì„Åì„Å´ËøΩÂä†„Åó„Åü„ÉÜ„Çπ„Éà„ÅØ„ÄÅ„Åô„Åπ„Å¶„ÅÆË®ÄË™ûÂõ∫Êúâ„Éó„É≠„É≥„Éó„Éà„ÅÆË®≠Ë®àËÄÖ„ÅåÂèÇÁÖß„Åó„Åæ„Åô„ÄÇ\n+\n+‰Ωø„ÅÑÊñπ:\n+\n+* Ë®ÄË™ûÂõ∫Êúâ„Éó„É≠„É≥„Éó„Éà„ÇíÁî®ÊÑè„Åó„Åæ„Åô - `docs/{language code}/llm-prompt.md`„ÄÇ\n+* „Åì„ÅÆÊñáÊõ∏„ÇíÂ∏åÊúõ„Åô„Çã„Çø„Éº„Ç≤„ÉÉ„ÉàË®ÄË™û„Å´Êñ∞Ë¶è„ÅßÁøªË®≥„Åó„Åæ„ÅôÔºà‰æã: `translate.py` „ÅÆ `translate-page` „Ç≥„Éû„É≥„ÉâÔºâ„ÄÇ„Åì„Çå„Å´„Çà„Çä `docs/{language code}/docs/_llm-test.md` „Å´ÁøªË®≥„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åô„ÄÇ\n+* ÁøªË®≥„ÅåÂïèÈ°å„Å™„ÅÑ„ÅãÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ\n+* ÂøÖË¶Å„Åß„ÅÇ„Çå„Å∞„ÄÅË®ÄË™ûÂõ∫Êúâ„Éó„É≠„É≥„Éó„Éà„ÄÅgeneral „Éó„É≠„É≥„Éó„Éà„ÄÅ„Åæ„Åü„ÅØËã±Ë™û„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÊîπÂñÑ„Åó„Åæ„Åô„ÄÇ\n+* „Åù„ÅÆÂæå„ÄÅÁøªË®≥„Å´ÊÆã„Å£„Å¶„ÅÑ„ÇãÂïèÈ°å„ÇíÊâãÂãï„Åß‰øÆÊ≠£„Åó„ÄÅËâØ„ÅÑÁøªË®≥„Å´„Åó„Åæ„Åô„ÄÇ\n+* ËâØ„ÅÑÁøªË®≥„ÇíÁî®ÊÑè„Åó„ÅüÁä∂ÊÖã„Åß„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÁøªË®≥„Åó„Åæ„Åô„ÄÇÁêÜÊÉ≥ÁöÑ„Å™ÁµêÊûú„ÅØ„ÄÅLLM „ÅåÁøªË®≥„Å´‰∏ÄÂàáÂ§âÊõ¥„ÇíÂä†„Åà„Å™„ÅÑ„Åì„Å®„Åß„Åô„ÄÇ„Å§„Åæ„Çä general „Éó„É≠„É≥„Éó„Éà„Å®Ë®ÄË™ûÂõ∫Êúâ„Éó„É≠„É≥„Éó„Éà„ÅåÊúÄËâØ„Åß„ÅÇ„Çã„Åì„Å®„ÇíÊÑèÂë≥„Åó„Åæ„ÅôÔºàÊôÇ„ÄÖ„ÅÑ„Åè„Å§„Åã„É©„É≥„ÉÄ„É†„Å´Ë¶ã„Åà„ÇãÂ§âÊõ¥„ÇíË°å„ÅÜ„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÁêÜÁî±„ÅØ <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM „ÅØÊ±∫ÂÆöË´ñÁöÑ„Ç¢„É´„Ç¥„É™„Ç∫„É†„Åß„ÅØ„Å™„ÅÑ</a> „Åü„ÇÅ„Åß„ÅôÔºâ„ÄÇ\n+\n+„ÉÜ„Çπ„ÉàÂÜÖÂÆπ:\n+\n+## „Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„Éà { #code-snippets }\n+\n+//// tab | „ÉÜ„Çπ„Éà\n+\n+„Åì„Çå„ÅØ„Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„Éà„Åß„Åô: `foo`„ÄÇ„Åù„Åó„Å¶„Åì„Çå„ÇÇ„Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„Éà„Åß„Åô: `bar`„ÄÇ„Åï„Çâ„Å´„ÇÇ„ÅÜ‰∏Ä„Å§: `baz quux`„ÄÇ\n+\n+////\n+\n+//// tab | ÊÉÖÂ†±\n+\n+„Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„Éà„ÅÆÂÜÖÂÆπ„ÅØ„Åù„ÅÆ„Åæ„Åæ„Å´„Åó„Å¶„Åä„ÅèÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n+\n+`scripts/translate.py` „ÅÆ general „Éó„É≠„É≥„Éó„ÉàÂÜÖ„Äå### Content of code snippets„Äç„ÅÆÁØÄ„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n+\n+////\n+\n+## ÂºïÁî® { #quotes }\n+\n+//// tab | „ÉÜ„Çπ„Éà\n+\n+Êò®Êó•„ÄÅÂèã‰∫∫„ÅØ„Åì„ÅÜÊõ∏„Åç„Åæ„Åó„Åü„ÄÇ„Äåincorrectly „ÇíÊ≠£„Åó„ÅèÁ∂¥„Çå„Å∞„ÄÅ„ÅÇ„Å™„Åü„ÅØ„Åù„Çå„ÇíÈñìÈÅï„Å£„Å¶Á∂¥„Å£„Åü„Åì„Å®„Å´„Å™„Çã„Äç„ÄÇ„Åù„Çå„Å´ÂØæ„Åó„Å¶ÁßÅ„ÅØ„Åì„ÅÜÁ≠î„Åà„Åæ„Åó„Åü„ÄÇ„Äå„Åù„ÅÆ„Å®„Åä„Çä„ÄÇ„Åü„Å†„Åó„Äéincorrectly„Äè„ÅØË™§„Çä„Åß„ÄÅ„Äé\"incorrectly\"„Äè„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„Äç„ÄÇ\n+\n+/// note | ÂÇôËÄÉ\n+\n+LLM „ÅØ„Åä„Åù„Çâ„Åè„Åì„Åì„ÇíË™§„Å£„Å¶ÁøªË®≥„Åó„Åæ„Åô„ÄÇÈáçË¶Å„Å™„ÅÆ„ÅØ„ÄÅÂÜçÁøªË®≥ÊôÇ„Å´‰øÆÊ≠£Ê∏à„Åø„ÅÆÁøªË®≥„ÇíÁ∂≠ÊåÅ„Åß„Åç„Çã„Åã„Å©„ÅÜ„Åã„Å†„Åë„Åß„Åô„ÄÇ\n+\n+///\n+\n+////\n+\n+//// tab | ÊÉÖÂ†±\n+\n+„Éó„É≠„É≥„Éó„ÉàË®≠Ë®àËÄÖ„ÅØ„ÄÅ„Çπ„Éà„É¨„Éº„Éà„ÇØ„Ç©„Éº„Éà„Çí„Çø„Ç§„Éù„Ç∞„É©„Éï„Ç£„ÉÉ„ÇØ„Å™ÂºïÁî®Á¨¶„Å´Â§âÊèõ„Åô„Çã„Åã„Å©„ÅÜ„Åã„ÇíÈÅ∏„Åπ„Åæ„Åô„ÄÇ„Åù„ÅÆ„Åæ„Åæ„Åß„ÇÇÂïèÈ°å„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n+\n+‰æã„Å®„Åó„Å¶ `docs/de/llm-prompt.md` „ÅÆ„Äå### Quotes„Äç„ÅÆÁØÄ„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n+\n+////\n+\n+## „Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„ÉàÂÜÖ„ÅÆÂºïÁî® { #quotes-in-code-snippets }\n+\n+//// tab | „ÉÜ„Çπ„Éà\n+\n+`pip install \"foo[bar]\"`\n+\n+„Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„Éà‰∏≠„ÅÆÊñáÂ≠óÂàó„É™„ÉÜ„É©„É´„ÅÆ‰æã: `\"this\"`, `'that'`.\n+\n+Èõ£„Åó„ÅÑÊñáÂ≠óÂàó„É™„ÉÜ„É©„É´„ÅÆ‰æã: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+„Éè„Éº„Éâ„Ç≥„Ç¢: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | ÊÉÖÂ†±\n+\n+... „Åü„Å†„Åó„ÄÅ„Ç≥„Éº„Éâ„Çπ„Éã„Éö„ÉÉ„ÉàÂÜÖ„ÅÆÂºïÁî®Á¨¶„ÅØ„Åù„ÅÆ„Åæ„Åæ„Å´„Åó„Å¶„Åä„ÅèÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n+\n+////\n+\n+## „Ç≥„Éº„Éâ„Éñ„É≠„ÉÉ„ÇØ { #code-blocks }\n+\n+//// tab | „ÉÜ„Çπ„Éà\n+\n+Bash „ÅÆ„Ç≥„Éº„Éâ‰æã„Åß„Åô...\n+\n+\n```\n\n```diff\n@@ -0,0 +1,3 @@\n+# Ê¶ÇË¶Å { #about }\n+\n+FastAPI „ÅÆÊ¶ÇË¶Å„ÄÅ„Åù„ÅÆË®≠Ë®à„ÇÑ„Ç§„É≥„Çπ„Éî„É¨„Éº„Ç∑„Éß„É≥„Å™„Å©„Å´„Å§„ÅÑ„Å¶Ëß£Ë™¨„Åó„Åæ„Åô„ÄÇü§ì\n\n```\n\n```diff\n@@ -0,0 +1,247 @@\n+# OpenAPI „ÅÆËøΩÂä†„É¨„Çπ„Éù„É≥„Çπ { #additional-responses-in-openapi }\n+\n+/// warning | Ê≥®ÊÑè\n+\n+„Åì„Çå„ÅØÊØîËºÉÁöÑÈ´òÂ∫¶„Å™„Éà„Éî„ÉÉ„ÇØ„Åß„Åô„ÄÇ\n+\n+FastAPI „Çí‰Ωø„ÅÑÂßã„ÇÅ„Åü„Å∞„Åã„Çä„Åß„ÅÇ„Çå„Å∞„ÄÅ„Åì„Çå„ÅØ‰∏çË¶Å„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ\n+\n+///\n+\n+ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„ÄÅ„É°„Éá„Ç£„Ç¢„Çø„Ç§„Éó„ÄÅË™¨Êòé„Å™„Å©„Çí‰º¥„ÅÜËøΩÂä†„É¨„Çπ„Éù„É≥„Çπ„ÇíÂÆ£Ë®Ä„Åß„Åç„Åæ„Åô„ÄÇ\n+\n+„Åù„Çå„Çâ„ÅÆËøΩÂä†„É¨„Çπ„Éù„É≥„Çπ„ÅØ OpenAPI „Çπ„Ç≠„Éº„Éû„Å´Âê´„Åæ„Çå„ÄÅAPI „Éâ„Ç≠„É•„É°„É≥„Éà„Å´„ÇÇË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ\n+\n+„Åü„Å†„Åó„ÄÅ„Åù„Çå„Çâ„ÅÆËøΩÂä†„É¨„Çπ„Éù„É≥„Çπ„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÊåáÂÆö„Åó„Å¶ `JSONResponse` „Å™„Å©„ÅÆ `Response` „ÇíÁõ¥Êé•Ëøî„ÅôÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n+\n+## `model` „Çí‰Ωø„Å£„ÅüËøΩÂä†„É¨„Çπ„Éù„É≥„Çπ { #additional-response-with-model }\n+\n+*path operation „Éá„Ç≥„É¨„Éº„Çø*„Å´ `responses` „Éë„É©„É°„Éº„Çø„ÇíÊ∏°„Åõ„Åæ„Åô„ÄÇ\n+\n+„Åì„Çå„ÅØ `dict` „ÇíÂèó„ÅëÂèñ„Çä„ÄÅ„Ç≠„Éº„ÅØÂêÑ„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„ÉâÔºà‰æã: `200`Ôºâ„ÄÅÂÄ§„ÅØÂêÑ„É¨„Çπ„Éù„É≥„Çπ„ÅÆÊÉÖÂ†±„ÇíÂê´„ÇÄÂà•„ÅÆ `dict` „Åß„Åô„ÄÇ\n+\n+„Åù„Çå„Åû„Çå„ÅÆ„É¨„Çπ„Éù„É≥„Çπ `dict` „Å´„ÅØ„ÄÅ`response_model` „Å®ÂêåÊßò„Å´ Pydantic „É¢„Éá„É´„ÇíÊ†ºÁ¥ç„Åô„Çã `model` „Ç≠„Éº„ÇíÂê´„ÇÅ„Çâ„Çå„Åæ„Åô„ÄÇ\n+\n+FastAPI „ÅØ„Åù„ÅÆ„É¢„Éá„É´„Åã„Çâ JSON Schema „ÇíÁîüÊàê„Åó„ÄÅOpenAPI „ÅÆÈÅ©Âàá„Å™Â†¥ÊâÄ„Å´Âê´„ÇÅ„Åæ„Åô„ÄÇ\n+\n+‰æã„Åà„Å∞„ÄÅ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ `404` „Å® Pydantic „É¢„Éá„É´ `Message` „ÇíÊåÅ„Å§Âà•„ÅÆ„É¨„Çπ„Éù„É≥„Çπ„ÇíÂÆ£Ë®Ä„Åô„Çã„Å´„ÅØ„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´Êõ∏„Åë„Åæ„Åô:\n+\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n+\n+/// note | ÂÇôËÄÉ\n+\n+`JSONResponse` „ÇíÁõ¥Êé•Ëøî„ÅôÂøÖË¶Å„Åå„ÅÇ„ÇãÁÇπ„Å´Ê≥®ÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n+\n+///\n+\n+/// info | ÊÉÖÂ†±\n+\n+`model` „Ç≠„Éº„ÅØ OpenAPI „ÅÆ‰∏ÄÈÉ®„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n+\n+FastAPI „ÅØ„Åù„Åì„Åã„Çâ Pydantic „É¢„Éá„É´„ÇíÂèñÂæó„Åó„Å¶ JSON Schema „ÇíÁîüÊàê„Åó„ÄÅÈÅ©Âàá„Å™Â†¥ÊâÄ„Å´ÈÖçÁΩÆ„Åó„Åæ„Åô„ÄÇ\n+\n+ÈÅ©Âàá„Å™Â†¥ÊâÄ„ÅØÊ¨°„ÅÆ„Å®„Åä„Çä„Åß„Åô:\n+\n+- `content` „Ç≠„Éº„ÅÆ‰∏≠„ÄÇ„Åì„Çå„ÅØÂÄ§„Å®„Åó„Å¶Âà•„ÅÆ JSON „Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÔºà`dict`Ôºâ„ÇíÊåÅ„Å°„ÄÅ„Åù„ÅÆ‰∏≠„Å´Ê¨°„ÅåÂê´„Åæ„Çå„Åæ„Åô:\n+    - „É°„Éá„Ç£„Ç¢„Çø„Ç§„ÉóÔºà‰æã: `application/json`Ôºâ„Çí„Ç≠„Éº„Å®„Åó„ÄÅÂÄ§„Å®„Åó„Å¶„Åï„Çâ„Å´Âà•„ÅÆ JSON „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÊåÅ„Å°„ÄÅ„Åù„ÅÆ‰∏≠„Å´Ê¨°„ÅåÂê´„Åæ„Çå„Åæ„Åô:\n+        - `schema` „Ç≠„Éº„ÄÇÂÄ§„Å®„Åó„Å¶„É¢„Éá„É´Áî±Êù•„ÅÆ JSON Schema „ÇíÊåÅ„Å°„ÄÅ„Åì„Åì„ÅåÊ≠£„Åó„ÅÑÈÖçÁΩÆÂ†¥ÊâÄ„Åß„Åô„ÄÇ\n+            - FastAPI „ÅØ„Åì„Åì„Å´„ÄÅ„Çπ„Ç≠„Éº„Éû„ÇíÁõ¥Êé•Âüã„ÇÅËæº„ÇÄ‰ª£„Çè„Çä„Å´ OpenAPI ÂÜÖ„ÅÆ„Ç∞„É≠„Éº„Éê„É´„Å™ JSON Schema „Å∏„ÅÆÂèÇÁÖß„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ„Åì„Çå„Å´„Çà„Çä„ÄÅ‰ªñ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÇÑ„ÇØ„É©„Ç§„Ç¢„É≥„Éà„Åå„Åù„Çå„Çâ„ÅÆ JSON Schema „ÇíÁõ¥Êé•Âà©Áî®„Åó„ÄÅ„Çà„ÇäËâØ„ÅÑ„Ç≥„Éº„ÉâÁîüÊàê„ÉÑ„Éº„É´Á≠â„ÇíÊèê‰æõ„Åß„Åç„Åæ„Åô„ÄÇ\n+\n+///\n+\n+„Åì„ÅÆ *path operation* „ÅÆ„Åü„ÇÅ„Å´ OpenAPI „Å´ÁîüÊàê„Åï„Çå„Çã„É¨„Çπ„Éù„É≥„Çπ„ÅØÊ¨°„ÅÆ„Å®„Åä„Çä„Åß„Åô:\n+\n+\n```\n\n```diff\n@@ -16,7 +16,7 @@\n \n {* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n-/// warning | Ê≥®ÊÑè\n+/// warning\n \n ‰∏ä„ÅÆ‰æã„ÅÆ„Çà„ÅÜ„Å´ `Response` „ÇíÁõ¥Êé•Ëøî„Åô„Å®„ÄÅ„Åù„Çå„ÅØ„Åù„ÅÆ„Åæ„ÅæËøî„Åï„Çå„Åæ„Åô„ÄÇ\n \n@@ -38,4 +38,4 @@\n \n ËøΩÂä†„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ„Ç≥„Éº„Éâ„Å®„É¨„Çπ„Éù„É≥„Çπ„ÇíÁõ¥Êé•Ëøî„ÅôÂ†¥Âêà„ÄÅ„Åù„Çå„Çâ„ÅØ OpenAPI „Çπ„Ç≠„Éº„ÉûÔºàAPI „Éâ„Ç≠„É•„É°„É≥„ÉàÔºâ„Å´„ÅØÂê´„Åæ„Çå„Åæ„Åõ„Çì„ÄÇFastAPI „Å´„ÅØ„ÄÅ‰∫ãÂâç„Å´‰Ωï„ÅåËøî„Åï„Çå„Çã„Åã„ÇíÁü•„ÇãÊñπÊ≥ï„Åå„Å™„ÅÑ„Åã„Çâ„Åß„Åô„ÄÇ\n \n-„Åó„Åã„Åó„ÄÅ[Additional Responses](additional-responses.md){.internal-link target=_blank} „Çí‰Ωø„Å£„Å¶„Ç≥„Éº„ÉâÂÜÖ„Å´„Éâ„Ç≠„É•„É°„É≥„ÉàÂåñ„Åß„Åç„Åæ„Åô„ÄÇ\n+„Åó„Åã„Åó„ÄÅ[ËøΩÂä†„ÅÆ„É¨„Çπ„Éù„É≥„Çπ](additional-responses.md){.internal-link target=_blank} „Çí‰Ωø„Å£„Å¶„Ç≥„Éº„ÉâÂÜÖ„Å´„Éâ„Ç≠„É•„É°„É≥„ÉàÂåñ„Åß„Åç„Åæ„Åô„ÄÇ\n\n```\n\n```diff\n@@ -0,0 +1,163 @@\n+# È´òÂ∫¶„Å™‰æùÂ≠òÈñ¢‰øÇ { #advanced-dependencies }\n+\n+## „Éë„É©„É°„Éº„ÇøÂåñ„Åï„Çå„Åü‰æùÂ≠òÈñ¢‰øÇ { #parameterized-dependencies }\n+\n+„Åì„Çå„Åæ„ÅßË¶ã„Å¶„Åç„Åü‰æùÂ≠òÈñ¢‰øÇ„ÅØ„ÄÅÂõ∫ÂÆö„ÅÆÈñ¢Êï∞„Åæ„Åü„ÅØ„ÇØ„É©„Çπ„Åß„Åó„Åü„ÄÇ\n+\n+„Åó„Åã„Åó„ÄÅÂ§ö„Åè„ÅÆÁï∞„Å™„ÇãÈñ¢Êï∞„ÇÑ„ÇØ„É©„Çπ„ÇíÂÆ£Ë®Ä„Åõ„Åö„Å´„ÄÅ„Åù„ÅÆ‰æùÂ≠òÈñ¢‰øÇ„Å´„Éë„É©„É°„Éº„Çø„ÇíË®≠ÂÆö„Åó„Åü„ÅÑÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n+\n+„Åü„Å®„Åà„Å∞„ÄÅ„ÇØ„Ç®„É™„Éë„É©„É°„Éº„Çø `q` „Å´„ÄÅ„ÅÇ„ÇãÂõ∫ÂÆö„ÅÆÂÜÖÂÆπ„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Çã„Åã„ÇíÊ§úÊüª„Åô„Çã‰æùÂ≠òÈñ¢‰øÇ„ÅåÊ¨≤„Åó„ÅÑ„Å®„Åó„Åæ„Åô„ÄÇ\n+\n+„Åü„Å†„Åó„ÄÅ„Åù„ÅÆÂõ∫ÂÆö„ÅÆÂÜÖÂÆπ„ÅØ„Éë„É©„É°„Éº„ÇøÂåñ„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åó„Åü„ÅÑ„Åß„Åô„ÄÇ\n+\n+## \"callable\" „Å™„Ç§„É≥„Çπ„Çø„É≥„Çπ { #a-callable-instance }\n+\n+Python „Å´„ÅØ„ÄÅ„ÇØ„É©„Çπ„ÅÆ„Ç§„É≥„Çπ„Çø„É≥„Çπ„Çí \"callable\" „Å´„Åô„ÇãÊñπÊ≥ï„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\n+\n+„ÇØ„É©„ÇπËá™‰ΩìÔºà„Åì„Çå„ÅØ„Åô„Åß„Å´ callable „Åß„ÅôÔºâ„Åß„ÅØ„Å™„Åè„ÄÅ„Åù„ÅÆ„ÇØ„É©„Çπ„ÅÆ„Ç§„É≥„Çπ„Çø„É≥„Çπ„Åß„Åô„ÄÇ\n+\n+„Åù„ÅÆ„Åü„ÇÅ„Å´„ÅØ„ÄÅ`__call__` „É°„ÇΩ„ÉÉ„Éâ„ÇíÂÆ£Ë®Ä„Åó„Åæ„Åô:\n+\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n+\n+„Åì„ÅÆÂ†¥Âêà„ÄÅ„Åì„ÅÆ `__call__` „Åå„ÄÅ**FastAPI** „ÅåËøΩÂä†„ÅÆ„Éë„É©„É°„Éº„Çø„ÇÑ„Çµ„Éñ‰æùÂ≠òÈñ¢‰øÇ„ÇíÁ¢∫Ë™ç„Åô„Çã„Åü„ÇÅ„Å´‰Ωø„ÅÜ„ÇÇ„ÅÆ„Å´„Å™„Çä„ÄÅÂæå„Åß„ÅÇ„Å™„Åü„ÅÆ *path operation Èñ¢Êï∞* „ÅÆ„Éë„É©„É°„Éº„Çø„Å´ÂÄ§„ÇíÊ∏°„Åô„Åü„ÇÅ„Å´Âëº„Å≥Âá∫„Åï„Çå„Çã„ÇÇ„ÅÆ„Å´„Å™„Çä„Åæ„Åô„ÄÇ\n+\n+## „Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅÆ„Éë„É©„É°„Éº„ÇøÂåñ { #parameterize-the-instance }\n+\n+„Åù„Åó„Å¶„ÄÅ`__init__` „Çí‰Ωø„Å£„Å¶„ÄÅ‰æùÂ≠òÈñ¢‰øÇ„Çí„Äå„Éë„É©„É°„Éº„ÇøÂåñ„Äç„Åô„Çã„Åü„ÇÅ„Å´Âà©Áî®„Åß„Åç„Çã„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíÂÆ£Ë®Ä„Åß„Åç„Åæ„Åô:\n", "output": "Changes look good. This PR implements: üåê Update translations for ja (update-all)", "source": "pr", "type": "code_review", "pr_number": 188}
{"instruction": "Review the following code changes: üåê Update translations for de (update-all)", "input": "```diff\n@@ -26,7 +26,7 @@ Jedes dieser Response-`dict`s kann einen Schl√ºssel `model` haben, welcher ein P\n \n Um beispielsweise eine weitere Response mit dem Statuscode `404` und einem Pydantic-Modell `Message` zu deklarieren, k√∂nnen Sie schreiben:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Hinweis\n \n@@ -203,7 +203,7 @@ Sie k√∂nnen beispielsweise eine Response mit dem Statuscode `404` deklarieren, d\n \n Und eine Response mit dem Statuscode `200`, die Ihr `response_model` verwendet, aber ein benutzerdefiniertes Beispiel (`example`) enth√§lt:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n Es wird alles kombiniert und in Ihre OpenAPI eingebunden und in der API-Dokumentation angezeigt:\n \n\n```\n\n```diff\n@@ -18,23 +18,23 @@ Nicht die Klasse selbst (die bereits aufrufbar ist), sondern eine Instanz dieser\n \n Dazu deklarieren wir eine Methode `__call__`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n In diesem Fall ist dieses `__call__` das, was **FastAPI** verwendet, um nach zus√§tzlichen Parametern und Unterabh√§ngigkeiten zu suchen, und das ist es auch, was sp√§ter aufgerufen wird, um einen Wert an den Parameter in Ihrer *Pfadoperation-Funktion* zu √ºbergeben.\n \n ## Die Instanz parametrisieren { #parameterize-the-instance }\n \n Und jetzt k√∂nnen wir `__init__` verwenden, um die Parameter der Instanz zu deklarieren, die wir zum ‚ÄûParametrisieren‚Äú der Abh√§ngigkeit verwenden k√∂nnen:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n In diesem Fall wird **FastAPI** `__init__` nie ber√ºhren oder sich darum k√ºmmern, wir werden es direkt in unserem Code verwenden.\n \n ## Eine Instanz erstellen { #create-an-instance }\n \n Wir k√∂nnten eine Instanz dieser Klasse erstellen mit:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n Und auf diese Weise k√∂nnen wir unsere Abh√§ngigkeit ‚Äûparametrisieren‚Äú, die jetzt `\"bar\"` enth√§lt, als das Attribut `checker.fixed_content`.\n \n@@ -50,7 +50,7 @@ checker(q=\"somequery\")\n \n ... und √ºbergibt, was immer das als Wert dieser Abh√§ngigkeit in unserer *Pfadoperation-Funktion* zur√ºckgibt, als den Parameter `fixed_content_included`:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip | Tipp\n \n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+# Fortgeschrittene Python-Typen { #advanced-python-types }\n+\n+Hier sind einige zus√§tzliche Ideen, die beim Arbeiten mit Python-Typen n√ºtzlich sein k√∂nnten.\n+\n+## `Union` oder `Optional` verwenden { #using-union-or-optional }\n+\n+Wenn Ihr Code aus irgendeinem Grund nicht `|` verwenden kann, z. B. wenn es nicht in einer Typannotation ist, sondern in etwas wie `response_model=`, k√∂nnen Sie anstelle des senkrechten Strichs (`|`) `Union` aus `typing` verwenden.\n+\n+Zum Beispiel k√∂nnten Sie deklarieren, dass etwas ein `str` oder `None` sein k√∂nnte:\n+\n+\n```\n\n```diff\n@@ -32,11 +32,11 @@ Betrachten wir als einfaches Beispiel eine Dateistruktur √§hnlich der in [Gr√∂√ü\n \n Die Datei `main.py` h√§tte als Inhalt:\n \n-{* ../../docs_src/async_tests/app_a_py39/main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/main.py *}\n \n Die Datei `test_main.py` h√§tte die Tests f√ºr `main.py`, das k√∂nnte jetzt so aussehen:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py *}\n \n ## Es ausf√ºhren { #run-it }\n \n@@ -56,7 +56,7 @@ $ pytest\n \n Der Marker `@pytest.mark.anyio` teilt pytest mit, dass diese Testfunktion asynchron aufgerufen werden soll:\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[7] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[7] *}\n \n /// tip | Tipp\n \n@@ -66,7 +66,7 @@ Beachten Sie, dass die Testfunktion jetzt `async def` ist und nicht nur `def` wi\n \n Dann k√∂nnen wir einen `AsyncClient` mit der App erstellen und mit `await` asynchrone Requests an ihn senden.\n \n-{* ../../docs_src/async_tests/app_a_py39/test_main.py hl[9:12] *}\n+{* ../../docs_src/async_tests/app_a_py310/test_main.py hl[9:12] *}\n \n Das ist das √Ñquivalent zu:\n \n\n```\n\n```diff\n@@ -44,7 +44,7 @@ $ fastapi run --forwarded-allow-ips=\"*\"\n \n Angenommen, Sie definieren eine *Pfadoperation* `/items/`:\n \n-{* ../../docs_src/behind_a_proxy/tutorial001_01_py39.py hl[6] *}\n+{* ../../docs_src/behind_a_proxy/tutorial001_01_py310.py hl[6] *}\n \n Wenn der Client versucht, zu `/items` zu gehen, w√ºrde er standardm√§√üig zu `/items/` umgeleitet.\n \n@@ -115,7 +115,7 @@ In diesem Fall w√ºrde der urspr√ºngliche Pfad `/app` tats√§chlich unter `/api/v1\n \n Auch wenn Ihr gesamter Code unter der Annahme geschrieben ist, dass es nur `", "output": "Code Review for: üåê Update translations for de (update-all)\n\nüìù **docs/de/docs/tutorial/dependencies/dependencies-with-yield.md**: Typo. Adds an extra \"h\". One of those strange LLM errors.\n\nüìù **docs/de/docs/tutorial/security/first-steps.md**: The English docs still write it bold, so I suggest undo.\n\nüìù **docs/de/docs/_llm-test.md**: Two `s` is an error here. Revert.\n\nüìù **docs/de/docs/_llm-test.md**: Ditto.\n\nüìù **docs/de/docs/features.md**: The change to dfn is good, but revert to `‚ÄûKomponenten‚Äú, ‚ÄûResourcen‚Äú, ‚ÄûDienste‚Äú, ‚ÄûDienstanbieter‚Äú`. The English docs also have these words in quotes.\n\n", "source": "pr", "type": "code_review", "pr_number": 187}
{"instruction": "Review this code change in `docs/de/docs/tutorial/dependencies/dependencies-with-yield.md`", "input": "```diff\n@@ -57,25 +57,25 @@ Sie k√∂nnen also mit `except SomeException` diese bestimmte Exception innerhalb\n \n Auf die gleiche Weise k√∂nnen Sie `finally` verwenden, um sicherzustellen, dass die Exit-Schritte ausgef√ºhrt werden, unabh√§ngig davon, ob eine Exception geworfen wurde oder nicht.\n \n-{* ../../docs_src/dependencies/tutorial007_py39.py hl[3,5] *}\n+{* ../../docs_src/dependencies/tutorial007_py310.py hl[3,5] *}\n \n ## Unterabh√§ngigkeiten mit `yield` { #sub-dependencies-with-yield }\n \n-Sie k√∂nnen Unterabh√§ngigkeiten und ‚ÄûB√§ume‚Äú von Unterabh√§ngigkeiten beliebiger Gr√∂√üe und Form haben, und einige oder alle davon k√∂nnen `yield` verwenden.\n+Sie k√∂nnen Unterabh√§ngigkeiten und ‚ÄûB√§ume‚Äú von Unterabhh√§ngigkeiten beliebiger Gr√∂√üe und Form haben, und einige oder alle davon k√∂nnen `yield` verwenden.\n\n```", "output": "Typo. Adds an extra \"h\". One of those strange LLM errors.", "source": "pr_review", "type": "inline_review", "pr_number": 187}
{"instruction": "Review this code change in `docs/de/docs/tutorial/security/first-steps.md`", "input": "```diff\n@@ -111,10 +111,10 @@ Betrachten wir es also aus dieser vereinfachten Sicht:\n * Der Benutzer klickt im Frontend, um zu einem anderen Abschnitt der Frontend-Web-Anwendung zu gelangen.\n * Das Frontend muss weitere Daten von der API abrufen.\n     * Es ben√∂tigt jedoch eine Authentifizierung f√ºr diesen bestimmten Endpunkt.\n-    * Um sich also bei unserer API zu authentifizieren, sendet es einen Header `Authorization` mit dem Wert `Bearer ` plus dem Token.\n+    * Um sich also bei unserer API zu authentifizieren, sendet es einen `Authorization`-Header mit dem Wert `Bearer ` plus dem Token.\n     * Wenn der Token `foobar` enthielte, w√§re der Inhalt des `Authorization`-Headers: `Bearer foobar`.\n \n-## **FastAPI**s `OAuth2PasswordBearer` { #fastapis-oauth2passwordbearer }\n+## FastAPIs `OAuth2PasswordBearer` { #fastapis-oauth2passwordbearer }\n\n```", "output": "The English docs still write it bold, so I suggest undo.", "source": "pr_review", "type": "inline_review", "pr_number": 187}
{"instruction": "Review this code change in `docs/de/docs/_llm-test.md`", "input": "```diff\n@@ -1,12 +1,12 @@\n # LLM-Testdatei { #llm-test-file }\n \n-Dieses Dokument testet, ob das <abbr title=\"Large Language Model ‚Äì Gro√ües Sprachmodell\">LLM</abbr>, das die Dokumentation √ºbersetzt, den <abbr title=\"General Prompt ‚Äì Allgemeiner Prompt\">`general_prompt`</abbr> in `scripts/translate.py` und den sprachspezifischen Prompt in `docs/{language code}/llm-prompt.md` versteht. Der sprachspezifische Prompt wird an `general_prompt` angeh√§ngt.\n+Dieses Dokument testet, ob das <abbr title=\"Large Language Model ‚Äì Gro√ües Sprachmodell\">LLM</abbr>, das die Dokumentation √ºbersetzt, den <abbr title=\"General Prompt ‚Äì Allgemeiner Prompt\">`general_prompt`</abbr> in `scripts/translate.py` und den sprachspezifischen Prompt in `docs/{language code}/llm-prompt.md` versteht. Der sprachsspezifische Prompt wird an `general_prompt` angeh√§ngt.\n\n```", "output": "Two `s` is an error here. Revert.", "source": "pr_review", "type": "inline_review", "pr_number": 187}
{"instruction": "Review this code change in `docs/de/docs/features.md`", "input": "```diff\n@@ -136,7 +136,7 @@ Alles als wiederverwendbare Tools und Komponenten gebaut, die einfach in Ihre Sy\n \n ### Dependency Injection { #dependency-injection }\n \n-FastAPI enth√§lt ein extrem einfach zu verwendendes, aber extrem m√§chtiges <abbr title='auch bekannt als ‚ÄûKomponenten‚Äú, ‚ÄûResourcen‚Äú, ‚ÄûDienste‚Äú, ‚ÄûDienstanbieter‚Äú'><strong>Dependency Injection</strong></abbr> System.\n+FastAPI enth√§lt ein extrem einfach zu verwendendes, aber extrem m√§chtiges <dfn title='auch bekannt als: Komponenten, Ressourcen, Dienste, Dienstanbieter'><strong>Dependency Injection</strong></dfn> System.\n\n```", "output": "The change to dfn is good, but revert to `‚ÄûKomponenten‚Äú, ‚ÄûResourcen‚Äú, ‚ÄûDienste‚Äú, ‚ÄûDienstanbieter‚Äú`. The English docs also have these words in quotes.", "source": "pr_review", "type": "inline_review", "pr_number": 187}
{"instruction": "Review the following code changes: üåê Update translations for fr (update-all and add-missing)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# Fichier de test LLM { #llm-test-file }\n+\n+Ce document teste si le <abbr title=\"Large Language Model - Grand mod√®le de langage\">LLM</abbr>, qui traduit la documentation, comprend le `general_prompt` dans `scripts/translate.py` et l‚Äôinvite sp√©cifique √† la langue dans `docs/{language code}/llm-prompt.md`. L‚Äôinvite sp√©cifique √† la langue est ajout√©e √† la fin de `general_prompt`.\n+\n+Les tests ajout√©s ici seront visibles par tous les concepteurs d‚Äôinvites sp√©cifiques √† chaque langue.\n+\n+Utiliser comme suit :\n+\n+* Avoir une invite sp√©cifique √† la langue - `docs/{language code}/llm-prompt.md`.\n+* Effectuer une nouvelle traduction de ce document dans votre langue cible souhait√©e (voir par exemple la commande `translate-page` de `translate.py`). Cela cr√©era la traduction sous `docs/{language code}/docs/_llm-test.md`.\n+* V√©rifier si tout est correct dans la traduction.\n+* Si n√©cessaire, am√©liorer votre invite sp√©cifique √† la langue, l‚Äôinvite g√©n√©rale, ou le document anglais.\n+* Corriger ensuite manuellement les probl√®mes restants dans la traduction, afin que ce soit une bonne traduction.\n+* Retraduire, en ayant la bonne traduction en place. Le r√©sultat id√©al serait que le LLM ne fasse plus aucun changement √† la traduction. Cela signifie que l‚Äôinvite g√©n√©rale et votre invite sp√©cifique √† la langue sont aussi bonnes que possible (il fera parfois quelques changements apparemment al√©atoires, la raison √©tant que <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">les LLM ne sont pas des algorithmes d√©terministes</a>).\n+\n+Les tests :\n+\n+## Extraits de code { #code-snippets }\n+\n+//// tab | Test\n+\n+Ceci est un extrait de code : `foo`. Et ceci est un autre extrait de code : `bar`. Et encore un autre : `baz quux`.\n+\n+////\n+\n+//// tab | Info\n+\n+Le contenu des extraits de code doit √™tre laiss√© tel quel.\n+\n+Voir la section `### Content of code snippets` dans l‚Äôinvite g√©n√©rale dans `scripts/translate.py`.\n+\n+////\n+\n+## Guillemets { #quotes }\n+\n+//// tab | Test\n+\n+Hier, mon ami a √©crit : ¬´ Si vous √©crivez ¬´ incorrectly ¬ª correctement, vous l‚Äôavez √©crit de fa√ßon incorrecte ¬ª. √Ä quoi j‚Äôai r√©pondu : ¬´ Correct, mais ‚Äòincorrectly‚Äô est incorrectement non pas ‚Äò¬´ incorrectly ¬ª‚Äô ¬ª.\n+\n+/// note | Remarque\n+\n+Le LLM traduira probablement ceci de mani√®re erron√©e. Il est seulement int√©ressant de voir s‚Äôil conserve la traduction corrig√©e lors d‚Äôune retraduction.\n+\n+///\n+\n+////\n+\n+//// tab | Info\n+\n+Le concepteur de l‚Äôinvite peut choisir s‚Äôil souhaite convertir les guillemets neutres en guillemets typographiques. Il est acceptable de les laisser tels quels.\n+\n+Voir par exemple la section `### Quotes` dans `docs/de/llm-prompt.md`.\n+\n+////\n+\n+## Guillemets dans les extraits de code { #quotes-in-code-snippets }\n+\n+//// tab | Test\n+\n+`pip install \"foo[bar]\"`\n+\n+Exemples de litt√©raux de cha√Æne dans des extraits de code : `\"this\"`, `'that'`.\n+\n+Un exemple difficile de litt√©raux de cha√Æne dans des extraits de code : `f\"I\n\n```\n\n```diff\n@@ -0,0 +1,3 @@\n+# √Ä propos { #about }\n+\n+√Ä propos de FastAPI, de sa conception, de ses sources d'inspiration et plus encore. ü§ì\n\n```\n\n```diff\n@@ -8,7 +8,7 @@ Si vous d√©butez avec **FastAPI**, vous n'en aurez peut-√™tre pas besoin.\n \n ///\n \n-Vous pouvez d√©clarer des r√©ponses suppl√©mentaires, avec des codes HTTP, des types de m√©dias, des descriptions, etc.\n+Vous pouvez d√©clarer des r√©ponses suppl√©mentaires, avec des codes d'√©tat suppl√©mentaires, des types de m√©dias, des descriptions, etc.\n \n Ces r√©ponses suppl√©mentaires seront incluses dans le sch√©ma OpenAPI, elles appara√Ætront donc √©galement dans la documentation de l'API.\n \n@@ -26,7 +26,7 @@ Chacun de ces `dict` de r√©ponse peut avoir une cl√© `model`, contenant un mod√®\n \n Par exemple, pour d√©clarer une autre r√©ponse avec un code HTTP `404` et un mod√®le Pydantic `Message`, vous pouvez √©crire¬†:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Remarque\n \n@@ -203,7 +203,7 @@ Par exemple, vous pouvez d√©clarer une r√©ponse avec un code HTTP `404` qui util\n \n Et une r√©ponse avec un code HTTP `200` qui utilise votre `response_model`, mais inclut un `example` personnalis√©¬†:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n Tout sera combin√© et inclus dans votre OpenAPI, et affich√© dans la documentation de l'API¬†:\n \n\n```\n\n```diff\n@@ -36,6 +36,6 @@ Pour plus de commodit√©s, **FastAPI** fournit les objets `starlette.responses` s\n \n ## Documents OpenAPI et API { #openapi-and-api-docs }\n \n-Si vous renvoyez directement des codes HTTP et des r√©ponses suppl√©mentaires, ils ne seront pas inclus dans le sch√©ma OpenAPI (la documentation de l'API), car FastAPI n'a aucun moyen de savoir √† l'avance ce que vous allez renvoyer.\n+Si vous renvoyez directement des codes HTTP et des r√©ponses suppl√©mentaires, ils ne", "output": "Changes look good. This PR implements: üåê Update translations for fr (update-all and add-missing)", "source": "pr", "type": "code_review", "pr_number": 186}
{"instruction": "Review the following code changes: üåê Update translations for zh-hant (update-all and add-missing)", "input": "```diff\n@@ -0,0 +1,503 @@\n+# LLM Ê∏¨Ë©¶Ê™îÊ°à { #llm-test-file }\n+\n+Êú¨Êñá‰ª∂Áî®‰æÜÊ∏¨Ë©¶Áî®ÊñºÁøªË≠ØÊñá‰ª∂ÁöÑ <abbr title=\"Large Language Model - Â§ßÂûãË™ûË®ÄÊ®°Âûã\">LLM</abbr> ÊòØÂê¶ÁêÜËß£ `scripts/translate.py` ‰∏≠ÁöÑ `general_prompt`Ôºå‰ª•Âèä `docs/{language code}/llm-prompt.md` ‰∏≠ÁöÑË™ûË®ÄÁâπÂÆöÊèêÁ§∫„ÄÇË™ûË®ÄÁâπÂÆöÊèêÁ§∫ÊúÉÈôÑÂä†Âú® `general_prompt` ÂæåÈù¢„ÄÇ\n+\n+Ê≠§ËôïÊñ∞Â¢ûÁöÑÊ∏¨Ë©¶ÊúÉÊèê‰æõÁµ¶ÊâÄÊúâË™ûË®ÄÁâπÂÆöÊèêÁ§∫ÁöÑË®≠Ë®àËÄÖÂèÉËÄÉ„ÄÇ\n+\n+‰ΩøÁî®ÊñπÂºèÔºö\n+\n+* Ê∫ñÂÇôË™ûË®ÄÁâπÂÆöÊèêÁ§∫ - `docs/{language code}/llm-prompt.md`„ÄÇ\n+* ÈáùÂ∞çÊú¨Êñá‰ª∂ÂÅö‰∏ÄÊ¨°ÂÖ®Êñ∞ÁöÑÁøªË≠ØÁÇ∫‰Ω†ÊÉ≥Ë¶ÅÁöÑÁõÆÊ®ôË™ûË®ÄÔºà‰æãÂ¶Ç‰ΩøÁî® `translate.py` ÁöÑ `translate-page` Êåá‰ª§Ôºâ„ÄÇÈÄôÊúÉÂú® `docs/{language code}/docs/_llm-test.md` Áî¢ÁîüÁøªË≠ØÊ™î„ÄÇ\n+* Ê™¢Êü•ÁøªË≠ØÊòØÂê¶Ê≠£Á¢∫„ÄÇ\n+* Â¶ÇÊúâÈúÄË¶ÅÔºåÊîπÈÄ≤‰Ω†ÁöÑË™ûË®ÄÁâπÂÆöÊèêÁ§∫„ÄÅÈÄöÁî®ÊèêÁ§∫ÔºåÊàñËã±ÊñáÂéüÊñá„ÄÇ\n+* ÁÑ∂ÂæåÊâãÂãï‰øÆÊ≠£ÁøªË≠Ø‰∏≠Ââ©‰∏ãÁöÑÂïèÈ°åÔºåËÆìÂÆÉÊàêÁÇ∫‰∏ÄÂÄãÂ•ΩÁöÑË≠ØÊñá„ÄÇ\n+* ÈáçÊñ∞ÁøªË≠ØÔºå‰∏¶‰øùÁïôÈÄô‰ªΩÂ•ΩÁöÑË≠ØÊñá„ÄÇÁêÜÊÉ≥ÁµêÊûúÊòØ LLM ‰∏çÂÜçÂ∞çË©≤Ë≠ØÊñáÂÅö‰ªª‰ΩïËÆäÊõ¥„ÄÇÈÄô‰ª£Ë°®ÈÄöÁî®ÊèêÁ§∫Ëàá‰Ω†ÁöÑË™ûË®ÄÁâπÂÆöÊèêÁ§∫Â∑≤Á∂ìÁõ°ÂèØËÉΩÂÆåÂñÑÔºàÊúâÊôÇÂÆÉ‰ªçÂèØËÉΩÂÅöÂá∫ÂπæÂÄãÁúã‰ººÈö®Ê©üÁöÑËÆäÊõ¥ÔºåÂéüÂõ†ÊòØ<a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLMs ‰∏¶ÈùûÊ±∫ÂÆöÊÄßÊºîÁÆóÊ≥ï</a>Ôºâ„ÄÇ\n+\n+Ê∏¨Ë©¶Ôºö\n+\n+## Á®ãÂºèÁ¢ºÁâáÊÆµ { #code-snippets }\n+\n+//// tab | Ê∏¨Ë©¶\n+\n+ÈÄôÊòØ‰∏ÄÂÄãÁ®ãÂºèÁ¢ºÁâáÊÆµÔºö`foo`„ÄÇÈÄôÊòØÂè¶‰∏ÄÂÄãÁ®ãÂºèÁ¢ºÁâáÊÆµÔºö`bar`„ÄÇÈÇÑÊúâ‰∏ÄÂÄãÔºö`baz quux`„ÄÇ\n+\n+////\n+\n+//// tab | Ë≥áË®ä\n+\n+Á®ãÂºèÁ¢ºÁâáÊÆµÂÖßÁöÑÂÖßÂÆπÊáâ‰øùÊåÅÂéüÊ®£„ÄÇ\n+\n+Ë´ãË¶ã `scripts/translate.py` ‰∏≠ÈÄöÁî®ÊèêÁ§∫ÁöÑ `### Content of code snippets` Â∞èÁØÄ„ÄÇ\n+\n+////\n+\n+## ÂºïËôü { #quotes }\n+\n+//// tab | Ê∏¨Ë©¶\n+\n+Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\".\n+\n+/// note | Ê≥®ÊÑè\n+\n+LLM ÂæàÂèØËÉΩÊúÉÊääÈÄôÊÆµÁøªË≠ØÈåØ„ÄÇÈáçÈªûÂè™Âú®ÊñºÈáçÊñ∞ÁøªË≠ØÊôÇÊòØÂê¶ËÉΩ‰øùÁïôÂ∑≤‰øÆÊ≠£ÁöÑÁøªË≠Ø„ÄÇ\n+\n+///\n+\n+////\n+\n+//// tab | Ë≥áË®ä\n+\n+ÊèêÁ§∫Ë®≠Ë®àËÄÖÂèØ‰ª•ÈÅ∏ÊìáÊòØÂê¶Â∞á‰∏≠ÊÄßÂºïËôüËΩâÊèõÁÇ∫ÊéíÂç∞ÂºïËôü„ÄÇ‰øùÁïôÂéüÊ®£‰πüÂèØ‰ª•„ÄÇ\n+\n+‰æãÂ¶ÇË´ãË¶ã `docs/de/llm-prompt.md` ‰∏≠ÁöÑ `### Quotes` Â∞èÁØÄ„ÄÇ\n+\n+////\n+\n+## Á®ãÂºèÁ¢ºÁâáÊÆµ‰∏≠ÁöÑÂºïËôü { #quotes-in-code-snippets }\n+\n+//// tab | Ê∏¨Ë©¶\n+\n+`pip install \"foo[bar]\"`\n+\n+Á®ãÂºèÁ¢ºÁâáÊÆµ‰∏≠Â≠ó‰∏≤Â∏∏ÂÄºÁöÑ‰æãÂ≠êÔºö\"this\"„ÄÅ'that'„ÄÇ\n+\n+ËºÉÈõ£ÁöÑÁ®ãÂºèÁ¢ºÁâáÊÆµ‰∏≠Â≠ó‰∏≤Â∏∏ÂÄº‰æãÂ≠êÔºö`f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+ÈÄ≤ÈöéÔºö`Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | Ë≥áË®ä\n+\n+... ‰∏çÈÅéÔºåÁ®ãÂºèÁ¢ºÁâáÊÆµ‰∏≠ÁöÑÂºïËôüÂøÖÈ†à‰øùÊåÅÂéüÊ®£„ÄÇ\n+\n+////\n+\n+## Á®ãÂºèÁ¢ºÂçÄÂ°ä { #code-blocks }\n+\n+//// tab | Ê∏¨Ë©¶\n+\n+‰∏ÄÂÄã Bash Á®ãÂºèÁ¢ºÁØÑ‰æã...\n+\n+\n```\n\n```diff\n@@ -0,0 +1,247 @@\n+# OpenAPI ‰∏≠ÁöÑÈ°çÂ§ñÂõûÊáâ { #additional-responses-in-openapi }\n+\n+/// warning | Ë≠¶Âëä\n+\n+ÈÄôÊòØ‰∏ÄÂÄãÂÅèÈÄ≤ÈöéÁöÑ‰∏ªÈ°å„ÄÇ\n+\n+Â¶ÇÊûú‰Ω†ÂâõÈñãÂßã‰ΩøÁî® **FastAPI**ÔºåÂ§ßÂ§öÊÉÖÊ≥Å‰∏ã‰∏çÈúÄË¶ÅÁî®Âà∞ÂÆÉ„ÄÇ\n+\n+///\n+\n+‰Ω†ÂèØ‰ª•ÂÆ£ÂëäÈ°çÂ§ñÁöÑÂõûÊáâÔºåÂåÖÂê´È°çÂ§ñÁöÑÁãÄÊÖãÁ¢º„ÄÅÂ™íÈ´îÂûãÂà•„ÄÅÊèèËø∞Á≠â„ÄÇ\n+\n+ÈÄô‰∫õÈ°çÂ§ñÂõûÊáâÊúÉË¢´ÂåÖÂê´Âú® OpenAPI ‰∏≠ÔºåÂõ†Ê≠§‰πüÊúÉÈ°ØÁ§∫Âú® API Êñá‰ª∂Ë£°„ÄÇ\n+\n+‰ΩÜÂ∞çÊñºÈÄô‰∫õÈ°çÂ§ñÂõûÊáâÔºå‰Ω†ÂøÖÈ†àÁõ¥Êé•ÂõûÂÇ≥ÂÉè `JSONResponse` ÈÄôÊ®£ÁöÑ `Response`Ôºå‰∏¶ÂåÖÂê´‰Ω†ÁöÑÁãÄÊÖãÁ¢ºËàáÂÖßÂÆπ„ÄÇ\n+\n+## ‰ΩøÁî® `model` ÁöÑÈ°çÂ§ñÂõûÊáâ { #additional-response-with-model }\n+\n+‰Ω†ÂèØ‰ª•Âú®‰Ω†ÁöÑ„ÄåË∑ØÂæëÊìç‰ΩúË£ùÈ£æÂô®„Äç‰∏≠ÂÇ≥ÂÖ•ÂèÉÊï∏ `responses`„ÄÇ\n+\n+ÂÆÉÊé•Êî∂‰∏ÄÂÄã `dict`ÔºöÈçµÊòØÂêÑÂõûÊáâÁöÑÁãÄÊÖãÁ¢ºÔºà‰æãÂ¶Ç `200`ÔºâÔºåÂÄºÊòØÂè¶‰∏ÄÂÄã `dict`ÔºåÂÖ∂‰∏≠ÂåÖÂê´ÊØèÂÄãÂõûÊáâÁöÑË≥áË®ä„ÄÇ\n+\n+ÊØèÂÄãÂõûÊáâÁöÑ `dict` ÈÉΩÂèØ‰ª•Êúâ‰∏ÄÂÄãÈçµ `model`ÔºåÂåÖÂê´‰∏ÄÂÄã Pydantic Ê®°ÂûãÔºåËàá `response_model` È°û‰ºº„ÄÇ\n+\n+**FastAPI** ÊúÉÂèñÁî®Ë©≤Ê®°Âûã„ÄÅÁî¢ÁîüÂÖ∂ JSON SchemaÔºå‰∏¶ÊääÂÆÉÊîæÂà∞ OpenAPI ‰∏≠Ê≠£Á¢∫ÁöÑ‰ΩçÁΩÆ„ÄÇ\n+\n+‰æãÂ¶ÇÔºåË¶ÅÂÆ£Âëä‰∏ÄÂÄãÁãÄÊÖãÁ¢ºÁÇ∫ `404` ÁöÑÈ°çÂ§ñÂõûÊáâÔºå‰∏¶‰ΩøÁî® Pydantic Ê®°Âûã `Message`Ôºå‰Ω†ÂèØ‰ª•ÈÄôÊ®£ÂØ´Ôºö\n+\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n+\n+/// note | Ê≥®ÊÑè\n+\n+Ë´ãË®ò‰Ωè‰Ω†ÂøÖÈ†àÁõ¥Êé•ÂõûÂÇ≥ `JSONResponse`„ÄÇ\n+\n+///\n+\n+/// info | Ë™™Êòé\n+\n+`model` ÈÄôÂÄãÈçµ‰∏çÂ±¨Êñº OpenAPI„ÄÇ\n+\n+**FastAPI** ÊúÉÂæûÈÄôË£°ÂèñÂá∫ Pydantic Ê®°ÂûãÔºåÁî¢Áîü JSON SchemaÔºå‰∏¶ÊîæÂà∞Ê≠£Á¢∫‰ΩçÁΩÆ„ÄÇ\n+\n+Ê≠£Á¢∫ÁöÑ‰ΩçÁΩÆÊòØÔºö\n+\n+* Âú® `content` ÈÄôÂÄãÈçµ‰∏≠ÔºåÂÖ∂ÂÄºÊòØ‰∏ÄÂÄã JSON Áâ©‰ª∂Ôºà`dict`ÔºâÔºåÂåÖÂê´Ôºö\n+    * ‰∏ÄÂÄãÂ™íÈ´îÂûãÂà•‰ΩúÁÇ∫ÈçµÔºå‰æãÂ¶Ç `application/json`ÔºåÂÖ∂ÂÄºÊòØÂè¶‰∏ÄÂÄã JSON Áâ©‰ª∂ÔºåÁï∂‰∏≠ÂåÖÂê´Ôºö\n+        * Èçµ `schema`ÔºåÂÖ∂ÂÄºÊòØË©≤Ê®°ÂûãÁöÑ JSON SchemaÔºåÈÄôË£°Â∞±ÊòØÊ≠£Á¢∫ÁöÑ‰ΩçÁΩÆ„ÄÇ\n+            * **FastAPI** ÊúÉÂú®ÈÄôË£°Âä†ÂÖ•‰∏ÄÂÄãÊåáÂêë‰Ω† OpenAPI ‰∏≠ÂÖ®Âüü JSON Schemas ÁöÑÂèÉÁÖßÔºåËÄå‰∏çÊòØÁõ¥Êé•ÊääÂÆÉÂµåÂÖ•„ÄÇÂ¶ÇÊ≠§‰∏Ä‰æÜÔºåÂÖ∂‰ªñÊáâÁî®ËàáÁî®Êà∂Á´ØÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÈÇ£‰∫õ JSON SchemasÔºåÊèê‰æõÊõ¥Â•ΩÁöÑÁ®ãÂºèÁ¢ºÁî¢ÁîüÂ∑•ÂÖ∑Á≠â„ÄÇ\n+\n+///\n+\n+ÈÄôÂÄãË∑ØÂæëÊìç‰ΩúÂú® OpenAPI ‰∏≠Áî¢ÁîüÁöÑÂõûÊáâÂ∞áÊúÉÊòØÔºö\n+\n+\n```\n\n```diff\n@@ -0,0 +1,41 @@\n+# È°çÂ§ñÁöÑÁãÄÊÖãÁ¢º { #additional-status-codes }\n+\n+Âú®È†êË®≠ÊÉÖÊ≥Å‰∏ãÔºå**FastAPI** ÊúÉ‰ΩøÁî® `JSONResponse` ÂÇ≥ÂõûÂõûÊáâÔºå‰∏¶Êää‰Ω†Âæû‰Ω†ÁöÑ„ÄåË∑ØÂæëÊìç‰ΩúÔºàpath operationÔºâ„ÄçÂõûÂÇ≥ÁöÑÂÖßÂÆπÊîæÈÄ≤Ë©≤ `JSONResponse` ‰∏≠„ÄÇ\n+\n+ÂÆÉÊúÉ‰ΩøÁî®È†êË®≠ÁöÑÁãÄÊÖãÁ¢ºÔºåÊàñ‰Ω†Âú®Ë∑ØÂæëÊìç‰Ωú‰∏≠Ë®≠ÂÆöÁöÑÁãÄÊÖãÁ¢º„ÄÇ\n+\n+## È°çÂ§ñÁöÑÁãÄÊÖãÁ¢º { #additional-status-codes_1 }\n+\n+Â¶ÇÊûú‰Ω†ÊÉ≥Âú®‰∏ªË¶ÅÁãÄÊÖãÁ¢º‰πãÂ§ñÂÜçÂõûÂÇ≥ÂÖ∂‰ªñÁãÄÊÖãÁ¢ºÔºåÂèØ‰ª•Áõ¥Êé•ÂõûÂÇ≥‰∏ÄÂÄã `Response`Ôºà‰æãÂ¶Ç `JSONResponse`ÔºâÔºå‰∏¶Áõ¥Êé•Ë®≠ÂÆö‰Ω†ÊÉ≥Ë¶ÅÁöÑÈ°çÂ§ñÁãÄÊÖãÁ¢º„ÄÇ\n+\n+‰æãÂ¶ÇÔºå‰Ω†ÊÉ≥Ë¶ÅÊúâ‰∏ÄÂÄãÂÖÅË®±Êõ¥Êñ∞È†ÖÁõÆÁöÑË∑ØÂæëÊìç‰ΩúÔºåÊàêÂäüÊôÇÂõûÂÇ≥ HTTP ÁãÄÊÖãÁ¢º 200 \"OK\"„ÄÇ\n+\n+‰ΩÜ‰Ω†‰πüÂ∏åÊúõÂÆÉËÉΩÊé•ÂèóÊñ∞È†ÖÁõÆÔºõÁï∂È†ÖÁõÆÂÖàÂâç‰∏çÂ≠òÂú®ÊôÇÂ∞±Âª∫Á´ãÂÆÉÂÄëÔºå‰∏¶ÂõûÂÇ≥ HTTP ÁãÄÊÖãÁ¢º 201 \"Created\"„ÄÇ\n+\n+Ë¶ÅÈÅîÊàêÈÄôÈªûÔºåÂåØÂÖ• `JSONResponse`ÔºåÁõ¥Êé•Âú®ÈÇ£Ë£°ÂõûÂÇ≥ÂÖßÂÆπÔºå‰∏¶Ë®≠ÂÆö‰Ω†ÊÉ≥Ë¶ÅÁöÑ `status_code`Ôºö\n+\n+{* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n+\n+/// warning\n+\n+Áï∂‰Ω†Áõ¥Êé•ÂõûÂÇ≥‰∏ÄÂÄã `Response`ÔºàÂ∞±ÂÉè‰∏äÈù¢ÁöÑÁØÑ‰æãÔºâÔºåÂÆÉÊúÉÂéüÂ∞Å‰∏çÂãïÂú∞Ë¢´ÈÄÅÂá∫„ÄÇ\n+\n+‰∏çÊúÉÂÜçÁ∂ìÈÅéÊ®°ÂûãÂ∫èÂàóÂåñÁ≠âËôïÁêÜ„ÄÇ\n+\n+Ë´ãÁ¢∫Ë™çÂÖ∂‰∏≠ÂåÖÂê´‰Ω†Ë¶ÅÁöÑË≥áÊñôÔºå‰∏îÂêÑÂÄºÊòØÂêàÊ≥ïÁöÑ JSONÔºàÂ¶ÇÊûú‰Ω†‰ΩøÁî®ÁöÑÊòØ `JSONResponse`Ôºâ„ÄÇ\n+\n+///\n+\n+/// note | Ê≥®ÊÑè\n+\n+‰Ω†‰πüÂèØ‰ª•‰ΩøÁî® `from starlette.responses import JSONResponse`„ÄÇ\n+\n+**FastAPI** ‰πüÂ∞áÂêåÊ®£ÁöÑ `starlette.responses` ‰ª• `fastapi.responses` ÁöÑÂΩ¢ÂºèÊèê‰æõÔºåÁ¥îÁ≤πÊòØÁÇ∫‰∫ÜËÆì‰Ω†ÔºàÈñãÁôºËÄÖÔºâÊõ¥Êñπ‰æø„ÄÇ‰ΩÜÂ§ßÂ§öÊï∏ÂèØÁî®ÁöÑÂõûÊáâÈ°ûÂà•ÂÖ∂ÂØ¶ÈÉΩÁõ¥Êé•‰æÜËá™ Starlette„ÄÇ`status` ‰πü‰∏ÄÊ®£„ÄÇ\n+\n+///\n+\n+## OpenAPI Ëàá API Êñá‰ª∂ { #openapi-and-api-docs }\n+\n+Â¶ÇÊûú‰Ω†Áõ¥Êé•ÂõûÂÇ≥È°çÂ§ñÁöÑÁãÄÊÖãÁ¢ºËàáÂõûÊáâÔºåÂÆÉÂÄë‰∏çÊúÉË¢´ÂåÖÂê´ÈÄ≤ OpenAPI Á∂±Ë¶ÅÔºàAPI Êñá‰ª∂Ôºâ‰∏≠ÔºåÂõ†ÁÇ∫ FastAPI ÁÑ°Ê≥ï‰∫ãÂÖàÁü•ÈÅì‰Ω†ÊúÉÂõûÂÇ≥‰ªÄÈ∫º„ÄÇ\n+\n+‰ΩÜ‰Ω†ÂèØ‰ª•Âú®Á®ãÂºèÁ¢º‰∏≠Ë£úÂÖÖÊñá‰ª∂Ôºå‰ΩøÁî®Ôºö[È°çÂ§ñÁöÑÂõûÊáâ](additional-responses.md){.internal-link target=_blank}„ÄÇ\n\n```\n\n```diff\n@@ -0,0 +1,163 @@\n+# ÈÄ≤ÈöéÁõ∏‰æù { #advanced-dependencies }\n+\n+## ÂèÉÊï∏ÂåñÁöÑÁõ∏‰æù { #parameterized-dependencies }\n+\n+Âà∞ÁõÆÂâçÁÇ∫Ê≠¢ÁúãÂà∞ÁöÑÁõ∏‰æùÈÉΩÊòØÂõ∫ÂÆöÁöÑÂáΩÂºèÊàñÈ°ûÂà•„ÄÇ\n+\n+‰ΩÜÊúâ‰∫õÊÉÖÊ≥Å‰∏ãÔºå‰Ω†ÂèØËÉΩÊÉ≥Ë¶ÅËÉΩÁÇ∫Áõ∏‰æùË®≠ÂÆöÂèÉÊï∏ÔºåËÄå‰∏çÂøÖÂÆ£ÂëäË®±Â§ö‰∏çÂêåÁöÑÂáΩÂºèÊàñÈ°ûÂà•„ÄÇ\n+\n+ÊÉ≥ÂÉèÊàëÂÄëÊÉ≥Ë¶Å‰∏ÄÂÄãÁõ∏‰æùÔºåÁî®‰æÜÊ™¢Êü•Êü•Ë©¢ÂèÉÊï∏ `q` ÊòØÂê¶ÂåÖÂê´Êüê‰∫õÂõ∫ÂÆöÂÖßÂÆπ„ÄÇ\n+\n+ÂêåÊôÇÊàëÂÄëÂ∏åÊúõËÉΩÂ∞áÈÇ£ÂÄãÂõ∫ÂÆöÂÖßÂÆπÂèÉÊï∏Âåñ„ÄÇ\n+\n+## „Äåcallable„ÄçÁöÑÂØ¶‰æã { #a-callable-instance }\n+\n+Âú® Python ‰∏≠Êúâ‰∏ÄÁ®ÆÊñπÂºèÂèØ‰ª•ËÆì‰∏ÄÂÄãÈ°ûÂà•ÁöÑÂØ¶‰æãËÆäÊàê„Äåcallable„Äç„ÄÇ\n+\n+‰∏çÊòØÈ°ûÂà•Êú¨Ë∫´ÔºàÈ°ûÂà•Êú¨‰æÜÂ∞±ÂèØÂëºÂè´ÔºâÔºåËÄåÊòØË©≤È°ûÂà•ÁöÑÂØ¶‰æã„ÄÇ\n+\n+Ë¶ÅÂÅöÂà∞ÈÄôÈªûÔºåÊàëÂÄëÂÆ£Âëä‰∏ÄÂÄã `__call__` ÊñπÊ≥ïÔºö\n+\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n+\n+Âú®ÈÄôÂÄãÊÉÖÂ¢É‰∏≠Ôºå**FastAPI** ÊúÉÁî®ÈÄôÂÄã `__call__` ‰æÜÊ™¢Êü•È°çÂ§ñÁöÑÂèÉÊï∏ËàáÂ≠êÁõ∏‰æùÔºå‰∏¶Âú®‰πãÂæåÂëºÂè´ÂÆÉÔºåÊääÂõûÂÇ≥ÂÄºÂÇ≥ÈÅûÁµ¶‰Ω†ÁöÑ„ÄåË∑ØÂæëÊìç‰ΩúÂáΩÂºè„Äç‰∏≠ÁöÑÂèÉÊï∏„ÄÇ\n+\n+## ËÆìÂØ¶‰æãÂèØÂèÉÊï∏Âåñ { #parameterize-the-instance }\n+\n+Êé•ËëóÔºåÊàëÂÄëÂèØ‰ª•Áî® `__init__` ‰æÜÂÆ£ÂëäÈÄôÂÄãÂØ¶‰æãÁöÑÂèÉÊï∏ÔºåÁî®‰ª•„ÄåÂèÉÊï∏Âåñ„ÄçÈÄôÂÄãÁõ∏‰æùÔºö\n+\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n+\n+Âú®ÈÄôË£°Ôºå**FastAPI** ÂÆåÂÖ®‰∏çÊúÉÊé•Ëß∏ÊàñÂú®ÊÑè `__in", "output": "Changes look good. This PR implements: üåê Update translations for zh-hant (update-all and add-missing)", "source": "pr", "type": "code_review", "pr_number": 185}
{"instruction": "Review the following code changes: üåê Update translations for uk (add-missing)", "input": "```diff\n@@ -0,0 +1,502 @@\n+# –¢–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª LLM { #llm-test-file }\n+\n+–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ —Ä–æ–∑—É–º—ñ—î <abbr title=\"Large Language Model - –í–µ–ª–∏–∫–∞ –º–æ–≤–Ω–∞ –º–æ–¥–µ–ª—å\">LLM</abbr>, —è–∫–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥–∞—î –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é, `general_prompt` —É `scripts/translate.py` —Ç–∞ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—É –ø—ñ–¥—Å–∫–∞–∑–∫—É –≤ `docs/{language code}/llm-prompt.md`. –ú–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ –ø—ñ–¥—Å–∫–∞–∑–∫–∞ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ `general_prompt`.\n+\n+–¢–µ—Å—Ç–∏, –¥–æ–¥–∞–Ω—ñ —Ç—É—Ç, –ø–æ–±–∞—á–∞—Ç—å —É—Å—ñ –∞–≤—Ç–æ—Ä–∏ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –ø—ñ–¥—Å–∫–∞–∑–æ–∫.\n+\n+–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–∞–∫:\n+\n+* –ú–∞–π—Ç–µ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—É –ø—ñ–¥—Å–∫–∞–∑–∫—É - `docs/{language code}/llm-prompt.md`.\n+* –ó—Ä–æ–±—ñ—Ç—å —Å–≤—ñ–∂–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ —Ü—å–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –±–∞–∂–∞–Ω—É —Ü—ñ–ª—å–æ–≤—É –º–æ–≤—É (–¥–∏–≤., –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–º–∞–Ω–¥—É `translate-page` —É `translate.py`). –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –ø–µ—Ä–µ–∫–ª–∞–¥ —É `docs/{language code}/docs/_llm-test.md`.\n+* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –≤—Å–µ –≥–∞—Ä–∞–∑–¥ —É –ø–µ—Ä–µ–∫–ª–∞–¥—ñ.\n+* –ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –ø–æ–∫—Ä–∞—â—ñ—Ç—å –≤–∞—à—É –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—É –ø—ñ–¥—Å–∫–∞–∑–∫—É, –∑–∞–≥–∞–ª—å–Ω—É –ø—ñ–¥—Å–∫–∞–∑–∫—É –∞–±–æ –∞–Ω–≥–ª—ñ–π—Å—å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç.\n+* –ü–æ—Ç—ñ–º –≤—Ä—É—á–Ω—É –≤–∏–ø—Ä–∞–≤—Ç–µ —Ä–µ—à—Ç—É –ø—Ä–æ–±–ª–µ–º —É –ø–µ—Ä–µ–∫–ª–∞–¥—ñ, —â–æ–± –≤—ñ–Ω –±—É–≤ —è–∫—ñ—Å–Ω–∏–º.\n+* –ü–µ—Ä–µ–∫–ª–∞–¥—ñ—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ, –º–∞—é—á–∏ —è–∫—ñ—Å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ –Ω–∞ –º—ñ—Å—Ü—ñ. –Ü–¥–µ–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –∫–æ–ª–∏ LLM –±—ñ–ª—å—à–µ –Ω–µ –≤–Ω–æ—Å–∏—Ç—å –∑–º—ñ–Ω –¥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–∞–≥–∞–ª—å–Ω–∞ –ø—ñ–¥—Å–∫–∞–∑–∫–∞ —Ç–∞ –≤–∞—à–∞ –º–æ–≤–Ω–æ-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ –ø—ñ–¥—Å–∫–∞–∑–∫–∞ –Ω–∞—Å—Ç—ñ–ª—å–∫–∏ –¥–æ–±—Ä—ñ, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –º–æ–∂–ª–∏–≤–æ (—ñ–Ω–∫–æ–ª–∏ –≤—ñ–Ω —Ä–æ–±–∏—Ç–∏–º–µ –∫—ñ–ª—å–∫–∞, –∑–¥–∞–≤–∞–ª–æ—Å—è –±, –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∑–º—ñ–Ω, –ø—Ä–∏—á–∏–Ω–∞ –≤ —Ç–æ–º—É, —â–æ <a href=\"https://doublespeak.chat/#/handbook#deterministic-output\" class=\"external-link\" target=\"_blank\">LLM-–∏ –Ω–µ —î –¥–µ—Ç–µ—Ä–º—ñ–Ω—ñ—Å—Ç–∏—á–Ω–∏–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏</a>).\n+\n+–¢–µ—Å—Ç–∏:\n+\n+## –§—Ä–∞–≥–º–µ–Ω—Ç–∏ –∫–æ–¥—É { #code-snippets }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+–¶–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥—É: `foo`. –ê —Ü–µ —â–µ –æ–¥–∏–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥—É: `bar`. –Ü —â–µ –æ–¥–∏–Ω: `baz quux`.\n+\n+////\n+\n+//// tab | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+–í–º—ñ—Å—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ –∫–æ–¥—É —Å–ª—ñ–¥ –∑–∞–ª–∏—à–∞—Ç–∏ –±–µ–∑ –∑–º—ñ–Ω.\n+\n+–î–∏–≤. —Ä–æ–∑–¥—ñ–ª `### Content of code snippets` –≤ –∑–∞–≥–∞–ª—å–Ω—ñ–π –ø—ñ–¥—Å–∫–∞–∑—Ü—ñ –≤ `scripts/translate.py`.\n+\n+////\n+\n+## –¶–∏—Ç–∞—Ç–∏ { #quotes }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+–í—á–æ—Ä–∞ –º—ñ–π –¥—Ä—É–≥ –Ω–∞–ø–∏—Å–∞–≤: ¬´–Ø–∫—â–æ –≤–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ø–∏—à–µ—Ç–µ \"incorrectly\", –≤–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ —Ü–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ¬ª. –ù–∞ —â–æ —è –≤—ñ–¥–ø–æ–≤—ñ–≤: ¬´–ü—Ä–∞–≤–∏–ª—å–Ω–æ, –∞–ª–µ 'incorrectly' - —Ü–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∞ –Ω–µ '\"incorrectly\"'¬ª.\n+\n+/// note | –ü—Ä–∏–º—ñ—Ç–∫–∞\n+\n+LLM, –π–º–æ–≤—ñ—Ä–Ω–æ, –ø–µ—Ä–µ–∫–ª–∞–¥–µ —Ü–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –¶—ñ–∫–∞–≤–æ –ª–∏—à–µ —Ç–µ, —á–∏ –∑–±–µ—Ä–µ–∂–µ –≤—ñ–Ω –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ –ø—ñ–¥ —á–∞—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É.\n+\n+///\n+\n+////\n+\n+//// tab | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+–ê–≤—Ç–æ—Ä –ø—ñ–¥—Å–∫–∞–∑–∫–∏ –º–æ–∂–µ –æ–±—Ä–∞—Ç–∏, —á–∏ –∫–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ñ –ª–∞–ø–∫–∏ –≤ —Ç–∏–ø–æ–≥—Ä–∞—Ñ—Å—å–∫—ñ. –ú–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ —è–∫ —î.\n+\n+–î–∏–≤., –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–æ–∑–¥—ñ–ª `### Quotes` —É `docs/de/llm-prompt.md`.\n+\n+////\n+\n+## –õ–∞–ø–∫–∏ —É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥—É { #quotes-in-code-snippets }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+`pip install \"foo[bar]\"`\n+\n+–ü—Ä–∏–∫–ª–∞–¥–∏ —Å—Ç—Ä–æ–∫–æ–≤–∏—Ö –ª—ñ—Ç–µ—Ä–∞–ª—ñ–≤ —É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥—É: `\"this\"`, `'that'`.\n+\n+–°–∫–ª–∞–¥–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Å—Ç—Ä–æ–∫–æ–≤–∏—Ö –ª—ñ—Ç–µ—Ä–∞–ª—ñ–≤ —É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö –∫–æ–¥—É: `f\"I like {'oranges' if orange else \"apples\"}\"`\n+\n+–•–∞—Ä–¥–∫–æ—Ä: `Yesterday, my friend wrote: \"If you spell incorrectly correctly, you have spelled it incorrectly\". To which I answered: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"`\n+\n+////\n+\n+//// tab | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+... –û–¥–Ω–∞–∫ –ª–∞–ø–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ –∫–æ–¥—É –º–∞—é—Ç—å –∑–∞–ª–∏—à–∞—Ç–∏—Å—è —è–∫ —î.\n+\n+////\n+\n+## –ë–ª–æ–∫–∏ –∫–æ–¥—É { #code-blocks }\n+\n+//// tab | –¢–µ—Å—Ç\n+\n+–ü—Ä–∏–∫–ª–∞–¥\n\n```\n\n```diff\n@@ -0,0 +1,3 @@\n+# –ü—Ä–æ { #about }\n+\n+–ü—Ä–æ FastAPI, –π–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É–≤–∞–Ω–Ω—è, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è —Ç–∞ —ñ–Ω—à–µ. ü§ì\n\n```\n\n```diff\n@@ -0,0 +1,247 @@\n+# –î–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ OpenAPI { #additional-responses-in-openapi }\n+\n+/// warning | –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è\n+\n+–¶–µ –¥–æ–≤–æ–ª—ñ –ø—Ä–æ—Å—É–Ω—É—Ç–∞ —Ç–µ–º–∞.\n+\n+–Ø–∫—â–æ –≤–∏ –ª–∏—à–µ –ø–æ—á–∏–Ω–∞—î—Ç–µ –∑ **FastAPI**, –π–º–æ–≤—ñ—Ä–Ω–æ, –≤–∞–º —Ü–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.\n+\n+///\n+\n+–í–∏ –º–æ–∂–µ—Ç–µ –æ–≥–æ–ª–æ—Å–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –∫–æ–¥–∞–º–∏ —Å—Ç–∞—Ç—É—Å—É, —Ç–∏–ø–∞–º–∏ –º–µ–¥—ñ–∞, –æ–ø–∏—Å–∞–º–∏ —Ç–æ—â–æ.\n+\n+–¶—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±—É–¥–µ –≤–∫–ª—é—á–µ–Ω–æ –¥–æ —Å—Ö–µ–º–∏ OpenAPI, —Ç–æ–∂ –≤–æ–Ω–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —ñ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó API.\n+\n+–ê–ª–µ –¥–ª—è —Ç–∞–∫–∏—Ö –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `Response` –Ω–∞ –∫—à—Ç–∞–ª—Ç `JSONResponse` –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ, —ñ–∑ –ø–æ—Ç—Ä—ñ–±–Ω–∏–º –∫–æ–¥–æ–º —Å—Ç–∞—Ç—É—Å—É —Ç–∞ –≤–º—ñ—Å—Ç–æ–º.\n+\n+## –î–æ–¥–∞—Ç–∫–æ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑ `model` { #additional-response-with-model }\n+\n+–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç–∏ –≤–∞—à–∏–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º –æ–ø–µ—Ä–∞—Ü—ñ–π —à–ª—è—Ö—É –ø–∞—Ä–∞–º–µ—Ç—Ä `responses`.\n+\n+–í—ñ–Ω –ø—Ä–∏–π–º–∞—î `dict`: –∫–ª—é—á—ñ - —Ü–µ –∫–æ–¥–∏ —Å—Ç–∞—Ç—É—Å—É –¥–ª—è –∫–æ–∂–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `200`), –∞ –∑–Ω–∞—á–µ–Ω–Ω—è - —ñ–Ω—à—ñ `dict` –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –¥–ª—è –∫–æ–∂–Ω–æ—ó –∑ –Ω–∏—Ö.\n+\n+–ö–æ–∂–µ–Ω —ñ–∑ —Ü–∏—Ö —Å–ª–æ–≤–Ω–∏–∫—ñ–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –º–æ–∂–µ –º–∞—Ç–∏ –∫–ª—é—á `model`, —â–æ –º—ñ—Å—Ç–∏—Ç—å Pydantic-–º–æ–¥–µ–ª—å, –ø–æ–¥—ñ–±–Ω–æ –¥–æ `response_model`.\n+\n+**FastAPI** –≤—ñ–∑—å–º–µ —Ü—é –º–æ–¥–µ–ª—å, –∑–≥–µ–Ω–µ—Ä—É—î —ó—ó –°—Ö–µ–º—É JSON —ñ –¥–æ–¥–∞—Å—Ç—å —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –º—ñ—Å—Ü–µ –≤ OpenAPI.\n+\n+–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —â–æ–± –æ–≥–æ–ª–æ—Å–∏—Ç–∏ —ñ–Ω—à—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑ –∫–æ–¥–æ–º —Å—Ç–∞—Ç—É—Å—É `404` —ñ Pydantic-–º–æ–¥–µ–ª–ª—é `Message`, –≤–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏:\n+\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n+\n+/// note | –ü—Ä–∏–º—ñ—Ç–∫–∞\n+\n+–ú–∞–π—Ç–µ –Ω–∞ —É–≤–∞–∑—ñ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `JSONResponse` –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ.\n+\n+///\n+\n+/// info | –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è\n+\n+–ö–ª—é—á `model` –Ω–µ —î —á–∞—Å—Ç–∏–Ω–æ—é OpenAPI.\n+\n+**FastAPI** –≤—ñ–∑—å–º–µ –∑–≤—ñ–¥—Ç–∏ Pydantic-–º–æ–¥–µ–ª—å, –∑–≥–µ–Ω–µ—Ä—É—î –°—Ö–µ–º—É JSON —ñ –ø–æ–º—ñ—Å—Ç–∏—Ç—å —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –º—ñ—Å—Ü–µ.\n+\n+–í—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –º—ñ—Å—Ü–µ —Ü–µ:\n+\n+- –£ –∫–ª—é—á—ñ `content`, –∑–Ω–∞—á–µ–Ω–Ω—è–º —è–∫–æ–≥–æ —î —ñ–Ω—à–∏–π JSON-–æ–±'—î–∫—Ç (`dict`), —â–æ –º—ñ—Å—Ç–∏—Ç—å:\n+    - –ö–ª—é—á —ñ–∑ —Ç–∏–ø–æ–º –º–µ–¥—ñ–∞, –Ω–∞–ø—Ä. `application/json`, –∑–Ω–∞—á–µ–Ω–Ω—è–º —è–∫–æ–≥–æ —î —ñ–Ω—à–∏–π JSON-–æ–±'—î–∫—Ç, —â–æ –º—ñ—Å—Ç–∏—Ç—å:\n+        - –ö–ª—é—á `schema`, –∑–Ω–∞—á–µ–Ω–Ω—è–º —è–∫–æ–≥–æ —î –°—Ö–µ–º–∞ JSON –∑ –º–æ–¥–µ–ª—ñ - –æ—Å—å —Ü–µ —ñ —î –ø—Ä–∞–≤–∏–ª—å–Ω–µ –º—ñ—Å—Ü–µ.\n+            - **FastAPI** –¥–æ–¥–∞—î —Ç—É", "output": "Changes look good. This PR implements: üåê Update translations for uk (add-missing)", "source": "pr", "type": "code_review", "pr_number": 184}
{"instruction": "Review the following code changes: üåê Update translations for ko (update-all and add-missing)", "input": "```diff\n@@ -35,7 +35,7 @@\n \n //// tab | ÌÖåÏä§Ìä∏\n \n-Ïñ¥Ï†ú Ï†ú ÏπúÍµ¨Í∞Ä Ïù¥Î†áÍ≤å ÏçºÏäµÎãàÎã§: \"If you spell incorrectly correctly, you have spelled it incorrectly\". Ïù¥Ïóê Ï†ÄÎäî Ïù¥Î†áÍ≤å ÎãµÌñàÏäµÎãàÎã§: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\"\".\n+Ïñ¥Ï†ú Ï†ú ÏπúÍµ¨Í∞Ä Ïù¥Î†áÍ≤å ÏçºÏäµÎãàÎã§: \"If you spell incorrectly correctly, you have spelled it incorrectly\". Ïù¥Ïóê Ï†ÄÎäî Ïù¥Î†áÍ≤å ÎãµÌñàÏäµÎãàÎã§: \"Correct, but 'incorrectly' is incorrectly not '\"incorrectly\"'\".\n \n /// note | Ï∞∏Í≥†\n \n@@ -256,15 +256,15 @@ works(foo=\"bar\")  # Ïù¥Í±¥ ÎèôÏûëÌï©ÎãàÎã§ üéâ\n \n //// tab | ÌÖåÏä§Ìä∏\n \n-* ÎãπÏã†\n-* ÎãπÏã†Ïùò\n+* Ïó¨Îü¨Î∂Ñ\n+* Ïó¨Îü¨Î∂ÑÏùò\n \n * Ïòà: (e.g.)\n * Îì± (etc.)\n \n-* `int`Î°úÏÑúÏùò `foo`\n-* `str`Î°úÏÑúÏùò `bar`\n-* `list`Î°úÏÑúÏùò `baz`\n+* `foo`Î°úÏÑúÏùò `int`\n+* `bar`Î°úÏÑúÏùò `str`\n+* `baz`Î°úÏÑúÏùò `list`\n \n * ÌäúÌÜ†Î¶¨Ïñº - ÏÇ¨Ïö©Ïûê Í∞ÄÏù¥Îìú\n * Í≥†Í∏â ÏÇ¨Ïö©Ïûê Í∞ÄÏù¥Îìú\n\n```\n\n```diff\n@@ -26,7 +26,7 @@\n \n ÏòàÎ•º Îì§Ïñ¥, ÏÉÅÌÉú ÏΩîÎìú `404`ÏôÄ Pydantic Î™®Îç∏ `Message`Î•º ÏÇ¨Ïö©ÌïòÎäî Îã§Î•∏ ÏùëÎãµÏùÑ ÏÑ†Ïñ∏ÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏûëÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n-{* ../../docs_src/additional_responses/tutorial001_py39.py hl[18,22] *}\n+{* ../../docs_src/additional_responses/tutorial001_py310.py hl[18,22] *}\n \n /// note | Ï∞∏Í≥†\n \n@@ -203,7 +203,7 @@\n \n ÎòêÌïú `response_model`ÏùÑ ÏÇ¨Ïö©ÌïòÎäî ÏÉÅÌÉú ÏΩîÎìú `200` ÏùëÎãµÏùÑ ÏÑ†Ïñ∏ÌïòÎêò, Ïª§Ïä§ÌÖÄ `example`ÏùÑ Ìè¨Ìï®Ìï† ÏàòÎèÑ ÏûàÏäµÎãàÎã§:\n \n-{* ../../docs_src/additional_responses/tutorial003_py39.py hl[20:31] *}\n+{* ../../docs_src/additional_responses/tutorial003_py310.py hl[20:31] *}\n \n Ïù¥ Î™®Îì† ÎÇ¥Ïö©ÏùÄ OpenAPIÏóê Í≤∞Ìï©ÎêòÏñ¥ Ìè¨Ìï®ÎêòÍ≥†, API Î¨∏ÏÑúÏóê ÌëúÏãúÎê©ÎãàÎã§:\n \n\n```\n\n```diff\n@@ -1,22 +1,22 @@\n # Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú { #additional-status-codes }\n \n-Í∏∞Î≥∏Ï†ÅÏúºÎ°ú **FastAPI**Îäî ÏùëÎãµÏùÑ `JSONResponse`Î•º ÏÇ¨Ïö©ÌïòÏó¨ Î∞òÌôòÌïòÎ©∞, *Í≤ΩÎ°ú ÏûëÏóÖ(path operation)*ÏóêÏÑú Î∞òÌôòÌïú ÎÇ¥Ïö©ÏùÑ Ìï¥Îãπ `JSONResponse` ÏïàÏóê ÎÑ£Ïñ¥ Î∞òÌôòÌï©ÎãàÎã§.\n+Í∏∞Î≥∏Ï†ÅÏúºÎ°ú **FastAPI**Îäî ÏùëÎãµÏùÑ `JSONResponse`Î•º ÏÇ¨Ïö©ÌïòÏó¨ Î∞òÌôòÌïòÎ©∞, *Í≤ΩÎ°ú Ï≤òÎ¶¨*ÏóêÏÑú Î∞òÌôòÌïú ÎÇ¥Ïö©ÏùÑ Ìï¥Îãπ `JSONResponse` ÏïàÏóê ÎÑ£Ïñ¥ Î∞òÌôòÌï©ÎãàÎã§.\n \n-Í∏∞Î≥∏ ÏÉÅÌÉú ÏΩîÎìú ÎòêÎäî *Í≤ΩÎ°ú ÏûëÏóÖ*ÏóêÏÑú ÏÑ§Ï†ïÌïú ÏÉÅÌÉú ÏΩîÎìúÎ•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.\n+Í∏∞Î≥∏ ÏÉÅÌÉú ÏΩîÎìú ÎòêÎäî *Í≤ΩÎ°ú Ï≤òÎ¶¨*ÏóêÏÑú ÏÑ§Ï†ïÌïú ÏÉÅÌÉú ÏΩîÎìúÎ•º ÏÇ¨Ïö©Ìï©ÎãàÎã§.\n \n ## Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìú { #additional-status-codes_1 }\n \n Í∏∞Î≥∏ ÏÉÅÌÉú ÏΩîÎìúÏôÄ Î≥ÑÎèÑÎ°ú Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìúÎ•º Î∞òÌôòÌïòÎ†§Î©¥ `JSONResponse`ÏôÄ Í∞ôÏù¥ `Response`Î•º ÏßÅÏ†ë Î∞òÌôòÌïòÍ≥† Ï∂îÍ∞Ä ÏÉÅÌÉú ÏΩîÎìúÎ•º ÏßÅÏ†ë ÏÑ§Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.\n \n-ÏòàÎ•º Îì§Ïñ¥ Ìï≠Î™©ÏùÑ ÏóÖÎç∞Ïù¥Ìä∏Ìï† Ïàò ÏûàÎäî *Í≤ΩÎ°ú ÏûëÏóÖ*Ïù¥ ÏûàÍ≥† ÏÑ±Í≥µ Ïãú 200 ‚ÄúOK‚ÄùÏùò HTTP ÏÉÅÌÉú ÏΩîÎìúÎ•º Î∞òÌôòÌïúÎã§Í≥† Í∞ÄÏ†ïÌï¥ Î≥¥Í≤†ÏäµÎãàÎã§.\n+ÏòàÎ•º Îì§Ïñ¥ Ìï≠Î™©ÏùÑ ÏóÖÎç∞Ïù¥Ìä∏Ìï† Ïàò ÏûàÎäî *Í≤ΩÎ°ú Ï≤òÎ¶¨*Í∞Ä ÏûàÍ≥† ÏÑ±Í≥µ Ïãú 200 ‚ÄúOK‚ÄùÏùò HTTP ÏÉÅÌÉú ÏΩîÎìúÎ•º Î∞òÌôòÌïúÎã§Í≥† Í∞ÄÏ†ïÌï¥ Î≥¥Í≤†ÏäµÎãàÎã§.\n \n ÌïòÏßÄÎßå ÏÉàÎ°úÏö¥ Ìï≠Î™©ÏùÑ ÌóàÏö©ÌïòÍ∏∞Î•º ÏõêÌï† Í≤ÉÏûÖÎãàÎã§. Í∑∏Î¶¨Í≥† Ìï≠Î™©Ïù¥ Ïù¥Ï†ÑÏóê Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏïòÎã§Î©¥ Ïù¥Î•º ÏÉùÏÑ±ÌïòÍ≥† HTTP ÏÉÅÌÉú ÏΩîÎìú 201 \"Created\"Î•º Î∞òÌôòÌï©ÎãàÎã§.\n \n Ïù¥Î•º ÏúÑÌï¥ÏÑúÎäî `JSONResponse`Î•º Í∞ÄÏ†∏ÏôÄÏÑú ÏõêÌïòÎäî `status_code`Î•º ÏÑ§Ï†ïÌïòÏó¨ ÏΩòÌÖêÏ∏†Î•º ÏßÅÏ†ë Î∞òÌôòÌï©ÎãàÎã§:\n \n {* ../../docs_src/additional_status_codes/tutorial001_an_py310.py hl[4,25] *}\n \n-/// warning | Í≤ΩÍ≥†\n+/// warning\n \n ÏúÑÏùò ÏòàÏ†úÏ≤òÎüº `Response`Î•º ÏßÅÏ†ë Î∞òÌôòÌïòÎ©¥ Î∞îÎ°ú Î∞òÌôòÎê©ÎãàÎã§.\n \n\n```\n\n```diff\n@@ -18,7 +18,7 @@ PythonÏóêÎäî ÌÅ¥ÎûòÏä§Ïùò Ïù∏Ïä§ÌÑ¥Ïä§Î•º \"Ìò∏Ï∂ú Í∞ÄÎä•\"ÌïòÍ≤å ÎßåÎìúÎäî Î∞©Î≤ï\n \n Ïù¥Î•º ÏúÑÌï¥ `__call__` Î©îÏÑúÎìúÎ•º ÏÑ†Ïñ∏Ìï©ÎãàÎã§:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[12] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[12] *}\n \n Ïù¥ Í≤ΩÏö∞, **FastAPI**Îäî Ï∂îÍ∞Ä Îß§Í∞úÎ≥ÄÏàòÏôÄ ÌïòÏúÑ ÏùòÏ°¥ÏÑ±ÏùÑ ÌôïÏù∏ÌïòÍ∏∞ ÏúÑÌï¥ `__call__`ÏùÑ ÏÇ¨Ïö©ÌïòÍ≤å ÎêòÎ©∞,\n ÎÇòÏ§ëÏóê *Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*ÏóêÏÑú Îß§Í∞úÎ≥ÄÏàòÏóê Í∞íÏùÑ Ï†ÑÎã¨Ìï† Îïå Ïù¥Î•º Ìò∏Ï∂úÌïòÍ≤å Îê©ÎãàÎã§.\n@@ -27,15 +27,15 @@ PythonÏóêÎäî ÌÅ¥ÎûòÏä§Ïùò Ïù∏Ïä§ÌÑ¥Ïä§Î•º \"Ìò∏Ï∂ú Í∞ÄÎä•\"ÌïòÍ≤å ÎßåÎìúÎäî Î∞©Î≤ï\n \n Ïù¥Ï†ú `__init__`ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏùòÏ°¥ÏÑ±ÏùÑ \"Îß§Í∞úÎ≥ÄÏàòÌôî\"Ìï† Ïàò ÏûàÎäî Ïù∏Ïä§ÌÑ¥Ïä§Ïùò Îß§Í∞úÎ≥ÄÏàòÎ•º ÏÑ†Ïñ∏Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[9] *}\n \n Ïù¥ Í≤ΩÏö∞, **FastAPI**Îäî `__init__`Ïóê Ï†ÑÌòÄ Í¥ÄÏó¨ÌïòÏßÄ ÏïäÏúºÎ©∞, Ïö∞Î¶¨Îäî Ïù¥ Î©îÏÑúÎìúÎ•º ÏΩîÎìúÏóêÏÑú ÏßÅÏ†ë ÏÇ¨Ïö©ÌïòÍ≤å Îê©ÎãàÎã§.\n \n ## Ïù∏Ïä§ÌÑ¥Ïä§ ÏÉùÏÑ±ÌïòÍ∏∞ { #create-an-instance }\n \n Îã§ÏùåÍ≥º Í∞ôÏù¥ Ïù¥ ÌÅ¥ÎûòÏä§Ïùò Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[18] *}\n \n Ïù¥Î†áÍ≤å ÌïòÎ©¥ `checker.fixed_content` ÏÜçÏÑ±Ïóê `\"bar\"`ÎùºÎäî Í∞íÏùÑ Îã¥ÏïÑ ÏùòÏ°¥ÏÑ±ÏùÑ \"Îß§Í∞úÎ≥ÄÏàòÌôî\"Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n \n@@ -51,7 +51,7 @@ checker(q=\"somequery\")\n \n ...Í∑∏Î¶¨Í≥† Ïù¥Îïå Î∞òÌôòÎêòÎäî Í∞íÏùÑ *Í≤ΩÎ°ú Ï≤òÎ¶¨ Ìï®Ïàò*Ïùò ÏùòÏ°¥ÏÑ± Í∞íÏúºÎ°ú, `fixed_content_included` Îß§Í∞úÎ≥ÄÏàòÏóê Ï†ÑÎã¨Ìï©ÎãàÎã§:\n \n-{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n+{* ../../docs_src/dependencies/tutorial011_an_py310.py hl[22] *}\n \n /// tip | ÌåÅ\n \n\n```\n\n```diff\n@@ -0,0 +1,61 @@\n+# Í≥†Í∏â Python ÌÉÄÏûÖ { #advanced-python-types }\n+\n+Python ÌÉÄÏûÖÏùÑ Îã§Î£∞ Îïå Ïú†Ïö©Ìï† Ïàò ÏûàÎäî Î™á Í∞ÄÏßÄ Ï∂îÍ∞Ä ÏïÑÏù¥ÎîîÏñ¥Î•º ÏÜåÍ∞úÌï©ÎãàÎã§.\n+\n+## `Union` ÎòêÎäî `Optional` ÏÇ¨Ïö© { #using-union-or-optional }\n+\n+Ïñ¥Îñ§ Ïù¥Ïú†Î°ú ÏΩîÎìúÏóêÏÑú `|`Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÎã§Î©¥, ÏòàÎ•º Îì§Ïñ¥ ÌÉÄÏûÖ Ïñ¥ÎÖ∏ÌÖåÏù¥ÏÖòÏù¥ ÏïÑÎãàÎùº `response_model=` Í∞ôÏùÄ Í≥≥Ïù¥ÎùºÎ©¥, ÌååÏù¥ÌîÑ Î¨∏Ïûê(`|`) ÎåÄÏã† `typing`Ïùò `Union`ÏùÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n+\n+ÏòàÎ•º Îì§Ïñ¥, Ïñ¥Îñ§ Í∞íÏù¥ `str` ÎòêÎäî `None`Ïù¥ Îê† Ïàò ÏûàÎã§Í≥† ÏÑ†Ïñ∏Ìï† Ïàò ÏûàÏäµÎãàÎã§:\n+\n+\n```", "output": "Changes look good. This PR implements: üåê Update translations for ko (update-all and add-missing)", "source": "pr", "type": "code_review", "pr_number": 183}
{"instruction": "Fix the following bug: fix: propagate Mount objects when using include_router", "input": "## Description\n\nFixes #10180\n\nWhen an `APIRouter` with mounted sub-applications is included into a FastAPI app via `include_router()`, the `Mount` routes were silently ignored. This caused sub-apps mounted on a router to return 404 when accessed through the main app.\n\n## Root Cause\n\n`include_router()` in `routing.py` iterates over router routes and handles:\n- `APIRoute`\n- `routing.Route`\n- `APIWebSocketRoute`\n- `routing.WebSocketRoute`\n\n...but **never `routing.Mount`**, so mounted sub-apps were simply dropped.\n\nAdditionally, `APIRouter.mount()` is inherited from Starlette's `Router.mount()` which does **not** apply `self.prefix` to the stored path (unlike `add_api_route()` which uses `self.prefix + path`). So the fix must apply both the `include_router` prefix and the router's own prefix when propagating `Mount` routes.\n\n## Fix\n\nAdded a single `elif` branch to handle `routing.Mount` in `include_router()`:\n\n```python\nelif isinstance(route, routing.Mount):\n    self.mount(prefix + router.prefix + route.path, route.app, name=route.name)\n```\n\n## Tests\n\nAdded `tests/test_router_mount.py` covering:\n\n1. `APIRouter` with prefix + mounted sub-app ‚Üí accessible at `/{router_prefix}/{mount_path}/...`\n2. `APIRouter` without prefix + mounted sub-app ‚Üí accessible at `/{mount_path}/...`\n3. `include_router` with additional prefix ‚Üí all prefixes combined correctly\n4. Existing `APIRoute` handling unaffected alongside `Mount`", "output": "```diff\n@@ -1133,6 +1133,9 @@ async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n             scope[\"root_path\"] = self.root_path\n         await super().__call__(scope, receive, send)\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        self.router._mount(path, app=app, name=name)\n+\n     def add_api_route(\n         self,\n         path: str,\n\n```\n\n```diff\n@@ -74,6 +74,7 @@\n     get_name,\n )\n from starlette.routing import Mount as Mount  # noqa\n+from starlette.staticfiles import StaticFiles\n from starlette.types import AppType, ASGIApp, Lifespan, Receive, Scope, Send\n from starlette.websockets import WebSocket\n from typing_extensions import deprecated\n@@ -993,6 +994,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        \"\"\"\n+        Mount a StaticFiles instance.\n+        Will raise a FastAPIError exception if app is not an instance of StaticFiles.\n+        \"\"\"\n+        if not isinstance(app, StaticFiles):\n+            raise FastAPIError(\n+                \"APIRouter does not support mounting ASGI applications other than StaticFiles.\"\n+            )\n+        self._mount(path=path, app=app, name=name)\n+\n+    def _mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        super().mount(path=path, app=app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1489,6 +1504,11 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                if isinstance(route.app, StaticFiles):\n+                    self._mount(\n+                        prefix + router.prefix + route.path, route.app, name=route.name\n+                    )\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,82 @@\n+\"\"\"Tests for mounting StaticFiles under APIRouter (issue #10180).\"\"\"\n+\n+from pathlib import Path\n+\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+from fastapi.exceptions import FastAPIError\n+from fastapi.staticfiles import StaticFiles\n+from fastapi.testclient import TestClient\n+\n+\n+def test_mount_staticfiles_under_router_with_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter with prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"hello.txt\"\n+    static_file.write_text(\"hello world\")\n+\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/app\")\n+    def read_main() -> dict:\n+        return {\"message\": \"Hello World from main app\"}\n+\n+    api_router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Regular route should still work\n+    r = client.get(\"/api/app\")\n+    assert r.status_code == 200\n+\n+    # StaticFiles should be accessible under router prefix\n+    r = client.get(\"/api/static/hello.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"hello world\"\n+\n+\n+def test_mount_staticfiles_under_router_without_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter without prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"test.txt\"\n+    static_file.write_text(\"test content\")\n+\n+    app = FastAPI()\n+    router = APIRouter()\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router)\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/static/test.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"test content\"\n+\n+\n+def test_mount_staticfiles_with_include_router_prefix(tmp_path: Path) -> None:\n+    \"\"\"include_router prefix + router prefix + mount path should all combine.\"\"\"\n+    static_file = tmp_path / \"file.txt\"\n+    static_file.write_text(\"combined prefix\")\n+\n+    app = FastAPI()\n+    router = APIRouter(prefix=\"/api\")\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router, prefix=\"/v1\")\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/v1/api/static/file.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"combined prefix\"\n+\n+\n+def test_mount_non_staticfiles_app_raises_error() -> None:\n+    \"\"\"Mounting a non-StaticFiles ASGI app on APIRouter should raise FastAPIError.\"\"\"\n+    router = APIRouter()\n+    sub_app = FastAPI()\n+\n+    with pytest.raises(\n+        FastAPIError,\n+        match=\"APIRouter does not support mounting ASGI applications other than StaticFiles.\",\n+    ):\n+        router.mount(\"/sub\", sub_app)\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 182}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -1133,6 +1133,9 @@ async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n             scope[\"root_path\"] = self.root_path\n         await super().__call__(scope, receive, send)\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        self.router._mount(path, app=app, name=name)\n+\n     def add_api_route(\n         self,\n         path: str,\n\n```\n\n```diff\n@@ -74,6 +74,7 @@\n     get_name,\n )\n from starlette.routing import Mount as Mount  # noqa\n+from starlette.staticfiles import StaticFiles\n from starlette.types import AppType, ASGIApp, Lifespan, Receive, Scope, Send\n from starlette.websockets import WebSocket\n from typing_extensions import deprecated\n@@ -993,6 +994,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        \"\"\"\n+        Mount a StaticFiles instance.\n+        Will raise a FastAPIError exception if app is not an instance of StaticFiles.\n+        \"\"\"\n+        if not isinstance(app, StaticFiles):\n+            raise FastAPIError(\n+                \"APIRouter does not support mounting ASGI applications other than StaticFiles.\"\n+            )\n+        self._mount(path=path, app=app, name=name)\n+\n+    def _mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        super().mount(path=path, app=app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1489,6 +1504,11 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                if isinstance(route.app, StaticFiles):\n+                    self._mount(\n+                        prefix + router.prefix + route.path, route.app, name=route.name\n+                    )\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,82 @@\n+\"\"\"Tests for mounting StaticFiles under APIRouter (issue #10180).\"\"\"\n+\n+from pathlib import Path\n+\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+from fastapi.exceptions import FastAPIError\n+from fastapi.staticfiles import StaticFiles\n+from fastapi.testclient import TestClient\n+\n+\n+def test_mount_staticfiles_under_router_with_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter with prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"hello.txt\"\n+    static_file.write_text(\"hello world\")\n+\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/app\")\n+    def read_main() -> dict:\n+        return {\"message\": \"Hello World from main app\"}\n+\n+    api_router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Regular route should still work\n+    r = client.get(\"/api/app\")\n+    assert r.status_code == 200\n+\n+    # StaticFiles should be accessible under router prefix\n+    r = client.get(\"/api/static/hello.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"hello world\"\n+\n+\n+def test_mount_staticfiles_under_router_without_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter without prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"test.txt\"\n+    static_file.write_text(\"test content\")\n+\n+    app = FastAPI()\n+    router = APIRouter()\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router)\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/static/test.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"test content\"\n+\n+\n+def test_mount_staticfiles_with_include_router_prefix(tmp_path: Path) -> None:\n+    \"\"\"include_router prefix + router prefix + m", "output": "Bug: fix: propagate Mount objects when using include_router\n\n## Description\n\nFixes #10180\n\nWhen an `APIRouter` with mounted sub-applications is included into a FastAPI app via `include_router()`, the `Mount` routes were silently ignored. This caused sub-apps mounted on a router to return 404 when accessed through the main app.\n\n## Root Cause\n\n`include_router()` in `routing.py` iterates over router routes and handles:\n- `APIRoute`\n- `routing.Route`\n- `APIWebSocketRoute`\n- `routing.WebSocketRoute`\n\n...but **never `routing.Mount`**, so mounted sub-apps were simply dropped.\n\nAdditionally, `APIRouter.mount()` is inherited from Starlette's `Router.mount()` which does **not** apply `self.prefix` to the stored path (unlike `add_api_route()` which uses `self.prefix + path`). So the fix must apply both the `include_router` prefix and the router's own prefix when propagating `Mount` routes.\n\n## Fix\n\nAdded a single `elif` branch to handle `routing.Mount` in `include_router()`:\n\n```python\nelif isinstance(route, routing.Mount):\n    self.mount(prefix + router.prefix + route.path, route.app, name=route.name)\n```\n\n## Tests\n\nAdded `tests/test_router_mount.py` covering:\n\n1. `APIRouter` with prefix + mounted sub-app ‚Üí accessible at `/{router_prefix}/{mount_path}/...`\n2. `APIRouter` without prefix + mounted sub-app ‚Üí accessible at `/{mount_path}/...`\n3. `include_router` with additional prefix ‚Üí all prefixes combined correctly\n4. Existing `APIRoute` handling unaffected alongside `Mount`", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 182}
{"instruction": "Review the following code changes: fix: propagate Mount objects when using include_router", "input": "```diff\n@@ -1133,6 +1133,9 @@ async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n             scope[\"root_path\"] = self.root_path\n         await super().__call__(scope, receive, send)\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        self.router._mount(path, app=app, name=name)\n+\n     def add_api_route(\n         self,\n         path: str,\n\n```\n\n```diff\n@@ -74,6 +74,7 @@\n     get_name,\n )\n from starlette.routing import Mount as Mount  # noqa\n+from starlette.staticfiles import StaticFiles\n from starlette.types import AppType, ASGIApp, Lifespan, Receive, Scope, Send\n from starlette.websockets import WebSocket\n from typing_extensions import deprecated\n@@ -993,6 +994,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        \"\"\"\n+        Mount a StaticFiles instance.\n+        Will raise a FastAPIError exception if app is not an instance of StaticFiles.\n+        \"\"\"\n+        if not isinstance(app, StaticFiles):\n+            raise FastAPIError(\n+                \"APIRouter does not support mounting ASGI applications other than StaticFiles.\"\n+            )\n+        self._mount(path=path, app=app, name=name)\n+\n+    def _mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        super().mount(path=path, app=app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1489,6 +1504,11 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                if isinstance(route.app, StaticFiles):\n+                    self._mount(\n+                        prefix + router.prefix + route.path, route.app, name=route.name\n+                    )\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,82 @@\n+\"\"\"Tests for mounting StaticFiles under APIRouter (issue #10180).\"\"\"\n+\n+from pathlib import Path\n+\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+from fastapi.exceptions import FastAPIError\n+from fastapi.staticfiles import StaticFiles\n+from fastapi.testclient import TestClient\n+\n+\n+def test_mount_staticfiles_under_router_with_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter with prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"hello.txt\"\n+    static_file.write_text(\"hello world\")\n+\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/app\")\n+    def read_main() -> dict:\n+        return {\"message\": \"Hello World from main app\"}\n+\n+    api_router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Regular route should still work\n+    r = client.get(\"/api/app\")\n+    assert r.status_code == 200\n+\n+    # StaticFiles should be accessible under router prefix\n+    r = client.get(\"/api/static/hello.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"hello world\"\n+\n+\n+def test_mount_staticfiles_under_router_without_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter without prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"test.txt\"\n+    static_file.write_text(\"test content\")\n+\n+    app = FastAPI()\n+    router = APIRouter()\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router)\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/static/test.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"test content\"\n+\n+\n+def test_mount_staticfiles_with_include_router_prefix(tmp_path: Path) -> None:\n+    \"\"\"include_router prefix + router prefix + mount path should all combine.\"\"\"\n+    static_file = tmp_path / \"file.txt\"\n+    static_file.write_text(\"combined prefix\")\n+\n+    app = FastAPI()\n+    router = APIRouter(prefix=\"/api\")\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router, prefix=\"/v1\")\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/v1/api/static/file.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"combined prefix\"\n+\n+\n+def test_mount_non_staticfiles_app_raises_error() -> None:\n+    \"\"\"Mounting a non-StaticFiles ASGI app on APIRouter should raise FastAPIError.\"\"\"\n+    router = APIRouter()\n+    sub_app = FastAPI()\n+\n+    with pytest.raises(\n+        FastAPIError,\n+        match=\"APIRouter does not support mounting ASGI applications other than StaticFiles.\",\n+    ):\n+        router.mount(\"/sub\", sub_app)\n\n```", "output": "Changes look good. This PR implements: fix: propagate Mount objects when using include_router", "source": "pr", "type": "code_review", "pr_number": 182}
{"instruction": "Review the following code changes: ‚ú® Support mounting `StaticFiles` to sub-routers", "input": "```diff\n@@ -1133,6 +1133,9 @@ async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n             scope[\"root_path\"] = self.root_path\n         await super().__call__(scope, receive, send)\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        self.router._mount(path, app=app, name=name)\n+\n     def add_api_route(\n         self,\n         path: str,\n\n```\n\n```diff\n@@ -74,6 +74,7 @@\n     get_name,\n )\n from starlette.routing import Mount as Mount  # noqa\n+from starlette.staticfiles import StaticFiles\n from starlette.types import AppType, ASGIApp, Lifespan, Receive, Scope, Send\n from starlette.websockets import WebSocket\n from typing_extensions import deprecated\n@@ -993,6 +994,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        \"\"\"\n+        Mount a StaticFiles instance.\n+        Will raise a FastAPIError exception if app is not an instance of StaticFiles.\n+        \"\"\"\n+        if not isinstance(app, StaticFiles):\n+            raise FastAPIError(\n+                \"APIRouter does not support mounting ASGI applications other than StaticFiles.\"\n+            )\n+        self._mount(path=self.prefix + path, app=app, name=name)\n+\n+    def _mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        super().mount(path=path, app=app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1489,6 +1504,11 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif (  # fmt: skip\n+                isinstance(route, routing.Mount) and isinstance(route.app, StaticFiles)\n+            ):\n+                self.mount(prefix + route.path, route.app, name=route.name)\n+\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,50 @@\n+from pathlib import Path\n+\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+from fastapi.exceptions import FastAPIError\n+from fastapi.staticfiles import StaticFiles\n+from fastapi.testclient import TestClient\n+\n+\n+@pytest.mark.parametrize(\"root_path\", [\"\", \"/v1\"])\n+@pytest.mark.parametrize(\n+    (\"router_prefix\", \"include_prefix\", \"request_prefix\"),\n+    [\n+        (\"\", \"\", \"\"),\n+        (\"/router\", \"\", \"/router\"),\n+        (\"\", \"/router_1\", \"/router_1\"),\n+        (\"/router\", \"/router_1\", \"/router_1/router\"),\n+    ],\n+)\n+def test_mount_static_files_to_apirouter(\n+    tmp_path: Path,\n+    root_path: str,\n+    router_prefix: str,\n+    include_prefix: str,\n+    request_prefix: str,\n+):\n+    static_asset = tmp_path / \"index.html\"\n+    static_asset.write_text(\"Hello, World!\")\n+\n+    router = APIRouter(prefix=router_prefix)\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+\n+    app = FastAPI(root_path=root_path or None)\n+    app.include_router(router, prefix=include_prefix)\n+\n+    client = TestClient(app)\n+    response = client.get(f\"{root_path}{request_prefix}/static/index.html\")\n+    assert response.status_code == 200\n+    assert response.text == \"Hello, World!\"\n+\n+\n+def test_mount_app_to_apirouter_raises():\n+    router = APIRouter()\n+    sub_app = FastAPI()\n+\n+    with pytest.raises(\n+        FastAPIError,\n+        match=\"APIRouter does not support mounting ASGI applications other than StaticFiles.\",\n+    ):\n+        router.mount(\"/sub\", sub_app)\n\n```", "output": "Changes look good. This PR implements: ‚ú® Support mounting `StaticFiles` to sub-routers", "source": "pr", "type": "code_review", "pr_number": 181}
{"instruction": "Review the following code changes: üìù Clarify non-standard HTTP methods like QUERY", "input": "```diff\n@@ -202,3 +202,50 @@ Here we reuse the same Pydantic model.\n But the same way, we could have validated it in some other way.\n \n ///\n+\n+## Non-standard HTTP methods (e.g., QUERY) { #non-standard-http-methods }\n+\n+Some proposals introduce non-standard HTTP methods like `QUERY` that allow a request body with a safe semantics.\n+\n+/// info\n+\n+**FastAPI follows OpenAPI for schema and docs generation.** OpenAPI `PathItem` only defines the standard HTTP operations: `get`, `put`, `post`, `delete`, `options`, `head`, `patch`, and `trace`. Methods like `QUERY` are not part of OpenAPI, so they won't be shown in the generated docs or supported by Swagger UI.\n+\n+///\n+\n+### Recommended approach\n+\n+If you need to send a complex filter/query payload, prefer using `POST` with a request body, even if the operation is logically a read. This is a common industry practice and fully supported by OpenAPI and the automatic docs.\n+\n+\n```", "output": "Changes look good. This PR implements: üìù Clarify non-standard HTTP methods like QUERY", "source": "pr", "type": "code_review", "pr_number": 180}
{"instruction": "Review the following code changes: üîí Escape HTML in Swagger and ReDoc titles and URLs", "input": "```diff\n@@ -1,3 +1,4 @@\n+import html as html_escape\n import json\n from typing import Any, Dict, Optional\n \n@@ -121,7 +122,7 @@ def get_swagger_ui_html(\n     <head>\n     <link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n     <link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n-    <title>{title}</title>\n+    <title>{html_escape.escape(title)}</title>\n     </head>\n     <body>\n     <div id=\"swagger-ui\">\n@@ -130,7 +131,7 @@ def get_swagger_ui_html(\n     <!-- `SwaggerUIBundle` is now available on the page -->\n     <script>\n     const ui = SwaggerUIBundle({{\n-        url: '{openapi_url}',\n+        url: '{html_escape.escape(openapi_url)}',\n     \"\"\"\n \n     for key, value in current_swagger_ui_parameters.items():\n@@ -221,7 +222,7 @@ def get_redoc_html(\n     <!DOCTYPE html>\n     <html>\n     <head>\n-    <title>{title}</title>\n+    <title>{html_escape.escape(title)}</title>\n     <!-- needed for adaptive design -->\n     <meta charset=\"utf-8\"/>\n     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n@@ -246,7 +247,7 @@ def get_redoc_html(\n     <noscript>\n         ReDoc requires Javascript to function. Please enable it to browse the documentation.\n     </noscript>\n-    <redoc spec-url=\"{openapi_url}\"></redoc>\n+    <redoc spec-url=\"{html_escape.escape(openapi_url)}\"></redoc>\n     <script src=\"{redoc_js_url}\"> </script>\n     </body>\n     </html>\n\n```", "output": "Changes look good. This PR implements: üîí Escape HTML in Swagger and ReDoc titles and URLs", "source": "pr", "type": "code_review", "pr_number": 179}
{"instruction": "Review the following code changes: vulnerability in Swagger UI template generation", "input": "```diff\n@@ -2,7 +2,6 @@\n from typing import Annotated, Any, Optional\n \n from annotated_doc import Doc\n-from fastapi.encoders import jsonable_encoder\n from starlette.responses import HTMLResponse\n \n swagger_ui_default_parameters: Annotated[\n@@ -110,51 +109,53 @@ def get_swagger_ui_html(\n     [FastAPI docs for Configure Swagger UI](https://fastapi.tiangolo.com/how-to/configure-swagger-ui/)\n     and the [FastAPI docs for Custom Docs UI Static Assets (Self-Hosting)](https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/).\n     \"\"\"\n-    current_swagger_ui_parameters = swagger_ui_default_parameters.copy()\n-    if swagger_ui_parameters:\n-        current_swagger_ui_parameters.update(swagger_ui_parameters)\n-\n-    html = f\"\"\"\n-    <!DOCTYPE html>\n-    <html>\n-    <head>\n-    <link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n-    <link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n-    <title>{title}</title>\n-    </head>\n-    <body>\n-    <div id=\"swagger-ui\">\n-    </div>\n-    <script src=\"{swagger_js_url}\"></script>\n-    <!-- `SwaggerUIBundle` is now available on the page -->\n-    <script>\n-    const ui = SwaggerUIBundle({{\n-        url: '{openapi_url}',\n-    \"\"\"\n+    swagger_config = {\n+        \"url\": openapi_url,\n+        \"dom_id\": \"#swagger-ui\",\n+        \"layout\": \"BaseLayout\",\n+        \"deepLinking\": True,\n+        \"showExtensions\": True,\n+        \"showCommonExtensions\": True,\n+        \"presets\": [\n+            \"SwaggerUIBundle.presets.apis\",\n+            \"SwaggerUIBundle.SwaggerUIStandalonePreset\",\n+        ],\n+    }\n \n-    for key, value in current_swagger_ui_parameters.items():\n-        html += f\"{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\\n\"\n+    if swagger_ui_parameters:\n+        swagger_config.update(swagger_ui_parameters)\n \n     if oauth2_redirect_url:\n-        html += f\"oauth2RedirectUrl: window.location.origin + '{oauth2_redirect_url}',\"\n-\n-    html += \"\"\"\n-    presets: [\n-        SwaggerUIBundle.presets.apis,\n-        SwaggerUIBundle.SwaggerUIStandalonePreset\n-        ],\n-    })\"\"\"\n+        swagger_config[\"oauth2RedirectUrl\"] = (\n+            f\"window.location.origin + '{oauth2_redirect_url}'\"\n+        )\n+\n+    config_json = json.dumps(swagger_config, default=str)\n+\n+    html = f'''<!DOCTYPE html>\n+<html>\n+<head>\n+<link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n+<link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n+<title>{title}</title>\n+</head>\n+<body>\n+<div id=\"swagger-ui\">\n+</div>\n+<script src=\"{swagger_js_url}\"></script>\n+<script>\n+const ui = SwaggerUIBundle({config_json});'''\n \n     if init_oauth:\n+        init_oauth_json = json.dumps(init_oauth, default=str)\n         html += f\"\"\"\n-        ui.initOAuth({json.dumps(jsonable_encoder(init_oauth))})\n-        \"\"\"\n+ui.initOAuth({init_oauth_json});\"\"\"\n \n     html += \"\"\"\n-    </script>\n-    </body>\n-    </html>\n-    \"\"\"\n+</script>\n+</body>\n+</html>\"\"\"\n+\n     return HTMLResponse(html)\n \n \n@@ -216,40 +217,40 @@ def get_redoc_html(\n     Read more abo\n\n```\n\n```diff\n@@ -110,51 +109,53 @@ def get_swagger_ui_html(\n     [FastAPI docs for Configure Swagger UI](https://fastapi.tiangolo.com/how-to/configure-swagger-ui/)\n     and the [FastAPI docs for Custom Docs UI Static Assets (Self-Hosting)](https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/).\n     \"\"\"\n-    current_swagger_ui_parameters = swagger_ui_default_parameters.copy()\n-    if swagger_ui_parameters:\n-        current_swagger_ui_parameters.update(swagger_ui_parameters)\n-\n-    html = f\"\"\"\n-    <!DOCTYPE html>\n-    <html>\n-    <head>\n-    <link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n-    <link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n-    <title>{title}</title>\n-    </head>\n-    <body>\n-    <div id=\"swagger-ui\">\n-    </div>\n-    <script src=\"{swagger_js_url}\"></script>\n-    <!-- `SwaggerUIBundle` is now available on the page -->\n-    <script>\n-    const ui = SwaggerUIBundle({{\n-        url: '{openapi_url}',\n-    \"\"\"\n+    swagger_config = {\n+        \"url\": openapi_url,\n+        \"dom_id\": \"#swagger-ui\",\n+        \"layout\": \"BaseLayout\",\n+        \"deepLinking\": True,\n+        \"showExtensions\": True,\n+        \"showCommonExtensions\": True,\n+        \"presets\": [\n+            \"SwaggerUIBundle.presets.apis\",\n+            \"SwaggerUIBundle.SwaggerUIStandalonePreset\",\n+        ],\n+    }\n \n-    for key, value in current_swagger_ui_parameters.items():\n-        html += f\"{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\\n\"\n+    if swagger_ui_parameters:\n+        swagger_config.update(swagger_ui_parameters)\n \n     if oauth2_redirect_url:\n-        html += f\"oauth2RedirectUrl: window.location.origin + '{oauth2_redirect_url}',\"\n-\n-    html += \"\"\"\n-    presets: [\n-        SwaggerUIBundle.presets.apis,\n-        SwaggerUIBundle.SwaggerUIStandalonePreset\n-        ],\n-    })\"\"\"\n+        swagger_config[\"oauth2RedirectUrl\"] = (\n+            f\"window.location.origin + '{oauth2_redirect_url}'\"\n\n```", "output": "Code Review for: vulnerability in Swagger UI template generation\n\nüìù **fastapi/openapi/docs.py**: This piece of JavaScript code will stop working after wrapping it with `json.dumps` - instead of accessing a variable `window`on browser side, it became a literal string. Same for `presets`, previously they are referred to some JavaScript objects loaded in swagger.js, now they are just strings.\n\n", "source": "pr", "type": "code_review", "pr_number": 178}
{"instruction": "Review this code change in `fastapi/openapi/docs.py`", "input": "```diff\n@@ -110,51 +109,53 @@ def get_swagger_ui_html(\n     [FastAPI docs for Configure Swagger UI](https://fastapi.tiangolo.com/how-to/configure-swagger-ui/)\n     and the [FastAPI docs for Custom Docs UI Static Assets (Self-Hosting)](https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/).\n     \"\"\"\n-    current_swagger_ui_parameters = swagger_ui_default_parameters.copy()\n-    if swagger_ui_parameters:\n-        current_swagger_ui_parameters.update(swagger_ui_parameters)\n-\n-    html = f\"\"\"\n-    <!DOCTYPE html>\n-    <html>\n-    <head>\n-    <link type=\"text/css\" rel=\"stylesheet\" href=\"{swagger_css_url}\">\n-    <link rel=\"shortcut icon\" href=\"{swagger_favicon_url}\">\n-    <title>{title}</title>\n-    </head>\n-    <body>\n-    <div id=\"swagger-ui\">\n-    </div>\n-    <script src=\"{swagger_js_url}\"></script>\n-    <!-- `SwaggerUIBundle` is now available on the page -->\n-    <script>\n-    const ui = SwaggerUIBundle({{\n-        url: '{openapi_url}',\n-    \"\"\"\n+    swagger_config = {\n+        \"url\": openapi_url,\n+        \"dom_id\": \"#swagger-ui\",\n+        \"layout\": \"BaseLayout\",\n+        \"deepLinking\": True,\n+        \"showExtensions\": True,\n+        \"showCommonExtensions\": True,\n+        \"presets\": [\n+            \"SwaggerUIBundle.presets.apis\",\n+            \"SwaggerUIBundle.SwaggerUIStandalonePreset\",\n+        ],\n+    }\n \n-    for key, value in current_swagger_ui_parameters.items():\n-        html += f\"{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\\n\"\n+    if swagger_ui_parameters:\n+        swagger_config.update(swagger_ui_parameters)\n \n     if oauth2_redirect_url:\n-        html += f\"oauth2RedirectUrl: window.location.origin + '{oauth2_redirect_url}',\"\n-\n-    html += \"\"\"\n-    presets: [\n-        SwaggerUIBundle.presets.apis,\n-        SwaggerUIBundle.SwaggerUIStandalonePreset\n-        ],\n-    })\"\"\"\n+        swagger_config[\"oauth2RedirectUrl\"] = (\n+            f\"window.location.origin + '{oauth2_redirect_url}'\"\n\n```", "output": "This piece of JavaScript code will stop working after wrapping it with `json.dumps` - instead of accessing a variable `window`on browser side, it became a literal string. Same for `presets`, previously they are referred to some JavaScript objects loaded in swagger.js, now they are just strings.", "source": "pr_review", "type": "inline_review", "pr_number": 178}
{"instruction": "Review the following code changes: Minor clarification suggestion for the ‚ÄúParallel Burgers‚Äù analogy in ‚Ä¶", "input": "```diff\n@@ -219,6 +219,13 @@ The fast food store has 8 processors (cashiers/cooks). While the concurrent burg\n \n But still, the final experience is not the best. üòû\n \n+/// note\n+\n+This example focuses on an <abbr title=\"Input and Output\">I/O</abbr>-bound scenario with significant waiting. Parallelism shines instead for <abbr title=\"Central Processing Unit\">CPU</abbr>-bound work, where multiple workers actively perform computation at the same time.\n+\n+///\n+\n+\n ---\n \n This would be the parallel equivalent story for burgers. üçî\n\n```\n\n```diff\n@@ -219,6 +219,13 @@ The fast food store has 8 processors (cashiers/cooks). While the concurrent burg\n \n But still, the final experience is not the best. üòû\n \n+/// note\n+\n+This example focuses on an <abbr title=\"Input and Output\">I/O</abbr>-bound scenario with significant waiting. Parallelism shines instead for <abbr title=\"Central Processing Unit\">CPU</abbr>-bound work, where multiple workers actively perform computation at the same time.\n+\n+///\n+\n+\n\n```", "output": "Code Review for: Minor clarification suggestion for the ‚ÄúParallel Burgers‚Äù analogy in ‚Ä¶\n\nüìù **docs/en/docs/async.md**: I came across this documentation independently and had the exact same concern about the terminology. The current \"Parallel Burgers\" section describes synchronous blocking with multiple workers, not true parallelism.\nFrom a CS perspective:\n\n", "source": "pr", "type": "code_review", "pr_number": 177}
{"instruction": "Review this code change in `docs/en/docs/async.md`", "input": "```diff\n@@ -219,6 +219,13 @@ The fast food store has 8 processors (cashiers/cooks). While the concurrent burg\n \n But still, the final experience is not the best. üòû\n \n+/// note\n+\n+This example focuses on an <abbr title=\"Input and Output\">I/O</abbr>-bound scenario with significant waiting. Parallelism shines instead for <abbr title=\"Central Processing Unit\">CPU</abbr>-bound work, where multiple workers actively perform computation at the same time.\n+\n+///\n+\n+\n\n```", "output": "I came across this documentation independently and had the exact same concern about the terminology. The current \"Parallel Burgers\" section describes synchronous blocking with multiple workers, not true parallelism.\nFrom a CS perspective:", "source": "pr_review", "type": "inline_review", "pr_number": 177}
{"instruction": "Review the following code changes: üìù Update link format for local documentation URL", "input": "```diff\n@@ -110,7 +110,7 @@ $ python ./scripts/docs.py live\n \n </div>\n \n-It will serve the documentation on `http://127.0.0.1:8008`.\n+It will serve the documentation on [`http://127.0.0.1:8008`](http://127.0.0.1:8008).\n \n That way, you can edit the documentation/source files and see the changes live.\n \n\n```", "output": "Changes look good. This PR implements: üìù Update link format for local documentation URL", "source": "pr", "type": "code_review", "pr_number": 176}
{"instruction": "Review the following code changes: üìù Clarify OpenAPI explanation", "input": "```diff\n@@ -83,8 +83,7 @@ You will see the alternative automatic documentation (provided by <a href=\"https\n ![ReDoc](https://fastapi.tiangolo.com/img/index/index-02-redoc-simple.png)\n \n ### OpenAPI { #openapi }\n-\n-**FastAPI** generates a \"schema\" with all your API using the **OpenAPI** standard for defining APIs.\n+FastAPI generates a \"schema\" with all your API using the OpenAPI standard for defining APIs. In simple terms, this is a structured description of your API that tools can read to show documentation and understand how your endpoints work.\n \n #### \"Schema\" { #schema }\n \n\n```", "output": "Changes look good. This PR implements: üìù Clarify OpenAPI explanation", "source": "pr", "type": "code_review", "pr_number": 175}
{"instruction": "Review the following code changes: Add tests for form data validation and optional fields", "input": "```diff\n@@ -139,3 +139,40 @@ def test_extra_param_list():\n         \"param\": \"123\",\n         \"extra_params\": [\"456\", \"789\"],\n     }\n+\n+\n+    def test_list_field_single_value():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"tags\": \"single\",\n+        },\n+    )\n+    assert response.status_code == 200\n+    assert response.json()[\"tags\"] == [\"single\"]\n+\n+\n+    def test_alias_field_name_not_accepted():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"alias_with\": \"something\",\n+        },\n+    )\n+    assert response.status_code == 422\n+\n+  def test_optional_int_empty_string():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"age\": \"\",\n+        },\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json()[\"age\"] is None\n\n```\n\n```diff\n@@ -139,3 +139,40 @@ def test_extra_param_list():\n         \"param\": \"123\",\n         \"extra_params\": [\"456\", \"789\"],\n     }\n+\n+\n+    def test_list_field_single_value():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"tags\": \"single\",\n+        },\n+    )\n+    assert response.status_code == 200\n+    assert response.json()[\"tags\"] == [\"single\"]\n+\n+\n+    def test_alias_field_name_not_accepted():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"alias_with\": \"something\",\n+        },\n+    )\n+    assert response.status_code == 422\n\n```\n\n```diff\n@@ -139,3 +139,40 @@ def test_extra_param_list():\n         \"param\": \"123\",\n         \"extra_params\": [\"456\", \"789\"],\n     }\n+\n+\n+    def test_list_field_single_value():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"tags\": \"single\",\n+        },\n+    )\n+    assert response.status_code == 200\n+    assert response.json()[\"tags\"] == [\"single\"]\n+\n+\n+    def test_alias_field_name_not_accepted():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"alias_with\": \"something\",\n+        },\n+    )\n+    assert response.status_code == 422\n+\n+  def test_optional_int_empty_string():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"age\": \"\",\n+        },\n+    )\n+    assert response.status_code == 200, response.text\n+    assert response.json()[\"age\"] is None\n\n```\n\n```diff\n@@ -139,3 +139,40 @@ def test_extra_param_list():\n         \"param\": \"123\",\n         \"extra_params\": [\"456\", \"789\"],\n     }\n+\n+\n+    def test_list_field_single_value():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"tags\": \"single\",\n+        },\n+    )\n+    assert response.status_code == 200\n+    assert response.json()[\"tags\"] == [\"single\"]\n\n```", "output": "Code Review for: Add tests for form data validation and optional fields\n\nüìù **tests/test_forms_single_model.py**: We already have such test: https://github.com/fastapi/fastapi/blob/0c7f2b66d769d05df42ea73f85205a3566ba127b/tests/test_request_params/test_form/test_required_str.py#L139-L156 \n\nüìù **tests/test_forms_single_model.py**: I think we should add such tests, but we should do it in more consistent way (different type of field, cover form declared as Pydantic model, different default values (not only `None`)).\r\nI have a plan to add such set of tests\n\nüìù **tests/test_forms_single_model.py**: Something tells me that if we search in the code base we will find out that such test already exists..\r\nI think we don't need to add this, but if we decide to add it we should do it in more consistent way (for different types (source) of parameters (e.g. Form, Query, Cookie, etc..))\n\n", "source": "pr", "type": "code_review", "pr_number": 173}
{"instruction": "Review this code change in `tests/test_forms_single_model.py`", "input": "```diff\n@@ -139,3 +139,40 @@ def test_extra_param_list():\n         \"param\": \"123\",\n         \"extra_params\": [\"456\", \"789\"],\n     }\n+\n+\n+    def test_list_field_single_value():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"tags\": \"single\",\n+        },\n+    )\n+    assert response.status_code == 200\n+    assert response.json()[\"tags\"] == [\"single\"]\n+\n+\n+    def test_alias_field_name_not_accepted():\n+    response = client.post(\n+        \"/form/\",\n+        data={\n+            \"username\": \"Rick\",\n+            \"lastname\": \"Sanchez\",\n+            \"alias_with\": \"something\",\n+        },\n+    )\n+    assert response.status_code == 422\n\n```", "output": "We already have such test: https://github.com/fastapi/fastapi/blob/0c7f2b66d769d05df42ea73f85205a3566ba127b/tests/test_request_params/test_form/test_required_str.py#L139-L156 ", "source": "pr_review", "type": "inline_review", "pr_number": 173}
{"instruction": "Fix the following bug: style: PEP 8 fixes in openapi/utils.py", "input": "**Changes:**\r\n- Added missing trailing commas in `validation_error_response_definition`\r\n- Fixed string concatenation in warning message\r\n\r\n**Type:** Code style cleanup (PEP 8)", "output": "```diff\n@@ -61,7 +61,7 @@\n             \"title\": \"Detail\",\n             \"type\": \"array\",\n             \"items\": {\"$ref\": REF_PREFIX + \"ValidationError\"},\n-        }\n+        },\n     },\n }\n \n@@ -242,8 +242,8 @@ def get_openapi_operation_metadata(\n     operation_id = route.operation_id or route.unique_id\n     if operation_id in operation_ids:\n         message = (\n-            f\"Duplicate Operation ID {operation_id} for function \"\n-            + f\"{route.endpoint.__name__}\"\n+            f\"Duplicate Operation ID {operation_id} \"\n+            f\"for function {route.endpoint.__name__}\"\n         )\n         file_name = getattr(route.endpoint, \"__globals__\", {}).get(\"__file__\")\n         if file_name:\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 172}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -61,7 +61,7 @@\n             \"title\": \"Detail\",\n             \"type\": \"array\",\n             \"items\": {\"$ref\": REF_PREFIX + \"ValidationError\"},\n-        }\n+        },\n     },\n }\n \n@@ -242,8 +242,8 @@ def get_openapi_operation_metadata(\n     operation_id = route.operation_id or route.unique_id\n     if operation_id in operation_ids:\n         message = (\n-            f\"Duplicate Operation ID {operation_id} for function \"\n-            + f\"{route.endpoint.__name__}\"\n+            f\"Duplicate Operation ID {operation_id} \"\n+            f\"for function {route.endpoint.__name__}\"\n         )\n         file_name = getattr(route.endpoint, \"__globals__\", {}).get(\"__file__\")\n         if file_name:\n\n```", "output": "Bug: style: PEP 8 fixes in openapi/utils.py\n\n**Changes:**\r\n- Added missing trailing commas in `validation_error_response_definition`\r\n- Fixed string concatenation in warning message\r\n\r\n**Type:** Code style cleanup (PEP 8)", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 172}
{"instruction": "Review the following code changes: style: PEP 8 fixes in openapi/utils.py", "input": "```diff\n@@ -61,7 +61,7 @@\n             \"title\": \"Detail\",\n             \"type\": \"array\",\n             \"items\": {\"$ref\": REF_PREFIX + \"ValidationError\"},\n-        }\n+        },\n     },\n }\n \n@@ -242,8 +242,8 @@ def get_openapi_operation_metadata(\n     operation_id = route.operation_id or route.unique_id\n     if operation_id in operation_ids:\n         message = (\n-            f\"Duplicate Operation ID {operation_id} for function \"\n-            + f\"{route.endpoint.__name__}\"\n+            f\"Duplicate Operation ID {operation_id} \"\n+            f\"for function {route.endpoint.__name__}\"\n         )\n         file_name = getattr(route.endpoint, \"__globals__\", {}).get(\"__file__\")\n         if file_name:\n\n```", "output": "Changes look good. This PR implements: style: PEP 8 fixes in openapi/utils.py", "source": "pr", "type": "code_review", "pr_number": 172}
{"instruction": "Fix the following bug: Fix Optional[Literal] Form field handling when value is None", "input": "### üêõ Bug\r\n\r\n`Optional[Literal[...]]` form fields were returning `422 Unprocessable Entity`\r\nwhen the submitted value was `None`, even though the field was optional.\r\n\r\nThis behavior was inconsistent with other optional form fields such as\r\n`Optional[str]` or `Optional[List[str]]`.\r\n\r\n### ‚úÖ Fix\r\n\r\n- Properly handle `None` values for `Optional[Literal]` form fields\r\n- Align behavior with other optional form parameters\r\n\r\n### üß™ Tests\r\n\r\n- Added tests reproducing the issue\r\n- Verified no regressions in existing request parameter tests", "output": "```diff\n@@ -347,6 +347,21 @@ def add_non_field_param_to_dependency(\n     return None\n \n \n+def _is_optional_type(annotation: Any) -> bool:\n+    \"\"\"\n+    Check if a type annotation is Optional (Union with None).\n+\n+    Optional[X] is equivalent to Union[X, None], so we check if:\n+    1. The origin is Union\n+    2. NoneType is one of the union args\n+    \"\"\"\n+    origin = get_origin(annotation)\n+    if origin is Union:\n+        args = get_args(annotation)\n+        return type(None) in args\n+    return False\n+\n+\n @dataclass\n class ParamDetails:\n     type_annotation: Any\n@@ -412,7 +427,12 @@ def analyze_param(\n                 assert not is_path_param, \"Path parameters cannot have default values\"\n                 field_info.default = value\n             else:\n-                field_info.default = RequiredParam\n+                # Check if the type annotation is Optional (Union with None)\n+                # If so, use None as default instead of RequiredParam\n+                if _is_optional_type(type_annotation):\n+                    field_info.default = None\n+                else:\n+                    field_info.default = RequiredParam\n         # Get Annotated Depends\n         elif isinstance(fastapi_annotation, params.Depends):\n             depends = fastapi_annotation\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n+\n+\n+def test_optional_literal_form_valid_values():\n+    \"\"\"Test that valid literal values work correctly\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Test with \"abc\"\n+    response = client.post(\"/\", data={\"attribute\": \"abc\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"abc\"}\n+\n+    # Test with \"def\"\n+    response = client.post(\"/\", data={\"attribute\": \"def\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"def\"}\n+\n+\n+def test_optional_literal_form_invalid_value():\n+    \"\"\"Test that invalid values return 422\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Invalid value should fail\n+    response = client.post(\"/\", data={\"attribute\": \"xyz\"})\n+    assert response.status_code == 422\n+\n+    # String \"None\" is also invalid\n+    response = client.post(\"/\", data={\"attribute\": \"None\"})\n+    assert response.status_code == 422\n+\n+\n+def test_optional_literal_form_empty_string():\n+    \"\"\"Test that empty string is treated as None for optional Form fields\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Empty string is treated as \"not provided\" for optional Form fields\n+    # This is consistent with FastAPI's behavior for Form data\n+    response = client.post(\"/\", data={\"attribute\": \"\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n+\n+\n+def test_optional_literal_form_valid_values():\n+    \"\"\"Test that valid literal values work correctly\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Test with \"abc\"\n+    response = client.post(\"/\", data={\"attribute\": \"abc\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"abc\"}\n+\n+    # Test with \"def\"\n+    response = client.post(\"/\", data={\"attribute\": \"def\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"def\"}\n+\n+\n+def test_optional_literal_form_invalid_value():\n+    \"\"\"Test that invalid values return 422\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Invalid value should fail\n+    response = client.post(\"/\", data={\"attribute\": \"xyz\"})\n+    assert response.status_code == 422\n+\n+    # String \"None\" is also invalid\n+    response = client.post(\"/\", data={\"attribute\": \"None\"})\n+    assert response.status_code == 422\n+\n+\n+def test_optional_literal_form_empty_string():\n+    \"\"\"Test that empty string is treated as None for optional Form fields\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Empty string is treated as \"not provided\" for optional Form fields\n+    # This is consistent with FastAPI's behavior for Form data\n+    response = client.post(\"/\", data={\"attribute\": \"\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 171}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -347,6 +347,21 @@ def add_non_field_param_to_dependency(\n     return None\n \n \n+def _is_optional_type(annotation: Any) -> bool:\n+    \"\"\"\n+    Check if a type annotation is Optional (Union with None).\n+\n+    Optional[X] is equivalent to Union[X, None], so we check if:\n+    1. The origin is Union\n+    2. NoneType is one of the union args\n+    \"\"\"\n+    origin = get_origin(annotation)\n+    if origin is Union:\n+        args = get_args(annotation)\n+        return type(None) in args\n+    return False\n+\n+\n @dataclass\n class ParamDetails:\n     type_annotation: Any\n@@ -412,7 +427,12 @@ def analyze_param(\n                 assert not is_path_param, \"Path parameters cannot have default values\"\n                 field_info.default = value\n             else:\n-                field_info.default = RequiredParam\n+                # Check if the type annotation is Optional (Union with None)\n+                # If so, use None as default instead of RequiredParam\n+                if _is_optional_type(type_annotation):\n+                    field_info.default = None\n+                else:\n+                    field_info.default = RequiredParam\n         # Get Annotated Depends\n         elif isinstance(fastapi_annotation, params.Depends):\n             depends = fastapi_annotation\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n+\n+\n+def test_optional_literal_form_valid_values():\n+    \"\"\"Test that valid literal values work correctly\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Test with \"abc\"\n+    response = client.post(\"/\", data={\"attribute\": \"abc\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"abc\"}\n+\n+    # Test with \"def\"\n+    response = client.post(\"/\", data={\"attribute\": \"def\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"def\"}\n+\n+\n+def test_optional_literal_form_invalid_value():\n+    \"\"\"Test that invalid values return 422\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Invalid value should fail\n+    response = client.post(\"/\", data={\"attribute\": \"xyz\"})\n+    assert response.status_code == 422\n+\n+    # String \"None\" is also invalid\n+    response = client.post(\"/\", data={\"attribute\": \"None\"})\n+    assert response.status_code == 422\n+\n+\n+def test_optional_literal_form_empty_string():\n+    \"\"\"Test that empty string is treated as None for optional Form fields\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Empty string is treated as \"not provided\" for optional Form fields\n+    # This is consistent with FastAPI's behavior for Form data\n+    response = client.post(\"/\", data={\"attribute\": \"\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_op", "output": "Bug: Fix Optional[Literal] Form field handling when value is None\n\n### üêõ Bug\r\n\r\n`Optional[Literal[...]]` form fields were returning `422 Unprocessable Entity`\r\nwhen the submitted value was `None`, even though the field was optional.\r\n\r\nThis behavior was inconsistent with other optional form fields such as\r\n`Optional[str]` or `Optional[List[str]]`.\r\n\r\n### ‚úÖ Fix\r\n\r\n- Properly handle `None` values for `Optional[Literal]` form fields\r\n- Align behavior with other optional form parameters\r\n\r\n### üß™ Tests\r\n\r\n- Added tests reproducing the issue\r\n- Verified no regressions in existing request parameter tests", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 171}
{"instruction": "Review the following code changes: Fix Optional[Literal] Form field handling when value is None", "input": "```diff\n@@ -347,6 +347,21 @@ def add_non_field_param_to_dependency(\n     return None\n \n \n+def _is_optional_type(annotation: Any) -> bool:\n+    \"\"\"\n+    Check if a type annotation is Optional (Union with None).\n+\n+    Optional[X] is equivalent to Union[X, None], so we check if:\n+    1. The origin is Union\n+    2. NoneType is one of the union args\n+    \"\"\"\n+    origin = get_origin(annotation)\n+    if origin is Union:\n+        args = get_args(annotation)\n+        return type(None) in args\n+    return False\n+\n+\n @dataclass\n class ParamDetails:\n     type_annotation: Any\n@@ -412,7 +427,12 @@ def analyze_param(\n                 assert not is_path_param, \"Path parameters cannot have default values\"\n                 field_info.default = value\n             else:\n-                field_info.default = RequiredParam\n+                # Check if the type annotation is Optional (Union with None)\n+                # If so, use None as default instead of RequiredParam\n+                if _is_optional_type(type_annotation):\n+                    field_info.default = None\n+                else:\n+                    field_info.default = RequiredParam\n         # Get Annotated Depends\n         elif isinstance(fastapi_annotation, params.Depends):\n             depends = fastapi_annotation\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n+\n+\n+def test_optional_literal_form_valid_values():\n+    \"\"\"Test that valid literal values work correctly\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Test with \"abc\"\n+    response = client.post(\"/\", data={\"attribute\": \"abc\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"abc\"}\n+\n+    # Test with \"def\"\n+    response = client.post(\"/\", data={\"attribute\": \"def\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": \"def\"}\n+\n+\n+def test_optional_literal_form_invalid_value():\n+    \"\"\"Test that invalid values return 422\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Invalid value should fail\n+    response = client.post(\"/\", data={\"attribute\": \"xyz\"})\n+    assert response.status_code == 422\n+\n+    # String \"None\" is also invalid\n+    response = client.post(\"/\", data={\"attribute\": \"None\"})\n+    assert response.status_code == 422\n+\n+\n+def test_optional_literal_form_empty_string():\n+    \"\"\"Test that empty string is treated as None for optional Form fields\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # Empty string is treated as \"not provided\" for optional Form fields\n+    # This is consistent with FastAPI's behavior for Form data\n+    response = client.post(\"/\", data={\"attribute\": \"\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```\n\n```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data ", "output": "Code Review for: Fix Optional[Literal] Form field handling when value is None\n\nüìù **tests/test_request_params/test_form/test_optional_literal_form.py**: This test is incorrect..\r\nThe `attribute` parameter is **nullable**, but still **required**. So, not passing it should result in 422 error response\n\nüìù **tests/test_request_params/test_form/test_optional_literal_form.py**: This is a known issue, and it fails for `Optional[str]` as well.\r\nJust change the type annotation to `Optional[str]` and run this test on `master` branch - you will see the same error\n\n", "source": "pr", "type": "code_review", "pr_number": 171}
{"instruction": "Review this code change in `tests/test_request_params/test_form/test_optional_literal_form.py`", "input": "```diff\n@@ -0,0 +1,77 @@\n+from typing import Annotated, Literal, Optional\n+\n+from fastapi import FastAPI, Form\n+from fastapi.testclient import TestClient\n+\n+\n+def test_optional_literal_form_none():\n+    \"\"\"Test that omitting an optional form field returns None\"\"\"\n+    app = FastAPI()\n+\n+    @app.post(\"/\")\n+    async def read_main(attribute: Annotated[Optional[Literal[\"abc\", \"def\"]], Form()]):\n+        return {\"attribute\": attribute}\n+\n+    client = TestClient(app)\n+\n+    # FIXED: Use empty data instead of {\"attribute\": None}\n+    response = client.post(\"/\", data={})\n+    assert response.status_code == 200\n+    assert response.json() == {\"attribute\": None}\n\n```", "output": "This test is incorrect..\r\nThe `attribute` parameter is **nullable**, but still **required**. So, not passing it should result in 422 error response", "source": "pr_review", "type": "inline_review", "pr_number": 171}
{"instruction": "Review the following code changes: Add hyperlinks to Starlette and ASGI in middleware docs", "input": "```diff\n@@ -8,7 +8,7 @@ In this section we'll see how to use other middlewares.\n \n ## Adding ASGI middlewares { #adding-asgi-middlewares }\n \n-As **FastAPI** is based on Starlette and implements the <abbr title=\"Asynchronous Server Gateway Interface\">ASGI</abbr> specification, you can use any ASGI middleware.\n+As **FastAPI** is based on [Starlette](https://www.starlette.io/) and implements the <abbr title=\"Asynchronous Server Gateway Interface\">[ASGI](https://asgi.readthedocs.io/)</abbr> specification, you can use any ASGI middleware.\n \n A middleware doesn't have to be made for FastAPI or Starlette to work, as long as it follows the ASGI spec.\n \n\n```", "output": "Changes look good. This PR implements: Add hyperlinks to Starlette and ASGI in middleware docs", "source": "pr", "type": "code_review", "pr_number": 170}
{"instruction": "Review the following code changes: ‚ö°Ô∏è Ensure faster start-up when using many nested routers", "input": "```diff\n@@ -974,6 +974,7 @@ class Item(BaseModel):\n             include_in_schema=include_in_schema,\n             responses=responses,\n             generate_unique_id_function=generate_unique_id_function,\n+            defer_init=False,\n         )\n         self.exception_handlers: dict[\n             Any, Callable[[Request, Any], Response | Awaitable[Response]]\n\n```\n\n```diff\n@@ -21,6 +21,7 @@\n     asynccontextmanager,\n )\n from enum import Enum, IntEnum\n+from functools import cached_property\n from typing import (\n     Annotated,\n     Any,\n@@ -582,6 +583,7 @@ def __init__(\n         openapi_extra: dict[str, Any] | None = None,\n         generate_unique_id_function: Callable[[\"APIRoute\"], str]\n         | DefaultPlaceholder = Default(generate_unique_id),\n+        defer_init: bool = True,\n     ) -> None:\n         self.path = path\n         self.endpoint = endpoint\n@@ -630,20 +632,32 @@ def __init__(\n             assert is_body_allowed_for_status_code(status_code), (\n                 f\"Status code {status_code} must not have a response body\"\n             )\n-            response_name = \"Response_\" + self.unique_id\n-            self.response_field = create_model_field(\n-                name=response_name,\n-                type_=self.response_model,\n-                mode=\"serialization\",\n-            )\n-        else:\n-            self.response_field = None  # type: ignore\n+\n         self.dependencies = list(dependencies or [])\n         self.description = description or inspect.cleandoc(self.endpoint.__doc__ or \"\")\n         # if a \"form feed\" character (page break) is found in the description text,\n         # truncate description text to the content preceding the first \"form feed\"\n         self.description = self.description.split(\"\\f\")[0].strip()\n-        response_fields = {}\n+\n+        assert callable(endpoint), \"An endpoint must be a callable\"\n+\n+        if not defer_init:\n+            self.init_attributes()\n+\n+    @cached_property\n+    def response_field(self) -> ModelField | None:\n+        if not self.response_model:\n+            return None\n+        response_name = \"Response_\" + self.unique_id\n+        return create_model_field(\n+            name=response_name,\n+            type_=self.response_model,\n+            mode=\"serialization\",\n+        )\n+\n+    @cached_property\n+    def response_fields(self) -> dict[int | str, ModelField]:\n+        response_fields: dict[int | str, ModelField] = {}\n         for additional_status_code, response in self.responses.items():\n             assert isinstance(response, dict), \"An additional response must be a dict\"\n             model = response.get(\"model\")\n@@ -656,30 +670,49 @@ def __init__(\n                     name=response_name, type_=model, mode=\"serialization\"\n                 )\n                 response_fields[additional_status_code] = response_field\n-        if response_fields:\n-            self.response_fields: dict[int | str, ModelField] = response_fields\n-        else:\n-            self.response_fields = {}\n \n-        assert callable(endpoint), \"An endpoint must be a callable\"\n-        self.dependant = get_dependant(\n+        return response_fields\n+\n+    @cached_property\n+    def dependant(self) -> Dependant:\n+        dependant = get_dependant(\n             path=self.path_format, call=self.endpoint, scope=\"function\"\n         )\n         for depends in self.dependencies[::-1]:\n-    \n\n```\n\n```diff\n@@ -0,0 +1,113 @@\n+from itertools import chain\n+\n+from fastapi import APIRouter, Depends, FastAPI\n+from fastapi.routing import APIRoute\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+from starlette.routing import BaseRoute\n+\n+deferred_keys = [\n+    \"app\",\n+    \"response_fields\",\n+    \"body_field\",\n+    \"response_field\",\n+    \"dependant\",\n+    \"_flat_dependant\",\n+    \"_embed_body_fields\",\n+]\n+\n+\n+def check_if_initialized(route: APIRoute, should_not: bool = False):\n+    for key in deferred_keys:\n+        if should_not:\n+            assert key not in route.__dict__\n+        else:\n+            assert key in route.__dict__\n+\n+\n+def create_test_router(routes: list[BaseRoute] | None = None, defer_init: bool = True):\n+    router = APIRouter(routes=routes or [], defer_init=defer_init)\n+\n+    class UserIdBody(BaseModel):\n+        user_id: int\n+\n+    @router.get(\"/user_id\", dependencies=[Depends(lambda: True)])\n+    async def get_user_id(user_id: int = Depends(lambda: 1)) -> UserIdBody:\n+        return {\"user_id\": user_id}\n+\n+    return router\n+\n+\n+def test_route_defers():\n+    app = FastAPI()\n+    router = create_test_router(routes=app.router.routes)\n+\n+    for route in router.routes:\n+        if not isinstance(route, APIRoute):\n+            continue\n+        check_if_initialized(route, should_not=True)\n+\n+    app.router = router\n+    client = TestClient(app)\n+    response = client.get(\"/user_id\")\n+    assert response.status_code == 200\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200\n+\n+    for route in router.routes:\n+        i", "output": "Changes look good. This PR implements: ‚ö°Ô∏è Ensure faster start-up when using many nested routers", "source": "pr", "type": "code_review", "pr_number": 169}
{"instruction": "Fix the following bug: fix: support mounting StaticFiles on APIRouter and propagate via include_router", "input": "Fixes #10180\n\n## Description\n\n`APIRouter` did not support mounting `StaticFiles` (or any ASGI app) because `Mount` objects were silently ignored in `include_router()`.\n\nThis PR fixes the issue by:\n\n- Overriding `APIRouter.mount()` to only allow `StaticFiles`; raises `FastAPIError` for any other ASGI app with a clear error message\n- Adding `APIRouter._mount()` as an internal method used by `include_router()` and `FastAPI.mount()`\n- Overriding `FastAPI.mount()` to call `self.router._mount()` directly (bypassing the StaticFiles-only restriction on `APIRouter`)\n- Propagating `StaticFiles` mounts in `include_router()` with correct path combining: `prefix + router.prefix + route.path`\n\n## Example\n\n```python\nfrom fastapi import APIRouter, FastAPI\nfrom fastapi.staticfiles import StaticFiles\n\napp = FastAPI()\nrouter = APIRouter(prefix=\"/api\")\n\nrouter.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")\napp.include_router(router)\n\n# Now accessible at /api/static/...\n```\n\n## Tests\n\nAdded `tests/test_apirouter_mount.py` with 4 test cases:\n- StaticFiles mounted on APIRouter with prefix\n- StaticFiles mounted on APIRouter without prefix\n- `include_router` prefix + router prefix + mount path combining\n- Non-StaticFiles app raises `FastAPIError`", "output": "```diff\n@@ -1133,6 +1133,9 @@ async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n             scope[\"root_path\"] = self.root_path\n         await super().__call__(scope, receive, send)\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        self.router._mount(path, app=app, name=name)\n+\n     def add_api_route(\n         self,\n         path: str,\n\n```\n\n```diff\n@@ -74,6 +74,7 @@\n     get_name,\n )\n from starlette.routing import Mount as Mount  # noqa\n+from starlette.staticfiles import StaticFiles\n from starlette.types import AppType, ASGIApp, Lifespan, Receive, Scope, Send\n from starlette.websockets import WebSocket\n from typing_extensions import deprecated\n@@ -993,6 +994,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        \"\"\"\n+        Mount a StaticFiles instance.\n+        Will raise a FastAPIError exception if app is not an instance of StaticFiles.\n+        \"\"\"\n+        if not isinstance(app, StaticFiles):\n+            raise FastAPIError(\n+                \"APIRouter does not support mounting ASGI applications other than StaticFiles.\"\n+            )\n+        self._mount(path=path, app=app, name=name)\n+\n+    def _mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        super().mount(path=path, app=app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1489,6 +1504,11 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                if isinstance(route.app, StaticFiles):\n+                    self._mount(\n+                        prefix + router.prefix + route.path, route.app, name=route.name\n+                    )\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,82 @@\n+\"\"\"Tests for mounting StaticFiles under APIRouter (issue #10180).\"\"\"\n+\n+from pathlib import Path\n+\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+from fastapi.exceptions import FastAPIError\n+from fastapi.staticfiles import StaticFiles\n+from fastapi.testclient import TestClient\n+\n+\n+def test_mount_staticfiles_under_router_with_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter with prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"hello.txt\"\n+    static_file.write_text(\"hello world\")\n+\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/app\")\n+    def read_main() -> dict:\n+        return {\"message\": \"Hello World from main app\"}\n+\n+    api_router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Regular route should still work\n+    r = client.get(\"/api/app\")\n+    assert r.status_code == 200\n+\n+    # StaticFiles should be accessible under router prefix\n+    r = client.get(\"/api/static/hello.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"hello world\"\n+\n+\n+def test_mount_staticfiles_under_router_without_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter without prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"test.txt\"\n+    static_file.write_text(\"test content\")\n+\n+    app = FastAPI()\n+    router = APIRouter()\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router)\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/static/test.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"test content\"\n+\n+\n+def test_mount_staticfiles_with_include_router_prefix(tmp_path: Path) -> None:\n+    \"\"\"include_router prefix + router prefix + mount path should all combine.\"\"\"\n+    static_file = tmp_path / \"file.txt\"\n+    static_file.write_text(\"combined prefix\")\n+\n+    app = FastAPI()\n+    router = APIRouter(prefix=\"/api\")\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router, prefix=\"/v1\")\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/v1/api/static/file.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"combined prefix\"\n+\n+\n+def test_mount_non_staticfiles_app_raises_error() -> None:\n+    \"\"\"Mounting a non-StaticFiles ASGI app on APIRouter should raise FastAPIError.\"\"\"\n+    router = APIRouter()\n+    sub_app = FastAPI()\n+\n+    with pytest.raises(\n+        FastAPIError,\n+        match=\"APIRouter does not support mounting ASGI applications other than StaticFiles.\",\n+    ):\n+        router.mount(\"/sub\", sub_app)\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 168}
{"instruction": "Review the following code changes: fix: support mounting StaticFiles on APIRouter and propagate via include_router", "input": "```diff\n@@ -1133,6 +1133,9 @@ async def __call__(self, scope: Scope, receive: Receive, send: Send) -> None:\n             scope[\"root_path\"] = self.root_path\n         await super().__call__(scope, receive, send)\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        self.router._mount(path, app=app, name=name)\n+\n     def add_api_route(\n         self,\n         path: str,\n\n```\n\n```diff\n@@ -74,6 +74,7 @@\n     get_name,\n )\n from starlette.routing import Mount as Mount  # noqa\n+from starlette.staticfiles import StaticFiles\n from starlette.types import AppType, ASGIApp, Lifespan, Receive, Scope, Send\n from starlette.websockets import WebSocket\n from typing_extensions import deprecated\n@@ -993,6 +994,20 @@ def __init__(\n         self.default_response_class = default_response_class\n         self.generate_unique_id_function = generate_unique_id_function\n \n+    def mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        \"\"\"\n+        Mount a StaticFiles instance.\n+        Will raise a FastAPIError exception if app is not an instance of StaticFiles.\n+        \"\"\"\n+        if not isinstance(app, StaticFiles):\n+            raise FastAPIError(\n+                \"APIRouter does not support mounting ASGI applications other than StaticFiles.\"\n+            )\n+        self._mount(path=path, app=app, name=name)\n+\n+    def _mount(self, path: str, app: ASGIApp, name: str | None = None) -> None:\n+        super().mount(path=path, app=app, name=name)\n+\n     def route(\n         self,\n         path: str,\n@@ -1489,6 +1504,11 @@ def read_users():\n                 self.add_websocket_route(\n                     prefix + route.path, route.endpoint, name=route.name\n                 )\n+            elif isinstance(route, routing.Mount):\n+                if isinstance(route.app, StaticFiles):\n+                    self._mount(\n+                        prefix + router.prefix + route.path, route.app, name=route.name\n+                    )\n         for handler in router.on_startup:\n             self.add_event_handler(\"startup\", handler)\n         for handler in router.on_shutdown:\n\n```\n\n```diff\n@@ -0,0 +1,82 @@\n+\"\"\"Tests for mounting StaticFiles under APIRouter (issue #10180).\"\"\"\n+\n+from pathlib import Path\n+\n+import pytest\n+from fastapi import APIRouter, FastAPI\n+from fastapi.exceptions import FastAPIError\n+from fastapi.staticfiles import StaticFiles\n+from fastapi.testclient import TestClient\n+\n+\n+def test_mount_staticfiles_under_router_with_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter with prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"hello.txt\"\n+    static_file.write_text(\"hello world\")\n+\n+    app = FastAPI()\n+    api_router = APIRouter(prefix=\"/api\")\n+\n+    @api_router.get(\"/app\")\n+    def read_main() -> dict:\n+        return {\"message\": \"Hello World from main app\"}\n+\n+    api_router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(api_router)\n+\n+    client = TestClient(app)\n+\n+    # Regular route should still work\n+    r = client.get(\"/api/app\")\n+    assert r.status_code == 200\n+\n+    # StaticFiles should be accessible under router prefix\n+    r = client.get(\"/api/static/hello.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"hello world\"\n+\n+\n+def test_mount_staticfiles_under_router_without_prefix(tmp_path: Path) -> None:\n+    \"\"\"StaticFiles mounted on APIRouter without prefix should be accessible.\"\"\"\n+    static_file = tmp_path / \"test.txt\"\n+    static_file.write_text(\"test content\")\n+\n+    app = FastAPI()\n+    router = APIRouter()\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router)\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/static/test.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"test content\"\n+\n+\n+def test_mount_staticfiles_with_include_router_prefix(tmp_path: Path) -> None:\n+    \"\"\"include_router prefix + router prefix + mount path should all combine.\"\"\"\n+    static_file = tmp_path / \"file.txt\"\n+    static_file.write_text(\"combined prefix\")\n+\n+    app = FastAPI()\n+    router = APIRouter(prefix=\"/api\")\n+    router.mount(\"/static\", StaticFiles(directory=tmp_path), name=\"static\")\n+    app.include_router(router, prefix=\"/v1\")\n+\n+    client = TestClient(app)\n+\n+    r = client.get(\"/v1/api/static/file.txt\")\n+    assert r.status_code == 200\n+    assert r.text == \"combined prefix\"\n+\n+\n+def test_mount_non_staticfiles_app_raises_error() -> None:\n+    \"\"\"Mounting a non-StaticFiles ASGI app on APIRouter should raise FastAPIError.\"\"\"\n+    router = APIRouter()\n+    sub_app = FastAPI()\n+\n+    with pytest.raises(\n+        FastAPIError,\n+        match=\"APIRouter does not support mounting ASGI applications other than StaticFiles.\",\n+    ):\n+        router.mount(\"/sub\", sub_app)\n\n```", "output": "Changes look good. This PR implements: fix: support mounting StaticFiles on APIRouter and propagate via include_router", "source": "pr", "type": "code_review", "pr_number": 168}
{"instruction": "Review the following code changes: Improve wording and clarity in FastAPI CLI documentation", "input": "```diff\n@@ -1,8 +1,9 @@\n+\n```", "output": "Changes look good. This PR implements: Improve wording and clarity in FastAPI CLI documentation", "source": "pr", "type": "code_review", "pr_number": 167}
{"instruction": "Fix the following bug: refactor: Make the logic more explicit in validation error insertion in get_openapi_path", "input": "This PR simplifies and clarifies the logic that determines when a 422 Validation Error response should be added to an operation's OpenAPI schema.\r\n\r\nWhy is this an improvement?\r\n\r\n**Improved readability:** The conditions are easier to understand at a glance, reducing cognitive load during maintenance.\r\n\r\n**Less error-prone:** Explicit naming makes it clear why validation errors are added and avoids misinterpreting the previous inline logic.\r\n\r\n**Behavior preserved:** No functional change- only a clarity/refactor improvement.", "output": "```diff\n@@ -417,9 +417,12 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n+            if (\n+                (all_route_params or route.body_field)  # May raise validation error\n+                and not any(  # Doesn't have a defined validation error response already\n+                    status in operation[\"responses\"]\n+                    for status in [http422, \"4XX\", \"default\"]\n+                )\n             ):\n                 operation[\"responses\"][http422] = {\n                     \"description\": \"Validation Error\",\n\n```\n\n```diff\n@@ -417,10 +417,11 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n-            ):\n+            requires_validation_error = bool(all_route_params or route.body_field)\n+            has_validation_response = any(\n+                status in operation[\"responses\"] for status in (\"422\", \"4XX\", \"default\")\n+            )\n+            if requires_validation_error and not has_validation_response:\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 166}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -417,9 +417,12 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n+            if (\n+                (all_route_params or route.body_field)  # May raise validation error\n+                and not any(  # Doesn't have a defined validation error response already\n+                    status in operation[\"responses\"]\n+                    for status in [http422, \"4XX\", \"default\"]\n+                )\n             ):\n                 operation[\"responses\"][http422] = {\n                     \"description\": \"Validation Error\",\n\n```\n\n```diff\n@@ -417,10 +417,11 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n-            ):\n+            requires_validation_error = bool(all_route_params or route.body_field)\n+            has_validation_response = any(\n+                status in operation[\"responses\"] for status in (\"422\", \"4XX\", \"default\")\n+            )\n+            if requires_validation_error and not has_validation_response:\n\n```", "output": "Bug: refactor: Make the logic more explicit in validation error insertion in get_openapi_path\n\nThis PR simplifies and clarifies the logic that determines when a 422 Validation Error response should be added to an operation's OpenAPI schema.\r\n\r\nWhy is this an improvement?\r\n\r\n**Improved readability:** The conditions are easier to understand at a glance, reducing cognitive load during maintenance.\r\n\r\n**Less error-prone:** Explicit naming makes it clear why validation errors are added and avoids misinterpreting the previous inline logic.\r\n\r\n**Behavior preserved:** No functional change- only a clarity/refactor improvement.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 166}
{"instruction": "Review the following code changes: refactor: Make the logic more explicit in validation error insertion in get_openapi_path", "input": "```diff\n@@ -417,9 +417,12 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n+            if (\n+                (all_route_params or route.body_field)  # May raise validation error\n+                and not any(  # Doesn't have a defined validation error response already\n+                    status in operation[\"responses\"]\n+                    for status in [http422, \"4XX\", \"default\"]\n+                )\n             ):\n                 operation[\"responses\"][http422] = {\n                     \"description\": \"Validation Error\",\n\n```\n\n```diff\n@@ -417,10 +417,11 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n-            ):\n+            requires_validation_error = bool(all_route_params or route.body_field)\n+            has_validation_response = any(\n+                status in operation[\"responses\"] for status in (\"422\", \"4XX\", \"default\")\n+            )\n+            if requires_validation_error and not has_validation_response:\n\n```", "output": "Code Review for: refactor: Make the logic more explicit in validation error insertion in get_openapi_path\n\nüìù **fastapi/openapi/utils.py**: ```suggestion\r\n            if (\r\n                (all_route_params or route.body_field)  # May raise validation error\r\n                and not any(  # Doesn't have a defined validation error response already\r\n                    status in operation[\"responses\"]\r\n                    for status in [http422, \"4XX\", \"default\"]\r\n                )\r\n            ):\r\n```\r\n\r\nI'm not sure clarifications are needed for this part of code, but if we decide to clarify it, I would just add comments\r\n\n", "source": "pr", "type": "code_review", "pr_number": 166}
{"instruction": "Review this code change in `fastapi/openapi/utils.py`", "input": "```diff\n@@ -417,10 +417,11 @@ def get_openapi_path(\n                     openapi_response[\"description\"] = description\n             http422 = \"422\"\n             all_route_params = get_flat_params(route.dependant)\n-            if (all_route_params or route.body_field) and not any(\n-                status in operation[\"responses\"]\n-                for status in [http422, \"4XX\", \"default\"]\n-            ):\n+            requires_validation_error = bool(all_route_params or route.body_field)\n+            has_validation_response = any(\n+                status in operation[\"responses\"] for status in (\"422\", \"4XX\", \"default\")\n+            )\n+            if requires_validation_error and not has_validation_response:\n\n```", "output": "```suggestion\r\n            if (\r\n                (all_route_params or route.body_field)  # May raise validation error\r\n                and not any(  # Doesn't have a defined validation error response already\r\n                    status in operation[\"responses\"]\r\n                    for status in [http422, \"4XX\", \"default\"]\r\n                )\r\n            ):\r\n```\r\n\r\nI'm not sure clarifications are needed for this part of code, but if we decide to clarify it, I would just add comments\r", "source": "pr_review", "type": "inline_review", "pr_number": 166}
{"instruction": "Review the following code changes: üìù Clarify when to use async def vs def", "input": "```diff\n@@ -349,6 +349,11 @@ async def read_burgers():\n     return burgers\n \n```", "output": "Changes look good. This PR implements: üìù Clarify when to use async def vs def", "source": "pr", "type": "code_review", "pr_number": 165}
{"instruction": "Fix the following bug: Fix XSS vulnerability", "input": "This PR addresses a security issue identified by Semgrep. The vulnerable code used innerHTML to render user-controlled data, which could lead to XSS attacks.\r\n\r\n**What was fixed:**\r\n\r\nReplaced innerHTML with safe DOM manipulation (document.createElement)\r\n\r\nReplaced direct HTML insertion with textContent for user input\r\n\r\nReplaced attribute string concatenation with setAttribute() and className\r\n\r\nPreserved existing behavior while removing XSS risk", "output": "```diff\n@@ -222,10 +222,26 @@ class Termynal {\n      */\n     lineDataToElements(lineData) {\n         return lineData.map(line => {\n-            let div = document.createElement('div');\n-            div.innerHTML = `<span ${this._attributes(line)}>${line.value || ''}</span>`;\n+            let span = document.createElement('span');\n+            \n+            // Safely set text content instead of using innerHTML\n+            span.textContent = line.value || '';\n+            \n+            // Safely set attributes\n+            for (let prop in line) {\n+                // Custom add class\n+                if (prop === 'class') {\n+                    span.className = line[prop];\n+                    continue;\n+                }\n+                if (prop === 'type') {\n+                    span.setAttribute(this.pfx, line[prop]);\n+                } else if (prop !== 'value') {\n+                    span.setAttribute(`${this.pfx}-${prop}`, line[prop]);\n+                }\n+            }\n \n-            return div.firstElementChild;\n+            return span;\n         });\n     }\n \n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+import os\n from datetime import datetime, timedelta, timezone\n from typing import Annotated, Union\n \n@@ -10,7 +11,7 @@\n \n # to get a string like this run:\n # openssl rand -hex 32\n-SECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\n+SECRET_KEY = os.environ.get(\"SECRET_KEY\", \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\")\n ALGORITHM = \"HS256\"\n ACCESS_TOKEN_EXPIRE_MINUTES = 30\n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 164}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -222,10 +222,26 @@ class Termynal {\n      */\n     lineDataToElements(lineData) {\n         return lineData.map(line => {\n-            let div = document.createElement('div');\n-            div.innerHTML = `<span ${this._attributes(line)}>${line.value || ''}</span>`;\n+            let span = document.createElement('span');\n+            \n+            // Safely set text content instead of using innerHTML\n+            span.textContent = line.value || '';\n+            \n+            // Safely set attributes\n+            for (let prop in line) {\n+                // Custom add class\n+                if (prop === 'class') {\n+                    span.className = line[prop];\n+                    continue;\n+                }\n+                if (prop === 'type') {\n+                    span.setAttribute(this.pfx, line[prop]);\n+                } else if (prop !== 'value') {\n+                    span.setAttribute(`${this.pfx}-${prop}`, line[prop]);\n+                }\n+            }\n \n-            return div.firstElementChild;\n+            return span;\n         });\n     }\n \n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+import os\n from datetime import datetime, timedelta, timezone\n from typing import Annotated, Union\n \n@@ -10,7 +11,7 @@\n \n # to get a string like this run:\n # openssl rand -hex 32\n-SECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\n+SECRET_KEY = os.environ.get(\"SECRET_KEY\", \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\")\n ALGORITHM = \"HS256\"\n ACCESS_TOKEN_EXPIRE_MINUTES = 30\n \n\n```", "output": "Bug: Fix XSS vulnerability\n\nThis PR addresses a security issue identified by Semgrep. The vulnerable code used innerHTML to render user-controlled data, which could lead to XSS attacks.\r\n\r\n**What was fixed:**\r\n\r\nReplaced innerHTML with safe DOM manipulation (document.createElement)\r\n\r\nReplaced direct HTML insertion with textContent for user input\r\n\r\nReplaced attribute string concatenation with setAttribute() and className\r\n\r\nPreserved existing behavior while removing XSS risk", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 164}
{"instruction": "Review the following code changes: Fix XSS vulnerability", "input": "```diff\n@@ -222,10 +222,26 @@ class Termynal {\n      */\n     lineDataToElements(lineData) {\n         return lineData.map(line => {\n-            let div = document.createElement('div');\n-            div.innerHTML = `<span ${this._attributes(line)}>${line.value || ''}</span>`;\n+            let span = document.createElement('span');\n+            \n+            // Safely set text content instead of using innerHTML\n+            span.textContent = line.value || '';\n+            \n+            // Safely set attributes\n+            for (let prop in line) {\n+                // Custom add class\n+                if (prop === 'class') {\n+                    span.className = line[prop];\n+                    continue;\n+                }\n+                if (prop === 'type') {\n+                    span.setAttribute(this.pfx, line[prop]);\n+                } else if (prop !== 'value') {\n+                    span.setAttribute(`${this.pfx}-${prop}`, line[prop]);\n+                }\n+            }\n \n-            return div.firstElementChild;\n+            return span;\n         });\n     }\n \n\n```\n\n```diff\n@@ -1,3 +1,4 @@\n+import os\n from datetime import datetime, timedelta, timezone\n from typing import Annotated, Union\n \n@@ -10,7 +11,7 @@\n \n # to get a string like this run:\n # openssl rand -hex 32\n-SECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\n+SECRET_KEY = os.environ.get(\"SECRET_KEY\", \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\")\n ALGORITHM = \"HS256\"\n ACCESS_TOKEN_EXPIRE_MINUTES = 30\n \n\n```", "output": "Changes look good. This PR implements: Fix XSS vulnerability", "source": "pr", "type": "code_review", "pr_number": 164}
{"instruction": "Review the following code changes: üîß Enable FURB ruff rule", "input": "```diff\n@@ -436,9 +436,7 @@ async def app(request: Request) -> Response:\n                 }\n                 # If status_code was set, use it, otherwise use the default from the\n                 # response class, in the case of redirect it's 307\n-                current_status_code = (\n-                    status_code if status_code else solved_result.response.status_code\n-                )\n+                current_status_code = status_code or solved_result.response.status_code\n                 if current_status_code is not None:\n                     response_args[\"status_code\"] = current_status_code\n                 if solved_result.response.status_code:\n\n```\n\n```diff\n@@ -502,6 +502,7 @@ select = [\n     \"B\",  # flake8-bugbear\n     \"C4\",  # flake8-comprehensions\n     \"UP\",  # pyupgrade\n+    \"FURB\"  # refurb\n ]\n ignore = [\n     \"E501\",  # line too long, handled by black\n\n```\n\n```diff\n@@ -1,5 +1,5 @@\n import re\n-from typing import TypedDict, Union\n+from typing import TypedDict\n \n CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n@@ -50,8 +50,8 @@ class MarkdownLinkInfo(TypedDict):\n     line_no: int\n     url: str\n     text: str\n-    title: Union[str, None]\n-    attributes: Union[str, None]\n+    title: str | None\n+    attributes: str | None\n     full_match: str\n \n \n@@ -287,8 +287,8 @@ def _add_lang_code_to_url(url: str, lang_code: str) -> str:\n def _construct_markdown_link(\n     url: str,\n     text: str,\n-    title: Union[str, None],\n-    attributes: Union[str, None],\n+    title: str | None,\n+    attributes: str | None,\n     lang_code: str,\n ) -> str:\n     \"\"\"\n@@ -549,7 +549,7 @@ def extract_multiline_code_blocks(text: list[str]) -> list[MultilineCodeBlockInf\n     return blocks\n \n \n-def _split_hash_comment(line: str) -> tuple[str, Union[str, None]]:\n+def _split_hash_comment(line: str) -> tuple[str, str | None]:\n     match = HASH_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -558,7 +558,7 @@ def _split_hash_comment(line: str) -> tuple[str, Union[str, None]]:\n     return line.rstrip(), None\n \n \n-def _split_slashes_comment(line: str) -> tuple[str, Union[str, None]]:\n+def _split_slashes_comment(line: str) -> tuple[str, str | None]:\n     match = SLASHES_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -594,7 +594,7 @@ def replace_multiline_code_block(\n         )\n \n     block_language = block_a[\"lang\"].lower()\n-    if block_language in {\"mermaid\"}:\n+    if block_language == \"mermaid\":\n         if block_a != block_b:\n             print(\n                 f\"Skipping mermaid code block replacement (lines {start_line}-{end_line_no}). \"\n@@ -604,8 +604,8 @@ def replace_multiline_code_block(\n \n     code_block: list[str] = []\n     for line_a, line_b in zip(block_a[\"content\"], block_b[\"content\"]):\n-        line_a_comment: Union[str, None] = None\n-        line_b_comment: Union[str, None] = None\n+        line_a_comment: str | None = None\n+        line_b_comment: str | None = None\n \n         # Handle comments based on language\n         if block_language in {\n\n```\n\n```diff\n@@ -288,13 +288,14 @@ show_contexts = true\n \n [tool.ruff.lint]\n select = [\n-    \"E\",  # pycodestyle errors\n-    \"W\",  # pycodestyle warnings\n-    \"F\",  # pyflakes\n-    \"I\",  # isort\n-    \"B\",  # flake8-bugbear\n-    \"C4\",  # flake8-comprehensions\n-    \"UP\",  # pyupgrade\n+    \"E\",    # pycodestyle errors\n+    \"W\",    # pycodestyle warnings\n+    \"F\",    # pyflakes\n+    \"I\",    # isort\n+    \"B\",    # flake8-bugbear\n+    \"C4\",   # flake8-comprehensions\n+    \"UP\",   # pyupgrade\n+    \"FURB\"  # refurb\n\n```\n\n```diff\n@@ -152,7 +152,7 @@ docs = [\n ]\n docs-tests = [\n     \"httpx >=0.23.0,<1.0.0\",\n-    \"ruff >=0.14.14\",\n+    \"ruff >=0.15.0\",\n\n```", "output": "Code Review for: üîß Enable FURB ruff rule\n\nüìù **pyproject.toml**: ```suggestion\n    \"E\",  # pycodestyle errors\n    \"W\",  # pycodestyle warnings\n    \"F\",  # pyflakes\n    \"I\",  # isort\n    \"B\",  # flake8-bugbear\n    \"C4\",  # flake8-comprehensions\n    \"UP\",  # pyupgrade\n    \"FURB\"  # refurb\n```\n\nüìù **pyproject.toml**: If this is not necessary for this rule to work, it should be done in a separate PR (dependabot will take care of it)\n```suggestion\n    \"ruff >=0.14.14\",\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 163}
{"instruction": "Review this code change in `pyproject.toml`", "input": "```diff\n@@ -288,13 +288,14 @@ show_contexts = true\n \n [tool.ruff.lint]\n select = [\n-    \"E\",  # pycodestyle errors\n-    \"W\",  # pycodestyle warnings\n-    \"F\",  # pyflakes\n-    \"I\",  # isort\n-    \"B\",  # flake8-bugbear\n-    \"C4\",  # flake8-comprehensions\n-    \"UP\",  # pyupgrade\n+    \"E\",    # pycodestyle errors\n+    \"W\",    # pycodestyle warnings\n+    \"F\",    # pyflakes\n+    \"I\",    # isort\n+    \"B\",    # flake8-bugbear\n+    \"C4\",   # flake8-comprehensions\n+    \"UP\",   # pyupgrade\n+    \"FURB\"  # refurb\n\n```", "output": "```suggestion\n    \"E\",  # pycodestyle errors\n    \"W\",  # pycodestyle warnings\n    \"F\",  # pyflakes\n    \"I\",  # isort\n    \"B\",  # flake8-bugbear\n    \"C4\",  # flake8-comprehensions\n    \"UP\",  # pyupgrade\n    \"FURB\"  # refurb\n```", "source": "pr_review", "type": "inline_review", "pr_number": 163}
{"instruction": "Review this code change in `pyproject.toml`", "input": "```diff\n@@ -152,7 +152,7 @@ docs = [\n ]\n docs-tests = [\n     \"httpx >=0.23.0,<1.0.0\",\n-    \"ruff >=0.14.14\",\n+    \"ruff >=0.15.0\",\n\n```", "output": "If this is not necessary for this rule to work, it should be done in a separate PR (dependabot will take care of it)\n```suggestion\n    \"ruff >=0.14.14\",\n```", "source": "pr_review", "type": "inline_review", "pr_number": 163}
{"instruction": "Review the following code changes: use annotated description as Field description", "input": "```diff\n@@ -367,6 +367,7 @@ def analyze_param(\n     used_default_field_info = False\n     depends = None\n     type_annotation: Any = Any\n+    description: Optional[str] = None\n     if (\n         annotation is not inspect.Signature.empty\n         and get_origin(annotation) is Annotated  # type: ignore[comparison-overlap]\n@@ -376,7 +377,7 @@ def analyze_param(\n         fastapi_annotations = [\n             arg\n             for arg in annotated_args[1:]\n-            if isinstance(arg, (FieldInfo, params.Depends))\n+            if isinstance(arg, (FieldInfo, params.Depends, str))\n         ]\n         assert (\n             len(fastapi_annotations) <= 1\n@@ -396,6 +397,8 @@ def analyze_param(\n                 field_info.default = Required\n         elif isinstance(fastapi_annotation, params.Depends):\n             depends = fastapi_annotation\n+        elif isinstance(fastapi_annotation, str):\n+            description = fastapi_annotation\n     elif annotation is not inspect.Signature.empty:\n         type_annotation = annotation\n \n@@ -433,9 +436,10 @@ def analyze_param(\n             # We might check here that `default_value is Required`, but the fact is that the same\n             # parameter might sometimes be a path parameter and sometimes not. See\n             # `tests/test_infer_param_optionality.py` for an example.\n-            field_info = params.Path()\n+            field_info = params.Path(description=description)\n         else:\n-            field_info = params.Query(default=default_value)\n+            field_info = params.Query(default=default_value, description=description)\n+\n         used_default_field_info = True\n \n     field = None\n\n```\n\n```diff\n@@ -26,6 +26,11 @@ async def unrelated(foo: Annotated[str, object()]):\n     return {\"foo\": foo}\n \n \n+@app.get(\"/description\")\n+async def description(foo: Annotated[str, \"should default to foo\"] = \"foo\"):\n+    return {\"foo\": foo}\n+\n+\n client = TestClient(app)\n \n foo_is_missing = {\n@@ -62,6 +67,8 @@ async def unrelated(foo: Annotated[str, object()]):\n         (\"/multiple?foo=\", 422, foo_is_short),\n         (\"/unrelated?foo=bar\", 200, {\"foo\": \"bar\"}),\n         (\"/unrelated\", 422, foo_is_missing),\n+        (\"/description\", 200, {\"foo\": \"foo\"}),\n+        (\"/description?foo=bar\", 200, {\"foo\": \"bar\"}),\n     ],\n )\n def test_get(path, expected_status, expected_response):\n@@ -96,6 +103,28 @@ async def test(var: Annotated[str, Query()] = \"bar\"):\n     assert response.json() == {\"foo\": \"baz\"}\n \n \n+def test_multiple_optional_path():\n+    app = FastAPI()\n+\n+    @app.get(\"/test1/{var}\")\n+    @app.get(\"/test1\")\n+    async def test(var: Annotated[str, \"a var value\"] = \"bar\"):\n+        return {\"foo\": var}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/test1\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": \"bar\"}\n+\n+    response = client.get(\"/test1\", params={\"var\": \"baz\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": \"baz\"}\n+\n+    response = client.get(\"/test1/baz\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": \"baz\"}\n+\n+\n def test_nested_router():\n     app = FastAPI()\n \n@@ -253,6 +282,42 @@ def test_openapi_schema():\n                     },\n                 }\n             },\n+            \"/description\": {\n+                \"get\": {\n+                    \"summary\": \"Description\",\n+                    \"operationId\": \"description_description_get\",\n+                    \"parameters\": [\n+                        {\n+                            \"description\": \"should default to foo\",\n+                            \"required\": False,\n+                            \"schema\": {\n+                                \"title\": \"Foo\",\n+                                \"type\": \"string\",\n+                                \"description\": \"should default to foo\",\n+                                \"default\": \"foo\",\n+                            },\n+                            \"name\": \"foo\",\n+                            \"in\": \"query\",\n+                        }\n+                    ],\n+                    \"responses\": {\n+                        \"200\": {\n+                            \"description\": \"Successful Response\",\n+                            \"content\": {\"application/json\": {\"schema\": {}}},\n+                        },\n+                        \"422\": {\n+                            \"description\": \"Validation Error\",\n+                            \"content\": {\n+                                \"application/json\": {\n+                                    \"schema\": {\n+                                        \"$ref\": \"#/components/schemas/HTTPValidationError\"\n+                                    }\n\n```\n\n```diff\n@@ -96,6 +103,28 @@ async def test(var: Annotated[str, Query()] = \"bar\"):\n     assert response.json() == {\"foo\": \"baz\"}\n \n \n+def test_multiple_optional_path():\n+    app = FastAPI()\n+\n+    @app.get(\"/test1/{var}\")\n+    @app.get(\"/test1\")\n+    async def test(var: Annotated[str, \"a var value\"] = \"bar\"):\n+        retur", "output": "Code Review for: use annotated description as Field description\n\nüìù **tests/test_annotated.py**: This is kinda not related to the PR's goal but I felt it was important to have this test to make sure this feature (supporting optional path) is supported! \n\n", "source": "pr", "type": "code_review", "pr_number": 162}
{"instruction": "Review this code change in `tests/test_annotated.py`", "input": "```diff\n@@ -96,6 +103,28 @@ async def test(var: Annotated[str, Query()] = \"bar\"):\n     assert response.json() == {\"foo\": \"baz\"}\n \n \n+def test_multiple_optional_path():\n+    app = FastAPI()\n+\n+    @app.get(\"/test1/{var}\")\n+    @app.get(\"/test1\")\n+    async def test(var: Annotated[str, \"a var value\"] = \"bar\"):\n+        return {\"foo\": var}\n+\n+    client = TestClient(app)\n+    response = client.get(\"/test1\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": \"bar\"}\n+\n+    response = client.get(\"/test1\", params={\"var\": \"baz\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": \"baz\"}\n+\n+    response = client.get(\"/test1/baz\")\n+    assert response.status_code == 200\n+    assert response.json() == {\"foo\": \"baz\"}\n\n```", "output": "This is kinda not related to the PR's goal but I felt it was important to have this test to make sure this feature (supporting optional path) is supported! ", "source": "pr_review", "type": "inline_review", "pr_number": 162}
{"instruction": "Review the following code changes: [14350] Added ScyllaDB and Cassandra docs and tests", "input": "```diff\n@@ -0,0 +1,341 @@\n+# NoSQL Databases { #nosql-databases }\n+\n+**FastAPI** doesn't require you to use a SQL (relational) database.\n+\n+Here we'll see an example using <a href=\"https://cassandra.apache.org/\" class=\"external-link\" target=\"_blank\">Apache Cassandra</a>, a popular distributed NoSQL database.\n+\n+We'll also show how <a href=\"https://www.scylladb.com/\" class=\"external-link\" target=\"_blank\">ScyllaDB</a>, a Cassandra-compatible database, works using the exact same code.\n+\n+/// tip\n+\n+FastAPI doesn't force you to use any specific database. This tutorial demonstrates Cassandra/ScyllaDB, but you can use other databases with their respective Python drivers.\n+\n+///\n+\n+## Install Dependencies { #install-dependencies }\n+\n+First, make sure you create your [virtual environment](../virtual-environments.md){.internal-link target=_blank}, activate it, and then install the Cassandra driver:\n+\n+<div class=\"termy\">\n+\n+\n```\n\n```diff\n@@ -150,6 +150,7 @@ nav:\n     - tutorial/middleware.md\n     - tutorial/cors.md\n     - tutorial/sql-databases.md\n+    - tutorial/nosql-databases.md\n     - tutorial/bigger-applications.md\n     - tutorial/background-tasks.md\n     - tutorial/metadata.md\n\n```\n\n```diff\n@@ -0,0 +1,147 @@\n+from contextlib import asynccontextmanager\n+from typing import List, Union\n+from uuid import UUID, uuid4\n+\n+from cassandra.cluster import Cluster\n+from fastapi import Depends, FastAPI, HTTPException\n+from pydantic import BaseModel, Field\n+\n+\n+class TaskBase(BaseModel):\n+    title: str\n+    description: Union[str, None] = None\n+    status: str = \"pending\"\n+\n+\n+class TaskCreate(TaskBase):\n+    pass\n+\n+\n+class Task(TaskBase):\n+    id: UUID = Field(default_factory=uuid4)\n+\n+\n+class CassandraConnection:\n+    def __init__(self, hosts=None, port=9042):\n+        self.cluster = Cluster(hosts or [\"cassandra\"], port=port)\n+        self.session = None\n+        self.keyspace = \"task_manager\"\n+\n+    def connect(self):\n+        self.session = self.cluster.connect()\n+        self.create_keyspace()\n+        self.session.set_keyspace(self.keyspace)\n+        self.create_table()\n+\n+    def create_keyspace(self):\n+        self.session.execute(\n+            f\"\"\"\n+            CREATE KEYSPACE IF NOT EXISTS {self.keyspace}\n+            WITH replication = {{'class': 'SimpleStrategy', 'replication_factor': 1}}\n+            \"\"\"\n+        )\n+\n+    def create_table(self):\n+        self.session.execute(\n+            \"\"\"\n+            CREATE TABLE IF NOT EXISTS tasks (\n+                id uuid PRIMARY KEY,\n+                title text,\n+                description text,\n+                status text,\n+                created_at timestamp,\n+                updated_at timestamp\n+            )\n+            \"\"\"\n+        )\n+\n+    def close(self):\n+        if self.session:\n+            self.session.shutdown()\n+        if self.cluster:\n+            self.cluster.shutdown()\n+\n+\n+db = CassandraConnection()\n+\n+\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    # Startup\n+    db.connect()\n+    yield\n+    # Shutdown\n+    db.close()\n+\n+\n+app = FastAPI(lifespan=lifespan)\n+\n+\n+def get_db():\n+    return db.session\n+\n+\n+@app.post(\"/tasks/\", response_model=Task)\n+def create_task(task: TaskCreate, session=Depends(get_db)):\n+    task_id = uuid4()\n+    query = \"\"\"\n+        INSERT INTO tasks (id, title, description, status, created_at, updated_at)\n+        VALUES (%s, %s, %s, %s, toTimestamp(now()), toTimestamp(now()))\n+    \"\"\"\n+    session.execute(query, (task_id, task.title, task.description, task.status))\n+    return Task(\n+        id=task_id, title=task.title, description=task.description, status=task.status\n+    )\n+\n+\n+@app.get(\"/tasks/\", response_model=List[Task])\n+def read_tasks(session=Depends(get_db)):\n+    query = \"SELECT id, title, description, status FROM tasks\"\n+    rows = session.execute(query)\n+    return [\n+        Task(id=row.id, title=row.title, description=row.description, status=row.status)\n+        for row in rows\n+    ]\n+\n+\n+@app.get(\"/tasks/{task_id}\", response_model=Task)\n+def read_task(task_id: UUID, session=Depends(get_db)):\n+    query = \"SELECT id, title, description, status FROM tasks WHERE id = %s\"\n+    row = session.execute(query, (task_id,)).o\n\n```\n\n```diff\n@@ -0,0 +1,147 @@\n+from contextlib import asynccontextmanager\n+from typing import List, Union\n+from uuid import UUID, uuid4\n+\n+from cassandra.cluster import Cluster\n+from fastapi import Depends, FastAPI, HTTPException\n+from pydantic import BaseModel, Field\n+\n+\n+class TaskBase(BaseModel):\n+    title: str\n+    description: Union[str, None] = None\n+    status: str = \"pending\"\n+\n+\n+class TaskCreate(TaskBase):\n+    pass\n+\n+\n+class Task(TaskBase):\n+    id: UUID = Field(default_factory=uuid4)\n+\n+\n+class ScyllaDBConnection:\n+    def __init__(self, hosts=None, port=9042):\n+        self.cluster = Cluster(hosts or [\"scylladb\"], port=port)\n+        self.session = None\n+        self.keyspace = \"task_manager\"\n+\n+    def connect(self):\n+        self.session = self.cluster.connect()\n", "output": "Changes look good. This PR implements: [14350] Added ScyllaDB and Cassandra docs and tests", "source": "pr", "type": "code_review", "pr_number": 161}
{"instruction": "Review the following code changes: Add database session management to tutorial007", "input": "```diff\n@@ -1,3 +1,6 @@\n+from .database import DBSession\n+\n+\n async def get_db():\n     db = DBSession()\n     try:\n\n```", "output": "Changes look good. This PR implements: Add database session management to tutorial007", "source": "pr", "type": "code_review", "pr_number": 159}
{"instruction": "Review the following code changes: üî• Remove Python 3.9 specific files, no longer needed after updating translations", "input": "```diff\n@@ -1,22 +0,0 @@\n-from fastapi import FastAPI\n-from fastapi.responses import JSONResponse\n-from pydantic import BaseModel\n-\n-\n-class Item(BaseModel):\n-    id: str\n-    value: str\n-\n-\n-class Message(BaseModel):\n-    message: str\n-\n-\n-app = FastAPI()\n-\n-\n-@app.get(\"/items/{item_id}\", response_model=Item, responses={404: {\"model\": Message}})\n-async def read_item(item_id: str):\n-    if item_id == \"foo\":\n-        return {\"id\": \"foo\", \"value\": \"there goes my hero\"}\n-    return JSONResponse(status_code=404, content={\"message\": \"Item not found\"})\n\n```\n\n```diff\n@@ -1,37 +0,0 @@\n-from fastapi import FastAPI\n-from fastapi.responses import JSONResponse\n-from pydantic import BaseModel\n-\n-\n-class Item(BaseModel):\n-    id: str\n-    value: str\n-\n-\n-class Message(BaseModel):\n-    message: str\n-\n-\n-app = FastAPI()\n-\n-\n-@app.get(\n-    \"/items/{item_id}\",\n-    response_model=Item,\n-    responses={\n-        404: {\"model\": Message, \"description\": \"The item was not found\"},\n-        200: {\n-            \"description\": \"Item requested by ID\",\n-            \"content\": {\n-                \"application/json\": {\n-                    \"example\": {\"id\": \"bar\", \"value\": \"The bar tenders\"}\n-                }\n-            },\n-        },\n-    },\n-)\n-async def read_item(item_id: str):\n-    if item_id == \"foo\":\n-        return {\"id\": \"foo\", \"value\": \"there goes my hero\"}\n-    else:\n-        return JSONResponse(status_code=404, content={\"message\": \"Item not found\"})\n\n```\n\n```diff\n@@ -1,11 +0,0 @@\n-from fastapi import FastAPI\n-from fastapi.middleware.httpsredirect import HTTPSRedirectMiddleware\n-\n-app = FastAPI()\n-\n-app.add_middleware(HTTPSRedirectMiddleware)\n-\n-\n-@app.get(\"/\")\n-async def main():\n-    return {\"message\": \"Hello World\"}\n\n```\n\n```diff\n@@ -1,13 +0,0 @@\n-from fastapi import FastAPI\n-from fastapi.middleware.trustedhost import TrustedHostMiddleware\n-\n-app = FastAPI()\n-\n-app.add_middleware(\n-    TrustedHostMiddleware, allowed_hosts=[\"example.com\", \"*.example.com\"]\n-)\n-\n-\n-@app.get(\"/\")\n-async def main():\n-    return {\"message\": \"Hello World\"}\n\n```\n\n```diff\n@@ -1,11 +0,0 @@\n-from fastapi import FastAPI\n-from fastapi.middleware.gzip import GZipMiddleware\n-\n-app = FastAPI()\n-\n-app.add_middleware(GZipMiddleware, minimum_size=1000, compresslevel=5)\n-\n-\n-@app.get(\"/\")\n-async def main():\n-    return \"somebigcontent\"\n\n```", "output": "Changes look good. This PR implements: üî• Remove Python 3.9 specific files, no longer needed after updating translations", "source": "pr", "type": "code_review", "pr_number": 158}
{"instruction": "Fix the following bug: Fix coverage gap in serialize_sequence_value continue statement", "input": "Line 316 in `fastapi/_compat/v2.py` was untested, causing coverage to fail at 99%. The line is a `continue` statement that skips `NoneType` when iterating union args in `serialize_sequence_value`.\n\n## Root Cause\n\nExisting tests used `list[str] | None`, which orders union args as `(list[str], NoneType)`. The loop processes `list[str]` first and breaks, never reaching the `continue` statement for `NoneType`.\n\n## Changes\n\n- Updated `test_serialize_sequence_value_with_none_first_in_union` to use explicit `Union[None, list[str]]` syntax\n- This places `NoneType` first in union args, exercising the continue statement before processing the list type\n\n```python\n# Before: list[str] | None ‚Üí union args are (list[str], NoneType)\nfield_info = FieldInfo(annotation=list[str] | None)\n\n# After: Union[None, list[str]] ‚Üí union args are (NoneType, list[str])  \nfield_info = FieldInfo(annotation=Union[None, list[str]])\n```\n\nCoverage now reaches 100%.\n\n<!-- START COPILOT CODING AGENT TIPS -->\n---\n\nüí° You can make Copilot smarter by setting up custom instructions, customizing its development environment and configuring Model Context Protocol (MCP) servers. Learn more [Copilot coding agent tips](https://gh.io/copilot-coding-agent-tips) in the docs.", "output": "```diff\n@@ -120,9 +120,12 @@ def test_serialize_sequence_value_with_optional_list_pipe_union():\n \n def test_serialize_sequence_value_with_none_first_in_union():\n     \"\"\"Test that serialize_sequence_value handles Union[None, List[...]] correctly.\"\"\"\n+    from typing import Union\n+\n     from fastapi._compat import v2\n \n-    field_info = FieldInfo(annotation=list[str] | None)\n+    # Use Union[None, list[str]] to ensure None comes first in the union args\n+    field_info = FieldInfo(annotation=Union[None, list[str]])\n     field = v2.ModelField(name=\"items\", field_info=field_info)\n     result = v2.serialize_sequence_value(field=field, value=[\"x\", \"y\"])\n     assert result == [\"x\", \"y\"]\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 157}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -120,9 +120,12 @@ def test_serialize_sequence_value_with_optional_list_pipe_union():\n \n def test_serialize_sequence_value_with_none_first_in_union():\n     \"\"\"Test that serialize_sequence_value handles Union[None, List[...]] correctly.\"\"\"\n+    from typing import Union\n+\n     from fastapi._compat import v2\n \n-    field_info = FieldInfo(annotation=list[str] | None)\n+    # Use Union[None, list[str]] to ensure None comes first in the union args\n+    field_info = FieldInfo(annotation=Union[None, list[str]])\n     field = v2.ModelField(name=\"items\", field_info=field_info)\n     result = v2.serialize_sequence_value(field=field, value=[\"x\", \"y\"])\n     assert result == [\"x\", \"y\"]\n\n```", "output": "Bug: Fix coverage gap in serialize_sequence_value continue statement\n\nLine 316 in `fastapi/_compat/v2.py` was untested, causing coverage to fail at 99%. The line is a `continue` statement that skips `NoneType` when iterating union args in `serialize_sequence_value`.\n\n## Root Cause\n\nExisting tests used `list[str] | None`, which orders union args as `(list[str], NoneType)`. The loop processes `list[str]` first and breaks, never reaching the `continue` statement for `NoneType`.\n\n## Changes\n\n- Updated `test_serialize_sequence_value_with_none_first_in_union` to use explicit `Union[None, list[str]]` syntax\n- This places `NoneType` first in union args, exercising the continue statement before processing the list type\n\n```python\n# Before: list[str] | None ‚Üí union args are (list[str], NoneType)\nfield_info = FieldInfo(annotation=list[str] | None)\n\n# After: Union[None, list[str]] ‚Üí union args are (NoneType, list[str])  \nfield_info = FieldInfo(annotation=Union[None, list[str]])\n```\n\nCoverage now reaches 100%.\n\n<!-- START COPILOT CODING AGENT TIPS -->\n---\n\nüí° You can make Copilot smarter by setting up custom instructions, customizing its development environment and configuring Model Context Protocol (MCP) servers. Learn more [Copilot coding agent tips](https://gh.io/copilot-coding-agent-tips) in the docs.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 157}
{"instruction": "Review the following code changes: Fix coverage gap in serialize_sequence_value continue statement", "input": "```diff\n@@ -120,9 +120,12 @@ def test_serialize_sequence_value_with_optional_list_pipe_union():\n \n def test_serialize_sequence_value_with_none_first_in_union():\n     \"\"\"Test that serialize_sequence_value handles Union[None, List[...]] correctly.\"\"\"\n+    from typing import Union\n+\n     from fastapi._compat import v2\n \n-    field_info = FieldInfo(annotation=list[str] | None)\n+    # Use Union[None, list[str]] to ensure None comes first in the union args\n+    field_info = FieldInfo(annotation=Union[None, list[str]])\n     field = v2.ModelField(name=\"items\", field_info=field_info)\n     result = v2.serialize_sequence_value(field=field, value=[\"x\", \"y\"])\n     assert result == [\"x\", \"y\"]\n\n```", "output": "Changes look good. This PR implements: Fix coverage gap in serialize_sequence_value continue statement", "source": "pr", "type": "code_review", "pr_number": 157}
{"instruction": "Review the following code changes: üé® Upgrade typing syntax for Python 3.10", "input": "```diff\n@@ -1,5 +1,3 @@\n-from typing import Union\n-\n from fastapi import FastAPI\n from pydantic import BaseModel\n \n@@ -30,6 +28,6 @@ class PlaneItem(BaseItem):\n }\n \n \n-@app.get(\"/items/{item_id}\", response_model=Union[PlaneItem, CarItem])\n+@app.get(\"/items/{item_id}\", response_model=PlaneItem | CarItem)\n async def read_item(item_id: str):\n     return items[item_id]\n\n```\n\n```diff\n@@ -1,5 +1,5 @@\n import re\n-from typing import TypedDict, Union\n+from typing import TypedDict\n \n CODE_INCLUDE_RE = re.compile(r\"^\\{\\*\\s*(\\S+)\\s*(.*)\\*\\}$\")\n CODE_INCLUDE_PLACEHOLDER = \"<CODE_INCLUDE>\"\n@@ -50,8 +50,8 @@ class MarkdownLinkInfo(TypedDict):\n     line_no: int\n     url: str\n     text: str\n-    title: Union[str, None]\n-    attributes: Union[str, None]\n+    title: str | None\n+    attributes: str | None\n     full_match: str\n \n \n@@ -287,8 +287,8 @@ def _add_lang_code_to_url(url: str, lang_code: str) -> str:\n def _construct_markdown_link(\n     url: str,\n     text: str,\n-    title: Union[str, None],\n-    attributes: Union[str, None],\n+    title: str | None,\n+    attributes: str | None,\n     lang_code: str,\n ) -> str:\n     \"\"\"\n@@ -549,7 +549,7 @@ def extract_multiline_code_blocks(text: list[str]) -> list[MultilineCodeBlockInf\n     return blocks\n \n \n-def _split_hash_comment(line: str) -> tuple[str, Union[str, None]]:\n+def _split_hash_comment(line: str) -> tuple[str, str | None]:\n     match = HASH_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -558,7 +558,7 @@ def _split_hash_comment(line: str) -> tuple[str, Union[str, None]]:\n     return line.rstrip(), None\n \n \n-def _split_slashes_comment(line: str) -> tuple[str, Union[str, None]]:\n+def _split_slashes_comment(line: str) -> tuple[str, str | None]:\n     match = SLASHES_COMMENT_RE.match(line)\n     if match:\n         code = match.group(\"code\").rstrip()\n@@ -603,9 +603,9 @@ def replace_multiline_code_block(\n         return block_a[\"content\"].copy()  # We don't handle mermaid code blocks for now\n \n     code_block: list[str] = []\n-    for line_a, line_b in zip(block_a[\"content\"], block_b[\"content\"]):\n-        line_a_comment: Union[str, None] = None\n-        line_b_comment: Union[str, None] = None\n+    for line_a, line_b in zip(block_a[\"content\"], block_b[\"content\"], strict=False):\n+        line_a_comment: str | None = None\n+        line_b_comment: str | None = None\n \n         # Handle comments based on language\n         if block_language in {\n@@ -659,7 +659,7 @@ def replace_multiline_code_blocks_in_text(\n         )\n \n     modified_text = text.copy()\n-    for block, original_block in zip(code_blocks, original_code_blocks):\n+    for block, original_block in zip(code_blocks, original_code_blocks, strict=True):\n         updated_content = replace_multiline_code_block(block, original_block)\n \n         start_line_index = block[\"start_line_no\"] - 1\n\n```\n\n```diff\n@@ -1,6 +1,6 @@\n from functools import lru_cache\n from pathlib import Path\n-from typing import Any, Union\n+from typing import Any\n \n import material\n from mkdocs.config.defaults import MkDocsConfig\n@@ -105,9 +105,9 @@ def on_files(files: Files, *, config: MkDocsConfig) -> Files:\n \n \n def generate_renamed_section_items(\n-    items: list[Union[Page, Section, Link]], *, config: MkDocsConfig\n-) -> list[Union[Page, Section, Link]]:\n-    new_items: list[Union[Page, Section, Link]] = []\n+    items: list[Page | Section | Link], *, config: MkDocsConfig\n+) -> list[Page | Section | Link]:\n+    new_items: list[Page | Section | Link] = []\n     for item in items:\n         if isinstance(item, Section):\n             new_title = item.title\n\n```\n\n```diff\n@@ -3,7 +3,7 @@\n import sys\n import time\n from pathlib import Path\n-from typing import Any, Union, cast\n+from typing import Any, cast\n \n import httpx\n from github import Github\n@@ -181,9 +181,9 @@ class Settings(BaseSettings):\n     github_repository: str\n     github_token: SecretStr\n     github_event_path: Path\n-    github_event_name: Union[str, None] = None\n+    github_event_name: str | None = None\n     httpx_timeout: int = 30\n-    debug: Union[bool, None] = False\n+    debug: bool | None = False\n     number: int | None = None\n \n \n@@ -199,12 +199,12 @@ def get_graphql_response(\n     *,\n     settings: Settings,\n     query: str,\n-    after: Union[str, None] = None,\n-    category_id: Union[str, None] = None,\n-    discussion_number: Union[int, None] = None,\n-    discussion_id: Union[str, None] = None,\n-    comment_id: Union[str, None] = None,\n-    body: Union[str, None] = None,\n+    after: str | None = None,\n+    category_id: str | None = None,\n+    discussion_number: int | None = None,\n+    discussion_id: str | None = None,\n+    comment_id: str | None = None,\n+    body: str | None = None,\n ) -> dict[str, Any]:\n     headers = {\"Authorization\": f\"token {settings.github_token.get_secret_value()}\"}\n     variables = {\n@@ -249,7 +249,7 @@ def get_graphql_translation_discussions(\n \n \n def get_graphql_translation_discussion_comments_edges(\n-    *, settings: Settings, discussion", "output": "Changes look good. This PR implements: üé® Upgrade typing syntax for Python 3.10", "source": "pr", "type": "code_review", "pr_number": 156}
{"instruction": "Review the following code changes: Add WebSocket handling support for HTTP security dependencies", "input": "```diff\n@@ -4,7 +4,7 @@\n from fastapi.openapi.models import APIKey, APIKeyIn\n from fastapi.security.base import SecurityBase\n from starlette.exceptions import HTTPException\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n \n@@ -137,8 +137,8 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> str | None:\n-        api_key = request.query_params.get(self.model.name)\n+    async def __call__(self, conn: HTTPConnection) -> str | None:\n+        api_key = conn.query_params.get(self.model.name)\n         return self.check_api_key(api_key)\n \n \n@@ -225,8 +225,8 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> str | None:\n-        api_key = request.headers.get(self.model.name)\n+    async def __call__(self, conn: HTTPConnection) -> str | None:\n+        api_key = conn.headers.get(self.model.name)\n         return self.check_api_key(api_key)\n \n \n@@ -313,6 +313,6 @@ def __init__(\n             auto_error=auto_error,\n         )\n \n-    async def __call__(self, request: Request) -> str | None:\n-        api_key = request.cookies.get(self.model.name)\n+    async def __call__(self, conn: HTTPConnection) -> str | None:\n+        api_key = conn.cookies.get(self.model.name)\n         return self.check_api_key(api_key)\n\n```\n\n```diff\n@@ -9,7 +9,7 @@\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n from pydantic import BaseModel\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n \n@@ -91,8 +91,10 @@ def make_not_authenticated_error(self) -> HTTPException:\n             headers=self.make_authenticate_headers(),\n         )\n \n-    async def __call__(self, request: Request) -> HTTPAuthorizationCredentials | None:\n-        authorization = request.headers.get(\"Authorization\")\n+    async def __call__(\n+        self, conn: HTTPConnection\n+    ) -> HTTPAuthorizationCredentials | None:\n+        authorization = conn.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n@@ -200,9 +202,9 @@ def make_authenticate_headers(self) -> dict[str, str]:\n         return {\"WWW-Authenticate\": \"Basic\"}\n \n     async def __call__(  # type: ignore\n-        self, request: Request\n+        self, conn: HTTPConnection\n     ) -> HTTPBasicCredentials | None:\n-        authorization = request.headers.get(\"Authorization\")\n+        authorization = conn.headers.get(\"Authorization\")\n         scheme, param = get_authorization_scheme_param(authorization)\n         if not authorization or scheme.lower() != \"basic\":\n             if self.auto_error:\n@@ -300,8 +302,10 @@ def __init__(\n         self.scheme_name = scheme_name or self.__class__.__name__\n         self.auto_error = auto_error\n \n-    async def __call__(self, request: Request) -> HTTPAuthorizationCredentials | None:\n-        authorization = request.headers.get(\"Authorization\")\n+    async def __call__(\n+        self, conn: HTTPConnection\n+    ) -> HTTPAuthorizationCredentials | None:\n+        authorization = conn.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n@@ -401,8 +405,10 @@ def __init__(\n         self.scheme_name = scheme_name or self.__class__.__name__\n         self.auto_error = auto_error\n \n-    async def __call__(self, request: Request) -> HTTPAuthorizationCredentials | None:\n-        authorization = request.headers.get(\"Authorization\")\n+    async def __call__(\n+        self, conn: HTTPConnection\n+    ) -> HTTPAuthorizationCredentials | None:\n+        authorization = conn.headers.get(\"Authorization\")\n         scheme, credentials = get_authorization_scheme_param(authorization)\n         if not (authorization and scheme and credentials):\n             if self.auto_error:\n\n```\n\n```diff\n@@ -7,7 +7,7 @@\n from fastapi.param_functions import Form\n from fastapi.security.base import SecurityBase\n from fastapi.security.utils import get_authorization_scheme_param\n-from starlette.requests import Request\n+from starlette.requests import HTTPConnection\n from starlette.status import HTTP_401_UNAUTHORIZED\n \n \n@@ -420,8 +420,8 @@ def make_not_authenticated_error(self) -> HTTPException:\n             headers={\"WWW-Authenticate\": \"Bearer\"},\n         )\n \n-    async def __call__(self, request: Request) -> str | None:\n-        authorization = request.headers.get(\"Authorization\")\n+    async def __call__(self, conn: HTTPConnection) -> str | None:\n+        authorization = conn.headers.get(\"Authorization\")\n         if not authorization:\n             if self.auto_error:\n               ", "output": "Code Review for: Add WebSocket handling support for HTTP security dependencies\n\nüìù **fastapi/security/utils.py**: With the new Starlette version (0.37.0), you don't need this.\n\nüìù **fastapi/security/utils.py**: Thanks for the confirmation!\r\nSo, we need to wait until FastAPI is updated to use Startlette 0.37. Then we will need to exclude all the stuff with `@handle_exc_for_ws` from this PR, change tests and merge it.\n\nüìù **fastapi/security/utils.py**: Sure, we'll wait for PR #11146 to be completed. \r\n\r\nBy the way, could you provide details on the change in Starlette 0.37 that enables raising HTTPException in WebSocket sessions?\n\nüìù **fastapi/security/http.py**: ```suggestion\n        self, conn: HTTPConnection\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 155}
{"instruction": "Review this code change in `fastapi/security/utils.py`", "input": "```diff\n@@ -8,3 +14,25 @@ def get_authorization_scheme_param(\n         return \"\", \"\"\n     scheme, _, param = authorization_header_value.partition(\" \")\n     return scheme, param\n+\n+\n+_SecurityDepFunc = TypeVar(\n+    \"_SecurityDepFunc\", bound=Callable[[Any, HTTPConnection], Awaitable[Any]]\n+)\n+\n+\n+def handle_exc_for_ws(func: _SecurityDepFunc) -> _SecurityDepFunc:\n+    @wraps(func)\n+    async def wrapper(self: Any, request: HTTPConnection) -> Any:\n+        try:\n+            return await func(self, request)\n+        except HTTPException as e:\n+            if not isinstance(request, WebSocket):\n+                raise e\n+            # close before accepted with result a HTTP 403 so the exception argument is ignored\n+            # ref: https://asgi.readthedocs.io/en/latest/specs/www.html#close-send-event\n+            raise WebSocketException(\n+                code=WS_1008_POLICY_VIOLATION, reason=e.detail\n+            ) from None\n+\n+    return wrapper  # type: ignore\n\n```", "output": "With the new Starlette version (0.37.0), you don't need this.", "source": "pr_review", "type": "inline_review", "pr_number": 155}
{"instruction": "Review this code change in `fastapi/security/http.py`", "input": "```diff\n@@ -80,7 +80,7 @@ def __init__(\n         self.auto_error = auto_error\n \n     async def __call__(\n-        self, request: Request\n+        self, request: HTTPConnection\n\n```", "output": "```suggestion\n        self, conn: HTTPConnection\n```", "source": "pr_review", "type": "inline_review", "pr_number": 155}
{"instruction": "Review the following code changes: üìù Clarify required but nullable request body fields", "input": "```diff\n@@ -55,6 +55,32 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n }\n \n```\n\n```diff\n@@ -0,0 +1,13 @@\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class Item(BaseModel):\n+    description: str\n+\n+\n+@app.post(\"/items/\")\n+async def create_item(item: Item):\n+    return item\n\n```\n\n```diff\n@@ -0,0 +1,27 @@\n+import importlib\n+\n+import pytest\n+from fastapi.testclient import TestClient\n+\n+\n+@pytest.fixture(\n+    name=\"client\",\n+    params=[\n+        pytest.param(\"tutorial005_py310\"),\n+    ],\n+)\n+def get_client(request: pytest.FixtureRequest):\n+    mod = importlib.import_module(f\"docs_src.body.{request.param}\")\n+    client = TestClient(mod.app)\n+    return client\n+\n+\n+def test_required_nullable_field(client: TestClient):\n+    response = client.post(\"/items/\", json={\"description\": \"Some description\"})\n+    assert response.status_code == 200\n+    assert response.json() == {\"description\": \"Some description\"}\n+\n+\n+def test_required_field_missing(client: TestClient):\n+    response = client.post(\"/items/\", json={})\n+    assert response.status_code == 422\n\n```\n\n```diff\n@@ -55,6 +55,44 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n }\n \n```\n\n```diff\n@@ -55,6 +55,44 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n }\n \n```", "output": "Code Review for: üìù Clarify required but nullable request body fields\n\nüìù **docs/en/docs/tutorial/body.md**: All code examples should be placed in separate files and covered by tests.\r\nPlease, look how it's done for other code examples in docs\n\nüìù **docs/en/docs/tutorial/body.md**: Thanks for the feedback!\r\nI‚Äôve moved the example to separate numbered tutorial files under docs_src/body (for Python 3.9 and 3.10+), added tests following the existing pattern, and updated the documentation to reference them.\n\nüìù **docs/en/docs/tutorial/body.md**: Hi @YuriiMotov ! Just a gentle ping in case this PR got buried.\r\nAll checks are green now ‚Äî happy to adjust anything if needed. Thanks!\n\nüìù **docs/en/docs/tutorial/body.md**: ```suggestion\n    description: str | None = None\n```\n\nüìù **docs/en/docs/tutorial/body.md**: ```suggestion\n{* ../../docs_src/body/tutorial005_py310.py hl[8] *}\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 154}
{"instruction": "Review this code change in `docs/en/docs/tutorial/body.md`", "input": "```diff\n@@ -55,6 +55,44 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n }\n ```\n \n+### Required fields that can be `None` { #required-fields-that-can-be-none }\n+\n+In Python type hints, a parameter can be **required** and still allow the value `None`.\n+\n+This means the field must be present in the request, but its value can be `null` (`None` in Python).\n+\n+This typically happens when you use `Optional[T]` **without** providing a default value.\n+\n+For example:\n+\n+```python\n+from typing import Optional\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+class Item(BaseModel):\n+    description: Optional[str]\n+\n+@app.post(\"/items/\")\n+async def create_item(item: Item):\n+    return item\n+```\n\n```", "output": "All code examples should be placed in separate files and covered by tests.\r\nPlease, look how it's done for other code examples in docs", "source": "pr_review", "type": "inline_review", "pr_number": 154}
{"instruction": "Review this code change in `docs/en/docs/tutorial/body.md`", "input": "```diff\n@@ -55,6 +55,36 @@ For example, this model above declares a JSON \"`object`\" (or Python `dict`) like\n }\n ```\n \n+### Required fields that can be `None` { #required-fields-that-can-be-none }\n+\n+In Python type hints, a parameter can be **required** and still allow the value `None`.\n+\n+This means that the field must be present in the request body, but its value can be `null`\n+(`None` in Python).\n+\n+This typically happens when you use `Optional[T]` **without** providing a default value.\n+\n+For example:\n+\n+{* ../../docs_src/body/tutorial005_py39.py hl[6] *}\n+\n+And for Python 3.10+:\n+\n+{* ../../docs_src/body/tutorial005_py310.py hl[6] *}\n+\n+In this example:\n+\n+* The `description` field is **required** (the client must include it in the JSON body).\n+* Its value can still be `null` (`None` in Python).\n+* This is different from a truly optional field, which would have a default value:\n+\n+```python\n+class Item(BaseModel):\n+    description: Optional[str] = None\n\n```", "output": "```suggestion\n    description: str | None = None\n```", "source": "pr_review", "type": "inline_review", "pr_number": 154}
{"instruction": "Review this code change in `docs_src/body/tutorial005_py39.py`", "input": "```diff\n@@ -0,0 +1,15 @@\n+from typing import Optional\n\n```", "output": "We don't need code examples for Python 3.9 anymore. This file can be deleted", "source": "pr_review", "type": "inline_review", "pr_number": 154}
{"instruction": "Review this code change in `tests/test_tutorial/test_body_required_nullable/test_tutorial001.py`", "input": "```diff\n@@ -0,0 +1,30 @@\n+import importlib\n+\n+import pytest\n+from fastapi.testclient import TestClient\n+\n+from ...utils import needs_py310\n+\n+\n+@pytest.fixture(\n+    name=\"client\",\n+    params=[\n+        pytest.param(\"tutorial005_py39\"),\n+        pytest.param(\"tutorial005_py310\", marks=needs_py310),\n\n```", "output": "```suggestion\n        \"tutorial005_py310\",\n```", "source": "pr_review", "type": "inline_review", "pr_number": 154}
{"instruction": "Review this code change in `docs_src/body/tutorial005_py310.py`", "input": "```diff\n@@ -0,0 +1,13 @@\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class Item(BaseModel):\n+    description: str | None = None\n\n```", "output": "This code example is intended to illustrate the required field, but you added default value..", "source": "pr_review", "type": "inline_review", "pr_number": 154}
{"instruction": "Review the following code changes: ‚ú® Support Starlette 0.52.0+ generic `Request`", "input": "```diff\n@@ -329,6 +329,7 @@ def get_dependant(\n def add_non_field_param_to_dependency(\n     *, param_name: str, type_annotation: Any, dependant: Dependant\n ) -> bool | None:\n+    type_annotation = get_origin(type_annotation) or type_annotation\n     if lenient_issubclass(type_annotation, Request):\n         dependant.request_param_name = param_name\n         return True\n@@ -453,7 +454,7 @@ def analyze_param(\n     # Only apply special handling when there's no explicit Depends - if there's a Depends,\n     # the dependency will be called and its return value used instead of the special injection\n     if depends is None and lenient_issubclass(\n-        type_annotation,\n+        get_origin(type_annotation) or type_annotation,\n         (\n             Request,\n             WebSocket,\n\n```\n\n```diff\n@@ -1,10 +1,15 @@\n from collections.abc import AsyncGenerator\n from contextlib import asynccontextmanager\n+from typing import TypedDict\n \n import pytest\n from fastapi import APIRouter, FastAPI, Request\n from fastapi.testclient import TestClient\n from pydantic import BaseModel\n+from starlette import __version__ as STARLETTE_VERSION\n+from typing_extensions import Self\n+\n+STARLETTE_MINOR_VERSION_TUPLE = tuple(int(x) for x in STARLETTE_VERSION.split(\".\")[:2])\n \n \n class State(BaseModel):\n@@ -171,6 +176,39 @@ def main(request: Request) -> dict[str, str]:\n     assert state.sub_router_shutdown is True\n \n \n+@pytest.mark.skipif(\n+    STARLETTE_MINOR_VERSION_TUPLE < (0, 52),\n+    reason=\"Starlette Request with generic type is not supported in Starlette < 0.52.0\",\n+)\n+def test_router_generic_request_typed_dict_lifespan_state() -> None:\n+    class MyClass:\n+        async def __aenter__(self) -> Self:\n+            return self\n+\n+        async def __aexit__(self, exc_type, exc_value, traceback) -> None:\n+            pass\n+\n+    class MyState(TypedDict):\n+        my_class: MyClass\n+\n+    @asynccontextmanager\n+    async def lifespan(app: FastAPI) -> AsyncGenerator[MyState]:\n+        async with MyClass() as my_class:\n+            yield {\"my_class\": my_class}\n+\n+    app = FastAPI(lifespan=lifespan)\n+\n+    @app.get(\"/\")\n+    def main(request: Request[MyState]) -> dict[str, str]:\n+        assert isinstance(request.state[\"my_class\"], MyClass)\n+        return {\"message\": \"Hello World\"}\n+\n+    with TestClient(app) as client:\n+        response = client.get(\"/\")\n+        assert response.status_code == 200, response.text\n+        assert response.json() == {\"message\": \"Hello World\"}\n+\n+\n def test_router_nested_lifespan_state_overriding_by_parent() -> None:\n     @asynccontextmanager\n     async def lifespan(\n\n```", "output": "Changes look good. This PR implements: ‚ú® Support Starlette 0.52.0+ generic `Request`", "source": "pr", "type": "code_review", "pr_number": 153}
{"instruction": "Fix the following bug: Fix _endpoint_context_cache using id() which risks stale entries afte‚Ä¶", "input": "The _endpoint_context_cache in routing.py used id(func) as dict keys to cache endpoint context (source file, line number, function name) for error messages. This has two problems:\r\n\r\n1. ID reuse after garbage collection. Python id() returns the memory address of an object. Once an object is garbage collected, its ID can be reassigned to a newly created object. If an endpoint function were deallocated and a new function reused the same ID, the cache would return stale context (wrong file, line, function name) for error messages.\r\n\r\n2. No eviction.. The module-level dict grows unboundedly for every unique endpoint function. While each entry is small (~3 strings), this matters in scenarios where FastAPI instances are dynamically created and destroyed in a single process (e.g., test suites, multi-tenant embedding).\r\n\r\nFix: key the cache on the function object itself instead of id(func). Since Python functions use identity-based hashing by default, lookup performance is identical. The dict now holds a strong reference to each function, which means the function cannot be garbage collected while its cache entry exists, and therefore its ID cannot be reused for a different object. In practice, endpoint functions are already held alive by the router for the app lifetime, so this does not change object lifetimes.", "output": "```diff\n@@ -4,6 +4,7 @@\n import inspect\n import json\n import types\n+import weakref\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n@@ -232,16 +233,19 @@ def __call__(self: _T, app: object) -> _T:\n         return self\n \n \n-# Cache for endpoint context to avoid re-extracting on every request\n-_endpoint_context_cache: dict[int, EndpointContext] = {}\n+# Cache for endpoint context to avoid re-extracting on every request.\n+# Uses WeakKeyDictionary so entries are automatically evicted when the endpoint\n+# function is garbage collected (e.g., when a dynamically created FastAPI app is\n+# destroyed), preventing both memory leaks and stale-ID lookups.\n+_endpoint_context_cache: weakref.WeakKeyDictionary[\n+    Callable[..., Any], EndpointContext\n+] = weakref.WeakKeyDictionary()\n \n \n def _extract_endpoint_context(func: Any) -> EndpointContext:\n     \"\"\"Extract endpoint context with caching to avoid repeated file I/O.\"\"\"\n-    func_id = id(func)\n-\n-    if func_id in _endpoint_context_cache:\n-        return _endpoint_context_cache[func_id]\n+    if func in _endpoint_context_cache:\n+        return _endpoint_context_cache[func]\n \n     try:\n         ctx: EndpointContext = {}\n@@ -255,7 +259,7 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n     except Exception:\n         ctx = EndpointContext()\n \n-    _endpoint_context_cache[func_id] = ctx\n+    _endpoint_context_cache[func] = ctx\n     return ctx\n \n \n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 152}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -4,6 +4,7 @@\n import inspect\n import json\n import types\n+import weakref\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n@@ -232,16 +233,19 @@ def __call__(self: _T, app: object) -> _T:\n         return self\n \n \n-# Cache for endpoint context to avoid re-extracting on every request\n-_endpoint_context_cache: dict[int, EndpointContext] = {}\n+# Cache for endpoint context to avoid re-extracting on every request.\n+# Uses WeakKeyDictionary so entries are automatically evicted when the endpoint\n+# function is garbage collected (e.g., when a dynamically created FastAPI app is\n+# destroyed), preventing both memory leaks and stale-ID lookups.\n+_endpoint_context_cache: weakref.WeakKeyDictionary[\n+    Callable[..., Any], EndpointContext\n+] = weakref.WeakKeyDictionary()\n \n \n def _extract_endpoint_context(func: Any) -> EndpointContext:\n     \"\"\"Extract endpoint context with caching to avoid repeated file I/O.\"\"\"\n-    func_id = id(func)\n-\n-    if func_id in _endpoint_context_cache:\n-        return _endpoint_context_cache[func_id]\n+    if func in _endpoint_context_cache:\n+        return _endpoint_context_cache[func]\n \n     try:\n         ctx: EndpointContext = {}\n@@ -255,7 +259,7 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n     except Exception:\n         ctx = EndpointContext()\n \n-    _endpoint_context_cache[func_id] = ctx\n+    _endpoint_context_cache[func] = ctx\n     return ctx\n \n \n\n```", "output": "Bug: Fix _endpoint_context_cache using id() which risks stale entries afte‚Ä¶\n\nThe _endpoint_context_cache in routing.py used id(func) as dict keys to cache endpoint context (source file, line number, function name) for error messages. This has two problems:\r\n\r\n1. ID reuse after garbage collection. Python id() returns the memory address of an object. Once an object is garbage collected, its ID can be reassigned to a newly created object. If an endpoint function were deallocated and a new function reused the same ID, the cache would return stale context (wrong file, line, function name) for error messages.\r\n\r\n2. No eviction.. The module-level dict grows unboundedly for every unique endpoint function. While each entry is small (~3 strings), this matters in scenarios where FastAPI instances are dynamically created and destroyed in a single process (e.g., test suites, multi-tenant embedding).\r\n\r\nFix: key the cache on the function object itself instead of id(func). Since Python functions use identity-based hashing by default, lookup performance is identical. The dict now holds a strong reference to each function, which means the function cannot be garbage collected while its cache entry exists, and therefore its ID cannot be reused for a different object. In practice, endpoint functions are already held alive by the router for the app lifetime, so this does not change object lifetimes.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 152}
{"instruction": "Review the following code changes: Fix _endpoint_context_cache using id() which risks stale entries afte‚Ä¶", "input": "```diff\n@@ -4,6 +4,7 @@\n import inspect\n import json\n import types\n+import weakref\n from collections.abc import (\n     AsyncIterator,\n     Awaitable,\n@@ -232,16 +233,19 @@ def __call__(self: _T, app: object) -> _T:\n         return self\n \n \n-# Cache for endpoint context to avoid re-extracting on every request\n-_endpoint_context_cache: dict[int, EndpointContext] = {}\n+# Cache for endpoint context to avoid re-extracting on every request.\n+# Uses WeakKeyDictionary so entries are automatically evicted when the endpoint\n+# function is garbage collected (e.g., when a dynamically created FastAPI app is\n+# destroyed), preventing both memory leaks and stale-ID lookups.\n+_endpoint_context_cache: weakref.WeakKeyDictionary[\n+    Callable[..., Any], EndpointContext\n+] = weakref.WeakKeyDictionary()\n \n \n def _extract_endpoint_context(func: Any) -> EndpointContext:\n     \"\"\"Extract endpoint context with caching to avoid repeated file I/O.\"\"\"\n-    func_id = id(func)\n-\n-    if func_id in _endpoint_context_cache:\n-        return _endpoint_context_cache[func_id]\n+    if func in _endpoint_context_cache:\n+        return _endpoint_context_cache[func]\n \n     try:\n         ctx: EndpointContext = {}\n@@ -255,7 +259,7 @@ def _extract_endpoint_context(func: Any) -> EndpointContext:\n     except Exception:\n         ctx = EndpointContext()\n \n-    _endpoint_context_cache[func_id] = ctx\n+    _endpoint_context_cache[func] = ctx\n     return ctx\n \n \n\n```", "output": "Changes look good. This PR implements: Fix _endpoint_context_cache using id() which risks stale entries afte‚Ä¶", "source": "pr", "type": "code_review", "pr_number": 152}
{"instruction": "Review the following code changes: üåê Add Traditional Chinese translation for `docs/zh-hant/docs/async.md`", "input": "```diff\n@@ -0,0 +1,442 @@\n+# ‰∏¶Ë°åËàá async / await\n+\n+ÊúâÈóú*Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè*ÁöÑ `async def` Ë™ûÊ≥ïÁöÑÁ¥∞ÁØÄËàáÈùûÂêåÊ≠• (asynchronous) Á®ãÂºèÁ¢º„ÄÅ‰∏¶Ë°å (concurrency) ËàáÂπ≥Ë°å (parallelism) ÁöÑ‰∏Ä‰∫õËÉåÊôØÁü•Ë≠ò„ÄÇ\n+\n+## Ë∂ïÊôÇÈñìÂóé?\n+\n+<abbr title=\"too long; didn't readÔºàÊñáÈï∑ÊÖéÂÖ•Ôºâ\"><strong>TL;DR:</strong></abbr>\n+\n+Â¶ÇÊûú‰Ω†Ê≠£Âú®‰ΩøÁî®Ë¶ÅÊ±Ç‰Ω†‰ª• `await` Ë™ûÊ≥ïÂëºÂè´ÁöÑÁ¨¨‰∏âÊñπÂáΩÂºèÂ∫´Ôºå‰æãÂ¶ÇÔºö\n+\n+\n```\n\n```diff\n@@ -0,0 +1,442 @@\n+# ‰∏¶Ë°åËàá async / await\n+\n+ÊúâÈóú*Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè*ÁöÑ `async def` Ë™ûÊ≥ïÁöÑÁ¥∞ÁØÄËàáÈùûÂêåÊ≠• (asynchronous) Á®ãÂºèÁ¢º„ÄÅ‰∏¶Ë°å (concurrency) ËàáÂπ≥Ë°å (parallelism) ÁöÑ‰∏Ä‰∫õËÉåÊôØÁü•Ë≠ò„ÄÇ\n+\n+## Ë∂ïÊôÇÈñìÂóé?\n+\n+<abbr title=\"too long; didn't readÔºàÊñáÈï∑ÊÖéÂÖ•Ôºâ\"><strong>TL;DR:</strong></abbr>\n+\n+Â¶ÇÊûú‰Ω†Ê≠£Âú®‰ΩøÁî®Ë¶ÅÊ±Ç‰Ω†‰ª• `await` Ë™ûÊ≥ïÂëºÂè´ÁöÑÁ¨¨‰∏âÊñπÂáΩÂºèÂ∫´Ôºå‰æãÂ¶ÇÔºö\n+\n+\n```", "output": "Code Review for: üåê Add Traditional Chinese translation for `docs/zh-hant/docs/async.md`\n\nüìù **docs/zh-hant/docs/async.md**: I've fixed this (it wasn't rendering properly)\r\n(we have to include the ‚Äúnote‚Äù as the styling depends on this part)\n\n", "source": "pr", "type": "code_review", "pr_number": 151}
{"instruction": "Review this code change in `docs/zh-hant/docs/async.md`", "input": "```diff\n@@ -0,0 +1,442 @@\n+# ‰∏¶Ë°åËàá async / await\n+\n+ÊúâÈóú*Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè*ÁöÑ `async def` Ë™ûÊ≥ïÁöÑÁ¥∞ÁØÄËàáÈùûÂêåÊ≠• (asynchronous) Á®ãÂºèÁ¢º„ÄÅ‰∏¶Ë°å (concurrency) ËàáÂπ≥Ë°å (parallelism) ÁöÑ‰∏Ä‰∫õËÉåÊôØÁü•Ë≠ò„ÄÇ\n+\n+## Ë∂ïÊôÇÈñìÂóé?\n+\n+<abbr title=\"too long; didn't readÔºàÊñáÈï∑ÊÖéÂÖ•Ôºâ\"><strong>TL;DR:</strong></abbr>\n+\n+Â¶ÇÊûú‰Ω†Ê≠£Âú®‰ΩøÁî®Ë¶ÅÊ±Ç‰Ω†‰ª• `await` Ë™ûÊ≥ïÂëºÂè´ÁöÑÁ¨¨‰∏âÊñπÂáΩÂºèÂ∫´Ôºå‰æãÂ¶ÇÔºö\n+\n+```Python\n+results = await some_library()\n+```\n+\n+ÁÑ∂ÂæåÔºå‰ΩøÁî® `async def` ÂÆ£Âëä‰Ω†ÁöÑ*Ë∑ØÂæëÊìç‰ΩúÂáΩÂºè*Ôºö\n+\n+\n+```Python hl_lines=\"2\"\n+@app.get('/')\n+async def read_results():\n+    results = await some_library()\n+    return results\n+```\n+\n+/// note | Ê≥®ÊÑè\n\n```", "output": "I've fixed this (it wasn't rendering properly)\r\n(we have to include the ‚Äúnote‚Äù as the styling depends on this part)", "source": "pr_review", "type": "inline_review", "pr_number": 151}
{"instruction": "Review the following code changes: üóëÔ∏è Deprecate `scopes` parameter in `Security` in favor of `oauth_scopes`", "input": "```diff\n@@ -106,7 +106,17 @@ Now we declare that the *path operation* for `/users/me/items/` requires the sco\n \n For this, we import and use `Security` from `fastapi`.\n \n-You can use `Security` to declare dependencies (just like `Depends`), but `Security` also receives a parameter `scopes` with a list of scopes (strings).\n+You can use `Security` to declare dependencies (just like `Depends`), but `Security` also receives a parameter `oauth_scopes` with a list of scopes (strings).\n+\n+/// note\n+\n+Before version 0.122.X, the name of this parameter was `scopes`.\n+\n+In FastAPI 0.122.X, the `scopes` parameter was deprecated in favor of `oauth_scopes`\n+to avoid confusing it with the `scope` parameter, which is used to specify when the exit code\n+of dependencies with `yield` should run.\n+\n+///\n \n In this case, we pass a dependency function `get_current_active_user` to `Security` (the same way we would do with `Depends`).\n \n@@ -124,7 +134,7 @@ We are doing it here to demonstrate how **FastAPI** handles scopes declared at d\n \n ///\n \n-{* ../../docs_src/security/tutorial005_an_py310.py hl[5,141,172] *}\n+{* ../../docs_src/security/tutorial005_an_py310.py hl[5,141,173] *}\n \n /// info | Technical Details\n \n@@ -213,13 +223,13 @@ Here's how the hierarchy of dependencies and scopes looks like:\n                         * This `security_scopes` parameter has a property `scopes` with a `list` containing all these scopes declared above, so:\n                             * `security_scopes.scopes` will contain `[\"me\", \"items\"]` for the *path operation* `read_own_items`.\n                             * `security_scopes.scopes` will contain `[\"me\"]` for the *path operation* `read_users_me`, because it is declared in the dependency `get_current_active_user`.\n-                            * `security_scopes.scopes` will contain `[]` (nothing) for the *path operation* `read_system_status`, because it didn't declare any `Security` with `scopes`, and its dependency, `get_current_user`, doesn't declare any `scopes` either.\n+                            * `security_scopes.scopes` will contain `[]` (nothing) for the *path operation* `read_system_status`, because it didn't declare any `Security` with `oauth_scopes`, and its dependency, `get_current_user`, doesn't declare any `oauth_scopes` either.\n \n /// tip\n \n The important and \"magic\" thing here is that `get_current_user` will have a different list of `scopes` to check for each *path operation*.\n \n-All depending on the `scopes` declared in each *path operation* and each dependency in the dependency tree for that specific *path operation*.\n+All depending on the `oauth_scopes` declared in each *path operation* and each dependency in the dependency tree for that specific *path operation*.\n \n ///\n \n@@ -271,4 +281,4 @@ But in the end, they are implementing the same OAuth2 standard.\n \n ## `Security` in decorator `dependencies` { #security-in-decorator-dependencies }\n \n-The same way you can define a `list` of `Depends` in the decorator's `dependen\n\n```\n\n```diff\n@@ -141,7 +141,7 @@ async def get_current_user(\n \n \n async def get_current_active_user(\n-    current_user: Annotated[User, Security(get_current_user, scopes=[\"me\"])],\n+    current_user: Annotated[User, Security(get_current_user, oauth_scopes=[\"me\"])],\n ):\n     if current_user.disabled:\n         raise HTTPException(status_code=400, detail=\"Inactive user\")\n@@ -172,7 +172,9 @@ async def read_users_me(\n \n @app.get(\"/users/me/items/\")\n async def read_own_items(\n-    current_user: Annotated[User, Security(get_current_active_user, scopes=[\"items\"])],\n+    current_user: Annotated[\n+        User, Security(get_current_active_user, oauth_scopes=[\"items\"])\n+    ],\n ):\n     return [{\"item_id\": \"Foo\", \"owner\": current_user.username}]\n \n\n```\n\n```diff\n@@ -140,7 +140,7 @@ async def get_current_user(\n \n \n async def get_current_active_user(\n-    current_user: User = Security(get_current_user, scopes=[\"me\"]),\n+    current_user: User = Security(get_current_user, oauth_scopes=[\"me\"]),\n ):\n     if current_user.disabled:\n         raise HTTPException(status_code=400, detail=\"Inactive user\")\n@@ -169,7 +169,7 @@ async def read_users_me(current_user: User = Depends(get_current_active_user)) -\n \n @app.get(\"/users/me/items/\")\n async def read_own_items(\n-    current_user: User = Security(get_current_active_user, scopes=[\"items\"]),\n+    current_user: User = Security(get_current_active_user, oauth_scopes=[\"items\"]),\n ):\n     return [{\"item_id\": \"Foo\", \"owner\": current_user.username}]\n \n\n```\n\n```diff\n@@ -113,8 +113,8 @@ def get_parameterless_sub_dependant(*, depends: params.Depends, path: str) -> De\n         \"A parameter-less dependency must have a callable dependency\"\n     )\n     own_oauth_scopes: list[str] = []\n-    if isinstance(depends, params.Security) and depends.scopes:\n-        own_oauth_scopes.extend(depends.scopes)\n+    if isinstance(depends, params.Security) and depends.oauth_scopes:\n+        own_oauth_scopes.extend(depends.oauth_scopes)\n     return get_dependant(\n ", "output": "Code Review for: üóëÔ∏è Deprecate `scopes` parameter in `Security` in favor of `oauth_scopes`\n\nüìù **docs/en/docs/advanced/security/oauth2-scopes.md**: Just a reminder that we need to update the version number\n\nüìù **fastapi/param_functions.py**: There seems to be a bug (I think in griffe) in the docstring generation for deprecated parameter - deprecation message is concatenated with docstring without linebreak and this breaks the codeblock formatting.\r\nI added an invisible whitespace character to preserve empty line after code block closing triple back-ticks.\r\n\r\n<details><summary>Without that invisible symbol it looks like this (see in details)</summary>\r\n\r\n\r\n**Pay attention to the line in the middle that starts with `python Security`**\r\n\r\n<img width=\"775\" height=\"486\" alt=\"Screenshot from 2025-11-25 22-27-49\" src=\"https://github.com/user-attachments/assets/30c2ff70-cfec-41c5-8e1a-f8ac4b5a35cd\" />\r\n\r\n</details>\n\n", "source": "pr", "type": "code_review", "pr_number": 150}
{"instruction": "Review this code change in `docs/en/docs/advanced/security/oauth2-scopes.md`", "input": "```diff\n@@ -106,7 +106,17 @@ Now we declare that the *path operation* for `/users/me/items/` requires the sco\n \n For this, we import and use `Security` from `fastapi`.\n \n-You can use `Security` to declare dependencies (just like `Depends`), but `Security` also receives a parameter `scopes` with a list of scopes (strings).\n+You can use `Security` to declare dependencies (just like `Depends`), but `Security` also receives a parameter `oauth_scopes` with a list of scopes (strings).\n+\n+/// note\n+\n+Before version 0.122.X, the name of this parameter was `scopes`.\n+\n+In FastAPI 0.122.X, the `scopes` parameter was deprecated in favor of `oauth_scopes`\n\n```", "output": "Just a reminder that we need to update the version number", "source": "pr_review", "type": "inline_review", "pr_number": 150}
{"instruction": "Review this code change in `fastapi/param_functions.py`", "input": "```diff\n@@ -2324,7 +2376,48 @@ def Security(  # noqa: N802\n \n             These scopes are integrated with OpenAPI (and the API docs at `/docs`).\n             So they are visible in the OpenAPI specification.\n-            )\n+\n+            This parameter is deprecated in favor of `oauth_scopes`.\n+            \"\"\"\n+        ),\n+        deprecated(\n+            \"\"\"\n+            In order to avoid confusion with `scope` parameter, the `scopes` parameter\n+            is deprecated in favor of `oauth_scopes`.\n+\n+            To specify dependency scope for dependencies with `yield` use `scope` parameter:\n+\n+            ```python\n+            Security(dependency_fn, scope=\"function\")\n+            ```\n+\n+            To specify OAuth2 scopes use `oauth_scopes` parameter:\n+\n+            ```python\n+            Security(dependency_fn, oauth_scopes=[\"items\", \"users\"])\n+            ```\n+\n+            &#8203;\n\n```", "output": "There seems to be a bug (I think in griffe) in the docstring generation for deprecated parameter - deprecation message is concatenated with docstring without linebreak and this breaks the codeblock formatting.\r\nI added an invisible whitespace character to preserve empty line after code block closing triple back-ticks.\r\n\r\n<details><summary>Without that invisible symbol it looks like this (see in details)</summary>\r\n\r\n\r\n**Pay attention to the line in the middle that starts with `python Security`**\r\n\r\n<img width=\"775\" height=\"486\" alt=\"Screenshot from 2025-11-25 22-27-49\" src=\"https://github.com/user-attachments/assets/30c2ff70-cfec-41c5-8e1a-f8ac4b5a35cd\" />\r\n\r\n</details>", "source": "pr_review", "type": "inline_review", "pr_number": 150}
{"instruction": "Fix the following bug: üìù Fix CORS tutorial inconsistency with `allow_credentials=True` and wildcard values in `allow_methods`/`allow_headers`", "input": "# Overview\r\n[The CORS documentation](https://github.com/fastapi/fastapi/blob/master/docs/en/docs/tutorial/cors.md) states the following:\r\n\r\n> None of allow_origins, allow_methods and allow_headers can be set to ['*'] if allow_credentials is set to True. All of them must be [explicitly specified](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#credentialed_requests_and_wildcards).\r\n\r\nHowever. [the CORS tutorial example](https://github.com/fastapi/fastapi/blob/master/docs_src/cors/tutorial001.py#L13), sets `allow_methods` and `allow_headers` to `['*']`.\r\n\r\n\r\nRelated discussions:\r\n* https://github.com/fastapi/fastapi/discussions/14491", "output": "```diff\n@@ -13,7 +13,7 @@\n app.add_middleware(\n     CORSMiddleware,\n     allow_origins=origins,\n-    allow_credentials=True,\n+    allow_credentials=False,\n     allow_methods=[\"*\"],\n     allow_headers=[\"*\"],\n )\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 149}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -13,7 +13,7 @@\n app.add_middleware(\n     CORSMiddleware,\n     allow_origins=origins,\n-    allow_credentials=True,\n+    allow_credentials=False,\n     allow_methods=[\"*\"],\n     allow_headers=[\"*\"],\n )\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```", "output": "Bug: üìù Fix CORS tutorial inconsistency with `allow_credentials=True` and wildcard values in `allow_methods`/`allow_headers`\n\n# Overview\r\n[The CORS documentation](https://github.com/fastapi/fastapi/blob/master/docs/en/docs/tutorial/cors.md) states the following:\r\n\r\n> None of allow_origins, allow_methods and allow_headers can be set to ['*'] if allow_credentials is set to True. All of them must be [explicitly specified](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#credentialed_requests_and_wildcards).\r\n\r\nHowever. [the CORS tutorial example](https://github.com/fastapi/fastapi/blob/master/docs_src/cors/tutorial001.py#L13), sets `allow_methods` and `allow_headers` to `['*']`.\r\n\r\n\r\nRelated discussions:\r\n* https://github.com/fastapi/fastapi/discussions/14491", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 149}
{"instruction": "Review the following code changes: üìù Fix CORS tutorial inconsistency with `allow_credentials=True` and wildcard values in `allow_methods`/`allow_headers`", "input": "```diff\n@@ -13,7 +13,7 @@\n app.add_middleware(\n     CORSMiddleware,\n     allow_origins=origins,\n-    allow_credentials=True,\n+    allow_credentials=False,\n     allow_methods=[\"*\"],\n     allow_headers=[\"*\"],\n )\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```\n\n```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```", "output": "Code Review for: üìù Fix CORS tutorial inconsistency with `allow_credentials=True` and wildcard values in `allow_methods`/`allow_headers`\n\nüìù **docs_src/cors/tutorial001.py**: ```suggestion\r\n    allow_headers=[\"Authorization\", \"X-Example\", \"Content-Type\"],\r\n```\r\nI think it would make sense to add `Authorization` header (as we specified `allow_credentials=True`) and probably `Content-Type` header (as it's very common).\r\nWhat do you think?\n\nüìù **docs_src/cors/tutorial001.py**: Hi Yurii, thank you for taking the time to review this PR.\r\n\r\nYes, that makes sense; though since this example is a `simple request`, the `Content-Type` header is allowed by default, the docs mention that [here](https://github.com/fastapi/fastapi/blob/master/docs/en/docs/tutorial/cors.md?plain=1#L59C1-L59C75). I don't think we have to explicitly add it as it might seem a bit confusing on a first read regarding why we did that for `Content-Type` and not the other defaults.\r\n\r\nWhat do you think? I'm happy to add it if you believe it would be helpful to have it there.\n\nüìù **docs_src/cors/tutorial001.py**: It's true for simple requests. But if you send a request with credentials, it will not be a simple request\n\nüìù **docs_src/cors/tutorial001.py**: @simone-trubian, good point :)\r\n\r\n```\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=origins,\r\n    allow_credentials=False,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n```\n\nüìù **docs_src/cors/tutorial001.py**: Yes, that's a good point. I will update the files; thanks for the review guys.\n\n", "source": "pr", "type": "code_review", "pr_number": 149}
{"instruction": "Review this code change in `docs_src/cors/tutorial001.py`", "input": "```diff\n@@ -14,8 +14,8 @@\n     CORSMiddleware,\n     allow_origins=origins,\n     allow_credentials=True,\n-    allow_methods=[\"*\"],\n-    allow_headers=[\"*\"],\n+    allow_methods=[\"GET\"],\n+    allow_headers=[\"X-Example\"],\n\n```", "output": "```suggestion\r\n    allow_headers=[\"Authorization\", \"X-Example\", \"Content-Type\"],\r\n```\r\nI think it would make sense to add `Authorization` header (as we specified `allow_credentials=True`) and probably `Content-Type` header (as it's very common).\r\nWhat do you think?", "source": "pr_review", "type": "inline_review", "pr_number": 149}
{"instruction": "Fix the following bug: üìù Fix docs UI asset paths to respect `root_path` in Custom Docs code example", "input": "## Description\r\n\r\nUpdates docs for https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/ with better examples for handling `root_path` setups.\r\n\r\nUpdates tests to validate static assets when `root_path` is used in conjunction with self-hosting swagger/redoc assets.", "output": "```diff\n@@ -34,7 +34,7 @@ You can reuse FastAPI's internal functions to create the HTML pages for the docs\n \n And similarly for ReDoc...\n \n-{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[2:6,11:19,22:24,27:33] *}\n+{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[2:6,11:20,23:25,28:35] *}\n \n /// tip\n \n@@ -50,7 +50,7 @@ Swagger UI will handle it behind the scenes for you, but it needs this \"redirect\n \n Now, to be able to test that everything works, create a *path operation*:\n \n-{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[36:38] *}\n+{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[38:40] *}\n \n ### Test it { #test-it }\n \n@@ -160,7 +160,7 @@ Again, you can reuse FastAPI's internal functions to create the HTML pages for t\n \n And similarly for ReDoc...\n \n-{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[2:6,14:22,25:27,30:36] *}\n+{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[2:6,14:23,26:28,31:38] *}\n \n /// tip\n \n@@ -176,7 +176,7 @@ Swagger UI will handle it behind the scenes for you, but it needs this \"redirect\n \n Now, to be able to test that everything works, create a *path operation*:\n \n-{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[39:41] *}\n+{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[41:43] *}\n \n ### Test Static Files UI { #test-static-files-ui }\n \n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from fastapi import FastAPI\n+from fastapi import FastAPI, Request\n from fastapi.openapi.docs import (\n     get_redoc_html,\n     get_swagger_ui_html,\n@@ -9,11 +9,12 @@\n \n \n @app.get(\"/docs\", include_in_schema=False)\n-async def custom_swagger_ui_html():\n+async def custom_swagger_ui_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_swagger_ui_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - Swagger UI\",\n-        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,\n+        oauth2_redirect_url=f\"{root_path}{app.swagger_ui_oauth2_redirect_url}\",\n         swagger_js_url=\"https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js\",\n         swagger_css_url=\"https://unpkg.com/swagger-ui-dist@5/swagger-ui.css\",\n     )\n@@ -25,9 +26,10 @@ async def swagger_ui_redirect():\n \n \n @app.get(\"/redoc\", include_in_schema=False)\n-async def redoc_html():\n+async def redoc_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_redoc_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - ReDoc\",\n         redoc_js_url=\"https://unpkg.com/redoc@2/bundles/redoc.standalone.js\",\n     )\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from fastapi import FastAPI\n+from fastapi import FastAPI, Request\n from fastapi.openapi.docs import (\n     get_redoc_html,\n     get_swagger_ui_html,\n@@ -12,13 +12,14 @@\n \n \n @app.get(\"/docs\", include_in_schema=False)\n-async def custom_swagger_ui_html():\n+async def custom_swagger_ui_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_swagger_ui_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - Swagger UI\",\n-        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,\n-        swagger_js_url=\"/static/swagger-ui-bundle.js\",\n-        swagger_css_url=\"/static/swagger-ui.css\",\n+        oauth2_redirect_url=f\"{root_path}{app.swagger_ui_oauth2_redirect_url}\",\n+        swagger_js_url=f\"{root_path}/static/swagger-ui-bundle.js\",\n+        swagger_css_url=f\"{root_path}/static/swagger-ui.css\",\n     )\n \n \n@@ -28,11 +29,12 @@ async def swagger_ui_redirect():\n \n \n @app.get(\"/redoc\", include_in_schema=False)\n-async def redoc_html():\n+async def redoc_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_redoc_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - ReDoc\",\n-        redoc_js_url=\"/static/redoc.standalone.js\",\n+        redoc_js_url=f\"{root_path}/static/redoc.standalone.js\",\n     )\n \n \n\n```\n\n```diff\n@@ -5,38 +5,61 @@\n from fastapi.testclient import TestClient\n \n \n-@pytest.fixture(scope=\"module\")\n-def client():\n+@pytest.fixture(\n+    params=[\"\", \"/api\"],\n+    ids=[\"Without path prefix\", \"With /api path prefix\"],\n+)\n+def path_prefix(request: pytest.FixtureRequest):\n+    return request.param\n+\n+\n+@pytest.fixture\n+def client(path_prefix: str):\n     static_dir: Path = Path(os.getcwd()) / \"static\"\n     print(static_dir)\n     static_dir.mkdir(exist_ok=True)\n     from docs_src.custom_docs_ui.tutorial001_py310 import app\n \n-    with TestClient(app) as client:\n+    with TestClient(app, root_path=path_prefix, base_url=\"http://server\") as client:\n         yield client\n+\n     static_dir.rmdir()\n \n \n-def test_swagger_ui_html(client: TestClient):\n-    response = client.get(\"/docs\")\n+def test_swagger_ui_html(client: TestClient, path_prefix: str):\n+    response = client.get(f\"{path_prefix}/docs\")\n+    assert response.request.url == f\"http://server{path_prefix}/docs\"\n     assert response.status_code == 200, response.text\n     assert \"https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js\" in response.text\n     assert \"https://unpkg.com/swagger-ui-dist@5/swagger-ui.css\" in response.text\n+    assert f\"{path_prefix}/openapi.json\" in response.text\n+    assert f\"{path_prefix}/docs/oauth2-redirect\" in response.text\n+\n+\n+def test_openapi_json(client: TestClient, path_prefix: str):\n+    response = client.get(f\"{path_prefix}/openapi.json\")\n+    assert response.request.url == f\"http://server{path_prefix}/openapi.json\"\n+    assert response.status_code == 200, response.text\n+    assert response.json()[\"openapi\"] == \"3.1.0\"\n \n \n-def test_swagger_ui_oauth2_redirect_html(client: TestClient):\n-    response = client.get(\"/docs/oauth2-redirect\")\n+def test_swagger_ui_oauth2_redirect_html(client: TestClient, path_prefix: str):\n+    response = client.get(f\"{path_prefix}/docs/oauth2-redirect\")\n+    assert response.request.url == f\"http://server{path_prefix}/docs/oauth2-redirect\"\n     assert response.status_code == 200, response.text\n     assert \"window.opener.swaggerUIRedirectOauth2\" in response.text\n \n \n-def test_redoc_html(client: TestClient):\n-    response = client.get(\"/redoc\")\n+def test_redoc_html(client: TestClient, path_prefix: str):\n+    response = client.get(f\"{path_prefix}/redoc\")\n+    assert response.request.url == f\"http://server{path_prefix}/redoc\"\n     assert response.status_code == 200, response.text\n     assert \"https://unpkg.com/redoc@2/bundles/redoc.standalone.js\" in response.text\n+    assert f\"{path_prefix}/openapi.json\" in response.text\n \n \n-def test_api(client: TestClient):\n-    response = client.get(\"/users/john\")\n+def test_api(client: TestClient, path_prefix: str):\n+    response = client.get(f\"{path_prefix}/users/john\")\n+    assert response.request.url == f\"http://server{path_prefix}/users/john\"\n     assert response.status_code == 200, response.text\n     assert response.json()[\"message\"] == \"Hello john\"\n\n```\n\n```diff\n@@ -5,38 +5,60 @@\n from fastapi.testclient import TestClient\n \n \n-@pytest.fixture(scope=\"module\")\n-def client():\n+@pytest.fixture(\n+    params=[\"\", \"/api\"],\n+    ids=[\"Without path prefix\", \"With /api path prefix\"],\n+)\n+def path_prefix(request: pytest.FixtureRequest):\n+    return request.param\n+\n+\n+@pytest.fixture\n+def client(path_prefix: str):\n     static_dir: Path = Path(os.getcwd()) / \"static\"\n     print(static_dir)\n     static_dir.mkdir(exist_ok=True)\n     from docs_src.custom_docs_ui.tutorial002_py310 import app\n \n-    with TestClient(app) as client:\n+    with TestClient(app, root_path=path_prefix, base_url=\"http://server\") as client:\n         yield client\n+\n     static_dir.rmdir()\n \n \n-def test_swagger_ui_html(client: TestClient):\n-    response = client.get(\"/docs\")\n+def test_swagger_ui_html(client: TestClient, path_prefix: str):\n+    respons\n... (truncated)", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 148}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -34,7 +34,7 @@ You can reuse FastAPI's internal functions to create the HTML pages for the docs\n \n And similarly for ReDoc...\n \n-{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[2:6,11:19,22:24,27:33] *}\n+{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[2:6,11:20,23:25,28:35] *}\n \n /// tip\n \n@@ -50,7 +50,7 @@ Swagger UI will handle it behind the scenes for you, but it needs this \"redirect\n \n Now, to be able to test that everything works, create a *path operation*:\n \n-{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[36:38] *}\n+{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[38:40] *}\n \n ### Test it { #test-it }\n \n@@ -160,7 +160,7 @@ Again, you can reuse FastAPI's internal functions to create the HTML pages for t\n \n And similarly for ReDoc...\n \n-{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[2:6,14:22,25:27,30:36] *}\n+{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[2:6,14:23,26:28,31:38] *}\n \n /// tip\n \n@@ -176,7 +176,7 @@ Swagger UI will handle it behind the scenes for you, but it needs this \"redirect\n \n Now, to be able to test that everything works, create a *path operation*:\n \n-{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[39:41] *}\n+{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[41:43] *}\n \n ### Test Static Files UI { #test-static-files-ui }\n \n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from fastapi import FastAPI\n+from fastapi import FastAPI, Request\n from fastapi.openapi.docs import (\n     get_redoc_html,\n     get_swagger_ui_html,\n@@ -9,11 +9,12 @@\n \n \n @app.get(\"/docs\", include_in_schema=False)\n-async def custom_swagger_ui_html():\n+async def custom_swagger_ui_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_swagger_ui_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - Swagger UI\",\n-        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,\n+        oauth2_redirect_url=f\"{root_path}{app.swagger_ui_oauth2_redirect_url}\",\n         swagger_js_url=\"https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js\",\n         swagger_css_url=\"https://unpkg.com/swagger-ui-dist@5/swagger-ui.css\",\n     )\n@@ -25,9 +26,10 @@ async def swagger_ui_redirect():\n \n \n @app.get(\"/redoc\", include_in_schema=False)\n-async def redoc_html():\n+async def redoc_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_redoc_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - ReDoc\",\n         redoc_js_url=\"https://unpkg.com/redoc@2/bundles/redoc.standalone.js\",\n     )\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from fastapi import FastAPI\n+from fastapi import FastAPI, Request\n from fastapi.openapi.docs import (\n     get_redoc_html,\n     get_swagger_ui_html,\n@@ -12,13 +12,14 @@\n \n \n @app.get(\"/docs\", include_in_schema=False)\n-async def custom_swagger_ui_html():\n+async def custom_swagger_ui_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_swagger_ui_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - Swagger UI\",\n-        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,\n-        swagger_js_url=\"/static/swagger-ui-bundle.js\",\n-        swagger_css_url=\"/static/swagger-ui.css\",\n+        oauth2_redirect_url=f\"{root_path}{app.swagger_ui_oauth2_redirect_url}\",\n+        swagger_js_url=f\"{root_path}/static/swagger-ui-bundle.js\",\n+        swagger_css_url=f\"{root_path}/static/swagger-ui.css\",\n     )\n \n \n@@ -28,11 +29,12 @@ async def swagger_ui_redirect():\n \n \n @app.get(\"/redoc\", include_in_schema=False)\n-async def redoc_html():\n+async def redoc_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_redoc_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n   ", "output": "Bug: üìù Fix docs UI asset paths to respect `root_path` in Custom Docs code example\n\n## Description\r\n\r\nUpdates docs for https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/ with better examples for handling `root_path` setups.\r\n\r\nUpdates tests to validate static assets when `root_path` is used in conjunction with self-hosting swagger/redoc assets.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 148}
{"instruction": "Review the following code changes: üìù Fix docs UI asset paths to respect `root_path` in Custom Docs code example", "input": "```diff\n@@ -34,7 +34,7 @@ You can reuse FastAPI's internal functions to create the HTML pages for the docs\n \n And similarly for ReDoc...\n \n-{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[2:6,11:19,22:24,27:33] *}\n+{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[2:6,11:20,23:25,28:35] *}\n \n /// tip\n \n@@ -50,7 +50,7 @@ Swagger UI will handle it behind the scenes for you, but it needs this \"redirect\n \n Now, to be able to test that everything works, create a *path operation*:\n \n-{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[36:38] *}\n+{* ../../docs_src/custom_docs_ui/tutorial001_py310.py hl[38:40] *}\n \n ### Test it { #test-it }\n \n@@ -160,7 +160,7 @@ Again, you can reuse FastAPI's internal functions to create the HTML pages for t\n \n And similarly for ReDoc...\n \n-{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[2:6,14:22,25:27,30:36] *}\n+{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[2:6,14:23,26:28,31:38] *}\n \n /// tip\n \n@@ -176,7 +176,7 @@ Swagger UI will handle it behind the scenes for you, but it needs this \"redirect\n \n Now, to be able to test that everything works, create a *path operation*:\n \n-{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[39:41] *}\n+{* ../../docs_src/custom_docs_ui/tutorial002_py310.py hl[41:43] *}\n \n ### Test Static Files UI { #test-static-files-ui }\n \n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from fastapi import FastAPI\n+from fastapi import FastAPI, Request\n from fastapi.openapi.docs import (\n     get_redoc_html,\n     get_swagger_ui_html,\n@@ -9,11 +9,12 @@\n \n \n @app.get(\"/docs\", include_in_schema=False)\n-async def custom_swagger_ui_html():\n+async def custom_swagger_ui_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_swagger_ui_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - Swagger UI\",\n-        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,\n+        oauth2_redirect_url=f\"{root_path}{app.swagger_ui_oauth2_redirect_url}\",\n         swagger_js_url=\"https://unpkg.com/swagger-ui-dist@5/swagger-ui-bundle.js\",\n         swagger_css_url=\"https://unpkg.com/swagger-ui-dist@5/swagger-ui.css\",\n     )\n@@ -25,9 +26,10 @@ async def swagger_ui_redirect():\n \n \n @app.get(\"/redoc\", include_in_schema=False)\n-async def redoc_html():\n+async def redoc_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_redoc_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - ReDoc\",\n         redoc_js_url=\"https://unpkg.com/redoc@2/bundles/redoc.standalone.js\",\n     )\n\n```\n\n```diff\n@@ -1,4 +1,4 @@\n-from fastapi import FastAPI\n+from fastapi import FastAPI, Request\n from fastapi.openapi.docs import (\n     get_redoc_html,\n     get_swagger_ui_html,\n@@ -12,13 +12,14 @@\n \n \n @app.get(\"/docs\", include_in_schema=False)\n-async def custom_swagger_ui_html():\n+async def custom_swagger_ui_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_swagger_ui_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - Swagger UI\",\n-        oauth2_redirect_url=app.swagger_ui_oauth2_redirect_url,\n-        swagger_js_url=\"/static/swagger-ui-bundle.js\",\n-        swagger_css_url=\"/static/swagger-ui.css\",\n+        oauth2_redirect_url=f\"{root_path}{app.swagger_ui_oauth2_redirect_url}\",\n+        swagger_js_url=f\"{root_path}/static/swagger-ui-bundle.js\",\n+        swagger_css_url=f\"{root_path}/static/swagger-ui.css\",\n     )\n \n \n@@ -28,11 +29,12 @@ async def swagger_ui_redirect():\n \n \n @app.get(\"/redoc\", include_in_schema=False)\n-async def redoc_html():\n+async def redoc_html(req: Request):\n+    root_path = req.scope.get(\"root_path\", \"\").rstrip(\"/\")\n     return get_redoc_html(\n-        openapi_url=app.openapi_url,\n+        openapi_url=f\"{root_path}{app.openapi_url}\",\n         title=app.title + \" - ReDoc\",\n-        redoc_js_url=\"/static/redoc.standalone.js\",\n+        redoc_js_url=f\"{root_path}/static/redoc.standalone.js\",\n     )\n \n \n\n```\n\n```diff\n@@ -5,38 +5,61 @@\n from fastapi.testclient import TestClient\n \n \n-@pytest.fixture(scope=\"module\")\n-def client():\n+@pytest.fixture(\n+    params=[\"\", \"/api\"],\n+    ids=[\"Without path prefix\", \"With /api path prefix\"],\n+)\n+def path_prefix(request: pytest.FixtureRequest):\n+    return request.param\n+\n+\n+@pytest.fixture\n+def client(path_prefix: str):\n     static_dir: Path = Path(os.getcwd()) / \"static\"\n     print(static_dir)\n     static_dir.mkdir(exist_ok=True)\n     from docs_src.custom_docs_ui.tutorial001_py310 import app\n \n-    with TestClient(app) as client:\n+    with TestClient(app, root_path=path_prefix, base_url=\"http://server\") as client:\n         yield client\n+\n     static_dir.rmdir()\n \n \n-def test_swagger_ui_html(client: TestClient):\n-    response = client.get(\"/docs\")\n+def test_swagger_ui_html(client: Test", "output": "Changes look good. This PR implements: üìù Fix docs UI asset paths to respect `root_path` in Custom Docs code example", "source": "pr", "type": "code_review", "pr_number": 148}
{"instruction": "Review the following code changes: üî® Add Kapa.ai widget (AI chatbot)", "input": "```diff\n@@ -61,6 +61,10 @@ a.internal-link::after {\n   padding-bottom: 2em;\n }\n \n+.md-footer-meta .md-social {\n+  padding-right: 4rem;\n+}\n+\n .user-list {\n   display: flex;\n   flex-wrap: wrap;\n\n```\n\n```diff\n@@ -0,0 +1,29 @@\n+document.addEventListener(\"DOMContentLoaded\", function () {\n+  var script = document.createElement(\"script\");\n+  script.src = \"https://widget.kapa.ai/kapa-widget.bundle.js\";\n+  script.setAttribute(\"data-website-id\", \"91f47f27-b405-4299-bf5f-a1c0ec07b3cc\");\n+  script.setAttribute(\"data-project-name\", \"FastAPI\");\n+  script.setAttribute(\"data-project-color\", \"#009485\");\n+  script.setAttribute(\"data-project-logo\", \"https://fastapi.tiangolo.com/img/favicon.png\");\n+  script.setAttribute(\"data-bot-protection-mechanism\", \"hcaptcha\");\n+  script.setAttribute(\"data-button-height\", \"3rem\");\n+  script.setAttribute(\"data-button-width\", \"3rem\");\n+  script.setAttribute(\"data-button-border-radius\", \"50%\");\n+  script.setAttribute(\"data-button-padding\", \"0\");\n+  script.setAttribute(\"data-button-image\", \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 8V4H8'/%3E%3Crect width='16' height='12' x='4' y='8' rx='2'/%3E%3Cpath d='M2 14h2'/%3E%3Cpath d='M20 14h2'/%3E%3Cpath d='M15 13v2'/%3E%3Cpath d='M9 13v2'/%3E%3C/svg%3E\");\n+  script.setAttribute(\"data-button-image-height\", \"20px\");\n+  script.setAttribute(\"data-button-image-width\", \"20px\");\n+  script.setAttribute(\"data-button-text\", \"Ask AI\");\n+  script.setAttribute(\"data-button-text-font-size\", \"0.5rem\");\n+  script.setAttribute(\"data-button-text-font-family\", \"Roboto, sans-serif\");\n+  script.setAttribute(\"data-button-text-color\", \"#FFFFFF\");\n+  script.setAttribute(\"data-modal-border-radius\", \"0.5rem\");\n+  script.setAttribute(\"data-modal-header-bg-color\", \"#009485\");\n+  script.setAttribute(\"data-modal-title\", \"FastAPI AI Assistant\");\n+  script.setAttribute(\"data-modal-title-color\", \"#FFFFFF\");\n+  script.setAttribute(\"data-modal-title-font-family\", \"Roboto, sans-serif\");\n+  script.setAttribute(\"data-modal-example-questions\", \"How to define a route?,How to validate models?,How to handle responses?,How to deploy FastAPI?\");\n+  script.setAttribute(\"data-modal-disclaimer\", \"AI-generated answers based on FastAPI [documentation](https://fastapi.tiangolo.com/) and [community discussions](https://github.com/fastapi/fastapi/discussions). Always verify important information.\");\n+  script.async = true;\n+  document.head.appendChild(script);\n+});\n\n```\n\n```diff\n@@ -342,5 +342,6 @@ extra_css:\n extra_javascript:\n - js/termynal.js\n - js/custom.js\n+- js/init_kapa_widget.js\n hooks:\n - ../../scripts/mkdocs_hooks.py\n\n```", "output": "Changes look good. This PR implements: üî® Add Kapa.ai widget (AI chatbot)", "source": "pr", "type": "code_review", "pr_number": 147}
{"instruction": "Review the following code changes: üìù Update \"Union or anyOf\" section in `docs/en/docs/tutorial/extra-models.md`", "input": "```diff\n@@ -156,35 +156,21 @@ That way, we can declare just the differences between the models (with plaintext\n \n {* ../../docs_src/extra_models/tutorial002_py310.py hl[7,13:14,17:18,21:22] *}\n \n-## `Union` or `anyOf` { #union-or-anyof }\n+## Union or `anyOf` { #union-or-anyof }\n \n-You can declare a response to be the `Union` of two or more types, that means, that the response would be any of them.\n+You can declare a response to be the union of two or more types, that means, that the response would be any of them.\n \n It will be defined in OpenAPI with `anyOf`.\n \n-To do that, use the standard Python type hint <a href=\"https://docs.python.org/3/library/typing.html#typing.Union\" class=\"external-link\" target=\"_blank\">`typing.Union`</a>:\n+To do that, use the standard Python union syntax:\n \n /// note\n \n-When defining a <a href=\"https://docs.pydantic.dev/latest/concepts/types/#unions\" class=\"external-link\" target=\"_blank\">`Union`</a>, include the most specific type first, followed by the less specific type. In the example below, the more specific `PlaneItem` comes before `CarItem` in `Union[PlaneItem, CarItem]`.\n+When defining a union, include the most specific type first, followed by the less specific type. In the example below, the more specific `PlaneItem` comes before `CarItem` in `PlaneItem | CarItem`.\n \n ///\n \n-{* ../../docs_src/extra_models/tutorial003_py310.py hl[1,14:15,18:20,33] *}\n-\n-### `Union` in Python 3.10 { #union-in-python-3-10 }\n-\n-In this example we pass `Union[PlaneItem, CarItem]` as the value of the argument `response_model`.\n-\n-Because we are passing it as a **value to an argument** instead of putting it in a **type annotation**, we have to use `Union` even in Python 3.10.\n-\n-If it was in a type annotation we could have used the vertical bar, as:\n-\n-\n```\n\n```diff\n@@ -156,35 +156,21 @@ That way, we can declare just the differences between the models (with plaintext\n \n {* ../../docs_src/extra_models/tutorial002_py310.py hl[7,13:14,17:18,21:22] *}\n \n-## `Union` or `anyOf` { #union-or-anyof }\n+## Union or `anyOf` { #union-or-anyof }\n \n-You can declare a response to be the `Union` of two or more types, that means, that the response would be any of them.\n+You can declare a response to be the union of two or more types, that means, that the response would be any of them.\n \n It will be defined in OpenAPI with `anyOf`.\n \n-To do that, use the standard Python type hint <a href=\"https://docs.python.org/3/library/typing.html#typing.Union\" class=\"external-link\" target=\"_blank\">`typing.Union`</a>:\n+To do that, use the standard Python type hint union:\n\n```", "output": "Code Review for: üìù Update \"Union or anyOf\" section in `docs/en/docs/tutorial/extra-models.md`\n\nüìù **docs/en/docs/tutorial/extra-models.md**: ```suggestion\nTo do that, use the standard Python union syntax:\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 146}
{"instruction": "Review this code change in `docs/en/docs/tutorial/extra-models.md`", "input": "```diff\n@@ -156,35 +156,21 @@ That way, we can declare just the differences between the models (with plaintext\n \n {* ../../docs_src/extra_models/tutorial002_py310.py hl[7,13:14,17:18,21:22] *}\n \n-## `Union` or `anyOf` { #union-or-anyof }\n+## Union or `anyOf` { #union-or-anyof }\n \n-You can declare a response to be the `Union` of two or more types, that means, that the response would be any of them.\n+You can declare a response to be the union of two or more types, that means, that the response would be any of them.\n \n It will be defined in OpenAPI with `anyOf`.\n \n-To do that, use the standard Python type hint <a href=\"https://docs.python.org/3/library/typing.html#typing.Union\" class=\"external-link\" target=\"_blank\">`typing.Union`</a>:\n+To do that, use the standard Python type hint union:\n\n```", "output": "```suggestion\nTo do that, use the standard Python union syntax:\n```", "source": "pr_review", "type": "inline_review", "pr_number": 146}
{"instruction": "Review the following code changes: üêõ Improve `jsonable_encoder` for other types of iterables", "input": "```diff\n@@ -1,7 +1,7 @@\n import dataclasses\n import datetime\n from collections import defaultdict, deque\n-from collections.abc import Callable\n+from collections.abc import Callable, Mapping, Sequence\n from decimal import Decimal\n from enum import Enum\n from ipaddress import (\n@@ -15,7 +15,10 @@\n from pathlib import Path, PurePath\n from re import Pattern\n from types import GeneratorType\n-from typing import Annotated, Any\n+from typing import (\n+    Annotated,\n+    Any,\n+)\n from uuid import UUID\n \n from annotated_doc import Doc\n@@ -27,11 +30,23 @@\n from pydantic.types import SecretBytes, SecretStr\n from pydantic_core import PydanticUndefinedType\n \n+# Dropped support for Pydantic v1 so we can remove the try-except import and the related code\n+from pydantic_extra_types import color as et_color\n+\n from ._compat import (\n     Url,\n     is_pydantic_v1_model_instance,\n )\n \n+encoders_by_extra_type: dict[type[Any], Callable[[Any], Any]] = {et_color.Color: str}\n+\n+try:\n+    from pydantic_extra_types import coordinate\n+\n+    encoders_by_extra_type[coordinate.Coordinate] = str\n+except ImportError:\n+    pass\n+\n \n # Taken from Pydantic v1 as is\n def isoformat(o: datetime.date | datetime.time) -> str:\n@@ -106,7 +121,9 @@ def generate_encoders_by_class_tuples(\n     return encoders_by_class_tuples\n \n \n-encoders_by_class_tuples = generate_encoders_by_class_tuples(ENCODERS_BY_TYPE)\n+encoders_by_class_tuples = generate_encoders_by_class_tuples(\n+    ENCODERS_BY_TYPE | encoders_by_extra_type\n+)\n \n \n def jsonable_encoder(\n@@ -198,6 +215,18 @@ def jsonable_encoder(\n             \"\"\"\n         ),\n     ] = True,\n+    named_tuple_as_dict: Annotated[\n+        bool,\n+        Doc(\n+            \"\"\"\n+            Whether to encode named tuples as dicts instead of lists.\n+\n+            This is useful when you want to preserve the field names of named tuples\n+            in the JSON output, which can make it easier to understand and work with\n+            the data on the client side.\n+            \"\"\"\n+        ),\n+    ] = False,\n ) -> Any:\n     \"\"\"\n     Convert any object to something that can be encoded in JSON.\n@@ -239,6 +268,10 @@ def jsonable_encoder(\n             exclude_defaults=exclude_defaults,\n             sqlalchemy_safe=sqlalchemy_safe,\n         )\n+    # The extra types have their own encoders, so we check for them before checking for dataclasses,\n+    # because some of them are also dataclasses, and we want to use their custom encoders instead of encoding them as dataclasses.\n+    if type(obj) in encoders_by_extra_type:\n+        return encoders_by_extra_type[type(obj)](obj)\n     if dataclasses.is_dataclass(obj):\n         assert not isinstance(obj, type)\n         obj_dict = dataclasses.asdict(obj)\n@@ -261,7 +294,7 @@ def jsonable_encoder(\n         return obj\n     if isinstance(obj, PydanticUndefinedType):\n         return None\n-    if isinstance(obj, dict):\n+    if isinstance(obj, Mapping):\n         encoded_dict = {}\n         allowed_keys = set(obj.keys())\n         if include is not\n\n```\n\n```diff\n@@ -1,12 +1,13 @@\n import warnings\n-from collections import deque\n+from collections import deque, namedtuple\n+from collections.abc import Sequence\n from dataclasses import dataclass\n from datetime import datetime, timezone\n from decimal import Decimal\n from enum import Enum\n from math import isinf, isnan\n from pathlib import PurePath, PurePosixPath, PureWindowsPath\n-from typing import TypedDict\n+from typing import NamedTuple, TypedDict\n \n import pytest\n from fastapi._compat import Undefined\n@@ -311,3 +312,124 @@ class Model(BaseModel):\n def test_encode_pydantic_undefined():\n     data = {\"value\": Undefined}\n     assert jsonable_encoder(data) == {\"value\": None}\n+\n+\n+def test_encode_sequence():\n+    class SequenceModel(Sequence[str]):\n+        def __init__(self, items: list[str]):\n+            self._items = items\n+\n+        def __getitem__(self, index: int | slice) -> str | Sequence[str]:\n+            return self._items[index]\n+\n+        def __len__(self) -> int:\n+            return len(self._items)\n+\n+    seq = SequenceModel([\"item1\", \"item2\", \"item3\"])\n+    assert len(seq) == 3\n+    assert jsonable_encoder(seq) == [\"item1\", \"item2\", \"item3\"]\n+\n+\n+def test_encode_bytes():\n+    assert jsonable_encoder(b\"hello\") == \"hello\"\n+\n+\n+def test_encode_bytes_in_dict():\n+    data = {\"content\": b\"hello\", \"name\": \"test\"}\n+    assert jsonable_encoder(data) == {\"content\": \"hello\", \"name\": \"test\"}\n+\n+\n+def test_encode_list_of_bytes():\n+    data = [b\"hello\", b\"world\"]\n+    assert jsonable_encoder(data) == [\"hello\", \"world\"]\n+\n+\n+def test_encode_generator():\n+    def gen():\n+        yield 1\n+        yield 2\n+        yield 3\n+\n+    assert jsonable_encoder(gen()) == [1, 2, 3]\n+\n+\n+def test_encode_generator_of_bytes():\n+    def gen():\n+        yield b\"hello\"\n+        yield b\"world\"\n+\n+    assert jsonable_encoder(gen()) == [\"hello\", \"world\"]\n+\n+\n+def test_encode_named_tuple_as_list():\n+    Point = namedtuple(\"Point\", [\"x\", \"y\"])\n+    p = Point(1, 2)\n+    assert jsonab", "output": "Code Review for: üêõ Improve `jsonable_encoder` for other types of iterables\n\nüìù **fastapi/encoders.py**: This package supports pydantic 2.x only\n\nüìù **fastapi/encoders.py**: Same for `Coordinate` type\n\nüìù **fastapi/encoders.py**: Note that this is not an issue anymore, as we've dropped support for Pydantic v1 in the meantime.\n\n", "source": "pr", "type": "code_review", "pr_number": 145}
{"instruction": "Review this code change in `fastapi/encoders.py`", "input": "```diff\n@@ -14,14 +14,26 @@\n from pathlib import Path, PurePath\n from re import Pattern\n from types import GeneratorType\n-from typing import Any, Callable, Dict, List, Optional, Tuple, Type, Union\n+from typing import (\n+    Any,\n+    Callable,\n+    Dict,\n+    List,\n+    Mapping,\n+    Optional,\n+    Sequence,\n+    Tuple,\n+    Type,\n+    Union,\n+)\n from uuid import UUID\n \n from fastapi.types import IncEx\n from pydantic import BaseModel\n-from pydantic.color import Color\n from pydantic.networks import AnyUrl, NameEmail\n from pydantic.types import SecretBytes, SecretStr\n+from pydantic_extra_types.color import Color\n\n```", "output": "This package supports pydantic 2.x only", "source": "pr_review", "type": "inline_review", "pr_number": 145}
{"instruction": "Fix the following bug: ‚úèÔ∏è Fix several typos in ru translations", "input": "Fix ru typos in docs", "output": "```diff\n@@ -83,7 +83,7 @@ app.add_middleware(UnicornMiddleware, some_config=\"rainbow\")\n –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:\n \n - `minimum_size` ‚Äî –Ω–µ —Å–∂–∏–º–∞—Ç—å GZip‚Äë–æ–º –æ—Ç–≤–µ—Ç—ã, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω—å—à–µ —ç—Ç–æ–≥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–π—Ç–∞—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `500`.\n-- `compresslevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å GZip‚Äë—Å–∂–∞—Ç–∏—è. –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `9`. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.\n+- `compresslevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å GZip‚Äë—Å–∂–∞—Ç–∏—è. –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `9`. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.\n \n ## –î—Ä—É–≥–∏–µ middleware { #other-middlewares }\n \n\n```\n\n```diff\n@@ -214,7 +214,7 @@ CMD [\"fastapi\", \"run\", \"app/main.py\", \"--port\", \"80\"]\n \n 5. –ö–æ–ø–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./app` –≤–Ω—É—Ç—Ä—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/code`.\n \n-    –¢–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ**, –∫—ç—à Docker **–≤—Ä—è–¥ –ª–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥a –∏–ª–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤**.\n+    –¢–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ**, –∫—ç—à Docker **–≤—Ä—è–¥ –ª–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥–∞ –∏–ª–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤**.\n \n     –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —à–∞–≥ **–±–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É** `Dockerfile`, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.\n \n\n```\n\n```diff\n@@ -76,4 +76,4 @@\n \n –£ **FastAPI** –≤–µ–ª–∏–∫–æ–µ –±—É–¥—É—â–µ–µ.\n \n-–ò [–≤–∞—à –≤–∫–ª–∞–¥ –≤ —ç—Ç–æ](help-fastapi.md){.internal-link target=_blank} - –æ—á–µ–Ω—å —Ü–µ–Ω–Ω–µ–Ω.\n+–ò [–≤–∞—à –≤–∫–ª–∞–¥ –≤ —ç—Ç–æ](help-fastapi.md){.internal-link target=_blank} - –æ—á–µ–Ω—å —Ü–µ–Ω–µ–Ω.\n\n```\n\n```diff\n@@ -20,7 +20,7 @@ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4\n \n –ù–æ –æ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —ç–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏ (–≤—ã–¥–∞–≤–∞–ª–∏), –≤—ã –º–æ–∂–µ—Ç–µ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã –µ–≥–æ —ç–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏.\n \n-–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å–æ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º, 1 –Ω–µ–¥–µ–ª—è. –ê –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º, –≤—ã –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.\n+–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å–æ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º, 1 –Ω–µ–¥–µ–ª—è. –ê –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º, –≤—ã –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.\n \n –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ –∏—Å—Ç–µ—á–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –µ–º—É –ø—Ä–∏–¥–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω. –ê –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∏–ª–∏ —Ç—Ä–µ—Ç—å–µ –ª–∏—Ü–æ) –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã —Å–º–æ–∂–µ—Ç–µ —ç—Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –±—É–¥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å.\n \n\n```\n\n```diff\n@@ -58,7 +58,7 @@ Swagger UI —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å ¬´–∑–∞ –∫—É–ª–∏—Å–∞–º–∏¬ª, –Ω–æ –¥\n \n ## –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ { #self-hosting-javascript-and-css-for-docs }\n \n-–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n+–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 144}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -83,7 +83,7 @@ app.add_middleware(UnicornMiddleware, some_config=\"rainbow\")\n –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:\n \n - `minimum_size` ‚Äî –Ω–µ —Å–∂–∏–º–∞—Ç—å GZip‚Äë–æ–º –æ—Ç–≤–µ—Ç—ã, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω—å—à–µ —ç—Ç–æ–≥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–π—Ç–∞—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `500`.\n-- `compresslevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å GZip‚Äë—Å–∂–∞—Ç–∏—è. –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `9`. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.\n+- `compresslevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å GZip‚Äë—Å–∂–∞—Ç–∏—è. –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `9`. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.\n \n ## –î—Ä—É–≥–∏–µ middleware { #other-middlewares }\n \n\n```\n\n```diff\n@@ -214,7 +214,7 @@ CMD [\"fastapi\", \"run\", \"app/main.py\", \"--port\", \"80\"]\n \n 5. –ö–æ–ø–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./app` –≤–Ω—É—Ç—Ä—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/code`.\n \n-    –¢–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ**, –∫—ç—à Docker **–≤—Ä—è–¥ –ª–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥a –∏–ª–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤**.\n+    –¢–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ**, –∫—ç—à Docker **–≤—Ä—è–¥ –ª–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥–∞ –∏–ª–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤**.\n \n     –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —à–∞–≥ **–±–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É** `Dockerfile`, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.\n \n\n```\n\n```diff\n@@ -76,4 +76,4 @@\n \n –£ **FastAPI** –≤–µ–ª–∏–∫–æ–µ –±—É–¥—É—â–µ–µ.\n \n-–ò [–≤–∞—à –≤–∫–ª–∞–¥ –≤ —ç—Ç–æ](help-fastapi.md){.internal-link target=_blank} - –æ—á–µ–Ω—å —Ü–µ–Ω–Ω–µ–Ω.\n+–ò [–≤–∞—à –≤–∫–ª–∞–¥ –≤ —ç—Ç–æ](help-fastapi.md){.internal-link target=_blank} - –æ—á–µ–Ω—å —Ü–µ–Ω–µ–Ω.\n\n```\n\n```diff\n@@ -20,7 +20,7 @@ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4\n \n –ù–æ –æ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —ç–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏ (–≤—ã–¥–∞–≤–∞–ª–∏), –≤—ã –º–æ–∂–µ—Ç–µ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã –µ–≥–æ —ç–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏.\n \n-–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å–æ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º, 1 –Ω–µ–¥–µ–ª—è. –ê –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º, –≤—ã –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.\n+–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å–æ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º, 1 –Ω–µ–¥–µ–ª—è. –ê –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º, –≤—ã –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.\n \n –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ –∏—Å—Ç–µ—á–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –µ–º—É –ø—Ä–∏–¥–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω. –ê –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∏–ª–∏ —Ç—Ä–µ—Ç—å–µ –ª–∏—Ü–æ) –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã —Å–º–æ–∂–µ—Ç–µ —ç—Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –±—É–¥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å.\n \n\n```\n\n```diff\n@@ -58,7 +58,7 @@ Swagger UI —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å ¬´–∑–∞ –∫—É–ª–∏—Å–∞–º–∏¬ª, –Ω–æ –¥\n \n ## –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ { #self-hosting-javascript-and-css-for-docs }\n \n-–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n+–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n\n```", "output": "Bug: ‚úèÔ∏è Fix several typos in ru translations\n\nFix ru typos in docs", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 144}
{"instruction": "Review the following code changes: ‚úèÔ∏è Fix several typos in ru translations", "input": "```diff\n@@ -83,7 +83,7 @@ app.add_middleware(UnicornMiddleware, some_config=\"rainbow\")\n –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã:\n \n - `minimum_size` ‚Äî –Ω–µ —Å–∂–∏–º–∞—Ç—å GZip‚Äë–æ–º –æ—Ç–≤–µ—Ç—ã, —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω—å—à–µ —ç—Ç–æ–≥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –±–∞–π—Ç–∞—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `500`.\n-- `compresslevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å GZip‚Äë—Å–∂–∞—Ç–∏—è. –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `9`. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.\n+- `compresslevel` ‚Äî —É—Ä–æ–≤–µ–Ω—å GZip‚Äë—Å–∂–∞—Ç–∏—è. –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 9. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `9`. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±—ã—Å—Ç—Ä–µ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞; –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ, –Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞.\n \n ## –î—Ä—É–≥–∏–µ middleware { #other-middlewares }\n \n\n```\n\n```diff\n@@ -214,7 +214,7 @@ CMD [\"fastapi\", \"run\", \"app/main.py\", \"--port\", \"80\"]\n \n 5. –ö–æ–ø–∏—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./app` –≤–Ω—É—Ç—Ä—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/code`.\n \n-    –¢–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ**, –∫—ç—à Docker **–≤—Ä—è–¥ –ª–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥a –∏–ª–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤**.\n+    –¢–∞–∫ –∫–∞–∫ –∑–¥–µ—Å—å –≤–µ—Å—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π **–º–µ–Ω—è–µ—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ**, –∫—ç—à Docker **–≤—Ä—è–¥ –ª–∏** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —ç—Ç–æ–≥–æ —à–∞–≥–∞ –∏–ª–∏ **–ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤**.\n \n     –ü–æ—ç—Ç–æ–º—É –≤–∞–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —à–∞–≥ **–±–ª–∏–∂–µ –∫ –∫–æ–Ω—Ü—É** `Dockerfile`, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.\n \n\n```\n\n```diff\n@@ -76,4 +76,4 @@\n \n –£ **FastAPI** –≤–µ–ª–∏–∫–æ–µ –±—É–¥—É—â–µ–µ.\n \n-–ò [–≤–∞—à –≤–∫–ª–∞–¥ –≤ —ç—Ç–æ](help-fastapi.md){.internal-link target=_blank} - –æ—á–µ–Ω—å —Ü–µ–Ω–Ω–µ–Ω.\n+–ò [–≤–∞—à –≤–∫–ª–∞–¥ –≤ —ç—Ç–æ](help-fastapi.md){.internal-link target=_blank} - –æ—á–µ–Ω—å —Ü–µ–Ω–µ–Ω.\n\n```\n\n```diff\n@@ -20,7 +20,7 @@ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4\n \n –ù–æ –æ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω. –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫–æ–≥–¥–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —ç–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏ (–≤—ã–¥–∞–≤–∞–ª–∏), –≤—ã –º–æ–∂–µ—Ç–µ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã –µ–≥–æ —ç–º–∏—Ç–∏—Ä–æ–≤–∞–ª–∏.\n \n-–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å–æ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º, 1 –Ω–µ–¥–µ–ª—è. –ê –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º, –≤—ã –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.\n+–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω —Å–æ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è, —Å–∫–∞–∂–µ–º, 1 –Ω–µ–¥–µ–ª—è. –ê –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–æ–º, –≤—ã –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–Ω –≤—Å–µ –µ—â–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.\n \n –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞ –∏—Å—Ç–µ—á–µ—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –µ–º—É –ø—Ä–∏–¥–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω. –ê –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–∏–ª–∏ —Ç—Ä–µ—Ç—å–µ –ª–∏—Ü–æ) –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã —Å–º–æ–∂–µ—Ç–µ —ç—Ç–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –±—É–¥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å.\n \n\n```\n\n```diff\n@@ -58,7 +58,7 @@ Swagger UI —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å ¬´–∑–∞ –∫—É–ª–∏—Å–∞–º–∏¬ª, –Ω–æ –¥\n \n ## –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ { #self-hosting-javascript-and-css-for-docs }\n \n-–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n+–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n\n```", "output": "Code Review for: ‚úèÔ∏è Fix several typos in ru translations\n\nüìù **docs/ru/docs/how-to/custom-docs-ui-assets.md**: `–æ—Ñ–ª–∞–π–Ω–µ` is correct: https://gramota.ru/spravka/vopros/290484\n\nüìù **docs/ru/docs/how-to/custom-docs-ui-assets.md**: ```suggestion\n–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 144}
{"instruction": "Review this code change in `docs/ru/docs/how-to/custom-docs-ui-assets.md`", "input": "```diff\n@@ -58,7 +58,7 @@ Swagger UI —Å–¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ –≤–∞—Å ¬´–∑–∞ –∫—É–ª–∏—Å–∞–º–∏¬ª, –Ω–æ –¥\n \n ## –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ { #self-hosting-javascript-and-css-for-docs }\n \n-–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n+–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ JavaScript –∏ CSS –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –æ—Ñ—Ñ–ª–∞–π–Ω–µ, –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–∫—Ä—ã—Ç–æ–º—É –ò–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.\n\n```", "output": "`–æ—Ñ–ª–∞–π–Ω–µ` is correct: https://gramota.ru/spravka/vopros/290484", "source": "pr_review", "type": "inline_review", "pr_number": 144}
{"instruction": "Review the following code changes: Prevent IncEx reexport from being stripped from stubs.", "input": "```diff\n@@ -1,12 +1,13 @@\n import types\n from collections.abc import Callable\n from enum import Enum\n-from typing import Any, TypeVar, Union\n+from typing import Any, TypeAlias, TypeVar, Union\n \n from pydantic import BaseModel\n-from pydantic.main import IncEx as IncEx\n+from pydantic.main import IncEx as _IncEx\n \n DecoratedCallable = TypeVar(\"DecoratedCallable\", bound=Callable[..., Any])\n UnionType = getattr(types, \"UnionType\", Union)\n ModelNameMap = dict[type[BaseModel] | type[Enum], str]\n DependencyCacheKey = tuple[Callable[..., Any] | None, tuple[str, ...], str]\n+IncEx: TypeAlias = _IncEx\n\n```", "output": "Changes look good. This PR implements: Prevent IncEx reexport from being stripped from stubs.", "source": "pr", "type": "code_review", "pr_number": 143}
{"instruction": "Fix the following bug: üî® Fix retry logic for server check in `scripts/playwright`", "input": "Problems:\r\nbreak inside except stops the loop immediately after the first failure ‚Üí retries are useless.\r\nNo check for response.status_code.\r\n\r\nsolution I propose:\r\nIncreased the retry attempts for server connection and added a timeout to the HTTP request.\r\nImproved the HTTP Request Loop Logic:", "output": "```diff\n@@ -25,12 +25,16 @@ def run(playwright: Playwright) -> None:\n     [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"],\n )\n try:\n-    for _ in range(3):\n+    for _ in range(10):\n         try:\n-            response = httpx.get(\"http://localhost:8000/docs\")\n+            response = httpx.get(\"http://localhost:8000/docs\", timeout=1)\n+            if response.status_code == 200:\n+                break\n         except httpx.ConnectError:\n             time.sleep(1)\n-            break\n+    else:\n+        raise RuntimeError(\"Server did not start in time\")\n+\n     with sync_playwright() as playwright:\n         run(playwright)\n finally:\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 142}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -25,12 +25,16 @@ def run(playwright: Playwright) -> None:\n     [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"],\n )\n try:\n-    for _ in range(3):\n+    for _ in range(10):\n         try:\n-            response = httpx.get(\"http://localhost:8000/docs\")\n+            response = httpx.get(\"http://localhost:8000/docs\", timeout=1)\n+            if response.status_code == 200:\n+                break\n         except httpx.ConnectError:\n             time.sleep(1)\n-            break\n+    else:\n+        raise RuntimeError(\"Server did not start in time\")\n+\n     with sync_playwright() as playwright:\n         run(playwright)\n finally:\n\n```", "output": "Bug: üî® Fix retry logic for server check in `scripts/playwright`\n\nProblems:\r\nbreak inside except stops the loop immediately after the first failure ‚Üí retries are useless.\r\nNo check for response.status_code.\r\n\r\nsolution I propose:\r\nIncreased the retry attempts for server connection and added a timeout to the HTTP request.\r\nImproved the HTTP Request Loop Logic:", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 142}
{"instruction": "Review the following code changes: üî® Fix retry logic for server check in `scripts/playwright`", "input": "```diff\n@@ -25,12 +25,16 @@ def run(playwright: Playwright) -> None:\n     [\"fastapi\", \"run\", \"docs_src/sql_databases/tutorial002.py\"],\n )\n try:\n-    for _ in range(3):\n+    for _ in range(10):\n         try:\n-            response = httpx.get(\"http://localhost:8000/docs\")\n+            response = httpx.get(\"http://localhost:8000/docs\", timeout=1)\n+            if response.status_code == 200:\n+                break\n         except httpx.ConnectError:\n             time.sleep(1)\n-            break\n+    else:\n+        raise RuntimeError(\"Server did not start in time\")\n+\n     with sync_playwright() as playwright:\n         run(playwright)\n finally:\n\n```", "output": "Changes look good. This PR implements: üî® Fix retry logic for server check in `scripts/playwright`", "source": "pr", "type": "code_review", "pr_number": 142}
{"instruction": "Fix the following bug: Fix ann compat", "input": "when we try to generate openapi schema we lose the info (meta) from annotated, the get_def extracts all and then rewrap in the modelfield (to avoid duplication in the schema??), now using the lenient_issubclass just basemodel are gonna be flatted, enums (currency from iso4217) are correctly handled (need tests!)\r\n\r\nThis probably is not needed if they declare correctly the __get_pydantic_json_schema__ but I think that WithJsonSchema should be respected https://docs.pydantic.dev/latest/api/json_schema/#pydantic.json_schema.WithJsonSchema", "output": "```diff\n@@ -251,6 +251,7 @@ def get_definitions(\n             mode=\"validation\",\n         )\n         for model in flat_validation_models\n+        if lenient_issubclass(model, BaseModel)\n     ]\n     flat_serialization_model_fields = [\n         ModelField(\n@@ -259,6 +260,7 @@ def get_definitions(\n             mode=\"serialization\",\n         )\n         for model in flat_serialization_models\n+        if lenient_issubclass(model, BaseModel)\n     ]\n     flat_model_fields = flat_validation_model_fields + flat_serialization_model_fields\n     input_types = {f.field_info.annotation for f in fields}\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 141}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -251,6 +251,7 @@ def get_definitions(\n             mode=\"validation\",\n         )\n         for model in flat_validation_models\n+        if lenient_issubclass(model, BaseModel)\n     ]\n     flat_serialization_model_fields = [\n         ModelField(\n@@ -259,6 +260,7 @@ def get_definitions(\n             mode=\"serialization\",\n         )\n         for model in flat_serialization_models\n+        if lenient_issubclass(model, BaseModel)\n     ]\n     flat_model_fields = flat_validation_model_fields + flat_serialization_model_fields\n     input_types = {f.field_info.annotation for f in fields}\n\n```", "output": "Bug: Fix ann compat\n\nwhen we try to generate openapi schema we lose the info (meta) from annotated, the get_def extracts all and then rewrap in the modelfield (to avoid duplication in the schema??), now using the lenient_issubclass just basemodel are gonna be flatted, enums (currency from iso4217) are correctly handled (need tests!)\r\n\r\nThis probably is not needed if they declare correctly the __get_pydantic_json_schema__ but I think that WithJsonSchema should be respected https://docs.pydantic.dev/latest/api/json_schema/#pydantic.json_schema.WithJsonSchema", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 141}
{"instruction": "Review the following code changes: Fix ann compat", "input": "```diff\n@@ -251,6 +251,7 @@ def get_definitions(\n             mode=\"validation\",\n         )\n         for model in flat_validation_models\n+        if lenient_issubclass(model, BaseModel)\n     ]\n     flat_serialization_model_fields = [\n         ModelField(\n@@ -259,6 +260,7 @@ def get_definitions(\n             mode=\"serialization\",\n         )\n         for model in flat_serialization_models\n+        if lenient_issubclass(model, BaseModel)\n     ]\n     flat_model_fields = flat_validation_model_fields + flat_serialization_model_fields\n     input_types = {f.field_info.annotation for f in fields}\n\n```", "output": "Changes look good. This PR implements: Fix ann compat", "source": "pr", "type": "code_review", "pr_number": 141}
{"instruction": "Review the following code changes: refactor: Improve type annotations and use python 3.10+ syntax", "input": "```diff\n@@ -381,19 +381,12 @@ def analyze_param(\n         fastapi_annotations = [\n             arg\n             for arg in annotated_args[1:]\n-            if isinstance(arg, (FieldInfo, params.Depends))\n+            if isinstance(arg, FieldInfo | params.Depends)\n         ]\n         fastapi_specific_annotations = [\n             arg\n             for arg in fastapi_annotations\n-            if isinstance(\n-                arg,\n-                (\n-                    params.Param,\n-                    params.Body,\n-                    params.Depends,\n-                ),\n-            )\n+            if isinstance(arg, params.Param | params.Body | params.Depends)\n         ]\n         if fastapi_specific_annotations:\n             fastapi_annotation: FieldInfo | params.Depends | None = (\n@@ -724,7 +717,7 @@ def _get_multidict_value(\n     if (\n         (not _is_json_field(field))\n         and field_annotation_is_sequence(field.field_info.annotation)\n-        and isinstance(values, (ImmutableMultiDict, Headers))\n+        and isinstance(values, ImmutableMultiDict | Headers)\n     ):\n         value = values.getlist(alias)\n     else:\n@@ -833,7 +826,7 @@ def request_params_to_args(\n     return values, errors\n \n \n-def is_union_of_base_models(field_type: Any) -> bool:\n+def is_union_of_base_models(field_type: type | None) -> bool:\n     \"\"\"Check if field type is a Union where all members are BaseModel subclasses.\"\"\"\n     from fastapi.types import UnionType\n \n\n```\n\n```diff\n@@ -16,7 +16,7 @@ def __init__(\n         description: str | None,\n         scheme_name: str | None,\n         auto_error: bool,\n-    ):\n+    ) -> None:\n         self.auto_error = auto_error\n \n         self.model: APIKey = APIKey(\n@@ -128,7 +128,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         super().__init__(\n             location=APIKeyIn.query,\n             name=name,\n@@ -216,7 +216,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         super().__init__(\n             location=APIKeyIn.header,\n             name=name,\n@@ -304,7 +304,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         super().__init__(\n             location=APIKeyIn.cookie,\n             name=name,\n\n```\n\n```diff\n@@ -74,7 +74,7 @@ def __init__(\n         scheme_name: str | None = None,\n         description: str | None = None,\n         auto_error: bool = True,\n-    ):\n+    ) -> None:\n         self.model: HTTPBaseModel = HTTPBaseModel(\n             scheme=scheme, description=description\n         )\n@@ -188,7 +188,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         self.model = HTTPBaseModel(scheme=\"basic\", description=description)\n         self.scheme_name = scheme_name or self.__class__.__name__\n         self.realm = realm\n@@ -295,7 +295,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         self.model = HTTPBearerModel(bearerFormat=bearerFormat, description=description)\n         self.scheme_name = scheme_name or self.__class__.__name__\n         self.auto_error = auto_error\n@@ -396,7 +396,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         self.model = HTTPBaseModel(scheme=\"digest\", description=description)\n         self.scheme_name = scheme_name or self.__class__.__name__\n         self.auto_error = auto_error\n\n```\n\n```diff\n@@ -150,7 +150,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-    ):\n+    ) -> None:\n         self.grant_type = grant_type\n         self.username = username\n         self.password = password\n@@ -316,7 +316,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-    ):\n+    ) -> None:\n         super().__init__(\n             grant_type=grant_type,\n             username=username,\n@@ -391,7 +391,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         self.model = OAuth2Model(\n             flows=cast(OAuthFlowsModel, flows), description=description\n         )\n@@ -513,7 +513,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-    ):\n+    ) -> None:\n         if not scopes:\n             scopes = {}\n         flows = OAuthFlowsModel(\n@@ -618,7 +618,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         if not scopes:\n             scopes = {}\n         flows = OAuthFlowsModel(\n@@ -673,7 +673,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = None,\n-    ):\n+    ) -> None:\n         self.scopes: Annotated[\n             list[str],\n             Doc(\n\n```\n\n```diff\n@@ -70,7 +70,7 @@ def __init__(\n                 \"\"\"\n             ),\n         ] = True,\n-    ):\n+    ) -> None:\n         self.model = OpenIdConnectModel(\n             openIdConnectUrl=openIdConnectUrl, description=descr", "output": "Code Review for: refactor: Improve type annotations and use python 3.10+ syntax\n\nüìù **fastapi/dependencies/utils.py**: ```\nmypy check...............................................................Failed\n- hook id: local-mypy\n- exit code: 1\n\n", "source": "pr", "type": "code_review", "pr_number": 140}
{"instruction": "Review this code change in `fastapi/dependencies/utils.py`", "input": "```diff\n@@ -833,7 +826,7 @@ def request_params_to_args(\n     return values, errors\n \n \n-def is_union_of_base_models(field_type: Any) -> bool:\n+def is_union_of_base_models(field_type: type) -> bool:\n\n```", "output": "```\nmypy check...............................................................Failed\n- hook id: local-mypy\n- exit code: 1", "source": "pr_review", "type": "inline_review", "pr_number": 140}
{"instruction": "Fix the following bug: üìù Fix `StreamingResponse` code example", "input": "Fixes #14680\r\n\r\n`async` generators passed to `starlette.StreamingResponse` must contain an `await` command[^starlette-1776] otherwise they block\r\n\r\n[^starlette-1776]: https://github.com/Kludex/starlette/discussions/1776#discussioncomment-3207518", "output": "```diff\n@@ -217,7 +217,15 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+An `async` task can only be cancelled when it reaches an `await`. If there is no `await`, the generator can not be cancelled properly and may keep running even after cancellation is requested.\n+\n+Since this small example does not need any `await` statements, we add an `await asyncio.sleep(0)` to give the event loop a chance to handle cancellation.\n+\n+///\n \n #### Using `StreamingResponse` with file-like objects { #using-streamingresponse-with-file-like-objects }\n \n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)\n \n \n @app.get(\"/\")\n\n```\n\n```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0.1)\n\n```\n\n```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)  # simulate async work\n\n```\n\n```diff\n@@ -217,7 +217,17 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+In `asyncio`, a task can only be cancelled when it reaches an `await`.\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 139}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -217,7 +217,15 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+An `async` task can only be cancelled when it reaches an `await`. If there is no `await`, the generator can not be cancelled properly and may keep running even after cancellation is requested.\n+\n+Since this small example does not need any `await` statements, we add an `await asyncio.sleep(0)` to give the event loop a chance to handle cancellation.\n+\n+///\n \n #### Using `StreamingResponse` with file-like objects { #using-streamingresponse-with-file-like-objects }\n \n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)\n \n \n @app.get(\"/\")\n\n```\n\n```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0.1)\n\n```\n\n```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)  # simulate async work\n\n```\n\n```diff\n@@ -217,7 +217,17 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+In `asyncio`, a task can only be cancelled when it reaches an `await`.\n\n```", "output": "Bug: üìù Fix `StreamingResponse` code example\n\nFixes #14680\r\n\r\n`async` generators passed to `starlette.StreamingResponse` must contain an `await` command[^starlette-1776] otherwise they block\r\n\r\n[^starlette-1776]: https://github.com/Kludex/starlette/discussions/1776#discussioncomment-3207518", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 139}
{"instruction": "Review the following code changes: üìù Fix `StreamingResponse` code example", "input": "```diff\n@@ -217,7 +217,15 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+An `async` task can only be cancelled when it reaches an `await`. If there is no `await`, the generator can not be cancelled properly and may keep running even after cancellation is requested.\n+\n+Since this small example does not need any `await` statements, we add an `await asyncio.sleep(0)` to give the event loop a chance to handle cancellation.\n+\n+///\n \n #### Using `StreamingResponse` with file-like objects { #using-streamingresponse-with-file-like-objects }\n \n\n```\n\n```diff\n@@ -1,3 +1,5 @@\n+import asyncio\n+\n from fastapi import FastAPI\n from fastapi.responses import StreamingResponse\n \n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)\n \n \n @app.get(\"/\")\n\n```\n\n```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0.1)\n\n```\n\n```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)  # simulate async work\n\n```\n\n```diff\n@@ -217,7 +217,17 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+In `asyncio`, a task can only be cancelled when it reaches an `await`.\n\n```", "output": "Code Review for: üìù Fix `StreamingResponse` code example\n\nüìù **docs_src/custom_response/tutorial007_py39.py**: ```suggestion\n        await asyncio.sleep(0)\n```\n\nüìù **docs_src/custom_response/tutorial007_py310.py**: ```suggestion\n        await asyncio.sleep(0)\n```\n\nüìù **docs/en/docs/advanced/custom-response.md**: Why only `asyncio`? I think it will be the same for `anyio` and other async frameworks.\r\n\r\n**UPD:** I see it was the same in my suggestion)\r\n\r\nLet's change it to something like\r\n```\r\nAsync task can only be cancelled when it reaches an `await`.\r\n```\n\n", "source": "pr", "type": "code_review", "pr_number": 139}
{"instruction": "Review this code change in `docs_src/custom_response/tutorial007_py39.py`", "input": "```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0.1)\n\n```", "output": "```suggestion\n        await asyncio.sleep(0)\n```", "source": "pr_review", "type": "inline_review", "pr_number": 139}
{"instruction": "Review this code change in `docs_src/custom_response/tutorial007_py310.py`", "input": "```diff\n@@ -7,6 +9,7 @@\n async def fake_video_streamer():\n     for i in range(10):\n         yield b\"some fake video bytes\"\n+        await asyncio.sleep(0)  # simulate async work\n\n```", "output": "```suggestion\n        await asyncio.sleep(0)\n```", "source": "pr_review", "type": "inline_review", "pr_number": 139}
{"instruction": "Review this code change in `docs/en/docs/advanced/custom-response.md`", "input": "```diff\n@@ -217,7 +217,17 @@ You can also use the `status_code` parameter combined with the `response_class`\n \n Takes an async generator or a normal generator/iterator and streams the response body.\n \n-{* ../../docs_src/custom_response/tutorial007_py310.py hl[2,14] *}\n+{* ../../docs_src/custom_response/tutorial007_py310.py hl[4,17] *}\n+\n+/// note\n+\n+In `asyncio`, a task can only be cancelled when it reaches an `await`.\n\n```", "output": "Why only `asyncio`? I think it will be the same for `anyio` and other async frameworks.\r\n\r\n**UPD:** I see it was the same in my suggestion)\r\n\r\nLet's change it to something like\r\n```\r\nAsync task can only be cancelled when it reaches an `await`.\r\n```", "source": "pr_review", "type": "inline_review", "pr_number": 139}
{"instruction": "Review the following code changes: docs: update pytest output example in Testing page", "input": "```diff\n@@ -178,9 +178,8 @@ Run the tests with:\n $ pytest\n \n ================ test session starts ================\n-platform linux -- Python 3.6.9, pytest-5.3.5, py-1.8.1, pluggy-0.13.1\n+platform linux -- Python 3.12.x, pytest-8.x.y, pluggy-1.x.y\n rootdir: /home/user/code/superawesome-cli/app\n-plugins: forked-1.1.3, xdist-1.31.0, cov-2.8.1\n collected 6 items\n \n ---> 100%\n\n```", "output": "Changes look good. This PR implements: docs: update pytest output example in Testing page", "source": "pr", "type": "code_review", "pr_number": 138}
{"instruction": "Fix the following bug: ‚úèÔ∏è Fix `client_password` typo in OAuth2 form docstrings", "input": "The `client_secret` parameter docstring in both `OAuth2PasswordRequestForm` and `OAuth2PasswordRequestFormStrict` incorrectly referred to `client_password` instead of `client_secret`.\n\nThe parameter itself is correctly named `client_secret`, and the rest of each docstring also uses `client_secret` ‚Äî it's just this one mention that had the wrong name.", "output": "```diff\n@@ -143,7 +143,7 @@ def __init__(\n             Form(json_schema_extra={\"format\": \"password\"}),\n             Doc(\n                 \"\"\"\n-                If there's a `client_password` (and a `client_id`), they can be sent\n+                If there's a `client_secret` (and a `client_id`), they can be sent\n                 as part of the form fields. But the OAuth2 specification recommends\n                 sending the `client_id` and `client_secret` (if any) using HTTP Basic\n                 auth.\n@@ -309,7 +309,7 @@ def __init__(\n             Form(),\n             Doc(\n                 \"\"\"\n-                If there's a `client_password` (and a `client_id`), they can be sent\n+                If there's a `client_secret` (and a `client_id`), they can be sent\n                 as part of the form fields. But the OAuth2 specification recommends\n                 sending the `client_id` and `client_secret` (if any) using HTTP Basic\n                 auth.\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 137}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -143,7 +143,7 @@ def __init__(\n             Form(json_schema_extra={\"format\": \"password\"}),\n             Doc(\n                 \"\"\"\n-                If there's a `client_password` (and a `client_id`), they can be sent\n+                If there's a `client_secret` (and a `client_id`), they can be sent\n                 as part of the form fields. But the OAuth2 specification recommends\n                 sending the `client_id` and `client_secret` (if any) using HTTP Basic\n                 auth.\n@@ -309,7 +309,7 @@ def __init__(\n             Form(),\n             Doc(\n                 \"\"\"\n-                If there's a `client_password` (and a `client_id`), they can be sent\n+                If there's a `client_secret` (and a `client_id`), they can be sent\n                 as part of the form fields. But the OAuth2 specification recommends\n                 sending the `client_id` and `client_secret` (if any) using HTTP Basic\n                 auth.\n\n```", "output": "Bug: ‚úèÔ∏è Fix `client_password` typo in OAuth2 form docstrings\n\nThe `client_secret` parameter docstring in both `OAuth2PasswordRequestForm` and `OAuth2PasswordRequestFormStrict` incorrectly referred to `client_password` instead of `client_secret`.\n\nThe parameter itself is correctly named `client_secret`, and the rest of each docstring also uses `client_secret` ‚Äî it's just this one mention that had the wrong name.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 137}
{"instruction": "Review the following code changes: ‚úèÔ∏è Fix `client_password` typo in OAuth2 form docstrings", "input": "```diff\n@@ -143,7 +143,7 @@ def __init__(\n             Form(json_schema_extra={\"format\": \"password\"}),\n             Doc(\n                 \"\"\"\n-                If there's a `client_password` (and a `client_id`), they can be sent\n+                If there's a `client_secret` (and a `client_id`), they can be sent\n                 as part of the form fields. But the OAuth2 specification recommends\n                 sending the `client_id` and `client_secret` (if any) using HTTP Basic\n                 auth.\n@@ -309,7 +309,7 @@ def __init__(\n             Form(),\n             Doc(\n                 \"\"\"\n-                If there's a `client_password` (and a `client_id`), they can be sent\n+                If there's a `client_secret` (and a `client_id`), they can be sent\n                 as part of the form fields. But the OAuth2 specification recommends\n                 sending the `client_id` and `client_secret` (if any) using HTTP Basic\n                 auth.\n\n```", "output": "Changes look good. This PR implements: ‚úèÔ∏è Fix `client_password` typo in OAuth2 form docstrings", "source": "pr", "type": "code_review", "pr_number": 137}
{"instruction": "Fix the following bug: üêõ Fix `get_model_fields` to support Annotated types", "input": "#14482 added the model_config to the ModelField to support arbitrary types, however the if statement did not check for all the correct types.\r\n\r\nThis PR brings the check inline with the internal pydantic TypeAdapter check which would throw an error in some cases, e.g. Union fields with single Values.", "output": "```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n from pydantic.fields import FieldInfo as FieldInfo\n from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n@@ -337,7 +337,7 @@ def create_body_model(\n def get_model_fields(model: type[BaseModel]) -> list[ModelField]:\n     model_fields: list[ModelField] = []\n     for name, field_info in model.model_fields.items():\n-        type_ = field_info.annotation\n+        type_ = annotated_type(field_info.annotation) or field_info.annotation\n         if lenient_issubclass(type_, (BaseModel, dict)) or is_dataclass(type_):\n             model_config = None\n         else:\n\n```\n\n```diff\n@@ -0,0 +1,88 @@\n+from typing import Annotated, Literal, Union\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client():\n+    from pydantic import BaseModel, Field, RootModel\n+\n+    class Base(BaseModel):\n+        type: Literal[\"BASE\"] = \"BASE\"\n+        value: str\n+\n+    class MyModel(RootModel[Annotated[Union[Base], Field(discriminator=\"type\")]]):\n+        pass\n+\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def test() -> MyModel:\n+        return MyModel.model_validate(Base(value=\"test\"))\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+def test_get(client: TestClient):\n+    response = client.get(\"/\")\n+    assert response.json() == {\"value\": \"test\", \"type\": \"BASE\"}\n+\n+\n+def test_openapi_schema(client: TestClient):\n+    response = client.get(\"openapi.json\")\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"get\": {\n+                        \"summary\": \"Test\",\n+                        \"operationId\": \"test__get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/MyModel\"\n+                                        }\n+                                    }\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+                    \"Base\": {\n+                        \"properties\": {\n+                            \"type\": {\n+                                \"type\": \"string\",\n+                                \"const\": \"BASE\",\n+                                \"title\": \"Type\",\n+                                \"default\": \"BASE\",\n+                            },\n+                            \"value\": {\"type\": \"string\", \"title\": \"Value\"},\n+                        },\n+                        \"type\": \"object\",\n+                        \"required\": [\"value\"],\n+                        \"title\": \"Base\",\n+                    },\n+                    \"MyModel\": {\n+                        \"oneOf\": [{\"$ref\": \"#/components/schemas/Base\"}],\n+                        \"title\": \"MyModel\",\n+                        \"discriminator\": {\n+                            \"propertyName\": \"type\",\n+                            \"mapping\": {\"BASE\": \"#/components/schemas/Base\"},\n+                        },\n+                    },\n+                }\n+            },\n+        }\n+    )\n\n```\n\n```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n\n```\n\n```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 136}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n from pydantic.fields import FieldInfo as FieldInfo\n from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n@@ -337,7 +337,7 @@ def create_body_model(\n def get_model_fields(model: type[BaseModel]) -> list[ModelField]:\n     model_fields: list[ModelField] = []\n     for name, field_info in model.model_fields.items():\n-        type_ = field_info.annotation\n+        type_ = annotated_type(field_info.annotation) or field_info.annotation\n         if lenient_issubclass(type_, (BaseModel, dict)) or is_dataclass(type_):\n             model_config = None\n         else:\n\n```\n\n```diff\n@@ -0,0 +1,88 @@\n+from typing import Annotated, Literal, Union\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client():\n+    from pydantic import BaseModel, Field, RootModel\n+\n+    class Base(BaseModel):\n+        type: Literal[\"BASE\"] = \"BASE\"\n+        value: str\n+\n+    class MyModel(RootModel[Annotated[Union[Base], Field(discriminator=\"type\")]]):\n+        pass\n+\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def test() -> MyModel:\n+        return MyModel.model_validate(Base(value=\"test\"))\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+def test_get(client: TestClient):\n+    response = client.get(\"/\")\n+    assert response.json() == {\"value\": \"test\", \"type\": \"BASE\"}\n+\n+\n+def test_openapi_schema(client: TestClient):\n+    response = client.get(\"openapi.json\")\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"get\": {\n+                        \"summary\": \"Test\",\n+                        \"operationId\": \"test__get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/MyModel\"\n+                                        }\n+                                    }\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+                    \"Base\": {\n+                        \"properties\": {\n+                            \"type\": {\n+                                \"type\": \"string\",\n+                                \"const\": \"BASE\",\n+                                \"title\": \"Type\",\n+                                \"default\": \"BASE\",\n+                            },\n+                            \"value\": {\"type\": \"string\", \"title\": \"Value\"},\n+                        },\n+                        \"type\": \"object\",\n+                        \"required\": [\"value\"],\n+                        \"title\": \"Base\",\n+                    },\n+                    \"MyModel\": {\n+                        \"oneOf\": [{\"$ref\": \"#/components/schemas/Base\"}],\n+                        \"title\": \"MyModel\",\n+                        \"discriminator\": {\n+                            \"propertyName\": \"type\",\n+                            \"mapping\": {\"BASE\": \"#/components/schemas/Base\"},\n+                        },\n+                    },\n+                }\n+            },\n+        }\n+    )\n\n```\n\n```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_gener", "output": "Bug: üêõ Fix `get_model_fields` to support Annotated types\n\n#14482 added the model_config to the ModelField to support arbitrary types, however the if statement did not check for all the correct types.\r\n\r\nThis PR brings the check inline with the internal pydantic TypeAdapter check which would throw an error in some cases, e.g. Union fields with single Values.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 136}
{"instruction": "Review the following code changes: üêõ Fix `get_model_fields` to support Annotated types", "input": "```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n from pydantic.fields import FieldInfo as FieldInfo\n from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n@@ -337,7 +337,7 @@ def create_body_model(\n def get_model_fields(model: type[BaseModel]) -> list[ModelField]:\n     model_fields: list[ModelField] = []\n     for name, field_info in model.model_fields.items():\n-        type_ = field_info.annotation\n+        type_ = annotated_type(field_info.annotation) or field_info.annotation\n         if lenient_issubclass(type_, (BaseModel, dict)) or is_dataclass(type_):\n             model_config = None\n         else:\n\n```\n\n```diff\n@@ -0,0 +1,88 @@\n+from typing import Annotated, Literal, Union\n+\n+import pytest\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+\n+\n+@pytest.fixture(name=\"client\")\n+def get_client():\n+    from pydantic import BaseModel, Field, RootModel\n+\n+    class Base(BaseModel):\n+        type: Literal[\"BASE\"] = \"BASE\"\n+        value: str\n+\n+    class MyModel(RootModel[Annotated[Union[Base], Field(discriminator=\"type\")]]):\n+        pass\n+\n+    app = FastAPI()\n+\n+    @app.get(\"/\")\n+    def test() -> MyModel:\n+        return MyModel.model_validate(Base(value=\"test\"))\n+\n+    client = TestClient(app)\n+    return client\n+\n+\n+def test_get(client: TestClient):\n+    response = client.get(\"/\")\n+    assert response.json() == {\"value\": \"test\", \"type\": \"BASE\"}\n+\n+\n+def test_openapi_schema(client: TestClient):\n+    response = client.get(\"openapi.json\")\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/\": {\n+                    \"get\": {\n+                        \"summary\": \"Test\",\n+                        \"operationId\": \"test__get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"application/json\": {\n+                                        \"schema\": {\n+                                            \"$ref\": \"#/components/schemas/MyModel\"\n+                                        }\n+                                    }\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+            \"components\": {\n+                \"schemas\": {\n+                    \"Base\": {\n+                        \"properties\": {\n+                            \"type\": {\n+                                \"type\": \"string\",\n+                                \"const\": \"BASE\",\n+                                \"title\": \"Type\",\n+                                \"default\": \"BASE\",\n+                            },\n+                            \"value\": {\"type\": \"string\", \"title\": \"Value\"},\n+                        },\n+                        \"type\": \"object\",\n+                        \"required\": [\"value\"],\n+                        \"title\": \"Base\",\n+                    },\n+                    \"MyModel\": {\n+                        \"oneOf\": [{\"$ref\": \"#/components/schemas/Base\"}],\n+                        \"title\": \"MyModel\",\n+                        \"discriminator\": {\n+                            \"propertyName\": \"type\",\n+                            \"mapping\": {\"BASE\": \"#/components/schemas/Base\"},\n+                        },\n+                    },\n+                }\n+            },\n+        }\n+    )\n\n```\n\n```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n\n```\n\n```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n\n```", "output": "Code Review for: üêõ Fix `get_model_fields` to support Annotated types\n\nüìù **fastapi/_compat/v2.py**: Would be great if FastAPI did not rely on more Pydantic internals than it does currently. `eval_type_lenient` is a clear example, I had to \"soft-deprecate\" it (i.e. only wrap it around `@typing_extensions.deprecated` without raising any runtime warning) solely because FastAPI was using it. `annotated_type` might be deleted at any point (and in fact has a good chance of being removed at some point).\r\n\r\nThis can easily be implemented directly in FastAPI.\n\nüìù **fastapi/_compat/v2.py**: @Viicos Good point, but in general this is a weird set of circumstances in the first place.\r\nSince this entire code\r\n\r\n```python\r\n        type_ = annotated_type(field_info.annotation) or field_info.annotation\r\n        if lenient_issubclass(type_, (BaseModel, dict)) or is_dataclass(type_):\r\n            model_config = None\r\n        else:\r\n            model_config = model.model_config\r\n```\r\n\r\nis just a duplication of this pydantic internal function anyway \r\n\r\n```python\r\ndef _type_has_config(type_: Any) -> bool:\r\n    \"\"\"Returns whether the type has config.\"\"\"\r\n    type_ = _typing_extra.annotated_type(type_) or type_\r\n    try:\r\n        return issubclass(type_, BaseModel) or is_dataclass(type_) or is_typeddict(type_)\r\n    except TypeError:\r\n        # type is not a class\r\n        return False\r\n```\r\n\r\nsince otherwise the pydantic TypeAdapter raises an error. So i guess we could just copy this function to fastapi but then when Pydantic decides to remove the function and in the process maybe change the check in the TypeAdapter the two checks are out of sync again just waiting for a new bug to be introduced.\r\n\r\ni think depending directly on the internal pydantic function will make it clear that this code needs to be looked at again if the pydantic function is removed and ported to the new pydantic way of handling it. \n\n", "source": "pr", "type": "code_review", "pr_number": 136}
{"instruction": "Review this code change in `fastapi/_compat/v2.py`", "input": "```diff\n@@ -22,7 +22,7 @@\n from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]\n     GetJsonSchemaHandler as GetJsonSchemaHandler,\n )\n-from pydantic._internal._typing_extra import eval_type_lenient\n+from pydantic._internal._typing_extra import annotated_type, eval_type_lenient\n\n```", "output": "Would be great if FastAPI did not rely on more Pydantic internals than it does currently. `eval_type_lenient` is a clear example, I had to \"soft-deprecate\" it (i.e. only wrap it around `@typing_extensions.deprecated` without raising any runtime warning) solely because FastAPI was using it. `annotated_type` might be deleted at any point (and in fact has a good chance of being removed at some point).\r\n\r\nThis can easily be implemented directly in FastAPI.", "source": "pr_review", "type": "inline_review", "pr_number": 136}
{"instruction": "Review the following code changes: Clarify usage of middleware for X-Request-ID request tracing", "input": "```diff\n@@ -59,6 +59,9 @@ For example, you could add a custom header `X-Process-Time` containing the time\n \n {* ../../docs_src/middleware/tutorial001_py310.py hl[10,12:13] *}\n \n+Middleware can also be used to add request tracing headers such as `X-Request-ID`. This is commonly used in production systems to uniquely identify and track requests across multiple services for debugging and observability.\n+\n+\n /// tip\n \n Here we use <a href=\"https://docs.python.org/3/library/time.html#time.perf_counter\" class=\"external-link\" target=\"_blank\">`time.perf_counter()`</a> instead of `time.time()` because it can be more precise for these use cases. ü§ì\n\n```", "output": "Changes look good. This PR implements: Clarify usage of middleware for X-Request-ID request tracing", "source": "pr", "type": "code_review", "pr_number": 135}
{"instruction": "Review the following code changes: üë∑ Always run tests on push to `master` branch and when run by scheduler", "input": "```diff\n@@ -45,7 +45,7 @@ jobs:\n   test:\n     needs:\n       - changes\n-    if: needs.changes.outputs.src == 'true'\n+    if: needs.changes.outputs.src == 'true' || github.ref == 'refs/heads/master'\n     strategy:\n       matrix:\n         os: [ windows-latest, macos-latest ]\n\n```\n\n```diff\n@@ -45,7 +45,10 @@ jobs:\n   test:\n     needs:\n       - changes\n-    if: needs.changes.outputs.src == 'true'\n+    if: |\n+      needs.changes.outputs.src == 'true' ||\n+      github.event_name == 'schedule' ||\n+      (github.event_name == 'push' && github.ref == 'refs/heads/master')\n\n```", "output": "Code Review for: üë∑ Always run tests on push to `master` branch and when run by scheduler\n\nüìù **.github/workflows/test.yml**: Or just:\r\n\r\n```suggestion\r\n    if: needs.changes.outputs.src == 'true' || github.ref == 'refs/heads/master'\r\n```\r\n?\n\n", "source": "pr", "type": "code_review", "pr_number": 134}
{"instruction": "Review this code change in `.github/workflows/test.yml`", "input": "```diff\n@@ -45,7 +45,10 @@ jobs:\n   test:\n     needs:\n       - changes\n-    if: needs.changes.outputs.src == 'true'\n+    if: |\n+      needs.changes.outputs.src == 'true' ||\n+      github.event_name == 'schedule' ||\n+      (github.event_name == 'push' && github.ref == 'refs/heads/master')\n\n```", "output": "Or just:\r\n\r\n```suggestion\r\n    if: needs.changes.outputs.src == 'true' || github.ref == 'refs/heads/master'\r\n```\r\n?", "source": "pr_review", "type": "inline_review", "pr_number": 134}
{"instruction": "Review the following code changes: ‚¨Ü Bump werkzeug from 3.1.5 to 3.1.6", "input": "```diff\n@@ -5982,14 +5982,14 @@ wheels = [\n \n [[package]]\n name = \"werkzeug\"\n-version = \"3.1.5\"\n+version = \"3.1.6\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"markupsafe\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/5a/70/1469ef1d3542ae7c2c7b72bd5e3a4e6ee69d7978fa8a3af05a38eca5becf/werkzeug-3.1.5.tar.gz\", hash = \"sha256:6a548b0e88955dd07ccb25539d7d0cc97417ee9e179677d22c7041c8f078ce67\", size = 864754, upload-time = \"2026-01-08T17:49:23.247Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/61/f1/ee81806690a87dab5f5653c1f146c92bc066d7f4cebc603ef88eb9e13957/werkzeug-3.1.6.tar.gz\", hash = \"sha256:210c6bede5a420a913956b4791a7f4d6843a43b6fcee4dfa08a65e93007d0d25\", size = 864736, upload-time = \"2026-02-19T15:17:18.884Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/ad/e4/8d97cca767bcc1be76d16fb76951608305561c6e056811587f36cb1316a8/werkzeug-3.1.5-py3-none-any.whl\", hash = \"sha256:5111e36e91086ece91f93268bb39b4a35c1e6f1feac762c9c822ded0a4e322dc\", size = 225025, upload-time = \"2026-01-08T17:49:21.859Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/4d/ec/d58832f89ede95652fd01f4f24236af7d32b70cab2196dfcc2d2fd13c5c2/werkzeug-3.1.6-py3-none-any.whl\", hash = \"sha256:7ddf3357bb9564e407607f988f683d72038551200c704012bb9a4c523d42f131\", size = 225166, upload-time = \"2026-02-19T15:17:17.475Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump werkzeug from 3.1.5 to 3.1.6", "source": "pr", "type": "code_review", "pr_number": 133}
{"instruction": "Review the following code changes: ‚¨Ü Bump flask from 3.1.2 to 3.1.3", "input": "```diff\n@@ -1595,7 +1595,7 @@ wheels = [\n \n [[package]]\n name = \"flask\"\n-version = \"3.1.2\"\n+version = \"3.1.3\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"blinker\" },\n@@ -1605,9 +1605,9 @@ dependencies = [\n     { name = \"markupsafe\" },\n     { name = \"werkzeug\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/dc/6d/cfe3c0fcc5e477df242b98bfe186a4c34357b4847e87ecaef04507332dab/flask-3.1.2.tar.gz\", hash = \"sha256:bf656c15c80190ed628ad08cdfd3aaa35beb087855e2f494910aa3774cc4fd87\", size = 720160, upload-time = \"2025-08-19T21:03:21.205Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/26/00/35d85dcce6c57fdc871f3867d465d780f302a175ea360f62533f12b27e2b/flask-3.1.3.tar.gz\", hash = \"sha256:0ef0e52b8a9cd932855379197dd8f94047b359ca0a78695144304cb45f87c9eb\", size = 759004, upload-time = \"2026-02-19T05:00:57.678Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/ec/f9/7f9263c5695f4bd0023734af91bedb2ff8209e8de6ead162f35d8dc762fd/flask-3.1.2-py3-none-any.whl\", hash = \"sha256:ca1d8112ec8a6158cc29ea4858963350011b5c846a414cdb7a954aa9e967d03c\", size = 103308, upload-time = \"2025-08-19T21:03:19.499Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/7f/9c/34f6962f9b9e9c71f6e5ed806e0d0ff03c9d1b0b2340088a0cf4bce09b18/flask-3.1.3-py3-none-any.whl\", hash = \"sha256:f4bcbefc124291925f1a26446da31a5178f9483862233b23c0c96a20701f670c\", size = 103424, upload-time = \"2026-02-19T05:00:56.027Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨Ü Bump flask from 3.1.2 to 3.1.3", "source": "pr", "type": "code_review", "pr_number": 132}
{"instruction": "Fix the following bug: üî® Fix `FastAPI People` workflow", "input": "Currently `FastAPI People` workflow fails due to hitting GitHub API rate limits.\r\n\r\nAfter some experiments and googling I found out that the reason of hitting rate limits is in requests per query.\r\nSince September rate limit rules became more complex and it's not recommended to make heavy queries (that return thousands of records).\r\n\r\nTo avoid hitting rate limits I:\r\n* reduced the number of records fetched by query (30 discussions instead of 100)\r\n* added a rate limiter that respects different types of limits:\r\n  * pauses if the number of remaining points is less than needed for request\r\n  * respects safe time intervals between requests (interval time is calculated from the limitation of 5000 points per hour and the number of points used by each request)\r\n\r\nThis way script will take more time to fetch data, but we will likely avoid hitting rate limits\r\n\r\n---\r\n\r\nIf we need it, we can experiment with the speed by setting `speed_multiplier` ENV variable (defaults to 1, that is the spread with which we will spend 84 points per minute (5000 points per hour divided by 60 minutes)).", "output": "```diff\n@@ -5,6 +5,7 @@\n from collections import Counter\n from collections.abc import Container\n from datetime import datetime, timedelta, timezone\n+from math import ceil\n from pathlib import Path\n from typing import Any\n \n@@ -15,12 +16,66 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n+\n+\n+POINTS_PER_MINUTE_LIMIT = 84  # 5000 points per hour\n+\n+\n+class RateLimiter:\n+    def __init__(self) -> None:\n+        self.last_query_cost: int = 1\n+        self.remaining_points: int = 5000\n+        self.reset_at: datetime = datetime.fromtimestamp(0, timezone.utc)\n+        self.last_request_start_time: datetime = datetime.fromtimestamp(0, timezone.utc)\n+        self.speed_multiplier: float = 1.0\n+\n+    def __enter__(self) -> \"RateLimiter\":\n+        now = datetime.now(tz=timezone.utc)\n+\n+        # Handle primary rate limits\n+        primary_limit_wait_time = 0.0\n+        if self.remaining_points <= self.last_query_cost:\n+            primary_limit_wait_time = (self.reset_at - now).total_seconds() + 2\n+            logging.warning(\n+                f\"Approaching GitHub API rate limit, remaining points: {self.remaining_points}, \"\n+                f\"reset time in {primary_limit_wait_time} seconds\"\n+            )\n+\n+        # Handle secondary rate limits\n+        secondary_limit_wait_time = 0.0\n+        points_per_minute = POINTS_PER_MINUTE_LIMIT * self.speed_multiplier\n+        interval = 60 / (points_per_minute / self.last_query_cost)\n+        time_since_last_request = (now - self.last_request_start_time).total_seconds()\n+        if time_since_last_request < interval:\n+            secondary_limit_wait_time = interval - time_since_last_request\n+\n+        final_wait_time = ceil(max(primary_limit_wait_time, secondary_limit_wait_time))\n+        logging.info(f\"Sleeping for {final_wait_time} seconds to respect rate limit\")\n+        time.sleep(final_wait_time)\n+\n+        self.last_request_start_time = datetime.now(tz=timezone.utc)\n+        return self\n+\n+    def __exit__(self, exc_type, exc_val, exc_tb) -> None:\n+        pass\n+\n+    def update_request_info(self, cost: int, remaining: int, reset_at: str) -> None:\n+        self.last_query_cost = cost\n+        self.remaining_points = remaining\n+        self.reset_at = datetime.fromisoformat(reset_at.replace(\"Z\", \"+00:00\"))\n+        logging.info(\n+            f\"remaining points: {self.remaining_points}, reset at: {self.reset_at.isoformat()}\"\n+        )\n+\n+\n+rate_limiter = RateLimiter()\n+\n \n discussions_query = \"\"\"\n query Q($after: String, $category_id: ID) {\n   repository(name: \"fastapi\", owner: \"fastapi\") {\n-    discussions(first: 100, after: $after, categoryId: $category_id) {\n+    discussions(first: 30, after: $after, categoryId: $category_id) {\n       edges {\n         cursor\n         node {\n@@ -58,6 +113,11 @@\n       }\n     }\n   }\n+  rateLimit {\n+    cost\n+ \n\n```\n\n```diff\n@@ -15,12 +16,64 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 131}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -5,6 +5,7 @@\n from collections import Counter\n from collections.abc import Container\n from datetime import datetime, timedelta, timezone\n+from math import ceil\n from pathlib import Path\n from typing import Any\n \n@@ -15,12 +16,66 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n+\n+\n+POINTS_PER_MINUTE_LIMIT = 84  # 5000 points per hour\n+\n+\n+class RateLimiter:\n+    def __init__(self) -> None:\n+        self.last_query_cost: int = 1\n+        self.remaining_points: int = 5000\n+        self.reset_at: datetime = datetime.fromtimestamp(0, timezone.utc)\n+        self.last_request_start_time: datetime = datetime.fromtimestamp(0, timezone.utc)\n+        self.speed_multiplier: float = 1.0\n+\n+    def __enter__(self) -> \"RateLimiter\":\n+        now = datetime.now(tz=timezone.utc)\n+\n+        # Handle primary rate limits\n+        primary_limit_wait_time = 0.0\n+        if self.remaining_points <= self.last_query_cost:\n+            primary_limit_wait_time = (self.reset_at - now).total_seconds() + 2\n+            logging.warning(\n+                f\"Approaching GitHub API rate limit, remaining points: {self.remaining_points}, \"\n+                f\"reset time in {primary_limit_wait_time} seconds\"\n+            )\n+\n+        # Handle secondary rate limits\n+        secondary_limit_wait_time = 0.0\n+        points_per_minute = POINTS_PER_MINUTE_LIMIT * self.speed_multiplier\n+        interval = 60 / (points_per_minute / self.last_query_cost)\n+        time_since_last_request = (now - self.last_request_start_time).total_seconds()\n+        if time_since_last_request < interval:\n+            secondary_limit_wait_time = interval - time_since_last_request\n+\n+        final_wait_time = ceil(max(primary_limit_wait_time, secondary_limit_wait_time))\n+        logging.info(f\"Sleeping for {final_wait_time} seconds to respect rate limit\")\n+        time.sleep(final_wait_time)\n+\n+        self.last_request_start_time = datetime.now(tz=timezone.utc)\n+        return self\n+\n+    def __exit__(self, exc_type, exc_val, exc_tb) -> None:\n+        pass\n+\n+    def update_request_info(self, cost: int, remaining: int, reset_at: str) -> None:\n+        self.last_query_cost = cost\n+        self.remaining_points = remaining\n+        self.reset_at = datetime.fromisoformat(reset_at.replace(\"Z\", \"+00:00\"))\n+        logging.info(\n+            f\"remaining points: {self.remaining_points}, reset at: {self.reset_at.isoformat()}\"\n+        )\n+\n+\n+rate_limiter = RateLimiter()\n+\n \n discussions_query = \"\"\"\n query Q($after: String, $category_id: ID) {\n   repository(name: \"fastapi\", owner: \"fastapi\") {\n-    discussions(first: 100, after: $after, categoryId: $category_id) {\n+    discussions(first: 30, after: $after, categoryId: $category_id) {\n       edges {\n         cursor\n         node {\n@@ -58,6 +113,11 @@\n       }\n     }\n   }\n+  rateLimit {\n+    cost\n+ \n\n```\n\n```diff\n@@ -15,12 +16,64 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n\n```", "output": "Bug: üî® Fix `FastAPI People` workflow\n\nCurrently `FastAPI People` workflow fails due to hitting GitHub API rate limits.\r\n\r\nAfter some experiments and googling I found out that the reason of hitting rate limits is in requests per query.\r\nSince September rate limit rules became more complex and it's not recommended to make heavy queries (that return thousands of records).\r\n\r\nTo avoid hitting rate limits I:\r\n* reduced the number of records fetched by query (30 discussions instead of 100)\r\n* added a rate limiter that respects different types of limits:\r\n  * pauses if the number of remaining points is less than needed for request\r\n  * respects safe time intervals between requests (interval time is calculated from the limitation of 5000 points per hour and the number of points used by each request)\r\n\r\nThis way script will take more time to fetch data, but we will likely avoid hitting rate limits\r\n\r\n---\r\n\r\nIf we need it, we can experiment with the speed by setting `speed_multiplier` ENV variable (defaults to 1, that is the spread with which we will spend 84 points per minute (5000 points per hour divided by 60 minutes)).", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 131}
{"instruction": "Review the following code changes: üî® Fix `FastAPI People` workflow", "input": "```diff\n@@ -5,6 +5,7 @@\n from collections import Counter\n from collections.abc import Container\n from datetime import datetime, timedelta, timezone\n+from math import ceil\n from pathlib import Path\n from typing import Any\n \n@@ -15,12 +16,66 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n+\n+\n+POINTS_PER_MINUTE_LIMIT = 84  # 5000 points per hour\n+\n+\n+class RateLimiter:\n+    def __init__(self) -> None:\n+        self.last_query_cost: int = 1\n+        self.remaining_points: int = 5000\n+        self.reset_at: datetime = datetime.fromtimestamp(0, timezone.utc)\n+        self.last_request_start_time: datetime = datetime.fromtimestamp(0, timezone.utc)\n+        self.speed_multiplier: float = 1.0\n+\n+    def __enter__(self) -> \"RateLimiter\":\n+        now = datetime.now(tz=timezone.utc)\n+\n+        # Handle primary rate limits\n+        primary_limit_wait_time = 0.0\n+        if self.remaining_points <= self.last_query_cost:\n+            primary_limit_wait_time = (self.reset_at - now).total_seconds() + 2\n+            logging.warning(\n+                f\"Approaching GitHub API rate limit, remaining points: {self.remaining_points}, \"\n+                f\"reset time in {primary_limit_wait_time} seconds\"\n+            )\n+\n+        # Handle secondary rate limits\n+        secondary_limit_wait_time = 0.0\n+        points_per_minute = POINTS_PER_MINUTE_LIMIT * self.speed_multiplier\n+        interval = 60 / (points_per_minute / self.last_query_cost)\n+        time_since_last_request = (now - self.last_request_start_time).total_seconds()\n+        if time_since_last_request < interval:\n+            secondary_limit_wait_time = interval - time_since_last_request\n+\n+        final_wait_time = ceil(max(primary_limit_wait_time, secondary_limit_wait_time))\n+        logging.info(f\"Sleeping for {final_wait_time} seconds to respect rate limit\")\n+        time.sleep(final_wait_time)\n+\n+        self.last_request_start_time = datetime.now(tz=timezone.utc)\n+        return self\n+\n+    def __exit__(self, exc_type, exc_val, exc_tb) -> None:\n+        pass\n+\n+    def update_request_info(self, cost: int, remaining: int, reset_at: str) -> None:\n+        self.last_query_cost = cost\n+        self.remaining_points = remaining\n+        self.reset_at = datetime.fromisoformat(reset_at.replace(\"Z\", \"+00:00\"))\n+        logging.info(\n+            f\"remaining points: {self.remaining_points}, reset at: {self.reset_at.isoformat()}\"\n+        )\n+\n+\n+rate_limiter = RateLimiter()\n+\n \n discussions_query = \"\"\"\n query Q($after: String, $category_id: ID) {\n   repository(name: \"fastapi\", owner: \"fastapi\") {\n-    discussions(first: 100, after: $after, categoryId: $category_id) {\n+    discussions(first: 30, after: $after, categoryId: $category_id) {\n       edges {\n         cursor\n         node {\n@@ -58,6 +113,11 @@\n       }\n     }\n   }\n+  rateLimit {\n+    cost\n+ \n\n```\n\n```diff\n@@ -15,12 +16,64 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n\n```", "output": "Code Review for: üî® Fix `FastAPI People` workflow\n\nüìù **scripts/people.py**: Old value is \"global id\" and it's deprecated (produced deprecation warning with the recommendation to use this new ID)\n\n", "source": "pr", "type": "code_review", "pr_number": 131}
{"instruction": "Review this code change in `scripts/people.py`", "input": "```diff\n@@ -15,12 +16,64 @@\n from pydantic_settings import BaseSettings\n \n github_graphql_url = \"https://api.github.com/graphql\"\n-questions_category_id = \"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMyMDAxNDM0\"\n+questions_category_id = \"DIC_kwDOCZduT84B6E2a\"\n\n```", "output": "Old value is \"global id\" and it's deprecated (produced deprecation warning with the recommendation to use this new ID)", "source": "pr_review", "type": "inline_review", "pr_number": 131}
{"instruction": "Review the following code changes: Add regression test for Annotated + ForwardRef OpenAPI ( #13056 )", "input": "```diff\n@@ -0,0 +1,29 @@\n+from typing import Annotated, Union\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from pydantic import BaseModel\n+\n+app = FastAPI()\n+\n+\n+class Item(BaseModel):\n+    name: str\n+    # This is the ForwardRef issue context\n+    next_item: Annotated[Union[\"Item\", None], None] = None\n+\n+\n+@app.get(\"/\", response_model=Item)\n+def read_root():\n+    return Item(name=\"root\")\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_issue_13056_openapi_annotated_forwardref():\n+    # This triggers the schema generation where the crash usually happens\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    data = response.json()\n+    assert data[\"components\"][\"schemas\"][\"Item\"]\n\n```", "output": "Changes look good. This PR implements: Add regression test for Annotated + ForwardRef OpenAPI ( #13056 )", "source": "pr", "type": "code_review", "pr_number": 130}
{"instruction": "Review the following code changes: Clarify usage of --reload flag in Docker environments", "input": "```diff\n@@ -66,10 +66,10 @@ For example, there's an official <a href=\"https://hub.docker.com/_/python\" class\n \n And there are many other images for different things like databases, for example for:\n \n-* <a href=\"https://hub.docker.com/_/postgres\" class=\"external-link\" target=\"_blank\">PostgreSQL</a>\n-* <a href=\"https://hub.docker.com/_/mysql\" class=\"external-link\" target=\"_blank\">MySQL</a>\n-* <a href=\"https://hub.docker.com/_/mongo\" class=\"external-link\" target=\"_blank\">MongoDB</a>\n-* <a href=\"https://hub.docker.com/_/redis\" class=\"external-link\" target=\"_blank\">Redis</a>, etc.\n+- <a href=\"https://hub.docker.com/_/postgres\" class=\"external-link\" target=\"_blank\">PostgreSQL</a>\n+- <a href=\"https://hub.docker.com/_/mysql\" class=\"external-link\" target=\"_blank\">MySQL</a>\n+- <a href=\"https://hub.docker.com/_/mongo\" class=\"external-link\" target=\"_blank\">MongoDB</a>\n+- <a href=\"https://hub.docker.com/_/redis\" class=\"external-link\" target=\"_blank\">Redis</a>, etc.\n \n By using a pre-made container image it's very easy to **combine** and use different tools. For example, to try out a new database. In most cases, you can use the **official images**, and just configure them with environment variables.\n \n@@ -99,9 +99,9 @@ I'll show you how to build a **Docker image** for FastAPI **from scratch**, base\n \n This is what you would want to do in **most cases**, for example:\n \n-* Using **Kubernetes** or similar tools\n-* When running on a **Raspberry Pi**\n-* Using a cloud service that would run a container image for you, etc.\n+- Using **Kubernetes** or similar tools\n+- When running on a **Raspberry Pi**\n+- Using a cloud service that would run a container image for you, etc.\n \n ### Package Requirements { #package-requirements }\n \n@@ -111,7 +111,7 @@ It would depend mainly on the tool you use to **install** those requirements.\n \n The most common way to do it is to have a file `requirements.txt` with the package names and their versions, one per line.\n \n-You would of course use the same ideas you read in [About FastAPI versions](versions.md){.internal-link target=_blank} to set the ranges of versions.\n+You would of course use the same ideas you read in [About FastAPI versions](versions.md){.internal-link target=\\_blank} to set the ranges of versions.\n \n For example, your `requirements.txt` could look like:\n \n@@ -140,9 +140,9 @@ There are other formats and tools to define and install package dependencies.\n \n ### Create the **FastAPI** Code { #create-the-fastapi-code }\n \n-* Create an `app` directory and enter it.\n-* Create an empty file `__init__.py`.\n-* Create a `main.py` file with:\n+- Create an `app` directory and enter it.\n+- Create an empty file `__init__.py`.\n+- Create a `main.py` file with:\n \n \n```", "output": "Changes look good. This PR implements: Clarify usage of --reload flag in Docker environments", "source": "pr", "type": "code_review", "pr_number": 129}
{"instruction": "Review the following code changes: ci: add explicit least-privilege permissions to project workflows", "input": "```diff\n@@ -7,6 +7,8 @@ on:\n       - opened\n       - reopened\n \n+permissions: {}\n+\n jobs:\n   add-to-project:\n     name: Add to project\n\n```\n\n```diff\n@@ -16,6 +16,10 @@ on:\n         required: false\n         default: 'false'\n \n+permissions:\n+  contents: write\n+  pull-requests: read\n+\n jobs:\n   latest-changes:\n     runs-on: ubuntu-latest\n\n```\n\n```diff\n@@ -9,6 +9,9 @@ on:\n       - opened\n       - synchronize\n \n+permissions:\n+  contents: read\n+\n jobs:\n   test-redistribute:\n     runs-on: ubuntu-latest\n\n```", "output": "Changes look good. This PR implements: ci: add explicit least-privilege permissions to project workflows", "source": "pr", "type": "code_review", "pr_number": 128}
{"instruction": "Fix the following bug: ‚ôªÔ∏è Fix JSON Schema for bytes, use `\"contentMediaType\": \"application/octet-stream\"` instead of `\"format\": \"binary\"`", "input": "‚ôªÔ∏è Fix JSON Schema for bytes, use `\"contentMediaType\": \"application/octet-stream\"` instead of `\"format\": \"binary\"`\r\n\r\n## Background\r\n\r\n`format: binary` was defined in OpenAPI 3.0.x, in OpenAPI 3.1.x the schema was aligned with the latest JSON Schema, recommending instead `contentMediaType: application/octet-stream`.\r\n\r\nI suspect the JSON Schema for `bytes` using `\"format\": \"binary\"` comes from my first implementation in Pydantic 1.x.\r\n\r\nIt was defined and suggested in OpenAPI 3.0.x (not in JSON Schema): https://spec.openapis.org/oas/v3.0.3.html#considerations-for-file-uploads\r\n\r\nOpenAPI 3.1.x aligned support with JSON Schema draft 07, so it was suggested to upate file uploads to use the regular JSON Schema format: `\"contentMediaType\": \"application/octet-stream\"`: https://learn.openapis.org/upgrading/v3.0-to-v3.1\r\n\r\nThis is defined in JSON Schema 07: https://json-schema.org/draft-07/json-schema-validation#rfc.section.8.4\r\n\r\n### JSON Schema 2020-12 Note\r\n\r\nNow OpenAPI 3.2 is aligned with JSON Schema 2020-12, which is what Pydantic v2 implements (except for this, I'm implementing it there too).\r\n\r\nIt's the same as in JSON Schema draft 07, so this still applies: https://json-schema.org/draft/2020-12/draft-bhutton-json-schema-validation-01#name-contentmediatype\r\n\r\n### Usage in JSON\r\n\r\nJSON as a format actually doesn't support bytes, everything has to be in UTF-8 strings. Transporting bytes in JSON would require encoding bytes in a string, e.g. with base64.\r\n\r\nBut as JSON Schema is not only defined to declare JSON payloads but also payloads that could have a comparable structure and defined with JSON Schema, it's still there in the spec.", "output": "```diff\n@@ -0,0 +1,63 @@\n+# JSON with Bytes as Base64 { #json-with-bytes-as-base64 }\n+\n+If your app needs to receive and send JSON data, but you need to include binary data in it, you can encode it as base64.\n+\n+## Base64 vs Files { #base64-vs-files }\n+\n+Consider first if you can use [Request Files](../tutorial/request-files.md){.internal-link target=_blank} for uploading binary data and [Custom Response - FileResponse](./custom-response.md#fileresponse--fileresponse-){.internal-link target=_blank} for sending binary data, instead of encoding it in JSON.\n+\n+JSON can only contain UTF-8 encoded strings, so it can't contain raw bytes.\n+\n+Base64 can encode binary data in strings, but to do it, it needs to use more characters than the original binary data, so it would normally be less efficient than regular files.\n+\n+Use base64 only if you definitely need to include binary data in JSON, and you can't use files for that.\n+\n+## Pydantic `bytes` { #pydantic-bytes }\n+\n+You can declare a Pydantic model with `bytes` fields, and then use `val_json_bytes` in the model config to tell it to use base64 to *validate* input JSON data, as part of that validation it will decode the base64 string into bytes.\n+\n+{* ../../docs_src/json_base64_bytes/tutorial001_py310.py ln[1:9,29:35] hl[9] *}\n+\n+If you check the `/docs`, they will show that the field `data` expects base64 encoded bytes:\n+\n+<div class=\"screenshot\">\n+<img src=\"/img/tutorial/json-base64-bytes/image01.png\">\n+</div>\n+\n+You could send a request like:\n+\n+\n```\n\n```diff\n@@ -192,6 +192,7 @@ nav:\n     - advanced/wsgi.md\n     - advanced/generate-clients.md\n     - advanced/advanced-python-types.md\n+    - advanced/json-base64-bytes.md\n   - fastapi-cli.md\n   - Deployment:\n     - deployment/index.md\n\n```\n\n```diff\n@@ -0,0 +1,46 @@\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+\n+class DataInput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\"val_json_bytes\": \"base64\"}\n+\n+\n+class DataOutput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\"ser_json_bytes\": \"base64\"}\n+\n+\n+class DataInputOutput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\n+        \"val_json_bytes\": \"base64\",\n+        \"ser_json_bytes\": \"base64\",\n+    }\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/data\")\n+def post_data(body: DataInput):\n+    content = body.data.decode(\"utf-8\")\n+    return {\"description\": body.description, \"content\": content}\n+\n+\n+@app.get(\"/data\")\n+def get_data() -> DataOutput:\n+    data = \"hello\".encode(\"utf-8\")\n+    return DataOutput(description=\"A plumbus\", data=data)\n+\n+\n+@app.post(\"/data-in-out\")\n+def post_data_in_out(body: DataInputOutput) -> DataInputOutput:\n+    return body\n\n```\n\n```diff\n@@ -27,7 +27,7 @@\n )\n from pydantic._internal._typing_extra import eval_type_lenient\n from pydantic.fields import FieldInfo as FieldInfo\n-from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n+from pydantic.json_schema import GenerateJsonSchema as _GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n from pydantic_core import CoreSchema as CoreSchema\n from pydantic_core import PydanticUndefined\n@@ -40,6 +40,23 @@\n Undefined = PydanticUndefined\n evaluate_forwardref = eval_type_lenient\n \n+\n+class GenerateJsonSchema(_GenerateJsonSchema):\n+    # TODO: remove when this is merged (or equivalent): https://github.com/pydantic/pydantic/pull/12841\n+    # and dropping support for any version of Pydantic before that one (so, in a very long time)\n+    def bytes_schema(self, schema: CoreSchema) -> JsonSchemaValue:\n+        json_schema = {\"type\": \"string\", \"contentMediaType\": \"application/octet-stream\"}\n+        bytes_mode = (\n+            self._config.ser_json_bytes\n+            if self.mode == \"serialization\"\n+            else self._config.val_json_bytes\n+        )\n+        if bytes_mode == \"base64\":\n+            json_schema[\"contentEncoding\"] = \"base64\"\n+        self.update_with_validations(json_schema, schema, self.ValidationsMapping.bytes)\n+        return json_schema\n+\n+\n # TODO: remove when dropping support for Pydantic < v2.12.3\n _Attrs = {\n     \"default\": ...,\n\n```\n\n```diff\n@@ -139,7 +139,7 @@ def _validate(cls, __input_value: Any, _: Any) -> \"UploadFile\":\n     def __get_pydantic_json_schema__(\n         cls, core_schema: Mapping[str, Any], handler: GetJsonSchemaHandler\n     ) -> dict[str, Any]:\n-        return {\"type\": \"string\", \"format\": \"binary\"}\n+        return {\"type\": \"string\", \"contentMediaType\": \"application/octet-stream\"}\n \n     @classmethod\n     def __get_pydantic_core_schema__(\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 127}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -0,0 +1,63 @@\n+# JSON with Bytes as Base64 { #json-with-bytes-as-base64 }\n+\n+If your app needs to receive and send JSON data, but you need to include binary data in it, you can encode it as base64.\n+\n+## Base64 vs Files { #base64-vs-files }\n+\n+Consider first if you can use [Request Files](../tutorial/request-files.md){.internal-link target=_blank} for uploading binary data and [Custom Response - FileResponse](./custom-response.md#fileresponse--fileresponse-){.internal-link target=_blank} for sending binary data, instead of encoding it in JSON.\n+\n+JSON can only contain UTF-8 encoded strings, so it can't contain raw bytes.\n+\n+Base64 can encode binary data in strings, but to do it, it needs to use more characters than the original binary data, so it would normally be less efficient than regular files.\n+\n+Use base64 only if you definitely need to include binary data in JSON, and you can't use files for that.\n+\n+## Pydantic `bytes` { #pydantic-bytes }\n+\n+You can declare a Pydantic model with `bytes` fields, and then use `val_json_bytes` in the model config to tell it to use base64 to *validate* input JSON data, as part of that validation it will decode the base64 string into bytes.\n+\n+{* ../../docs_src/json_base64_bytes/tutorial001_py310.py ln[1:9,29:35] hl[9] *}\n+\n+If you check the `/docs`, they will show that the field `data` expects base64 encoded bytes:\n+\n+<div class=\"screenshot\">\n+<img src=\"/img/tutorial/json-base64-bytes/image01.png\">\n+</div>\n+\n+You could send a request like:\n+\n+\n```\n\n```diff\n@@ -192,6 +192,7 @@ nav:\n     - advanced/wsgi.md\n     - advanced/generate-clients.md\n     - advanced/advanced-python-types.md\n+    - advanced/json-base64-bytes.md\n   - fastapi-cli.md\n   - Deployment:\n     - deployment/index.md\n\n```\n\n```diff\n@@ -0,0 +1,46 @@\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+\n+class DataInput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\"val_json_bytes\": \"base64\"}\n+\n+\n+class DataOutput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\"ser_json_bytes\": \"base64\"}\n+\n+\n+class DataInputOutput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\n+        \"val_json_bytes\": \"base64\",\n+        \"ser_json_bytes\": \"base64\",\n+    }\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/data\")\n+def post_data(body: DataInput):\n+    content = body.data.decode(\"utf-8\")\n+    return {\"description\": body.description, \"content\": content}\n+\n+\n+@app.get(\"/data\")\n+def get_data() -> DataOutput:\n+    data = \"hello\".encode(\"utf-8\")\n+    return DataOutput(description=\"A plumbus\", data=data)\n+\n+\n+@app.post(\"/data-in-out\")\n+def post_data_in_out(body: DataInputOutput) -> DataInputOutput:\n+    return body\n\n```\n\n```diff\n@@ -27,7 +27,7 @@\n )\n from pydantic._internal._typing_extra import eval_type_lenient\n from pydantic.fields import FieldInfo as FieldInfo\n-from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n+from pydantic.json_schema import GenerateJsonSchema as _GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n from pydantic_core import CoreSchema as CoreSchema\n from pydantic_core import PydanticUndefined\n@@ -40,6 +40,23 @@\n Undefined = PydanticUndefined\n evaluate_forwardref = eval_type_lenient\n \n+\n+class GenerateJsonSchema(_GenerateJsonSchema):\n+    # TODO: remove when this is merged (or equivalent): https://github.com/pydantic/pydantic/pull/12841\n+    # and dropping support for any version of Pydantic before that one (so, in a very long time)\n+    def bytes_schema(self, schema: CoreSchema) -> JsonSchemaValue:\n+        json_schema = {\"type\": \"string\", \"contentMediaType\": \"application/octet-stream\"}\n+        bytes_mode = (\n+            self._config.ser_json_bytes\n+            if self.mode == \"serialization\"\n+            else self._config.val_json_bytes\n+        )\n+        if bytes_mode == \"base64\":\n+            json_schema[\"contentEncoding\"] = \"base64\"\n+        self.update_with_validations(json_s", "output": "Bug: ‚ôªÔ∏è Fix JSON Schema for bytes, use `\"contentMediaType\": \"application/octet-stream\"` instead of `\"format\": \"binary\"`\n\n‚ôªÔ∏è Fix JSON Schema for bytes, use `\"contentMediaType\": \"application/octet-stream\"` instead of `\"format\": \"binary\"`\r\n\r\n## Background\r\n\r\n`format: binary` was defined in OpenAPI 3.0.x, in OpenAPI 3.1.x the schema was aligned with the latest JSON Schema, recommending instead `contentMediaType: application/octet-stream`.\r\n\r\nI suspect the JSON Schema for `bytes` using `\"format\": \"binary\"` comes from my first implementation in Pydantic 1.x.\r\n\r\nIt was defined and suggested in OpenAPI 3.0.x (not in JSON Schema): https://spec.openapis.org/oas/v3.0.3.html#considerations-for-file-uploads\r\n\r\nOpenAPI 3.1.x aligned support with JSON Schema draft 07, so it was suggested to upate file uploads to use the regular JSON Schema format: `\"contentMediaType\": \"application/octet-stream\"`: https://learn.openapis.org/upgrading/v3.0-to-v3.1\r\n\r\nThis is defined in JSON Schema 07: https://json-schema.org/draft-07/json-schema-validation#rfc.section.8.4\r\n\r\n### JSON Schema 2020-12 Note\r\n\r\nNow OpenAPI 3.2 is aligned with JSON Schema 2020-12, which is what Pydantic v2 implements (except for this, I'm implementing it there too).\r\n\r\nIt's the same as in JSON Schema draft 07, so this still applies: https://json-schema.org/draft/2020-12/draft-bhutton-json-schema-validation-01#name-contentmediatype\r\n\r\n### Usage in JSON\r\n\r\nJSON as a format actually doesn't support bytes, everything has to be in UTF-8 strings. Transporting bytes in JSON would require encoding bytes in a string, e.g. with base64.\r\n\r\nBut as JSON Schema is not only defined to declare JSON payloads but also payloads that could have a comparable structure and defined with JSON Schema, it's still there in the spec.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 127}
{"instruction": "Review the following code changes: ‚ôªÔ∏è Fix JSON Schema for bytes, use `\"contentMediaType\": \"application/octet-stream\"` instead of `\"format\": \"binary\"`", "input": "```diff\n@@ -0,0 +1,63 @@\n+# JSON with Bytes as Base64 { #json-with-bytes-as-base64 }\n+\n+If your app needs to receive and send JSON data, but you need to include binary data in it, you can encode it as base64.\n+\n+## Base64 vs Files { #base64-vs-files }\n+\n+Consider first if you can use [Request Files](../tutorial/request-files.md){.internal-link target=_blank} for uploading binary data and [Custom Response - FileResponse](./custom-response.md#fileresponse--fileresponse-){.internal-link target=_blank} for sending binary data, instead of encoding it in JSON.\n+\n+JSON can only contain UTF-8 encoded strings, so it can't contain raw bytes.\n+\n+Base64 can encode binary data in strings, but to do it, it needs to use more characters than the original binary data, so it would normally be less efficient than regular files.\n+\n+Use base64 only if you definitely need to include binary data in JSON, and you can't use files for that.\n+\n+## Pydantic `bytes` { #pydantic-bytes }\n+\n+You can declare a Pydantic model with `bytes` fields, and then use `val_json_bytes` in the model config to tell it to use base64 to *validate* input JSON data, as part of that validation it will decode the base64 string into bytes.\n+\n+{* ../../docs_src/json_base64_bytes/tutorial001_py310.py ln[1:9,29:35] hl[9] *}\n+\n+If you check the `/docs`, they will show that the field `data` expects base64 encoded bytes:\n+\n+<div class=\"screenshot\">\n+<img src=\"/img/tutorial/json-base64-bytes/image01.png\">\n+</div>\n+\n+You could send a request like:\n+\n+\n```\n\n```diff\n@@ -192,6 +192,7 @@ nav:\n     - advanced/wsgi.md\n     - advanced/generate-clients.md\n     - advanced/advanced-python-types.md\n+    - advanced/json-base64-bytes.md\n   - fastapi-cli.md\n   - Deployment:\n     - deployment/index.md\n\n```\n\n```diff\n@@ -0,0 +1,46 @@\n+from fastapi import FastAPI\n+from pydantic import BaseModel\n+\n+\n+class DataInput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\"val_json_bytes\": \"base64\"}\n+\n+\n+class DataOutput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\"ser_json_bytes\": \"base64\"}\n+\n+\n+class DataInputOutput(BaseModel):\n+    description: str\n+    data: bytes\n+\n+    model_config = {\n+        \"val_json_bytes\": \"base64\",\n+        \"ser_json_bytes\": \"base64\",\n+    }\n+\n+\n+app = FastAPI()\n+\n+\n+@app.post(\"/data\")\n+def post_data(body: DataInput):\n+    content = body.data.decode(\"utf-8\")\n+    return {\"description\": body.description, \"content\": content}\n+\n+\n+@app.get(\"/data\")\n+def get_data() -> DataOutput:\n+    data = \"hello\".encode(\"utf-8\")\n+    return DataOutput(description=\"A plumbus\", data=data)\n+\n+\n+@app.post(\"/data-in-out\")\n+def post_data_in_out(body: DataInputOutput) -> DataInputOutput:\n+    return body\n\n```\n\n```diff\n@@ -27,7 +27,7 @@\n )\n from pydantic._internal._typing_extra import eval_type_lenient\n from pydantic.fields import FieldInfo as FieldInfo\n-from pydantic.json_schema import GenerateJsonSchema as GenerateJsonSchema\n+from pydantic.json_schema import GenerateJsonSchema as _GenerateJsonSchema\n from pydantic.json_schema import JsonSchemaValue as JsonSchemaValue\n from pydantic_core import CoreSchema as CoreSchema\n from pydantic_core import PydanticUndefined\n@@ -40,6 +40,23 @@\n Undefined = PydanticUndefined\n evaluate_forwardref = eval_type_lenient\n \n+\n+class GenerateJsonSchema(_GenerateJsonSchema):\n+    # TODO: remove when this is merged (or equivalent): https://github.com/pydantic/pydantic/pull/12841\n+    # and dropping support for any version of Pydantic before that one (so, in a very long time)\n+    def bytes_schema(self, schema: CoreSchema) -> JsonSchemaValue:\n+        json_schema = {\"type\": \"string\", \"contentMediaType\": \"application/octet-stream\"}\n+        bytes_mode = (\n+            self._config.ser_json_bytes\n+            if self.mode == \"serialization\"\n+            else self._config.val_json_bytes\n+        )\n+        if bytes_mode == \"base64\":\n+            json_schema[\"contentEncoding\"] = \"base64\"\n+        self.update_with_validations(json_schema, schema, self.ValidationsMapping.bytes)\n+        return json_schema\n+\n+\n # TODO: remove when dropping support for Pydantic < v2.12.3\n _Attrs = {\n     \"default\": ...,\n\n```\n\n```diff\n@@ -139,7 +139,7 @@ def _validate(cls, __input_value: Any, _: Any) -> \"UploadFile\":\n     def __get_pydantic_json_schema__(\n         cls, core_schema: Mapping[str, Any], handler: GetJsonSchemaHandler\n     ) -> dict[str, Any]:\n-        return {\"type\": \"string\", \"format\": \"binary\"}\n+        return {\"type\": \"string\", \"contentMediaType\": \"application/octet-stream\"}\n \n     @classmethod\n     def __get_pydantic_core_schema__(\n\n```", "output": "Changes look good. This PR implements: ‚ôªÔ∏è Fix JSON Schema for bytes, use `\"contentMediaType\": \"application/octet-stream\"` instead of `\"format\": \"binary\"`", "source": "pr", "type": "code_review", "pr_number": 127}
{"instruction": "Fix the following bug: üêõ Fix implicit path params with converters", "input": "## Summary\r\n  Routes that use path converters (e.g. `{param:path}`) are not detected as path parameters when the parameter is declared implicitly\r\n  (without `Path()`), because `get_path_param_names()` returns the raw token including the converter suffix.\r\n\r\n  This causes the parameter to be treated as a query parameter and the request to fail.\r\n\r\n  ## Changes Made\r\n  - Strip converter suffixes in `get_path_param_names()` so `{param:path}` is recognized as `param`.\r\n  - Add a regression test that verifies an implicit `param: str` path parameter works with the `path` converter.\r\n\r\n  ## Why it matters\r\n  This aligns implicit parameters with explicit `Path()` behavior and restores correct routing for path-converter syntax.\r\n\r\n  ## Testing\r\n  - Added a focused test in `tests/test_starlette_urlconvertors.py`.", "output": "```diff\n@@ -41,7 +41,8 @@ def is_body_allowed_for_status_code(status_code: int | str | None) -> bool:\n \n \n def get_path_param_names(path: str) -> set[str]:\n-    return set(re.findall(\"{(.*?)}\", path))\n+    params = re.findall(\"{(.*?)}\", path)\n+    return {param.split(\":\", 1)[0] for param in params}\n \n \n _invalid_args_message = (\n\n```\n\n```diff\n@@ -19,6 +19,11 @@ def path_convertor(param: str = Path()):\n     return {\"path\": param}\n \n \n+@app.get(\"/path-implicit/{param:path}\")\n+def path_convertor_implicit(param: str):\n+    return {\"path\": param}\n+\n+\n @app.get(\"/query/\")\n def query_convertor(param: str = Query()):\n     return {\"query\": param}\n@@ -50,6 +55,13 @@ def test_route_converters_path():\n     assert response.json() == {\"path\": \"some/example\"}\n \n \n+def test_route_converters_path_implicit():\n+    # Test path conversion without explicit Path()\n+    response = client.get(\"/path-implicit/some/example\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"path\": \"some/example\"}\n+\n+\n def test_route_converters_query():\n     # Test query conversion\n     response = client.get(\"/query\", params={\"param\": \"Qu√© tal!\"})\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 126}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -41,7 +41,8 @@ def is_body_allowed_for_status_code(status_code: int | str | None) -> bool:\n \n \n def get_path_param_names(path: str) -> set[str]:\n-    return set(re.findall(\"{(.*?)}\", path))\n+    params = re.findall(\"{(.*?)}\", path)\n+    return {param.split(\":\", 1)[0] for param in params}\n \n \n _invalid_args_message = (\n\n```\n\n```diff\n@@ -19,6 +19,11 @@ def path_convertor(param: str = Path()):\n     return {\"path\": param}\n \n \n+@app.get(\"/path-implicit/{param:path}\")\n+def path_convertor_implicit(param: str):\n+    return {\"path\": param}\n+\n+\n @app.get(\"/query/\")\n def query_convertor(param: str = Query()):\n     return {\"query\": param}\n@@ -50,6 +55,13 @@ def test_route_converters_path():\n     assert response.json() == {\"path\": \"some/example\"}\n \n \n+def test_route_converters_path_implicit():\n+    # Test path conversion without explicit Path()\n+    response = client.get(\"/path-implicit/some/example\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"path\": \"some/example\"}\n+\n+\n def test_route_converters_query():\n     # Test query conversion\n     response = client.get(\"/query\", params={\"param\": \"Qu√© tal!\"})\n\n```", "output": "Bug: üêõ Fix implicit path params with converters\n\n## Summary\r\n  Routes that use path converters (e.g. `{param:path}`) are not detected as path parameters when the parameter is declared implicitly\r\n  (without `Path()`), because `get_path_param_names()` returns the raw token including the converter suffix.\r\n\r\n  This causes the parameter to be treated as a query parameter and the request to fail.\r\n\r\n  ## Changes Made\r\n  - Strip converter suffixes in `get_path_param_names()` so `{param:path}` is recognized as `param`.\r\n  - Add a regression test that verifies an implicit `param: str` path parameter works with the `path` converter.\r\n\r\n  ## Why it matters\r\n  This aligns implicit parameters with explicit `Path()` behavior and restores correct routing for path-converter syntax.\r\n\r\n  ## Testing\r\n  - Added a focused test in `tests/test_starlette_urlconvertors.py`.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 126}
{"instruction": "Review the following code changes: üêõ Fix implicit path params with converters", "input": "```diff\n@@ -41,7 +41,8 @@ def is_body_allowed_for_status_code(status_code: int | str | None) -> bool:\n \n \n def get_path_param_names(path: str) -> set[str]:\n-    return set(re.findall(\"{(.*?)}\", path))\n+    params = re.findall(\"{(.*?)}\", path)\n+    return {param.split(\":\", 1)[0] for param in params}\n \n \n _invalid_args_message = (\n\n```\n\n```diff\n@@ -19,6 +19,11 @@ def path_convertor(param: str = Path()):\n     return {\"path\": param}\n \n \n+@app.get(\"/path-implicit/{param:path}\")\n+def path_convertor_implicit(param: str):\n+    return {\"path\": param}\n+\n+\n @app.get(\"/query/\")\n def query_convertor(param: str = Query()):\n     return {\"query\": param}\n@@ -50,6 +55,13 @@ def test_route_converters_path():\n     assert response.json() == {\"path\": \"some/example\"}\n \n \n+def test_route_converters_path_implicit():\n+    # Test path conversion without explicit Path()\n+    response = client.get(\"/path-implicit/some/example\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == {\"path\": \"some/example\"}\n+\n+\n def test_route_converters_query():\n     # Test query conversion\n     response = client.get(\"/query\", params={\"param\": \"Qu√© tal!\"})\n\n```", "output": "Changes look good. This PR implements: üêõ Fix implicit path params with converters", "source": "pr", "type": "code_review", "pr_number": 126}
{"instruction": "Review the following code changes: üîß Update pyproject.toml, remove unneeded lines", "input": "```diff\n@@ -30,7 +30,6 @@ internal:\n         - .gitignore\n         - .pre-commit-config.yaml\n         - pdm_build.py\n-        - requirements*.txt\n         - uv.lock\n         - docs/en/data/sponsors.yml\n         - docs/en/overrides/main.html\n\n```\n\n```diff\n@@ -1,2 +0,0 @@\n-def get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\n-    return item_a, item_b, item_c, item_d, item_e\n\n```\n\n```diff\n@@ -57,7 +57,6 @@ Issues = \"https://github.com/fastapi/fastapi/issues\"\n Changelog = \"https://fastapi.tiangolo.com/release-notes/\"\n \n [project.optional-dependencies]\n-\n standard = [\n     \"fastapi-cli[standard] >=0.0.8\",\n     # For the test client\n@@ -245,25 +244,16 @@ disallow_incomplete_defs = false\n disallow_untyped_defs = false\n disallow_untyped_calls = false\n \n-[tool.pytest.ini_options]\n+[tool.pytest]\n+minversion = \"9.0\"\n addopts = [\n   \"--strict-config\",\n   \"--strict-markers\",\n   \"--ignore=docs_src\",\n ]\n-xfail_strict = true\n-junit_family = \"xunit2\"\n+strict_xfail = true\n filterwarnings = [\n     \"error\",\n-    # see https://trio.readthedocs.io/en/stable/history.html#trio-0-22-0-2022-09-28\n-    \"ignore:You seem to already have a custom.*:RuntimeWarning:trio\",\n-    # TODO: remove after upgrading SQLAlchemy to a version that includes the following changes\n-    # https://github.com/sqlalchemy/sqlalchemy/commit/59521abcc0676e936b31a523bd968fc157fef0c2\n-    'ignore:datetime\\.datetime\\.utcfromtimestamp\\(\\) is deprecated and scheduled for removal in a future version\\..*:DeprecationWarning:sqlalchemy',\n-    # Trio 24.1.0 raises a warning from attrs\n-    # Ref: https://github.com/python-trio/trio/pull/3054\n-    # Remove once there's a new version of Trio\n-    'ignore:The `hash` argument is deprecated*:DeprecationWarning:trio',\n ]\n \n [tool.coverage.run]\n@@ -280,210 +270,13 @@ dynamic_context = \"test_function\"\n omit = [\n     \"docs_src/response_model/tutorial003_04_py39.py\",\n     \"docs_src/response_model/tutorial003_04_py310.py\",\n-    \"docs_src/dependencies/tutorial008_an_py39.py\",  # difficult to mock\n     \"docs_src/dependencies/tutorial013_an_py310.py\",  # temporary code example?\n     \"docs_src/dependencies/tutorial014_an_py310.py\",  # temporary code example?\n     # Pydantic v1 migration, no longer tested\n     \"docs_src/pydantic_v1_in_v2/tutorial001_an_py310.py\",\n     \"docs_src/pydantic_v1_in_v2/tutorial002_an_py310.py\",\n     \"docs_src/pydantic_v1_in_v2/tutorial003_an_py310.py\",\n     \"docs_src/pydantic_v1_in_v2/tutorial004_an_py310.py\",\n-    # TODO: remove all the ignores below when all translations use the new Python 3.10 files\n-    \"docs_src/additional_responses/tutorial001_py39.py\",\n-    \"docs_src/additional_responses/tutorial003_py39.py\",\n-    \"docs_src/advanced_middleware/tutorial001_py39.py\",\n-    \"docs_src/advanced_middleware/tutorial002_py39.py\",\n-    \"docs_src/advanced_middleware/tutorial003_py39.py\",\n-    \"docs_src/app_testing/app_a_py39/main.py\",\n-    \"docs_src/app_testing/app_a_py39/test_main.py\",\n-    \"docs_src/app_testing/tutorial001_py39.py\",\n-    \"docs_src/app_testing/tutorial002_py39.py\",\n-    \"docs_src/app_testing/tutorial003_py39.py\",\n-    \"docs_src/app_testing/tutorial004_py39.py\",\n-    \"docs_src/async_tests/app_a_py39/main.py\",\n-    \"docs_src/async_tests/app_a_py39/test_main.py\",\n-    \"docs_src/authentication_error_status_code/tutorial001_an_py39.py\",\n-    \"docs_src/background_tasks/tutorial001_py39.py\",\n-    \"docs_src/behind_a_proxy/t\n\n```", "output": "Changes look good. This PR implements: üîß Update pyproject.toml, remove unneeded lines", "source": "pr", "type": "code_review", "pr_number": 125}
{"instruction": "Review the following code changes: ‚ûñ Drop support for `fastapi-slim`, no more versions will be released, use only `\"fastapi[standard]\"` or `fastapi`", "input": "```diff\n@@ -29,7 +29,6 @@ internal:\n         - scripts/**\n         - .gitignore\n         - .pre-commit-config.yaml\n-        - pdm_build.py\n         - uv.lock\n         - docs/en/data/sponsors.yml\n         - docs/en/overrides/main.html\n\n```\n\n```diff\n@@ -1,40 +0,0 @@\n-import os\n-from typing import Any\n-\n-from pdm.backend.hooks import Context\n-\n-TIANGOLO_BUILD_PACKAGE = os.getenv(\"TIANGOLO_BUILD_PACKAGE\")\n-\n-\n-def pdm_build_initialize(context: Context) -> None:\n-    metadata = context.config.metadata\n-    # Get main version\n-    version = metadata[\"version\"]\n-    # Get custom config for the current package, from the env var\n-    all_configs_config: dict[str, Any] = context.config.data[\"tool\"][\"tiangolo\"][\n-        \"_internal-slim-build\"\n-    ][\"packages\"]\n-\n-    if TIANGOLO_BUILD_PACKAGE not in all_configs_config:\n-        return\n-\n-    config = all_configs_config[TIANGOLO_BUILD_PACKAGE]\n-    project_config: dict[str, Any] = config[\"project\"]\n-    # Override main [project] configs with custom configs for this package\n-    for key, value in project_config.items():\n-        metadata[key] = value\n-    # Get custom build config for the current package\n-    build_config: dict[str, Any] = (\n-        config.get(\"tool\", {}).get(\"pdm\", {}).get(\"build\", {})\n-    )\n-    # Override PDM build config with custom build config for this package\n-    for key, value in build_config.items():\n-        context.config.build_config[key] = value\n-    # Get main dependencies\n-    dependencies: list[str] = metadata.get(\"dependencies\", [])\n-    # Sync versions in dependencies\n-    new_dependencies = []\n-    for dep in dependencies:\n-        new_dep = f\"{dep}>={version}\"\n-        new_dependencies.append(new_dep)\n-    metadata[\"dependencies\"] = new_dependencies\n\n```\n\n```diff\n@@ -198,32 +198,6 @@ source-includes = [\n     \"docs/en/docs/img/favicon.png\",\n ]\n \n-[tool.tiangolo._internal-slim-build.packages.fastapi-slim.project]\n-name = \"fastapi-slim\"\n-readme = \"fastapi-slim/README.md\"\n-dependencies = [\n-    \"fastapi\",\n-]\n-optional-dependencies = {}\n-scripts = {}\n-\n-[tool.tiangolo._internal-slim-build.packages.fastapi-slim.tool.pdm.build]\n-# excludes needs to explicitly exclude the top level python packages,\n-# otherwise PDM includes them by default\n-# A \"*\" glob pattern can't be used here because in PDM internals, the patterns are put\n-# in a set (unordered, order varies) and each excluded file is assigned one of the\n-# glob patterns that matches, as the set is unordered, the matched pattern could be \"*\"\n-# independent of the order here. And then the internal code would give it a lower score\n-# than the one for a default included file.\n-# By not using \"*\" and explicitly excluding the top level packages, they get a higher\n-# score than the default inclusion\n-excludes = [\"fastapi\", \"tests\", \"pdm_build.py\"]\n-# source-includes needs to explicitly define some value because PDM will check the\n-# truthy value of the list, and if empty, will include some defaults, including \"tests\",\n-# an empty string doesn't match anything, but makes the list truthy, so that PDM\n-# doesn't override it during the build.\n-source-includes = [\"\"]\n-\n [tool.mypy]\n plugins = [\"pydantic.mypy\"]\n strict = true\n\n```", "output": "Changes look good. This PR implements: ‚ûñ Drop support for `fastapi-slim`, no more versions will be released, use only `\"fastapi[standard]\"` or `fastapi`", "source": "pr", "type": "code_review", "pr_number": 124}
{"instruction": "Fix the following bug: üë∑ Fix CI, do not attempt to publish `fastapi-slim`", "input": "üë∑ Fix CI, do not attempt to publish `fastapi-slim`", "output": "```diff\n@@ -8,11 +8,6 @@ on:\n jobs:\n   publish:\n     runs-on: ubuntu-latest\n-    strategy:\n-      matrix:\n-        package:\n-          - fastapi\n-          - fastapi-slim\n     permissions:\n       id-token: write\n       contents: read\n@@ -26,14 +21,9 @@ jobs:\n         uses: actions/setup-python@v6\n         with:\n           python-version-file: \".python-version\"\n-          # Issue ref: https://github.com/actions/setup-python/issues/436\n-          # cache: \"pip\"\n-          # cache-dependency-path: pyproject.toml\n       - name: Install uv\n         uses: astral-sh/setup-uv@v7\n       - name: Build distribution\n         run: uv build\n-        env:\n-          TIANGOLO_BUILD_PACKAGE: ${{ matrix.package }}\n       - name: Publish\n         run: uv publish\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 123}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -8,11 +8,6 @@ on:\n jobs:\n   publish:\n     runs-on: ubuntu-latest\n-    strategy:\n-      matrix:\n-        package:\n-          - fastapi\n-          - fastapi-slim\n     permissions:\n       id-token: write\n       contents: read\n@@ -26,14 +21,9 @@ jobs:\n         uses: actions/setup-python@v6\n         with:\n           python-version-file: \".python-version\"\n-          # Issue ref: https://github.com/actions/setup-python/issues/436\n-          # cache: \"pip\"\n-          # cache-dependency-path: pyproject.toml\n       - name: Install uv\n         uses: astral-sh/setup-uv@v7\n       - name: Build distribution\n         run: uv build\n-        env:\n-          TIANGOLO_BUILD_PACKAGE: ${{ matrix.package }}\n       - name: Publish\n         run: uv publish\n\n```", "output": "Bug: üë∑ Fix CI, do not attempt to publish `fastapi-slim`\n\nüë∑ Fix CI, do not attempt to publish `fastapi-slim`", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 123}
{"instruction": "Review the following code changes: üë∑ Fix CI, do not attempt to publish `fastapi-slim`", "input": "```diff\n@@ -8,11 +8,6 @@ on:\n jobs:\n   publish:\n     runs-on: ubuntu-latest\n-    strategy:\n-      matrix:\n-        package:\n-          - fastapi\n-          - fastapi-slim\n     permissions:\n       id-token: write\n       contents: read\n@@ -26,14 +21,9 @@ jobs:\n         uses: actions/setup-python@v6\n         with:\n           python-version-file: \".python-version\"\n-          # Issue ref: https://github.com/actions/setup-python/issues/436\n-          # cache: \"pip\"\n-          # cache-dependency-path: pyproject.toml\n       - name: Install uv\n         uses: astral-sh/setup-uv@v7\n       - name: Build distribution\n         run: uv build\n-        env:\n-          TIANGOLO_BUILD_PACKAGE: ${{ matrix.package }}\n       - name: Publish\n         run: uv publish\n\n```", "output": "Changes look good. This PR implements: üë∑ Fix CI, do not attempt to publish `fastapi-slim`", "source": "pr", "type": "code_review", "pr_number": 123}
{"instruction": "Review the following code changes: ‚¨ÜÔ∏è Upgrade pytest", "input": "```diff\n@@ -170,7 +170,7 @@ tests = [\n     \"mypy >=1.14.1\",\n     \"pwdlib[argon2] >=0.2.1\",\n     \"pyjwt >=2.9.0\",\n-    \"pytest >=7.1.3,<9.0.0\",\n+    \"pytest >=9.0.0\",\n     \"pytest-codspeed >=4.2.0\",\n     \"pyyaml >=5.3.1,<7.0.0\",\n     \"sqlmodel >=0.0.31\",\n\n```\n\n```diff\n@@ -1276,7 +1276,7 @@ dev = [\n     { name = \"pydantic-ai\", specifier = \">=0.4.10\" },\n     { name = \"pygithub\", specifier = \">=2.8.1\" },\n     { name = \"pyjwt\", specifier = \">=2.9.0\" },\n-    { name = \"pytest\", specifier = \">=7.1.3,<9.0.0\" },\n+    { name = \"pytest\", specifier = \">=9.0.0\" },\n     { name = \"pytest-codspeed\", specifier = \">=4.2.0\" },\n     { name = \"python-slugify\", specifier = \">=8.0.4\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n@@ -1329,7 +1329,7 @@ tests = [\n     { name = \"mypy\", specifier = \">=1.14.1\" },\n     { name = \"pwdlib\", extras = [\"argon2\"], specifier = \">=0.2.1\" },\n     { name = \"pyjwt\", specifier = \">=2.9.0\" },\n-    { name = \"pytest\", specifier = \">=7.1.3,<9.0.0\" },\n+    { name = \"pytest\", specifier = \">=9.0.0\" },\n     { name = \"pytest-codspeed\", specifier = \">=4.2.0\" },\n     { name = \"pyyaml\", specifier = \">=5.3.1,<7.0.0\" },\n     { name = \"ruff\", specifier = \">=0.14.14\" },\n@@ -4330,7 +4330,7 @@ wheels = [\n \n [[package]]\n name = \"pytest\"\n-version = \"8.4.2\"\n+version = \"9.0.2\"\n source = { registry = \"https://pypi.org/simple\" }\n dependencies = [\n     { name = \"colorama\", marker = \"sys_platform == 'win32'\" },\n@@ -4341,9 +4341,9 @@ dependencies = [\n     { name = \"pygments\" },\n     { name = \"tomli\", marker = \"python_full_version < '3.11'\" },\n ]\n-sdist = { url = \"https://files.pythonhosted.org/packages/a3/5c/00a0e072241553e1a7496d638deababa67c5058571567b92a7eaa258397c/pytest-8.4.2.tar.gz\", hash = \"sha256:86c0d0b93306b961d58d62a4db4879f27fe25513d4b969df351abdddb3c30e01\", size = 1519618, upload-time = \"2025-09-04T14:34:22.711Z\" }\n+sdist = { url = \"https://files.pythonhosted.org/packages/d1/db/7ef3487e0fb0049ddb5ce41d3a49c235bf9ad299b6a25d5780a89f19230f/pytest-9.0.2.tar.gz\", hash = \"sha256:75186651a92bd89611d1d9fc20f0b4345fd827c41ccd5c299a868a05d70edf11\", size = 1568901, upload-time = \"2025-12-06T21:30:51.014Z\" }\n wheels = [\n-    { url = \"https://files.pythonhosted.org/packages/a8/a4/20da314d277121d6534b3a980b29035dcd51e6744bd79075a6ce8fa4eb8d/pytest-8.4.2-py3-none-any.whl\", hash = \"sha256:872f880de3fc3a5bdc88a11b39c9710c3497a547cfa9320bc3c5e62fbf272e79\", size = 365750, upload-time = \"2025-09-04T14:34:20.226Z\" },\n+    { url = \"https://files.pythonhosted.org/packages/3b/ab/b3226f0bd7cdcf710fbede2b3548584366da3b19b5021e74f5bde2a8fa3f/pytest-9.0.2-py3-none-any.whl\", hash = \"sha256:711ffd45bf766d5264d487b917733b453d917afd2b0ad65223959f59089f875b\", size = 374801, upload-time = \"2025-12-06T21:30:49.154Z\" },\n ]\n \n [[package]]\n\n```", "output": "Changes look good. This PR implements: ‚¨ÜÔ∏è Upgrade pytest", "source": "pr", "type": "code_review", "pr_number": 122}
{"instruction": "Review the following code changes: docs: migrate testing tutorial from on_event to lifespan", "input": "```diff\n@@ -0,0 +1,7 @@\n+from decimal import Decimal\n+\n+from fastapi import Query\n+\n+\n+def create_item(price: Decimal = Query(..., max_digits=5, decimal_places=2)):\n+    return {\"price\": price}\n\n```\n\n```diff\n@@ -94,6 +94,6 @@ As the testing function is now asynchronous, you can now also call (and `await`)\n \n /// tip\n \n-If you encounter a `RuntimeError: Task attached to a different loop` when integrating asynchronous function calls in your tests (e.g. when using <a href=\"https://stackoverflow.com/questions/41584243/runtimeerror-task-attached-to-a-different-loop\" class=\"external-link\" target=\"_blank\">MongoDB's MotorClient</a>), remember to instantiate objects that need an event loop only within async functions, e.g. an `@app.on_event(\"startup\")` callback.\n+If you encounter a `RuntimeError: Task attached to a different loop` when integrating asynchronous function calls in your tests (e.g. when using <a href=\"https://stackoverflow.com/questions/41584243/runtimeerror-task-attached-to-a-different-loop\" class=\"external-link\" target=\"_blank\">MongoDB's MotorClient</a>), remember to instantiate objects that need an event loop only within async functions, for example, using a lifespan async context manager.\n \n ///\n\n```\n\n```diff\n@@ -0,0 +1,30 @@\n+from contextlib import asynccontextmanager\n+from typing import Any\n+\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+\n+# Use typing.Dict for compatibility with older Python versions\n+items: dict[str, Any] = {}\n+\n+\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n+    items[\"foo\"] = {\"name\": \"Fighters\"}\n+    items[\"bar\"] = {\"name\": \"Tenders\"}\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n+\n+\n+@app.get(\"/items/{item_id}\")\n+async def read_items(item_id: str):\n+    return items[item_id]\n+\n+\n+def test_read_items():\n+    with TestClient(app) as client:\n+        response = client.get(\"/items/foo\")\n+        assert response.status_code == 200\n+        assert response.json() == {\"name\": \"Fighters\"}\n\n```\n\n```diff\n@@ -1,15 +1,19 @@\n+from contextlib import asynccontextmanager\n+\n from fastapi import FastAPI\n from fastapi.testclient import TestClient\n \n-app = FastAPI()\n-\n items = {}\n \n \n-@app.on_event(\"startup\")\n-async def startup_event():\n+@asynccontextmanager\n+async def lifespan(app: FastAPI):\n     items[\"foo\"] = {\"name\": \"Fighters\"}\n     items[\"bar\"] = {\"name\": \"Tenders\"}\n+    yield\n+\n+\n+app = FastAPI(lifespan=lifespan)\n \n \n @app.get(\"/items/{item_id}\")\n\n```\n\n```diff\n@@ -1,7 +1,11 @@\n-import pytest\n+from docs_src.app_testing import tutorial003, tutorial003_py310\n \n \n-def test_main():\n-    with pytest.warns(DeprecationWarning):\n-        from docs_src.app_testing.tutorial003_py310 import test_read_items\n-    test_read_items()\n+def test_tutorial003():\n+    # This covers the base version (tutorial003.py)\n+    tutorial003.test_read_items()\n+\n+\n+def test_tutorial003_py310():\n+    # This covers the modern version (tutorial003_py310.py)\n+    tutorial003_py310.test_read_items()\n\n```", "output": "Changes look good. This PR implements: docs: migrate testing tutorial from on_event to lifespan", "source": "pr", "type": "code_review", "pr_number": 121}
{"instruction": "Fix the following bug: Fix UnboundLocalError in OpenAPI schema generation with custom respon‚Ä¶", "input": "When a route uses a custom response class whose __init__ does not expose a status_code parameter with an int default, and the route decorator does not specify an explicit status_code, the status_code local variable in get_openapi_path() was never assigned. This caused an UnboundLocalError at the point where status_code is used to populate the operation responses dict.\r\n\r\nThe bug does not surface with standard Starlette response classes (JSONResponse, HTMLResponse, PlainTextResponse, StreamingResponse, etc.) because they all declare status_code: int = 200 (or 307 for redirects) in their __init__ signatures. It triggers when users define custom response classes that wrap or omit the status_code parameter, e.g.:\r\n\r\n    class CustomResponse(Response):\r\n        def __init__(self, content, **kwargs):\r\n            super().__init__(content=content, status_code=200, **kwargs)\r\n\r\n    @app.get(\"/items\", response_class=CustomResponse)\r\n    async def get_items(): ...\r\n\r\nAccessing /openapi.json or /docs would crash with:\r\n    UnboundLocalError: cannot access local variable 'status_code'\r\n\r\nFix: initialize status_code = \"200\" before the conditional block so it always has a safe default. The existing branches that extract status_code from the route or from the response class signature still override this default when applicable.", "output": "```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n             if route.status_code is not None:\n                 status_code = str(route.status_code)\n             else:\n\n```\n\n```diff\n@@ -0,0 +1,62 @@\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from starlette.responses import Response\n+\n+\n+class CustomResponse(Response):\n+    \"\"\"A custom response class whose __init__ does not expose status_code\n+    as a parameter with an int default. This previously caused an\n+    UnboundLocalError during OpenAPI schema generation when the route\n+    did not specify an explicit status_code.\"\"\"\n+\n+    media_type = \"text/plain\"\n+\n+    def __init__(self, content: str, **kwargs: object) -> None:\n+        super().__init__(content=content, status_code=200, **kwargs)\n+\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/items\", response_class=CustomResponse)\n+async def get_items():\n+    return \"ok\"\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_get_response():\n+    response = client.get(\"/items\")\n+    assert response.status_code == 200\n+    assert response.text == \"ok\"\n+\n+\n+def test_openapi_schema():\n+    \"\"\"OpenAPI generation must not crash when the response class's __init__\n+    lacks a status_code parameter with an int default.\"\"\"\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/items\": {\n+                    \"get\": {\n+                        \"summary\": \"Get Items\",\n+                        \"operationId\": \"get_items_items_get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"text/plain\": {\"schema\": {\"type\": \"string\"}}\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+        }\n+    )\n\n```\n\n```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```\n\n```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 120}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n             if route.status_code is not None:\n                 status_code = str(route.status_code)\n             else:\n\n```\n\n```diff\n@@ -0,0 +1,62 @@\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from starlette.responses import Response\n+\n+\n+class CustomResponse(Response):\n+    \"\"\"A custom response class whose __init__ does not expose status_code\n+    as a parameter with an int default. This previously caused an\n+    UnboundLocalError during OpenAPI schema generation when the route\n+    did not specify an explicit status_code.\"\"\"\n+\n+    media_type = \"text/plain\"\n+\n+    def __init__(self, content: str, **kwargs: object) -> None:\n+        super().__init__(content=content, status_code=200, **kwargs)\n+\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/items\", response_class=CustomResponse)\n+async def get_items():\n+    return \"ok\"\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_get_response():\n+    response = client.get(\"/items\")\n+    assert response.status_code == 200\n+    assert response.text == \"ok\"\n+\n+\n+def test_openapi_schema():\n+    \"\"\"OpenAPI generation must not crash when the response class's __init__\n+    lacks a status_code parameter with an int default.\"\"\"\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/items\": {\n+                    \"get\": {\n+                        \"summary\": \"Get Items\",\n+                        \"operationId\": \"get_items_items_get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"text/plain\": {\"schema\": {\"type\": \"string\"}}\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+        }\n+    )\n\n```\n\n```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```\n\n```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```", "output": "Bug: Fix UnboundLocalError in OpenAPI schema generation with custom respon‚Ä¶\n\nWhen a route uses a custom response class whose __init__ does not expose a status_code parameter with an int default, and the route decorator does not specify an explicit status_code, the status_code local variable in get_openapi_path() was never assigned. This caused an UnboundLocalError at the point where status_code is used to populate the operation responses dict.\r\n\r\nThe bug does not surface with standard Starlette response classes (JSONResponse, HTMLResponse, PlainTextResponse, StreamingResponse, etc.) because they all declare status_code: int = 200 (or 307 for redirects) in their __init__ signatures. It triggers when users define custom response classes that wrap or omit the status_code parameter, e.g.:\r\n\r\n    class CustomResponse(Response):\r\n        def __init__(self, content, **kwargs):\r\n            super().__init__(content=content, status_code=200, **kwargs)\r\n\r\n    @app.get(\"/items\", response_class=CustomResponse)\r\n    async def get_items(): ...\r\n\r\nAccessing /openapi.json or /docs would crash with:\r\n    UnboundLocalError: cannot access local variable 'status_code'\r\n\r\nFix: initialize status_code = \"200\" before the conditional block so it always has a safe default. The existing branches that extract status_code from the route or from the response class signature still override this default when applicable.", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 120}
{"instruction": "Review the following code changes: Fix UnboundLocalError in OpenAPI schema generation with custom respon‚Ä¶", "input": "```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n             if route.status_code is not None:\n                 status_code = str(route.status_code)\n             else:\n\n```\n\n```diff\n@@ -0,0 +1,62 @@\n+from fastapi import FastAPI\n+from fastapi.testclient import TestClient\n+from inline_snapshot import snapshot\n+from starlette.responses import Response\n+\n+\n+class CustomResponse(Response):\n+    \"\"\"A custom response class whose __init__ does not expose status_code\n+    as a parameter with an int default. This previously caused an\n+    UnboundLocalError during OpenAPI schema generation when the route\n+    did not specify an explicit status_code.\"\"\"\n+\n+    media_type = \"text/plain\"\n+\n+    def __init__(self, content: str, **kwargs: object) -> None:\n+        super().__init__(content=content, status_code=200, **kwargs)\n+\n+\n+app = FastAPI()\n+\n+\n+@app.get(\"/items\", response_class=CustomResponse)\n+async def get_items():\n+    return \"ok\"\n+\n+\n+client = TestClient(app)\n+\n+\n+def test_get_response():\n+    response = client.get(\"/items\")\n+    assert response.status_code == 200\n+    assert response.text == \"ok\"\n+\n+\n+def test_openapi_schema():\n+    \"\"\"OpenAPI generation must not crash when the response class's __init__\n+    lacks a status_code parameter with an int default.\"\"\"\n+    response = client.get(\"/openapi.json\")\n+    assert response.status_code == 200, response.text\n+    assert response.json() == snapshot(\n+        {\n+            \"openapi\": \"3.1.0\",\n+            \"info\": {\"title\": \"FastAPI\", \"version\": \"0.1.0\"},\n+            \"paths\": {\n+                \"/items\": {\n+                    \"get\": {\n+                        \"summary\": \"Get Items\",\n+                        \"operationId\": \"get_items_items_get\",\n+                        \"responses\": {\n+                            \"200\": {\n+                                \"description\": \"Successful Response\",\n+                                \"content\": {\n+                                    \"text/plain\": {\"schema\": {\"type\": \"string\"}}\n+                                },\n+                            }\n+                        },\n+                    }\n+                }\n+            },\n+        }\n+    )\n\n```\n\n```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```\n\n```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```", "output": "Code Review for: Fix UnboundLocalError in OpenAPI schema generation with custom respon‚Ä¶\n\nüìù **fastapi/openapi/utils.py**: I think this is incorrect to assume the status code is 200.\n\nüìù **fastapi/openapi/utils.py**: I agree with @YuriiMotov. \r\nstatus_code = \"200\" is to avoid an UnboundLocalError if no status code is defined.\r\nHowever, an explicit \"200\" can be misleading to API consumers; using the OpenAPI \"default\" response as a fallback would be safer and more informative.\r\n\r\nstatus_code = \"default\"\r\n\r\n\"responses\": {\r\n  \"200\": { \"description\": \"Success\" },\r\n  \"400\": { \"description\": \"Bad request\" },\r\n  \"default\": { \"description\": \"Unexpected error\" }\r\n}\n\n", "source": "pr", "type": "code_review", "pr_number": 120}
{"instruction": "Review this code change in `fastapi/openapi/utils.py`", "input": "```diff\n@@ -339,6 +339,7 @@ def get_openapi_path(\n                         )\n                         callbacks[callback.name] = {callback.path: cb_path}\n                 operation[\"callbacks\"] = callbacks\n+            status_code = \"200\"\n\n```", "output": "I think this is incorrect to assume the status code is 200.", "source": "pr_review", "type": "inline_review", "pr_number": 120}
{"instruction": "Fix the following bug: üìù Fix doctrings for `max_digits` and `decimal_places`", "input": "They are only applicable for `Decimal` type: https://github.com/pydantic/pydantic/blob/8be4a57eb36760c85fa97a3bdea78a1f283489d0/pydantic/_internal/_known_annotated_metadata.py#L44", "output": "```diff\n@@ -211,15 +211,15 @@ def Path(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -570,15 +570,15 @@ def Query(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -892,15 +892,15 @@ def Header(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1198,15 +1198,15 @@ def Cookie(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1526,15 +1526,15 @@ def Body(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1842,15 +1842,15 @@ def Form(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n\n\n```", "source": "pr_bugfix", "type": "bug_fix", "pr_number": 119}
{"instruction": "Explain what bug this code change fixes and why", "input": "```diff\n@@ -211,15 +211,15 @@ def Path(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -570,15 +570,15 @@ def Query(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -892,15 +892,15 @@ def Header(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1198,15 +1198,15 @@ def Cookie(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1526,15 +1526,15 @@ def Body(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1842,15 +1842,15 @@ def Form(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n\n\n```", "output": "Bug: üìù Fix doctrings for `max_digits` and `decimal_places`\n\nThey are only applicable for `Decimal` type: https://github.com/pydantic/pydantic/blob/8be4a57eb36760c85fa97a3bdea78a1f283489d0/pydantic/_internal/_known_annotated_metadata.py#L44", "source": "pr_bugfix", "type": "bug_explanation", "pr_number": 119}
{"instruction": "Review the following code changes: üìù Fix doctrings for `max_digits` and `decimal_places`", "input": "```diff\n@@ -211,15 +211,15 @@ def Path(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -570,15 +570,15 @@ def Query(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -892,15 +892,15 @@ def Header(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1198,15 +1198,15 @@ def Cookie(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1526,15 +1526,15 @@ def Body(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of decimal places allowed for numbers.\n+            Maximum number of decimal places allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n@@ -1842,15 +1842,15 @@ def Form(  # noqa: N802\n         int | None,\n         Doc(\n             \"\"\"\n-            Maximum number of allow digits for strings.\n+            Maximum number of digits allowed for decimal values.\n             \"\"\"\n         ),\n     ] = _Unset,\n     decimal_places: Annotated[\n\n\n```", "output": "Changes look good. This PR implements: üìù Fix doctrings for `max_digits` and `decimal_places`", "source": "pr", "type": "code_review", "pr_number": 119}
{"instruction": "Debug this error: Would be nice to be able to route request using header's Accept field (or generic header's field)", "input": "```\nN.A.\n\n```\n\n```\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\", accept=\"application/json;version=1.0\")\r\nasync def root():\r\n    return {\"message\": \"Hello World v1.0\"}\r\n\r\n@app.get(\"/\", accept=\"application/json;version=1.1\")\r\nasync def root():\r\n    return {\"message\": \"Hello World v1.1\"}\n\n```", "output": "You still have access to request object, couldn't you use that to retrieve `content-type` and implement your logic as if there are two different endpoints?\n\n> You still have access to request object, couldn't you use that to retrieve `content-type` and implement your logic as if there are two different endpoints?\r\n\r\nwell, it's not so easy.\r\nUsually new version of the API means breaking changes in the request body and/or response body.\r\n\r\nHandle it in a single endpoint will end-up in a \"messy\" code.\r\n\r\nFor instance how to define different input body depending of the version?\n\nYou could handle the version in the route? Eg /api/v1/person /api/v2/person", "source": "bug_issue", "type": "error_debug", "issue_number": 118}
{"instruction": "How to fix: Would be nice to be able to route request using header's Accept field (or generic header's field)", "input": "### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options üëÜ\n\n### Example Code\n\n```python\nN.A.\n```\n\n\n### Description\n\nIn some cases would be nice to specify header's field as routing rules.\r\n\r\nOne important example is to support API versioning based on Header's Accept field\n\n### Wanted Solution\n\nAbility to specify some header's fields in the `.get()`, `.post()` .... decorators\n\n### Wanted Code\n\n```python\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\", accept=\"application/json;version=1.0\")\r\nasync def root():\r\n    return {\"message\": \"Hello World v1.0\"}\r\n\r\n@app.get(\"/\", accept=\"application/json;version=1.1\")\r\nasync def root():\r\n    return {\"message\": \"Hello World v1.1\"}\n```\n\n\n### Alternatives\n\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\", headers={\"accept\": \"application/json;version=1.0\"})\r\nasync def root():\r\n    return {\"message\": \"Hello World v1.0\"}\r\n\r\n@app.get(\"/\", headers={\"accept\": \"application/json;version=1.1\"})\r\nasync def root():\r\n    return {\"message\": \"Hello World v1.1\"}\r\n\n\n### Operating System\n\nmacOS\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\npython -c \"import fastapi; print(fastapi.__version__)\"\n\n### Python Version\n\nPython 3.9.7\n\n### Additional Context\n\n_No response_", "output": "You still have access to request object, couldn't you use that to retrieve `content-type` and implement your logic as if there are two different endpoints?\n\n> You still have access to request object, couldn't you use that to retrieve `content-type` and implement your logic as if there are two different endpoints?\r\n\r\nwell, it's not so easy.\r\nUsually new version of the API means breaking changes in the request body and/or response body.\r\n\r\nHandle it in a single endpoint will end-up in a \"messy\" code.\r\n\r\nFor instance how to define different input body depending of the version?\n\nYou could handle the version in the route? Eg /api/v1/person /api/v2/person", "source": "bug_issue", "type": "bug_solution", "issue_number": 118}
{"instruction": "How to fix: Need help tracking API usage", "input": "### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom typing import Callable\r\nfrom fastapi import Request, Response, Depends\r\nfrom fastapi.routing import APIRoute\r\nfrom server.routes.users import fastapi_users\r\nfrom server.models.users import *\r\n\r\nclass session_log(APIRoute):\r\n    def get_route_handler(self) -> Callable:\r\n        original_route_handler = super().get_route_handler()\r\n\r\n        async def custom_route_handler(request: Request,\r\n        user: User = fastapi_users.get_current_user\r\n        ) -> Response:\r\n            response: Response = await original_route_handler(request)\r\n            # print(f\"route response: {response}\")\r\n            try:\r\n                print(\"User\", str(user))\r\n            except Exception as e:\r\n                print(f\"Error : {e}\")\r\n            return response\r\n\r\n        return custom_route_handler\r\n```\r\n\r\n\r\n### Description\r\n\r\nHi, I'm looking for a way to track api usage on user basis. We are using fastapi-users for user management. Can anyone please suggest a way to do this. I tried using a custom API Router but was unable to fetch user details as it done through dependency injection and I kept getting errors like Depends object has no attribute ID/ Depends object is not subscriptable.\r\n\r\nAny help would be greatly appreciated.\r\n\r\nThank you!!\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\nfastapi==0.61.1\r\n\r\n### Python Version\r\n\r\n3.8\r\n\r\n### Additional Context\r\n\r\n_No response_", "output": "Hi @ari-jain013, if your logs don't require the response object, you could create a dependency for logging ([that depends on user dependency](https://fastapi.tiangolo.com/tutorial/dependencies/sub-dependencies/)) and inject it on all routes.\r\n\r\nFor logging, check:  https://github.com/tiangolo/fastapi/issues/778#issuecomment-563284270\r\n\r\nFor adding the dependency on all paths, check: https://fastapi.tiangolo.com/tutorial/bigger-applications/\r\n> And we can add a list of dependencies that will be added to all the path operations in the router and will be executed/solved for each request made to them.\r\n\r\n**EDIT:** Just to add an example \r\n```python\r\nfrom fastapi import FastAPI, APIRouter, Depends\r\n\r\napp = FastAPI()\r\n\r\ndef user_dep() -> int:\r\n    print(\"CALLED USER DEPENDENCY\")\r\n    user = 0\r\n    return user\r\n\r\ndef logger_dep(user: int = Depends(user_dep)):\r\n    print('CALLED LOGGER', user)\r\n\r\nlogged_router = APIRouter(dependencies=[Depends(logger_dep)])\r\n\r\n@app.get(\"/not-logged\")\r\nasync def not_logged(user: int = Depends(user_dep)):\r\n    return user\r\n\r\n@logged_router.get(\"/logged\")\r\nasync def logged(user: int = Depends(user_dep)):\r\n    return user\r\n\r\napp.include_router(logged_router)\r\n```\r\n\r\nYou can confirm, user dependency is only called once for each path (other calls use cached value): \r\n```python\r\nfrom fastapi.testclient import TestClient\r\nclient = TestClient(app)\r\nclient.get('/logged')\r\n```\r\nGives:\r\n>CALLED USER DEPENDENCY\r\n>CALLED LOGGER 0\n\nOkay, I think I can start with this but again it would be great analytics if I could also track is the response was successful or not.\r\n\r\nThank you for the quick reply\n\nIf you need to wait for the response, I would add a middleware for logging. For user info, [starlette allows you attach states to the request object](https://www.starlette.io/requests/#other-state), which you can then access from the middleware. Not sure if there is a downside to using this with FastAPI, but the following example runs correctly. \r\n\r\n```python\r\nfrom fastapi import FastAPI, Depends, Request\r\n\r\nasync def user_dep() -> int:\r\n    user = 0\r\n    return user\r\n\r\nasync def add_request_state(request: Request, user: int = Depends(user_dep)):\r\n    request.state.user = user\r\n\r\napp = FastAPI(dependencies=[Depends(add_request_state)])\r\n\r\n@app.middleware(\"http\")\r\nasync def add_logs(request: Request, call_next):\r\n    response = await call_next(request)\r\n    print (\"some logging logic for user\", request.state.user)\r\n    print (\"response status code: \", response.status_code)\r\n    return response\r\n\r\n\r\n@app.get(\"/test\")\r\nasync def logged(user: int=Depends(user_dep)):\r\n    return user\r\n\r\n# Test behavior\r\nfrom fastapi.testclient import TestClient\r\nclient = TestClient(app)\r\nclient.get('/test')\r\n```\r\n> some logging logic for user 0\r\n> response status code:  200", "source": "bug_issue", "type": "bug_solution", "issue_number": 117}
{"instruction": "Debug this error: Scale FastApi with sync endpoints", "input": "```\nimport logging\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\nlogger = logging.getLogger()\r\n\r\n@app.get(\"/\")\r\ndef root():\r\n    logger.info(f\"Running on {os.getpid()}\")\r\n    time.sleep(3600)\r\n    return {\"message\": \"Hello World\"}\n\n```", "output": "Notes for the reader:\r\n\r\n- Concurrency is when 2 or more tasks are being performed at the same time, which might mean that only 1 of them is being worked on while the other ones are paused.\r\n\r\n- Parallelism is when 2 or more tasks are executing at the same time.\r\n\r\nConcurrency:\r\n\r\n- gunicorn: --workers, spawn different processes\r\n- gunicorn: --threads, per worker spawn threads, threads share memory in the same worker\r\n- Async: pseudo threads, asyncio uses one thread & one process, and allows concurrency by jumping between coroutines (async functions)\r\n\r\nParallelism:\r\n- gunicorn: --workers\r\n- gunicorn: --threads\r\n\r\nIn your example you are using the workers, and the issue that is occurring is that the work is not balanced of the workers.\r\n\r\nAccording to the documentation:\r\n\r\n    The default synchronous workers assume that your application is resource-bound in terms of CPU and network bandwidth.\r\n\r\nAnd:\r\n\r\n    Gunicorn relies on the operating system to provide all of the load balancing when handling requests.\r\n\r\nif an application is CPU bound (\"resource bound\") than workers are ideal, if an application is I/O bound threads or pseudo threads are ideal.\r\n\n\n+ is there any reason why async is not an option?\n\n@extreme4all because we're using not asyncio compatible library (a snowflake driver of sqlalchemy", "source": "bug_issue", "type": "error_debug", "issue_number": 116}
{"instruction": "How to fix: Scale FastApi with sync endpoints", "input": "### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options üëÜ\n\n### Example Code\n\n```python\nimport logging\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\nlogger = logging.getLogger()\r\n\r\n@app.get(\"/\")\r\ndef root():\r\n    logger.info(f\"Running on {os.getpid()}\")\r\n    time.sleep(3600)\r\n    return {\"message\": \"Hello World\"}\n```\n\n\n### Description\n\nI've noticed lately that we have some latency problems when the servers are busy. I dived into it and found out that, if for example, I have four uvicorn workers, while one worker is very busy, the rest three are significantly less busier. That has two problems - \r\n1. We're not taking advantage of all our parallelism power\r\n2. We're suffering more from Python's GIL problems on the same worker.\r\n\r\nIn the example code, if I run it with `gunicorn main:app --workers 4 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000`, the first five requests will result in the following output - \r\n```\r\nINFO:root:Running on 643\r\nINFO:root:Running on 643\r\nINFO:root:Running on 643\r\nINFO:root:Running on 643\r\nINFO:root:Running on 642\r\n```\r\n\r\nI investigated uvicorn workers and found out they use asyncio [server](https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.Server) interface, which accepts new connections on python's event loop, which means that as long we're using not-async endpoints (which run on AnyIo threads), there is no limit on the number of new connections a worker gets, which again takes us back to the GIL problem.\r\n\r\nTo sum it all up, I'm a little confused about what is my best option for using FastApi with not-async endpoints and get better performance. Should I use more workers? Should I use more container instances?\r\nMaybe we should implement a new worker which able to control better multithreading on such cases ? I have some implementation ideas for this purpose, but I‚Äôd like to have your advice here.\n\n### Operating System\n\nLinux\n\n### Operating System Details\n\n-\n\n### FastAPI Version\n\n0.88.0\n\n### Python Version\n\n3.9.4\n\n### Additional Context\n\n-", "output": "Notes for the reader:\r\n\r\n- Concurrency is when 2 or more tasks are being performed at the same time, which might mean that only 1 of them is being worked on while the other ones are paused.\r\n\r\n- Parallelism is when 2 or more tasks are executing at the same time.\r\n\r\nConcurrency:\r\n\r\n- gunicorn: --workers, spawn different processes\r\n- gunicorn: --threads, per worker spawn threads, threads share memory in the same worker\r\n- Async: pseudo threads, asyncio uses one thread & one process, and allows concurrency by jumping between coroutines (async functions)\r\n\r\nParallelism:\r\n- gunicorn: --workers\r\n- gunicorn: --threads\r\n\r\nIn your example you are using the workers, and the issue that is occurring is that the work is not balanced of the workers.\r\n\r\nAccording to the documentation:\r\n\r\n    The default synchronous workers assume that your application is resource-bound in terms of CPU and network bandwidth.\r\n\r\nAnd:\r\n\r\n    Gunicorn relies on the operating system to provide all of the load balancing when handling requests.\r\n\r\nif an application is CPU bound (\"resource bound\") than workers are ideal, if an application is I/O bound threads or pseudo threads are ideal.\r\n\n\n+ is there any reason why async is not an option?\n\n@extreme4all because we're using not asyncio compatible library (a snowflake driver of sqlalchemy", "source": "bug_issue", "type": "bug_solution", "issue_number": 116}
{"instruction": "How to fix: [Feature Request - Community Feedback needed] Additional Responses", "input": "How do we add additional responses (e.g. 401, 403, 500, etc..) to the documentation other than the default 200 response and the 422 validation error response?", "output": "Did you check this link https://fastapi.tiangolo.com/tutorial/response-status-code/ ?\n\n@kurtrottmann I did, but that's only for changing the status code of the main (only) response. I'm wondering if it's possible to add documentations of the error responses.\n\nThanks @kurtrottmann for helping here! That's highly appreciated :tada: :taco: \r\n\r\n---\r\n\r\n@pulitz There's still no defined way to declare them.\r\n\r\nI knew this would happen, but I didn't want to define the API/functionality for that yet, as I wanted to hear feedback for you guys (and other developers), before implementing it.\r\n\r\n---\r\n\r\n### Here's the problem/situation:\r\n\r\nWhen defining a single response model and status code, no matter what is actually returned by the path operation function, it will be converted to that model (and filtered by it) and that status code will be returned.\r\n\r\nIf we have more than one possible status code, the path operation function has to return a Starlette `Response` (instead of a plain `dict` or Pydantic model), with the final content already converted to the correct JSON data (maybe filtered by the correct Pydantic model) and the correct status code. That has to be done inside the path operation *function*, independently of the declared responses and status codes in the path operation *decorator* (the ones that appear in the OpenAPI generated schema).\r\n\r\nThis is because there is no way for FastAPI (actually for Python) to know what are all the possible values/data returned by the path operation function.\r\n\r\n### What has to be done:\r\n\r\nSo, this would mean, that the declared model and status code has to be declared twice (code repetition :disappointed: , that in this case, we can't avoid). Once in the path operation decorator (to declare it for the generated OpenAPI schema) and once inside the path operation function, to actually return it.\r\n\r\n### The question, requested feedback:\r\n\r\nIn summary, declaring additional response models/schemas and status codes will be \"way more complex\" than declaring a single one. Actually, it won't be that difficult, but will not be super-intuitive and simple, which is the ideal for FastAPI (and is what all the rest tries to achieve).\r\n\r\nI can think of two options:\r\n\r\nAn additional parameter for the path operation decorator, something like `extra_responses` (is that parameter name intuitive enough? any alternatives?).\r\n\r\nThis parameter could receive:\r\n\r\n* Option A: A `dict` mapping status codes (numbers) to Pydantic models. The schema of those Pydantic models would be the optional response schemas for each status code.\r\n    * This option would probably be the more simple and Pythonic, as Pydantic is just plain Python types. But it requires creating and using those additional classes.\r\n    * By using additional Pydantic models, it would be possible to have them in the top level OpenAPI definitions and reference them, as is currently done for the `response_model` parameter. And they could be used by other OpenAPI based client code generators. For example, creating TypeScript interfaces automatically (if you don't know what that is, don't worry about the term).\r\n* Option B: A `dict` mapping status codes to sub-`dict`s with the actual JSON Schema (OpenAPI schema) of the response.\r\n    * This option would require writing the actual output JSON Schema directly, or calling the schema method from Pydantic models by hand.\r\n    * It would allow declaring additional responses inside of the same path operation decorator, without needing to declare anything else outside of the path operation. And would give the maximum flexibility, as the contents would be almost \"free-form\". Although, there's no gain in the \"free-form\" that I can think of, as Pydantic supports all (or almost all) the possible declarations with JSON Schema.\r\n\r\n* Option C: A `dict` mapping status codes to sub-`dict`s containing keys for the `description` (a `str`), `headers` (a `dict`), `content` (here's where the schemas live), the `content` could have the output schema as a `dict` directly, or we could add support for the `example`, `examples`, `schema` and `encoding`.\r\n* Option D: The same as Option C, but instead of having each schema as a `dict`, receive Pydantic models.\r\n    * Options C and D are the most complex, also the most complete (with respect to OpenAPI).\r\n\r\n### References\r\n\r\nOpenAPI operation object, that contains `responses`: https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#operationObject\r\n\r\nOpenAPI responses object that contains each `response`: https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#responsesObject\r\n\r\nOpenAPI response object that contains each field, and `content`, referencing a \"Media Type Object\" (that contains the actual schema): https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.md#responseObject\r\n\r\nOpenAPI Media Type object (that contains the actual `schema`): https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.2.m", "source": "bug_issue", "type": "bug_solution", "issue_number": 115}
{"instruction": "How to fix: How to pass list in query parameters?", "input": "**Description**\r\n\r\nI need to support several query parameters with same name in GET route. Typical request looks like this:\r\nhttp://localhost/item?num=1&num=2\r\n\r\nI configured a route\r\n````\r\n@app.get(\"/item\", content_type=UJSONResponse)\r\nasync def get_part(num: list):\r\n    found = False\r\n    for i in num:\r\n         if i in some_data:\r\n             found = True\r\n             break\r\n    return {\"found\": found}\r\n````\r\nThe idea is, that I can pass several numbers to check, if they exist in some_data. In my opinion, it is not a good idea to get numbers from body here, because it is a simple GET request, but in current version application expects argument \"num\" in body, so on my request (written above) I receive a response\r\n\r\n`{\"detail\":[{\"loc\":[\"body\",\"num\"],\"msg\":\"field required\",\"type\":\"value_error.missing\"}]}`\r\n\r\nAs I know, it is not restricted to pass several query parameters with the same name in an HTTP request by any specifications, so I would like to ask, is it possible to configure a route in FastAPI, which will be able to parse several query parameters with the same name?", "output": "It is supported (and tested), but not documented yet, but you can just use standard Python types (a `List`) :)\r\n\r\n```Python\r\nfrom typing import List\r\n\r\nfrom fastapi import FastAPI, Query\r\n\r\napp = FastAPI()\r\n@app.get(\"/items/\")\r\ndef read_items(q: List[int] = Query(None)):\r\n    return {\"q\": q}\r\n```\n\nIt is now properly documented :memo: :tada: \r\n\r\nFor query parameters: https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#query-parameter-list-multiple-values\r\n\r\nAnd for duplicate headers: https://fastapi.tiangolo.com/tutorial/header-params/#duplicate-headers\n\nI guess this is solved now, so I'll close the issue. But feel free to add more comments or create new issues.", "source": "bug_issue", "type": "bug_solution", "issue_number": 114}
{"instruction": "How to fix: Only show documentation while logged in", "input": "**Description**\r\n\r\nIs it possible to only show the documentation based on being logged in? Many times I create an API which should only expose it's documentation when somebody is logged in.", "output": "Sorry for the delay.\r\n\r\nIn short, **yes** *.\r\n\r\n*Now goes the \"it depends\"...\r\n\r\n## Long version\r\n\r\nHow are you logging in users?\r\n\r\n### Simplest, less secure\r\n\r\nThe simplest, less secure option I can imagine, is embeding your Swagger UI in your frontend, and show it selectively on if the user is authenticated or not.\r\n\r\n### FastAPI security\r\n\r\nFastAPI doesn't enforce a specific way to log in users, but you can use several approaches, e.g.:\r\n\r\n* JWT tokens in HTTP headers.\r\n* Session Cookies.\r\n* HTTP Basic Auth.\r\n* ...others.\r\n\r\n### OAuth2 JWT tokens\r\n\r\n**spoiler**: I think this wouldn't work for you.\r\n\r\nThe suggestion in the docs, using OAuth2 with the \"password flow\" (JWT tokens in HTTP headers), involves the following steps:\r\n\r\n* The client sends a `POST` with form data, including `username` and `password`.\r\n* The server returns a JSON body with an `access_token`.\r\n* For the next requests, to authenticated endpoints, the client sends that access token in a header.\r\n* The server checks that access token in the header, validates it, etc, and returns the content.\r\n\r\nUsing that, it is common to hold that access token in memory in the client (in a JS variable) or in `localStorage`. And then, when the client (your JS code in the browser) requests a protected endpoint, it sends the access token in the HTTP header. But you have to code it explicitly.\r\n\r\nNow, when you open the browser in the docs (Swagger UI), it doesn't automatically send any token from anywhere, because it would have to be added explicitly in code, taken from wherever you put it.\r\n\r\n### Cookies\r\n\r\nAnother option would be to use Cookies. Because the browser sends those Cookies automatically. But in that case, the API and the Swagger UI must live in the same host (the same combination of `http` or `https` and domain), for the browser to actually send the Cookies.\r\n\r\nBut still, all that doesn't change the actual `/openapi.json` endpoint to be available. So, you might want to use Cookies to override it too.\r\n\r\n### Basic Auth\r\n\r\nAnother simpler option would be to protect those endpoints with HTTP Basic Auth. So, the browser would show the default authentication pop-up and would remember the credentials used there for some time. But that would be more or less disconnected from your current authentication system.\n\nThanks for your elaborate answer! I will check-out the OAuth2 JWT token, Cookies and Basic Auth options and see what the best route is. Is there an easy / quick way to add a Depends / Security option to the documentation endpoints? \n\nYes, it is relatively easy to add dependencies to those endpoints. You can create your `FastAPI` removing the automatic docs endpoints: https://fastapi.tiangolo.com/tutorial/application-configuration/#docs-urls\r\n\r\nAnd then you can create them by hand, using the utils from `fastapi.openapi.docs`, there's a `get_swagger_ui_html` and `get_redoc_html` functions. There you can create the endpoints/path operations as normally.\r\n\r\nBut the next problem (probably the main one) is how to authenticate the user and where, outside the docs endpoints.", "source": "bug_issue", "type": "bug_solution", "issue_number": 113}
{"instruction": "How to fix: How to work with form data?", "input": "Hello everyone!\r\nI need to process form data but I can't do that with fastapi. To try understand how can I do it I used Postman to send data in different ways:\r\nfrom form-data tab\r\nfrom x-www-form-urlencoded\r\nwith header \"Content-Type: application/x-www-form-urlencoded\"\r\nwith header \"Content-Type: application/json\"\r\nwithout headers\r\n\r\nIn any case I have the same result: {\"detail\": \"There was an error parsing the body\"}.\r\n\r\n![postman](https://user-images.githubusercontent.com/22984590/57228831-54404d80-7047-11e9-8fa6-4502b8a29dca.png)\r\n\r\n```\r\nfrom fastapi import FastAPI, HTTPException, Form\r\n\r\n@app.post(\"/subscription_email\")\r\ndef subscription_email(*, customers: int = Form(...)):\r\n    return customers\r\n```\r\nCode based on example from docs.\r\n\r\nPlease, help me to fix it and understand how to work woth form data from POST requests.", "output": "Here is what I'm using for file upload (using forms):\r\n\r\nhttps://fastapi.tiangolo.com/tutorial/request-forms-and-files/\r\n\r\n    @router.post(\"/nanopubs/import/file\", tags=[\"Nanopubs\"])\r\n    def import_nanopubs(\r\n        file: UploadFile = File(...),\r\n        overwrite: bool = Query(False, description=\"Overwrite if exists when true\"),\r\n        validation: bool = Query(True, description=\"Validate nanopub when true\"),\r\n        email: str = Query(\"\", description=\"Will send email with processing results\"),\r\n    ):\r\n\r\n        if file:\r\n            contents = file.file.read().decode(\"utf-8\")\r\n            try:\r\n                nanopubs = json.loads(contents)\r\n            except Exception as e:\r\n                log.error(\"Error reading nanopub json content\", error=str(e))\r\n\n\n@wshayes thank you for advice. It works fine with query parameters but still doesn't work with data from form fields.\n\nyour example works fine out of the box with the swagger generated at /docs\r\n\r\nedit: email doesnt support markdown, see screens below\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 112}
{"instruction": "How to fix: Choices Dropdown Menu in API Documentation", "input": "**Feature Request:**\r\n\r\nIt would be nice to document in the API, which what choices are available to the user as a drop-down menu in the UI. It helps prevent such documentation in the description\\help of the parameter.  \r\n\r\n**Context**\r\n`flask_restplus` library is able to show choices in its Swagger UI, and is able to handle if incorrect choice is provided as an input by the user.  \r\n![Selection_005](https://user-images.githubusercontent.com/43503284/58156014-6dffa880-7c75-11e9-9d35-3c32150a3596.png)\r\n\r\n**Preferred Solution:**\r\nWould like to see `choices` parameter added to possibly `fastapi.Query` class and possibly other classes that handle input from user. \r\nWould be awesome if it was something like this\r\n```\r\n@api.get('/get_countries')\r\ndef get_something(\r\n    choice: str = Query('eu', choices=('eu,'us','cn,'ru'), description='foo bar')\r\n):\r\n    do_something(choice)\r\n``` \r\n\r\nWould be nice to see this feature in `FastAPI`, as I/We would prefer to use `FastAPI` over `flask_restplus`.", "output": "after some digging it seems it works out of the box:\r\n\r\n![Imgur](https://i.imgur.com/tRCaRXM.png)\r\n\r\n```\r\nimport uvicorn\r\n\r\nfrom fastapi import FastAPI, Query\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get('/get_countries')\r\nasync def get_countries(_q: str = Query(\"eu\", enum=[\"eu\", \"us\", \"cn\", \"ru\"])):\r\n    return {\"selected\": _q}\r\n\r\n\r\nif __name__ == '__main__':\r\n    uvicorn.run(\"test_swagger_dropdown:app\", reload=True)\r\n```\n\nThanks @euri10 for your help!\r\n\r\nLater I'll add full `Enum` support for query values too, that way, apart from showing up in Swagger UI,  Pydantic validates the values given.\n\nThanks a lot! This will work! Can't wait for full support!", "source": "bug_issue", "type": "bug_solution", "issue_number": 111}
{"instruction": "How to fix: Add support for Pydantic's dataclasses", "input": "**Describe the question**\r\nI am using a  pydantic.dataclasses.dataclass as a response_model of my fast api route.\r\n\r\n\r\n```\r\nfrom fastapi import FastAPI\r\nfrom pydantic.dataclasses import dataclass\r\n\r\n\r\n@dataclass\r\nclass Foo:\r\n    bar: int\r\n\r\napp = FastAPI()\r\n\r\n@app.get('/foo', response_model=Foo)\r\ndef get_bar() -> Foo:\r\n    return Foo(bar=1)\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a file **app.py** with the above code.\r\n2. Start the app: `uvicorn app:app`\r\n3. Open the browser and go to **localhost:8000/foo**\r\n4. See error: \r\n```\r\npydantic.error_wrappers.ValidationError: 1 validation error\r\nresponse\r\n  __init__() got an unexpected keyword argument '__initialised__' (type=type_error)\r\n```\r\n\r\n**Expected behavior**\r\nNo validation error and serialized json does not contain any keys `__initialised__`.\r\n\r\n\r\n**Environment:**\r\n - OS: Linux\r\n - FastAPI Version 0.25.0\r\n- Python version 3.7.3", "output": "**Possible solution**\r\n\r\nAdd the following to jsonable_encoder in fastapi.encoders:\r\n\r\n```\r\nfrom dataclasses import is_dataclass, asdict\r\n\r\ndef jsonable_encoder(\r\n    obj: Any,\r\n    include: Set[str] = None,\r\n    exclude: Set[str] = set(),\r\n    by_alias: bool = True,\r\n    skip_defaults: bool = False,\r\n    include_none: bool = True,\r\n    custom_encoder: dict = {},\r\n    sqlalchemy_safe: bool = True,\r\n) -> Any:\r\n...\r\n    if is_dataclass(obj):\r\n        return asdict(obj)\r\n```\n\nThank you. Pydantic's dataclasses are not supported yet. They probably will be at some point.\n\nUsing pydantic BaseModel vs dataclass causes tremendous slowdown as well in my codebase.", "source": "bug_issue", "type": "bug_solution", "issue_number": 110}
{"instruction": "How to fix: Issue when debugging inside docker", "input": "**Describe the bug**\r\nWhen I run pdb in docker I run into issues if I have reload enabled.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\nfrom starlette.requests import Request\r\n\r\nimport sys\r\nsys.path.insert(0, '.')\r\nfrom app.api.api import api_router\r\nfrom app.core import config\r\nfrom app.db.session import Session\r\n\r\n\r\napp = FastAPI(title='App')\r\napp.include_router(api_router, prefix=config.API_V1_STR)\r\n\r\n\r\n@app.middleware(\"http\")\r\nasync def db_session_middleware(request: Request, call_next):\r\n   \r\n    # This set_trace crashes only if I started uvicorn with `debug=True`\r\n    import pdb; pdb.set_trace()\r\n   \r\n    request.state.db = Session()\r\n    response = await call_next(request)\r\n    request.state.db.close()\r\n    return response\r\n\r\n\r\n# For debugging\r\nif __name__ == \"__main__\":\r\n    import uvicorn\r\n    uvicorn.run(\"main:app\", host=\"0.0.0.0\", port=80, reload=True, debug=True)\r\n```\r\n\r\n**Expected behavior**\r\nI should be able to use pdb, but instead get an `bdb.BdbQuit` exception. This doesn't happen if I run outside docker or if I run inside docker but remove `reload=True` argument.\r\n\r\n**Environment:**\r\n`FROM tiangolo/uvicorn-gunicorn:python3.7`", "output": "I have no idea what could be causing this, but my guess is that it's more likely to be a uvicorn issue than a fastapi issue. I'd recommend trying with a non-fastapi (and ideally non-starlette-based) framework -- if you have the same problem hitting breakpoints, it would indicate the problem is in uvicorn.\r\n\r\n@euri10 any other suggestions for debugging in docker? (If I recall you have some experience with this.)\n\nI'm using pycharm which uses pydevd iirc so no experience with pdb.\nMy guess is that uvicorn reload uses another process and afaik you cant pbd in another process,hence the behavior with reload only. \nBut you should ask in uvicorn imho, if a simple asgi app crashes the same. \n\n@euri10 that's a good insight -- I definitely think the separate process issue could explain the problem", "source": "bug_issue", "type": "bug_solution", "issue_number": 109}
{"instruction": "How to fix: Post results to Error 405 Method not Allowed", "input": "Used the very code on the docs for simple posting and it only allows me to use get", "output": "actually the log shows im using GET although in code im using POST\r\n\n\nWhat was the resolution for this issue? I am getting same behavior.\n\nThanks @Finix21 for reporting back and closing the issue :+1: \r\n\r\n@nikhilno1 you might want to follow the tutorial exactly as is. With the integrated docs UI to send the POST and confirm that it works. Then you can check in your own code, gradually what is different.", "source": "bug_issue", "type": "bug_solution", "issue_number": 108}
{"instruction": "How to fix: Handling Exception Response format", "input": "Hello.\r\nI want to change the validation error response and make it inside `app` object.\r\n\r\nI've found this example:\r\n```\r\n@app.exception_handler(RequestValidationError)\r\nasync def validation_exception_handler(request: Request, exc: RequestValidationError):\r\n    return JSONResponse(\r\n        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,\r\n        content=jsonable_encoder({\"detail\": exc.errors(), \"body\": exc.body}),\r\n    )\r\n```\r\n\r\nBut can't understand how to add this function to `app` object without decorator:\r\n```\r\napp = FastAPI(\r\n    title='Bla API',\r\n    description='Bla description',\r\n    APIRoute('/api', api.toggle, methods=['POST'],\r\n             description='Switch interface state',\r\n             response_description='Interface successfully switched',\r\n             response_class=JSONResponse,\r\n             response_model=api.Success,\r\n             responses={**api.post_responses},\r\n             ),\r\n...\r\n\r\n```", "output": "Why is the use of decorators problematic? Defininig pretty much anything inside the FastAPI constructor like that is certainly an uncommon way to do things and much of the discussion in #687 was about how that approach would be likely to be less ergonomic for routes when taking FastAPI's goals into account (like how Path parameters would end up split between the route declaration and the function signature).\r\n\r\nIt's not currently possible to do that with `exception_hadler` with FastAPI right now (upstream Starlette versions support that, but it causes compatibility issues with FastAPI, see #683), but why do you want to do that with the exception handler?\n\nI have an app that has both GUI (rendering HTML page) and API.\r\nIt is pretty convenient to keep code of web view in one module and API code in another one, then import these modules and build an app object.\r\nThis approach just keeps everything in its own place.\r\n\r\nThis is how I like it:\r\n```\r\n\r\nimport api\r\nfrom views import home\r\n\r\nstatics = StaticFiles(directory=\"statics\", packages=[\"bootstrap4\"])\r\n\r\n\r\napp = FastAPI(\r\n    title='Yandex.Cloud Netinfra API',\r\n    description='A bundled API for Yandex.Cloud Netinfra team tools',\r\n    routes=[\r\n        Route('/', home, methods=['GET', 'POST']),\r\n        APIRoute('/api', api.check, methods=['GET'], tags=['VlanToggler'],\r\n                 # name='String replaces function name on Swagger API page',\r\n                 # summary='String replaces function name AND name on Swagger API page',\r\n                 description='Get current interface state',\r\n                 response_description='Successfully got interface state',\r\n                 response_class=JSONResponse,\r\n                 response_model=api.Success,\r\n                 responses={**api.get_responses}\r\n                 ),\r\n        APIRoute('/api', api.toggle, methods=['POST'], tags=['VlanToggler'],\r\n                 description='Switch interface state',\r\n                 response_description='Interface successfully switched',\r\n                 response_class=JSONResponse,\r\n                 response_model=api.Success,\r\n                 responses={**api.post_responses},\r\n                 ),\r\n        Mount('/statics', statics, name='static'),\r\n    ],\r\n)\r\n```\n\nSo you're defining each route in separate modules, importing each of them in your app module and then declaring your routes inside your constructor? Usually you would want to either [create an `APIRouter` in these modules and do something like this](https://fastapi.tiangolo.com/tutorial/bigger-applications/):\r\n\r\n```py\r\nfrom api import api_router\r\napp.include_router(api_router, prefix='/api')\r\n```\r\n\r\n...or build secondary app objects for your API and your HTML views and [mount those onto your primary app](https://fastapi.tiangolo.com/advanced/sub-applications-proxy/#mounting-a-fastapi-application):\r\n\r\n```py\r\nfrom api import api_app\r\napp.mount('/api', api_app)\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 107}
{"instruction": "How to fix: about qps", "input": "# Description\r\n\r\nThe simple get 'hello world' server crashed when I send more than 510 requests in a second to the fastAPI.\r\n\r\n```\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n@app.get(\"/\")\r\ndef read_root():\r\n    return \"Hello World\"\r\n```\r\n\r\nHow to improve qps for it?\r\n\r\nI‚Äòve checked and can't find an effective way in question[https://github.com/tiangolo/fastapi/issues/603](https://github.com/tiangolo/fastapi/issues/603) or any other issues.\r\n\r\nMy environments:\r\nwin10 1903\r\nPython 3.7.5 64bit\r\nfastapi 0.52.0\r\nuvicorn 0.11.3\r\n\r\nused module grequests to send the requests.\r\n```\r\nimport grequests, time, collections\r\n\r\ndef qps_test(url, N):\r\n    start_time = time.time()\r\n    res_list = grequests.map([\r\n        grequests.get(url) \r\n        for _ in range(N)\r\n    ])\r\n    print(f'time: {time.time() - start_time}\\nstatue_code:')\r\n    print('\\n'.join(\r\n        f'{k}: {v}'\r\n        for k, v in collections.Counter(\r\n            res is None and 'LOST' or res.status_code\r\n            for res in res_list\r\n        ).items()\r\n    ))\r\n\r\nif __name__ == '__main__':\r\n    qps_test('http://127.0.0.1:8000/', 500)\r\n    # qps_test('http://127.0.0.1:8000/', 511) #crashed\r\n```\r\n\r\n`uvicorn main:app --reload` run in cmd (follow the docs).\r\nand i also tried `uvicorn main:app` , the same.\r\n\r\nerror message:\r\n\r\n`Process SpawnProcess-1:\r\nTraceback (most recent call last):\r\n  File \"d:\\python37\\lib\\multiprocessing\\process.py\", line 297, in _bootstrap\r\n    self.run()\r\n  File \"d:\\python37\\lib\\multiprocessing\\process.py\", line 99, in run\r\n    self._target(*self._args, **self._kwargs)\r\n  File \"d:\\python37\\lib\\site-packages\\uvicorn\\subprocess.py\", line 61, in subprocess_started\r\n    target(sockets=sockets)\r\n  File \"d:\\python37\\lib\\site-packages\\uvicorn\\main.py\", line 382, in run\r\n    loop.run_until_complete(self.serve(sockets=sockets))\r\n  File \"d:\\python37\\lib\\asyncio\\base_events.py\", line 566, in run_until_complete\r\n    self.run_forever()\r\n  File \"d:\\python37\\lib\\asyncio\\base_events.py\", line 534, in run_forever\r\n    self._run_once()\r\n  File \"d:\\python37\\lib\\asyncio\\base_events.py\", line 1735, in _run_once\r\n    event_list = self._selector.select(timeout)\r\n  File \"d:\\python37\\lib\\selectors.py\", line 323, in select\r\n    r, w, _ = self._select(self._readers, self._writers, [], timeout)\r\n  File \"d:\\python37\\lib\\selectors.py\", line 314, in _select\r\n    r, w, x = select.select(r, w, w, timeout)\r\nValueError: too many file descriptors in select()`", "output": "What is the code of your hello world server?\r\n\r\nAlso see https://stackoverflow.com/questions/47675410/python-asyncio-aiohttp-valueerror-too-many-file-descriptors-in-select-on-win\n\n> What is the code of your hello world server?\r\n> \r\n> Also see https://stackoverflow.com/questions/47675410/python-asyncio-aiohttp-valueerror-too-many-file-descriptors-in-select-on-win\r\n\r\nthanks for comments\r\n\r\n```\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n@app.get(\"/\")\r\ndef read_root():\r\n    return \"Hello World\"\r\n```\r\n\r\ni also tried to run in power shell, but still not work, and it much slower than in cmd.\r\n\r\nand i worte a c-extern for it yesterday, but it doesn't work, doesn't real set the maxstdio in python program.\r\n\r\nc:\r\n```\r\n#include<stdio.h>\r\n\r\nvoid set_max_stdio()\r\n{\r\n    printf(\"%d \\n\", _getmaxstdio()); // stdout 512\r\n    _setmaxstdio(2048); // If the parameter is bigger than 2048, it changes back to 512\r\n    printf(\"setmaxstdio: %d \\n\", _getmaxstdio()); // stdout 2048\r\n}\r\n```\r\npython:\r\n```\r\nfrom ctypes import cdll\r\ncdll.LoadLibrary(\"./setmaxstdio.so\").set_max_stdio()\r\n```\r\n\r\ni checked it in stackoverflow, but still have no idea how to set it in main.py\n\nany reason to use the `--reload` flag ?", "source": "bug_issue", "type": "bug_solution", "issue_number": 106}
{"instruction": "How to fix: Use TestClient in an async fashion", "input": "### Is your feature request related to a problem\n\nUnfortunately, test client runs it's own event loop. This causes an issue when attempting to do other async operations in the background.\nRunning it inside an executor will cause it to run in a different threat, which in turn causes issues with other async libraries a they're calling coroutines from a different thread.\n\n### The solution you would like\n\nMake a TestClient that doesn't create it's own loop. Just have it async. \n\n### Describe alternatives you've considered\n\nOther than executor or partching fastapi, there are no alternatives.", "output": "There are plans (https://github.com/encode/starlette/issues/440 and https://github.com/encode/starlette/issues/652) to move `starlette.testclient.TestClient` from `requests` to `httpx` to fix this behaviour. Before this happens you can try using `httpx` [directly](https://www.python-httpx.org/async/#calling-into-python-web-apps) or try the [`async-asgi-client`](https://pypi.org/project/async-asgi-testclient/) package. But there may be some problems with the templates, if you are using them.\n\nAs long as fastapi doesn't support it, may I suggest adding a note to the docs? \n\nYes, good idea. I think adding an [`info`](https://squidfunk.github.io/mkdocs-material/extensions/admonition/#info) block after the introduction on [this](https://fastapi.tiangolo.com/tutorial/testing/) page will be good place, right? \r\n\r\nIn addition, it is possible to create a new page that will show how to use `httpx` (or `async-asgi-client`) for tests. Probably in the advanced section. \r\n\r\nWould you submit a PR?", "source": "bug_issue", "type": "bug_solution", "issue_number": 105}
{"instruction": "How to fix: FastAPI and Uvicorn is running synchronously and very slow", "input": "I'm new in FastAPI and i'm testing file uploads and asyncronous requests. However, when i perform several request with clients parallel and serial the FastAPI process each upload in Queue (synchronously) and very slow. I'm performing the API with uvicorn and gunicorn and with 1 worker. With both execution the time spent was the same.\r\n\r\nMy client send 4 files with approximately 20MB in parallel (or in serial) for FastAPI endpoint, however, it is storing the files one at a time and very slow.\r\n\r\nI made the same upload with a aiohttp endpoint and the files was stored in approximately 0.6 seconds with client making request in parallel (multiprocessing) and 0.8 seconds with client making request in serial (in mean). When i made this uploads in FastAPI the files was stored in approximately 13 seconds with client making parallel request and 15 seconds with client making serial request (in mean)\r\n\r\nWould I like know if i'm making anything wrong?\r\n\r\n\r\n### Server Code\r\n\r\n```python\r\n\r\n# app.py\r\n\r\nfrom fastapi import FastAPI, File, UploadFile\r\nimport random\r\nimport aiofiles\r\nimport os\r\n\r\napp = FastAPI()\r\n\r\nSTORAGE_PATH = 'storage'\r\n\r\n@app.post(\"/\")\r\nasync def read_root(file: UploadFile=File('teste')):\r\n    fpath = os.path.join(\r\n        STORAGE_PATH, f'{random.randint(0, 5000)}_{file.filename}'\r\n    )\r\n    async with aiofiles.open(fpath, 'wb') as f:\r\n        content = await file.read()\r\n        await f.write(content)\r\n\r\n    return {\"Test\": \"Test\"}\r\n\r\n\r\n# uvicorn app:app --host 0.0.0.0 --port 8000 --workers 1\r\n# gunicorn -w=1 -k=uvicorn.workers.UvicornWorker --bind=0.0.0.0:8000 app:app\r\n```\r\n\r\n\r\n### Client Code\r\n```python\r\nFILES = ['f1.txt', 'f2.txt', 'f3.txt', 'f4.txt' ]\r\n\r\ndef request(fname):\r\n    files = {'file': open(fname,'rb')} \r\n    requests.post(\"http://localhost:8000/\", files=files)\r\n\r\n\r\ndef req_mp():\r\n    start = datetime.now() \r\n    pool = Pool(4) \r\n    pool.map(request, FILES) \r\n    print(datetime.now() - start)\r\n\r\n\r\ndef req_serial():\r\n    start = datetime.now()  \r\n    for fn in FILES:    \r\n        request(fn)\r\n    print(datetime.now() - start)\r\n```", "output": "aiofiles itself is very slow, I would try re-running this using open and write directly, which will block but will probably be faster\r\n\r\nfile.read() is also going to read the entire file then put i into memory, which I believe under the covers may be a blocking operation despite saying async\r\n\r\nI would try the following which may not work, alternatively you can use `async read(bytes)` to choose the rate at which you read and then write it.\r\n\r\n```python\r\n    async with aiofiles.open(fpath, 'wb') as f:\r\n        for line in file:\r\n            await f.write(content)\r\n```\r\n\r\nIf you really want to have non blocking uploads you'll need to send a binary stream, and read it directly from the body, that's how I'm handling multi gb uploads in my own system.\n\nThanks for answer @chris-allnutt. I don't know exactly how do make \"async read(bytes)\" . i made another tests, with others algorithm and the result also was slow. I changed the algorithm for write file asynchronously (chunk by chunk) and the result was the same.\r\n### New test 1\r\n```python\r\nwith open(fpath, 'wb') as f:\r\n    content = await file.read(4096)\r\n    f.write(content)\r\n\r\n# uvicorn - time spent: 8 seconds - client serial (req_serial)\r\n# uvicorn - time spent: 6 seconds - client parallel (req_mp)\r\n# gunicorn - time spent: 6 seconds - client - parallel (req_mp)\r\n# gunicorn - time spent: 6 seconds - client serial (req_serial)\r\n```\r\n### New test 2\r\n```python\r\nasync with aiofiles.open(fpath, 'wb') as f:\r\n    while True:\r\n    chunk = await file.read(4096)\r\n    if not bool(chunk):\r\n        break\r\n        await f.write(chunk)\r\n # uvicorn - time spent: 15 seconds - client serial (req_serial)\r\n # uvicorn - time spent: 12 seconds - client parallel (req_mp)\r\n # gunicorn - time spent: 13 seconds - client serial (req_serial)\r\n # gunicorn - time spent: 12 seconds - client parallel (req_mp)\r\n```\r\n\r\nthis same algorithm was used in my tests with aiohttp and the read and write was asyncronously in fact with time between 0.8 and 0.4  seconds (aproximately) for save files. I made these tests with django with all operations sincronouly and the all files are written between 1.2 and 1.8 seconds.\r\n\r\nAnother thing i saw, when i send the requests, exists a delay until request are processed by python code.\r\n\r\nI saw many benchmarks and fastAPI and Uvicorn has great results. But, I can't verify the performance optimization that the tool offers in the tests I'm doing.\r\n\r\nI'd like to use FastAPI in my next projects, but, unfortunately this basic tests aren't show very nice results.\n\n<del>Well here nobody wants to sell you anything</del>, but could you post your OS and Python version?", "source": "bug_issue", "type": "bug_solution", "issue_number": 104}
{"instruction": "How to fix: Depends object returned instead of session", "input": "I am currently trying to migrate from flask to fastapi and trying to keep my files separated. My depends is not called from my routes but from within my crud file but similar to the documentation for relational databases: https://fastapi.tiangolo.com/tutorial/sql-databases/\r\n\r\nThis was my initial way of using a database session which is similar to the sqlalchemy docs\r\nAlso, is this bad practice or is it okay to use this and a mix of depends? I did kind of want to decouple sqlalchemy from fastapi.\r\n```python\r\ndef get_database():\r\n    db = scoped_session(default_session)\r\n    try:\r\n        yield db\r\n    finally:\r\n        db.close()\r\n\r\ndef get_references(db: scoped_session = next(get_database())):\r\n    references = db.query(Reference).all()\r\n    return references\r\n```\r\n\r\nI then tried to switch and use Depends but am getting the same issue as others below with my attempts added at the end:\r\n\r\n> > I am seeing this same issue in .52 using almost verbatim the doc examples with postgres. Depends is not calling the function but returning what appears to be an instantiate Depends object.\r\n> \r\n> @pspierce and @H0r53, Did you solve this? I am seeing in 0.58.1. I also tried: instead of using generator, returning the db directly -- same problem.\r\n\r\n```python\r\nfrom sqlalchemy import create_engine\r\nfrom sqlalchemy.orm import scoped_session, sessionmaker\r\n\r\nengine = create_engine('postgresql://postgres:postgres@localhost:5432/postgres', echo=True)\r\ndefault_session = scoped_session(sessionmaker(autocommit=False,\r\n                                         autoflush=False,\r\n                                         bind=engine))\r\n\r\ndef get_database():\r\n    db = default_session()\r\n    try:\r\n        yield db\r\n    finally:\r\n        db.close()\r\n\r\n```\r\n\r\n\r\nFirst error I got:\r\n\r\n> AttributeError: 'Depends' object has no attribute 'query'\r\n\r\n```python\r\nfrom database.data import get_database, scoped_session\r\nfrom database.models.reference import Reference\r\nfrom fastapi import Depends\r\n\r\n\r\ndef get_references(db: scoped_session = Depends(get_database())):\r\n    references = db.query(Reference).all()\r\n    return references\r\n```\r\n\r\nWithout Depends:\r\n\r\n> AttributeError: 'generator' object has no attribute 'query'\r\n```python\r\ndef get_references(db: scoped_session = get_database()):\r\n```\r\n\r\n_Originally posted by @BrainABar in https://github.com/tiangolo/fastapi/issues/631#issuecomment-655614557_", "output": "As I can see, you calling `get_database` directly in function arguments, but you have to pass function object into Depends in order to make injection. In your case you should rewrite `def get_references` as:\r\n```\r\ndef get_references(db: scoped_session = Depends(get_database)):\r\n    references = db.query(Reference).all()\r\n    return references\r\n```\n\nJust to complement: `Depends` receives a callable.\r\nThere's something that there's a miss concept when you do this:\r\n```\r\ndef get_references(db: scoped_session = Depends(get_database())):\r\n```\r\nNotice that `Depends` is not receiving a callable, you're calling `get_database()`. Which means that `Depends` will not receive the callable, and will try to solve it without success. That's why you're having the current error.\r\n\r\nAs @SirTelemak said, you should use this notation:\r\n```\r\ndef get_references(db: scoped_session = Depends(get_database)):\r\n```\r\nAnd here you can see that `get_database` is not being called. Now `Depends` can successfully solve it.\r\n\r\nPs.: You can still use the last notation, without `Depends`, but the problem is that you're getting a generator in your snippet. To solve it you should use `next`. I don't recommend this approach, but I'll show you anyway:\r\n```\r\ndef get_references(db: scoped_session = next(get_database())):\r\n```\r\nor:\r\n```\r\ndef get_references(db: scoped_session = get_database()):\r\n    # some_var = next(db)\r\n```\n\n> Ps.: You can still use the last notation, without `Depends`, but the problem is that you're getting a generator in your snippet. To solve it you should use `next`. I don't recommend this approach, but I'll show you anyway:\r\n> \r\n> ```\r\n> def get_references(db: scoped_session = next(get_database())):\r\n> ```\r\n> \r\n> or:\r\n> \r\n> ```\r\n> def get_references(db: scoped_session = get_database()):\r\n>     # some_var = next(db)\r\n> ```\r\n\r\nWhy do you not recommend this approach? My first example was like the example you put.\r\n\r\nI ended getting the initial approach cause I was declaring in its own module. I ended up reading somewhere that it might be because it was outside of my routes but I did not dig further yet since I was unsure if sqlalchemy's way was enough for my use case.", "source": "bug_issue", "type": "bug_solution", "issue_number": 103}
{"instruction": "How to fix: AsyncClient ignores the startup and shutdown events", "input": "This is very close to #1072, but for AsyncClient.\r\n\r\nThe problem is that AsyncClient ignores the startup and shutdown events. \r\n\r\n# To Reproduce\r\n\r\nSteps to reproduce the behavior with a minimum self-contained file.\r\n\r\nReplace each part with your own scenario:\r\n- Create a main.py file with:\r\n\r\n```python\r\nfrom fastapi import FastAPI, Request\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\nasync def read_main():\r\n    return {\"msg\": \"Hello World\"}\r\n\r\n\r\nasync def add_test_header(request: Request, call_next):\r\n    response = await call_next(request)\r\n    response.headers[\"X-Test-Header\"] = 'Hello'\r\n    return response\r\n\r\n\r\n@app.on_event(\"startup\")\r\ndef setup():\r\n    # example code that runs on startup\r\n    global add_test_header\r\n    print('executing startup!!')\r\n    add_test_header = app.middleware(\"http\")(add_test_header)\r\n```\r\n\r\n- Create a test_startup.py file with:\r\n\r\n```python\r\nimport pytest\r\n\r\nfrom httpx import AsyncClient\r\n\r\nfrom main import app\r\n\r\n\r\n@pytest.fixture()\r\nasync def client():\r\n    async with AsyncClient(app=app, base_url=\"http://test\") as \r\n        yield client\r\n\r\n\r\n@pytest.mark.asyncio\r\nasync def test_read_main(client):\r\n    response = await client.get(\"/\")\r\n    assert response.status_code == 200\r\n    assert response.json() == {\"msg\": \"Hello World\"}\r\n    assert 'X-Test-Header' in response.headers\r\n```\r\nRun pytest -s -v test_startup.py\r\nYou will see an AssertionError for the X-Test-Header not being there\r\nThe test should pass\r\n\r\n\r\n\r\nSo far I am using a hack to make it work:\r\n```python\r\n@pytest.fixture()\r\nasync def client():\r\n    \"\"\"Test client pytest fixture.\r\n\r\n    Example:\r\n        >>> from httpx import Response\r\n        >>>\r\n        >>>\r\n        >>> @pytest.mark.asyncio\r\n        >>> async def test_health_check(client):\r\n        >>>    resp: Response = await client.get(\"/health_check\")\r\n        >>>    assert resp.status_code == 200\r\n\r\n    \"\"\"\r\n    app = build_app()\r\n    async with AsyncClient(app=app, base_url=\"http://test\") as client:\r\n        await connect_to_db(app)\r\n        yield client\r\n    await db_teardown(app)\r\n```\r\n\r\nbut probably some solution or a note in the docs would compliment the project", "output": "If a minimal example is provided, others can check. :tada: \n\n@Kludex pls take a look one more time\n\n@ZhukovGreen \r\nYou're using `httpx` and it's `AsyncClient` which i don't believe supports test?\r\nYou can use `pip install async_asgi_testclient` \r\n\r\nWhich will look like this:\r\n```\r\nimport pytest\r\n\r\nfrom main import app\r\nfrom async_asgi_testclient import TestClient\r\n\r\n\r\n@pytest.fixture\r\nasync def client():\r\n    async with TestClient(app) as client:\r\n        yield client\r\n\r\n\r\n@pytest.mark.asyncio\r\nasync def test_read_main(client):\r\n    response = await client.get(\"/\")\r\n    assert response.status_code == 200\r\n    assert response.json() == {\"msg\": \"Hello World\"}\r\n    assert 'X-Test-Header' in response.headers\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 102}
{"instruction": "How to fix: Error 422: Unprocessable entity when I send form data from JS script", "input": "#### Backend\r\n```py\r\nfrom fastapi import FastAPI, File, Form, UploadFile, Request\r\nfrom fastapi.middleware.cors import CORSMiddleware\r\n\r\napp = FastAPI()\r\n\r\norigins = [\"http://127.0.0.1:5500\"]\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=origins,\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\n\r\n@app.post(\"/test\")\r\ndef test(username: str = Form(...)):\r\n    print(f\"########### Received {username} #############\")\r\n```\r\n### Frontend\r\n```js\r\nasync function sendData() {\r\n    formData = new FormData();\r\n    formData.append('username', 'Kareem');\r\n    const response = await fetch('http://127.0.0.1:8000/test', {\r\n        method: 'POST',\r\n        data: formData\r\n    })\r\n    console.log(response)\r\n```\r\n### Response\r\n```\r\nResponse {\r\nbody: (...)\r\nbodyUsed: false\r\nheaders: Headers {}\r\nok: false\r\nredirected: false\r\nstatus: 422\r\nstatusText: \"Unprocessable Entity\"\r\ntype: \"cors\"\r\nurl: \"http://127.0.0.1:8000/test\"\r\n__proto__: Response }\r\n```\r\n### Description\r\n- The `/test` endpoint is simply supposed to recieve a form containing only `username` and print it out.\r\n- When I test the API using swagger docs it works fine as expected, but when I try to send form data from an external script it throws me this error and that response object above.\r\n### Environment\r\n- OS: Linux\r\n- FastAPI version: 0.61.1\r\n- Python version: 3.8.2", "output": "Try sending a request with a header.\r\n\r\n```javascript\r\nconst response = await fetch('http://127.0.0.1:8000/test', {\r\n        method: 'POST',\r\n        data: formData,\r\n        headers: {'content-type': 'multipart/form-data'}\r\n    })\r\n```\n\n@ycd the error is now `400 Bad request`\n\nWhat is the error in the response?", "source": "bug_issue", "type": "bug_solution", "issue_number": 101}
{"instruction": "How to fix: FastAPI+Uvicorn is running slow than Flask+uWSGI", "input": "I'm new to fastapi and I'm trying to test speed between fastapi and flask, but I didn't get a better result by fastapi. pls tell me if I'm making anything wrong?\r\n\r\n### Example\r\n1. fastapi\r\n```Python\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI(debug=False)\r\n\r\n@app.get(\"/\")\r\nasync def run():\r\n    return {\"message\": \"hello\"}\r\n```\r\n+ run command: `uvicorn --log-level error --workers 4 fastapi_test:app > /dev/null 2>&1 `\r\n\r\n2. flask\r\n```Python\r\nimport flask\r\n\r\napp = flask.Flask(__name__)\r\n\r\n@app.route(\"/\")\r\ndef run():\r\n    return {\"message\": \"hello\"}\r\n```\r\n+ run command: `uwsgi --wsgi-file flask_test.py --process 4 --callable app --http :8000 > /dev/null 2>&1`\r\n\r\n### Result\r\n* use `ab -n 10000 -c 500 http://127.0.0.1:8000/` to test speed\r\n1. FastApi\r\n```\r\nRequests per second:    1533.91 [#/sec] (mean)\r\nTime per request:       325.965 [ms] (mean)\r\nTime per request:       0.652 [ms] (mean, across all concurrent requests)\r\nTransfer rate:          244.17 [Kbytes/sec] received\r\n\r\nConnection Times (ms)\r\n              min  mean[+/-sd] median   max\r\nConnect:        0   46 208.1      0    1000\r\nProcessing:     1  268 171.1    245     950\r\nWaiting:        0  201 146.1    174     909\r\nTotal:          1  314 296.7    246    1918\r\n```\r\n2. Flask\r\n```\r\nRequests per second:    1829.40 [#/sec] (mean)\r\nTime per request:       273.313 [ms] (mean)\r\nTime per request:       0.547 [ms] (mean, across all concurrent requests)\r\nTransfer rate:          162.57 [Kbytes/sec] received\r\n\r\nConnection Times (ms)\r\n              min  mean[+/-sd] median   max\r\nConnect:        0   18 131.3      0    1000\r\nProcessing:    12  192 556.3     36    4302\r\nWaiting:        0  191 556.3     35    4301\r\nTotal:         17  210 612.7     36    5300\r\n```\r\n\r\n### Environment\r\n\r\n* OS: CentOS 7\r\n* Python Version: 3.9.1\r\n* FastAPI Version: 0.63.0\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context or screenshots about the question here. -->", "output": "> I'm new to fastapi and I'm trying to test speed between fastapi and flask, but I didn't get a better result by fastapi. pls tell me if I'm making anything wrong?\r\n> \r\n> ### Example\r\n> 1. fastapi\r\n> \r\n> ```python\r\n> from fastapi import FastAPI\r\n> \r\n> app = FastAPI(debug=False)\r\n> \r\n> @app.get(\"/\")\r\n> async def run():\r\n>     return {\"message\": \"hello\"}\r\n> ```\r\n> \r\n> * run command: `uvicorn --log-level error --workers 4 fastapi_test:app > /dev/null 2>&1 `\r\n> \r\n> 1. flask\r\n> \r\n> ```python\r\n> import flask\r\n> \r\n> app = flask.Flask(__name__)\r\n> \r\n> @app.route(\"/\")\r\n> def run():\r\n>     return {\"message\": \"hello\"}\r\n> ```\r\n> \r\n> * run command: `uwsgi --wsgi-file flask_test.py --process 4 --callable app --http :8000 > /dev/null 2>&1`\r\n> \r\n> ### Result\r\n> * use `ab -n 10000 -c 500 http://127.0.0.1:8000/` to test speed\r\n> \r\n> 1. FastApi\r\n> \r\n> ```\r\n> Requests per second:    1533.91 [#/sec] (mean)\r\n> Time per request:       325.965 [ms] (mean)\r\n> Time per request:       0.652 [ms] (mean, across all concurrent requests)\r\n> Transfer rate:          244.17 [Kbytes/sec] received\r\n> \r\n> Connection Times (ms)\r\n>               min  mean[+/-sd] median   max\r\n> Connect:        0   46 208.1      0    1000\r\n> Processing:     1  268 171.1    245     950\r\n> Waiting:        0  201 146.1    174     909\r\n> Total:          1  314 296.7    246    1918\r\n> ```\r\n> \r\n> 1. Flask\r\n> \r\n> ```\r\n> Requests per second:    1829.40 [#/sec] (mean)\r\n> Time per request:       273.313 [ms] (mean)\r\n> Time per request:       0.547 [ms] (mean, across all concurrent requests)\r\n> Transfer rate:          162.57 [Kbytes/sec] received\r\n> \r\n> Connection Times (ms)\r\n>               min  mean[+/-sd] median   max\r\n> Connect:        0   18 131.3      0    1000\r\n> Processing:    12  192 556.3     36    4302\r\n> Waiting:        0  191 556.3     35    4301\r\n> Total:         17  210 612.7     36    5300\r\n> ```\r\n> \r\n> ### Environment\r\n> * OS: CentOS 7\r\n> * Python Version: 3.9.1\r\n> * FastAPI Version: 0.63.0\r\n> \r\n> ### Additional context\r\n\r\nWell... you're using \"async def\" in the FastAPI example when you're doing zeeo asynchronous operations in the endpoint. Try make it a normal function, then re-run the benchmarks.\n\nFor a more detailed benchmark, check [TechEmpowers](https://www.techempower.com/benchmarks/#section=data-r19&hw=ph&test=composite&l=zijzen-1r&f=0-jz6rk-4ftog0-0-5jrvnk-1ekg-29gxz6-hragaq-4fuwq0-5jw554-0)\r\n\r\n Framework | JSON | 1-query | 20-query | Fortunes | Updates | Plaintext \r\n -- | -- | -- | -- | -- | -- | -- \r\nfastapi | 171,055 | 66,185 | 13,022 | 52,080 | 5,926 | 159,445 | 1,212 \r\n flask | 63,026 | 34,217 | 6,647 | 23,136 | 1,327 | 83,398 | 465\r\n\r\n\n\nI believe using Uvicorn's Gunicorn worker class along with gunicorn offers more performance than the uvicorn workers", "source": "bug_issue", "type": "bug_solution", "issue_number": 100}
{"instruction": "How to fix: Gunicorn on Google Cloud Run get an 504 error status (Upstream Request Timeout)", "input": "Why my gunicorn always get a 504 error status code when I open my URL from Cloud Runabout 15 seconds for the first time, and after that the URL can be opened without an error. But after I leave it without opening the URL for about 30-60 minutes, it will return the 504 error again? Is my Gunicorn dead/shutdown? Because when i check it from my Cloud Run log, my gunicorn got a `Shutting down`, and I think my gunicorn was dead. So I need to keep my Gunicorn always on, but how can I make it to set my gunicorn always on?\r\n\r\nMy code at startup need to load the Machine Learning Model that got a 1 pickle about 100MB, in my case I need to load 6 pickle file (around 600mb++), and I use FastAPI for my API code.\r\n\r\nThis is how my pickle load :\r\n```python\r\n# Load all model\r\n@app.on_event(\"startup\")\r\nasync def load_model():\r\n    # Pathfile\r\n    pathfile_model = os.path.join(\"modules\", \"model/\")\r\n    pathfile_data = os.path.join(\"modules\", \"data/\")\r\n\r\n    start_time = time.time()\r\n\r\n    # Load Model\r\n    usedcar.price_engine_4w = {}\r\n    top5_brand = [\"honda\", \"toyota\", \"nissan\", \"suzuki\", \"daihatsu\"]\r\n    for i in top5_brand:\r\n        with open(pathfile_model + f'{i}_all_in_one.pkl', 'rb') as file:\r\n            usedcar.price_engine_4w[i] = pickle.load(file)\r\n    with open(pathfile_model + 'ex_Top5_all_in_one.pkl', 'rb') as file:\r\n        usedcar.price_engine_4w['non'] = pickle.load(file)\r\n\r\n    # Load Dataset Match\r\n    with open(pathfile_data + settings.DATA_LIST) as path:\r\n        usedcar.list_match_seva = pd.read_csv(path)\r\n\r\n    elapsed_time = time.time() - start_time\r\n\r\n    print(\"======================================\")\r\n    print(\"INFO  : Model loaded Succesfully\")\r\n    print(\"MODEL :\", usedcar.price_engine_4w)\r\n    print(\"ELAPSED MODEL TIME : \", elapsed_time)\r\n```\r\n\r\nHere are how my main.py code run :\r\n```python\r\nif __name__ == \"__main__\":\r\n    uvicorn.run(app, host=\"0.0.0.0\", port=8080, log_level=\"info\", loop=asyncio)\r\n```\r\n\r\nThis is my Dockerfile :\r\n```Dockerfile\r\nFROM python:3.8-slim-buster\r\nRUN apt-get update --fix-missing\r\nRUN DEBIAN_FRONTEND=noninteractive apt-get install -y libgl1-mesa-dev python3-pip git\r\nRUN mkdir /usr/src/app\r\nWORKDIR /usr/src/app\r\nCOPY ./requirements.txt /usr/src/app/requirements.txt\r\nRUN pip3 install -U setuptools\r\nRUN pip3 install --upgrade pi\r\nRUN pip3 install -r ./requirements.txt --use-feature=2020-resolver\r\nCOPY . /usr/src/app\r\nCMD exec gunicorn --bind :8080 --workers 2 --threads 4 main:app --worker-class uvicorn.workers.UvicornH11Worker --preload --timeout 60 --worker-tmp-dir /dev/shm\r\n```\r\n\r\nThis is my requirements for uvicorn and gunicorn :\r\n```shell\r\nfastapi\r\nfastapi-utils\r\nuvicorn[standard]\r\ngunicorn\r\n```\r\n\r\nThis is my Cloud Run Log :\r\n```shell\r\n2021-02-15 14:31:54.346 WIT[2021-02-15 07:31:54 +0000] [1] [INFO] Handling signal: term\r\n2021-02-15 14:31:54.385 WIT[2021-02-15 07:31:54 +0000] [11] [INFO] Shutting down\r\n2021-02-15 14:31:54.386 WIT[2021-02-15 07:31:54 +0000] [12] [INFO] Shutting down\r\n2021-02-15 14:31:54.4", "output": "Could you give us your Cloud Run configuration (or the command you make to deploy your service)? By default, Cloud Run instances start with 256 Mb of RAM so, given the size of your model, I suspect you run out of memory.\n\n@frankie567 Oh sorry, I forgot to attach my Cloud Run Configuration:\r\n\r\nThis is for build and submit:\r\n```shell\r\ngcloud builds submit --tag gcr.io/subscription/priceengine-3rd-iteration\r\n```\r\n\r\nThis is for Cloud Run:\r\n```shell\r\ngcloud run deploy priceengine \\\r\n    --image=\"gcr.io/subscription/priceengine-3rd-iteration\" \\\r\n    --region asia-southeast2 \\\r\n    --allow-unauthenticated \\\r\n    --platform managed \\\r\n    --memory 4Gi \\\r\n    --cpu 2 \\\r\n    --set-env-vars \"SECRET_API_KEY=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\" \\\r\n    --set-env-vars \"PROJECT_ID=subscription\" \\\r\n    --add-cloudsql-instances database:asia-southeast2:price-engine \\\r\n    --set-env-vars \"DATA_LIST=20210105_Dictionary_List_Model_Variant.csv\" \\\r\n    --set-env-vars \"DATABASE_URL_API=postgres+pg8000://user:user@/api?unix_sock=/cloudsql/database:asia-southeast2:price-engine/.s.PGSQL.5432\" \\\r\n    --set-env-vars \"DATABASE_URL_CAR=postgres+pg8000://user:user@/api_database?unix_sock=/cloudsql/database:asia-southeast2:price-engine/.s.PGSQL.5432\" \\\r\n    --project=subscription\r\n```\r\n\r\nI've set my memory 4Gi and CPU 2 core.\n\nThanks! May I suggest to increase Cloud Run timeout:\r\n\r\n* https://cloud.google.com/sdk/gcloud/reference/run/deploy?hl=fr#--timeout\r\n* https://cloud.google.com/run/docs/configuring/request-timeout\r\n\r\nIt clearly states that a 504 error is triggered when the timeout is reached.", "source": "bug_issue", "type": "bug_solution", "issue_number": 99}
{"instruction": "How to fix: Ability to define response_model with native typing", "input": "### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\n\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\n\r\nclass TypicalResponse(BaseModel):\r\n    msg: str\r\n    data: int\r\n\r\n\r\n@app.get(\"/add/{x}/{y}\")\r\nasync def add(x: int, y: int) -> TypicalResponse:\r\n    return TypicalResponse(msg=\"Done!\", data=x + y)\r\n```\r\n\r\n\r\n### Description\r\n\r\nOpen the automatic doc on this handler\r\nSee no output schema defined\r\nI would like to use typing \"-> *Type*\" for annotate response model.\r\nThis is good for simple handlers.\r\n\r\n### Wanted Solution\r\n\r\nI would like to autodoc parse this typing same as \"response_model=TypicalResponse\"\r\n\r\n### Wanted Code\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\n\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\n# Same\r\nclass TypicalResponse(BaseModel):\r\n    msg: str\r\n    data: int\r\n\r\n\r\n@app.get(\"/add/{x}/{y}\")\r\nasync def add(x: int, y: int) -> TypicalResponse:\r\n    return TypicalResponse(msg=\"Done!\", data=x + y)\r\n```\r\n\r\n\r\n### Alternatives\r\n\r\nI use kwarg \"response_model\" as single alternative\r\nBut typing already defines the output model, necessary duplicate as result.\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.79.0\r\n\r\n### Python Version\r\n\r\nPython 3.9.0\r\n\r\n### Additional Context\r\n\r\nWithout patch:\r\n![–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](https://user-images.githubusercontent.com/109909821/182039698-0e3a5a77-eed4-4840-ab16-85c9333a7aef.png)\r\n\r\n\r\nWith patch:\r\n![–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](https://user-images.githubusercontent.com/109909821/182039688-d23be71c-5e9c-4e2c-a0f6-1b35319936e7.png)\r\n\r\nI think second is better by avoid information duplication\r\n\r\nMeanwhile, solution is quite simple.\r\nOne of the ways to implement (don't judge too much, that's first idea):\r\n\r\n1. Open APIRouter class\r\n2. Modify `self.add_api_route` by adding\r\n![–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ](https://user-images.githubusercontent.com/109909821/182039543-ef289246-4ae4-49d3-bbc3-bb4947ffb239.png)\r\n\r\nMay be dirty, so welcome to search another ways.", "output": "> May be dirty, so welcome to search another ways.\r\n\r\nNot at all dirty! I like the idea, it is more 'pythonic' and best of all its additional to current practice, so in the future it could be decided to phase it out. If you want, I can put a pull request together. \n\n> Not at all dirty! I like the idea, it is more 'pythonic' and best of all its additional to current practice, so in the future it could be decided to phase it out. If you want, I can put a pull request together.\r\n\r\nI am highly interested, why this \"**essential**\" feautre didn't imlemented earlier.\r\nMaybe some hidden problems in corner cases or something else.\r\n\r\nP.S. I think it's essential\n\nYeah I am just thinking about that, for example when you have multiple return types (anyOf situation in OpenAPI), but that would still work actually. I'll run the test suite, see what happens.\r\n\r\nI don't agree that it is \"essential\" as the functionality is now already there, well documented and in use by literally thousands of projects, but  I do think it is more idiomatic. ", "source": "bug_issue", "type": "bug_solution", "issue_number": 98}
{"instruction": "How to fix: Use third party class as property in pydantic schema", "input": "**Describe the bug**\r\nI have a pydantic schema that needs a third party class (bson.objectid.ObjectID) as a property. For this reason I created a custom validator and encoder as per pydantic documentation.\r\n<details><summary>Code</summary>\r\n<p>\r\n\r\n```python\r\nfrom bson.objectid import ObjectId\r\nfrom pydantic import BaseModel\r\nfrom pydantic import validators\r\nfrom pydantic.errors import PydanticTypeError\r\nfrom pydantic.utils import change_exception\r\n\r\nclass ObjectIdError(PydanticTypeError):\r\n    msg_template = 'value is not a valid bson.objectid.ObjectId'\r\n\r\ndef object_id_validator(v) -> ObjectId:\r\n    with change_exception(ObjectIdError, ValueError):\r\n        v = ObjectId(v)\r\n    return v\r\n\r\ndef get_validators() -> None:\r\n    yield validators.not_none_validator\r\n    yield object_id_validator\r\n\r\nObjectId.__get_validators__ = get_validators\r\n\r\ndef encode_object_id(object_id: ObjectId):\r\n    return str(object_id)\r\n\r\nclass UserId(BaseModel):\r\n    object_id: ObjectId = None\r\n\r\n    class Config:\r\n        json_encoders = {\r\n            ObjectId: encode_object_id\r\n        }\r\n\r\nclass User(UserId):\r\n    email: str\r\n    salt: str\r\n    hashed_password: str\r\n\r\n# Just for testing\r\nuser = User(object_id = ObjectId(), email=\"john.doe@example.com\", salt=\"12345678\", hashed_password=\"letmein\")\r\nprint(user.json())\r\n# Outputs:\r\n# {\"object_id\": \"5c7e424225e2971c8c548a86\", \"email\": \"john.doe@example.com\", \"salt\": \"12345678\", \"hashed_password\": \"letmein\"}\r\n```\r\n\r\n</p>\r\n</details></br>\r\n\r\nAs you can see at the bottom of the code, the serialization seems to work just fine. But when I use this schema as an argument (and/or response type) in API operations and then open the automatic documentation, I get presented with an error.\r\n\r\n<details><summary>Code</summary>\r\n<p>\r\n\r\n```python\r\nfrom bson import ObjectId\r\nfrom fastapi import FastAPI\r\nfrom user import User, UserId\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.post(\"/user\", tags=[\"user\"], response_model=UserId)\r\ndef create_user(user: User):\r\n    # Create user and return id\r\n    print(user)\r\n    return UserId(objectId=ObjectId())\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<details><summary>Log</summary>\r\n<p>\r\n\r\n```\r\nINFO: ('127.0.0.1', 2706) - \"GET /openapi.json HTTP/1.1\" 500\r\nERROR: Exception in ASGI application\r\nTraceback (most recent call last):\r\n  File \"<project-path>\\venv\\lib\\site-packages\\uvicorn\\protocols\\http\\h11_impl.py\", line 373, in run_asgi\r\n    result = await asgi(self.receive, self.send)\r\n  File \"<project-path>\\venv\\lib\\site-packages\\uvicorn\\middleware\\debug.py\", line 83, in __call__\r\n    raise exc from None\r\n  File \"<project-path>\\venv\\lib\\site-packages\\uvicorn\\middleware\\debug.py\", line 80, in __call__\r\n    await asgi(receive, self.send)\r\n  File \"<project-path>\\venv\\lib\\site-packages\\starlette\\middleware\\errors.py\", line 125, in asgi\r\n    raise exc from None\r\n  File \"<project-path>\\venv\\lib\\site-packages\\starlette\\middleware\\errors.py\", line 103, in asgi\r\n    await asgi(receive, _send)\r\n  File \"<project-path>\\venv\\lib\\site-packages\\starlet", "output": "Thanks for the report, sorry for the delay.\r\n\r\nI see/assume you are using MongoDB, right?\r\n\r\nI hope to check and debug it soon, but it might take a bit as I have to set up a stack with mongo (and I don't have a project generator with Mongo just yet).\n\nThanks for your response.\r\n\r\nYou are right, I'm using MongoDB.\r\nBut the problem isn't related to MongoDB, so I don't think you need it to debug the error.\r\n\r\nYou just need to install the following pip packages:\r\n- FastAPI\r\n- bson\r\n\r\nAnd then put the first code snippet in a module called `user.py` and the second one into some arbitrary module (e.g. `server.py`). When you then start the server and open the automatic documentation in your browser, you should be greeted by the error in the `Log` accordion above.\r\n\r\n_Note: I had to slightly modify my code snippets to make it possible to just copy-paste them._\r\n\r\n\n\nExcellent, I'll use that to debug/develop it.", "source": "bug_issue", "type": "bug_solution", "issue_number": 97}
{"instruction": "How to fix: How to manage relationships in (pydantic) models", "input": "EDIT: add proper greetings üôÑ \r\n\r\nHi guys,\r\n\r\nMany thanks for this fantastic repo. It rocks. Not to mention https://dockerswarm.rocks/, I am now in the process to review all my projects from this base ü•á \r\n\r\n**Here is my question :**\r\n\r\nHow can I declare a one-to-many relationship in the pydantic models?\r\n\r\n**Context**\r\n\r\nI have a first object 'Rule', that is attached to a second 'City'.\r\n\r\nI have tried the following without success :\r\n\r\nrules.py\r\n```\r\nfrom app.models.cities import City\r\n\r\nclass RuleBase(BaseModel):\r\n    mode: Optional[RuleMode] = None\r\n    value: Optional[float] = None\r\n    city: Optional[City] = None\r\n```\r\n\r\n\r\ncities.py\r\n```\r\nclass City(BaseModel):\r\n    id: int\r\n    name: str\r\n    rules: Optional[List['Rule']]\r\n```\r\n\r\nError in tests:\r\n\r\n```\r\nImportError while loading conftest '/app/app/tests/conftest.py'.\r\napp/app/tests/conftest.py:4: in <module>\r\n    from app.models.cities import City, Rectangle, Point\r\napp/app/models/cities.py:50: in <module>\r\n    class City(BaseModel):\r\nusr/local/lib/python3.6/site-packages/pydantic/main.py:179: in __new__\r\n    config=config,\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:118: in infer\r\n    schema=schema,\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:87: in __init__\r\n    self.prepare()\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:152: in prepare\r\n    self._populate_sub_fields()\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:177: in _populate_sub_fields\r\n    self.sub_fields = [self._create_sub_type(t, f'{self.name}_{display_as_type(t)}') for t in types_]\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:177: in <listcomp>\r\n    self.sub_fields = [self._create_sub_type(t, f'{self.name}_{display_as_type(t)}') for t in types_]\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:210: in _create_sub_type\r\n    model_config=self.model_config,\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:87: in __init__\r\n    self.prepare()\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:153: in prepare\r\n    self._populate_validators()\r\nusr/local/lib/python3.6/site-packages/pydantic/fields.py:228: in _populate_validators\r\n    else find_validators(self.type_, self.model_config.arbitrary_types_allowed)\r\nusr/local/lib/python3.6/site-packages/pydantic/validators.py:326: in find_validators\r\n    raise RuntimeError(f'error checking inheritance of {type_!r} (type: {display_as_type(type_)})') from e\r\nE   RuntimeError: error checking inheritance of _ForwardRef('Rule') (type: _ForwardRef('Rule'))\r\n```\r\n\r\nCheers,\r\nEmmanuel", "output": "It won't answer your question exactly but I feel it's the same pattern where you have recursivity and declare an attribute of a model while that depends on another not yet created\r\n\r\nmy model looks like this :\r\n\r\n```\r\n<LoggerModel name='root' level=20 children=[<LoggerModel name='__main__' level=10 children=[]>, <LoggerModel name='__mp_ma‚Ä¶>\r\n```\r\n\r\n```\r\nfrom __future__ import annotations\r\n\r\nfrom typing import ForwardRef, List, Optional\r\n\r\nfrom pydantic import BaseModel\r\n\r\nListLoggerModel = ForwardRef(\"List[LoggerModel]\")\r\n\r\nclass LoggerModel(BaseModel):\r\n    name: str\r\n    level: Optional[int]\r\n    children: ListLoggerModel = None\r\n\r\n\r\nLoggerModel.update_forward_refs()\r\n```\n\nThanks for the hint!\r\n\r\nI got an ImportError with python 3.6.8\r\n\r\n```\r\n>>> from typing import ForwardRef\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nImportError: cannot import name 'ForwardRef'\r\n```\r\n\r\nTherefore I installed python 3.7.3 and that solved the issue.\r\n\r\nProbably something to report to https://github.com/tiangolo/full-stack-fastapi-postgresql, from which I started from :)\n\nForwardref is a python 3 thing indeed, maybe there s a way to achieve the\nsame without, @tiangolo will know for sure !\n\nLe ven. 12 avr. 2019 √† 7:59 PM, Manu <notifications@github.com> a √©crit :\n\n> Thanks for the hint!\n>\n> I got an ImportError with python 3.6.8\n>\n> >>> from typing import ForwardRef\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n> ImportError: cannot import name 'ForwardRef'\n>\n> Therefore I installed python 3.7.3 and that solved the issue.\n>\n> Probably something to report to\n> https://github.com/tiangolo/full-stack-fastapi-postgresql, from which I\n> started from :)\n>\n> ‚Äî\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/153#issuecomment-482667182>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABDZPnowf6UmatNDVrS7YpgPPMgkXMCnks5vgMlkgaJpZM4csUX5>\n> .\n>\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 96}
{"instruction": "How to fix: Hooks to modify request and response body", "input": "How can I modify request body before it's accessed by the api handler and response body before it's returned by the handler?\r\n\r\nIs it possible to implement a middleware or view hooks to change the request body and response body as needed?\r\n\r\n**Additional context**\r\nI am working on implementing API versioning with FastAPI using [Stripe's approach](https://stripe.com/blog/api-versioning). As I understand, it requires modifying the request body and response body depending on requested version of the API. I've been experimenting with different approaches but unable to find a clean way to do it. I've tried implementing it as a middleware but it doesn't seem like the right place. So my question is, are there any hooks that I can rely on to modify the incoming request and modify the response. Thanks!", "output": "@tiangolo has made it really easy to work with the middleware - it's the way I'd handle this if I was doing it the way you are - of course using the mounts - it's really easy to handle /api/v1/... and /api/v2/... in the same application:\r\n\r\nhttps://fastapi.tiangolo.com/tutorial/middleware/\r\n\n\nThank you for your input @wshayes. What I am trying to achieve is slightely different but your suggestion definitely pointed me in the right direction.\n\nThanks for your help @wshayes !\r\n\r\n@nav you might also want to look at `APIRouter`s, with them you can add an API prefix to a whole set of routes/path operations: https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-prefix-tags-and-responses", "source": "bug_issue", "type": "bug_solution", "issue_number": 95}
{"instruction": "How to fix: Awaiting request body in middleware blocks the application", "input": "**Describe the bug**\r\nDescription in the title\r\n\r\n**To Reproduce**\r\nMinimal code:\r\n```\r\nfrom typing import Mapping\r\n\r\nfrom fastapi import FastAPI\r\nfrom starlette.requests import Request\r\n\r\napp = FastAPI()\r\n\r\n@app.middleware(\"http\")\r\nasync def func(request: Request, call_next):\r\n    print(await request.json())\r\n    return await call_next(request)\r\n\r\n@app.post(\"/\")\r\ndef read_root(arg: Mapping[str, str]):\r\n    return {\"Hello\": \"World\"}\r\n```\r\nRun the application with ```uvicorn <file>:app```\r\nTest the bug with ```curl localhost:8000 -d '{\"status\":\"ok\"}'```\r\n\r\n**Expected behavior**\r\nThe body of the request is printed, but the curl command stay pending for ever. If it is interrupted (Ctrl-C), the application then print ```ERROR: Error getting request body:```\r\n\r\n**Environment:**\r\n - OS: macOS\r\n - fastapi 0.33.0\r\n - python 3.7.3\r\n - (tested on Ubuntu too with Python 3.7.0 and 3.7.4)\r\n\r\n**Additional context**\r\n - When the route function has no body argument (```def read_root():```), there is no problem : the body is printed and the response send.\r\n - Thinking the issue was maybe coming from Starlette, I tested the following code, which works without issue. The bug seems thus to come from fastapi\r\n```\r\nfrom starlette.applications import Starlette\r\nfrom starlette.requests import Request\r\nfrom starlette.responses import JSONResponse\r\n\r\napp = Starlette()\r\n\r\n\r\n@app.middleware(\"http\")\r\nasync def func(request: Request, call_next):\r\n    print(await request.json())\r\n    return await call_next(request)\r\n\r\n\r\n@app.route('/', methods=[\"POST\"])\r\ndef homepage(request):\r\n    return JSONResponse({\"Hello\": \"World\"})\r\n```", "output": "works fine for me copy-pasting the exact same thing, only had to comment `    print(await request.json())\r\n` which crashed the app\r\n\r\n```\r\n@app.middleware(\"http\")\r\nasync def func(request: Request, call_next):\r\n    # print(await request.json())\r\n    return await call_next(request)\r\n\r\n\r\n@app.post(\"/bug\")\r\ndef bug(arg: Mapping[str, str]):\r\n    return {\"Hello\": \"World\"}\r\n```\r\n```\r\n ‚úó curl -d '{\"status\":\"ok\"}' http://localhost:8000/bug\r\n{\"Hello\":\"World\"}%             \r\n```\n\n> works fine for me copy-pasting the exact same thing, only had to comment ` print(await request.json())` which crashed the app\r\n\r\nThat's exactly the point, the print statement, or more exactly the ``√†wait``` inside blocks the application. The question is why ?\r\nAnd the other question, more important for me is : how can I log my request payload if i'm not able to await it in middleware ?\n\nI think the middleware is unnecessary, should you want to get your payload just do:\r\n```\r\n@app.post(\"/bug\")\r\nasync def read_root(request: Request, arg: Mapping[str, str]):\r\n    print(await request.json())\r\n    return {\"Hello\": \"World\"}\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 94}
{"instruction": "How to fix: Is this the correct way to save an uploaded file ?", "input": "Hello,\r\ni am trying to save an uploaded file to disk, the following code works correctly but i wonder if it is the correct way to do that.\r\n\r\n```\r\ndef parse(file: UploadFile = File(...)):\r\n\r\n    extension = os.path.splitext(file.filename)[1]\r\n    _, path = tempfile.mkstemp(prefix='parser_', suffix=extension)\r\n\r\n    with open(path, 'wb') as f:\r\n        f.write(file.file.read())\r\n\r\n```\r\nBasically i need to get the path of the temp file.\r\nI also have tried with .rollover() but file.file.name does not return the path (only the file descriptor)", "output": "1)\r\n\r\nIt's not clear why you making a tempfile - UploadFile already does that under the hood if file size is larger then some configured amount.\r\n\r\n\r\n2)\r\n`file.file.read()` - this line can \"eat\" your entire memory if uploaded file size is larger than free memory space\r\n\r\nyou would need to read(chunk_size) in loop and write chunks to the copy\n\n@vitalik i must save the file on the disk. I know UploadFile stores the file if it is larger than free mem space but i have to save all the files i receive.\n\nwell my point is - why you use tempfile ?...\r\n\r\nfrom you code looks like you do not close the tempfile handle correctly (your \"_\" variable)\r\n\r\nread more - https://www.logilab.org/blogentry/17873", "source": "bug_issue", "type": "bug_solution", "issue_number": 93}
{"instruction": "How to fix: Body is always parsed as JSON regardless of media_type", "input": "### Describe the bug\r\n\r\nThis is to continue the discussion at https://github.com/tiangolo/fastapi/issues/579#issuecomment-589263249. `Body` accepts an argument `media_type`, but regardless of the media_type Body is parsed as JSON. This is a problem for other media_types such as `plain/text`, `application/sql`, etc. And this is not compliant to [OpenAPI content](https://swagger.io/docs/specification/describing-responses/). Body should be able to represent plain text as `str` too.\r\n\r\nBasically I wish I could do this:\r\n```python\r\nrequest: str = Body(..., media_type='text/plain')\r\n```\r\nHowever, this produces 400 parsing error because Body is parsed as JSON anyway.\r\n\r\n### To Reproduce\r\n\r\n1. Create a file with:\r\n\r\n```Python\r\nfrom fastapi import FastAPI, Body\r\n\r\napp = FastAPI()\r\n\r\n@app.post(\"/\")\r\ndef read_root(body: str = Body(..., media_type='text/plain')):\r\n    return {\"I received:\": body}\r\n```\r\n\r\n2. Run the server.\r\n\r\n3. Then execute: `curl -d 'I want to print this' -H 'Content-Type: plain/text' http://localhost:8000` \r\n\r\n4. It returns {\"detail\":\"There was an error parsing the body\"}\r\n\r\n5. But I expected it to return `{\"I received\": \"I want to print this\"}`.\r\n\r\n### Expected behavior\r\n\r\nMy expectation is that the Body should be parsed based on the Content-Type header always. \r\n\r\n### Screenshots\r\n\r\nI think the information is quite comprehensive without screenshots.\r\n\r\n### Environment\r\n\r\n- OS: Ubuntu 18.04\r\n- FastAPI Version: 0.49.0\r\n- Python 3.7.4\r\n\r\n\r\n### Additional context\r\nThe associated part is: https://github.com/tiangolo/fastapi/blob/9c3c9b6e78768374868d690bc05918d58481e880/fastapi/routing.py#L114\r\n\r\nThis does not check Content-Type. My proposal is to fix it as \r\n```python\r\nif body_bytes and request.headers['Content-Type'] == 'application/json':\r\n# if body_bytes and request.headers.get('Content-Type', 'application/json'): # if the content type should be assumed.\r\n    body = await request.json()\r\nelse:\r\n    body = body_bytes\r\n```\r\n\r\nI can make a PR for this, but I would like to learn the maintainers' opinion on this.\r\n@tiangolo @dmontagu @phy25, thanks for the great project!", "output": "Looking forward to this. I have a bunch of raw text (words from files) I want pumping into my api with a simple api as possible..\n\nI have the fix suggested above implemented, and it works in the project that I'm currently developing, but I'm unable to figure out a way to get all of the tests to pass. For example, I'm getting a test failure on `tests/test_tutorial/test_body/test_tutorial001.py` during `test_post_broken_body()`. The value of `response.status_code` is 422, which is causing the assertion of `assert response.status_code == expected_status` to fail. Any suggestions, anyone?\n\nOh, that's why I cant have a YAML body in an endpoint...\r\n\r\nWith @jbkoh's proposal, I get this error in the tests:\r\n\r\n```\r\nfastapi/routing.py:151: error: Incompatible types in assignment (expression has type \"bytes\", variable has type \"Optional[FormData]\")\r\nFound 1 error in 1 file (checked 40 source files)\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 92}
{"instruction": "How to fix: Error getting request body: The `python-multipart` library must be installed to use form parsing.", "input": "(venv) G:\\projects\\python\\fastprojects>pip list\r\n\r\npython-dateutil   2.8.1\r\npython-multipart  0.0.5\r\nrope              0.17.0\r\n\r\n```\r\n@app.post('/token', tags=['safe'])\r\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\r\n  print('form_data', form_data)\r\n  user_dict = fake_users_db.get(form_data.username)\r\n  if not user_dict:\r\n    raise HTTPException(\r\n      status_code=400,\r\n      detail='Incorrect username or password'\r\n    )\r\n  user = UserInDB(**user_dict)\r\n  hashed_password = fake_hash_password(form_data.password)\r\n  if not hashed_password == user.hashed_password:\r\n    raise HTTPException(\r\n      status_code=400,\r\n      detail='Incorrect username or password'\r\n    )\r\n  return {'access_token': user.username, 'token_type': 'bearer'}\r\n\r\n```\r\n\r\nI don't know how to troubleshoot this problem", "output": "@q98765543221 `pip install python-multipart`\n\nUsing legacy setup.py install for python-multipart, since package 'wheel' is not installed.\r\nInstalling collected packages: python-multipart\r\n    Running setup.py install for python-multipart ... done\r\nSuccessfully installed python-multipart-0.0.5\r\n\r\n?[31mERROR?[0m:    Error getting request body: The `python-multipart` library must be installed to use form parsing\r\n.\r\n?[32mINFO?[0m:     127.0.0.1:13645 - \"?[1mPOST /token HTTP/1.1?[0m\" ?[31m400 Bad Request?[0m\r\n\r\n\r\n**A new project, same error**\n\nAre you sure you're running your app in the same environment as the one you're installing `python-multipart`? ", "source": "bug_issue", "type": "bug_solution", "issue_number": 91}
{"instruction": "How to fix: How to Prevent the 307 Temporary Redirect When There's a Missing Trailing Slash", "input": "### Description\r\n\r\nJust like the author of #731, I don't want a 307 temporary redirect which is automatically sent by uvicorn when there's a missing trailing slash in the api call. However, the solution given in that issue, i.e. route path like \"/?\" no longer works in the versions after this April as reported in in #1787, #1648 and else. Certain developers states this is an unexpected behavior and won't be supported in the future. In this case, I'm wondering what is the current elegant way to realize this. Or there's any way to handle both \"\" and \"/\" two paths simultaneously?", "output": "You can have multiple decorators with path routes w/ and w/o the trailing slash.  Not incredibly elegant because then you get duplicate endpoints in your swagger docs.\r\n\r\nIt should be mentioned this is a Starlette issue. There are several issues about this in the repo, here is one of them: https://github.com/encode/starlette/issues/1008\r\n\r\nIf FastAPI could handle this, it might be to somehow identify and remove the duplicate entries in swagger docs.\n\n@falkben just use include_in_schema=False on one decorator.\n\nYours answers together is a very good workaround!", "source": "bug_issue", "type": "bug_solution", "issue_number": 90}
{"instruction": "How to fix: Choosing the Right ASGI Server for Deploying FastAPI", "input": "According to [ASGI Documentation](https://asgi.readthedocs.io/en/latest/implementations.html#servers) there are 3 ASGI Servers: [Daphne](https://github.com/django/daphne), [Hypercorn](https://pgjones.gitlab.io/hypercorn/index.html) and [Uvicorn](https://www.uvicorn.org/).\r\n\r\nFrom FastAPI's documentation to [Deploy FastAPI without Docker](https://fastapi.tiangolo.com/deployment/#alternatively-deploy-fastapi-without-docker) we could use Uvicorn or Hypercorn.\r\n\r\nBut which ASGI Server works best with FastAPI in terms of performance and scalability? A comparison chart or pros and cons between the available ASGI Servers would be helpful!\r\n\r\nAlso for Serverless Deployment what else should I consider?", "output": "As per documentation, FastAPI is built on top of Starlette which itself is built on top of Uvicorn.\r\nThe performance difference between the ASGI servers is small and arguably is not important in the grand scheme of things (aka going from flask to fast).\r\nSo the suggestion would be to use Uvicorn since it is used by FastAPI under the hood.\r\n\n\n@ArcLightSlavik My application needs to be deployed as FaaS on [AWS Lambda](https://aws.amazon.com/lambda/). Previously I used [Zappa](https://github.com/Miserlou/Zappa) for deploying flask application. I've found something similar for this purpose named [Mangum](https://mangum.io/) and [Serverless](https://www.serverless.com/).\r\n\r\nWhen my application is built with any of the mentioned framework above, the total size gets about **~500 MB**! This raises an _**error**_ uploading to AWS Lambda (as [AWS Lambda limits](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html) zip sizes to **50 MB**). [To solve this problem](https://github.com/Miserlou/Zappa#large-projects) I used a property named **`slim_handler`** on Zappa. Setting this to **`true`** would just upload a small handler to Lambda and load actual project from S3 at runtime.\r\n\r\nI couldn't find anything like this to do with Mangum or Serverless. Do you have any clue how to solve this problem?\n\n@ShaonDey \r\nI have no experience with lambda/running application this way so this will be pure speculation.\r\nZappa says `including, but not limited to, WSGI web apps` which means gunicorn should be supported. So you can continue using Zappa but change gunicorn to use the uvicorn worker. This is the recommended behaviour for uvicorn. \r\nWill it work? probably but ¬Ø\\\\\\_(„ÉÑ)\\_/¬Ø", "source": "bug_issue", "type": "bug_solution", "issue_number": 89}
{"instruction": "How to fix: What is the efficient way to get images using FAST API?", "input": "How to get an image using Fast API ?", "output": "Get an image of/from what?\n\n```Python\r\n\r\nfrom fastapi import FastAPI, File, UploadFile\r\nfrom fastapi.responses import FileResponse\r\nfrom pydantic import BaseModel\r\n\r\nimport numpy as np\r\n\r\nfrom PIL import Image\r\n\r\nimport shutil\r\n\r\nimport tensorflow as tf\r\nfrom object_detection.utils import label_map_util\r\nfrom object_detection.utils import visualization_utils as viz_utils\r\n\r\napp = FastAPI()\r\n\r\ndetect_fn = tf.saved_model.load('saved_model')\r\ncategory_index = label_map_util.create_category_index_from_labelmap(\"label_map.pbtxt\",use_display_name=True)\r\n\r\n\r\ndef load_image_into_numpy_array(path):\r\n    \"\"\"Load an image from file into a numpy array.\r\n\r\n    Puts image into numpy array to feed into tensorflow graph.\r\n    Note that by convention we put it into a numpy array with shape\r\n    (height, width, channels), where channels=3 for RGB.\r\n\r\n    Args:\r\n      path: the file path to the image\r\n\r\n    Returns:\r\n      uint8 numpy array with shape (img_height, img_width, 3)\r\n    \"\"\"\r\n    return np.array(Image.open(path))\r\n\r\n\r\ndef predict(image):\r\n     # The input needs to be a tensor, convert it using `tf.convert_to_tensor`.\r\n    image_np = np.array(image.file)\r\n    input_tensor = tf.convert_to_tensor(image_np)\r\n    # The model expects a batch of images, so add an axis with `tf.newaxis`.\r\n    input_tensor = input_tensor[tf.newaxis, ...]\r\n\r\n    # input_tensor = np.expand_dims(image_np, 0)\r\n    detections = detect_fn(input_tensor)\r\n\r\n    # All outputs are batches tensors.\r\n    # Convert to numpy arrays, and take index [0] to remove the batch dimension.\r\n    # We're only interested in the first num_detections.\r\n    num_detections = int(detections.pop('num_detections'))\r\n    \r\n    detections = {key: value[0, :num_detections].numpy()\r\n                   for key, value in detections.items()}\r\n    detections['num_detections'] = num_detections\r\n\r\n    # detection_classes should be ints.\r\n    detections['detection_classes'] = detections['detection_classes'].astype(np.int64)\r\n\r\n    image_np_with_detections = image_np.copy()\r\n\r\n    viz_utils.visualize_boxes_and_labels_on_image_array(\r\n          image_np_with_detections,\r\n          detections['detection_boxes'],\r\n          detections['detection_classes'],\r\n          detections['detection_scores'],\r\n          category_index,\r\n          use_normalized_coordinates=True,\r\n          max_boxes_to_draw=200,\r\n          min_score_thresh=.50,\r\n          agnostic_mode=False)\r\n    print(\"Detected\")\r\n    return image_np_with_detections\r\n\r\n\r\n@app.get(\"/\")\r\nasync def main():\r\n    return FileResponse(r\"misdo.jpg\")\r\n\r\n\r\n@app.post(\"/uploadfile/\")\r\nasync def create_upload_file(image: UploadFile = File(...)):\r\n    predicted_image = predict(image)\r\n    return predicted_image```\r\n\r\n###ValueError: Failed to convert a NumPy array to a Tensor (Unsupported object type SpooledTemporaryFile).\n\n> Get an image of/from what?\r\n\r\nCould you look at my code and suggest me a way to pass image and get inference from it?", "source": "bug_issue", "type": "bug_solution", "issue_number": 88}
{"instruction": "How to fix: Usage Graphene Subscriptions in FastAPI - Usage of Starlette-Graphene3 failed", "input": "I wanted to make the subscriptions of graphene work in FastAPI. Unfortuantely I saw two other repositories who asked a similar thing and no conclusion made there. After some research I found the package starlette-graphene3, which makes uploading files and the subscription possible in Starlette. Due to the usage of the the GraphQLApp-class of starlette i thought, that this is going to work. Unfortunately there is a little problem when using starlette-graphene3 with fastapi:\r\n\r\n- When installing starlette-graphene3 I get the error: `ERROR: fastapi 0.63.0 has requirement starlette==0.13.6, but you'll have starlette 0.14.1 which is incompatible.`, which makes FastAPI not work anymore.\r\n\r\nMy questions are: \r\n- is it in planning to use a newer Starlette version, that starlette-graphene3 could be used\r\n- Any other way to make subscriptions work in FastAPI?\r\n\r\nWhen trying to use GraphQL  like in the documentation of FastAPI with subscriptions i get the error:\r\n`\"Subscriptions are not allowed. You will need to either use the subscribe function or pass allow_subscriptions=True\"`\r\n\r\nCode to reproduce:\r\n```Python\r\nfrom fastapi import FastAPI\r\nfrom starlette.graphql import GraphQLApp\r\nimport graphene\r\nimport asyncio\r\n\r\nclass Subscription(graphene.ObjectType):\r\n    count = graphene.Int(upto=graphene.Int())\r\n\r\n    async def subscribe_count(root, info, upto=3):\r\n        for i in range(upto):\r\n            yield i\r\n            await asyncio.sleep(1)\r\n\r\n\r\napp = FastAPI()\r\napp.add_route(\"/graphql\", GraphQLApp(schema=graphene.Schema(subscription=Subscription)))\r\n```", "output": "For the reasoning behind pinning starlette to a specific version, see my comment here: https://github.com/tiangolo/fastapi/discussions/2532#discussioncomment-229069\r\n\r\nAs far as your question goes, what happens if you try the suggestions in the error regarding allowing subscriptions?\n\nThanks for the fast response! Unfortunately I couldnt find the location where i can set this. The only solutions i found where directly dedicated to django. Do you have an idea where to set this setting?\n\nWe can close this issue. I got it to work with Ariadne", "source": "bug_issue", "type": "bug_solution", "issue_number": 87}
{"instruction": "How to fix: The docs page layout is abnormal", "input": "Local service running with fastapi\r\n\r\nvisit docs page, the docs page layout is abnormal.", "output": "I meet the same problem. The css of docs page seems not correct. It shows like this picture.\r\n\r\n![image](https://user-images.githubusercontent.com/26795087/118911679-2d68c180-b959-11eb-8d2a-0572bbe9e62b.png)\r\n\r\nIt seems because it add a button element to contains the origin content, after I check the difference of the correct doc pages.\r\n\r\n![image](https://user-images.githubusercontent.com/26795087/118914311-93efde80-b95d-11eb-9821-36151f1db2d4.png)\r\n\n\n![fastapi-swagger](https://user-images.githubusercontent.com/12136712/118913058-5722e800-b95b-11eb-9883-063e1b96c76f.png)\r\nsame problem! occured about 1 hour ago. before that, every thing is ok\n\nswagger-ui-dist had a release 5 hours ago (3.49.0) which probably broke this, could you give the example endpoint where this issue comes up?\r\n\r\nAfter this you can do:\r\n\r\n```\r\nfrom fastapi import applications\r\nfrom fastapi.openapi.docs import get_swagger_ui_html\r\n\r\n\r\ndef swagger_monkey_patch(*args, **kwargs):\r\n    \"\"\"\r\n    Wrap the function which is generating the HTML for the /docs endpoint and \r\n    overwrite the default values for the swagger js and css.\r\n    \"\"\"\r\n    return get_swagger_ui_html(\r\n        *args, **kwargs,\r\n        swagger_js_url=\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.48.0/swagger-ui-bundle.js\",\r\n        swagger_css_url=\"https://cdn.jsdelivr.net/npm/swagger-ui-dist@3.48.0/swagger-ui.css\"\r\n    )\r\n\r\n\r\n# Actual monkey patch\r\napplications.get_swagger_ui_html = swagger_monkey_patch\r\n\r\n\r\n# Your normal code ...\r\napp = FastAPI()\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 86}
{"instruction": "How to fix: `TestClient.delete()` no longer supports payloads", "input": "### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n\r\n#### App\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n@app.delete(\"/{user_id}\")\r\nasync def _delete_user(user_id: int):\r\n    return {}\r\n```\r\n\r\n\r\n#### Test\r\n\r\n```python\r\ndef test_delete_user(client: TestClient):\r\n    user_id = 123\r\n    response = client.delete(f\"/{user_id}\", json={\"validation_code\": 789})\r\n    assert response.status_code == 200\r\n```\r\n\r\n#### Error\r\n\r\n```\r\nTypeError: TestClient.delete() got an unexpected keyword argument 'json'\r\n```\r\n\r\n### Description\r\n\r\nAfter updating my application to FastAPI 0.87.0 I found out that the new `TestClient` does not support anymore any kind of payload in the `DELETE` method. Although the use of a body within DELETE requests is highly discouraged, it is not forbidden. Hence, we should find a way to allow a full retro-compatibility. \r\n\r\nAn idea would be to wrap the `httpx.delete` method used within the `TestClient` class in order to re-enable this feature. For this to happen, the solution described [here](https://www.python-httpx.org/compatibility/#request-body-on-http-methods) can be reused.\r\n  \r\n\r\n### Operating System\r\n\r\nmacOS\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.87.0\r\n\r\n### Python Version\r\n\r\n3.10\r\n\r\n### Additional Context\r\n\r\n_No response_", "output": "[FastAPI's release 0.87.0](https://github.com/tiangolo/fastapi/releases/tag/0.87.0) upgrades Starlette to [0.21.0](https://github.com/encode/starlette/releases/tag/0.21.0) which replaces `requests` with `httpx`.\r\n`fastapi.testclient.TestClient` is only a shortcut for `starlette.testclient.TestClient`, thus, IMO, you should open an issue in Starlette's issues. You'll also probably receive an answer faster there.\n\n[https://github.com/encode/httpx/discussions/1587](url)\n\n> [FastAPI's release 0.87.0](https://github.com/tiangolo/fastapi/releases/tag/0.87.0) upgrades Starlette to [0.21.0](https://github.com/encode/starlette/releases/tag/0.21.0) which replaces `requests` with `httpx`.\n> \n> `fastapi.testclient.TestClient` is only a shortcut for `starlette.testclient.TestClient`, thus, IMO, you should open an issue in Starlette's issues. You'll also probably receive an answer faster there.\n\nThanks @mbroton for the suggestion. I'm quite sure that if I open an issue on Starlette repo they'll tell me to go back to FastAPI repo üòÖ", "source": "bug_issue", "type": "bug_solution", "issue_number": 85}
{"instruction": "How to fix: How can I serve static files (html, js) easily?", "input": "**Description**\r\n\r\n How can I serve static files (html, js) easily? Even though I don't need to inject python data, I attempted to do it with jinja and encountered issues.\r\n\r\n**Additional context**\r\n I tried something like: \r\n\r\n```\r\n@router.get(\"/webui/{file_name}\", name=\"webui.show\")\r\nasync def webui_show(file_name: str):\r\n    template = jinja2.get_template(file_name)\r\n    content = template.render()\r\n    return HTMLResponse(content=content, status_code=200)\r\n```\r\n\r\nWhere jinja2 was \r\n```\r\nloader = FileSystemLoader(web_dir(\"dist\"))\r\n# no escaping while deubing\r\njinja2 = Environment(loader=loader, autoescape=False)\r\n```\r\n\r\nBut I received an error message \"jinja2.exceptions.TemplateSyntaxError: Expected an expression, got 'end of print statement'\" when returning JavaScript files. What's sanctioned way to implement simple static file serving in fastapi? If so, it'd be nice to have some documentation around it.", "output": "FastAPI being based on Starlette you may use it for that purpose: https://www.starlette.io/staticfiles/\n\n@3lpsy if you have a directory with static files, you can do as @euri10 suggests.\r\n\r\nIf you want to return some specific files (not necessarily from a fixed static directory), you can use a `FileResponse`: https://www.starlette.io/responses/#fileresponse\n\nThanks for the responses @euri10  and @tiangolo. I was attaching the StaticFiles instance to the FastAPI() app incorrectly because I thought StaticFiles was a route but it's more of an ASGI app. For anyone else trying to do the same, you can do something like: \r\n\r\n```\r\napi = FastAPI(title=config.API_PROJECT_NAME, openapi_url=\"/api/v1/openapi.json\")\r\napi.mount(\"/static\", StaticFiles(directory=\"static\"))\r\n```\r\n\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 84}
{"instruction": "How to fix: Debug Logging (Maybe just a n00b issue)", "input": "Disclaimer: n00b to Python altogether. This is the first Python app that I've ever built.\r\n\r\nTrying to add formatted debug logging to the screen. I've gotten it to the point where the debug output shows twice. Once with the formatting applied, and once raw. \r\n\r\nScaled down code would be:\r\n```\r\nimport logging\r\n\r\nfrom fastapi import FastAPI\r\n\r\napi = FastAPI()\r\n\r\nlogger = logging.getLogger(\"api\")\r\nlogger.setLevel(logging.DEBUG)\r\n\r\nfh = logging.FileHandler(\"QED.log\")\r\nfh.setLevel(logging.ERROR)\r\nch = logging.StreamHandler()\r\nch.setLevel(logging.DEBUG)\r\nformatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')\r\nfh.setFormatter(formatter)\r\nch.setFormatter(formatter)\r\n\r\nlogger.addHandler(fh)\r\nlogger.addHandler(ch)\r\n\r\n@api.get(\"/\")\r\ndef read_root():\r\n    logger.debug(\"THIS IS A DEBUG LOG\")\r\n    logger.error(\"SOMETHING WENT VERY VERY WRONG\")\r\n    return {\"Hello\": \"World\"}\r\n```\r\nOutput to the console is:\r\n\r\n```\r\n2019-06-04 12:44:51,169 - api - DEBUG - THIS IS A DEBUG LOG\r\nDEBUG: THIS IS A DEBUG LOG\r\n2019-06-04 12:44:51,169 - api - ERROR - SOMETHING WENT VERY VERY WRONG\r\nERROR: SOMETHING WENT VERY VERY WRONG\r\nINFO: ('127.0.0.1', 55229) - \"GET / HTTP/1.1\" 200\r\n\r\n```\r\n\r\nSo, two things are happening.\r\n\r\n1. Seeing both the formatted message and the raw message.\r\n2. Seeing the ERROR level message in the console. That should only be written to QED.log\r\n\r\nThanks!", "output": "Guessing that you started the app with uvicorn it looks like this is the\nlogs of it.\nYou can use the log-level flag, see\nhttps://www.uvicorn.org/settings/#logging\n\ne mar. 4 juin 2019 √† 9:37 PM, Charlie Griefer <notifications@github.com> a\n√©crit :\n\n> Disclaimer: n00b to Python altogether. This is the first Python app that\n> I've ever built.\n>\n> Trying to add formatted debug logging to the screen. I've gotten it to the\n> point where the debug output shows twice. Once with the formatting applied,\n> and once raw.\n>\n> Scaled down code would be:\n>\n> import logging\n>\n> from fastapi import FastAPI\n>\n> api = FastAPI()\n>\n> logger = logging.getLogger(\"api\")\n> logger.setLevel(logging.DEBUG)\n>\n> fh = logging.FileHandler(\"QED.log\")\n> fh.setLevel(logging.DEBUG)\n> ch = logging.StreamHandler()\n> ch.setLevel(logging.DEBUG)\n> formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')\n> fh.setFormatter(formatter)\n> ch.setFormatter(formatter)\n>\n> logger.addHandler(fh)\n> logger.addHandler(ch)\n>\n> @api.get(\"/\")\n> def read_root():\n>     logger.debug(\"THIS IS A DEBUG LOG\")\n>     return {\"Hello\": \"World\"}\n>\n> Output to the console is:\n>\n> 2019-06-04 12:12:05,541 - api - DEBUG - THIS IS A DEBUG LOG\n> DEBUG: THIS IS A DEBUG LOG\n> INFO: ('127.0.0.1', 54183) - \"GET / HTTP/1.1\" 200\n>\n> Any advice to a Python n00b on how to remove that second unformatted debug?\n>\n> Thanks!\n>\n> ‚Äî\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/290?email_source=notifications&email_token=AAINSPTERYYFZ2BZEACYBSDPY2767A5CNFSM4HTAJOIKYY3PNVWWK3TUL52HS4DFUVEXG43VMWVGG33NNVSW45C7NFSM4GXTSYKA>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAINSPS7WED6ZLUAP6B7RK3PY2767ANCNFSM4HTAJOIA>\n> .\n>\n\n\nHey euri10...\r\n\r\nThanks for the reply!\r\n\r\nI started the app with `uvicorn qed.api:api --reload`\r\n\r\n... so I don't _think_ I should be seeing uvicorn log items?\n\nI think the uvicorn default is info and that is the\n\nINFO: ('127.0.0.1', 54183) - \"GET / HTTP/1.1\" 200\n\n\nLe mar. 4 juin 2019 √† 10:05 PM, Charlie Griefer <notifications@github.com>\na √©crit :\n\n> Hey euri10...\n>\n> Thanks for the reply!\n>\n> I started the app with uvicorn qed.api:api --reload\n>\n> ... so I don't *think* I should be seeing uvicorn log items?\n>\n> ‚Äî\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/290?email_source=notifications&email_token=AAINSPTKKZLUP57RDYOXHULPY3DH3A5CNFSM4HTAJOIKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGODW5WZHQ#issuecomment-498822302>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAINSPVGCNMWAKDZPR3TT4TPY3DH3ANCNFSM4HTAJOIA>\n> .\n>\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 83}
{"instruction": "How to fix: Starlette 0.13 declarative support?", "input": "**Description**\r\n\r\nIn the [upcoming release 0.13 of Starlette](https://github.com/encode/starlette/pull/704), a new declarative way for routing is introduced. At first, decorator style will still be supported but @tomchristie will somewhat *deprecate* it and remove it at some point in the future:\r\n\r\n> Yes, that's not going away here. However I _do think_ that I'm going to stop documenting it everywhere.\r\n> \r\n> Would I like to _eventually_ phase it out? _Possibly at some point in the future, maybe_. One of the key things I'm trying to emphasize in Starlette is a low-complexity stack, and components such as the `Starlette` and `Router` classes get _really_ simple if we move away from all the `.add_route(...)` and `@route()` futzing.\r\n\r\nAt the light of this, it seems that FastAPI needs to take a decision about this: either follow Starlette new convention or stick with the decorator style.\r\n\r\nPersonally, I tend to prefer the decorator style, which is similar to Flask or even Node's Express. However, as Starlette is one of the core component of FastAPI, I think it's better if it keeps up with its evolutions, for several reasons:\r\n\r\n* Keep the friction between the two frameworks as low as possible. Currently, if you know how to write a Starlette app, you know how to write a FastAPI one.\r\n* At some point, FastAPI will have to implement and maintain some wrapper code to convert imperative routing into the declarative style Starlette expects.\r\n\r\nThat's it! Just some quick thoughts in order to keep this subject in mind üôÇ", "output": "FWIW I don‚Äôt think FastAPI necessarily needs to consider any changes here - it‚Äôs fairly reasonable for higher level frameworks to adopt a different approach, while Starlette itself sticks to a as-plain-as-possible style.\r\n\r\n(Also I don‚Äôt think there‚Äôs any changes needed to deal with the 0.12-0.13 update, tho I‚Äôm keen to double check that all before I hit go on it)\r\n\r\nI am *interested* in folks thoughts about the style change, tho. It‚Äôs an odd trade off, because I‚Äôm not sure it necessarily looks nicer, but I think it‚Äôs a good thing for the project.\r\n\r\nFrom my POV it‚Äôs a good thing for Starlette since it more simply expresses the mechanics, and is easier to override the behaviour (eg subclassing Route makes sense, whereas that‚Äôs more awkward to do if there‚Äôs a .route decorator on the app instance). Those are particularly valuable qualities for Starlette since it makes it easier to build different high level styles on top of it.\n\n@tomchristie Thank you for your insights! I was just opening the debate here so that FastAPI maintainers can start to think about it :)\r\n\r\nRegarding the style change of Starlette, from my limited API developer point-of-view, I have to say that I *tend* to prefer the decorator style. I find very handy to have the path, the parameters, the HTTP method *and* the logic behind at the same place in the code.\r\n\r\nIf I may make the parallel with Django, I'm often frustrated to go back and forth between `views.py` and `urls.py`, often forgetting either the name of the params, the name of the route or struggle to find back the function associated.\r\n\r\nBut I understand your wish to limit the hidden magic behind the framework and to make it easier to extend.\n\n> I am _interested_ in folks thoughts about the style change, tho. It‚Äôs an odd trade off, because I‚Äôm not sure it necessarily looks nicer, but I think it‚Äôs a good thing for the project.\r\n> \r\n> From my POV it‚Äôs a good thing for Starlette since it more simply expresses the mechanics, and is easier to override the behaviour (eg subclassing Route makes sense, whereas that‚Äôs more awkward to do if there‚Äôs a .route decorator on the app instance). Those are particularly valuable qualities for Starlette since it makes it easier to build different high level styles on top of it.\r\n\r\n@tomchristie: I wasn't sure initially because I've already gotten used to the Flask-like decorator magic, but the more I look at it, the more I believe it's a good thing, especially if the intention is to make Starlette an ASGI library rather than a full-on framework. The problem with decorators is that they require the app or router to always be in-scope, [which leads to odd patterns in Flask-land](https://flask.palletsprojects.com/en/1.1.x/patterns/appfactories/) to avoid depencency loops.\r\n\r\nMaking routes declarative at initialization time provides both a nice tree-like structure of the routes in the code itself, with very little magic to hide sub-application mount points, route subclasses, the evaluation order for each route, etc. Given those have some pretty important repercussions on how the resulting application will behave, I can definitely appreciate making this a bit more explicit.\r\n\r\nThe main problem I can see if FastAPI were to switch to this new model is that decorators clearly show which functions are intended to be routes and which aren't, which becomes important when you consider how dependency injection and parameters work, since those don't work with \"normal\" functions, only routes and the dependencies those route call (which are admittedly unmarked as well). Having the route declaration in a different file could be frustrating in that regard, though it might not be a problem in practice.\r\n\r\n**EDIT:** What I mean is like how, in the example below, the route (`@app.get(\"/users/{user_id}\")`) is coupled with the parameters passed to those functions (`def read_user(user_id: int)`), and a change in either one could break the route.\r\n\r\n```py\r\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\r\ndef read_user(user_id: int, db: Session = Depends(get_db)):\r\n    db_user = crud.get_user(db, user_id=user_id)\r\n    if db_user is None:\r\n        raise HTTPException(status_code=404, detail=\"User not found\")\r\n    return db_user\r\n```\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 82}
{"instruction": "How to fix: How does one setup a global timeout to all requests?", "input": "### First check\r\n<details>\r\n\r\n<summary>\r\n<i>Ticked all checks, then first commitment choice</i>\r\n</summary>\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n\r\n</details>\r\n\r\n<!-- \r\n\r\nI'm asking all this because answering questions and solving problems in GitHub issues consumes a lot of time. I end up not being able to add new features, fix bugs, review Pull Requests, etc. as fast as I wish because I have to spend too much time handling issues.\r\n\r\nAll that, on top of all the incredible help provided by a bunch of community members that give a lot of their time to come here and help others.\r\n\r\nThat's a lot of work they are doing, but if more FastAPI users came to help others like them just a little bit more, it would be much less effort for them (and you and me üòÖ).\r\n\r\n-->\r\n\r\n### Description\r\n\r\nHi there, first of all many thanks for the work on FastAPI - this is now my goto framework for building Python-based REST APIs :)\r\n\r\nMy question is about adding a **global timeout** to _any potential request_ served by the server. My use-case includes occasionally long loading times when I have to load a new model for a given user request, and instead of blocking for 30-50s (which would often timeout on the user side due to default connection timeouts), I would like to return a temporary error whenever any endpoint takes more than a given delay to complete. \r\n\r\n### Example\r\n\r\nToday the only way I found to implement a timeout on every request is to wrap every endpoint method within a context manager like this one:\r\n\r\n```Python\r\n@contextmanager\r\ndef timeout_after(seconds: int):\r\n    # Register a function to raise a TimeoutError on the signal.\r\n    signal.signal(signal.SIGALRM, raise_timeout)\r\n    # Schedule the signal to be sent after `seconds`.\r\n    signal.alarm(seconds)\r\n\r\n    try:\r\n        yield\r\n    finally:\r\n        # Unregister the signal so it won't be triggered if the timeout is not reached.\r\n        signal.", "output": "Hi @PLNech \r\n\r\nI am developing my own API using FastAPI and ran into the same \"problem\" as I am trying to add a global timeout to all my requests. \r\n\r\nI am still new to fastapi but from what I understand I believe the \"fastapi\" way to do so would be to use a middleware as they are designed to be ran at every request by nature. As I searched on how to do so I found this\r\n[gitter community thread](https://gitter.im/encode/community?at=5eee4457fa0c9221fc4ddeb4) and thought it could maybe help you. \r\n\r\nI am going to implement both your solution and the middleware based one and see which one I prefer and works best. Also note that there seems to be a problem with starlette 0.13.3 and higher so keep that in mind.\r\n\r\nAlso if you found a workaround by now I am more than interested.\r\n\r\nHope it helped you a bit\n\nHi @ZionStage, thanks for your message! I haven't found a workaround for now. Looking forward to continuing this conversation with you as we move forward on this topic :)\n\nHey @PLNech \r\n\r\nI have implemented and tested the middleware and it seems to be working fine for me. Here is my code \r\n```python\r\nimport asyncio\r\nimport time\r\n\r\n\r\nimport pytest\r\n\r\nfrom fastapi import FastAPI, Request, Response, HTTPException\r\nfrom fastapi.responses import JSONResponse\r\nfrom httpx import AsyncClient\r\nfrom starlette.status import HTTP_504_GATEWAY_TIMEOUT\r\n\r\nREQUEST_TIMEOUT_ERROR = 1  # Threshold\r\n\r\napp = FastAPI() # Fake app\r\n\r\n# Creating a test path\r\n@app.get(\"/test_path\")\r\nasync def route_for_test(sleep_time: float) -> None:\r\n    await asyncio.sleep(sleep_time)\r\n\r\n# Adding a middleware returning a 504 error if the request processing time is above a certain threshold\r\n@app.middleware(\"http\")\r\nasync def timeout_middleware(request: Request, call_next):\r\n    try:\r\n        start_time = time.time()\r\n        return await asyncio.wait_for(call_next(request), timeout=REQUEST_TIMEOUT_ERROR)\r\n\r\n    except asyncio.TimeoutError:\r\n        process_time = time.time() - start_time\r\n        return JSONResponse({'detail': 'Request processing time excedeed limit',\r\n                             'processing_time': process_time},\r\n                            status_code=HTTP_504_GATEWAY_TIMEOUT)\r\n\r\n# Testing wether or not the middleware triggers\r\n@pytest.mark.asyncio\r\nasync def test_504_error_triggers():\r\n    # Creating an asynchronous client to test our asynchronous function\r\n    async with AsyncClient(app=app, base_url=\"http://test\") as ac:\r\n        response = await ac.get(\"/test_path?sleep_time=3\")\r\n    content = eval(response.content.decode())\r\n    assert response.status_code == HTTP_504_GATEWAY_TIMEOUT\r\n    assert content['processing_time'] < 1.1\r\n\r\n# Testing middleware's consistency for requests having a processing time close to the threshold \r\n@pytest.mark.asyncio\r\nasync def test_504_error_consistency():\r\n    async with AsyncClient(app=app, base_url=\"http://test\") as ac:\r\n        errors = 0\r\n        sleep_time = REQUEST_TIMEOUT_ERROR*0.9\r\n        for i in range(100):\r\n            response = await ac.get(\"/test_path?sleep_time={}\".format(sleep_time))\r\n            if response.status_code == HTTP_504_GATEWAY_TIMEOUT:\r\n                errors += 1\r\n        assert errors == 0\r\n\r\n# Testing middleware's precision\r\n# ie : Testing if it triggers when it should not and vice versa\r\n@pytest.mark.asyncio\r\nasync def test_504_error_precision():\r\n    async with AsyncClient(app=app, base_url=\"http://test\") as ac:\r\n        should_trigger = []\r\n        should_pass = []\r\n        have_triggered = []\r\n        have_passed = []\r\n        for i in range(200):\r\n            sleep_time = 2 * REQUEST_TIMEOUT_ERROR * random.random()\r\n            if sleep_time < 1.1:\r\n                should_pass.append(i)\r\n            else:\r\n                should_trigger.append(i)\r\n            response = await ac.get(\"/test_path?sleep_time={}\".format(sleep_time))\r\n            if response.status_code == HTTP_504_GATEWAY_TIMEOUT:\r\n                have_triggered.append(i)\r\n            else:\r\n                have_passed.append(i)\r\n        assert should_trigger == have_triggered\r\n```\r\n\r\nI created three tests, the first one is designed to see wether or not the middleware actually does its job. \r\nThe second one is just there to check if there is any consistency problem with a single request. \r\nThe third one is here to check if I ran into the same issue raised in the [thread I mentioned](https://gitter.im/encode/community?at=5eee4457fa0c9221fc4ddeb4). \r\n\r\nAs far as I am concerned the first two tests passed without a problem.\r\n**However** the third one failed. There are requests that have triggered when they should not : \r\n```\r\nE           AssertionError: assert [3, 7, 10, 11, 12, 14, ...] == [3, 7, 8, 10, 11, 12, ...]\r\nE             At index 2 diff: 10 != 8\r\nE             Right contains 11 more items, first extra item: 165\r\n```\r\nThis is the issue mentioned in the thread. I'll downgrade to starlette 0.13.2 and see if the test pass.\r\n\r\nI might have made some mistakes or overlooked some things so I", "source": "bug_issue", "type": "bug_solution", "issue_number": 81}
{"instruction": "How to fix: Python - FastAPI - Optional option for an UploadFile", "input": "### First Check\r\n\r\n- [x] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom typing import Optional\r\nfrom fastapi import FastAPI, UploadFile, File\r\n\r\napp = FastAPI()\r\n\r\n@app.get(\"/\")\r\ndef root():\r\n    pass\r\n\r\n@app.post(\"/OptionOne\")\r\ndef pdf_foo1(file: Optional[UploadFile] = None):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionTwo\")\r\ndef pdf_foo2(file: Optional[UploadFile] = File(None)):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionThree\")\r\ndef pdf_foo3(file: UploadFile = File(None)):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionFour\")\r\ndef pdf_foo4(file: UploadFile = None):\r\n    print(file.filename)\r\n\r\n@app.post(\"/OptionFive\")\r\ndef pdf_foo5(file: bytes = File(None)):\r\n    print(file)\r\n```\r\n\r\n\r\n### Description\r\n\r\n### Short Summary\r\nI am trying to do what I think is a simple thing but no internet solution has helped me so far, and I didn't find anything helpful yet in the issues.\r\n___\r\n### The desired solution:\r\nA route (function) that will accept an UploadFile but that will be optional, the user will not be have to provide it.\r\n\r\n### Current Case:\r\nIn the code there are 5 different cases I tried, all of them are not working as follows:\r\nCases 1, 3 Gives an 'ValueError: Value not declarable with JSON Schema'\r\nCases 2, 4 Acts like it's not always must:\r\n - It will boot up and start working, but when I try to send a request (for example in the docs swagger) it will gives me a 422 error and will say it excepts data named \"file\" (in this case)\r\nCase 5 Gives a different error (up until now I saw 3 different ones) but anyway using bytes is not the solution I'm looking for.\r\n\r\n### Operating System\r\n\r\nLinux, Windows\r\n\r\n### Operating System Details\r\n\r\nIm developing on a windows server, and publish on a Linux webapp (Azure)\r\n\r\n### FastAPI Version\r\n\r\n0.70.1\r\n\r\n### Python Version\r\n\r\n3.8.2\r\n\r\n### Additional Context\r\n\r\nI'm testing it with Swagger (Locally and Webapp) and also using the API links in a different program\r\n( If I missed anything, or there is anything else you need to know in order to resolve this issue, please comment and I will update the data accordingly within 12 hours max [Not including Friday and Saturday] )", "output": "Does the example from the docs work?\r\n\r\n```\r\nfrom typing import Optional\r\n\r\nfrom fastapi import FastAPI, File, UploadFile\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.post(\"/files/\")\r\nasync def create_file(file: Optional[bytes] = File(None)):\r\n    if not file:\r\n        return {\"message\": \"No file sent\"}\r\n    else:\r\n        return {\"file_size\": len(file)}\r\n\r\n\r\n@app.post(\"/uploadfile/\")\r\nasync def create_upload_file(file: Optional[UploadFile] = None):\r\n    if not file:\r\n        return {\"message\": \"No upload file sent\"}\r\n    else:\r\n        return {\"filename\": file.filename}\r\n```\r\n\r\nhttps://fastapi.tiangolo.com/tutorial/request-files/#optional-file-upload\r\n\n\nThe upload assumes multipart form data: So when you see a JSON error; you might want to test your upload different.\n\nHey, if you will look at the options I wrote there, there is an option like that one in the docs (OptionOne and part of OptionFive but OptionFive is not good for me anyway)", "source": "bug_issue", "type": "bug_solution", "issue_number": 80}
{"instruction": "How to fix: Inheritance and Polymorphism support", "input": "Actually, there is no support for Inheritance and Polymorphism as I know in fastapi : https://swagger.io/docs/specification/data-models/inheritance-and-polymorphism/\r\n\r\nMaybe annotations like that will do the job : \r\n\r\n```python\r\nclass Item(BaseModel):\r\n    type: str\r\n\r\nclass CarItem(Item):\r\n    type: str\r\n\r\nclass PlaneItem(Item):\r\n    type: str\r\n    size: str\r\n\r\n\r\n@app.post(\"/items/\", response_model=Item, one_of=[CarItem, PlaneItem], discriminator=\"type\")\r\nasync def create_item(*, item: Item):\r\n    return item\r\n```\r\n\r\nFor now, we need to define an `any` response_model since defining an `Item` response_model will remove the extra attributes during serialization.\r\n\r\nI'll try to hack using the based starlette api : https://www.starlette.io/schemas/ but comment are unused by fastapi (except for description)", "output": "You can achieve what I think you need with standard Python `typing.Union`.\r\n\r\nI just added docs documenting it: https://fastapi.tiangolo.com/tutorial/extra-models/#union-or-anyof\n\nThanks for the response !!! \r\nIt works well on response thanks !! :+1: \r\n\r\nBut I also try with request body : \r\n```python\r\n\r\nclass Item(BaseModel):\r\n    type: str\r\n\r\nclass CarItem(Item):\r\n    type: str\r\n    wheel: int\r\n\r\nclass PlaneItem(Item):\r\n    type: str\r\n    size: str\r\n\r\n\r\nitem_union = Union[\r\n    CarItem,\r\n    PlaneItem\r\n]\r\n\r\n@app.post(\"/items/\", response_model=item_union)\r\nasync def create_item(*, item: item_union):\r\n    return item\r\n```\r\nseems to pick the first one, so drop the fields that is not on the second one. \r\n\r\nAny suggestion for this one ? \r\n\n\nconfirmed with a set of tests, specifically `test_create_item_reverse`: https://github.com/euri10/fastapi/tree/post_union\r\nno time for looking further though ! maybe later :_)\r\nUnion order seems important", "source": "bug_issue", "type": "bug_solution", "issue_number": 79}
{"instruction": "How to fix: Websocket Broadcast", "input": "It would be awesome to have a feature to enable broadcast messages to all connected clients at specific websocket endpoint. \n\nThis function could be executed inside a api endpoint, for example after a post method that changes some persistent data, all connected clients at /ws will receive a message telling that it is time to refresh. \n\nCheers guys, this is a incredible project. Like so much!", "output": "@rudmac If I understand your feature request properly, I think it is actually possible without too much effort by making use of an async generator. Admittedly, I still find async generators a little mind bending (this is the first time I've ever had a use for one \"in the wild\"), but I think seeing it in action makes it a little easier. Here's an implementation that makes a small extension of the tutorial app from https://fastapi.tiangolo.com/tutorial/websockets/ to add global push notifications:\r\n```python\r\nfrom typing import List\r\n\r\nfrom fastapi import FastAPI\r\nfrom starlette.responses import HTMLResponse\r\nfrom starlette.websockets import WebSocket, WebSocketDisconnect\r\n\r\n\r\napp = FastAPI()\r\n\r\nhtml = \"\"\"\r\n<!DOCTYPE html>\r\n<html>\r\n    <head>\r\n        <title>Chat</title>\r\n    </head>\r\n    <body>\r\n        <h1>WebSocket Chat</h1>\r\n        <form action=\"\" onsubmit=\"sendMessage(event)\">\r\n            <input type=\"text\" id=\"messageText\" autocomplete=\"off\"/>\r\n            <button>Send</button>\r\n        </form>\r\n        <ul id='messages'>\r\n        </ul>\r\n        <script>\r\n            var ws = new WebSocket(\"ws://localhost:8000/ws\");\r\n            ws.onmessage = function(event) {\r\n                var messages = document.getElementById('messages')\r\n                var message = document.createElement('li')\r\n                var content = document.createTextNode(event.data)\r\n                message.appendChild(content)\r\n                messages.appendChild(message)\r\n            };\r\n            function sendMessage(event) {\r\n                var input = document.getElementById(\"messageText\")\r\n                ws.send(input.value)\r\n                input.value = ''\r\n                event.preventDefault()\r\n            }\r\n        </script>\r\n    </body>\r\n</html>\r\n\"\"\"\r\n\r\n\r\n@app.get(\"/\")\r\nasync def get():\r\n    return HTMLResponse(html)\r\n\r\n\r\nclass Notifier:\r\n    def __init__(self):\r\n        self.connections: List[WebSocket] = []\r\n        self.generator = self.get_notification_generator()\r\n\r\n    async def get_notification_generator(self):\r\n        while True:\r\n            message = yield\r\n            await self._notify(message)\r\n\r\n    async def push(self, msg: str):\r\n        await self.generator.asend(msg)\r\n\r\n    async def connect(self, websocket: WebSocket):\r\n        await websocket.accept()\r\n        self.connections.append(websocket)\r\n\r\n    def remove(self, websocket: WebSocket):\r\n        self.connections.remove(websocket)\r\n\r\n    async def _notify(self, message: str):\r\n        living_connections = []\r\n        while len(self.connections) > 0:\r\n            # Looping like this is necessary in case a disconnection is handled\r\n            # during await websocket.send_text(message)\r\n            websocket = self.connections.pop()\r\n            await websocket.send_text(message)\r\n            living_connections.append(websocket)\r\n        self.connections = living_connections\r\n\r\n\r\nnotifier = Notifier()\r\n\r\n\r\n@app.websocket(\"/ws\")\r\nasync def websocket_endpoint(websocket: WebSocket):\r\n    await notifier.connect(websocket)\r\n    try:\r\n        while True:\r\n            data = await websocket.receive_text()\r\n            await websocket.send_text(f\"Message text was: {data}\")\r\n    except WebSocketDisconnect:\r\n        notifier.remove(websocket)\r\n\r\n\r\n@app.get(\"/push/{message}\")\r\nasync def push_to_connected_websockets(message: str):\r\n    await notifier.push(f\"! Push notification: {message} !\")\r\n\r\n\r\n@app.on_event(\"startup\")\r\nasync def startup():\r\n    # Prime the push notification generator\r\n    await notifier.generator.asend(None)\r\n```\r\nIf you want to test it out, copy the above to a file `main.py` and start the server:\r\n```bash\r\nuvicorn main:app --reload\r\n```\r\nThen, open a few tabs at http://localhost:8000/ and send some chat messages (this should work the same as the base tutorial app). Then open http://localhost:8000/push/hello%20world and you should receive a push notification in each of your open tabs showing the message `hello world`.\r\n\r\n@tiangolo I'm a really big fan of this websockets integration, truly awesome stuff.\n\n> Cheers guys, this is a incredible project. Like so much!\r\n\r\n@rudmac I'm glad to hear that!\r\n\r\n---\r\n\r\n@dmontagu That's very interesting! And yes, it's mind-bending.\r\n\r\nThis should go in a blog post, a tutorial, a package or something :clap: \n\n@dmontagu Very interesting approach. This is what I'm looking for. Thank you so much! I will let you know after implement this in my real application.", "source": "bug_issue", "type": "bug_solution", "issue_number": 78}
{"instruction": "How to fix: UploadFile as a CSV file", "input": "**Description**\r\nI'm trying to upload csv file to fastapi server. Is there any clear way to read fastapi File object and write it as a csv file?\r\n\r\nWhen I receive byte stream through the api, it's difficult to save it as a csv file since there could be comma anywhere in the string. \r\n\r\nOne solution could be write incoming bytes files to disk and load it back but I'm wondering if there is a direct approach without writing it into a disk", "output": "there is a whole section in the docs about uploading files: https://fastapi.tiangolo.com/tutorial/request-files/\r\nif you want to avoid writing to the disk you can use the io module from standard library: https://docs.python.org/3/library/io.html\r\n\r\nedit : just note the io module is not async\n\nTo add to @euri10 's comment, I think you will probably want to make use of `UploadFile` to receive the csv file (as described in the docs @euri10 linked). This will transparently handle writing the file to disk if it is too large to store in memory, and has both a sync and async API for saving to disk if desired.\r\n\r\nMoreover, If you want to load the csv data _without_ saving to disk, I believe it should be possible to pass it directly to `pandas.read_csv` via:\r\n\r\n```python\r\nimport pandas as pd\r\n\r\n@app.post(\"/uploadcsv/\")\r\ndef upload_csv(csv_file: UploadFile = File(...)):\r\n    dataframe = pd.read_csv(csv_file.file)\r\n    # do something with dataframe here (?)\r\n    return {\"filename\": file.filename}\r\n```\r\n\r\n(I haven't tested this, but it seems like it should be supported based on the [pandas docs](https://pandas.pydata.org/pandas-docs/stable/user_guide/io.html#io-read-csv-table). Other csv readers may require other modifications.)\n\nGreat answers @euri10 and @dmontagu ! Thanks a lot for your help here! :cake: \r\n\r\n@enod yep, right what they said :smile: :point_up: ", "source": "bug_issue", "type": "bug_solution", "issue_number": 77}
{"instruction": "How to fix: Elegant way to exclude middleware in unit tests?", "input": "**Description**\r\n\r\nIs it possible to disable or override middleware in unit tests?\r\n\r\n**Additional context**\r\n\r\nI have written some middleware to obtain a database pool connection and release it when the request is done.  I'm using asyncpg directly for this as follows:\r\n\r\n```python\r\n@app.middleware(\"http\")\r\nasync def database_middleware(request: Request, call_next):\r\n    conn = None\r\n    try:\r\n        conn = await database_pool.acquire()\r\n\r\n        try:\r\n            await conn.fetch(\"SELECT 1\")\r\n        except ConnectionDoesNotExistError:\r\n            conn = await database_pool.acquire()\r\n\r\n        request.state.db = conn\r\n        return await call_next(request)\r\n    except (PostgresConnectionError, OSError) as e:\r\n        logger.error(\"Unable to connect to the database: %s\", e)\r\n        return Response(\r\n            \"Unable to connect to the database.\", status_code=HTTP_500_INTERNAL_SERVER_ERROR\r\n        )\r\n    except SyntaxOrAccessError as e:\r\n        logger.error(\"Unable to execute query: %s\", e)\r\n        return Response(\r\n            \"Unable to execute the required query to obtain data from the database.\",\r\n            status_code=HTTP_500_INTERNAL_SERVER_ERROR,\r\n        )\r\n    finally:\r\n        if conn:\r\n            await database_pool.release(conn)\r\n```\r\n\r\nI then have a little `get_db` dependency injection which is similar to the docs:\r\n\r\n```python\r\ndef get_db(request: Request):\r\n    return request.state.db\r\n```\r\n\r\nI'd like to mock my database in my unit tests so I can verify that I'm building the correct SQL given the appropriate params.\r\n\r\nI've setup a pytest fixture to mock the database as follows:\r\n\r\n```python\r\n@pytest.fixture(scope=\"function\")\r\ndef db_mock(request):\r\n    def fin():\r\n        del app.dependency_overrides[get_db]\r\n\r\n    db_mock = mock.MagicMock()\r\n    app.dependency_overrides[get_db] = lambda: db_mock\r\n\r\n    request.addfinalizer(fin)\r\n    return db_mock\r\n```\r\n\r\nThis works perfectly when the middleware is disabled.  However, when it's enabled, naturally all endpoints fail with a 500 error as the database fails to connect.\r\n\r\nAfter looking a little deeper into starlette codebase and the way middleware works, I couldn't seem to find an elegant way to disable or override middleware in my unit tests.\r\n\r\nAny help is greatly appreciated.  Also if you see anything wrong with the approach I'm taking, please do let me know.\r\n\r\nHuge thanks!\r\nFotis", "output": "I'd try to use asynctest CoroutineMock instead of MagicMock\r\nedit: ha sorry your mock is a on a def\n\n> I'd try to use asynctest CoroutineMock instead of MagicMock\r\n> edit: ha sorry your mock is a on a def\r\n\r\nOh interesting idea, but yeah, pytest injection doesn't use async at this stage.  I'm injecting this fixture as follows:\r\n\r\n```python\r\ndef test_events(client, db_mock, current_user_mock):\r\n    db_mock.fetch.return_value = Future()\r\n    db_mock.fetch.return_value.set_result([])\r\n\r\n    response = client.post(\"/v1/events/\", json={\"id\": [\"bla\"]})\r\n    assert response.status_code == 200\r\n    assert response.json() == []\r\n    assert db_mock.fetch.call_args == mock.call(\r\n        \"SELECT * \"\r\n        \"FROM events\"\r\n        \"WHERE id = ANY ($1) \"\r\n        \"ORDER BY event_timestamp DESC \"\r\n        \"LIMIT $2\",\r\n        [\"bla\"], 20\r\n    )\r\n```\r\n\r\nOf course, I'm totally open to better ways of accomplishing this! üòÑ  I'm definitely a bit new to async in Python and am coming from Falcon (which is not async at all).\n\nActually @euri10, you're right, I can use the `asynctest` library (which I hadn't heard of) for slightly more elegant results:\r\n\r\n```python\r\n@pytest.fixture(scope=\"function\")\r\ndef db_mock(request):\r\n    def fin():\r\n        del app.dependency_overrides[get_db]\r\n\r\n    db_mock = asynctest.Mock()\r\n    app.dependency_overrides[get_db] = lambda: db_mock\r\n\r\n    request.addfinalizer(fin)\r\n    return db_mock\r\n\r\ndef test_events(client, db_mock, current_user_mock):\r\n    db_mock.fetch = asynctest.CoroutineMock(return_value=[])\r\n\r\n    response = client.post(\"/v1/events/\", json={\"id\": [\"bla\"]})\r\n    assert response.status_code == 200\r\n    assert response.json() == []\r\n    assert db_mock.fetch.call_args == mock.call(\r\n        \"SELECT * \"\r\n        \"FROM events \"\r\n        \"WHERE id = ANY ($1) \"\r\n        \"ORDER BY event_timestamp DESC \"\r\n        \"LIMIT $2\",\r\n        [\"bla\"], 20\r\n    )\r\n```\r\n\r\nThe reason this works is that the endpoint itself uses `await` so it's all good üòÑ ", "source": "bug_issue", "type": "bug_solution", "issue_number": 76}
{"instruction": "How to fix: How to use different middleware for different routes/path", "input": "### First check\r\n\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n\r\n### Description\r\n\r\nIs it possible to use different middleware for different routes/path?\r\n\r\n### Additional context\r\n\r\nIn my case my need comes from CORS. But, I am sure there is other cases than CORS requirements that someone would need different middlewares for different paths.\r\n\r\n* I want `myapi.com/path1` to allow origins of calls from `myfrontend.com`\r\n* I want `myapi.com/path2` to allow origins of calls from anywhere ('*') since it is a public facing api.\r\n\r\nI checked if it was possible to add a middleware at a router level and did not find any documentation about it.\r\n\r\n### Code example\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\nfrom fastapi.middleware.cors import CORSMiddleware\r\n\r\napp = FastAPI()\r\n\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=['myfrontend.com'],\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\n# I want /path1 to allow only calls from 'myfrontend.com'\r\n@app.get(\"/path1\")\r\nasync def path1():\r\n    return {\"status\": \"alive\"}\r\n\r\n# I want /path2 to be a public facing api that can be accessed from anywhere ['*']\r\n@app.get(\"/path2\")\r\nasync def path2():\r\n    return {\"status\": \"alive\"}\r\n\r\n```", "output": "I haven't use this way, but you can have a try.\r\nHow about use subapp?\r\n[documention](https://fastapi.tiangolo.com/advanced/sub-applications-proxy/#mount-the-sub-application)\n\nThank you @Dustyposa this looks exactly like what I was looking for.\r\n\r\nHere is a example implementation in case someone else stumble upon the same problem\r\n\r\n```python\r\n# app1.py\r\n\r\nfrom fastapi import FastAPI\r\n\r\napp1 = FastAPI(openapi_prefix=\"/app1\")\r\n\r\n@app1.get(\"path1\")\r\nasync def path1():\r\n    return { \"message\": \"app1\"}\r\n```\r\n\r\n```python\r\n# app2.py\r\n\r\nfrom fastapi import FastAPI\r\n\r\napp2 = FastAPI(openapi_prefix=\"/app2\")\r\n\r\n@app1.get(\"path2\")\r\nasync def path2():\r\n    return { \"message\": \"app2\"}\r\n```\r\n\r\n```python\r\n# main.py\r\n\r\nfrom fastapi import FastAPI\r\nfrom app1 import app1\r\nfrom app2 import app2\r\n\r\n\r\napp1.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=['myfrontend.com'],\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\n# here we can add middlewares that are only for app2 and not executed on paths of app1\r\n# the CORS policy is different for app2. (allows '*' instead of 'myfrontend.com')\r\napp2.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=['*'],\r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"],\r\n    allow_headers=[\"*\"],\r\n)\r\n\r\napp = FastAPI()\r\n\r\napp.mount(\"/app1\", app1) # if does not work try: app.mount(app1, \"/app1\")\r\napp.mount(\"/app2\", app2) # if does not work try: app.mount(app2, \"/app2\")\r\n\r\n@app.get(\"/\")\r\nasync def root():\r\n    return {\"message\": \"alive\"}\r\n\r\n```\n\nThanks for your help here @Dustyposa :bowing_man: :cake: \r\n\r\nAnd thanks for reporting back and closing the issue @philippegirard :rocket: ", "source": "bug_issue", "type": "bug_solution", "issue_number": 75}
{"instruction": "How to fix: How to hide certain fields in Pydantic models?", "input": "Example:\r\n\r\nI have created_at and updated_at fields that I want to auto populate on the model using default_factory, but I don't want the user to be able to set them via an endpoint. I thought this could be achieved by the read only Field arg but then I can never set it.\r\n\r\nWhat's the best way to go about this?", "output": "``` python\r\nfrom pydantic import BaseModel,Field\r\nfrom datetime import datetime\r\n\r\n\r\n\r\nclass User(BaseModel):\r\n    name:str\r\n    create_at: datetime = datetime.now()\r\n\r\nuser_in_system = User(name='includeamin')\r\nprint(user_in_system.dict(exclude={'create_at'}))\r\n# output: {'name': 'includeamin'}\r\n```\n\nSorry I should have clarified, how do you hide them in the openapi spec? :)\n\nI mean you could create two models, one internal and one external, but you have to be careful between converting between two models (performance v.s. validation).", "source": "bug_issue", "type": "bug_solution", "issue_number": 74}
{"instruction": "How to fix: FastAPI gets terminated when child multiprocessing process terminated", "input": "### Describe the bug\r\n\r\nMake a multiprocessing Process and start it.\r\nRight after terminate the process, fastapi itself(parent) terminated.\r\n\r\n### To Reproduce\r\n\r\nStart command: /usr/local/bin/uvicorn worker.stts_api:app --host 127.0.0.1 --port 8445\r\n\r\n1. Create a file with:\r\n\r\n```Python\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.post('/task/run')\r\ndef task_run(task_config: TaskOptionBody):\r\n    proc = multiprocessing.Process(\r\n        target=task.run,\r\n        args=(xxxx,))\r\n    proc.start()\r\n    return task_id\r\n\r\n@app.get('/task/abort')\r\ndef task_abort(task_id: str):\r\n    proc.terminate()\r\n    return result_OK\r\n```\r\n\r\n3. Run task_run and while the process alive, trigger task_abort\r\n4. After child process terminated then parent(fastApi) terminated as well.\r\n\r\n### Expected behavior\r\n\r\nParent process should not be terminated after child terminated.\r\n\r\n### Environment\r\n\r\n- OS: Linux\r\n- FastAPI Version 0.54.1\r\n- Python version 3.8.2\r\n\r\n\r\n### Additional context\r\n\r\nI tried same code with Flask with gunicorn, it never terminated.", "output": "Hi @jongwon-yi, \r\nJust wanted to ask what 'TaskOptionBody' is referring to in the definition of task_run\n\n> Hi @jongwon-yi,\r\n> Just wanted to ask what 'TaskOptionBody' is referring to in the definition of task_run\r\n\r\n`\r\nclass TaskOptionBody(BaseModel):\r\n    owner: str\r\n    description: str\r\n    subscribers: str\r\n    devices: list\r\n    options: dict\r\n    protocol: int\r\n`\r\n\r\nThis behavior doesn't related to request headers or payloads. You can simply reproduce this by\r\n> run fastapi with uvicorn\r\n> start default(fork) multiprocessing Process and save the proc somewhere\r\n> terminate child with saved proc (proc.terminate())\n\n@Kludex May I work on this?", "source": "bug_issue", "type": "bug_solution", "issue_number": 73}
{"instruction": "How to fix: How to achieve nested parameterized dependencies?", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n\r\n### Example\r\n\r\nGiven the follow minimal working example, where `Test1` and `Test2` are parameterized dependencies (as described in https://fastapi.tiangolo.com/advanced/advanced-dependencies/). One parameter of `Test2` should be forwarded to `Test1` which should be injected into `Test2`.:\r\n\r\n```Python\r\nimport uvicorn\r\nfrom fastapi import Depends, FastAPI\r\napp = FastAPI()\r\n\r\nclass Test1():\r\n\r\n    def __init__(self, t1) -> None:\r\n        self.t1 = t1\r\n\r\n    def __call__(self):\r\n        return self.t1\r\n\r\nclass Test2():\r\n\r\n    def __init__(self, t2) -> None:\r\n        self.t2 = t2\r\n\r\n    def __call__(self):\r\n        return Depends(Test1(t1=self.t2))\r\n\r\n@app.get(\"/test/\")\r\ndef test_call(test: str = Depends(Test2(t2='test'))):\r\n    return test\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    uvicorn.run(\"main:app\", host=\"127.0.0.1\", port=8000, reload=True, debug=True)\r\n```\r\n\r\n### Description\r\n\r\nIt is not possible to include `Test1` as dependency in the `call` parameters of `Test2` since there wouldn't be any access to the parameter of `Test1`.\r\nDirectly calling `Depends` as in the example above also does not work since there does not seem to be any dependency injection at this level.\r\n\r\nHow to achieve this kind of nesting? Is this simply not possible at the moment? If not, I would like to add this as feature request.\r\n\r\n### Environment\r\n\r\n* OS: Windows:\r\n* FastAPI Version 0.58.0\r\n* Python version: 3.7", "output": "you could add a `Test1` instance in `Test2.__init__`\r\nyou could get an instance as input like : `Depends(Test2(t2='test2', test1=Test1(t1='test1')))`\r\nor you can create one in `__init__` like:\r\n```\r\nclass Test2():\r\n\r\n    def __init__(self, t2) -> None:\r\n        self.t2 = t2\r\n        self.test1=Test1(t1=t2)\r\n```\n\n@ihakh This does not provide any dependency injection to the `__call__` method of `Test1`. Getting this to work with dependency injections is the point of this question / feature request.\n\nHey @Spenhouet, thanks for the interest.\r\n\r\nI think I'm having a bit of trouble understanding the use case. I think I can imagine simple ways to solve it without requiring support for that, but I'm probably missing details of your use case.\r\n\r\nFor example, this seems to work:\r\n\r\n```Python\r\nimport uvicorn\r\nfrom fastapi import Depends, FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\nclass Test1:\r\n    def __init__(self, t1) -> None:\r\n        self.t1 = t1\r\n\r\n    def __call__(self):\r\n        return self.t1\r\n\r\n\r\nclass Test2:\r\n    def __init__(self, t2) -> None:\r\n        self.t2 = t2\r\n\r\n    def __call__(self):\r\n        return Test1(t1=self.t2)()\r\n\r\n\r\n@app.get(\"/test/\")\r\ndef test_call(test: str = Depends(Test2(t2=\"test\"))):\r\n    return test\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    uvicorn.run(\"main:app\", host=\"127.0.0.1\", port=8000, reload=True, debug=True)\r\n```\r\n\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 72}
{"instruction": "How to fix: Question. SQL Alchemy and blocking calls", "input": "in the documentation it is suggested to use sql alchemy as a orm, but isn't alchemy completely synchronous? wouldn't that way create blocking calls?", "output": "I don't know at which point you've read. But there's also a section about **databases**, which is the asynchronous suggestion about the topic. \r\n\r\nI can't give you the references right now, but search for \"encode databases\" in Google or in the documentation and you'll find more information. \r\n\r\nAbout this topic, if someone is willing to open a PR about how to use FastAPI with Gino and/or Tortoise, I think it will be gladly accepted. Those are the most recommended async ORM solutions nowadays, even by @tiangolo himself  (based on last Friday YouTube presentation).\r\n\r\nJust remember that FastAPI is DB Independent. :)\r\n\r\nAbout what you probably saw in the documentation, you need to understand that SQLAlchemy is more than 10 years old, and the async ORM frameworks are still quite new. GINO (build on top of SQLAlchemy) was born February 2020 and Tortoise has more or less the same age as FastAPI (2 years old +). My point is that going for SQLAlchemy will avoid surprises in your development path.\r\n\r\nAnswering your question: yes, it will.\r\n\r\nLast curious points: \r\n- Tortoise ORM has a Pydantic feature which is quite nice for us. \r\n- @tiangolo is experimenting some nice stuff that will make you able to create a Pydantic and SQLAlchemy model at the same time (this is based on a single Twitter post). We don't have more information about it, but he said he was just experimenting. Hope he can achieve something nice and share with us :) \r\n\r\nP.S.: Sorry for the lack of links, I'm unable to add them now. \r\n\r\nEdit: references below:\r\n- [FastAPI docs about async SQL databases](https://fastapi.tiangolo.com/tutorial/sql-databases/) \r\n- [databases from encode](https://github.com/encode/databases)\r\n- [GINO](https://python-gino.org/)\r\n- [Template using GINO with FastAPI](https://github.com/leosussan/fastapi-gino-arq-uvicorn)\r\n- [Tortoise ORM - FastAPI example](https://tortoise-orm.readthedocs.io/en/latest/examples/fastapi.html)\r\n- [Sebasti√°n's YouTube talk about FastAPI from last Friday](https://www.youtube.com/watch?v=1zMQBe0l1bM)\r\n- [Sebasti√°n's tweet about Pydantic + SQLAlchemy models](https://twitter.com/tiangolo/status/1287679028036599809)\n\n\r\nI am using fastapi and tortoise orm in production and tortoise orm has problems with migrations. or rather, they are not at all out of the box. this creates the need for third-party solutions such as aerich, which in turn is poorly optimized for postgresql. The question arises - are there any plans to write a migration library for tortoise orm or support for aerich? or not? \r\nand what to do with migrations on fastapi if there is no normal, asynchronous orm? because in the current implementation it turns out that fastapi does not have a stable orm. its a serious problem\n\n > The question arises - are there any plans to write a migration library for tortoise orm or support for aerich? or not?\r\n\r\nWe are talking in the FastAPI GitHub issues, if you want details about Tortoise, maybe you should ask on their issues... But anyway, using Tortoise search engine you can find their [roadmap](https://tortoise-orm.readthedocs.io/en/latest/roadmap.html?highlight=migrations#mid-term):\r\n![image](https://user-images.githubusercontent.com/7353520/89129014-f88a9b80-d4f9-11ea-8f83-02111ac3c1bb.png)\r\n\r\n> and what to do with migrations on fastapi if there is no normal, asynchronous orm? because in the current implementation it turns out that fastapi does not have a stable orm. its a serious problem\r\n\r\nPlease, do not make strong statements like \"its a serious problem\" without concrete arguments. I'll quote what I said in my last reply: \r\n> Just remember that FastAPI is DB Independent. :)\r\n\r\nNow, [aerich](https://github.com/long2ice/aerich) was created a few months ago (May 19) so it's expected to not be perfect. But be aware that SQLAlchemy's most common migration tool used is [Alembic](https://alembic.sqlalchemy.org/en/latest/) and GINO as well is using the same tool ([GINO's solution](https://gist.github.com/omarryhan/cb7bf6d7142c154496ba6623a56326c2#file-sanic-gino-alembic-migrations-setup)). So none of those ORMs have native migrations. \r\n\r\nAdditional comments:\r\n- Alembic was created by SQLAlchemy creator...\r\n- Django has native migrations on the Django ORM... If that's something that you really need...", "source": "bug_issue", "type": "bug_solution", "issue_number": 71}
{"instruction": "How to fix: Using UploadFile and Pydantic model in one request", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n### Example\r\n\r\nHere's a self-contained, [minimal, reproducible, example](https://stackoverflow.com/help/minimal-reproducible-example) with my use case:\r\n\r\n```Python\r\nfrom fastapi import FastAPI, File, UploadFile\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\n\r\nclass Properties(BaseModel):\r\n    language: str = None\r\n    author: str = None\r\n\r\n\r\n@app.post(\"/uploadfile/\", status_code=201)\r\nasync def create_upload_file(properties: Properties, file: UploadFile = File(...)):\r\n    return {\"filename\": file.filename, 'properties': properties}\r\n```\r\n\r\n### Description\r\n\r\n* Open the browser `/docs` and call the endpoint `/uploadfile`.\r\n* It returns error 422 Validation Error.\r\n* But I expected it to return code 201.\r\n\r\n### Environment\r\n\r\n* OS: Linux (Fedora)\r\n* FastAPI Version: 0.61.1\r\n* Python version: 3.8.6\r\n\r\n### Additional context\r\nImmediately I apologize, maybe I missed something and / or did not understand and should not have bothered you. I need this function in order to unload a poster for it along with information in the form of a Pydantic model. I issued a [patch](https://github.com/tiangolo/fastapi/pull/2139), but everyone ignores it", "output": "based on [docs](https://fastapi.tiangolo.com/tutorial/request-forms-and-files/#import-file-and-form)\r\n``` python\r\nfrom fastapi import FastAPI, File, UploadFile,Form\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\n\r\nclass Properties(BaseModel):\r\n    language: str = None\r\n    author: str = None\r\n\r\n\r\n@app.post(\"/uploadfile/\", status_code=201)\r\nasync def create_upload_file(language: str = Form(...),author: str = Form(...),file: UploadFile = File(...)):\r\n    return {\"filename\": file.filename, 'properties': Properties(language=language,author=author)}\r\n```\n\n> based on [docs](https://fastapi.tiangolo.com/tutorial/request-forms-and-files/#import-file-and-form)\n> ``` python\n> from fastapi import FastAPI, File, UploadFile,Form\n> from pydantic import BaseModel\n> \n> app = FastAPI()\n> \n> \n> class Properties(BaseModel):\n>     language: str = None\n>     author: str = None\n> \n> \n> @app.post(\"/uploadfile/\", status_code=201)\n> async def create_upload_file(language: str = Form(...),author: str = Form(...),file: UploadFile = File(...)):\n>     return {\"filename\": file.filename, 'properties': Properties(language=language,author=author)}\n> ```\n\nHello. This option does not suit me, since the model in my project has many fields and I do not want crutches in my project, because of this I released a patch so that you can transfer the Pydantic Model to FormData. But thanks for trying to help\n\nThen you can try to use dependency injection. Just make class with required fields (better use dataclass). \r\nBut imo it's bad practice to upload file and body fields simultaneously", "source": "bug_issue", "type": "bug_solution", "issue_number": 70}
{"instruction": "How to fix: FastAPI always returns content, even if 204 no content status code is set.", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n### Example\r\n\r\n```Python\r\nfrom fastapi import FastAPI\r\nfrom starlette.status import HTTP_204_NO_CONTENT\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\", status_code=HTTP_204_NO_CONTENT)\r\ndef read_root():\r\n    print(\"d\")\r\n```\r\n\r\n\r\n\r\n### Description\r\n\r\nSend a request with any HTTP Client, observe the traffic using tcpdump/wireshark - you'll see that you get null as a response (content-length will be 4). This is extremely notable as this caused this issue https://github.com/encode/httpx/issues/1474 (The client doesn't expect any data in that case)\r\nI would expect FastAPI to not return null when response is None.\r\n\r\n### Environment\r\n\r\n* OS: macOS\r\n* FastAPI Version [e.g. 0.3.0]: 0.63.0\r\n* Python version: 0.63.0", "output": "Can you try to run with httptools instead of h11? \n\n> Can you try to run with httptools instead of h11? \n\nClient or server ?\n\nunicorn --http httptools ", "source": "bug_issue", "type": "bug_solution", "issue_number": 69}
{"instruction": "How to fix: Using dependency injection to get SQLAlchemy session can lead to deadlock", "input": "### First check\r\n\r\n- [x] I added a very descriptive title to this issue.\r\n- [x] I used the GitHub search to find a similar issue and didn't find it.\r\n- [x] I searched the FastAPI documentation, with the integrated search.\r\n- [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n- [x] After submitting this, I commit to one of:\r\n  - Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n  - I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n  - Implement a Pull Request for a confirmed bug.\r\n\r\nI've noticed that when using dependency injection with SQLAlchemy, a large number of concurrent requests can leave the app in a deadlocked state. This is especially noticeable with a small SQLAlchemy connection pool size (relative to the FastAPI thread pool size). Below is a self-contained example (you might have to tweak the pool size and the request body's sleep length but this should be a good starting point).\r\n\r\n<details>\r\n  <summary>View <code>app.py</code></summary>\r\n\r\n```python\r\n\"\"\"\r\nSetup: pip install fastapi sqlalchemy uvicorn\r\nRun: python app.py\r\n\"\"\"\r\nimport time\r\nimport uvicorn\r\n\r\nfrom fastapi import Depends, FastAPI, Request\r\nfrom sqlalchemy import create_engine\r\nfrom sqlalchemy.orm import Session, sessionmaker\r\nfrom sqlalchemy.pool import QueuePool\r\n\r\n\r\n# SQLAlchemy setup\r\nengine = create_engine(\r\n    'sqlite:///test.db',\r\n    connect_args={'check_same_thread': False},\r\n    poolclass=QueuePool,\r\n    pool_size=4,\r\n    max_overflow=0,\r\n    pool_timeout=None,  # Wait forever for a connection\r\n)\r\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\r\n\r\n# FastAPI\r\napp = FastAPI()\r\n\r\ndef get_db(request: Request):\r\n    db = SessionLocal()\r\n    try:\r\n        yield db\r\n    finally:\r\n        db.close()\r\n\r\n@app.get('/')\r\ndef index(db: Session = Depends(get_db)):\r\n    # Some blocking work\r\n    _ = db.execute('select 1')\r\n    time.sleep(1)\r\n    return {'hello': 'world'}\r\n\r\n# Run\r\nif __name__ == '__main__':\r\n    uvicorn.run('app:app', reload=True, host='0.0.0.0', port=80)\r\n```\r\n\r\n</details>\r\n\r\nWhen running the above with 100 concurrent requests (I used [locust](https://locust.io/)), I noticed that only around 5 requests are served, and then the app freezes and is unable to serve any more requests. Below is the locustfile.\r\n\r\n<details>\r\n  <summary>View <code>locustfile.py</code></summary>\r\n\r\n```python\r\n\"\"\"\r\nSetup: pip inst", "output": "I faced this problem. In 100% of cases, requests are blocked. Regardless of the frequency of requests, after about 7-10 requests, each time, requests are blocked. And so every time until you reboot. Tried it both in IDE on win10 and in Docker. On versions python 3.8 and 3.9 - nothing changes.\n\nI solved this problem by using this method - https://github.com/tiangolo/full-stack-fastapi-postgresql/issues/104#issuecomment-775858005.\n\nI'm not sure how background tasks are scheduled, but it doesn't look like that would always prevent the above situation. For example, running the above app using that solution still leads to deadlock with 100 concurrent users.\r\n\r\nAnother possible solution is to keep `get_db()` as-is, and change all endpoints to something like:\r\n\r\n```python\r\n@app.get('/')\r\ndef index(db: Session = Depends(get_db)):\r\n    with close_at_end(db) as db:\r\n        data = db.query(...)...\r\n        return {\"data\": data}\r\n```\r\n\r\nwhere `close_at_end` is a simple context manager that yields `db` and closes it after. This doesn't account for sub-dependencies and is a little tedious, but it can work as a temporary workaround.\r\n\r\nIt seems like if you want to keep using dependencies, the real solution is to migrate to an async database library, and if you're already using SQLAlchemy the switch should be relatively easy with version 1.4.", "source": "bug_issue", "type": "bug_solution", "issue_number": 68}
{"instruction": "How to fix: Pydantic v2, dataclasses, UUID, and `__annotations__`", "input": "### Privileged issue\n\n- [X] I'm @tiangolo or he asked me directly to create an issue here.\n\n### Issue Content\n\nThe combination of using:\r\n\r\n* Pydantic v2\r\n* dataclasses (instead of Pydantic models)\r\n* UUIDs\r\n* `from future import __annotations__`\r\n\r\nseems to break in a strange way.\r\n\r\nThis was original reported in this discussion by @sanzoghenzo: https://github.com/tiangolo/fastapi/discussions/9709#discussioncomment-6449458\r\n\r\nIn particular the comment by @raddevon with the minimal example by @fantix:\r\n\r\n```Python\r\nfrom __future__ import annotations\r\n\r\nimport uuid\r\nfrom dataclasses import dataclass, field\r\nfrom typing import List, Union\r\n\r\nfrom fastapi import FastAPI\r\n\r\n\r\n@dataclass\r\nclass Item:\r\n    id: uuid.UUID\r\n    name: str\r\n    price: float\r\n    tags: List[str] = field(default_factory=list)\r\n    description: Union[str, None] = None\r\n    tax: Union[float, None] = None\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/items/next\", response_model=Item)\r\nasync def read_next_item():\r\n    return {\r\n        \"name\": \"Island In The Moon\",\r\n        \"price\": 12.99,\r\n        \"description\": \"A place to be be playin' and havin' fun\",\r\n        \"tags\": [\"breater\"],\r\n    }\r\n```\r\n\r\nStarting FastAPI with that breaks with an error of:\r\n\r\n<details>\r\n<summary>log</summary>\r\n\r\n```\r\nuvicorn main:app\r\nTraceback (most recent call last):\r\n  File \"/Users/user/code/fastapi/env3.10/lib/python3.10/site-packages/pydantic/type_adapter.py\", line 165, in __init__\r\n    core_schema = _getattr_no_parents(type, '__pydantic_core_schema__')\r\n  File \"/Users/user/code/fastapi/env3.10/lib/python3.10/site-packages/pydantic/type_adapter.py\", line 97, in _getattr_no_parents\r\n    raise AttributeError(attribute)\r\nAttributeError: __pydantic_core_schema__\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/user/code/fastapi/env3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py\", line 625, in _resolve_forward_ref\r\n    obj = _typing_extra.evaluate_fwd_ref(obj, globalns=self._types_namespace)\r\n  File \"/Users/user/code/fastapi/env3.10/lib/python3.10/site-packages/pydantic/_internal/_typing_extra.py\", line 423, in evaluate_fwd_ref\r\n    return ref._evaluate(globalns=globalns, localns=localns, recursive_guard=frozenset())\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/typing.py\", line 694, in _evaluate\r\n    eval(self.__forward_code__, globalns, localns),\r\n  File \"<string>\", line 1, in <module>\r\nNameError: name 'uuid' is not defined\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/user/code/fastapi/env3.10/bin/uvicorn\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"/Users/user/code/fastapi/env3.10/lib/python3.10/site-packages/click/core.py\", line 1130, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/Users/user/code/fastapi/env3.10/lib/python3.10/site-packages/click/core.py\", line 1055, in main\r\n  ", "output": "Maybe using an id of type str can solve the problem...\r\n\r\nclass Item:\r\n    id: str  # Using string instead of uuid.UUID\r\n    name: str\r\n    price: float\r\n    tags: List[str] = field(default_factory=list)\r\n    description: Union[str, None] = None\r\n    tax: Union[float, None] = None\r\n\n\nIt looks like forward references are resolved from namespaces built from the previous 2 frames\r\nhttps://github.com/pydantic/pydantic/blob/adc657a8b9f0b5191c180fc51005c0bf1fe529db/pydantic/type_adapter.py#L76\n\nYou could use Pydantic's dataclass extension. It doesn't just give you the same data validation features but also fix your issue.\r\n\r\n```python\r\nfrom __future__ import annotations\r\n\r\nfrom typing import List, Union\r\nimport uuid\r\n\r\nfrom pydantic.dataclasses import dataclass, Field\r\n\r\n@dataclass\r\nclass Item:\r\n    id: uuid.UUID\r\n    name: str\r\n    price: float\r\n    tags: List[str] = Field(default_factory=list)\r\n    description: Union[str, None] = None\r\n    tax: Union[float, None] = None\r\n\r\nitem = Item(\r\n    id=uuid.uuid4(),\r\n    name=\"John\",\r\n    price=666.66,\r\n)\r\n\r\nprint(item)\r\n\r\n# Item(id=UUID('c399d5c9-c2bf-4e5f-94f9-21a7a5f78610'), name='John', price=666.66, tags=[], description=None, tax=None)\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 67}
{"instruction": "Debug this error: Multiple regressions in the handling of forms & form validation", "input": "```\napp = FastAPI()\n\n\n@app.post(\"/\")\ndef root(\n    name: Annotated[Optional[str], Form(embed=True)] = None,\n):\n    print(name)\n    return name\n\n```\n\n```\n‚ùØ http post -v --form localhost:8888 name=\"\"\nPOST / HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate, br, zstd\nConnection: keep-alive\nContent-Length: 5\nContent-Type: application/x-www-form-urlencoded\nHost: localhost:8888\nUser-Agent: xh/0.24.0\n\nname=\n\nHTTP/1.1 200 OK\nContent-Length: 2\nContent-Type: application/json\nDate: Sun, 23 Mar 2025 21:01:49 GMT\nServer: uvicorn\n\n\"\"\n\n```\n\n```\ndiff --git a/fastapi/dependencies/utils.py b/fastapi/dependencies/utils.py\nindex 6083b731..db7eedba 100644\n--- a/fastapi/dependencies/utils.py\n+++ b/fastapi/dependencies/utils.py\n@@ -789,9 +789,9 @@ async def _extract_form_body(\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n             values[field.name] = value\n-    for key, value in received_body.items():\n-        if key not in values:\n-            values[key] = value\n+    # for key, value in received_body.items():\n+    #     if key not in values:\n+    #         values[key] = value\n     return values\n\n```", "output": "@MarinPostma: You are not specifying the response model.\n\nThe response model is inconsequential in this example. I am not interested in the output of the endpoint but in the prints\n\nThe issue is with how the request model is being parsed, I have identified the sources of the regressions and have linked them. I am happy to submit a patch that resolves these bugs", "source": "bug_issue", "type": "error_debug", "issue_number": 66}
{"instruction": "How to fix: Multiple regressions in the handling of forms & form validation", "input": "### Issue Content\n\nWe have found at least 2 regression in the way forms are handled while trying to migrate to v0.115.11 from version v0.112.4. After investigation we were able to identify 2 commits that introduce 2 separate bugs that break the handling of default values in both `x-form-urlencoded` and `mutlipart` froms. Partial fixes have been proposed that also address a CVE, but the PR has been hanging since october 24.\n\n# Breaking in the handling of default value in `x-url-encoded` forms\n\nThis bug has been introduced in https://github.com/fastapi/fastapi/pull/12134.\n\nMRE:\n```python\napp = FastAPI()\n\n\n@app.post(\"/\")\ndef root(\n    name: Annotated[Optional[str], Form(embed=True)] = None,\n):\n    print(name)\n    return name\n```\n\nwith the following request:\n```\n‚ùØ http post -v --form localhost:8888 name=\"\"\nPOST / HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate, br, zstd\nConnection: keep-alive\nContent-Length: 5\nContent-Type: application/x-www-form-urlencoded\nHost: localhost:8888\nUser-Agent: xh/0.24.0\n\nname=\n\nHTTP/1.1 200 OK\nContent-Length: 2\nContent-Type: application/json\nDate: Sun, 23 Mar 2025 21:01:49 GMT\nServer: uvicorn\n\n\"\"\n```\nThe expected result is that `None` is printed, but instead `\"\"` is printed.\n\nthis is the offending bit from the linked PR:\n```\ndiff --git a/fastapi/dependencies/utils.py b/fastapi/dependencies/utils.py\nindex 6083b731..db7eedba 100644\n--- a/fastapi/dependencies/utils.py\n+++ b/fastapi/dependencies/utils.py\n@@ -789,9 +789,9 @@ async def _extract_form_body(\n             value = serialize_sequence_value(field=field, value=results)\n         if value is not None:\n             values[field.name] = value\n-    for key, value in received_body.items():\n-        if key not in values:\n-            values[key] = value\n+    # for key, value in received_body.items():\n+    #     if key not in values:\n+    #         values[key] = value\n     return values\n```\nThis patch solves the x-form-urlencoded  case. So we indeed have two different regressions.\nThis _get_multi_dict_value  gets called for all fields in the schema: https://github.com/fastapi/fastapi/blob/4633b1bca933e68dac5c3bcce797ff5963debe2a/fastapi/dependencies/utils.py#L765-L765\nwe see here the special case for empty fields: https://github.com/fastapi/fastapi/blob/4633b1bca933e68dac5c3bcce797ff5963debe2a/fastapi/dependencies/utils.py#L695-L700\nThis bit here just blindly re-adds all fields from the body:    https://github.com/fastapi/fastapi/blob/4633b1bca933e68dac5c3bcce797ff5963debe2a/fastapi/dependencies/utils.py#L794-L796\n\nThis would be partially fixed by https://github.com/fastapi/fastapi/pull/12502/files, but also requires that ignored fields are not re-added to the form.\n\n\n# Breaking in the handling of default value in `multipart` forms\n\nThe breaking of multipart form originates from https://github.com/fastapi/fastapi/pull/12117 where the check for empty field was dropped https://github.com/fastapi/fastapi/pull/12117/files#diff-aef3dac481b68359f4edd6974fa3a047cfde595254a4567a5", "output": "@MarinPostma: You are not specifying the response model.\n\nThe response model is inconsequential in this example. I am not interested in the output of the endpoint but in the prints\n\nThe issue is with how the request model is being parsed, I have identified the sources of the regressions and have linked them. I am happy to submit a patch that resolves these bugs", "source": "bug_issue", "type": "bug_solution", "issue_number": 66}
{"instruction": "How to fix: Allow json/BaseModels in query parameters", "input": "### Is your feature request related to a problem\r\n\r\nI have to support getting a structured json string as parameter:\r\n<img width=\"891\" alt=\"Screenshot 2020-01-17 at 22 08 55\" src=\"https://user-images.githubusercontent.com/2737108/72646249-f86be980-3975-11ea-9e3c-3ea7816fd1e1.png\">\r\n\r\n```url\r\nhttps://localhost:8080/test?moop={\"name\": \"something %26 something else\",\"description\": \"str\" ,\"price\": 0.2,\"tax\": 0.2}&foo=bar\r\n```\r\n\r\nI would like to have a easy validation for those fields as well, as this could be automatic\r\n\r\n### The solution you would like\r\n\r\n```python\r\n@routes.api_route('/test', methods=['GET', 'POST'], tags=['official', 'message', 'send'])\r\nasync def test(\r\n    moop: Json[Item] = Query(..., description='Something something'),\r\n    foo: str = Query(...),\r\n):\r\n    return {'woop': moop, 'lol': foo}\r\n# end def\r\n```\r\n\r\n<details><summary>Initial version:</summary>\r\n\r\n\r\nThis was the initial thought, before I discovered the `Json` type.\r\n```python\r\n@routes.api_route('/test', methods=['GET', 'POST'], tags=['official', 'message', 'send'])\r\nasync def test(\r\n    moop: Item = Query(..., description='Something something'),\r\n    foo: str = Query(...),\r\n):\r\n    return {'woop': moop, 'lol': foo}\r\n# end def\r\n```\r\n\r\n</details>\r\n\r\n### Bug you face\r\n\r\n```py\r\nAssertionError: Param: moop can only be a request body, using Body(...)\r\n```\r\n\r\n### Describe alternatives you've considered\r\n\r\n```py\r\n    moop: str\r\n```", "output": "Funny, using `moop: Json` is working:     \r\n\r\n```py\r\nfrom pydantic.types import Json\r\n\r\n@routes.api_route('/test', methods=['GET', 'POST'], tags=['official', 'message', 'send'])\r\nasync def test(\r\n    moop: Json = Query(..., description='Something something'),\r\n    foo: str = Query(...),\r\n):\r\n    moop = Item(moop)\r\n    return {'woop': moop, 'lol': foo}\r\n# end def\r\n```\r\n\r\nbut  `moop: Json[Item]` is not working:\r\n\r\n```py\r\n@routes.api_route('/test', methods=['GET', 'POST'], tags=['official', 'message', 'send'])\r\nasync def test(\r\n    moop: Json[Item] = Query(..., description='Something something'),\r\n    foo: str = Query(...),\r\n):\r\n    return {'woop': moop, 'lol': foo}\r\n# end def\r\n```\r\nis failing with:\r\n```py\r\nFile \"/path/to/project/main.py\", line 482, in <module>\r\n  from .views.api.v4_5.sendable import routes as sendable_routes\r\nFile \"/path/to/project/views/api/v4_5/sendable.py\", line 85, in <module>\r\n  foo: str = Query(...),\r\nFile \"/path/to/3.7.venv/lib/python3.7/site-packages/fastapi/routing.py\", line 487, in decorator\r\n  callbacks=callbacks,\r\nFile \"/path/to/3.7.venv/lib/python3.7/site-packages/fastapi/routing.py\", line 431, in add_api_route\r\n  callbacks=callbacks,\r\nFile \"/path/to/3.7.venv/lib/python3.7/site-packages/fastapi/routing.py\", line 334, in __init__\r\n  self.dependant = get_dependant(path=self.path_format, call=self.endpoint)\r\nFile \"/path/to/3.7.venv/lib/python3.7/site-packages/fastapi/dependencies/utils.py\", line 305, in get_dependant\r\n  ), f\"Param: {param_field.name} can only be a request body, using Body(...)\"\r\nAssertionError: Param: moop can only be a request body, using Body(...)\r\n```\n\nI think what's happening here is that FastAPI tries to only allow certain types to be parsed automatically from query parameters (presumably to limit confusion where you are expecting it to parse that data from the *body*, rather than the query parameters; obviously not relevant in *this* case).\r\n\r\nWhen you pass `Json`, the implicit generic parameter is treated as `Any`, which is apparently being allowed. (My guess is this is somehow related to the fact that `Json[Any]` could be parsing a `str`, for example, which is allowed as a query parameter by FastAPI.)\r\n\r\nHowever, when you say `Json[Item]`, you are now making it clear you want to parse a dict out of the query parameters, but fastapi explicitly only allows parsing primitives or sequences of primitives, so that's why you are getting this error.\r\n\r\nIt's a little less ergonomic, but I would recommend creating a custom dependency that parses the query string into the type you want. Something like:\r\n\r\n```python\r\ndef get_moop(moop: Json[Any] = Query(..., description='Something something')) -> Item:\r\n    return Item.parse_obj(moop)\r\n\r\nasync def test(\r\n    moop: Item = Depends(get_moop),\r\n    foo: str = Query(...),\r\n):\r\n```\r\n\r\n------\r\n\r\nFrom what I gather, the [OpenAPI spec](https://swagger.io/docs/specification/describing-parameters/#query-parameters) *does* allow you to pass objects as query parameter values, so in theory I don't see why this shouldn't be supported. But as far as I can tell, it isn't supported right now.\r\n\r\nI'd be happy to review a PR if someone cared to put in the work to implement this. (Note: you might have to manually parse the raw query string, since I'm not sure if starlette will do that automatically for objects.)\n\n@dmontagu  \r\nInterestingly, using `Json` as the type already converts the argument to a valid python objects, in this case a dict.\r\n\r\nSo basically all whats left is throwing tat json data already parsed as python primitives into the normal object loader if a square bracket thing is found.\r\n\r\nHowever, I don't really understand the current code which is raising an error, what I have to change there, and I also don't know what's the best place to add that transformation.\r\n**If I get some pointers there, I'd love to fix that**.\r\n\r\nFor example I have no clue what `get_dependant` and `is_scalar_field` does in the end.", "source": "bug_issue", "type": "bug_solution", "issue_number": 65}
{"instruction": "How to fix: Multiple aliases for query parameters", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * Or, I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n<!-- \r\n\r\nI'm asking all this because answering questions and solving problems in GitHub issues consumes a lot of time. I end up not being able to add new features, fix bugs, review Pull Requests, etc. as fast as I wish because I have to spend too much time handling issues.\r\n\r\nAll that, on top of all the incredible help provided by a bunch of community members that give a lot of their time to come here and help others.\r\n\r\nThat's a lot of work they are doing, but if more FastAPI users came to help others like them just a little bit more, it would be much less effort for them (and you and me üòÖ).\r\n\r\n-->\r\n\r\n### Example\r\n\r\nI would like to be able to do this:\r\n\r\n<!-- Replace the code below with your own self-contained, minimal, reproducible, example -->\r\n\r\n```Python\r\nfrom fastapi import FastAPI, Query\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef get(query: Optional[str] = Query(None, alias=['q', 'query']):\r\n    return query\r\n```\r\n\r\n### Description\r\n\r\n<!-- Replace the content below with your own feature request -->\r\n\r\nCurrently to give a query parameter multiple aliases, you need to declare multiple query parameters.\r\n\r\n### The solution you would like\r\n\r\n<!-- Replace this with your own content -->\r\n\r\nBeing able to give a list of aliases to the `alias` arg of the `Query` class.\r\n\r\n```Python\r\nQuery(alias=['q', 'query'])\r\n```\r\nOf course backwards compatibility won'y break, as  `alias` arg would be of type `Optional[Union[str, Iterable[str]]]`.\r\nYou would still be able to do this:\r\n\r\n```Python\r\nQuery(alias='q')\r\n```\r\n\r\n### Describe alternatives you've considered\r\n\r\n<!-- Replace this with your own ideas -->\r\n\r\n@Kludex mentioned creating a new argument `aliases`\r\n\r\n```Python\r\nQuery(aliases=['q', 'query'])\r\n```", "output": "It probably should accept a `str` as well or maybe an alternative solution could be a field `aliases`.\n\n> It probably should accept a `str` as well or maybe an alternative solution could be a field `aliases`.\r\n\r\nYes, my intention was not to break compatibility and make it accept both an `str` and a `Iterable[str]`, I'll edit my issue to make it more clear\n\n`alias` goes from pydantic so we can't make in on FastAPI layer (there is`__slots__` defined for base class) as I can se it for now", "source": "bug_issue", "type": "bug_solution", "issue_number": 63}
{"instruction": "How to fix: Making file field as Optional", "input": "I've a form-data request for user signUp process. \r\nThe user can or can't upload it's picture it's optional. \r\nI've created a api, with field types as form and for image as Uploadfile everything works perfect but it is making the image field as required. \r\nIs it possible to make the file input as optional.. \r\nDo share any reference docs..", "output": "Can you add a minimal reproducible example? It's hard to help.\n\nyou could add like `file: bytes =File(None)` or `file: bytes = File(b'')` and check if its not none or empty like `if file is not None:` or `if file:`\n\nwhen you add a default value it became optional", "source": "bug_issue", "type": "bug_solution", "issue_number": 62}
{"instruction": "Debug this error: Error loading ASGI app. Could not import module \"src.main\"", "input": "```\nfrom fastapi import Depends, FastAPI, HTTPException, status\r\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\r\nfrom fastapi.security.oauth2 import OAuth2PasswordRequestForm\r\nfrom . import models\r\nfrom . import services\r\nfrom .database import engine, get_db\r\nfrom passlib.context import CryptContext\r\nfrom sqlalchemy.orm import Session\r\nfrom datetime import datetime, timedelta\r\n\r\napp = FastAPI()\r\n\r\noauth2_scheme = OAuth2PasswordBearer(tokenUrl='login')\r\n\r\npwd_context = CryptContext(schemes=['bcrypt'], depracated='auto')\r\n\r\nmodels.Base.metadata.create_all(bind=engine)\r\n\r\nSECRET_KEY = '[SECRET KEY]'\r\nALGORITHM = 'HS256'\r\nACCESS_TOKEN_EXPIRE_MINUTES = 30\r\n\r\n\r\n\r\n@app.get(\"/\")\r\nasync def root():\r\n    return {\"message\": \"Hello World\"}\r\n    \r\n@app.get(\"/test/\")\r\nasync def test(token:str = Depends(oauth2_scheme)):\r\n    return {'token', token}\r\n\r\n@app.post('/login/{method}')\r\nasync def login(method: str, form_data: OAuth2PasswordRequestForm = Depends(), db: Session = Depends(get_db), ):\r\n    user = services.authenticate_user(form_data.username, form_data.password)\r\n    if not user:\r\n        raise HTTPException(\r\n            status_code=status.HTTP_401_UNAUTHORIZED,\r\n            detail=\"Incorrect username or password\",\r\n            headers={\"WWW-Authenticate\": \"Bearer\"},\r\n        )\r\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\r\n    access_token = services.create_access_token(\r\n        data={\"username\": user.username, \"email\": user.email}, expires_delta=access_token_expires\r\n    )\r\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n```", "output": "Can you give us your directory structure and the directory you are in when you run your uvicorn command?\n\nYou should be in the same directory as your main file to run `uvicorn main:app` so it will go to the main.py file and find the app object\n\n> Can you give us your directory structure and the directory you are in when you run your uvicorn command?\r\n> \r\n> You should be in the same directory as your main file to run `uvicorn main:app` so it will go to the main.py file and find the app object\r\n\r\n![image](https://user-images.githubusercontent.com/25674730/135541526-2cd340c6-0073-447b-8e64-9dd77555a997.png)\r\n\n\nWhere are you running your command from? what is the directory? Could you run `pwd` and an `ls` ", "source": "bug_issue", "type": "error_debug", "issue_number": 61}
{"instruction": "How to fix: Error loading ASGI app. Could not import module \"src.main\"", "input": "### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options üëÜ\n\n### Example Code\n\n```python\nfrom fastapi import Depends, FastAPI, HTTPException, status\r\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\r\nfrom fastapi.security.oauth2 import OAuth2PasswordRequestForm\r\nfrom . import models\r\nfrom . import services\r\nfrom .database import engine, get_db\r\nfrom passlib.context import CryptContext\r\nfrom sqlalchemy.orm import Session\r\nfrom datetime import datetime, timedelta\r\n\r\napp = FastAPI()\r\n\r\noauth2_scheme = OAuth2PasswordBearer(tokenUrl='login')\r\n\r\npwd_context = CryptContext(schemes=['bcrypt'], depracated='auto')\r\n\r\nmodels.Base.metadata.create_all(bind=engine)\r\n\r\nSECRET_KEY = '[SECRET KEY]'\r\nALGORITHM = 'HS256'\r\nACCESS_TOKEN_EXPIRE_MINUTES = 30\r\n\r\n\r\n\r\n@app.get(\"/\")\r\nasync def root():\r\n    return {\"message\": \"Hello World\"}\r\n    \r\n@app.get(\"/test/\")\r\nasync def test(token:str = Depends(oauth2_scheme)):\r\n    return {'token', token}\r\n\r\n@app.post('/login/{method}')\r\nasync def login(method: str, form_data: OAuth2PasswordRequestForm = Depends(), db: Session = Depends(get_db), ):\r\n    user = services.authenticate_user(form_data.username, form_data.password)\r\n    if not user:\r\n        raise HTTPException(\r\n            status_code=status.HTTP_401_UNAUTHORIZED,\r\n            detail=\"Incorrect username or password\",\r\n            headers={\"WWW-Authenticate\": \"Bearer\"},\r\n        )\r\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\r\n    access_token = services.create_access_token(\r\n        data={\"username\": user.username, \"email\": user.email}, expires_delta=access_token_expires\r\n    )\r\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n```\n\n\n### Description\n\nI saw the solution is changing 'main' -> 'src.main' so I tried that, but the same problem is occuring Even if I use 'cd src' to move to src and run 'uvicorn main:app --reload', errors continue. What do I need?\n\n### Operating System\n\nLinux\n\n### Operating System Details\n\nWSL 2\n\n### FastAPI Version\n\n0.68.1\n\n### Python Version\n\n3.8.10\n\n### Additional Context\n\n_No response_", "output": "Can you give us your directory structure and the directory you are in when you run your uvicorn command?\n\nYou should be in the same directory as your main file to run `uvicorn main:app` so it will go to the main.py file and find the app object\n\n> Can you give us your directory structure and the directory you are in when you run your uvicorn command?\r\n> \r\n> You should be in the same directory as your main file to run `uvicorn main:app` so it will go to the main.py file and find the app object\r\n\r\n![image](https://user-images.githubusercontent.com/25674730/135541526-2cd340c6-0073-447b-8e64-9dd77555a997.png)\r\n\n\nWhere are you running your command from? what is the directory? Could you run `pwd` and an `ls` ", "source": "bug_issue", "type": "bug_solution", "issue_number": 61}
{"instruction": "How to fix: Production configuration of gunicorn", "input": "NOTE: I'm not sure whether i should be filing this here or upstream on starlette. Please let me know if Starlette developers are more knowledgeable about this. However, I'm using fastapi.\r\n\r\nWhat is a good configuration setting for gunicorn in production.\r\n\r\nOn reading documentation of gunicorn with uvicorn, there are lines like this \r\n\r\n> \"Gunicorn provides a different set of configuration options to Uvicorn, so some options such as --limit-concurrency are not yet supported when running with Gunicorn\"\r\n\r\nIs it possible for you to share a list of options that work well ? One of the biggest question is around threads - should we set the threads option?\r\nwhat about stuff like \"worker_connections\" , \"keepalive\" (especially in context of async code)", "output": "This might be a reasonable starting point: https://github.com/tiangolo/uvicorn-gunicorn-docker/blob/master/python3.7/gunicorn_conf.py\r\n\r\nBut it doesn't go into much depth on the available options.\r\n\r\nThe starlette and uvicorn repos would also be good places to ask this question / search for related issues.\n\nI started mine off from a gunicorn example https://github.com/benoitc/gunicorn/blob/master/examples/example_config.py\r\n\r\nThen set mine like this - https://github.com/devsetgo/test-api/blob/master/app/gunicorn_cfg.py\r\n\r\nFrom my experience, i have found that I really just need to set workers, bind, port, and for starlette/fastapi the worker class is what makes uvicorn work with gunicorn.\n\nHi mike\nAre you setting threads in gunicorn ? Im not sure if the Uvicorn worker\nplays well with threads.\n\nWhat's the things you tune for in production?\n\nOn Sun, 22 Sep, 2019, 05:29 Mike Ryan, <notifications@github.com> wrote:\n\n> I started mine off from a gunicorn example\n> https://github.com/benoitc/gunicorn/blob/master/examples/example_config.py\n>\n> Then set mine like this -\n> https://github.com/devsetgo/test-api/blob/master/app/gunicorn_cfg.py\n>\n> From my experience, i have found that I really just need to set workers,\n> bind, port, and for starlette/fastapi the worker class is what makes\n> uvicorn work with gunicorn.\n>\n> ‚Äî\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/551?email_source=notifications&email_token=AAASYU2O5KBYPNMLAPO63UDQK2YONA5CNFSM4IYM5US2YY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOD7I3T4Q#issuecomment-533838322>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAASYU67APO7ZOC4ELT2LWDQK2YONANCNFSM4IYM5USQ>\n> .\n>\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 60}
{"instruction": "Debug this error: Dependency Models created from Form input data are loosing metadata(field set) and are enforcing validation on default values.", "input": "```\nfrom typing import Annotated\n\nfrom fastapi import FastAPI, Form\nfrom fastapi.testclient import TestClient\nfrom pydantic import BaseModel\n\nclass ExampleModel(BaseModel):\n    field_1: bool = True\n\napp = FastAPI()\n\n@app.post(\"/body\")\nasync def body_endpoint(model: ExampleModel):\n    return {\"fields_set\": list(model.model_fields_set)}\n\n@app.post(\"/form\")\nasync def form_endpoint(model: Annotated[ExampleModel, Form()]):\n    return {\"fields_set\": list(model.model_fields_set)}\n\nclient = TestClient(app)\n\ndef test_body():\n    resp = client.post(\"/body\", json={})\n    assert resp.status_code == 200, resp.text\n    fields_set = resp.json()[\"fields_set\"]\n    assert fields_set == []  # Ok\n\ndef test_form():\n    resp = client.post(\"/form\", data={})\n    assert resp.status_code == 200, resp.text\n    fields_set = resp.json()[\"fields_set\"]\n    assert fields_set == []  # AssertionError: assert ['field_1'] == []\n\n```\n\n```\nimport uvicorn\nfrom typing import Annotated\nfrom pydantic import BaseModel, Field\n\nfrom fastapi import FastAPI, Form\n\n\nclass ExampleJsonModel(BaseModel):\n    sample_field_1: Annotated[bool, Field(default=True)]\n    sample_field_2: Annotated[bool, Field(default=False)]\n    sample_field_3: Annotated[bool, Field(default=None)]\n    sample_field_4: Annotated[str, Field(default=0)] # This is dangerous but can be used with a validator\n\n\nclass ExampleFormModel(BaseModel):\n    sample_field_1: Annotated[bool, Form(default=True)]\n    sample_field_2: Annotated[bool, Form(default=False)]\n    sample_field_3: Annotated[bool, Form(default=None)]\n    sample_field_4: Annotated[str, Form(default=0)] # This is dangerous but can be used with a validator\n\n\nclass ResponseSampleModel(BaseModel):\n    fields_set: Annotated[list, Field(default_factory=list)]\n    dumped_fields_no_exclude: Annotated[dict, Field(default_factory=dict)]\n    dumped_fields_exclude_default: Annotated[dict, Field(default_factory=dict)]\n    dumped_fields_exclude_unset: Annotated[dict, Field(default_factory=dict)]\n\n\n\napp = FastAPI()\n\n\n@app.post(\"/form\")\nasync def form_endpoint(model: Annotated[ExampleFormModel, Form()]) -> ResponseSampleModel:\n    return ResponseSampleModel(\n        fields_set=list(model.model_fields_set),\n        dumped_fields_no_exclude=model.model_dump(),\n        dumped_fields_exclude_default=model.model_dump(exclude_defaults=True),\n        dumped_fields_exclude_unset=model.model_dump(exclude_unset=True)\n    )\n\n@app.post(\"/json\")\nasync def form_endpoint(model: ExampleJsonModel) -> ResponseSampleModel:\n    return ResponseSampleModel(\n        fields_set=list(model.model_fields_set),\n        dumped_fields_no_exclude=model.model_dump(),\n        dumped_fields_exclude_default=model.model_dump(exclude_defaults=True),\n        dumped_fields_exclude_unset=model.model_dump(exclude_unset=True)\n    )\n\n\nif __name__ == \"__main__\":\n    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n\n\n```\n\n```\nimport pytest\nfrom fastapi.testclient import TestClient\n\nfrom fastapi_defaults_bug import (\n    app,\n    ExampleFormModel,\n    ExampleJsonModel,\n    ResponseSampleModel\n)\n\n@pytest.fixture(scope=\"module\")\ndef fastapi_client():\n    with TestClient(app) as test_client:\n        yield test_client\n\n\n################\n# Section 1: Tests on Form model -> no fastapi, pydantic model\n################\n\ndef test_form_model_pydantic_only_defaults():\n    f_model = ExampleFormModel()\n    for field_name, field in f_model.model_fields.items():\n        assert getattr(f_model, field_name) == field.default\n\ndef test_form_model_pydantic_all_unset():\n    f_model = ExampleFormModel()\n    assert not f_model.model_fields_set\n\ndef test_form_model_pydantic_set_1():\n    f_model = ExampleFormModel(sample_field_1=True) # Those set have the same value of default\n    assert \"sample_field_1\" in f_model.model_fields_set\n    assert len(f_model.model_fields_set) == 1\n\ndef test_form_model_pydantic_set_2():\n    f_model = ExampleFormModel(sample_field_1=True, sample_field_2=False) # Those set have the same value of default\n    assert", "output": "I'd like to contribute to this - \n\nTrying to scope out what a fix might look like here: \n\nThe most minimal change might look something like just replacing these lines with just `return` : https://github.com/fastapi/fastapi/blob/f8878f3a98057c6ab6161d2577fab49087ba7015/fastapi/dependencies/utils.py#L733-L736\n\nThat would pass an explicit `None` that could be used in a `before` model validator to differentiate the form input case from the json input case, even if it is a bit implicit. \n\nThe second idea that would also fix my case, and might be nice to have in general, is an additional `@form_validator` decorator that someone can use to process values after they are extracted from the form but before the rest of the pydantic validation process. This would make a more explicit means of handling the quirks of form encoding.\n\nIt seems like there is a decent amount of additional logic in the input handling that might come from needing to maintain compatibility with old pydantic versions? In the most na√Øve implementation, one might expect there to be no additional logic beyond (a) formencoded data -> dict, (b) instantiate model, (c) optionally report errors. So maybe the most complex fix would be to try and remove that handling when used with pydantic v2 and just use its error handling that includes locations? From my reading it looks like the code is already mostly ready for it, but to the degree that we can decouple form handling, we might be able to set us up for being able to handle multiple content types in the same endpoint. \n\nLet me know if you have a preferred form of the fix for this, otherwise I can get working on a fix that passes the above tests\n\n\ni would like to take this, can some help me with starting things up\n\nHello @Warlord-10  what do you need exactly?", "source": "bug_issue", "type": "error_debug", "issue_number": 59}
{"instruction": "Analyze this error traceback and suggest a fix", "input": "### Discussed in https://github.com/fastapi/fastapi/discussions/13380\n\n<div type='discussions-op-text'>\n\n<sup>Originally posted by **sneakers-the-rat** February 16, 2025</sup>\n### First Check\n\n- [X] I added a very descriptive title here.\n- [X] I used the GitHub search to find a similar question and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/pydantic/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options üëÜ\n\n### Example Code\n\n**Short version (UPD by @YuriiMotov):**\n\n```python\nfrom typing import Annotated\n\nfrom fastapi import FastAPI, Form\nfrom fastapi.testclient import TestClient\nfrom pydantic import BaseModel\n\nclass ExampleModel(BaseModel):\n    field_1: bool = True\n\napp = FastAPI()\n\n@app.post(\"/body\")\nasync def body_endpoint(model: ExampleModel):\n    return {\"fields_set\": list(model.model_fields_set)}\n\n@app.post(\"/form\")\nasync def form_endpoint(model: Annotated[ExampleModel, Form()]):\n    return {\"fields_set\": list(model.model_fields_set)}\n\nclient = TestClient(app)\n\ndef test_body():\n    resp = client.post(\"/body\", json={})\n    assert resp.status_code == 200, resp.text\n    fields_set = resp.json()[\"fields_set\"]\n    assert fields_set == []  # Ok\n\ndef test_form():\n    resp = client.post(\"/form\", data={})\n    assert resp.status_code == 200, resp.text\n    fields_set = resp.json()[\"fields_set\"]\n    assert fields_set == []  # AssertionError: assert ['field_1'] == []\n```\n\n**Original code (in details):**\n\n<details>\n\nFile: fastapi_defaults_bug.py\n```python\nimport uvicorn\nfrom typing import Annotated\nfrom pydantic import BaseModel, Field\n\nfrom fastapi import FastAPI, Form\n\n\nclass ExampleJsonModel(BaseModel):\n    sample_field_1: Annotated[bool, Field(default=True)]\n    sample_field_2: Annotated[bool, Field(default=False)]\n    sample_field_3: Annotated[bool, Field(default=None)]\n    sample_field_4: Annotated[str, Field(default=0)] # This is dangerous but can be used with a validator\n\n\nclass ExampleFormModel(BaseModel):\n    sample_field_1: Annotated[bool, Form(default=True)]\n    sample_field_2: Annotated[bool, Form(default=False)]\n    sample_field_3: Annotated[bool, Form(default=None)]\n    sample_field_4: Annotated[str, Form(default=0)] # This is dangerous but can be used with a validator\n\n\nclass ResponseSampleModel(BaseModel):\n    fields_set: Annotated[list, Field(default_factory=list)]\n    dumped_fields_no_exclude: Annotated[dict, Field(default_factory=dict)]\n    dumped_fields_exclude_default: Annotated[dict, Field(default_factory=dict)]\n    dumped_fields_exclude_unset: Annotated[dict, Field(default_factory=dict)]\n\n\n\napp = FastAPI()\n\n\n@app.post(\"/form\")\nasync def form_endpoint(model: Annotated[ExampleFormModel, Form()]) -> ResponseSampleModel:\n    return ResponseSampleModel(\n        fields_set=list(model.model_fields_set),\n        dumped_fields_no_exclude=model.model_dump(),\n        dumped_fields_exclude_default=model.model_dump(exclude_defaults=True),\n        dumped_fields_exclude_unset=model.model_dump(exclude_unset=True)\n    )\n\n@app.post(\"/json\")\nasync def form_endpoint(model: ExampleJsonModel) -> ResponseSampleModel:\n    return ResponseSampleModel(\n        fields_set=list(model.model_fields_set),\n        dumped_fields_no_exclude=model.model_dump(),\n        dumped_fields_exclude_default=model.model_dump(exclude_defaults=True),\n        dumped_fields_exclude_unset=model.model_dump(exclude_unset=True)\n    )\n\n\nif __name__ == \"__main__\":\n    uvicorn.run(app, host=\"0.0.0.0\", port=800", "output": "**@sneakers-the-rat** (2025-02-21T05:14:06Z):\n\nI'd like to contribute to this - \n\nTrying to scope out what a fix might look like here: \n\nThe most minimal change might look something like just replacing these lines with just `return` : https://github.com/fastapi/fastapi/blob/f8878f3a98057c6ab6161d2577fab49087ba7015/fastapi/dependencies/utils.py#L733-L736\n\nThat would pass an explicit `None` that could be used in a `before` model validator to differentiate the form input case from the json input case, even if it is a bit implicit. \n\nThe second idea that would also fix my case, and might be nice to have in general, is an additional `@form_validator` decorator that someone can use to process values after they are extracted from the form but before the rest of the pydantic validation process. This would make a more explicit means of handling the quirks of form encoding.\n\nIt seems like there is a decent amount of additional logic in the input handling that might come from needing to maintain compatibility with old pydantic versions? In the most na√Øve implementation, one might expect there to be no additional logic beyond (a) formencoded data -> dict, (b) instantiate model, (c) optionally report errors. So maybe the most complex fix would be to try and remove that handling when used with pydantic v2 and just use its error handling that includes locations? From my reading it looks like the code is already mostly ready for it, but to the degree that we can decouple form handling, we might be able to set us up for being able to handle multiple content types in the same endpoint. \n\nLet me know if you have a preferred form of the fix for this, otherwise I can get working on a fix that passes the above tests\n", "source": "bug_issue", "type": "traceback_analysis", "issue_number": 59}
{"instruction": "How to fix: FastAPI keeps booting new workers when deploying", "input": "Hi there,\r\n\r\nI'm trying to run two different instances of FastAPI in the same Kubernetes pod (different Docker containers), but one of the two seems to keep booting up new workers. Therefor, the container uses a lot of CPU for nothing. It's also reporting that it's waiting for application startup constantly, but it is reachable (but slow).\r\n\r\nHere is the log that I keep getting:\r\n\r\n```\r\nChecking for script in /app/prestart.sh\r\nRunning script /app/prestart.sh\r\nRunning inside /app/prestart.sh, you could add migrations to this file, e.g.:\r\n #! /usr/bin/env bash\r\n # Let the DB start\r\nsleep 10;\r\n# Run migrations\r\nalembic upgrade head\r\n [2019-05-24 11:51:24 +0000] [1] [INFO] Starting gunicorn 19.9.0\r\n[2019-05-24 11:51:24 +0000] [1] [INFO] Listening at: http://0.0.0.0:8081 (1)\r\n[2019-05-24 11:51:24 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker\r\n[2019-05-24 11:51:24 +0000] [8] [INFO] Booting worker with pid: 8\r\n[2019-05-24 11:51:24 +0000] [9] [INFO] Booting worker with pid: 9\r\nWARNING:root:email-validator not installed, email fields will be treated as str.\r\nTo install, run: pip install email-validator\r\nWARNING:root:email-validator not installed, email fields will be treated as str.\r\nTo install, run: pip install email-validator\r\n[2019-05-24 11:51:33 +0000] [9] [INFO] Started server process [9]\r\n[2019-05-24 11:51:33 +0000] [9] [INFO] Waiting for application startup.\r\n[2019-05-24 11:51:33 +0000] [8] [INFO] Started server process [8]\r\n[2019-05-24 11:51:33 +0000] [8] [INFO] Waiting for application startup.\r\n[2019-05-24 11:51:37 +0000] [18] [INFO] Booting worker with pid: 18\r\nWARNING:root:email-validator not installed, email fields will be treated as str.\r\nTo install, run: pip install email-validator\r\n[2019-05-24 11:51:44 +0000] [18] [INFO] Started server process [18]\r\n[2019-05-24 11:51:44 +0000] [18] [INFO] Waiting for application startup.\r\n[2019-05-24 11:51:45 +0000] [23] [INFO] Booting worker with pid: 23\r\nWARNING:root:email-validator not installed, email fields will be treated as str.\r\nTo install, run: pip install email-validator\r\n[2019-05-24 11:51:53 +0000] [23] [INFO] Started server process [23]\r\n[2019-05-24 11:51:53 +0000] [23] [INFO] Waiting for application startup.\r\n[2019-05-24 11:51:54 +0000] [28] [INFO] Booting worker with pid: 28\r\nWARNING:root:email-validator not installed, email fields will be treated as str.\r\nTo install, run: pip install email-validator\r\n[2019-05-24 11:52:02 +0000] [28] [INFO] Started server process [28]\r\n[2019-05-24 11:52:02 +0000] [28] [INFO] Waiting for application startup.\r\n```\r\n\r\nThis will continue untill I shut it down. This problem weirdly does not happen when I run everything locally.\r\n\r\nA difference between local and remote deployment is probably only the port that I set.\r\nAs you can see, I use port 8081:\r\n```\r\n[INFO] Listening at: http://0.0.0.0:8081 (1)\r\n```\r\n\r\nI set the port by specifying it in my Kubernetes yaml file, but I am unsure if this has something to do with the problem.", "output": "Iirc there are no max workers set so I'd either tweak the gunicorn conf to\nset your number according to the server you deploy on, or set another env\nvar, can't remember on top of my head but it's in the docs I'm sure\n\nLe ven. 24 mai 2019 √† 2:03 PM, SansDK <notifications@github.com> a √©crit :\n\n> Hi there,\n>\n> I'm trying to run two different instances of FastAPI in the same\n> Kubernetes pod (different Docker containers), but one of the two seems to\n> keep booting up new workers. Therefor, the container uses a lot of CPU for\n> nothing. It's also reporting that it's waiting for application startup\n> constantly, but it is reachable (but slow).\n>\n> Here is the log that I keep getting:\n>\n> Checking for script in /app/prestart.sh\n> Running script /app/prestart.sh\n> Running inside /app/prestart.sh, you could add migrations to this file, e.g.:\n>  #! /usr/bin/env bash\n>  # Let the DB start\n> sleep 10;\n> # Run migrations\n> alembic upgrade head\n>  [2019-05-24 11:51:24 +0000] [1] [INFO] Starting gunicorn 19.9.0\n> [2019-05-24 11:51:24 +0000] [1] [INFO] Listening at: http://0.0.0.0:8081 (1)\n> [2019-05-24 11:51:24 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker\n> [2019-05-24 11:51:24 +0000] [8] [INFO] Booting worker with pid: 8\n> [2019-05-24 11:51:24 +0000] [9] [INFO] Booting worker with pid: 9\n> WARNING:root:email-validator not installed, email fields will be treated as str.\n> To install, run: pip install email-validator\n> WARNING:root:email-validator not installed, email fields will be treated as str.\n> To install, run: pip install email-validator\n> [2019-05-24 11:51:33 +0000] [9] [INFO] Started server process [9]\n> [2019-05-24 11:51:33 +0000] [9] [INFO] Waiting for application startup.\n> [2019-05-24 11:51:33 +0000] [8] [INFO] Started server process [8]\n> [2019-05-24 11:51:33 +0000] [8] [INFO] Waiting for application startup.\n> [2019-05-24 11:51:37 +0000] [18] [INFO] Booting worker with pid: 18\n> WARNING:root:email-validator not installed, email fields will be treated as str.\n> To install, run: pip install email-validator\n> [2019-05-24 11:51:44 +0000] [18] [INFO] Started server process [18]\n> [2019-05-24 11:51:44 +0000] [18] [INFO] Waiting for application startup.\n> [2019-05-24 11:51:45 +0000] [23] [INFO] Booting worker with pid: 23\n> WARNING:root:email-validator not installed, email fields will be treated as str.\n> To install, run: pip install email-validator\n> [2019-05-24 11:51:53 +0000] [23] [INFO] Started server process [23]\n> [2019-05-24 11:51:53 +0000] [23] [INFO] Waiting for application startup.\n> [2019-05-24 11:51:54 +0000] [28] [INFO] Booting worker with pid: 28\n> WARNING:root:email-validator not installed, email fields will be treated as str.\n> To install, run: pip install email-validator\n> [2019-05-24 11:52:02 +0000] [28] [INFO] Started server process [28]\n> [2019-05-24 11:52:02 +0000] [28] [INFO] Waiting for application startup.\n>\n> This will continue untill I shut it down. This problem weirdly does not\n> happen when I run everything locally.\n>\n> A difference between local and remote deployment is probably only the port\n> that I set.\n> As you can see, I use port 8081:\n>\n> [INFO] Listening at: http://0.0.0.0:8081 (1)\n>\n> I set the port by specifying it in my Kubernetes yaml file, but I am\n> unsure if this has something to do with the problem.\n>\n> ‚Äî\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/253?email_source=notifications&email_token=AAINSPWLEJ53IUGIRMY2MDDPW7KQBA5CNFSM4HPO4Y32YY3PNVWWK3TUL52HS4DFUVEXG43VMWVGG33NNVSW45C7NFSM4GVV7SAQ>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAINSPTKBVSZMRPIDNLUCDTPW7KQBANCNFSM4HPO4Y3Q>\n> .\n>\n\nLe ven. 24 mai 2019 √† 2:03 PM, SansDK <notifications@github.com> a √©crit :\n\n> Hi there,\n>\n> I'm trying to run two different instances of FastAPI in the same\n> Kubernetes pod (different Docker containers), but one of the two seems to\n> keep booting up new workers. Therefor, the container uses a lot of CPU for\n> nothing. It's also reporting that it's waiting for application startup\n> constantly, but it is reachable (but slow).\n>\n> Here is the log that I keep getting:\n>\n> Checking for script in /app/prestart.sh\n> Running script /app/prestart.sh\n> Running inside /app/prestart.sh, you could add migrations to this file, e.g.:\n>  #! /usr/bin/env bash\n>  # Let the DB start\n> sleep 10;\n> # Run migrations\n> alembic upgrade head\n>  [2019-05-24 11:51:24 +0000] [1] [INFO] Starting gunicorn 19.9.0\n> [2019-05-24 11:51:24 +0000] [1] [INFO] Listening at: http://0.0.0.0:8081 (1)\n> [2019-05-24 11:51:24 +0000] [1] [INFO] Using worker: uvicorn.workers.UvicornWorker\n> [2019-05-24 11:51:24 +0000] [8] [INFO] Booting worker with pid: 8\n> [2019-05-24 11:51:24 +0000] [9] [INFO] Booting worker with pid: 9\n> WARNING:root:email-validator not installed, email fields will be treated as str.\n> To install, run: pip install email-validator\n> WARNING:root:emai", "source": "bug_issue", "type": "bug_solution", "issue_number": 58}
{"instruction": "How to fix: File Upload Difficulties", "input": "Hello - I am not having any luck with file upload to FastAPI - I am trying to load JPEG images.  I have reviewed the other github, stackoverflow comments and none of the solutions work. \r\n\r\nI believe the issue is with the front-end - and I am able to get it to work with the swagger \\docs interface.  From my front-end I have tried submitting directly from a form as well as formData via XMLHttpRequest and fetch (would prefer either of the latter).  I am using plain javascript. \r\n\r\nI am sure I am doing something wrong - I just don't know what it is.  Any advice would be deeply appreciated - I am 20+hours deep into trying to solve this one.  **Thanks in advance!**\r\n\r\n**Here is the swagger curl:**\r\n``curl -X POST \"http://localhost:8000/staff/upload_image/\" -H  \"accept: application/json\" -H  \"Content-Type: multipart/form-data\" -F \"image=@_WGL1281.jpg;type=image/jpeg\"\r\n``\r\n\r\n**Server Reply:  POST http://localhost:8000/staff/upload_image/ 422 (Unprocessable Entity)**\r\n\r\n**Installed Versions:**\r\n```\r\nfastapi - 0.54.1\r\nstarlette - 0.13.2\r\npydantic - 1.5.1\r\npython - 3.832\r\npython-multipart - 0.0.5\r\n\r\n```\r\n**Server side code snippets:**\r\n\r\n```\r\nfrom fastapi import APIRouter, Request, Depends, File, UploadFile\r\n\r\n@router.post(\"/staff/upload_image/\")\r\nasync def upload_image(image: UploadFile = File(...)):\r\n\tprint(image.filename)\r\n\treturn {\"filename\": image.filename}\r\n\r\n```\r\n\r\n**client side:**\r\n```\r\nasync function imageupload(){\r\n            let imageinput = document.getElementById('testimage');\r\n            let formData = new FormData();\r\n            formData.append('imagefile', imageinput.files[0]);\r\n\r\n            let response = await fetch('/staff/upload_image/', {\r\n                method: 'POST',\r\n                body: formData\r\n            })\r\n\r\n            await console.log(response);\r\n\r\n```", "output": "Can you try with the latest version of fastapi, and give us the error from the server logs?\n\nI have updated FastAPI and dependencies to the following:\r\n```\r\nfastapi - 0.62.0\r\nstarlette - 0.13.6\r\n```\r\n\r\nServer log using my front end code:\r\n```\r\n‚Üê[32mINFO‚Üê[0m:     127.0.0.1:54609 - \"‚Üê[1mGET /staff_main HTTP/1.1‚Üê[0m\" ‚Üê[32m200 OK‚Üê[0m\r\n‚Üê[32mINFO‚Üê[0m:     127.0.0.1:54609 - \"‚Üê[1mGET /favicon.ico HTTP/1.1‚Üê[0m\" ‚Üê[31m404 Not Found‚Üê[0m\r\n‚Üê[32mINFO‚Üê[0m:     127.0.0.1:54609 - \"‚Üê[1mPOST /staff/upload_image/ HTTP/1.1‚Üê[0m\" ‚Üê[31m422 Unprocessable Entity‚Üê[0m\r\n```\r\nAnd with the swagger docs interface:\r\n```\r\n‚Üê[32mINFO‚Üê[0m:     127.0.0.1:54610 - \"‚Üê[1mGET /docs HTTP/1.1‚Üê[0m\" ‚Üê[32m200 OK‚Üê[0m\r\n‚Üê[32mINFO‚Üê[0m:     127.0.0.1:54610 - \"‚Üê[1mGET /openapi.json HTTP/1.1‚Üê[0m\" ‚Üê[32m200 OK‚Üê[0m\r\n_WGL0071.jpg\r\n‚Üê[32mINFO‚Üê[0m:     127.0.0.1:54611 - \"‚Üê[1mPOST /staff/upload_image/ HTTP/1.1‚Üê[0m\" ‚Üê[32m200 OK‚Üê[0m\r\n```\r\nwhere the _WGL0071.jpg is a response to print the file name on the server. \r\n\n\nSo the above results are using fetch.  When I switch to XMLHttpRequest - I get a different message in my console.log - in case this helps.  \r\n\r\n`{\"detail\":[{\"loc\":[\"body\",\"image\"],\"msg\":\"field required\",\"type\":\"value_error.missing\"}]}\r\n`", "source": "bug_issue", "type": "bug_solution", "issue_number": 57}
{"instruction": "How to fix: FastAPI 0.65.2 POST request fails with \"value is not a valid dict\" when using the Requests library; 0.65.1 works (with a caveat)", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [ ] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [ ] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [ ] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\nFirst off, thank you for creating this marvellous piece of software. It is a real life-changer.\r\n\r\nI hit a very odd bug while implementing some unit tests. Using FastAPI `0.65.2`, a POST request via the `requests` module (`requests.post`) consistently returns the following error:\r\n\r\n`{'detail': [{'loc': ['body'], 'msg': 'value is not a valid dict', 'type': 'type_error.dict'}]}`\r\n\r\nI created a reproducible example:\r\n\r\n```\r\nfrom fastapi import FastAPI\r\nfrom pydantic import BaseModel\r\nimport uvicorn\r\n\r\napp = FastAPI()\r\n\r\nclass Data(BaseModel):\r\n    field: str\r\n\r\n\r\n@app.post(\"/test\")\r\ndef test_data(data: Data):\r\n    return \"Polo\"\r\n\r\nif __name__=='__main__':\r\n    uvicorn.run(app)\r\n```\r\n\r\nAnd the `requests` counterpart:\r\n\r\n```\r\nimport requests as rq\r\n\r\ndef test():\r\n    result = rq.post('http://127.0.0.1:8000/test', data={\"field\": \"Marco\"})\r\n    print(f\"==[ result: {result.json()}\")\r\n\r\nif __name__==\"__main__\":\r\n    test()\r\n```\r\n\r\nThe result is\r\n\r\n`==[ result: {'detail': [{'loc': ['body'], 'msg': 'value is not a valid dict', 'type': 'type_error.dict'}]}`\r\n\r\nIf I downgrade FastAPI to `0.65.1`, I still get an error, but a different one:\r\n\r\n`==[ result: {'detail': [{'loc': ['body', 0], 'msg': 'Expecting value: line 1 column 1 (char 0)', 'type': 'value_error.jsondecode', 'ctx': {'msg': 'Expecting value', 'doc': 'field=heya', 'pos': 0, 'lineno': 1, 'colno': 1}}]}`\r\n\r\nThis  can be solved by JSONifying the dictionary:\r\n\r\n```\r\nimport requests as rq\r\nimport json as js\r\n\r\ndef test():\r\n    result = rq.post('http://127.0.0.1:8000/test', data = js.dumps({\"field\": \"Marco\"}))\r\n    print(f\"==[ result: {result.json()}\")\r\n\r\nif __name__==\"__main__\":\r\n    test()\r\n```\r\n\r\nRunning the above prints\r\n\r\n`==[ result: Polo`\r\n\r\nI am slightly perplexed because I am not sure if it is the `requests` library that is to blame or FastAPI. POSTing via ReDoc works without hiccups ", "output": "You probably meant to use the json parameter, not the data parameter. Data is for form data\n\n@Mause  \r\n\r\nThank you for the quick reply. What you suggested indeed fixed the problem, so I will mark this as resolved, but I am still perplexed. I never knew that the `data` parameter was for form data - I have always used `data` until I encountered this issue.  This is from the `requests` [documentation](https://docs.python-requests.org/en/latest/user/quickstart/):\r\n\r\n> Requests‚Äô simple API means that all forms of HTTP request are as obvious. For example, this is how you make an HTTP POST request:\r\n> `>>> r = requests.post('https://httpbin.org/post', data = {'key':'value'})`\r\n\r\nAlso, I'm not sure why downgrading FastAPI works (subject to the JSONification caveat above).\r\n\r\nStill, all is well that ends well. :) Thank you for your help!\n\nThe reason the downgrade fixed it was due to the json post handling in the latest version - it was changed so it only tried to parse bodies with a valid Content-Type header as json, which the data parameter wouldn't set", "source": "bug_issue", "type": "bug_solution", "issue_number": 56}
{"instruction": "How to fix: FastAPI with Pydantic v2", "input": "Is FastAPI with support for Pydantic v2 working for you (`0.100.0-beta1`)?\r\n\r\n~Let me know **in this discussion** on the link: https://github.com/tiangolo/fastapi/discussions/9709~\r\n\r\n~(don't comment in this issue, please go to the discussions and follow the instructions there)~\r\n\r\nAs FastAPI now supports Pydantic v2, any problems are not about the beta (as it's already released üòÖ), so let's keep the normal workflow.\r\n\r\nIf you are having problems, please create a new Discussion question following the template! üôè  https://github.com/tiangolo/fastapi/discussions/new?category=questions", "output": "Hi! I just updated my project to fastapi **v0.100.0-beta1** and pydantic **v2.0b2** and I'm getting the following error:\r\n\r\n```\r\npydantic.errors.PydanticImportError: pydantic:BaseSettings has been removed in V2.\r\n\r\nFor further information visit https://errors.pydantic.dev/2.0b2/u/import-error\r\n\r\n```\r\nIs there any official migration guide from pydantic v1 to pydantic v2? \n\nYes. There is: https://docs.pydantic.dev/dev-v2/migration/\n\nParsing of `Literal` types seems to be broken with Pydantic v2.\r\n\r\nTake this example:\r\n```python\r\nfrom typing import Literal\r\n\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass Health(BaseModel):\r\n    status: Literal[\"ok\", \"error\"]\r\n```\r\n\r\nDoing `print(Health.model_json_schema())` seems to return the right thing (`{'properties': {'status': {'enum': ['ok', 'error'], 'title': 'Status'}}, 'required': ['status'], 'title': 'Health', 'type': 'object'}`)\r\n\r\nHowever, if I use it as the return model for a path operation, the schema is broken in the swagger docs. Weirdly the examples do use one of the values.\r\n\r\n![image](https://github.com/tiangolo/fastapi/assets/47002300/c2c40fbb-33c5-46bc-868c-39cdcf0779c7)\r\n\r\n![image](https://github.com/tiangolo/fastapi/assets/47002300/d0cd0f95-fb7f-4484-842b-ef9ddc65f54e)\r\n\r\nHere is a pastebin with the generated openapi.json: https://pastebin.com/a95Tujah", "source": "bug_issue", "type": "bug_solution", "issue_number": 55}
{"instruction": "How to fix: How to send 204 response?", "input": "I tried to send 204 response in delete method\r\n\r\nExample handler\r\n```\r\n@router.delete('/{order_id}/', tags=['smart order'], status_code=204)\r\nasync def cancel_smart_order(\r\n        session: Session = Depends(get_session),\r\n        order_id: UUID = Path(...)\r\n):\r\n    order = await session.get(order_id)\r\n\r\n    if order.status != OrderStatus.open:\r\n        raise HTTPException(409, f'Order have status: {order.status}')\r\n\r\n    order.status = OrderStatus.canceled\r\n\r\n    await session.commit_only(order)\r\n```\r\n\r\nBut got error `h11._util.LocalProtocolError: Too much data for declared Content-Length`. Seems framefork convert None to null but set content length 0.", "output": "Not sure why the content-length is wrong; that may be a bug. But if you want to return an actual empty response, just set `response_class=Response` in the route decorator (the default is `JSONResponse`, which converts `None` to `\"null\"` as you have noticed).\n\nIt is a bug. I found that if `(event.status_code in (204, or request_method == b\" or (request_method == b\" and 200 <= event.status_code < 300))` than content length set to 0, but by defualt if return None then framevork try to conver None to json and got (`null`(len 4)). Need to add check on status code and try to convert only if the expression above is False.\n\n@heckad \r\nCould you share where this check is performed in the code?\r\n\r\nI don't *necessarily* think it's a bug for a `JSONResponse` to convert `None` to `\"null\"`, regardless of the status code you return; it's up to you to specify that the response class should be `Response` and not `JSONResponse`. But it definitely is a bug if it manually sets the content length to 0 even when that's not the case.\r\n\r\nI personally think the most consistent solution would be to drop the special case for the 204 status code (at least for `JSONResponse`).\r\n\r\nIt could make sense to display some kind of warning if using a 204 response code with a `JSONResponse` though?", "source": "bug_issue", "type": "bug_solution", "issue_number": 54}
{"instruction": "How to fix: Using MQTT with FastAPI", "input": "### First check\r\n\r\n* [x] I used the GitHub search to find a similar issue and didn't find it\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n\r\n### Description: How can I receive MQTT with fastAPI?\r\n\r\nMQTT is used often in IoT. It is much lighter than HTTP and is build on top of TCP. It can also use a WebSocket transport layer.\r\n\r\nI can think of the following options and would be interested to hear what you think.\r\n\r\n#### 1. Use Flask middleware\r\n\r\nFlask has support for MQTT routes, so I could follow the instructions here to implement Flask middleware, https://fastapi.tiangolo.com/advanced/wsgi/#using-wsgimiddleware, however I don't know if this works in general for any protocol (HTTP, MQTT, WS etc.) of if it only routes HTTP.\r\n\r\n#### 2. Use RabbitMQ\r\n\r\n[RabbitMQ](https://www.rabbitmq.com/mqtt.html) has support for MQTT. But I'm unsure how I would integrate this with FastAPI. It would not be appropriate to use a background task, https://fastapi.tiangolo.com/tutorial/background-tasks/ because these are tasks that fired off after returning a response. Probably I would need to use an asyncio.Queue and call API methods manually when an event arrives.\r\n\r\n#### 3. Use MQTT over Websocket\r\n\r\n[paho-mqtt](https://www.eclipse.org/paho/clients/python/docs/) can use WebSocket transport. Again I'm unsure how to integrate this with FastAPI. Could I use the `@websocket` decorator. Probably not because that would just be the transport layer, not the protocol layer!\r\n\r\n```python\r\n@app.websocket(\"/sent_data\")  #  PUT called by external client to send data here\r\nasync def recieved_data_mqtt_over_ws():\r\n    pass\r\n```\r\n\r\n#### Would it be possible to ...?\r\n\r\nEventually something like this might be possible?\r\n\r\n```python\r\n@app.mqtt(\"/sent_data\")  #  PUT called by external client to send data here\r\nasync def recieved_data_mqtt_over_ws():\r\n    pass\r\n```\r\n\r\nI have not yet started to write code for this part of the project yet, but it‚Äôs on the horizon and thought I would try and get some advice sooner rather than later.", "output": "Great question\r\nAlso interested in the answer.\n\nInteresting, I hadn't heard of it, I don't know how that protocol works but it seems it's more similar to WebSockets than to HTTP.\r\n\r\nThe solution would be quite involved, and actually would end up not related to FastAPI :shrug: but anyway, here are my ideas:\r\n\r\n* There would have to be an ASGI sub-specification for MQTT as there's one for HTTP and for WebSockets, I haven't seen one, but I see there are some packages that try to implement a layer for that (you can search \"asgi mqtt\").\r\n\r\n* But then you would need some type of server that supports that protocol, so, probably not Uvicorn, Hypercorn, etc. Maybe one of those packages directly.\r\n\r\n* Then there would be some code that handles that communication, maybe as part of one of those packages or independently.\r\n\r\nMost of those packages seem to target Django Channels, maybe using them would be the simplest approach to handle it.\r\n\r\nIf it was for WebSockets, you could probably mount Django Channels in a FastAPI app, as both are ASGI. But as you need a new, custom, protocol that is not supported by most ASGI servers, you would probably end up needing a custom solution.\n\n@tiangolo thanks! I will think about this when I return to this topic in the future.", "source": "bug_issue", "type": "bug_solution", "issue_number": 53}
{"instruction": "How to fix: Italian translations", "input": "### Italian translations tracking\r\nWe can use this Issue to track the progress of the Italian language translations. üáÆüáπ \r\n\r\nPlease post here what page you plan on translating so we can coordinate. üöÄ\r\n\r\n**Tips**\r\n* Just like [we're doing with the Spanish translations](https://github.com/tiangolo/fastapi/issues/1218), let's use \"tu\" instead of the more formal \"lei\" or \"voi\".\r\n* If the term is a technical term, leave in English and add an explanation of the meaning of the word in Italian.", "output": "For Portuguese there's a telegram channel, idk if you guys want to setup that as well... Is jfyk :) \n\nCool, thanks for letting me know @Kludex. I've created a telegram group for the Italian translations https://t.me/fastapiita :)\n\n~~I'm currently in the process of adding Italian as a new language and translating `index.md`~~\r\n\r\n`index.md` translation at PR #1576 [needing review]\r\n\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 52}
{"instruction": "How to fix: 404 Error with OpenAPI", "input": "Hi all,\r\n\r\nNew to fastAPI, and coming from Flask, I'm very impressed by the solution.\r\nBut using the OpenAPI documentation/UI, I can see in the logs that I have the following issue each time I extend a resource/API :\r\n`INFO:     <IP>:57175 - \"GET /%5Bobject%20Module%5D HTTP/1.1\" 404 Not Found`\r\nThe API is working, but I get this error in the log.\r\n\r\nI'm using v0.63.0, on an ubuntu server (18.04)\r\n\r\nThanks a lot for your support.", "output": "Hi, Welcome to FastAPI\r\n\r\nplease follow the [Issue instruction](https://github.com/tiangolo/fastapi/issues/new/choose).\r\nwe need more information to help you.\r\nthanks.\r\n\r\n\r\n\n\nHi,\r\n\r\nOK, here is what I can add :\r\n\r\nIt seems this issue appeared when I've implemented the following code (but not sure...) :\r\n```python\r\nclass device_import(BaseModel):\r\n    hostname: str\r\n    ipaddress: str\r\n    platform: str\r\n    description: Optional[str] = None\r\n......\r\n@app.post(\"/system/device\", summary=\"Create a new device in the system\", tags=[\"System\"])\r\nasync def post_device(device_info: device_import):\r\n........\r\n```\r\nAll other routes are using basic structure, with path parameters or Query.\r\n\r\nIn terms of imports : \r\n```python\r\nfrom typing import Optional, Dict\r\nfrom fastapi import FastAPI, Request, APIRouter, Form, Query, Body\r\nfrom pydantic import BaseModel, Field\r\n```\r\n\r\nThis issue appears each time I'm expanding a resource/API in the doc UI (Swagger UI).\r\nLet's say that I click on a GET or a POST object to expand, I will automatically get the following log : \r\n`\r\nINFO:     <IP>:49702 - \"GET /%5Bobject%20Module%5D HTTP/1.1\" 404 Not Found\r\n`\r\n\r\nAs explained, the engine works, and I can launch every request, but I get this error, and I really don't what could be the root cause...\r\n\r\nThanks again,\n\nyour route is `POST` and it works fine.\r\n``` python\r\n......\r\n@app.post(\"/system/device\", summary=\"Create a new device in the system\", tags=[\"System\"])\r\nasync def post_device(device_info: device_import):\r\n........\r\n```\r\n\r\nbut your log is about `GET` request.\r\n`Request with GET/HEAD method cannot have body.` [check this out](https://github.com/swagger-api/swagger-ui/issues/2136#issuecomment-216881309)\r\n\r\n``` python\r\nfrom fastapi import Depends\r\n\r\n@app.get(\"/system/device\", summary=\"Create a new device in the system\", tags=[\"System\"])\r\nasync def post_device(device_info: device_import=Depends()):\r\n    return device_info\r\n\r\n```\r\n\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 51}
{"instruction": "How to fix: FastAPI debugging", "input": "Hello\r\nI've seen on FastAPI documentation site, that it integrates nice with a VSCode. \r\nAny hint on debugging an FastAPI application in VSCode? There are some exaple configrations for python projects, but unfortunately I'm not able to utilize these for  FastAPI\r\n\r\nThanks\r\nOlegas", "output": "What examples are you talking about ?\r\nWhat prevents you from using them ?\r\nIf you could be more specific that would help answering.\r\n\r\nDocs are very clear and progressive imho, using the parts provided should suffice, if not the tests folder is often a good source of inspiration.\n\nYes, documentation is fine, thanks.\nWhat I mean are debug configurations, which allows you set breakpoints in\ncode. Not only on start, but also when performing api calls.\n\n\nOn Fri, 8 Feb 2019, 16:30 euri10 <notifications@github.com wrote:\n\n> What examples are you talking about ?\n> What prevents you from using them ?\n> If you could be more specific that would help answering.\n>\n> Docs are very clear and progressive imho, using the parts provided should\n> suffice, if not the tests folder is often a good source of inspiration.\n>\n> ‚Äî\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/23#issuecomment-461820659>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AbQG4Zr5E20Mso5U4FUzHgEcVPqkbW0-ks5vLYoZgaJpZM4akpHM>\n> .\n>\n\n\nnot sure how this is related to FastAPI, this seems more like a general question on how to use vscode.\nI'm using pycharm and in order to debug a route you'd simply put a breakpoint in it and call it either with your local browser, or curl, well anything you'd feel comfortable with.\nAs for vscode seems like debugging is described here: https://code.visualstudio.com/docs/python/debugging that may be a good start. \nYou could also use the cool pdb. \n\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 50}
{"instruction": "How to fix: enhance serialization speed", "input": "**Description**\r\n\r\nI have to return sometimes big objects, I'm constrained in the fact that chunking them is not an option\r\n\r\nAn example of such an object would be a dict `{\"key:: value}` where value is a list of list, 20 list of 10k elements.\r\n\r\nI wrote this simple [test case](https://github.com/euri10/fastapi/blob/slow_serial/tests/test_serial_speed.py) that shows quite clearly the massive hit in several scenarios (run with `pytest tests/test_serial_speed.py --log-cli-level=INFO`) \r\nHere's the output:\r\n```\r\n======================================================================================================================= 1 passed in 3.68 seconds =======================================================================================================================\r\n(fastapi) ‚ûú  fastapi git:(slow_serial) ‚úó pytest tests/test_serial_speed.py --log-cli-level=INFO\r\n========================================================================================================================= test session starts ==========================================================================================================================\r\nplatform linux -- Python 3.6.8, pytest-5.0.0, py-1.8.0, pluggy-0.12.0\r\nrootdir: /home/lotso/PycharmProjects/fastapi\r\nplugins: cov-2.7.1\r\ncollected 1 item                                                                                                                                                                                                                                                       \r\n\r\ntests/test_serial_speed.py::test_routes \r\n---------------------------------------------------------------------------------------------------------------------------- live log call -----------------------------------------------------------------------------------------------------------------------------\r\nINFO     tests.test_serial_speed:test_serial_speed.py:39 route1: 0.05402565002441406\r\nINFO     tests.test_serial_speed:test_serial_speed.py:18 app.tests.test_serial_speed.route1, 9.395180225372314, ['http_status:200', 'http_method:GET', 'time:wall']\r\nINFO     tests.test_serial_speed:test_serial_speed.py:18 app.tests.test_serial_speed.route1, 9.395131000000001, ['http_status:200', 'http_method:GET', 'time:cpu']\r\nINFO     tests.test_serial_speed:test_serial_speed.py:52 route1: 0.049863576889038086\r\nINFO     tests.test_serial_speed:test_serial_speed.py:18 app.tests.test_serial_speed.route2, 10.358616590499878, ['http_status:200', 'http_method:GET', 'time:wall']\r\nINFO     tests.test_serial_speed:test_serial_speed.py:18 app.tests.test_serial_speed.route2, 10.358592000000002, ['http_status:200', 'http_method:GET', 'time:cpu']\r\nINFO     tests.test_serial_speed:test_serial_speed.py:64 route1: 0.05589580535888672\r\nINFO     tests.test_serial_speed:test_serial_speed.py:18 app.tests.test_serial_speed.route3, 11.318845272064209, ['http_status:200', 'http_method:GET', 'time:wall']\r\nINFO     tests.test_serial_speed:test_serial_speed.py:18 ap", "output": "Just to confirm, you do have `ujson` installed? What type of machine are you running this on?  \r\n\r\nRoute 1 is going to be fastest as it is just returning the JSONResponse directly. \r\n\r\nRoute 2 is taking the dict, running `field.validate`   and then dumping it back out as JSON, so will be slower than route 1. \r\n\r\n_I  could be wrong on this one, have never really looked at the response portion of the fastapi code, but from a quick glance_\r\nRoute 3 constructs the pydantic model (which validates it), then calls `field.validate` on it again  and then dumps it back out as json, making it the slowest.\r\n\r\n\r\nFWIW, with ujson on a MBP:\r\n```test_serial_speed.py::test_routes\r\n------------------------------------------------------------------------------------------------ live log call -------------------------------------------------------------------------------------------------\r\ntest_serial_speed.py        41 INFO     route1: 0.028443098068237305\r\ntest_serial_speed.py        19 INFO     app.test_serial_speed.route1, 2.768159866333008, ['http_status:200', 'http_method:GET', 'time:wall']\r\ntest_serial_speed.py        19 INFO     app.test_serial_speed.route1, 2.7664400000000002, ['http_status:200', 'http_method:GET', 'time:cpu']\r\ntest_serial_speed.py        53 INFO     route2: 0.02795100212097168\r\ntest_serial_speed.py        19 INFO     app.test_serial_speed.route2, 3.3919589519500732, ['http_status:200', 'http_method:GET', 'time:wall']\r\ntest_serial_speed.py        19 INFO     app.test_serial_speed.route2, 3.386338999999999, ['http_status:200', 'http_method:GET', 'time:cpu']\r\ntest_serial_speed.py        64 INFO     route3: 0.03644418716430664\r\ntest_serial_speed.py        19 INFO     app.test_serial_speed.route3, 3.939689874649048, ['http_status:200', 'http_method:GET', 'time:wall']\r\ntest_serial_speed.py        19 INFO     app.test_serial_speed.route3, 3.9318400000000002, ['http_status:200', 'http_method:GET', 'time:cpu']```\n\nI don't have ujson installed and my machine was a dual i5-2697v2 (until today when it seems I fried my mb bios...) well.\nWill try ujson even if iirc it's kind of stalled project, isn't it? \n\n\nI'm investigating it, a bit, with line_profiler.\r\n\r\nMaybe calling `fastapi.encoders.jsonable_encoder()` part is main factor?, and too many calling this function (recursively).\r\n\r\n```\r\nFile: /home/me/venvs/fastapi/lib/python3.7/site-packages/fastapi/encoders.py\r\nFunction: jsonable_encoder at line 8\r\n\r\nLine #      Hits         Time  Per Hit   % Time  Line Contents\r\n==============================================================\r\n     8                                           @profile\r\n     9                                           def jsonable_encoder(\r\n    10                                               obj: Any,\r\n    11                                               include: Set[str] = None,\r\n    12                                               exclude: Set[str] = set(),\r\n    13                                               by_alias: bool = True,\r\n    14                                               skip_defaults: bool = False,\r\n    15                                               include_none: bool = True,\r\n    16                                               custom_encoder: dict = {},\r\n    17                                               sqlalchemy_safe: bool = True,\r\n    18                                           ) -> Any:\r\n    19    130008      85523.0      0.7      3.5      if include is not None and not isinstance(include, set):\r\n    20                                                   include = set(include)\r\n    21    130008      97039.0      0.7      3.9      if exclude is not None and not isinstance(exclude, set):\r\n    22                                                   exclude = set(exclude)\r\n    23    130008     172094.0      1.3      6.9      if isinstance(obj, BaseModel):\r\n    24         1          2.0      2.0      0.0          encoder = getattr(obj.Config, \"json_encoders\", custom_encoder)\r\n    25         1          1.0      1.0      0.0          return jsonable_encoder(\r\n    26         1          1.0      1.0      0.0              obj.dict(\r\n    27         1          0.0      0.0      0.0                  include=include,\r\n    28         1          1.0      1.0      0.0                  exclude=exclude,\r\n    29         1          1.0      1.0      0.0                  by_alias=by_alias,\r\n    30         1      22756.0  22756.0      0.9                  skip_defaults=skip_defaults,\r\n    31                                                       ),\r\n    32         1          1.0      1.0      0.0              include_none=include_none,\r\n    33         1          1.0      1.0      0.0              custom_encoder=encoder,\r\n    34         1          6.0      6.0      0.0              sqlalchemy_safe=sqlalchemy_safe,\r\n    35                                                   )\r\n    36    130007     116806.0      0.9      4.7      if isinstance(obj, Enum):\r\n    37                                      ", "source": "bug_issue", "type": "bug_solution", "issue_number": 49}
{"instruction": "How to fix: How can I pass the configuration in the app?", "input": "How can I pass the configuration in the app? Can I do it in some way like it was in Flask with app.config, or this framework manages it differently?", "output": "You will be able to pass anything you want to app.state I've starlette is\non 0.12.9\n\nLe jeu. 5 sept. 2019 √† 5:14 PM, Artsiom Dolatau <notifications@github.com>\na √©crit :\n\n> How can I pass the configuration in the app? Can I do it in some simple\n> way like it was in Flask with app.config, or this framework doesn't support\n> even this?\n>\n> ‚Äî\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/tiangolo/fastapi/issues/508?email_source=notifications&email_token=AAINSPVIGGYSLBWKF7TYFOLQIEO3PA5CNFSM4IT7DHBKYY3PNVWWK3TUL52HS4DFUVEXG43VMWVGG33NNVSW45C7NFSM4HJSGYQA>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAINSPQ5XZ73CSBHDJMJSPTQIEO3PANCNFSM4IT7DHBA>\n> .\n>\n\n\nI typically use a subclass of `pydantic.BaseSettings` so I can read config from the environment, then create an `lru_cache`d function that returns a config instance, then wherever I need access to a config setting I just call the `lru_cache`d function to get the config and read the setting off of it.\n\ni have the same question here - what is the equivalent of app.config in flask ? https://flask.palletsprojects.com/en/1.1.x/config/\r\n\r\nto specific, are there any convenience functions similar to\r\n```\r\napp.config.from_object('yourapplication.default_settings')\r\napp.config.from_envvar('YOURAPPLICATION_SETTINGS')\r\n```\r\nwe need to load different configurations based on production or staging environment.", "source": "bug_issue", "type": "bug_solution", "issue_number": 48}
{"instruction": "How to fix: Use UploadFile in Pydantic model", "input": "**Description**\r\n\r\nIs it possible to use `UploadFile` in a Pydantic model? The FastAPI docs [say](https://fastapi.tiangolo.com/tutorial/request-files/) ‚ÄúFastAPI's UploadFile inherits directly from Starlette's UploadFile, but adds some necessary parts to make it compatible with Pydantic and the other parts of FastAPI.‚Äù \r\n\r\n```python3\r\nfrom fastapi import FastAPI, File, UploadFile\r\nfrom pydantic import BaseModel\r\n\r\nclass PydanticFile(BaseModel):\r\n    file: UploadFile = File(...)\r\n\r\napp = FastAPI()\r\n\r\n@app.post(\"/uploadfile/\")\r\nasync def create_upload_file(file: PydanticFile):\r\n    return {\"filename\": file.filename}\r\n```\r\n\r\nHowever, `UploadFile` does not seem to be compatible with Pydantic. The code above ‚Äì derived from the example in FastAPI's [Request Files tutorial](https://fastapi.tiangolo.com/tutorial/request-files/) ‚Äì raises a value error:\r\n\r\n```\r\nValueError: Value not declarable with JSON Schema, field: file type=UploadFile required\r\n```", "output": "I'm a FastAPI/Starlette noob so take what I'm saying with a grain of salt, but I don't think what you are trying to do really makes sense.\r\n\r\nWhen you are specifying a UploadFile I believe you are telling FastAPI/Starlette that you will be providing data in a multipart form body.  Pydantic is for describing the expected JSON format body.  So trying to combine the two doesn't really make sense because you need to do one or the other.\r\n\r\nI could be off base though ... you can wait for someone else to chime in.\n\nThanks a lot for your helpful comment. So I guess I'd have to explicitly separate the file from the [JSON part of the multipart form body](url), as in:\r\n\r\n```python3\r\nclass Properties(BaseModel):\r\n    language: str = None\r\n    author: str = None\r\n\r\n@app.post(\"/uploadfile/\")\r\nasync def create_upload_file(file: UploadFile = File(...),\r\n                             properties: Properties):\r\n    return {\"filename\": file.filename}\r\n```\r\n\r\nThis seems to be working, and maybe query parameters would ultimately make more sense here.\n\nWhen it says \"adds necessary parts to make it compatible with Pydantic\", it doesn't mean with pydantic BaseModel instances. FastAPI makes deep use of a lot of pydantic internals during the request-handling process, and I believe the modifications to the type are to make it compatible with that. In particular, it is used in a way that doesn't require it to be able to live as a field on a `BaseModel`.\r\n\r\nGenerally, you should only use `BaseModel` instances in FastAPI when you know you want to parse the model contents from the json body of the request.\r\n\r\nIf you want to make use of `UploadFile` as an attribute of a dependency class you can, it just can't be a pydantic model. (You can look at how the auth dependencies are implemented for an example along those lines.) A plain-old 3.7 dataclass would probably work for this.", "source": "bug_issue", "type": "bug_solution", "issue_number": 47}
{"instruction": "How to fix: üåç Translations coordination (list of translations)", "input": "Here are the issues coordinating the translations to each language:\r\n\r\n* Portuguese: https://github.com/tiangolo/fastapi/issues/1211\r\n* Spanish: https://github.com/tiangolo/fastapi/issues/1218\r\n* Chinese: https://github.com/tiangolo/fastapi/issues/1228\r\n* Russian: https://github.com/tiangolo/fastapi/issues/1362\r\n* Italian: https://github.com/tiangolo/fastapi/issues/1556\r\n* Japanese: https://github.com/tiangolo/fastapi/issues/1572\r\n* Ukrainian: https://github.com/tiangolo/fastapi/issues/1748\r\n* Turkish: https://github.com/tiangolo/fastapi/issues/1892\r\n* French: https://github.com/tiangolo/fastapi/issues/1972\r\n* Korean: https://github.com/tiangolo/fastapi/issues/2017\r\n* Persian: https://github.com/tiangolo/fastapi/issues/2041\r\n* Polish: https://github.com/tiangolo/fastapi/issues/3169\r\n* German: https://github.com/tiangolo/fastapi/issues/3716\r\n* Indonesian: https://github.com/tiangolo/fastapi/issues/3717\r\n* Azerbaijani: https://github.com/tiangolo/fastapi/issues/3994\r\n* Dutch: https://github.com/tiangolo/fastapi/issues/4701\r\n* Uzbek: https://github.com/tiangolo/fastapi/issues/4883\r\n* Swedish: https://github.com/tiangolo/fastapi/issues/5146\r\n* Hebrew: https://github.com/tiangolo/fastapi/issues/5157\r\n* Tamil: https://github.com/tiangolo/fastapi/issues/5434\r\n* Arabic: https://github.com/tiangolo/fastapi/issues/3349\r\n---\r\n\r\nNote: this meta-issue is here because GitHub only allows a limited number of issues to be pinned, so I can't pin all of them. I'll update it here when there's a new language.", "output": "Couldn't we just have a tag for translations instead?\n\nHaving a specific issue for translations of a specific language lets people coordinate which section each one is working on.\n\nOh, sure, for individual languages, yeah, but I meant if it was necessary to have a meta-issue for those instead of just a 4th tag for translations?", "source": "bug_issue", "type": "bug_solution", "issue_number": 46}
{"instruction": "How to fix: Typehints  instead of response_model", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * Or, I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n<!-- \r\n\r\nI'm asking all this because answering questions and solving problems in GitHub issues consumes a lot of time. I end up not being able to add new features, fix bugs, review Pull Requests, etc. as fast as I wish because I have to spend too much time handling issues.\r\n\r\nAll that, on top of all the incredible help provided by a bunch of community members that give a lot of their time to come here and help others.\r\n\r\nThat's a lot of work they are doing, but if more FastAPI users came to help others like them just a little bit more, it would be much less effort for them (and you and me üòÖ).\r\n\r\n-->\r\n\r\n### Example\r\nNow:\r\n```Python\r\nfrom fastapi import FastAPI\r\nfrom typing import Dict, List\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\", response_model=Dict[str, List[str]])\r\ndef read_root():\r\n    return {\"Hello\": [\"tom\", \"hesus\"]}\r\n```\r\n### The solution you would like\r\nI want to do it through typehints:\r\n```Python\r\nfrom fastapi import FastAPI\r\nfrom typing import Dict, List\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef read_root() -> Dict[str, List[str]]:\r\n    return {\"Hello\": [\"tom\", \"hesus\"]}\r\n```", "output": "**I don't know** if it was only a decision or if there's an issue on the suggested approach.\r\n\r\nMy input here will be related to MyPy:\r\n\r\n```python\r\nfrom typing import Dict, List\r\n\r\nfrom fastapi import FastAPI\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\nclass Potato(BaseModel):\r\n    name: str\r\n    color: str\r\n\r\n@app.get(\"/\")\r\ndef get_potato() -> Potato:\r\n    return {\"name\": \"best potato\", \"color\": \"purple\"}\r\n```\r\n\r\nDoing as above, MyPy will get sad:\r\n```bash\r\ntest.py:14: error: Incompatible return value type (got \"Dict[str, str]\", expected \"Potato\")\r\nFound 1 error in 1 file (checked 1 source file)\r\n```\r\n\r\nMaybe a \"FastAPI MyPy plugin\" can be created to allow it (in case the suggestion is accepted and if is possible to create a plugin like that, I've never tried).\n\nNo, i want use annotations instead of response_model. i want fastapi to understand typehints\r\n\n\nI understand what you said... I want that too. :eyes: ", "source": "bug_issue", "type": "bug_solution", "issue_number": 45}
{"instruction": "How to fix: Too many emojis in 'Concurrency and async / await' explanation", "input": "The explanation page for concurrency, and more specifically its example with burgers (https://fastapi.tiangolo.com/async/#concurrent-burgers) becomes hard to read for me because of its many emojis.\r\n\r\nAn excerpt:\r\n\r\n> You go with your crush üòç to get fast food üçî, you stand in line while the cashier üíÅ takes the orders from the people in front of you.\r\n> Then it's your turn, you place your order of 2 very fancy burgers üçî for your crush üòç and you.\r\n> You pay üí∏.\r\n> The cashier üíÅ says something to the guy in the kitchen üë®‚Äçüç≥ so he knows he has to prepare your burgers üçî (even though he is currently preparing the ones for the previous clients).\r\n> The cashier üíÅ gives you the number of your turn.\r\n> While you are waiting, you go with your crush üòç and pick a table, you sit and talk with your crush üòç for a long time (as your burgers are very fancy and take some time to prepare ‚ú®üçî‚ú®).\r\n> As you are sitting on the table with your crush üòç, while you wait for the burgers üçî, you can spend that time admiring how awesome, cute and smart your crush is ‚ú®üòç‚ú®.\r\n...\r\nBut as you go away from the counter and sit on the table with a number for your turn, you can switch üîÄ your attention to your crush üòç, and \"work\" ‚èØ ü§ì on that. Then you are again doing something very \"productive\" ü§ì, as is flirting with your crush üòç.\r\n\r\nIn my opinion, the many emojis don't add anything to the explanation and make it hard to read. **Every emoji breaks the flow when reading because my eyes are distracted by the emojis' size and colour.**\r\n\r\nIs the 'üòç' after every 'crush' necessary? Same with burger and üçî, cashier and üíÅ and so on.\r\n\r\nI propose cutting down on or completely removing emojis from the documentation to help with readability.\r\n\r\nThe same issue, though less pronounced, is also apparent in the section 'Asynchronous Code' (https://fastapi.tiangolo.com/async/#asynchronous-code).\r\n\r\n***\r\n\r\n(If you want to know what it feels like to read the documentation, try reading this:)\r\n\r\nIn my üßëopinion ü§î, the manyüî¢ emojis don't add anythingüò£ to the explanationüò™ and make it hard to readüòì. Every emojiü§™ breaks the flow‚òÑüå¨ when readingüìñ because my eyesüëÄüëÄ are distractedüòúüòí by the emojis' sizeü•µ and colourü§°.", "output": "Emojis are part of our culture. :sweat_smile:\r\n\r\n> (If you want to know what it feels like to read the documentation, try reading this:)\r\n\r\nI've read the documentation, and I don't feel the same as reading your example, as it's clearly ill-intentioned to prove your point. :kissing: \r\n\r\nThat being said, we can wait to see if people have the same opinion as you, and/or you can propose a PR changing that page, and @tiangolo you'll check it at some point.\r\n\r\nI don't think this change is needed, nor do I feel harmed by those emojis, sometimes I even get the opposite effect as the one you mentioned. Which I think is because humans tend to relate images better than letters. \r\n\r\nEDIT: Well... Months have passed, and my opinion has changed. I no longer have strong feelings about this. Although, I think the most important argument here is the one mentioned [here](https://github.com/tiangolo/fastapi/issues/3273#issuecomment-1018297338). :wave: \n\nyou can write non emojis one in your self page.\n\nThat page was painful to read. Can the emojis be toned down please? \r\n\r\nFor a middle ground, perhaps introduce them in the opening sentence, and then stick to using them at the end of sentences, avoiding the temptation to use them mid-sentences outside their first occurrence. ", "source": "bug_issue", "type": "bug_solution", "issue_number": 44}
{"instruction": "How to fix: SQLAlchemy Dependency vs. Middleware vs. scoped_session", "input": "The SQLAlchemy library comes with a `scoped_session` object, which effectively allows for thread-safe database sessions. Is there a reason the docs recommend using the dependency method > middleware method > just a `scoped_session` global?", "output": "I'm not sure about the reasoning behind the doc's reccomendations, but the reason why I'd personally advise against making `scoped_session` global is because it then forces you to also have a global `engine` to bind it to, and global variables in ASGI don't have a well-defined lifetime (see #617). There's also how using dependencies rather than globals mean that all the ressource needed by your route are passed as function parameters, which tends to make testing easier since you can just pass a fake DB session instead of the one you would normally use.\r\n\r\n[SQLAlchemy's own doc](https://docs.sqlalchemy.org/en/13/orm/contextual.html#unitofwork-contextual) says `scoped_session` are just one of many ways of handling sessions. From my understanding of how `scoped_session` and sessions work, thread-local sessions might not work that well with FastAPI since Python's coroutines don't have a 1:1 mapping with threads, so I suspect that this could cause some unexpected behavior (though I haven't tried this, I might be wrong).\r\n\r\nI personally prefer handling my connections this way:\r\n\r\n```py\r\nfrom typing import Optional, AsyncIterable\r\n\r\nfrom fastapi import Depends, FastAPI\r\nfrom sqlalchemy import create_engine\r\nfrom sqlalchemy.orm import Session\r\nfrom sqlalchemy.engine import Engine as Database\r\n\r\napp = FastAPI()\r\n\r\n_db_conn: Optional[Database]\r\n\r\n@app.on_event(\"startup\")\r\ndef open_database_connection_pools():\r\n    global _db_conn\r\n    _db_conn = create_engine(...)\r\n\r\n@app.on_event(\"shutdown\")\r\ndef close_database_connection_pools():\r\n    global _db_conn\r\n    if _db_conn: _db_conn.dispose()\r\n\r\nasync def get_db_conn() -> Database:\r\n    assert _db_conn is not None\r\n    return _db_conn\r\n\r\n# This is the part that replaces sessionmaker\r\nasync def get_db_sess(db_conn = Depends(get_db_conn)) -> AsyncIterable[Session]:\r\n    sess = Session(bind=db_conn)\r\n\r\n    try:\r\n        yield sess\r\n    finally:\r\n        sess.close()\r\n\r\n@app.get(\"/\")\r\ndef foo(db_sess: Session = Depends(get_db_sess)):\r\n    pass\r\n```\r\n\r\nThe benefits of this approach are:\r\n* You can connect to as many databases as needed, which was a problem for me with the middleware approach, especially when using Flask\r\n* Your DB connections are released at application shutdown instead of garbage collection, which means you won't run into issues if you use `uvicorn --reload`\r\n* Your DB sessions will automatically be closed when the route using as a dependency finishes, so any uncommited operations will be rolled back.\r\n* While testing you can just pass a different Session object so you can write to a test database instead\r\n* When calling that route as a regular function from a different thread (which is a niche case, but it happens), you can pass an existing database session object instead of having the route create a new one.\r\n\n\nThanks for the in depth for response @sm-Fifteen! Those do seem like some good benefits over using `scoped_session`.\r\n\r\nOne clarification though: you initially mentioned how it's probably better not to have a global database connection, but then your solution is just passing around the connection as a global, no? You add a layer of indirection with the database connection dependency, but I'm not sure I see the benefit of that approach.\n\n> One clarification though: you initially mentioned how it's probably better not to have a global database connection, but then your solution is just passing around the connection as a global, no? You add a layer of indirection with the database connection dependency, but I'm not sure I see the benefit of that approach.\r\n\r\nYeah, I should probably have explained that one a bit more. The important distinction is that while `_db_conn` *lives* in the global scope (mainly because there is nowhere else it could live), it's not *created* in the global scope, nor is it ever accessed directly from the global scope aside from the 3 functions that control it.\r\n\r\nTo go back to the example I was giving:\r\n\r\n```py\r\n_db_conn: Optional[Database]\r\n\r\ndef open_database_connection_pools():\r\n    global _db_conn\r\n    _db_conn = create_engine(...)\r\n\r\ndef close_database_connection_pools():\r\n    global _db_conn\r\n    if _db_conn: _db_conn.dispose()\r\n\r\nasync def get_db_conn() -> Database:\r\n    assert _db_conn is not None\r\n    return _db_conn\r\n```\r\n\r\n...these three functions should be the only places where `_db_conn` is ever used directly. If that seems like a convoluted way of doing the same thing as `_db_conn = create_engine(...)` in the global space and calling it a day, the key thing to understand here is that SQLAlchemy's automatic cleanup system works in a WSGI setting (such as when using Flask) because it it set to cleanup whenever the Python interpreter shuts down. Since ASGI is both event-based and async, though, doing it that way in FastAPI could cause you to run into a number of subtle issues (like the `--reload` problem I briefly mentionned where reloading your code would create a new connection engine without closing the first one, ", "source": "bug_issue", "type": "bug_solution", "issue_number": 43}
{"instruction": "How to fix: Update docs include syntax for source examples", "input": "### Privileged issue\r\n\r\n- [X] I'm @tiangolo or he asked me directly to create an issue here.\r\n\r\n### Issue Content\r\n\r\nThis is a good first contribution. :nerd_face: \r\n\r\nThe code examples shown in the docs are actual Python files. They are even tested in CI, that's why you can always copy paste an example and it will always work, the example is tested.\r\n\r\nThe way those examples are included in the docs used a specific format. But now there's a new format available that is much simpler and easier to use than the previous one, in particular in complex cases, for example when there are examples in multiple versions of Python.\r\n\r\nBut not all the docs have the new format yet. The docs should use the new format to include examples. That is the task. :nerd_face: \r\n\r\n**It should be done as one PR per page updated.**\r\n\r\n## Simple Example\r\n\r\nBefore, the format was like:\r\n\r\n````markdown\r\n```Python hl_lines=\"3\"\r\n{!../../docs_src/first_steps/tutorial001.py!}\r\n```\r\n````\r\n\r\nNow the new format looks like:\r\n\r\n````markdown\r\n{* ../../docs_src/first_steps/tutorial001.py hl[3] *}\r\n````\r\n\r\n* Instead of `{!` and `!}` it uses `{*` and `*}`\r\n* It no longer has a line above with:\r\n\r\n````markdown\r\n```Python\r\n````\r\n\r\n* And it no longer has a line below with:\r\n\r\n````markdown\r\n```\r\n````\r\n\r\n* The highlight is no longer a line with e.g. `hl_lines=\"3\"` (to highlight line 3), but instead in the same line there's a `hl[3]`.\r\n\r\nAn example PR: https://github.com/fastapi/fastapi/pull/12552\r\n\r\n## Multiple Python Versions\r\n\r\nThere are some cases where there are variants of the same example for multiple versions of Python, or for using `Annotated` or not.\r\n\r\nIn those cases, the current include examples have syntax for tabs, and notes saying `Annotated` should be preferred. For example:\r\n\r\n````markdown\r\n//// tab | Python 3.9+\r\n\r\n```Python hl_lines=\"4  8  12\"\r\n{!> ../../docs_src/security/tutorial006_an_py39.py!}\r\n```\r\n\r\n////\r\n\r\n//// tab | Python 3.8+\r\n\r\n```Python hl_lines=\"2  7  11\"\r\n{!> ../../docs_src/security/tutorial006_an.py!}\r\n```\r\n\r\n////\r\n\r\n//// tab | Python 3.8+ non-Annotated\r\n\r\n/// tip\r\n\r\nPrefer to use the `Annotated` version if possible.\r\n\r\n///\r\n\r\n```Python hl_lines=\"2  6  10\"\r\n{!> ../../docs_src/security/tutorial006.py!}\r\n```\r\n\r\n////\r\n````\r\n\r\nIn these cases, it should be updated to only include the first one (the others will be included automatically :sunglasses: ):\r\n\r\n````markdown\r\n{* ../../docs_src/security/tutorial006_an_py39.py hl[4,8,12] *}\r\n````\r\n\r\n* The syntax for tabs is also removed, all the other variants are included automatically.\r\n* The highlight lines are included for that same first file, the fragment with `hl_lines=\"4  8  12\"` is replaced with `hl[4,8,12]`\r\n\r\nAn example PR: https://github.com/fastapi/fastapi/pull/12553\r\n\r\n## Highlight Lines\r\n\r\n### Simple Lines\r\n\r\nWhen there's a fragment like:\r\n\r\n````markdown\r\nhl_lines=\"4  8  12\"\r\n````\r\n\r\nThat means it is highlighting the lines 4, 8, and 12.\r\n\r\nThe new syntax is on the same include line:\r\n\r\n````markdown\r\nhl[4,8,12]\r", "output": "Osis\r\n\r\nOn Sat, Oct 26, 2024, 6:37 PM Sebasti√°n Ram√≠rez ***@***.***>\r\nwrote:\r\n\r\n> Privileged issue\r\n>\r\n>    - I'm @tiangolo <https://github.com/tiangolo> or he asked me directly\r\n>    to create an issue here.\r\n>\r\n> Issue Content\r\n>\r\n> This is a good first contribution. ü§ì\r\n>\r\n> The code examples shown in the docs are actual Python files. They are even\r\n> tested in CI, that's why you can always copy paste an example and it will\r\n> always work, the example is tested.\r\n>\r\n> The way those examples are included in the docs used a specific format.\r\n> But now there's a new format available that is much simpler and easier to\r\n> use than the previous one, in particular in complex cases, for example when\r\n> there are examples in multiple versions of Python.\r\n>\r\n> But not all the docs have the new format yet. The docs should use the new\r\n> format to include examples. That is the task. ü§ì\r\n>\r\n> It should be done as one PR per page updated.\r\n> Simple Example\r\n>\r\n> Before, the format was like:\r\n>\r\n> ```Python hl_lines=\"3\"\r\n> {!../../docs_src/first_steps/tutorial001.py!}```\r\n>\r\n> Now the new format looks like:\r\n>\r\n> {* ../../docs_src/first_steps/tutorial001.py hl[3] *}\r\n>\r\n>\r\n>    - Instead of {! and !} it uses {* and *}\r\n>    - It no longer has a line above with:\r\n>\r\n> ```Python\r\n>\r\n>\r\n>    - And it no longer has a line below with:\r\n>\r\n> ```\r\n>\r\n>\r\n>    - The highlight is no longer a line with e.g. hl_lines=\"3\" (to\r\n>    highlight line 3), but instead in the same line there's a hl[3].\r\n>\r\n> An example PR: #12552 <https://github.com/fastapi/fastapi/pull/12552>\r\n> Multiple Python Versions\r\n>\r\n> There are some cases where there are variants of the same example for\r\n> multiple versions of Python, or for using Annotated or not.\r\n>\r\n> In those cases, the current include examples have syntax for tabs, and\r\n> notes saying Annotated should be preferred. For example:\r\n>\r\n> //// tab | Python 3.9+\r\n> ```Python hl_lines=\"4  8  12\"\r\n> {!> ../../docs_src/security/tutorial006_an_py39.py!}```\r\n>\r\n> ////\r\n>\r\n> //// tab | Python 3.8+\r\n> ```Python hl_lines=\"2  7  11\"\r\n> {!> ../../docs_src/security/tutorial006_an.py!}```\r\n>\r\n> ////\r\n>\r\n> //// tab | Python 3.8+ non-Annotated\r\n>\r\n> /// tip\r\n>\r\n> Prefer to use the `Annotated` version if possible.\r\n>\r\n> ///\r\n> ```Python hl_lines=\"2  6  10\"\r\n> {!> ../../docs_src/security/tutorial006.py!}```\r\n>\r\n> ////\r\n>\r\n> In these cases, it should be updated to only include the first one (the\r\n> others will be included automatically üòé ):\r\n>\r\n> {* ../../docs_src/security/tutorial006_an_py39.py hl[4,8,12] *}\r\n>\r\n>\r\n>    - The syntax for tabs is also removed, all the other variants are\r\n>    included automatically.\r\n>    - The highlight lines are included for that same first file, the\r\n>    fragment with hl_lines=\"4 8 12\" is replaced with hl[4,8,12]\r\n>\r\n> An example PR: #12553 <https://github.com/fastapi/fastapi/pull/12553>\r\n>\r\n> ‚Äî\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/fastapi/fastapi/issues/12554>, or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/ABCOVL2FRNCDPALCW7LAZRLZ5OHY5AVCNFSM6AAAAABQUZLFL2VHI2DSMVQWIX3LMV43ASLTON2WKOZSGYYTKOBVGYYDINA>\r\n> .\r\n> You are receiving this because you are subscribed to this thread.Message\r\n> ID: ***@***.***>\r\n>\r\n\n\nIeje\r\n\r\nOn Sat, Oct 26, 2024, 6:54 PM Rajendra Prasad K ***@***.***>\r\nwrote:\r\n\r\n> Osis\r\n>\r\n> On Sat, Oct 26, 2024, 6:37 PM Sebasti√°n Ram√≠rez ***@***.***>\r\n> wrote:\r\n>\r\n>> Privileged issue\r\n>>\r\n>>    - I'm @tiangolo <https://github.com/tiangolo> or he asked me directly\r\n>>    to create an issue here.\r\n>>\r\n>> Issue Content\r\n>>\r\n>> This is a good first contribution. ü§ì\r\n>>\r\n>> The code examples shown in the docs are actual Python files. They are\r\n>> even tested in CI, that's why you can always copy paste an example and it\r\n>> will always work, the example is tested.\r\n>>\r\n>> The way those examples are included in the docs used a specific format.\r\n>> But now there's a new format available that is much simpler and easier to\r\n>> use than the previous one, in particular in complex cases, for example when\r\n>> there are examples in multiple versions of Python.\r\n>>\r\n>> But not all the docs have the new format yet. The docs should use the new\r\n>> format to include examples. That is the task. ü§ì\r\n>>\r\n>> It should be done as one PR per page updated.\r\n>> Simple Example\r\n>>\r\n>> Before, the format was like:\r\n>>\r\n>> ```Python hl_lines=\"3\"\r\n>> {!../../docs_src/first_steps/tutorial001.py!}```\r\n>>\r\n>> Now the new format looks like:\r\n>>\r\n>> {* ../../docs_src/first_steps/tutorial001.py hl[3] *}\r\n>>\r\n>>\r\n>>    - Instead of {! and !} it uses {* and *}\r\n>>    - It no longer has a line above with:\r\n>>\r\n>> ```Python\r\n>>\r\n>>\r\n>>    - And it no longer has a line below with:\r\n>>\r\n>> ```\r\n>>\r\n>>\r\n>>    - The highlight is no longer a line with e.g. hl_lines=\"3\" (to\r\n>>    highlight line 3), but instead in the same line there's a hl[3].\r\n>>\r\n>> An example PR: #12552 <https://github.com/fastapi/fastapi/pull/12552>\r\n>> Multiple Python Versions\r\n>>\r\n>> The", "source": "bug_issue", "type": "bug_solution", "issue_number": 42}
{"instruction": "How to fix: about threads issue with fastapi.", "input": "Hi, I have a question about the threads issue with fastapi.\r\n\r\n\r\nWhen I run the example from tutorial `uvicorn main:app --reload --port 4681 --host 0.0.0.0` with the following `main.py`\r\n```python\r\nfrom fastapi import FastAPI\r\napp = FastAPI()\r\n@app.get(\"/\")\r\ndef read_root():\r\n    return {\"Hello\": \"World\"}\r\n@app.get(\"/items/{item_id}\")\r\ndef read_item(item_id: int, q: str = None):\r\n    return {\"item_id\": item_id, \"q\": q}\r\n```\r\n\r\nand it show up the following information\r\n```\r\nINFO: Started server process [18983]\r\nINFO: Waiting for application startup.\r\nINFO: Uvicorn running on http://0.0.0.0:4681 (Press CTRL+C to quit)\r\n```\r\n\r\n__then I use `ps -o nlwp 18983` to see how many threads this process (18983) is using.__\r\n\r\nHowever, everytime when I send a request to this service, the number of threads increase without being closed. To be more specific, __when I send 1000 requests, this process ended up with 1000 threads running.__\r\n\r\nThis is problematic because I tried to serve another more complicated applications, allocating arbitrary number of threads would finally get my machine out of resources.\r\n\r\nIs there any thing I could have done wrong?\r\nThanks in advance!", "output": "Interested also to this question. Run it also on my machine with multiple workers and observed similar behaviour for each one of them. Would like to know what's happening as we are thinking of using fastAPI for some production service that would be running long term.\n\nCan you share your environment (starlette, fastapi, uvicorn, python, and operating system versions)?\r\n\r\nCan you check if you get the same behavior if you change the endpoints to be async def?\n\nAlso can you check if you get the same behavior when running uvicorn without the ‚Äîreload flag?", "source": "bug_issue", "type": "bug_solution", "issue_number": 41}
{"instruction": "How to fix: Are there any api developer docs?", "input": "### First check\r\n\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n\r\n### Description\r\n\r\nWhat I mean by api developer docs are basically something like sphinx docs for function definitions. This is usually generated from function docstrings (which I didn't see any in my small amount of browsing the FastAPI codebase). For example, here are the docs for github3 https://github3py.readthedocs.io/en/master/api-reference/index.html. It is an easy way to click through the entire package and see class and function definitions.\r\n\r\nDoes FastAPI have these? The tutorial docs look pretty good, but sometimes I just want to know what all the function parameters are independent of the context in a tutorial.", "output": "Not yet. I expect to use https://github.com/tomchristie/mkautodoc at some point.\r\n\r\nBut first I have to clean up some of the parameters, define a docstring style, and add docstrings everywhere.\n\n@tiangolo \r\nHi! Just out of interest, but what do you think about using [pawamoy/mkdocstrings](https://github.com/pawamoy/mkdocstrings)? I recently used this project and it worked without any problems.\n\nI have used https://www.sphinx-doc.org/en/master/ before and they look pretty nice. Works very well for Python code in my opinion.", "source": "bug_issue", "type": "bug_solution", "issue_number": 40}
{"instruction": "How to fix: Validation in the FastAPI response handler is a lot heavier than expected", "input": "### First check\r\n\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n\r\n### Description\r\n\r\nSo I have built a Tortoise ORM to Pydantic adaptor, and it's about stable, so I started profiling and found some interesting.\r\n\r\nPydantic will validate the data I fetch from the DB, which seems redundant as the DB content is already validated. So we are doing double validation.\r\nFurther profiling I found that the majority of time is spent by FastAPI preparing the data for serialisation, and then validating it, and then actually serialising (This specific step is what https://github.com/tiangolo/fastapi/issues/1224#issuecomment-617243856 refers to)\r\n\r\nSo I am doing essentially triple validation...\r\n\r\nI then saw that there is the orjson integration, I tried that... and it made no difference that I could tell. (I'll get to this later)\r\n\r\nI did a few experiments (none of them properly tested, but just to get an idea) with a simple benchmark:\r\n(The database was populated with 200 junk user profiles generated by hypothesis, response is 45694 bytes)\r\n\r\nKey:\r\nR1 ‚Üí Using FastAPI to serialise a `List[User]` model automatically (where `User` is a Pydantic model)\r\nR2 ‚Üí Using FastAPI to serialise a `List[User]` model automatically, but disabled the validation step in `serialize_response`\r\nR3 ‚Üí Manually serialised the data using an `ORJSONResponse`\r\nR4 ‚Üí Using FastAPI to serialise a `List[User]` model automatically, bypassed the `jsonable_encoder` as I'm serialising with orjson\r\nR5 ‚Üí Using FastAPI to serialise a `List[User]` model automatically, bypassed both validation and `jsonable_encoder`\r\nC1 ‚Üí Use provided pydantic `from_orm` \r\nC2 ‚Üí Custom constructor that doesn't validate\r\n\r\nMy results are:\r\nR1 + C1 ‚Üí 42req/s\r\nR1 + C2 ‚Üí 43req/s  (Seems the 3 FastAPI steps overpower the validation overhead of `from_orm`)\r\nR2 + C1 ‚Üí 56req/s (Disabling the validation IN FastAPI has a much bigger impact?)\r\nR2 + C2 ‚Üí 63req/s (So, no extra validation)\r\nR3 + C1 ‚Üí 75req/s\r\nR3 + C2 ‚Üí 160req/s\r\nR4 + C1 ‚Üí 53req/s (This orjson-specific optimization gave us a 26% speedup here!)\r\nR4 + C2 ‚Üí 64req/s (This orjson-specific optimization gave us a 48% speedup here!)\r\nR5 + C1 ‚Üí 74req/s (So, almost as fast as bypassing the FastAPI response handler)\r\nR5 + C2 ‚Üí 147req/s\r\n\r\nWas somewhat surprised by these results. Seems that Disabling all validation AND skipping the FastAPI response handler gave me a nearly 4x improvement!!\r\n\r\nOutcomes:\r\n1. Doing an optimal build from ORM to Pydantic doesn't help much by itself, but with an optimal response handler, it can fly!\r\n2. We should really consider as https://github.com/tiangolo/fastapi/issues/1224#issuecomment-617243856 proposed if using orjson, as it gives a big improvement by itself!\r\n3. Validation in the FastAPI response handler is a lot heavier than expected\r\n\r\nQuestions:\r\n", "output": "Nice, thanks for confirming my suspicions and getting some actual performance measurements on that issue. Out of curiosity, do you benchmark requests per second sequentially or in parallel? Given how encoding is part of the critical path on the event loop, `jsonable_encoder` and the json renderer are expected to have the worst performance impact when attempting to handle multiple requests in parallel, since they both block the event loop for whatever amount of time they end up running ([since they are CPU-bound](https://docs.python.org/3/library/asyncio-dev.html#running-blocking-code)).\n\nI tested with a concurrency of 10, but making it single concurrency hardly affected the results, as it was using a sqlite db as a backend (which is also single concurrency).\r\n\r\nThe benchmarks was just to find bottlenecks, and not to be representative of \"real-world\" use cases.\r\n\r\nI think we should see if the default responder is orjson, and then skip `jsonable_encoder`. And do a full regression test with that config to find out if this is a valid use-case?\r\n\n\n@grigi \r\n- Do you have numbers when using multiple workers?\r\n- Can you try it with postgres (may not help if you don't use something like asynvpg)\r\n\r\nI don' think there's anything fastapi can do about the speed of pydantic validation, by design that's how pydantic is setup to work so you can't populate invalid properties on its objects, there's no guarantee your database.\r\n\r\nI do agree however there are a good number of dependencies that could probably be improved with either faster or async aware alternatives, the less we block the better this will be, but also realizing there will always be blocking somewhere.", "source": "bug_issue", "type": "bug_solution", "issue_number": 39}
{"instruction": "How to fix: how can i run scheduling tasks using fastapi's", "input": "**Description**\r\n\r\nHow can I [...]?\r\n\r\nIs it possible to [...]?\r\n\r\n**Additional context**\r\nAdd any other context or screenshots about the feature request here.", "output": "it's not strictly speaking a FastAPI question but here are some options, find what works best for you\r\n\r\nthe best without any doubt :grin: https://linux.die.net/man/5/crontab\r\n\r\nsome python tools > \r\nhttps://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html\r\nhttps://docs.python.org/3/library/sched.html\r\nhttps://github.com/dbader/schedule\r\nhttps://github.com/Bogdanp/dramatiq/tree/master/examples/scheduling\r\n\n\nyes those methods I know but it is not working with an async function\n\nhttps://github.com/aio-libs/aiojobs maybe ? never tried it", "source": "bug_issue", "type": "bug_solution", "issue_number": 38}
{"instruction": "How to fix: Will FastAPI support QUERY http method? \"app.query\"", "input": "### Discussed in https://github.com/fastapi/fastapi/discussions/6049\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **FilipeMarch** December 16, 2022</sup>\r\n### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.query('/query/subjects')\r\ndef query_subjects(schema: ArbitrarySchema):\r\n    with Session(engine) as db:\r\n        subjects = db.query(Subject).all()\r\n        return schema(**subjects)\r\n\r\n# something like this\r\n```\r\n\r\n\r\n### Description\r\n\r\nThere is a new HTTP method called QUERY, I discovered it this week and it is super interesting!\r\n\r\nhttps://www.ietf.org/archive/id/draft-ietf-httpbis-safe-method-w-body-02.html\r\n\r\nI was trying to make a GET route that would accept a request body, but started receiving an error on Swagger UI:\r\n\r\n[TypeError: Request has method 'GET' and cannot have a body](https://github.com/swagger-api/swagger-ui/issues/5891#issuecomment-1340591857)\r\n\r\nThe idea is that sometimes we need to make a big or complex query, and this is the scenario in which we can see the advantages of GraphQL, and although I have seen that [we can integrate FastAPI with GraphQL](https://fastapi.tiangolo.com/advanced/graphql/), I was wondering if FastAPI will ever be able to simply accept a QUERY method like, for example, `app.query(\"/query/subjects\")`.\r\n\r\nFor example, suppose I have this object:\r\n```yml\r\n{\r\n   \"id\": 1,\r\n   \"name\": \"Math\"\r\n   \"tags\": [\r\n       {\r\n           \"id\": 1,\r\n           \"name\": \"Algebra\",\r\n           \"number_of_clicks\": 1,\r\n           \"number_of_questions\": 7,\r\n           \"number_of_answers\": 3,\r\n           \"number_of_comments\": 2,\r\n           \"number_of_votes\": 1,\r\n       }]\r\n   \"topics\": [\r\n       {\r\n           \"id\": 1,\r\n           \"name\": \"Linear Equations\",\r\n           \"likes\": 1,\r\n           \"dislikes\": 0,\r\n           \"number_of_clicks\": 1,\r\n           \"number_of_tutorials\": 1,\r\n           \"number_of_questions\": 7,\r\n           \"posts\": [\r\n               {\r\n                   \"id\": 1,\r\n                   \"title\": \"How to solve linear equations?\",\r\n                   \"likes\": 1,\r\n                   \"dislikes\": 0,\r\n                   \"number_of_clicks\": 1,\r", "output": "`httptools` supports the query method. FastAPI can support it now.\n\nI would like to attempt this one as a good first issue!\n\nI'll give this an attempt and see where I can get", "source": "bug_issue", "type": "bug_solution", "issue_number": 37}
{"instruction": "How to fix: How to bridge Pydantic models with SQLAlchemy?", "input": "**Description**\r\n\r\nUp until database interaction is introduced, the tutorial for FastAPI uses pydantic models for everything, such as this example in [the sextion on Extra Models](https://fastapi.tiangolo.com/tutorial/extra-models/) :\r\n\r\n```python\r\nclass UserOut(BaseModel):\r\n    username: str\r\n    email: EmailStr\r\n    full_name: str = None\r\n\r\n\r\nclass UserInDB(BaseModel):\r\n    username: str\r\n    hashed_password: str\r\n    email: EmailStr\r\n    full_name: str = None\r\n```\r\n\r\nThis alows for the \"database model\" to have private data which will not be exposed through the API. Later, in [the section on security](https://fastapi.tiangolo.com/tutorial/security/simple-oauth2/), a similar trick is used, but this time using inheritance to stack the two models (which I find makes the return-casting used by some functions better encoded in the type system).\r\n\r\n```py\r\nclass User(BaseModel):\r\n    username: str\r\n    email: str = None\r\n    full_name: str = None\r\n    disabled: bool = None\r\n\r\n\r\nclass UserInDB(User):\r\n    hashed_password: str\r\n```\r\n\r\n```py\r\ndef get_db_user() -> UserInDB:\r\n    return UserInDB(\r\n        username=\"johndoe\", full_name=\"John Doe\",\r\n        email=\"johndoe@example.com\",\r\n        hashed_password=\"fakehashedsecret\",\r\n        disabled=False\r\n    )\r\n\r\ndef get_user() -> User:\r\n    return get_db_user()\r\n```\r\n\r\nHowever, when [proper databases are introduced](https://fastapi.tiangolo.com/tutorial/sql-databases/), those Pydantic models are dropped in favor of a single SQLAlchemy ORM model, with no effort to bridge the two parts. And while one could see this as the SQLAlchemy models completely superseding the Pydantic models, [the fullstack demo app](https://github.com/tiangolo/full-stack-fastapi-postgresql) appears to [actually use both](https://github.com/tiangolo/full-stack-fastapi-postgresql/blob/ecd634e49715bb57fdfeb35b9dba21a6e94cf012/%7B%7Bcookiecutter.project_slug%7D%7D/backend/app/app/api/api_v1/endpoints/login.py#L13-L16), so there appears to be value in attempting to use them together, something which the documentation doesn't seem to address.\r\n\r\nSo can/should Pydantic and SQLAlchemy models be used together? If they are, how is one meant to connect the two together and can this still be done while maintaining some kind of type hierarchy?", "output": "From what I can tell, there is no problem using both pydantic models and SQLAlchemy models, and if you want to use sqlalchemy as your ORM you will *need* to use both.\r\n\r\nI've found this a little frustrating because, at least in my experience, it leads to lots of similarly-named objects and repetition of definitions, and frequent translation between the types depending on how you are using them. @tiangolo I would be interested if you have any suggestions for design patterns that would reduce the amount of \"translation\" code associated with having separate pydantic and sqlalchemy models.\r\n\r\nMore generally, I would be interested to hear if anyone has found a clean approach to bridging the gap between pydantic and a database, especially if it integrates nicely with an asynchronous database driver (I've been using ([encode/databases](https://github.com/encode/databases)), which only supports SQLAlchemy core,  not the ORM). In particular, it would be nice if I only had to create a single class for each conceptual model (I'd be okay with separate classes for pydantic and the orm as long as they could be derived from a common root).\r\n\r\nMy current approach has been to create a container class that holds references to the database table and the appropriate creation/in-db pydantic models (similar to UserCreate and UserInDB from the docs), and has a variety of generic classmethods for CRUD that make use of the creation/in-db types for input / return, but it still feels like a hack.\n\nHi @dmontagu , \r\n\r\nI am interested in your 'hack' üòÑ Could you share some code sample ?\r\n\r\nOn my side, I find it useful to split the models used for frontend interaction (Pydantic) from those used for the DB interaction and business logic (SQLAlchemy).\r\n\r\nI have therefore followed the scaffold from https://github.com/tiangolo/full-stack-fastapi-postgresql, with some repetition between models and db_models. But again, I am fine with it since it adresses different purpose. The point where repetition becomes to cumbersome is the crud layer, where you basically have to copy-paste again and again the same pieces of code. I have made a PR to try to reduce this friction: https://github.com/tiangolo/full-stack-fastapi-postgresql/pull/23\r\n\r\nI am curious to see how this goes along with @dmontagu approach...\r\n\r\nBy the way, fastapi takes care to translate SQLAlchemy models to pydantic ones on the api endpoint layer, with two limitations I have found so far on JSON fields (see https://github.com/tiangolo/fastapi/issues/211 for details) and Enum fields in a specific use case (see https://github.com/tiangolo/fastapi/issues/196)\n\nSo, Pydantic and SQLAlchemy are separated. Pydantic is used for documentation, validation, and data serialization. SQLAlchemy for SQL ORM stuff.\r\n\r\nFastAPI is not coupled with any DB, so, SQLAlchemy is optional.\r\n\r\nIf you don't care about having documentation, validation, and serialization, you don't need to use Pydantic, you could return SQLAlchemy models directly. They would be converted to JSON in a \"best-effort\" way.\r\n\r\nIf you want both, for now, you have to write both.\r\n\r\nI agree I don't like the duplication of properties in classes. But there's still no way to automatically generate one from the other.\r\n\r\nThat's a good candidate for a third-party package, that generates Pydantic models from SQLAlchemy models (or other ORMs) automatically. But it doesn't exist yet. There are some attempts at doing [something similar](https://github.com/awesometoolbox/ormantic) but I don't know a complete solution yet. Hopefully, someone will build it (or I'll do it later).\r\n\r\n---\r\n\r\nFor now, I'll take it as a request to update the docs clarifying the use of both Pydantic and SQLAlchemy at the same time.", "source": "bug_issue", "type": "bug_solution", "issue_number": 36}
{"instruction": "How to fix: Suggest middlwares for oauth2 against external providers", "input": "### Is your feature request related to a problem\r\n\r\nIs your feature request related to a problem? Yes\r\n\r\nIt is unclear how to integrate an external oauth provider such as Microsoft, Google, Auth0 with FastAPI.\r\n\r\n### The solution you would like\r\n\r\nA section on the documentation describing how to achieve this, or which libraries do we recommend to do so.\r\n\r\nTwo examples include [the client from authlib](https://docs.authlib.org/en/stable/client/starlette.html) and [starlette-oauth2-api](https://pypi.org/project/starlette-oauth2-api/).\r\n\r\n### Describe alternatives you've considered\r\n\r\nPR an implementation to FastAPI. The reason I avoided this is because OAuth is not a thing of FastAPI only, but of a web app in general.\r\n\r\n### Additional context\r\n\r\nI am the author of starlette-oauth2-api, which we have been using to secure an API of ours against access tokens signed by external providers (multi-tenancy).", "output": "I personally would welcome a docs PR, and I think the discussion at the end of https://github.com/tiangolo/fastapi/pull/797 may be relevant. I think @tiangolo might already be cooking up something along these lines.\n\nHi All,\r\n\r\nI would need it too ;-)\r\nI found a good doc for flask here:\r\nhttps://realpython.com/flask-google-login/\r\n\r\nBR,\r\nGeorge\n\nHow to add google auth is explained in this article: \r\nhttps://medium.com/data-rebels/fastapi-google-as-an-external-authentication-provider-3a527672cf33", "source": "bug_issue", "type": "bug_solution", "issue_number": 35}
{"instruction": "How to fix: Russian translation", "input": "### üá∑üá∫ Russian translation\r\n\r\nComrades from Russia need this :-)\r\nLet me know if you need a more precise plan for translating documentation into Russian. I created this issue to track and coordinate translation activities.\r\n\r\n_(in Soviet Russia documentation translates YOU)_", "output": "See my review please https://github.com/tiangolo/fastapi/pull/1363#pullrequestreview-421383447\n\nAwesome!\r\n\r\n> (in Soviet Russia documentation translates YOU)\r\n\r\nThis made me laugh :joy: \r\n\r\n---\r\n\r\nI just made a \"meta-issue\" with translations to pin that one and refer to each issue coordinating translations (including this one) from it.\n\nHello, comrade @tiangolo !\r\nUnfortunately comrade @rezchikov hasn't been online for a month. I hope he‚Äôs not in gulag üò¢ \r\n\r\nI want to develop Russian translation, how is it better to do this? Create a new pull request?", "source": "bug_issue", "type": "bug_solution", "issue_number": 34}
{"instruction": "How to fix: FastApi & MongoDB - the full guide", "input": "### Description\r\n\r\nIn this issue i'd like to gather all the information about the use of MongoDB, FastApi and Pydantic. At this point this is a \"rather complete\" solution, but i'd like to gather feedback and comments from the community to se how it can be improved.\r\n\r\nThe biggest pain point that started this and several other threads when trying to use FastAPI with mongo is the `_id` field. There are several issues here:\r\n1. Most known one - `_id` field being `ObjectId`, which is not very JSON-friendly\r\n2. `_id` field by it's naming is not very python-friendly (that is, written as is in Pydantic model, it would become a private field - many IDEs will point that)\r\n\r\nBelow i'll try to describe solutions i've found in different places and see what cases do the cover and what's left unsolved.\r\n\r\nLet's say, we have some Joe, who's a regular developer. Joe just discovered FastAPI and is familiar with mongo (to the extend that he can create and fetch documents from DB). Joe wants to build clean and fast api that would:\r\n\r\n1Ô∏è‚É£ Be able to define mongo-compatible documents as regular Pydantic models (with all the proper validations in place):\r\n```python\r\nclass User(BaseModel):\r\n    id: ObjectId = Field(description=\"User id\")\r\n    name: str = Field()\r\n```\r\n2Ô∏è‚É£ Write routes that would use native Pydantic models as usual:\r\n ```python\r\n@app.post('/me', response_model=User)\r\ndef save_me(body: User):\r\n    ...\r\n```\r\n3Ô∏è‚É£ Have api to return json like `{\"id\": \"5ed8b7eaccda20c1d4e95bb0\", \"name\": \"Joe\"}` (it's quite expected in the \"outer world\" to have `id` field for the document rather than `_id`. And it just looks nicer.)\r\n4Ô∏è‚É£ Have Swagger and ReDoc documentation to display fields `id` (str), `name` (str)\r\n5Ô∏è‚É£ Be able to save Pydantic documents into Mongo with proper `id` field substitution:\r\n```python\r\nuser = User(id=ObjectId(), name='Joe')\r\ninserted = db.user.insert_one(user) # This should insert document as `{\"_id\": user.id, \"name\": \"Joe\"}`\r\nassert inserted.inserted_id == user.id\r\n```\r\n6Ô∏è‚É£ Should be able to fetch documents from Mongo with proper `id` matching:\r\n```python\r\nuser_id = ObjectId()\r\nfound = db.user.find({\"_id\": user_id})\r\nuser = User(**found)\r\nassert user.id == user_id\r\n```\r\n\r\n### Known solutions\r\n\r\n#### Validating ObjectId\r\n\r\nAs proposed in #452, one can define custom field for `ObjectId` and apply validations to it. One can also create base model that would encode `ObjectId` into strings:\r\n\r\n```python\r\n\r\nclass OID(str):\r\n    @classmethod\r\n    def __get_validators__(cls):\r\n        yield cls.validate\r\n\r\n    @classmethod\r\n    def validate(cls, v):\r\n        try:\r\n            return ObjectId(str(v))\r\n        except InvalidId:\r\n            raise ValueError(\"Not a valid ObjectId\")\r\n\r\n\r\nclass MongoModel(BaseModel):\r\n    class Config(BaseConfig):\r\n        json_encoders = {\r\n            datetime: lambda dt: dt.isoformat(),\r\n            ObjectId: lambda oid: str(oid),\r\n        }\r\n\r\nclass User(MongoModel):\r\n    id: OID = Field()\r\n    name: str = Field()\r\n\r\n\r\n@a", "output": "Firstly, nice work! As you said, this is a fully working solution to using MongoDB with FastAPI that I'm sure will benefit people going forward.\r\n\r\nI would highly recommend that if this is to become the \"recommended\" way of working with MongoDB that we recommend an ODM (object-document-mapper) and show any potential issues with using those with Pydantic/FastAPI. The main reasons are:\r\n\r\n1. It would fall more in line with most of the examples in the docs (e.g. SQLAlchemy). Most FastAPI examples with response models show returning ORM-like objects. An ODM is the natural translation for Mongo.\r\n2. It resolves the 3 sub-optimal points you mentioned above.\r\n3. It encourages using objects instead of dicts for all code- which allows type annotations and editor completion.\r\n\r\nThe existing ODMs are not great. I don't think any of the major ones include type annotations or bulk write support. But they are fairly lightweight and get us most of the way there, and allow you to reach down into raw Mongo queries when you need to. I think if we're going to put some development effort into making Mongo easier to use with Pydantic/FastAPI, it would be best spent writing docs that are as accessible as possible and maybe contributing to existing ODMs to clear up any sticking points.\r\n\r\nObviously ODMs can be a contentious topic, but so can ORMs and FastAPI does not shy away from showing them as the easier way to get started. I think in an ideal world, we'd include the more straight forward \"here's an ODM, point and click\" approach first and the more advanced \"DIY\" approach after for people who want to wander into the deep end.\n\nCorrect me if I'm wrong but isn't the real key missing part for all of this the serializers/deserializers/validators for all the Mongo/Bson datatypes in Pydantic. If Pydantic added support for all the extra datatypes then you could just return a MongoEngine instance directly no?\n\nInterested to know how people are handling creation of indexes in mongo db . Does anyone know of suitable way to define index on a Pydantic model? ", "source": "bug_issue", "type": "bug_solution", "issue_number": 33}
{"instruction": "How to fix: How to do flexibly use nested pydantic models for sqlalchemy ORM", "input": "### First check\r\n\r\n* [x ] I added a very descriptive title to this issue.\r\n* [ x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [ x] I searched the FastAPI documentation, with the integrated search.\r\n* [x ] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [ x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [ x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x ] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [ x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [ x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n<!-- \r\n\r\nI'm asking all this because answering questions and solving problems in GitHub issues consumes a lot of time. I end up not being able to add new features, fix bugs, review Pull Requests, etc. as fast as I wish because I have to spend too much time handling issues.\r\n\r\nAll that, on top of all the incredible help provided by a bunch of community members that give a lot of their time to come here and help others.\r\n\r\nThat's a lot of work they are doing, but if more FastAPI users came to help others like them just a little bit more, it would be much less effort for them (and you and me üòÖ).\r\n\r\n-->\r\n\r\n### Example\r\n\r\n```python\r\nfrom fastapi import Depends, FastAPI, HTTPException, Body, Request\r\nfrom sqlalchemy import create_engine, Boolean, Column, ForeignKey, Integer, String\r\nfrom sqlalchemy.ext.declarative import declarative_base\r\nfrom sqlalchemy.orm import Session, sessionmaker, relationship\r\nfrom sqlalchemy.inspection import inspect\r\nfrom typing import List, Optional\r\nfrom pydantic import BaseModel\r\nimport json\r\n\r\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./test.db\"\r\nengine = create_engine(\r\n    SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\r\n)\r\n\r\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\r\nBase = declarative_base()\r\napp = FastAPI()\r\n\r\n# sqlalchemy models\r\n\r\n\r\nclass RootModel(Base):\r\n    __tablename__ = \"root_table\"\r\n    id = Column(Integer, primary_key=True, index=True)\r\n    someRootText = Column(String)\r\n    subData = relationship(\"SubModel\", back_populates=\"rootData\")\r\n\r\n\r\nclass SubModel(Base):\r\n    __tablename__ = \"sub_table\"\r\n    id = Column(Integer, primary_key=True, index=True)\r\n    someSubText = Column(String)\r\n    root_id = Column(Integer, ForeignKey(\"root_table.id\"))\r\n    rootData = relationship(\"RootModel\", back_populates=\"subData\")\r\n\r\n\r\n# pydantic models/schemas\r\nc", "output": "Have you tried @tiangolo's [Pydantic SQLAlchemy](https://github.com/tiangolo/pydantic-sqlalchemy) ?\n\nThank you for the contribution, but your proposal is for converting sqlalchemy model to pydantic, I need a way to convert a nested model from pydantic to sqlalchemy.\n\nI am thinking about a recursive function to do what I want. I currently need an external \"maping\" dict that translates the pydantic sub class to the related sqlalchemy class by their name. Would be helpful if someone could provide an example of a recursive function for two dicts. Added difficulty that sub model could be lists or direct keys.", "source": "bug_issue", "type": "bug_solution", "issue_number": 32}
{"instruction": "Debug this error: No objects ever released by the GC, potential memory leak?", "input": "```\n# From the official documentation\r\n# Run with uvicorn main:app --reload\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\nasync def root():\r\n    return {\"message\": \"Hello World\"}\n\n```", "output": "Are you using `--reload` as part of your entrypoint like the comment at the top of the code block indicates? What limits if any are you running with in Kube? Those graphs don't look like leaks, they look like constant memory usage to me so my interpretation of what might be happening is that upon application instance initialization some objects are being loaded into memory and those are never being released for whatever reason, likely they're being used by the application itself. These could be connections of various sorts, some data that is getting served, hard to say without seeing the actual production service. Memory leaks usually look like a somewhat constant increase in memory usage until a threshold is breached and then the service is OOM'd.\n\nWhat uvicorn version are you using?\r\n\r\nDo you have a health check that sends an TCP ping?\r\n\r\nIf answers above are: \"not the latest\" and \"yes\", then bump uvicorn to the latest one.\n\nIs the application running in the docker container? In the container, python recognizes the memory and CPUs of the host, not the resources limited of the container, which may cause the GC not to be actually executed.\r\n\r\nSimilar problems have occurred in my application before. I solved them with reference to this issue: https://github.com/tiangolo/fastapi/issues/596#issuecomment-635184641 \r\n", "source": "bug_issue", "type": "error_debug", "issue_number": 31}
{"instruction": "How to fix: No objects ever released by the GC, potential memory leak?", "input": "### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options üëÜ\n\n### Example Code\n\n```python\n# From the official documentation\r\n# Run with uvicorn main:app --reload\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\nasync def root():\r\n    return {\"message\": \"Hello World\"}\n```\n\n\n### Description\n\nUse the minimal example provided in the documentation, call the API 1M times. You will see that the memory usage piles up and up but never goes down. The GC can't free any objects. It's very noticeable once you have a real use case like a file upload that DoS'es your service.\r\n\r\n\r\n![memory-profile](https://user-images.githubusercontent.com/4538351/156794820-5bad7c00-6e02-4e27-bac3-ab488baa0df4.png)\r\n\r\nHere some examples from a real service in k8s via lens metrics:\r\n\r\n<img width=\"677\" alt=\"Screenshot 2022-03-04 at 16 47 18\" src=\"https://user-images.githubusercontent.com/4538351/156794991-abe94e21-57f4-4d96-a347-35a96e72c0d3.png\">\r\n\r\n<img width=\"681\" alt=\"Screenshot 2022-03-03 at 20 19 22\" src=\"https://user-images.githubusercontent.com/4538351/156795013-0a9792c3-8948-4d62-93af-31c41626f1eb.png\">\n\n### Operating System\n\nLinux, macOS\n\n### Operating System Details\n\n_No response_\n\n### FastAPI Version\n\n0.74.1\n\n### Python Version\n\nPython 3.10.1\n\n### Additional Context\n\n_No response_", "output": "Are you using `--reload` as part of your entrypoint like the comment at the top of the code block indicates? What limits if any are you running with in Kube? Those graphs don't look like leaks, they look like constant memory usage to me so my interpretation of what might be happening is that upon application instance initialization some objects are being loaded into memory and those are never being released for whatever reason, likely they're being used by the application itself. These could be connections of various sorts, some data that is getting served, hard to say without seeing the actual production service. Memory leaks usually look like a somewhat constant increase in memory usage until a threshold is breached and then the service is OOM'd.\n\nWhat uvicorn version are you using?\r\n\r\nDo you have a health check that sends an TCP ping?\r\n\r\nIf answers above are: \"not the latest\" and \"yes\", then bump uvicorn to the latest one.\n\nIs the application running in the docker container? In the container, python recognizes the memory and CPUs of the host, not the resources limited of the container, which may cause the GC not to be actually executed.\r\n\r\nSimilar problems have occurred in my application before. I solved them with reference to this issue: https://github.com/tiangolo/fastapi/issues/596#issuecomment-635184641 \r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 31}
{"instruction": "Debug this error: Problems with await in async dependencies (when using dependencies and middleware simultaneously)", "input": "```\nimport fastapi\r\nimport datetime as dt\r\nimport sqlalchemy as sa\r\n\r\nfrom sqlalchemy.ext.asyncio import AsyncEngine, AsyncSession\r\nfrom sqlalchemy.ext.asyncio import create_async_engine\r\nfrom sqlalchemy.orm import sessionmaker\r\n\r\n\r\nclass _Conn:\r\n    radius_engine: AsyncEngine\r\n    radius_session_maker: sessionmaker\r\n\r\n\r\ndef init_pg_connections() -> None:\r\n    _Conn.radius_engine = create_async_engine(\r\n        'postgresql+asyncpg://postgres:password@host:port/db_name',\r\n        connect_args={\r\n            'server_settings': {\r\n                'application_name': 'test_app'\r\n            }\r\n        },\r\n        pool_size=2, max_overflow=10\r\n    )\r\n    _Conn.radius_session_maker = sessionmaker(\r\n        bind=_Conn.radius_engine,\r\n        autoflush=False, autocommit=False,\r\n        expire_on_commit=False,\r\n        class_=AsyncSession\r\n    )\r\n\r\n\r\nasync def get_db():\r\n    db: AsyncSession = _Conn.radius_session_maker()\r\n    try:\r\n        yield db\r\n    finally:\r\n        print('finally get_db. Before close')\r\n        await db.close()\r\n        print('finally get_db. After close')\r\n\r\n\r\ndef get_app():\r\n    app = fastapi.FastAPI(\r\n        on_startup=[init_pg_connections]\r\n    )\r\n\r\n    @app.middleware('http')\r\n    async def add_process_time_header(request: fastapi.Request, call_next):\r\n        start_time = dt.datetime.now()\r\n        response = await call_next(request)\r\n        process_time = (dt.datetime.now() - start_time).total_seconds()\r\n        response.headers[\"X-Process-Time\"] = str(process_time)\r\n        return response\r\n\r\n    @app.post('/test')\r\n    async def test(\r\n            data: int = fastapi.Body(5, embed=True),\r\n            db: AsyncSession = fastapi.Depends(get_db)\r\n    ):\r\n        res = (await db.execute(sa.text('Select * FROM radacct'))).scalars().all()\r\n        print('test', f'{data=} {res=}')\r\n        return 'OK'\r\n    return app\r\n\r\n\r\nif __name__ == '__main__':\r\n    import uvicorn\r\n    _app = get_app()\r\n    uvicorn.run(_app, host='10.10.10.98', port=7776)\n\n```", "output": "Yes, having the same problem with `get_db` dependency not closing connection and the same error message. And it started with 0.74 release https://github.com/tiangolo/fastapi/releases/tag/0.74.0\r\n\r\n```python\r\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\r\nfrom sqlalchemy.orm import sessionmaker\r\n\r\nfrom app.config import settings\r\n\r\n\r\nengine = create_async_engine(\r\n    settings.DB_DSN,\r\n    echo=settings.DB_ECHO,\r\n    pool_size=settings.DB_POOL_SIZE,\r\n    max_overflow=settings.DB_MAX_OVERFLOW,\r\n    future=True,\r\n)\r\nasync_session = sessionmaker(engine, expire_on_commit=False, class_=AsyncSession, future=True, autoflush=False)\r\n\r\n\r\nasync def get_db():\r\n    db = async_session()\r\n    try:\r\n        yield db\r\n    finally:\r\n        await db.close()\r\n```\r\n\r\nAnd I have middlewares also\n\nSame here with `async_session` used inside a context manager, pinning fastapi to `0.73.0` fixes it. Using `asyncmy` as driver.\r\n\r\n```python\r\nasync def get_db_session(request: Request) -> AsyncGenerator[AsyncSession, None]:\r\n    async_sessionmaker = request.app.state.sessionmaker\r\n    session: AsyncSession\r\n    async with async_sessionmaker() as session:\r\n        try:\r\n            yield session\r\n        except SQLAlchemyError:\r\n            await shield(session.rollback())\r\n            logger = get_logger()\r\n            logger.exception(\"sqlalchemy_exception\")\r\n```\n\nHave similar bug when update from 0.73.2 to 0.75.2.\r\n\r\nI have async connection to postgres DB and connection started to pile up until I reach DB max client limit.\r\n\r\nThis is screenshot from pgAdmin, from Dashboard and statistic tabs, as you can see connection stuck at ROLLBACK\r\n![image](https://user-images.githubusercontent.com/4011523/164030558-c9ec1899-2658-4f48-937c-c9a1cc976481.png)\r\n\r\nMy code for Dependency:\r\n```py\r\n# imports...\r\n\r\nengine = create_async_engine(DATABASE_URL, echo=DEBUG, future=True)\r\n\r\n# ....\r\n\r\nasync def get_session() -> AsyncGenerator[AsyncSession, None]:\r\n    async_session = sessionmaker(\r\n        engine,\r\n        class_=AsyncSession,  # type: ignore\r\n        expire_on_commit=False,\r\n    )\r\n\r\n    async with async_session() as session:\r\n        yield session\r\n        await session.close()\r\n```\r\n\r\nThen in code I use it like:\r\n```py\r\n@router.get(\"/count\", response_model=UserCount)\r\nasync def counts_users(session: AsyncSession = Depends(get_session), current_user: User = Depends(get_current_user)) -> UserCount:\r\n    # code ...\r\n    # in CRUD:\r\n    query = await session.execute(...)\r\n    return UserCount(users=query.scalar_one())\r\n```", "source": "bug_issue", "type": "error_debug", "issue_number": 30}
{"instruction": "How to fix: Problems with await in async dependencies (when using dependencies and middleware simultaneously)", "input": "### First Check\n\n- [X] I added a very descriptive title to this issue.\n- [X] I used the GitHub search to find a similar issue and didn't find it.\n- [X] I searched the FastAPI documentation, with the integrated search.\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\n\n### Commit to Help\n\n- [X] I commit to help with one of those options üëÜ\n\n### Example Code\n\n```python\nimport fastapi\r\nimport datetime as dt\r\nimport sqlalchemy as sa\r\n\r\nfrom sqlalchemy.ext.asyncio import AsyncEngine, AsyncSession\r\nfrom sqlalchemy.ext.asyncio import create_async_engine\r\nfrom sqlalchemy.orm import sessionmaker\r\n\r\n\r\nclass _Conn:\r\n    radius_engine: AsyncEngine\r\n    radius_session_maker: sessionmaker\r\n\r\n\r\ndef init_pg_connections() -> None:\r\n    _Conn.radius_engine = create_async_engine(\r\n        'postgresql+asyncpg://postgres:password@host:port/db_name',\r\n        connect_args={\r\n            'server_settings': {\r\n                'application_name': 'test_app'\r\n            }\r\n        },\r\n        pool_size=2, max_overflow=10\r\n    )\r\n    _Conn.radius_session_maker = sessionmaker(\r\n        bind=_Conn.radius_engine,\r\n        autoflush=False, autocommit=False,\r\n        expire_on_commit=False,\r\n        class_=AsyncSession\r\n    )\r\n\r\n\r\nasync def get_db():\r\n    db: AsyncSession = _Conn.radius_session_maker()\r\n    try:\r\n        yield db\r\n    finally:\r\n        print('finally get_db. Before close')\r\n        await db.close()\r\n        print('finally get_db. After close')\r\n\r\n\r\ndef get_app():\r\n    app = fastapi.FastAPI(\r\n        on_startup=[init_pg_connections]\r\n    )\r\n\r\n    @app.middleware('http')\r\n    async def add_process_time_header(request: fastapi.Request, call_next):\r\n        start_time = dt.datetime.now()\r\n        response = await call_next(request)\r\n        process_time = (dt.datetime.now() - start_time).total_seconds()\r\n        response.headers[\"X-Process-Time\"] = str(process_time)\r\n        return response\r\n\r\n    @app.post('/test')\r\n    async def test(\r\n            data: int = fastapi.Body(5, embed=True),\r\n            db: AsyncSession = fastapi.Depends(get_db)\r\n    ):\r\n        res = (await db.execute(sa.text('Select * FROM radacct'))).scalars().all()\r\n        print('test', f'{data=} {res=}')\r\n        return 'OK'\r\n    return app\r\n\r\n\r\nif __name__ == '__main__':\r\n    import uvicorn\r\n    _app = get_app()\r\n    uvicorn.run(_app, host='10.10.10.98', port=7776)\n```\n\n\n### Description\n\nFastAPI version>=0.74 has a very strange problem with dependency (func get_db in example). \r\n\r\n1) If you run this code as it is and send reques", "output": "Yes, having the same problem with `get_db` dependency not closing connection and the same error message. And it started with 0.74 release https://github.com/tiangolo/fastapi/releases/tag/0.74.0\r\n\r\n```python\r\nfrom sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\r\nfrom sqlalchemy.orm import sessionmaker\r\n\r\nfrom app.config import settings\r\n\r\n\r\nengine = create_async_engine(\r\n    settings.DB_DSN,\r\n    echo=settings.DB_ECHO,\r\n    pool_size=settings.DB_POOL_SIZE,\r\n    max_overflow=settings.DB_MAX_OVERFLOW,\r\n    future=True,\r\n)\r\nasync_session = sessionmaker(engine, expire_on_commit=False, class_=AsyncSession, future=True, autoflush=False)\r\n\r\n\r\nasync def get_db():\r\n    db = async_session()\r\n    try:\r\n        yield db\r\n    finally:\r\n        await db.close()\r\n```\r\n\r\nAnd I have middlewares also\n\nSame here with `async_session` used inside a context manager, pinning fastapi to `0.73.0` fixes it. Using `asyncmy` as driver.\r\n\r\n```python\r\nasync def get_db_session(request: Request) -> AsyncGenerator[AsyncSession, None]:\r\n    async_sessionmaker = request.app.state.sessionmaker\r\n    session: AsyncSession\r\n    async with async_sessionmaker() as session:\r\n        try:\r\n            yield session\r\n        except SQLAlchemyError:\r\n            await shield(session.rollback())\r\n            logger = get_logger()\r\n            logger.exception(\"sqlalchemy_exception\")\r\n```\n\nHave similar bug when update from 0.73.2 to 0.75.2.\r\n\r\nI have async connection to postgres DB and connection started to pile up until I reach DB max client limit.\r\n\r\nThis is screenshot from pgAdmin, from Dashboard and statistic tabs, as you can see connection stuck at ROLLBACK\r\n![image](https://user-images.githubusercontent.com/4011523/164030558-c9ec1899-2658-4f48-937c-c9a1cc976481.png)\r\n\r\nMy code for Dependency:\r\n```py\r\n# imports...\r\n\r\nengine = create_async_engine(DATABASE_URL, echo=DEBUG, future=True)\r\n\r\n# ....\r\n\r\nasync def get_session() -> AsyncGenerator[AsyncSession, None]:\r\n    async_session = sessionmaker(\r\n        engine,\r\n        class_=AsyncSession,  # type: ignore\r\n        expire_on_commit=False,\r\n    )\r\n\r\n    async with async_session() as session:\r\n        yield session\r\n        await session.close()\r\n```\r\n\r\nThen in code I use it like:\r\n```py\r\n@router.get(\"/count\", response_model=UserCount)\r\nasync def counts_users(session: AsyncSession = Depends(get_session), current_user: User = Depends(get_current_user)) -> UserCount:\r\n    # code ...\r\n    # in CRUD:\r\n    query = await session.execute(...)\r\n    return UserCount(users=query.scalar_one())\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 30}
{"instruction": "How to fix: fastapi dev runs stuck", "input": "### Privileged issue\n\n- [X] I'm @tiangolo or he asked me directly to create an issue here.\n\n### Issue Content\n\nThe first time I ran fastapi dev, there was no problem, but I encountered a code error. Then after I modified the code and saved it, a WARNING: WatchFiles detected changes in 'tool/index.py'. Reloading... then got stuck and could not exit.\r\n\r\n<img width=\"983\" alt=\"image\" src=\"https://github.com/tiangolo/fastapi/assets/29888469/f596a4fb-af29-4098-b489-3d9efee08f2c\">", "output": "Any updates on this @kingcwt? facing the same issue!\n\nCould be related to: https://github.com/encode/uvicorn/issues/2000\n\nI currently have a slightly different issue from yours @kingcwt but it's still an issue with fastapi cli (dev and run)\r\nThe Code \r\n![image](https://github.com/tiangolo/fastapi/assets/69792620/c51f8e7a-79ab-437c-883b-8357ae074b35)\r\n\r\n\r\nThe Error\r\n![image](https://github.com/tiangolo/fastapi/assets/69792620/82c3bbf7-903f-4c8c-b0f4-9b0caaba0c21)\r\n![image](https://github.com/tiangolo/fastapi/assets/69792620/0ef1037d-7e28-4bd0-ade1-56b7307871c7)\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 29}
{"instruction": "How to fix: First-class session support in FastAPI", "input": "### Is your feature request related to a problem\r\n\r\nAll of the security schemas currently supported by FastAPI rely on some sort of \"client-server synergy\" , where, for instance, the client is expected to know and remember an OAuth token or the user credentials to be sent via headers. This works fairly well for single-page applications, but if you need to integrate authentication to an app that uses templates, keeping track of that authentication data becomes a challenge. Most applications would use server-side sessions to deal with this, but FastAPI doesn't really have a system to deal with sessions right now.\r\n\r\n### Describe alternatives you've considered\r\n\r\n#### Using Starlette's SessionMiddleware\r\n\r\nWhile Starlette's `SessionMiddleware` is mentionned a number of times in the FastAPI documentation, it does not integrate very well with the framework itself . What it does is that it adds a `request.session` dict on the `Request` object that lets the backend store and retreive information from it, and just before the response get sent, [that dict is serialized, combined to a timestamp, signed, converted into base 64 and appended as a cookie](https://github.com/encode/starlette/blob/b8bd1696492e501bd617bd151278999c68b30e2b/starlette/middleware/sessions.py#L52-L63). The client is then expected to send theat cookie back so that the server so that information can be decoded and used. This is what the Django doc describes as [the cookie-based approach](https://docs.djangoproject.com/en/2.2/topics/http/sessions/).\r\n\r\nThe problem with all this is that the entire process happens outside of what FastAPI can handle, and therefore does not appear in the generated OpenAPI documentation as an authentication schema.\r\n\r\nHaving read the source for that middleware and the documentation for itsdangerous, I also understand that this kind of \"session blob\" authentication method isn't really supported by OpenAPI, since all supported auth methods are expected to use constants to handle authentication.\r\n\r\n### The solution you would like\r\n\r\nIdeally, I would like to see FastAPI adding some kind of `SessionCookie[T]` class to `fastapi.security`, that would register a cookie-based API key authentication method (which is [what Swagger reccomands](https://swagger.io/docs/specification/authentication/cookie-authentication/), since sessions are out of scope for the OpenAPI spec). Those \"API keys\" would be session tokens, much like the It should also register that routes that depend on that security schema may reply with a `Set-Cookie` header.\r\n\r\nThe question of how that data would be persisted afterwards is an open one. Having a one-size-fits-all implementation as the only one available could be constraining, so there's always the option of a `fastapi.security.sessions` namespace containing things like `MemorySessionStorage`, `DatabaseSessionStorage`, `FileSessionStorage` and so on.\r\n\r\n### Additional context\r\n\r\nMaybe something like this?\r\n\r\n```py\r\nfrom fastapi import Depends, ", "output": "@prostomarkeloff: I know this is off-topic, but I thought LGTM was what you're supposed to say when reviewing patches and pull requests? What would that mean in the context of a feature request?\n\n@sm-Fifteen hmm. I wanted say that i am interested in this feature :)\n\nIn general I like this idea, because I think a lot of issue have been raised by people looking for this feature, especially in the context of a basic browser-driven interface.\r\n\r\nThat said, for maintainability reasons, I would *much* prefer an implementation that was ultimately powered by features in Starlette, where FastAPI just provided a cleaner dependency injection API and OpenAPI integration, and possibly using generics like `SessionCookie` as you wrote it above to get more of a typed interface (possibly with validation).\r\n\r\nIn particular, I think it would be much preferable for FastAPI to essentially wrap the pluggable session backends that are a part of [this PR](https://github.com/encode/starlette/pull/499), assuming it is eventually merged.\r\n\r\n@sm-Fifteen thoughts?\r\n\r\n------\r\n\r\nSeparately, I think it would be great if we had (optional) support for generics in many places where Starlette has an untyped interface. In particular, in addition to the `SessionCookie` as you've described it, I really wish there was an easy way to generically specify the types of `request.state` and `request.app.state`. I have some hacks in my own code to accomplish this, but maybe there is a clean way to unify all of these...\r\n", "source": "bug_issue", "type": "bug_solution", "issue_number": 28}
{"instruction": "How to fix: üôè Find maintainers for FastAPI", "input": "### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n\r\n### Description\r\n\r\nAt the moment, all contributions to the FastAPI are made with @tiangolo (directly or through a PR review).  \r\n\r\n@tiangolo is doing a great job üí™, but fast developing project with great community like FastAPI demand much more time.  \r\n(It can be seen by the number of open issues and pull request)\r\n\r\n### Wanted Solution\r\n\r\nSuggestion is to __find several active community members__ and add them to the __repository maintainers__, as other projects (e.g. Flask and Django) do. üë®‚Äçüë©‚Äçüëß‚Äçüë¶\r\n\r\nThis will help the development of the project and make the atmosphere for third-party contributors much more pleasant. üëæ\r\n\r\nHope @tiangolo will consider this possibility\r\n\r\nupd: discussion on this #3970\r\n\r\n### Wanted Code\r\n\r\n```python\r\nfrom fastapi.community import active_members  \r\n\r\nactive_members.make_maintainers()\r\n```", "output": "100% this. To stay at the level of Flask and Django, there needs to be a team of core maintainers. We can't just rely on a single person. \r\n\r\nFastAPI being a single maintainer project is a big reason some companies don't want to start experimenting with it/using it. \n\nTotally! We have the same issue in our company  \r\nFastAPI is Great and we use it for demo and inner projects, however, for production we have to use something else. \r\n\r\nI really want it become only-option for python api. And we'll have `1.0.0` soon with a great maintainers team. \n\n@k4black it's not clear if this is just something that you hope for, or if it's an initiative that you have @tiangolo's blessing to undertake. Can you clarify?", "source": "bug_issue", "type": "bug_solution", "issue_number": 27}
{"instruction": "How to fix: Websocket Routes Only Work on FastAPI, not APIRouter", "input": "**Describe the bug**\r\nWebsocket routes appear to only work on the main FastAPI object, not on APIRouter objects.  When the same function is copied from a FastAPI object to an APIRouter object instead of working properly it just throws a 403.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. The following works as expected:\r\n```python\r\nfrom fastapi import FastAPI\r\napp = FastAPI()\r\n\r\n@app.websocket_route(\"/hello\")\r\nasync def hello(websocket):\r\n    await websocket.accept()\r\n    await websocket.send_text(\"Hello!\")\r\n    response = await websocket.receive_text()\r\n    print(response)\r\n    await websocket.close()\r\n    print(\"Closed\")\r\n```\r\n2. Moving `hello` to an APIRouter fails:\r\n```python\r\n# main.py\r\nfrom fastapi import FastAPI\r\nimport other\r\napp = FastAPI()\r\napp.include_router(other.router)\r\n```\r\n\r\n```python\r\n# other.py\r\nfrom fastapi import APIRouter\r\nrouter = APIRouter()\r\n\r\n@router.websocket_route(\"/routerhello\")\r\nasync def hello(websocket):\r\n    await websocket.accept()\r\n    await websocket.send_text(\"Router Hello!\")\r\n    response = await websocket.receive_text()\r\n    print(response)\r\n    await websocket.close()\r\n    print(\"Router Closed\")\r\n```\r\n**Expected behavior**\r\nI expect a websocket route to work on both a FastAPI and APIRouter object.\r\n\r\n**Screenshots**\r\nNot applicable.\r\n\r\n**Environment:**\r\n - OS: macOS 10.14.3\r\n - FastAPI Version: 0.9.0\r\n\r\n- Python version, get it with: 3.7.2\r\n\r\n**Additional context**\r\nTesting websocket client side with `websocat`.", "output": "Thanks for the report!\r\n\r\nIt was fixed by @euri10 in PR https://github.com/tiangolo/fastapi/pull/100.\r\n\r\nIt is available in FastAPI verson `0.10.0`. :tada: :rocket: \n\nJust tested it out!  I'm impressed at how quickly that was fixed, thanks!\n\nAwesome! Kudos to @euri10 for his work üòÄüç∞üåÆ\r\n\r\nThanks @iwoloschin for reporting back and closing the issue.", "source": "bug_issue", "type": "bug_solution", "issue_number": 26}
{"instruction": "How to fix: Very poor performance does not align with marketing", "input": "I wanted to check the temperature of this project and so I ran a quick, very simple, benchmark with `wrk` and the default example:\r\n\r\n```Python\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef read_root():\r\n    return {\"Hello\": \"World\"}\r\n```\r\n\r\nEverything default with wrk, regular Ubuntu Linux, Python 3.8.2, latest FastAPI as of now.\r\n\r\n> wrk http://localhost:8000\r\n\r\nUvicorn with logging disabled (obviously), as per the README:\r\n\r\n> python3 -m uvicorn fast:app --log-level critical\r\n\r\nI get very poor performance, way worse than Node.js and really, really far from Golang:\r\n\r\n```\r\nRunning 10s test @ http://localhost:8000\r\n  2 threads and 10 connections\r\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\r\n    Latency     1.83ms  365.59us   3.90ms   75.34%\r\n    Req/Sec     2.74k   116.21     2.98k    65.00%\r\n  54447 requests in 10.00s, 7.37MB read\r\nRequests/sec:   5442.89\r\nTransfer/sec:    754.78KB\r\n```\r\n\r\nThis machine can do 400k req/sec on one single thread using other software, so 5k is not at all fast. Even Node.js does 20-30k on this machine, so this does not align at all with the README:\r\n\r\n```\r\nThe key features are:\r\n\r\nFast: Very high performance, on par with NodeJS and Go (thanks to Starlette and Pydantic). One of the fastest Python frameworks available.\r\n```\r\n\r\nWhere do you post benchmarks? How did you come to that conclusion? I cannot see you have posted any benchmarks at all?\r\n\r\nPlease fix marketing, it is not at all true.", "output": "If you [read README further](https://github.com/tiangolo/fastapi/blob/master/README.md#performance)...\r\n\r\n> Independent TechEmpower benchmarks show **FastAPI** applications running under Uvicorn as <a href=\"https://www.techempower.com/benchmarks/#section=test&runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&hw=ph&test=query&l=zijzen-7\" class=\"external-link\" target=\"_blank\">one of the fastest Python frameworks available</a>, only below Starlette and Uvicorn themselves (used internally by FastAPI). (*)\r\n>\r\n> To understand more about it, see the section <a href=\"https://fastapi.tiangolo.com/benchmarks/\" class=\"internal-link\" target=\"_blank\">Benchmarks</a>.\n\nOkay, so taking the source **you** gave me (entirely disregarding my own test), I can read the following:\r\n\r\n\r\n268 | fastapi | 159,445 | 2.2%\r\n-- | -- | -- | --\r\n\r\n199 | uvicorn | 382,930 | 5.2%\r\n-- | -- | -- | --\r\n\r\n124 | nodejs | 884,444 | 12.0%\r\n-- | -- | -- | --\r\n\r\n27 | fasthttp | 5,962,266 | 81.2%\r\n-- | -- | -- | --\r\n\r\nWhich is in very stark contrast with the README:\r\n\r\n> Very high performance, on par with NodeJS and Go\r\n\r\nhttps://www.collinsdictionary.com/dictionary/english/on-a-par-with\r\n\r\n2.2% is not \"on par with\" 12%. It's like comparing wine with light beer - they are entirely disjoint, you cannot possibly claim light beer gets you as hammered as wine?\r\n\r\nAnd the golang thing.... jeeeez!\n\n@alexhultman Your point might be valid, but I think you might be oversimplifying your tests here. Benchmarks are a tricky thing, but it's important to know what is it that you are comparing.\r\n\r\nFastApi is a Web application framework that provides quite a bit over just an application server.\r\n\r\nSo if you are comparing FastAPI, say, to NodeJs, then the test should be done over a Web Application Framework as NestJS or similar.\r\n\r\nSame thing with Golang. the comparison should be against Revel or something like this. \r\n\r\nIn @tiangolo's documentation on benchmarks you can read:\r\n\r\n> If you didn't use FastAPI and used Starlette directly (or another tool, like Sanic, Flask, Responder, etc) you would have to implement all the data validation and serialization yourself. So, your final application would still have the same overhead as if it was built using FastAPI. And in many cases, this data validation and serialization is the biggest amount of code written in applications.\r\n\r\nhttps://fastapi.tiangolo.com/benchmarks/\r\n\r\nI believe that when the developers say:\r\n\r\n> Very high performance, on par with NodeJS and Go\r\n\r\nThey mean a full application on Golang or NodeJS (on some framework) vs a Full application on FastAPI. ", "source": "bug_issue", "type": "bug_solution", "issue_number": 25}
{"instruction": "How to fix: Can't read settings .env file", "input": "Not working for me...\r\n\r\n\r\n    db_url=\"postgres\" # .env file\r\n   \r\n    class Settings(BaseSettings):\r\n       db_url: str\r\n\r\n       class Config:\r\n          env_file = \".env\"\r\n\r\n\r\n     settings = Settings()\r\n\r\n  \r\n     @lru_cache()\r\n     def get_settings():\r\n       return {\r\n        \"db_url\": settings.db_url,\r\n     }\r\n\r\nGetting error -> **pydantic.error_wrappers.ValidationError: 1 validation error for Settings db_url field required (type=value_error.missing)**", "output": "Do you have `python-dotenv` installed in your current working environment?\r\n\r\nAlso, try writing `db_url` without quotes, see examples from [`python-dotenv`'s documentation](https://pypi.org/project/python-dotenv/)\r\n\r\n\n\n@ycd Yes I have...I just follow the example here [docs](https://fastapi.tiangolo.com/advanced/settings/#reading-a-env-file)\n\nJust to be sure ... , this script does not run in your setup?\r\n\r\n```python\r\nfrom pydantic import BaseSettings \r\nfrom functools import lru_cache\r\nimport dotenv\r\n\r\n\r\nwith open(\".env\", \"wt\") as fh:\r\n    print(\"db_url=postgres\", file=fh)\r\n\r\n\r\nclass Settings(BaseSettings):\r\n   db_url: str\r\n\r\n   class Config:\r\n      env_file = \".env\"\r\n\r\n\r\nsettings = Settings()\r\n\r\n@lru_cache()\r\ndef get_settings():\r\n   return {\r\n    \"db_url\": settings.db_url,\r\n }\r\n\r\nassert get_settings() == {'db_url': 'postgres'}\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 24}
{"instruction": "How to fix: multipart/form-data: Unable to parse complex types in a request form", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it. -  _**See additional context**_\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [x] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [x] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [x] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n### Example\r\n\r\nHere's a self-contained, [minimal, reproducible, example](https://stackoverflow.com/help/minimal-reproducible-example) with my use case:\r\n\r\n```Python\r\nimport inspect\r\nfrom typing import Dict, Type\r\n\r\nfrom fastapi import Depends, FastAPI, File, Form\r\nfrom pydantic import BaseModel\r\n\r\napp = FastAPI()\r\n\r\n\r\ndef as_form(cls: Type[BaseModel]):\r\n    \"\"\"\r\n    Adds an as_form class method to decorated models. The as_form class method\r\n    can be used with FastAPI endpoints\r\n    \"\"\"\r\n    new_params = [\r\n        inspect.Parameter(\r\n            field.alias,\r\n            inspect.Parameter.POSITIONAL_ONLY,\r\n            default=(Form(field.default) if not field.required else Form(...)),\r\n            annotation=field.outer_type_,\r\n        )\r\n        for field in cls.__fields__.values()\r\n    ]\r\n\r\n    async def _as_form(**data):\r\n        return cls(**data)\r\n\r\n    sig = inspect.signature(_as_form)\r\n    sig = sig.replace(parameters=new_params)\r\n    _as_form.__signature__ = sig\r\n    setattr(cls, \"as_form\", _as_form)\r\n    return cls\r\n\r\n\r\n@as_form\r\nclass Item(BaseModel):\r\n    name: str\r\n    another: str\r\n    opts: Dict[str, int] = {}\r\n\r\n\r\n@app.post(\"/test\", response_model=Item)\r\ndef endpoint(item: Item = Depends(Item.as_form), data: bytes = File(...)):\r\n    print(len(data))\r\n    return item\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    import json\r\n    import os\r\n\r\n    from fastapi.testclient import TestClient\r\n\r\n    tc = TestClient(app)\r\n\r\n    item = {\"name\": \"vivalldi\", \"another\": \"mause\"}\r\n\r\n    data = bytearray(os.urandom(1))\r\n    files = {\"data\": (\"data\", data, \"text/csv\")}\r\n\r\n    r = tc.post(\"/test\", data=item, files=files)\r\n    assert r.status_code == 200\r\n    assert r.json() == {\"name\": \"vivalldi\", \"another\": \"mause\", \"opts\": {}}\r\n\r\n    files[\"opts\"] = (None, json.dumps({\"a\": 2}), \"application/json\")\r\n    r = tc.p", "output": "Try this:\r\n\r\n```python\r\n\r\nimport inspect\r\nfrom typing import Dict, Type, TypeVar, Protocol, Generic, NewType\r\n\r\nfrom fastapi import Depends, FastAPI, File, Form\r\nfrom pydantic import BaseModel, validator, BaseSettings, Json\r\n\r\napp = FastAPI()\r\n\r\nStringId = NewType('StringId', str)\r\n\r\n\r\ndef as_form(cls: Type[BaseModel]):\r\n    \"\"\"\r\n    Adds an as_form class method to decorated models. The as_form class method\r\n    can be used with FastAPI endpoints\r\n    \"\"\"\r\n    new_params = [\r\n        inspect.Parameter(\r\n            field.alias,\r\n            inspect.Parameter.POSITIONAL_ONLY,\r\n            default=(Form(field.default) if not field.required else Form(...)),\r\n        )\r\n        for field in cls.__fields__.values()\r\n    ]\r\n\r\n    async def _as_form(**data):\r\n        return cls(**data)\r\n\r\n    sig = inspect.signature(_as_form)\r\n    sig = sig.replace(parameters=new_params)\r\n    _as_form.__signature__ = sig\r\n    setattr(cls, \"as_form\", _as_form)\r\n    return cls\r\n\r\n\r\n@as_form\r\nclass Item(BaseModel):\r\n    name: str\r\n    another: str\r\n    opts: Json[Dict[str, int]] = '{}'\r\n\r\n\r\n@app.post(\"/test\")\r\nasync def endpoint(item: Item = Depends(Item.as_form)):\r\n    return item.dict()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    import json\r\n    import os\r\n\r\n    from fastapi.testclient import TestClient\r\n\r\n    tc = TestClient(app)\r\n\r\n    item = {\"name\": \"vivalldi\", \"another\": \"mause\"}\r\n\r\n    data = bytearray(os.urandom(1))\r\n    files = {\"data\": (\"data\", data, \"text/csv\")}\r\n\r\n    r = tc.post(\"/test\", data=item, files=files)\r\n    assert r.status_code == 200, r.text\r\n    assert r.json() == {\"name\": \"vivalldi\", \"another\": \"mause\", \"opts\": {}}\r\n\r\n    files[\"opts\"] = (None, json.dumps({\"a\": 2}), \"application/json\")\r\n    r = tc.post(\"/test\", data=item, files=files)\r\n    assert r.status_code == 200\r\n    assert r.json() == {\"name\": \"vivalldi\", \"another\": \"mause\", \"opts\": {\"a\": 2}}\r\n```\r\n\r\nThe main two changes were using the `Json` class from pydantic, and removing the annotation from the as_form method, as otherwise pydantic would be validating the data twice - once for `as_form`, and once for the model itself\n\nHi, I am just wondering why not add something like [this](https://github.com/tiangolo/fastapi/compare/master...tricosmo:patch-1). The error(`type is not dict`) is the value of `Item` comes in as string when it is `multipart/form-data`. This solution also works with nested classes, it also won't unpack all fields of `Item` into form fields, which is not very nice if this `Item` class is a little complicated. Happy to create a PR if this is really a good solution. \n\nThat snippet alone isn't really sufficient, as it doesn't include any pydantic validation. But feel free to submit a pr with appropriate documentation and tests if you think it's worth it.", "source": "bug_issue", "type": "bug_solution", "issue_number": 23}
{"instruction": "How to fix: Your upgrade of 113 broken all gradio apps - a fix needed ASAP this is devastating", "input": "a very basic just gradio having app\r\n\r\nfast api 111 fixes issue\r\n\r\nall of my followers now reporting errors and so hard to fix all\r\n\r\ni don't know how can you publish such a devastating bug having version please fix it ASAP\r\n\r\n\r\n```\r\n2024-09-06 00:12:20,515 - INFO - HTTP Request: GET https://api.gradio.app/gradio-messaging/en \"HTTP/1.1 200 OK\"\r\nRunning on local URL:  http://127.0.0.1:7860\r\n2024-09-06 00:12:20,542 - INFO - HTTP Request: GET http://127.0.0.1:7860/startup-events \"HTTP/1.1 200 OK\"\r\n2024-09-06 00:12:20,552 - INFO - HTTP Request: HEAD http://127.0.0.1:7860/ \"HTTP/1.1 200 OK\"\r\n\r\nTo create a public link, set `share=True` in `launch()`.\r\n2024-09-06 00:12:20,673 - INFO - HTTP Request: GET https://checkip.amazonaws.com/ \"HTTP/1.1 200 \"\r\n2024-09-06 00:12:21,337 - INFO - HTTP Request: GET https://api.gradio.app/pkg-version \"HTTP/1.1 200 OK\"\r\nERROR:    Exception in ASGI application\r\nTraceback (most recent call last):\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\pydantic\\type_adapter.py\", line 209, in __init__\r\n    core_schema = _getattr_no_parents(type, '__pydantic_core_schema__')\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\pydantic\\type_adapter.py\", line 98, in _getattr_no_parents\r\n    raise AttributeError(attribute)\r\nAttributeError: __pydantic_core_schema__\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\uvicorn\\protocols\\http\\h11_impl.py\", line 406, in run_asgi\r\n    result = await app(  # type: ignore[func-returns-value]\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\uvicorn\\middleware\\proxy_headers.py\", line 70, in __call__\r\n    return await self.app(scope, receive, send)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\fastapi\\applications.py\", line 1054, in __call__\r\n    await super().__call__(scope, receive, send)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\starlette\\applications.py\", line 113, in __call__\r\n    await self.middleware_stack(scope, receive, send)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\starlette\\middleware\\errors.py\", line 187, in __call__\r\n    raise exc\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\starlette\\middleware\\errors.py\", line 165, in __call__\r\n    await self.app(scope, receive, _send)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\gradio\\route_utils.py\", line 766, in __call__\r\n    await self.simple_response(scope, receive, send, request_headers=headers)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\gradio\\route_utils.py\", line 782, in simple_response\r\n    await self.app(scope, receive, send)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\starlette\\middleware\\exceptions.py\", line 62, in __call__\r\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\r\n  File \"R:\\Image_Caption_Editor_v6\\venv\\lib\\site-packages\\starlette\\_exception_handler.py\",", "output": "It looks like this latest version broke the vllm project as well:\r\nhttps://github.com/vllm-project/vllm/issues/8212\r\n\r\nNot quite sure how to fix it so just pinning `fastapi == 0.112.2` for now. :-(\n\n> It looks like this latest version broke the vllm project as well: [vllm-project/vllm#8212](https://github.com/vllm-project/vllm/issues/8212)\r\n> \r\n> Not quite sure how to fix it so just pinning `fastapi == 0.112.2` for now. :-(\r\n\r\nit broken literally all of the gradio apps. it is such a devastating bug. i have 10s of apps and updating installers and making all fast api lower version is so problematic\r\n\r\nespecially many apps are remote repos that i use from other people\n\nhttps://github.com/bmaltais/kohya_ss/issues/2783#issuecomment-2332444719", "source": "bug_issue", "type": "bug_solution", "issue_number": 22}
{"instruction": "How to fix: Are there plans to make class-based-views a first-class feature?", "input": "**Description**\r\n\r\nHi @tiangolo! First off kudos on FastAPI, beautiful stuff. My team (about a dozen backenders, pinging one here @gvbgduh) are in the midst of porting out Py2 services to Py3 and thought it'd be a good time to move away from Flask and Flask-RESTful and into something that makes better use of the Py3 features (predominantly async). Thus far FastAPI/Starlette is the top contender but the one feature we're missing the most is class-based-views (CBVs) as opposed to the defacto function-based-views (FBVs). Thus we were wondering if there's any plans to introduce CBVs as a first-class feature in FastAPI.\r\n\r\nWhile we know Starlette plays well with CBVs we looove the automagical features FastAPI offers like validation, OpenAPI generation, etc, things we had to do in very round-about ways prior.\r\n\r\nWay we see it CBVs have the following primary perks:\r\n- Centralised routing since you tend to declare the different routes in one place, typically after instantiating the application.\r\n- Code reusability since you can easily do OOP and inherit (eg through mixins) or compose common functionality around.\r\n- Would make it much easier to port existing CBVs to FastAPI since we'd be coming from Flask-RESTful.\r\n\r\nThus far we've found we can 'hack' CBVs into FastAPI as such:\r\n\r\n```\r\nfrom typing import Dict\r\n\r\nimport fastapi\r\nfrom starlette.endpoints import HTTPEndpoint\r\n\r\nfrom app.services.api.models import Something\r\n\r\n\r\napp = fastapi.FastAPI(debug=True)\r\n\r\n\r\nclass ResourceRoot(HTTPEndpoint):\r\n    def get(self):\r\n        # do stuff\r\n\r\n\r\nclass ResourceSomething(HTTPEndpoint):\r\n\r\n    def get(self, some_id: str) -> Dict:\r\n        # do stuff\r\n\r\n    def post(self, something: Something) -> None:\r\n        # do stuff\r\n\r\n\r\nresource_root = ResourceRoot(scope={\"type\": \"http\"})\r\nresource_something = ResourceSomething(scope={\"type\": \"http\"})\r\napp.add_api_route(\r\n    path=\"/\",\r\n    endpoint=resource_root.get,\r\n    methods=[\"GET\"],\r\n)\r\napp.add_api_route(\r\n    path=\"/something\",\r\n    endpoint=resource_something.post,\r\n    methods=[\"POST\"]\r\n)\r\napp.add_api_route(\r\n    path=\"/something/{some_id}\",\r\n    endpoint=resource_something.get,\r\n    methods=[\"GET\"]\r\n)\r\n```\r\n\r\nand as far as we can tell we're maintaining the FastAPI fanciness but it might be a little confusing for our devs. Is there a better way to do this?", "output": "I also want this feature. Great, support!\n\nFWIW, I'm looking for this feature because I have a HTTP header I need to pass through to external APIs - right now I'm passing it through a bunch of different functions, would be nice to have a class so I can just do `self.my_header = whatever` and just pass in `self.my_header` where I need to.\n\n@knyghty wouldn't a middleware make more sense there?", "source": "bug_issue", "type": "bug_solution", "issue_number": 21}
{"instruction": "How to fix: Context managers in `Depends` are broken after 0.106", "input": "### Discussed in https://github.com/tiangolo/fastapi/discussions/11107\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **FeeeeK** February  7, 2024</sup>\r\n### First Check\r\n\r\n- [X] I added a very descriptive title here.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/pydantic/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n```python\r\nfrom fastapi import Depends, FastAPI, Request\r\n\r\napp = FastAPI()\r\n\r\n\r\nclass Session:\r\n    def __init__(self):\r\n        print(\"creating session\")\r\n\r\n    async def __aenter__(self):\r\n        print(\"opening session\")\r\n        return self\r\n\r\n    async def __aexit__(self, exc_type, exc, tb):\r\n        print(\"closing session\")\r\n\r\n    async def commit(self):\r\n        print(\"committing session\")\r\n\r\n    async def rollback(self):\r\n        print(\"rolling back session\")\r\n\r\n\r\n@app.middleware(\"http\")\r\nasync def commit_session(request: Request, call_next):\r\n    # minimalistic middleware for example, my code uses ASGI middleware\r\n    response = await call_next(request)\r\n    db_session = request.scope.get(\"db_session\")\r\n    if not db_session:\r\n        return response\r\n\r\n    if response.status_code // 200 != 1:\r\n        await db_session.rollback()\r\n    else:\r\n        await db_session.commit()\r\n\r\n    return response\r\n\r\n\r\nasync def get_db_session(request: Request):\r\n    async with Session() as session:\r\n        request.scope[\"db_session\"] = session\r\n        yield session\r\n\r\n\r\n@app.get(\"/\")\r\nasync def root(session: Session = Depends(get_db_session)):\r\n    return {\"message\": \"Hello World\"}\r\n\r\n\r\n# Pre 0.106 behaviour:\r\n\r\n# creating session\r\n# opening session\r\n# committing session\r\n# closing session\r\n\r\n# Post 0.106 behaviour:\r\n# creating session\r\n# opening session\r\n# closing session\r\n# committing session\r\n\r\n# The session is not committed, because it's closed before the middleware is called.\r\n```\r\n\r\n\r\n### Description\r\n\r\nBefore `0.106`, Depends execution after yield was after middlewares, which allowed to access resources created for a route (e.g. sessions) and do something with them depending on the response (which cannot be done with Depends), but after 0.106, the behavior has changed and this feature is no longer available. The documentation only talks about background tasks, but not a word about middlewares. Was this behavior change intentional?\r\n\r\n### Operating Syst", "output": "I [commented](https://github.com/tiangolo/fastapi/discussions/11107#discussioncomment-8459459) in the Discussion that `StreamingResponse`'s no longer work with `Depends` resources. Since this is a pretty large change in behavior, and wasn't called out in the release notes, I wonder if this is intended. Should this be a separate Issue?\n\n> I [commented](https://github.com/tiangolo/fastapi/discussions/11107#discussioncomment-8459459) in the Discussion that `StreamingResponse`'s no longer work with `Depends` resources. Since this is a pretty large change in behavior, and wasn't called out in the release notes, I wonder if this is intended. Should this be a separate Issue?\r\n\r\nNo. The only reason I created this issue is because of your comment. üôè \n\nDoes this comment by @tiangolo answers this issue: https://github.com/tiangolo/fastapi/discussions/11177#discussioncomment-8559300 ?", "source": "bug_issue", "type": "bug_solution", "issue_number": 20}
{"instruction": "How to fix: Using pydantic models for GET request query params? Currently not possible, have to use dataclasses or normal classes.", "input": "**Description**\r\n\r\nIs there a way to use pydantic models for GET requests? I would like to have a similar interface for both query params and for the body. So for instance, an example could look like this:\r\n\r\n```\r\nclass PingArgs(BaseModel):\r\n    \"\"\"Model input for PingArgs.\"\"\"\r\n\r\n    dt: datetime.datetime = ...\r\n    to_sum: List[int] = ...\r\n\r\n    @validator(\"dt\", pre=False, always=True, whole=True)\r\n    def validate_dt(cls, v, values):\r\n        \"\"\"Validate dt.\"\"\"\r\n        parsed_dt = v.replace(tzinfo=None)\r\n        return parsed_dt\r\n\r\n@router.get(\"/ping\", tags=[\"basic\"])\r\ndef ping(args: PingArgs, request: Request):\r\n    \"\"\"Example.\"\"\"\r\n    return JSONResponse(\r\n        status_code=starlette.status.HTTP_200_OK,\r\n        content={\"detail\": \"pong\", \"dt\": args.dt.isoformat() \"summed\": sum(x for x in args.to_sum)},\r\n    )\r\n```\r\n\r\nWhere as, right now I think you would have to do something like this:\r\n\r\n```\r\n@router.get(\"/ping\", tags=[\"basic\"])\r\ndef ping(dt: datetime.datetime = Query(None), to_sum: List[int] = Query(None), request: Request):\r\n    \"\"\"Example.\"\"\"\r\n    parsed_dt = dt.replace(tzinfo=None)\r\n    \r\n    return JSONResponse(\r\n        status_code=starlette.status.HTTP_200_OK,\r\n        content={\"detail\": \"pong\", \"dt\": dt.isoformat() \"summed\": sum(x for x in to_sum)},\r\n    )\r\n```\r\n\r\nHope this can be clarified.", "output": "@LasseGravesen the problem is that GET operations don't have a body: https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET\r\n\r\nThe Pydantic body you are defining in the first example is not equivalent to the query parameters in the second.\r\n\r\nThat Pydantic model would require a JSON body with something like:\r\n\r\n```JSON\r\n{\r\n  \"dt\": \"2019-06-20T01:02:03+05:00\",\r\n  \"to_sum\": [2, 3, 4]\r\n}\r\n```\r\n\r\nBut what you can do, to avoid having to put all the parameters in each path operation, is to create a dependency, it would require the query parameters as you have them, and then you can put them in a Pydantic model with the shape you want, and it would return that Pydantic model.\r\n\r\nOr even shorter, you can create a class dependency, check a very similar example in the docs: https://fastapi.tiangolo.com/tutorial/dependencies/classes-as-dependencies/\n\n@tiangolo \r\nIt would not be a body, it would just be GET parameters as defined in a model. For instance, I come from the perspective of Flask and webargs, where you can define a 'model' and use that with the same interface for both GET and POST parameters, see for instance here:\r\n\r\nhttps://github.com/marshmallow-code/webargs/blob/dev/examples/flask_example.py#L23-L34\r\n\r\nThat is not a body, but rather it puts the GET query parameters into a model.\r\n\r\nI'll look into dependencies, but I hope you'll consider the above.\n\nDependencies might work, is there any reason why we couldn't use a pydantic class as a dependency?", "source": "bug_issue", "type": "bug_solution", "issue_number": 19}
{"instruction": "How to fix: BrokenResourceError", "input": "### First Check\r\n\r\n- [X] I added a very descriptive title to this issue.\r\n- [X] I used the GitHub search to find a similar issue and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [x] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\napp.py\r\n```python\r\nimport time\r\nimport uvicorn\r\nfrom fastapi import FastAPI, Request\r\nfrom fastapi.middleware.cors import CORSMiddleware\r\n\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.middleware(\"http\")\r\nasync def middleware(request: Request, call_next):\r\n    return await call_next(request)\r\n\r\n\r\n@app.get(\"/\")\r\ndef read_root():\r\n    time.sleep(4)\r\n    return {\"Hello\": \"World\"}\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    uvicorn.run(app=\"app:app\", port=8000)\r\n```\r\nscript.py\r\n```python\r\nimport requests as requests\r\n\r\nr = requests.get(f\"http://127.0.0.1:8000\", timeout=2)\r\n```\r\n\r\n### Description\r\nIf you trigger script.py, error will appear.\r\nAfter upgrade fastapi to 0.70.0 In some requests in our application its apearing this error.  So what we can do? What is problem?\r\n```\r\nERROR:    Exception in ASGI application\r\nTraceback (most recent call last):\r\n  File \"venv/lib/python3.8/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 398, in run_asgi\r\n    result = await app(self.scope, self.receive, self.send)\r\n  File \"venv/lib/python3.8/site-packages/uvicorn/middleware/proxy_headers.py\", line 45, in __call__\r\n    return await self.app(scope, receive, send)\r\n  File \"venv/lib/python3.8/site-packages/fastapi/applications.py\", line 208, in __call__\r\n    await super().__call__(scope, receive, send)\r\n  File \"venv/lib/python3.8/site-packages/starlette/applications.py\", line 112, in __call__\r\n    await self.middleware_stack(scope, receive, send)\r\n  File \"venv/lib/python3.8/site-packages/starlette/middleware/errors.py\", line 181, in __call__\r\n    raise exc\r\n  File \"venv/lib/python3.8/site-packages/starlette/middleware/errors.py\", line 159, in __call__\r\n    await self.app(scope, receive, _send)\r\n  File \"venv/lib/python3.8/site-packages/starlette/middleware/base.py\", line 57, in __call__\r\n    task_group.cancel_scope.cancel()\r\n  File \"venv/lib/python3.8/site-packages/anyio/_backends/_asyncio.py\", line 567, in __aexit__\r\n    raise exceptions[0]\r\n  File \"venv/lib/python3.8/site-packages/starlette/middleware/base.py\", line 30, in coro\r\n    await self.app(scope, request.receive, send_stream.send)\r\n  File \"venv/lib/python3.8/site-packages/starlette/except", "output": "This looks like a starlette issue: https://github.com/encode/starlette/issues/1284\n\n```\r\nException in ASGI application\r\nBrokenResourceError: null\r\n  File \"uvicorn/protocols/http/h11_impl.py\", line 373, in run_asgi\r\n    result = await app(self.scope, self.receive, self.send)\r\n  File \"uvicorn/middleware/proxy_headers.py\", line 75, in __call__\r\n    return await self.app(scope, receive, send)\r\n  File \"fastapi/applications.py\", line 208, in __call__\r\n    await super().__call__(scope, receive, send)\r\n  File \"starlette/applications.py\", line 112, in __call__\r\n    await self.middleware_stack(scope, receive, send)\r\n  File \"starlette/middleware/errors.py\", line 181, in __call__\r\n    raise exc\r\n  File \"starlette/middleware/errors.py\", line 159, in __call__\r\n    await self.app(scope, receive, _send)\r\n  File \"starlette/middleware/base.py\", line 57, in __call__\r\n    task_group.cancel_scope.cancel()\r\n  File \"anyio/_backends/_asyncio.py\", line 567, in __aexit__\r\n    raise exceptions[0]\r\n  File \"starlette/middleware/base.py\", line 30, in coro\r\n    await self.app(scope, request.receive, send_stream.send)\r\n  File \"starlette/exceptions.py\", line 82, in __call__\r\n    raise exc\r\n  File \"starlette/exceptions.py\", line 71, in __call__\r\n    await self.app(scope, receive, sender)\r\n  File \"starlette/routing.py\", line 656, in __call__\r\n    await route.handle(scope, receive, send)\r\n  File \"starlette/routing.py\", line 259, in handle\r\n    await self.app(scope, receive, send)\r\n  File \"starlette/routing.py\", line 64, in app\r\n    await response(scope, receive, send)\r\n  File \"starlette/responses.py\", line 139, in __call__\r\n    await send({\"type\": \"http.response.body\", \"body\": self.body})\r\n  File \"starlette/exceptions.py\", line 68, in sender\r\n    await send(message)\r\n  File \"anyio/streams/memory.py\", line 205, in send\r\n    raise BrokenResourceError\r\n```\r\n### Operating System\r\nLinux\r\n### FastAPI Version\r\n0.70.0\r\n\r\n### Python Version\r\n3.9.7\r\n\n\nI have the same problem, this is my code:\r\n\r\n**main.py**\r\n```python\r\n# -*- coding: utf-8 -*-\r\n\r\n\r\nfrom fastapi import FastAPI, Request\r\nfrom fastapi.responses import JSONResponse\r\nfrom fastapi.encoders import jsonable_encoder\r\nfrom pony.orm import *\r\n\r\nfrom models_pony.name_basics import NameBasics as pn_name_basics\r\n\r\napi = FastAPI() \r\n\r\n\r\n@api.middleware('http')\r\nasync def process_request(request: Request, call_next):\r\n    return await call_next(request)\r\n\r\n\r\n@api.get('/namebasics/id/{id}')\r\nasync def get_namebasic_by_id(id:int):\r\n    with db_session:\r\n         result = (pn_name_basics[id]).to_dict()\r\n    return JSONResponse(result)\r\n\r\n\r\n\r\n@api.get('/namebasics/ncost/{ncost}')\r\nasync def get_namebasic_by_ncost(ncost:str):\r\n    with db_session:\r\n        result = (pn_name_basics.get(ncost=ncost)).to_dict()\r\n    return JSONResponse(result)\r\n\r\n\r\n\r\n@api.get('/namebasics/year/{year}')\r\nasync def get_namebasic_by_year(year:str):\r\n    with db_session:\r\n        results = select(p for p in pn_name_basics if p.birth_year == year)[:]\r\n        _results = [i.to_dict() for i in results]\r\n        _results = jsonable_encoder(_results)\r\n    return JSONResponse(_results)\r\n\r\n\r\n\r\n@api.get('/namebasics/yearalive/{yearalive}')\r\nasync def get_namebasic_by_yearalive(yearalive:str):\r\n    with db_session:\r\n        results = select(p for p in pn_name_basics if p.birth_year == yearalive and p.death_year is None)[:]\r\n        _results = [i.to_dict() for i in results]\r\n        _results = jsonable_encoder(_results)\r\n    return JSONResponse(_results)\r\n```\r\n\r\n**Command terminal test**\r\n```\r\nwrk --duration 20s --threads 2 --connections 5 http://0.0.0.0:8000/namebasics/id/1024\r\nRunning 20s test @ http://0.0.0.0:8000/namebasics/id/1024\r\n  2 threads and 5 connections\r\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\r\n    Latency     8.54ms    9.84ms 112.06ms   91.46%\r\n    Req/Sec   289.56    154.88   565.00     59.00%\r\n  11538 requests in 20.05s, 3.66MB read\r\nRequests/sec:    575.56\r\nTransfer/sec:    187.17KB\r\n```\r\n\r\n**Error**\r\n```\r\n[2021-10-20 01:50:45 +0000] [5117] [ERROR] Exception in ASGI application\r\nTraceback (most recent call last):\r\n  File \"/lxcshared/benchmark.git/Python/src/.venv/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 375, in run_asgi\r\n    result = await app(self.scope, self.receive, self.send)\r\n  File \"/lxcshared/benchmark.git/Python/src/.venv/site-packages/uvicorn/middleware/proxy_headers.py\", line 75, in __call__\r\n    return await self.app(scope, receive, send)\r\n  File \"/lxcshared/benchmark.git/Python/src/.venv/site-packages/fastapi/applications.py\", line 208, in __call__\r\n    await super().__call__(scope, receive, send)\r\n  File \"/lxcshared/benchmark.git/Python/src/.venv/site-packages/starlette/applications.py\", line 112, in __call__\r\n    await self.middleware_stack(scope, receive, send)\r\n  File \"/lxcshared/benchmark.git/Python/src/.venv/site-packages/starlette/middleware/errors.py\", line 181, in __call__\r\n    raise exc\r\n  File \"/lxcshared/benchmark.git/Python/src/.venv/site-packages/starlette/middlewar", "source": "bug_issue", "type": "bug_solution", "issue_number": 18}
{"instruction": "How to fix: Dependency Injection - Singleton?", "input": "**Don't you think the dependency injection framework needs a singleton type?**\r\n\r\nI checked the documentation and as I can see there is no option for creating a class as a singleton. If I want to pass in a class as a dependency it will be created every time. So a feature to create singleton and if that already exists just pass it in as a dependency would be great. Because if you create a huge dependency tree than you have to specify one-by-one to make singletons. \r\n\r\nMaybe I missed something how to do that but if not that could be a new feature.", "output": "I think the easiest way to achieve this would be to put a `functools.lru_cache` on a function that returns an instance of the class, and use that as your dependency. Would that work for you?\r\n\r\nIf that doesn‚Äôt work for you there may be another (related) approach that does (likely involving the metaclass), but I don‚Äôt see why this should be a fastapi feature if you can just make the class itself a singleton.\n\ncan't remember for certain but I thought @tiangolo had implemented a cache mechanism for dependencies where it's called only once, am I confused ?\n\nseems like it's in [0.28](https://github.com/tiangolo/fastapi/releases/tag/0.28.0) is there a difference with what you want to achieve ? I may have misunderstood the goal obviously, but it seems like it's called once already", "source": "bug_issue", "type": "bug_solution", "issue_number": 17}
{"instruction": "How to fix: Use of socket.io", "input": "**Description**\r\n\r\nHow can I use socket.io instead of the plain websocket integration? I guess this is more a question belonging to starlette.\r\n\r\nCurrently migrating from a flask application using flask-socketio / python-socketio\r\n\r\nAny hint is appreciated. Thx.", "output": "Socket-IO has an ASGI compatible app: https://python-socketio.readthedocs.io/en/latest/server.html#uvicorn-daphne-and-other-asgi-servers\r\n\r\nYou should be able to mount that app like if it was a FastAPI sub-application: https://fastapi.tiangolo.com/tutorial/sub-applications-proxy/#mount-the-sub-application\n\nHi,\r\n\r\nAlso have a question regarding python-socketio, Ive tried:\r\n\r\n ```\r\nsio = socketio.AsyncServer(async_mode='asgi')\r\nsio_asgi_app = socketio.ASGIApp(sio, app)\r\napp.mount(\"/api/socket.io\", sio_asgi_app)\r\n```\r\n\r\nWhich does indeed seem to work, but only partially. Only GET requests seems to get through \r\nand POST's are somehow blocked, I get:\r\n\r\n```\r\nINFO:uvicorn:('127.0.0.1', 51888) - \"GET /api/socket.io/ HTTP/1.1\" 200\r\nINFO:uvicorn:('127.0.0.1', 51890) - \"POST /api/socket.io/ HTTP/1.1\" 405\r\n```\r\nIs there a way to also allow POST on `/api/socket.io/` ?\r\n\r\nThanks\r\n\n\nI am unable to get this to work at all, even with the snippet above.", "source": "bug_issue", "type": "bug_solution", "issue_number": 16}
{"instruction": "How to fix: using external oAuth providers", "input": "Hi,\r\n\r\nFirst of all, thank you for all the amazing work you've done with FastAPI. I'm just scratching the surface and I'm already amazed by what you're able to do right out of the box.\r\n\r\nAs for my question, At my institute we use a centralized authentication service for all webapps base on [ORY Hydra](https://github.com/ory/hydra). Is there an easy way built in to integrate an external server to authenticate again and use the token query the API?\r\n\r\nThanks\r\nM", "output": "To clarify, the app structure should look a bit like this (super simplified)\r\n\r\n![image](https://user-images.githubusercontent.com/11850640/51682864-bf11cf80-1fe8-11e9-8d7c-fea1fc3d2801.png)\r\n\r\n\r\nCheers\r\nM\n\nHey @matthdsm ,\r\n\r\nThis particular set of docs and examples should get you pretty far:\r\n\r\nhttps://fastapi.tiangolo.com/tutorial/security/simple-oauth2/ \r\nhttps://fastapi.tiangolo.com/tutorial/security/oauth2-jwt/\r\n\r\nYou also get an interactive way to test all this out too. \r\n![image](https://user-images.githubusercontent.com/13604961/51725656-9a8e1580-2031-11e9-8042-d4d1ff6601ad.png)\r\n(taken from the docs above)\r\n\r\nThe only piece missing (I assume, based on  your chart) would be an ```async def``` that implements a request to your external service to check the token and user. If it were me, I'd swap out the parts I need from this guy:\r\n\r\n```python\r\nasync def get_current_user(token: str = Security(oauth2_scheme)):\r\n    try:\r\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\r\n        token_data = TokenPayload(**payload)\r\n    except PyJWTError:\r\n        raise HTTPException(\r\n            status_code=HTTP_403_FORBIDDEN, detail=\"Could not validate credentials\"\r\n        )\r\n\r\n    #use something like requests.get and pass your payload here probably\r\n    user = get_user(fake_users_db, username=token_data.username)\r\n    return user\r\n```\r\n\r\n\r\nSide note: if you're coming from Django or Flask, most people reuse or enforce auth using the decorator pattern (i.e. @requires_auth). @tiangolo 's examples above show a much easier and traceable way using ```Depends```. It's _**asynchronous time-traveling chain-lightning black magic**_ and it totally rocks imo. I bring this up because you may want to reuse parts of it in your auth flow too.\r\n\r\nHope that helps, but I'll stick around if you run into probs or have more specific questions.\n\n> First of all, thank you for all the amazing work you've done with FastAPI. I'm just scratching the surface and I'm already amazed by what you're able to do right out of the box.\r\n\r\nThat's awesome to hear @matthdsm !\r\n\r\nAlso, thanks for taking the time to create the diagram and explain the use case so clearly.\r\n\r\n@rcox771 Awesome response! Thanks for sticking around and helping here :smile: :taco: \r\n\r\n> It's **asynchronous time-traveling chain-lightning black magic** and it totally rocks imo.\r\n\r\nLoved that, I'm citing it :joy: :grin: \r\n\r\n---\r\n\r\nSome more info:\r\n\r\nPretty much what @rcox771 explained.\r\n\r\nLet's say the function `get_user` doesn't take the parameters in the example, and actually goes and calls Hydra's [OpenId Connect UserInfo](https://www.ory.sh/docs/next/hydra/sdk/api#openid-connect-userinfo) endpoint, most probably using [Requests](http://docs.python-requests.org/en/master/), and then returns a Pydantic model with the user data (if you use a Pydantic model you can have all the completion, type checks, etc). Then you pretty much have the rest already from those examples.\r\n\r\nOne little detail: as Requests doesn't use `async` in the current versions, you would declare `def get_current_user` with a normal `def` instead of `async def`.\r\n\r\n---\r\n\r\nMore technical details (this is about to get pretty technical with specs stuff):\r\n\r\nSpecifically for your use case that is a bit more \"elaborate\", FastAPI has some other utilities that you can use for advanced OAuth2 flows, that are not in the tutorials but are there available for these cases.\r\n\r\nThe tutorials use the OAuth2 Password Flow. Which is the one appropriate when the same FastAPI application is the \"Authorization Server\" and the \"Resource Server\" (using [OAuth 2.0 spec terms](https://tools.ietf.org/html/rfc6749)). That's the simplest case that works for the simplest/more common scenarios.\r\n\r\nIn your case, your FastAPI application would be the \"Resource Server\", but Hydra would be the \"Authorization Server\".\r\n\r\nIn this case, you would probably use the \"Authorization Code\" or the \"Impicit\" OAuth 2.0 flows.\r\n\r\nAs Hydra is OpenId Connect compatible, you might want to use [`fastapi.security.open_id_connect_url.OpenIdConnect`](https://github.com/tiangolo/fastapi/blob/master/fastapi/security/open_id_connect_url.py#L8).\r\n\r\nAnd instead of using `OAuth2PasswordBearer`, you would use [`OAuth2`](https://github.com/tiangolo/fastapi/blob/master/fastapi/security/oauth2.py#L114) directly.\r\n\r\n`OAuth2` receives a `flows` parameter with your OAuth 2.0 flows, you can define them as a simple dictionary, but also using the included Pydantic models...\r\n\r\nFastAPI, although not documented, includes Pydantic models for the whole OpenAPI 3.0 spec, this might help you if you want to use completion, etc during development. And it includes, of course, all the models for OAuth 2.0 flows, etc. You can use them from here: https://github.com/tiangolo/fastapi/blob/master/fastapi/openapi/models.py#L291\r\n\r\nThere are models for all the OAuth 2.0 flows, also made to match the OpenAPI 3.0 spec (and the way it's sub-divided in sections):\r\n\r\n* `OAuthFl", "source": "bug_issue", "type": "bug_solution", "issue_number": 15}
{"instruction": "How to fix: Passing UploadFile objects into a StreamingResponse closes it in v0.106.0 but not v0.105.0", "input": "### Discussed in https://github.com/tiangolo/fastapi/discussions/10856\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **adrwz** December 28, 2023</sup>\r\n### First Check\r\n\r\n- [X] I added a very descriptive title here.\r\n- [X] I used the GitHub search to find a similar question and didn't find it.\r\n- [X] I searched the FastAPI documentation, with the integrated search.\r\n- [X] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n- [X] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n- [X] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/pydantic/pydantic).\r\n- [X] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n- [X] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n\r\n### Commit to Help\r\n\r\n- [X] I commit to help with one of those options üëÜ\r\n\r\n### Example Code\r\n\r\n```python\r\nasync def upload_file_event(files: List[UploadFile]):\r\n    print(\"2\", files[0].filename, files[0].file._file.closed)\r\n\r\n    # ... more code ...\r\n\r\n\r\n@router.post(\"/upload_session_file\")\r\nasync def upload_file(files: List[UploadFile] = File(...)):\r\n    print(\"1\", files[0].filename, files[0].file._file.closed)\r\n\r\n    try:\r\n        return StreamingResponse(\r\n            upload_file_event(files),\r\n            media_type=\"text/event-stream\",\r\n        )\r\n    except Exception as error:\r\n        logging.error(error)\r\n        raise HTTPException(status_code=500, detail=\"Internal Server Error\")\r\n```\r\n\r\n\r\n### Description\r\n\r\nHitting this endpoint with an uploaded file on v0.105.0 will print:\r\n\r\n```\r\n1 filename false\r\n2 filename false\r\n```\r\n\r\nHitting this endpoint with an uploaded file on v0.106.0 will print:\r\n\r\n```\r\n1 filename false\r\n2 filename true\r\n```\r\n\r\nUnfortunately this means I'm unable to upload files in a StreamingResponse with fastapi>=0.106.0\r\n\r\n### Operating System\r\n\r\nmacOS\r\n\r\n### Operating System Details\r\n\r\n_No response_\r\n\r\n### FastAPI Version\r\n\r\n0.105.0\r\n\r\n### Pydantic Version\r\n\r\n2.5.3\r\n\r\n### Python Version\r\n\r\n3.11.4\r\n\r\n### Additional Context\r\n\r\n_No response_</div>", "output": "Is there any update on this issue? I have the same problem , just migrated from `v0.103.0` to `v0.108.0` and realized my tests are failing due the same issue. Is is related to [this breaking change](https://fastapi.tiangolo.com/release-notes/#01060)? \r\nIf yes, what is the proposed approach for handling the UploadFile in the background task?\r\nmy old practice is written below\r\n``` python\r\n\r\nasync def upload_csv_to_gcloud_blob_storage(\r\n    self, file: UploadFile, bucket_name: str, blob_storage_path:str\r\n):\r\n    \"\"\"write the data to a bucket with\"\"\"\r\n    storage_client = storage.Client()\r\n    csv_bucket = storage_client.bucket(bucket_name)\r\n    blob = csv_bucket.blob(blob_storage_path)\r\n\r\n    try:\r\n        with blob.open(\"wb\") as buffer:\r\n            shutil.copyfileobj(file.file, buffer)\r\n    finally:\r\n        file.file.close()\r\n            \r\n@app.post( \"/csv_tables\" )\r\nasync def upload_csv(\r\n    csv_file: Annotated[UploadFile, File()],\r\n    background_tasks: BackgroundTasks,\r\n):\r\n  \r\n    background_tasks.add_task(\r\n        upload_csv_to_gcloud_blob_storage,\r\n        csv_file=csv_file,\r\n        bucket_name=\"csv\",\r\n        blob_storage_path=\"csv_path\",\r\n    )\r\n    return \"OK\"\r\n```\r\n\n\nWe ran into this issue. Calling `file.read()` in code our began raising an error after upgrading fastapi: `ValueError: I/O operation on closed file.`\n\nI'm having similar issue with a tempfile I'm yielding....\r\n\r\n```\r\ndef create_temp_file():\r\n    fd, path = tempfile.mkstemp(suffix='.csv')\r\n    try:\r\n        yield fd, path\r\n    finally:\r\n        os.unlink(path)\r\n```\r\n\r\n\r\nWhen I try to return the file in a FileResponse I hit:\r\n`RuntimeError(f\"File at path {self.path} does not exist.\")`", "source": "bug_issue", "type": "bug_solution", "issue_number": 14}
{"instruction": "How to fix: Provide timing data for things FastAPI does outside of user code", "input": "**Is your feature request related to a problem? Please describe.**\r\nI currently find myself using FastAPI as an API frontend for a database running queries of varying levels of complexity that usually return fairly large quantities of data. The problem I have is that, when attempting to figure out why an API request is taking time to respond, there's a lot going on outside of what fencing the code inside your route with the usual `time_start = time.time()`, `time_delta = time.time() - time_start` won't tell you.\r\n\r\nIn your average FastAPI application, there's 4 main causes for slowdowns:\r\n* Endpoint code running (app)\r\n* Waiting for the database (io)\r\n* Data validation (pydantic)\r\n* Data serialization (json/ujson)\r\n\r\nOf those 4, only the first two are actually part of the user code, the other two are handled behind the scenes by FastAPI. If I'm testing a route that's returning 50MBs of JSON (for whatever reason), it's actually rather tricky to determine whether switching from `json` to `ujson` or `orjson` will have any performance benefit or if the slowdown is coming from Pydantic choking on the sheer amount of data being fed to it or the database being slow.\r\n\r\n**Describe the solution you'd like**\r\nGiven FastAPI is performing operations outside of what the user can observe or measure, it should probably expose timing data for those things in some way (especially validation and serialization, since I doubt routing is going to factor a lot in the processing time). I don't know how the implementation should go, though, given any middleware is only going to receive a Starlette `Response` object and FastAPI probably shouldn't be doing this sort of thing automatically anymore than it does with CORS. The `Response` object could probably be extended in some way to contain some sort of `timing` dict, though that's sure to cause all sorts of compatibility issues, so I don't know whether that can be done without some upstream work with Starlette.\r\n\r\n**Describe alternatives you've considered**\r\nI was initially trying to write a middleware for this, but python's own `cProfile` is limited to text file export, so processing the data in Python becomes an extra hurdle, if the format is even stable enough for that. Without using a profiler, ASGI middlewares simply don't have access to timing information for the app besides the total time spent `await`ing the callable.\r\n\r\n**Additional context**\r\nThe recently introduced [`Server-Timing`](https://w3c.github.io/server-timing/#the-server-timing-header-field) HTTP header seems like a perfect way to push coarse profiling information to make debugging those cases somewhat easier, especially given how it's [supported in the Chrome devtools](https://twitter.com/paul_irish/status/829090506084749312) and that [Firefox support for it is just around the corner](https://bugzilla.mozilla.org/show_bug.cgi?id=1403051). That's probably beyond the scope of that issue, though.", "output": "A couple tangential profiling-related notes that may be of interest to anyone working with \"50MBs of JSON\"-sized payloads:\r\n<details>\r\n    <summary>Click to expand</summary>\r\n\r\n* Serialization may *also* involve two (potentially very costly!) steps: 1) if specifying a `response_model`, where the returned data is parsed into the `response_model`, and 2) in all cases unless you return a `Response` directly, where `fastapi.encoders.jsonable_encoder` is used to convert your output to json.\r\n    * For payloads with long lists or dicts with many keys this function call is not cheap, and unless you return a `Response` or one of its subclasses from your endpoint, in most cases, the cost of `jsonable_encoder` will probably dwarf the call to `json.dumps` or faster alternatives from other packages.\r\n* For faster creation of pydantic model instances, consider using `BaseModel.construct` if you *know* the input data doesn't require parsing (e.g., whenever you perform the instantiation yourself in a type-safe way, rather than relying on fastapi's parsing machinery).\r\n    * I profiled this method at ~30-40x faster than calls to `BaseModel.__init__`, even for relatively small payloads.\r\n    * The API is a little awkward in pydantic v0.32.2 since you have to pass the values as a dict (and have to specify the fields set), but starting in v1 it has the same API as the `__init__` calls and is even type-checked by the pydantic mypy plugin (a good reason for FastAPI to update to pydantic v1 as soon as possible!).\r\n</details>\r\n\r\n-----\r\n\r\nAddressing the main point brought up in this issue, I think it might be worth looking into [yappi](https://github.com/sumerc/yappi) -- if you look at the docs for the [get_func_stats](https://github.com/sumerc/yappi/blob/master/doc/api.md#get_func_statsfilternone) function and the [YFuncStat](https://github.com/sumerc/yappi/blob/master/doc/api.md#yfuncstat) class, it looks like it should be relatively easy to package up the profiling results inside an ASGI middleware. (Also, for what it's worth, it has built-in support in PyCharm.)\r\n\r\nI'm not very familiar with the `Server-Timing` header, but based on a quick skim of the linked docs, it seems that such a yappi ASGI middleware could return Server-Timing headers for each of its YFuncStat instances, presumably with some (configurable) filtering and formatting. (Obviously it could also just log the results to the console.)\r\n\r\n\n\n> A couple tangential profiling-related notes that may be of interest to anyone working with \"50MBs of JSON\"-sized payloads:\r\n\r\nAh, that's interesting, I'd usually just build my own `RawJSONResponse` class and handle json conversion on my own so I could bypass Pydantic entirely, but this is certainly much cleaner if you trust your input source.\r\n\r\n> Addressing the main point brought up in this issue, I think it might be worth looking into [yappi](https://github.com/sumerc/yappi) -- if you look at the docs for the [get_func_stats](https://github.com/sumerc/yappi/blob/master/doc/api.md#get_func_statsfilternone) function and the [YFuncStat](https://github.com/sumerc/yappi/blob/master/doc/api.md#yfuncstat) class, it looks like it should be relatively easy to package up the profiling results inside an ASGI middleware. (Also, for what it's worth, it has built-in support in PyCharm.)\r\n> \r\n> I'm not very familiar with the `Server-Timing` header, but based on a quick skim of the linked docs, it seems that such a yappi ASGI middleware could return Server-Timing headers for each of its YFuncStat instances, presumably with some (configurable) filtering and formatting. (Obviously it could also just log the results to the console.)\r\n\r\nThanks for pointing out yappi. I've tried the middleware solution with it, and while it's working well enough, it runs into the issue where, since profiling is global, if a route is called while another one is running, the profiler gets confused and the resulting profiling data will be incorrect or missing.\r\n\r\n```py\r\nfrom starlette.middleware.base import BaseHTTPMiddleware\r\nfrom starlette.responses import Response\r\nfrom starlette.requests import Request\r\n\r\nimport fastapi\r\nimport json\r\nimport sqlalchemy\r\n\r\nimport yappi\r\n\r\nclass BenchMiddleware(BaseHTTPMiddleware):\r\n    async def dispatch(self, request: Request, call_next) -> Response:\r\n        yappi.start()\r\n        response = await call_next(request)\r\n        yappi.stop()\r\n\r\n        #yappi.get_func_stats().sort('ttot', sort_order=\"desc\").print_all() # All time\r\n\r\n        db_exec_time = yappi.get_func_stats(dict(name=sqlalchemy.engine.base.Engine.execute.__qualname__))\r\n        #db_fetch_time = yappi.get_func_stats(dict(name=sqlalchemy.engine.result.ResultProxy.fetchone.__qualname__))\r\n        pydantic_time = yappi.get_func_stats(dict(name=fastapi.routing.serialize_response.__qualname__))\r\n        render_time = yappi.get_func_stats(dict(name=response.render.__qualname__))\r\n\r\n        server_timing = []\r\n\r\n        if not db_exec_time.empty():\r\n            server_", "source": "bug_issue", "type": "bug_solution", "issue_number": 13}
{"instruction": "How to fix: ApiKey Header documentation", "input": "Hi,\r\n\r\nDo you have some documentation or example regarding configuration for ApiKey (header) and how to verify it on FastAPI ?\r\n\r\nthanks in advance,\r\n\r\nR√©my.", "output": "Hi @meandus - @tiangolo has a full example that includes that functionality:  https://github.com/tiangolo/full-stack-fastapi-postgresql/tree/cd112bd683dcb9017e5f84c0ed3e4974a52e5571/%7B%7Bcookiecutter.project_slug%7D%7D/backend/app/app\r\n\r\nand plenty of tutorial info here: https://fastapi.tiangolo.com/tutorial/security/intro/\r\n\r\nAlso - the Gitter channel is already pretty active for these types of questions: https://gitter.im/tiangolo/fastapi\r\n\r\n\n\nThanks @wshayes for your help here! Much appreciated as always :tada: \r\n\r\n@meandus if you can use OAuth2, that tutorial and the project generator might help. If somehow you explicitly need something different than OAuth2, with some custom APIKeyHeader (as defined in OpenAPI), yes, it is supported, but it is not properly documented yet.\r\n\r\nI suggest you check the security section in the docs shared by William, and after knowing how it works, if you need to explicitly use `APIKeyHeader` instead of OAuth2, you can `from fastapi.security.api_key import APIKeyHeader`.\r\n\r\nAt least while I update the docs with those specifics... :grin: \n\nI found something in the library for apikey and looks good. But for the token (string defined) i dont know what is the best practice for that. Currently i can do a secret.cfg or a json file to store the key and permissions.\n\nI dont know high level of security for this part, thats why im using a apikey in header.\n\nRegards \n\nLe 9 avril 2019 20:42:23 GMT+02:00, \"Sebasti√°n Ram√≠rez\" <notifications@github.com> a √©crit :\n>Thanks @wshayes for your help here! Much appreciated as always :tada: \n>\n>@meandus if you can use OAuth2, that tutorial and the project generator\n>might help. If somehow you explicitly need something different than\n>OAuth2, with some custom APIKeyHeader (as defined in OpenAPI), yes, it\n>is supported, but it is not properly documented yet.\n>\n>I suggest you check the security section in the docs shared by William,\n>and after knowing how it works, if you need to explicitly use\n>`APIKeyHeader` instead of OAuth2, you can `from\n>fastapi.security.api_key import APIKeyHeader`.\n>\n>At least while I update the docs with those specifics... :grin: \n>\n>-- \n>You are receiving this because you were mentioned.\n>Reply to this email directly or view it on GitHub:\n>https://github.com/tiangolo/fastapi/issues/142#issuecomment-481380266\n\n-- \nEnvoy√© de mon appareil Android avec K-9 Mail. Veuillez excuser ma bri√®vet√©.", "source": "bug_issue", "type": "bug_solution", "issue_number": 12}
{"instruction": "How to fix: Korean translations", "input": "### üá∞üá∑ Korean translations (ko)\r\n\r\nI hope to translate the whole docs into Korean.  \r\nThis issue is opened to track the progress of Korean language translation.\r\n\r\nAny suggestion is welcome, and I will appreciate it. üòÉ \r\n\r\n### üìö Glossary\r\nUse [python official Korean glossary](https://docs.python.org/ko/3/glossary.html) for maintaining consistency.\r\n\r\nIf you can't find a proper word in the glossary, you can find it from https://www.flowdas.com/pages/python-docs-ko.html python Korean document maintainer, @flowdas, maintains.\r\n\r\nAlso, use less English as you can. For instance, at [Ï≤´Í±∏Ïùå](https://fastapi.tiangolo.com/ko/tutorial/first-steps/#_7)\r\n\r\n- PUT : Îç∞Ïù¥ÌÑ∞Î•º ~ÏóÖÎç∞Ïù¥Ìä∏~ÏàòÏ†ïÌïòÍ∏∞ ÏúÑÌï¥\r\n\r\nSee https://github.com/tiangolo/fastapi/discussions/3167#discussioncomment-1502428 (Thanks, @0417taehyun)\r\n\r\n### ‚úçüèª Writing style (2020-11-07 added)\r\nÎπÑÍ≤©ÏãùÏ≤¥(Informal)Ïù∏ Ìï¥ÏöîÏ≤¥Î•º ÏßÄÏñëÌïòÍ≥† Í≤©ÏãùÏ≤¥(Formal)Ïù∏ Ìï©ÏáºÏ≤¥Î•º ÏßÄÌñ•Ìï©ÎãàÎã§.\r\n\r\ne.g.\r\n- ~Ïù¥ÏóêÏöî (NOT Recommended)\r\n- ~ÏûÖÎãàÎã§.\r\n\r\n### üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Discussion (2021-05-04 added)\r\nI opened a discussion, https://github.com/tiangolo/fastapi/discussions/3167.\r\nIf you have a suggestion or an idea, please comment on it the discussion.\r\n\r\nOR\r\n\r\nYou can join [FastAPI Discord](https://discord.gg/VQjSZaeJmf) and talk to in `Korean` channel!\r\n\r\n### üéÅ PR Guide\r\nSee https://fastapi.tiangolo.com/contributing/#translations, please.\r\n\r\nYou don't have to get any permission. FastAPI is an open-source project.\r\nAnd I'm not an owner, just a contributor like anyone else.\r\nIf you want to contribute, do it right now!", "output": "Î≤àÏó≠ÏûëÏóÖÏóê Í∏∞Ïó¨ÌïòÍ≥† Ïã∂ÏùÄÎç∞ ÌòπÏãú Í¥ÄÎ†®Îêú ÏÜåÌÜµ Ï±ÑÎÑêÏù¥ ÏûàÏùÑÍπåÏöî?(deployment Î∂ÄÎ∂ÑÎ∂ÄÌÑ∞ Ï∞∏Ïó¨ÌïòÍ≥† Ïã∂ÏäµÎãàÎã§.)\n\n@SangRyul Îî∞Î°ú ÏÜåÌÜµ Ï±ÑÎÑêÏù¥ ÏûàÏßÄ ÏïäÏäµÎãàÎã§. ÏûêÏú†Î°≠Í≤å PR ÎÇ†Î†§Ï£ºÏãúÎ©¥ Îê©ÎãàÎã§.\r\nÏ∂îÌõÑ Ïù∏ÏõêÏù¥ ÎßéÏïÑÏßÄÎ©¥ ÏÉà discussion ÏùÑ ÎßåÎì§Ïñ¥ÏÑú Î≤àÏó≠ ÏûëÏóÖÏù¥ Ï§ëÎ≥µÎêòÏßÄ ÏïäÍ≤å ÌïòÍ±∞ÎÇò Ïö©Ïñ¥ Î≤àÏó≠Îì§Ïóê ÎåÄÌïú ÏùòÍ≤¨ÏùÑ ÎÇòÎàÑÍ≥†Ïûê Ìï©ÎãàÎã§.üòÅ\n\nÎ≤àÏó≠ ÌòëÏóÖÏóê [git Localize](https://gitlocalize.com/) ÎèÑ ÌïúÎ≤à ÏÉùÍ∞ÅÌï¥Î¥êÏ£ºÏãúÎ©¥ Ï¢ãÏùÑÍ≤É Í∞ôÏäµÎãàÎã§. Ï†ÅÎãπÌûà Îñ®Ïñ¥Ï†∏ ÏûàÎäî Î¨∏ÏÑú Ï∞∏Ïó¨Ìï¥Î≥¥Í≤†ÏäµÎãàÎã§!", "source": "bug_issue", "type": "bug_solution", "issue_number": 11}
{"instruction": "How to fix: Gunicorn Workers Hangs And Consumes Memory Forever", "input": "**Describe the bug**\r\nI have deployed FastAPI which queries the database and returns the results. I made sure closing the DB connection and all. I'm running gunicorn with this line ;\r\n`gunicorn -w 8 -k uvicorn.workers.UvicornH11Worker -b 0.0.0.0 app:app --timeout 10`\r\nSo after exposing it to the web, I run a load test which makes 30-40 requests in parallel to the fastapi. And the problem starts here. I'm watching the 'HTOP' in the mean time and I see that RAM usage is always growing, seems like no task is killed after completing it's job. Then I checked the Task numbers, same goes for it too, seems like gunicorn workers do not get killed. After some time RAM usage gets at it's maximum, and starts to throw errors. So I killed the gunicorn app but the thing is processes spawned by main gunicorn proces did not get killed and still using all the memory. \r\n\r\n**Environment:**\r\n - OS:  Ubuntu 18.04\r\n - FastAPI Version : 0.38.1\r\n\r\n- Python version : 3.7.4", "output": "You're using the PyPy compliant uvicorn worker class - is your system based on PyPy? If you're running on cpython then I suggest you try out the cpython implementation `uvicorn.workers.UvicornWorker`.  \r\n\r\nBut in other news, I'm seeing something similar. I just run uvicorn with this:\r\n`uvicorn --host 0.0.0.0 --port 7001 app:api --reload` but in some cases the memory is never freed up.\r\n\r\nFor example this function:\r\n```\r\n@api.post(\"/randompath\")\r\ndef get_xoxo(file: UploadFile = File(...)):\r\n    k = []\r\n    for i in range(10):\r\n        k.append('gab' * 9999999)\r\n```\r\nWhen I hit the endpoint once, the memory is cleared up, but when I hit it 10x, some of the memory is left allocated and when I hit it another 10x, even more memory is left allocated. This continues until I run out of memory or restart the process.\r\nIf I change the `get_xoxo` function to be `async`, then the memory is always cleared up, but the function also blocks much more (which makes sense since I'm not taking advantage of any `await`s in there).\r\n\r\nSo - is there a memory leak? I'm not sure, but something is handled incorrectly.\r\n\r\nMy system is running on `python:3.7` Docker container. Basically the same problem occurs in production where uvicorn is run with `uvicorn --host 0.0.0.0 --port %(ENV_UVICORN_PORT)s --workers %(ENV_UVICORN_WORKERS)s --timeout-keep-alive %(ENV_UVICORN_KEEPELIVE)s --log-level %(ENV_UVICORN_LOGLEVEL)s app:api`.\n\n@wanaryytel \r\n\r\nThis is probably an issue with starlette's `run_in_threadpool`, or maybe even the python ThreadPoolExecutor. If you port that endpoint to starlette, I expect you'll get the same behavior.\r\n\r\nRecently the starlette and uvicorn teams have been pretty good about addressing issues; if you can reproduce the memory leak in starlette, I'd recommend creating an issue demonstrating it in the starlette (and possible uvicorn?) repos.\n\n> You're using the PyPy compliant uvicorn worker class - is your system based on PyPy? If you're running on cpython then I suggest you try out the cpython implementation `uvicorn.workers.UvicornWorker`.\r\n\r\n I have noticed that too, under high load memory is left allocated but for single requests memory gets cleared up. And I already tried it making async but it is not deallocating the memory as well.\r\n\r\n\r\n\r\n> @wanaryytel\r\n> \r\n> This is probably an issue with starlette's `run_in_threadpool`, or maybe even the python ThreadPoolExecutor. If you port that endpoint to starlette, I expect you'll get the same behavior.\r\n> \r\n> Recently the starlette and uvicorn teams have been pretty good about addressing issues; if you can reproduce the memory leak in starlette, I'd recommend creating an issue demonstrating it in the starlette (and possible uvicorn?) repos.\r\n\r\nHmm, reproducing it in Starlette makes sense. I will reproduce the issue and open an issue on Starlette repo. Thanks for the idea", "source": "bug_issue", "type": "bug_solution", "issue_number": 10}
{"instruction": "How to fix: French translations", "input": "# Bonjour üá´üá∑\r\n\r\nWelcome to the issue that coordinates the French translation effort.\r\n\r\n## Purpose \r\n\r\n- Avoiding several people working on the same document at the same time. \r\n\r\nThe first person who declares that he/she is working on a translation gets the responsibility to carry it out. If a PR seems to be stalled, we can discuss a transfer of responsibility here.\r\n\r\n- Enforcing best practices\r\n\r\nBest practices are listed later in this description. You can propose your practice at any time, ideally with a supporting source and an example. \r\n\r\nDefining and sharing best practices will help to avoid common mistakes and will allow faster and easier reviews.\r\n\r\n- Help and build the community\r\n\r\nDo not hesitate to ask any questions regarding the french translation effort here. The stronger the community, the more effective we will be and the more we will enjoy. \r\n\r\n- Provide a french translation for this awesome library (last but not least)\r\n\r\nIf you are here, you probably like **FastAPI**, and maybe you even speak French. Giving more people the opportunity to get started using the documentation in its native language will encourage adoption. In that spirit, let's contribute to the magic of open source in this way.\r\n\r\n## How to contribute\r\n\r\n### Review \r\n\r\nKeep in mind that the easiest way to participate is to review the PRs. We need to avoid accumulating PRs waiting for review.\r\n\r\n### Translate\r\n\r\nIf you are not familiar with contributing to open source projects have a look at https://github.com/firstcontributions/first-contributions.\r\n\r\nIn any case, take a look at the documentation section related to the [contribution](https://fastapi.tiangolo.com/contributing/#development-contributing) and more precisely the part about the [documentation](https://fastapi.tiangolo.com/contributing/#docs).\r\n\r\nOnce you are decided to translate a document, make yourself known here by leaving a message here (eg. https://github.com/tiangolo/fastapi/issues/1972#issuecomment-702956335).\r\n\r\n### Organize\r\n\r\nIf you wish, your energy is welcome to help with the organization. Bringing together motivated people and helping them get the job done is essential. Moreover, we can surely learn a lot from the translation work of other languages that are much more advanced and we can have a significant impact if we put good processes in place that can help the whole community \r\n\r\n## Good practices\r\n\r\n- technical terms \r\n\r\nTechnical terms do not need to be translated. It is also a question of common sense, in certain conditions English can be preferred because the French version is not in use.\r\nSee: https://github.com/tiangolo/fastapi/issues/1972#issuecomment-715500921\r\n\r\n- punctuation and typography\r\n\r\nFor example, missing whitespace before/after punctuation. You can rely on [this page](https://leconjugueur.lefigaro.fr/ukponctuationtypographie.php) to help you.\r\nsee: https://github.com/tiangolo/fastapi/pull/1973#issuecomment-1186304199\r\n\r\n- structure the PR by commit\r\n\r\nSplitting the ", "output": "I'm starting with the `docs/index.md`: https://github.com/tiangolo/fastapi/pull/1973\n\nHello, I would like to help with this but it is the first time I contribute to an open-source project. Could you summarize me the workflow to correctly push the update ?\n\n@Jefidev \n- Post here the page you'll be translating.\n- Work on it.\n- Create the PR with your work.\n- Developers will review.\n- Fix issues/get approvals.\n- Wait for enough approvals (usually 2-3 are enough based on what I've seen).\n- @tiangolo will merge if everything is fine. ", "source": "bug_issue", "type": "bug_solution", "issue_number": 8}
{"instruction": "How to fix: Japanese Translation", "input": "### Tracking Japanese Translation\r\nWe can use this Issue to track the progress of the Japanese language translations.:sunglasses:\r\n\r\nPlease post here what page you plan on translating so we can coordinate. üöÄ\r\n\r\n### Tips\r\n- If the term is a technical term, leave in English and add an explanation of the meaning of the word in Japanese.\r\n- Please unify translations as follows:\r\n\r\nen | ja | Note\r\n-- | -- | --\r\n!!! note | !!! note \"ÂÇôËÄÉ\" | \r\n!!! info | !!! info \"ÊÉÖÂ†±\" | \r\n!!! tip | !!! tip \"Ë±ÜÁü•Ë≠ò\" | \r\n!!! check | !!! check \"Á¢∫Ë™ç\" | \r\npath operation | ¬† | ¬†\r\nvalidation | ¬† | ¬†\r\ncompletion | ¬† | ¬†\r\nautomatic documentation", "output": "@ryuckel Could you fix the title, please?\r\n`[FEATURE]Japanese Transration` -> `[FEATURE] Japanese Translation` \n\n~~Started translations of features.md~~\r\n\r\nfeatures.md translation at PR #1625 ~[needing review][Approved-2]~[merged]\n\ntutorial/index.md translation at PR #1656 ~[needing review][Approved-2]~[merged]\r\ntutorial/first-steps.md translation at PR #1658 ~[needing review][Approved-2]~[merged]\r\ntutorial/path-params.md translation at PR #1671 ~[needing review][Approved-2]~[merged]\r\ntutorial/query-params.md translation at PR #1674 ~[needing review][Approved-2]~[merged]\r\ntutorial/body.md translation at PR #1683 ~[needing review][Approved-2]~[merged]", "source": "bug_issue", "type": "bug_solution", "issue_number": 7}
{"instruction": "How to fix: msgpack response if client asks for application/x-msgpack", "input": "hi,\r\nwe are in the process of evaling fastapi for a large app migration from flask. Quick question on a very interesting and useful piece of functionality. \r\nThis builds upon the validations you have created for encoding json data and will be very useful for us out-of-the-box.\r\n\r\nhttps://msgpack.org/index.html is an enhancement to json which is highly compressed. There are some benchmarks that show it is as fast as protocol buffers...while making it a drop-in alternative to json. \r\n\r\nmsgpack is very important for Asia which are highly internet bandwidth constrained. We are prepared to tradeoff speed in exchange for lesser bandwidth (e.g. http://indiegamr.com/cut-your-data-exchange-traffic-by-up-to-50-with-one-line-of-code-msgpack-vs-json/ )\r\n\r\nTo be fair, it may be same size as gzipped json responses...but after having done android app deployments over a million devices in the field in asia, we realized that one has to write custom compression/decompression for gzipped json response handling. However msgpack has fairly well supported libraries. \r\n\r\nmsgpack is fairly production ready. Lots of downstream python libraries use it in production - https://github.com/0rpc/zerorpc-python\r\n\r\nThis enhancement request is for fastapi to respond in msgpack if the requesting client ask for the mimetype `application/x-msgpack`. The default behavior continues to be the same as currently.\r\n\r\nThere is no impact to any client of a fastapi deployment unless they specifically ask for msgpack (in which case, they will get better performance).\r\n\r\nI'm also pasting some criticisms of msgpack and comparisons with competing/derived json formats like CBOR\r\n\r\n- https://news.ycombinator.com/item?id=14067747\r\n- http://zderadicka.eu/comparison-of-json-like-serializations-json-vs-ubjson-vs-messagepack-vs-cbor/\r\n- https://techtutorialsx.com/2019/06/20/esp32-arduinojson-messagepack-serialization/\r\n- https://gist.github.com/frsyuki/2908191\r\n- https://prataprc.github.io/msgpack-vs-cbor.html", "output": "@sandys \r\nI think fastapi may actually be relatively well suited to handle this now without modifications.\r\n\r\nIf your top priority is just reducing bandwidth usage, I think it should be straightforward to implement converting the json responses to msgpack (in the presence of the appropriate mimetype request) as an ASGI middleware. I imagine that would involve parsing the json and dumping it to msgpack format, so would come with some processing overhead. But that overhead would probably be negligible compared to network, especially if bandwidth is the source of the concern.\r\n\r\nIf you really want to avoid the reparsing, I think this would also be possible by creating a custom starlette response that holds the python dict you want to serialize (rather than encoded json), and adding a middleware that converts responses of that type to a new starlette.Response with msgpack-encoded contents.\r\n\r\nIf you are serious about this and want/need a little more guidance than provided above, I can put together more of a skeleton implementation.\n\nThis might be even easier than I thought.\r\n\r\nI'd suggest taking a look at `starlette.responses.JSONResponse` -- it looks like you could pretty easily create a `MsgpackResponse` by defining an appropriate `render` function (e.g., using `msgpack-python`). Then, you could have your endpoints return `msgpack`-encoded data by setting `response_class=MsgpackResponse`. That wouldn't allow for dynamic determination of the response type based on the request, but maybe there is still a way to achieve that...\r\n\r\n(Certainly, in the worst case, you could just perform a reparsing of the `JSONResponse` in a middleware.)\n\n@sandys\r\nActually, I got interested in this and was able to throw together a working example -- not quite how I expected it would need to go, and it has some hacks that could probably be removed (maybe would require a feature request or two), but it works:\r\n\r\n```python\r\nfrom typing import Any, Dict, List, Type\r\n\r\nimport msgpack\r\nfrom fastapi import FastAPI\r\nfrom fastapi.routing import APIRoute, get_app\r\nfrom starlette.background import BackgroundTask\r\nfrom starlette.requests import Request\r\nfrom starlette.responses import JSONResponse, Response\r\nfrom starlette.routing import request_response\r\nfrom starlette.testclient import TestClient\r\n\r\n\r\nclass MsgpackResponse(Response):\r\n    media_type = \"application/msgpack\"\r\n\r\n    def render(self, content: Any) -> bytes:\r\n        return msgpack.packb(content)\r\n\r\n\r\nclass MultiResponse(JSONResponse):\r\n    serialization_header = \"Accept\"\r\n    default_response_class = JSONResponse\r\n    response_class_map: Dict[str, Type[Response]] = {\"application/x-msgpack\": MsgpackResponse}\r\n\r\n    def __init__(\r\n        self,\r\n        content: Any = None,\r\n        status_code: int = 200,\r\n        headers: dict = None,\r\n        media_type: str = None,\r\n        background: BackgroundTask = None,\r\n    ) -> None:\r\n        self.content = content\r\n        self._status_code = status_code\r\n        self._media_type = media_type\r\n        self._background = background\r\n        self.init_headers(headers)\r\n\r\n    def for_request(self, request: Request) -> Response:\r\n        serialization_method = request.headers.get(self.serialization_header)\r\n        response_class = self.response_class_map.get(\r\n            serialization_method, self.default_response_class\r\n        )\r\n        return response_class(\r\n            content=self.content,\r\n            status_code=self._status_code,\r\n            headers=self.headers,\r\n            media_type=self._media_type,\r\n            background=self._background,\r\n        )\r\n\r\n\r\nclass MultiAPIRoute(APIRoute):\r\n    def __init__(self, *args: Any, **kwargs: Any) -> None:\r\n        if kwargs[\"response_class\"] is JSONResponse:\r\n            kwargs[\"response_class\"] = MultiResponse\r\n        super().__init__(*args, **kwargs)\r\n\r\n        # Copied below from the end of the APIRoute init; overwriting the self.app with a modified version\r\n        base_app_func = get_app(\r\n            dependant=self.dependant,\r\n            body_field=self.body_field,\r\n            status_code=self.status_code,\r\n            response_class=self.response_class,\r\n            response_field=self.secure_cloned_response_field,\r\n            response_model_include=self.response_model_include,\r\n            response_model_exclude=self.response_model_exclude,\r\n            response_model_by_alias=self.response_model_by_alias,\r\n            response_model_skip_defaults=self.response_model_skip_defaults,\r\n            dependency_overrides_provider=self.dependency_overrides_provider,\r\n        )\r\n\r\n        async def app_func(request: Request) -> Response:\r\n            response = await base_app_func(request)\r\n            if isinstance(response, MultiResponse):\r\n                response = response.for_request(request)\r\n            return response\r\n\r\n        self.app = request_response(app_func)\r\n\r\n\r\napp = FastAPI()\r\napp.router.route_class = MultiAPIRoute\r\n\r\n\r\n@app.get(\"/\", response_model=List[int]", "source": "bug_issue", "type": "bug_solution", "issue_number": 6}
{"instruction": "How to fix: üáßüá∑Portuguese translations", "input": "## Portuguese translation tracking  <span>&#x1f1e7;&#x1f1f7;</span>\r\n\r\n### Is your feature request related to a problem\r\n\r\nI want to be able to track chapters that are in progress or already translated. \r\n\r\n### The solution you would like\r\n\r\nEach person who is working in a chapter should notify in this issue.  Comment with the name of the file. If more than two weeks are passed, other people can take this file. \r\n\r\n### Describe alternatives you've considered\r\n\r\nWe can track using our telegram channel `@fastapibr`, but the issue can be easy.\r\n\r\n### Additional context\r\n\r\nThere is no additional context.", "output": "~~Started translations of `index.md`~~\r\n\r\nDue to some personal problems, I am leaving the translation of this file, but I continue to help by reviewing the content of all translations. Good job guys!\r\n\n\n~Started translations of `history-design-future.md`~\r\n\r\n`history-design-future.md` translation at PR #1249 [needing review]\n\n~Started translations of `features.md`~\r\n\r\n`features.md` translation at PR #1248 [needing review]", "source": "bug_issue", "type": "bug_solution", "issue_number": 5}
{"instruction": "How to fix: The memory usage piles up over the time and leads to OOM", "input": "### First check\r\n\r\n* [x] I added a very descriptive title to this issue.\r\n* [x] I used the GitHub search to find a similar issue and didn't find it.\r\n* [x] I searched the FastAPI documentation, with the integrated search.\r\n* [x] I already searched in Google \"How to X in FastAPI\" and didn't find any information.\r\n* [x] I already read and followed all the tutorial in the docs and didn't find an answer.\r\n* [ ] I already checked if it is not related to FastAPI but to [Pydantic](https://github.com/samuelcolvin/pydantic).\r\n* [ ] I already checked if it is not related to FastAPI but to [Swagger UI](https://github.com/swagger-api/swagger-ui).\r\n* [ ] I already checked if it is not related to FastAPI but to [ReDoc](https://github.com/Redocly/redoc).\r\n* [x] After submitting this, I commit to one of:\r\n    * Read open issues with questions until I find 2 issues where I can help someone and add a comment to help there.\r\n    * I already hit the \"watch\" button in this repository to receive notifications and I commit to help at least 2 people that ask questions in the future.\r\n    * Implement a Pull Request for a confirmed bug.\r\n\r\n<!-- \r\n\r\nI'm asking all this because answering questions and solving problems in GitHub issues consumes a lot of time. I end up not being able to add new features, fix bugs, review Pull Requests, etc. as fast as I wish because I have to spend too much time handling issues.\r\n\r\nAll that, on top of all the incredible help provided by a bunch of community members that give a lot of their time to come here and help others.\r\n\r\nThat's a lot of work they are doing, but if more FastAPI users came to help others like them just a little bit more, it would be much less effort for them (and you and me üòÖ).\r\n\r\n-->\r\n\r\n### Example\r\n\r\nHere's a self-contained, [minimal, reproducible, example](https://stackoverflow.com/help/minimal-reproducible-example) with my use case:\r\n\r\n<!-- Replace the code below with your own self-contained, minimal, reproducible, example, if I (or someone) can copy it, run it, and see it right away, there's a much higher chance I (or someone) will be able to help you -->\r\n\r\n```Python\r\nfrom fastapi import FastAPI\r\n\r\napp = FastAPI()\r\n\r\n\r\n@app.get(\"/\")\r\ndef read_root():\r\n    return {\"Hello\": \"World\"}\r\n```\r\n\r\n### Description\r\n\r\n<!-- Replace the content below with your own problem, question, or error -->\r\n\r\n* Open the browser and call the endpoint `/`.\r\n* It returns a JSON with `{\"Hello\": \"World\"}`.\r\n* But I expected it to return `{\"Hello\": \"Sara\"}`.\r\n\r\n### Environment\r\n\r\n* OS: [e.g. Linux / Windows / macOS]:\r\n* FastAPI Version [e.g. 0.3.0]:\r\n\r\nTo know the FastAPI version use:\r\n\r\n```bash\r\npython -c \"import fastapi; print(fastapi.__version__)\"\r\n```\r\n\r\n* Python version:\r\n\r\nTo know the Python version use:\r\n\r\n```bash\r\npython --version\r\n```\r\n\r\n### Additional context\r\n\r\n<!-- Add any other context or screenshots about the question here. -->\r\nTracemalloc gave insight on the lines , that are top consumers of memory: (top one seems to be below lin", "output": "> same issue i faced @prav2019\r\n\r\nAny solution to overcome that @Riki-1mg\r\n\n\nNo @prav2019, \r\nare you using aiohttp as http clients in your service ?\r\nhttps://github.com/tiangolo/fastapi/issues/1623\n\n```python\r\n@app.get(\"/\")\r\ndef read_root():\r\n  return {\"Hello\": \"World\"}\r\n```\r\nSurely the expected behaviour here is to return `{\"Hello\": \"World\"}`?\r\n\r\nIf you want this function to return `{\"Hello\": \"Sara\"}` you'd probably need to do something like:\r\n\r\n```python\r\n@app.get(\"/\")\r\ndef read_root():\r\n  return {\"Hello\": \"Sara\"}\r\n```\r\n\r\nFurther, I can't reproduce your error on my \"machine\" (it's sitting on a cloud somewhere). You can [see the full details here](https://repl.it/repls/ImpoliteLightblueDemos) but everything looks to be working fine.\r\n\r\nI suspect that this is specific to your operating system setup, etc. Would you please provide some more info needed/useful to know in context of how to reproduce the error?\r\n\r\n * How much RAM does your machine have?\r\n * How much memory is each function using (ideally include all the debugging output).\r\nThis wil look something like the below (example from the Python documentation)\r\n```\r\n[ Top 10 ]\r\n<frozen importlib._bootstrap>:716: size=4855 KiB, count=39328, average=126 B\r\n<frozen importlib._bootstrap>:284: size=521 KiB, count=3199, average=167 B\r\n/usr/lib/python3.4/collections/__init__.py:368: size=244 KiB, count=2315, average=108 B\r\n/usr/lib/python3.4/unittest/case.py:381: size=185 KiB, count=779, average=243 B\r\n/usr/lib/python3.4/unittest/case.py:402: size=154 KiB, count=378, average=416 B\r\n/usr/lib/python3.4/abc.py:133: size=88.7 KiB, count=347, average=262 B\r\n<frozen importlib._bootstrap>:1446: size=70.4 KiB, count=911, average=79 B\r\n<frozen importlib._bootstrap>:1454: size=52.0 KiB, count=25, average=2131 B\r\n<string>:5: size=49.7 KiB, count=148, average=344 B\r\n/usr/lib/python3.4/sysconfig.py:411: size=48.0 KiB, count=1, average=48.0 KiB\r\n```\r\n * Does your out-of-memory error include a traceback? Please include that if that's the case.", "source": "bug_issue", "type": "bug_solution", "issue_number": 4}
{"instruction": "How to fix: Spanish translations", "input": "### Spanish translations tracking\r\n\r\nWe can use this Issue to track the progress of the Spanish language translations. ü§ì \r\n\r\nPlease let us know here what page you plan on translating so we can coordinate. üöÄ \r\n\r\n#### Tips\r\n\r\n- We chose to use \"tu\" instead of \"usted\" or \"vos\"\r\n\r\n- If the term is a technical term, leave in English and add an explanation of the meaning of the word in Spanish.  You can do it with a note or an `abbr` element. This should help us avoid confusion with confusing Spanish translations, for example using \"instancia\" for \"instance\". \r\n\r\nThank you for your help! Gracias por tu ayuda! üéâ", "output": "I'm currently translating the Features page. \r\n\r\nhttps://fastapi.tiangolo.com/es/features/\r\n\r\n---\r\n\r\nThis translation is done and up for review: #1220  üöÄ \n\nGreat\r\nCount on me.\r\nLet me grasp the procedure\n\nI'm currently translating the Python Type Intro page.\r\n\r\nhttps://fastapi.tiangolo.com/python-types/\r\n\r\n---\r\n\r\nThis translation is done and up for review: #1237  üöÄ ", "source": "bug_issue", "type": "bug_solution", "issue_number": 3}
{"instruction": "How to fix: CORSMiddleware not work", "input": "Hi,\r\nI searched the FastAPI documentation( https://fastapi.tiangolo.com/tutorial/cors/). But get errors:\r\nAccess to XMLHttpRequest at \"http://127.0.0.1:8086/api\" from origin \"http://www.example.com\" has been blocked by CORS policy:Response to preflight request doesn't pass access control check:No 'Access-Control-Allow-Origin' header is present on the requeste resource.\r\n\r\n\"http://127.0.0.1:8086/api\" and \"http://www.example.com\" are in same pc.\r\n\r\nfrom fastapi import FastAPI\r\nfrom starlette.middleware.cors import CORSMiddleware\r\n\r\napp = FastAPI()\r\napp.add_middleware(\r\n    CORSMiddleware,\r\n    allow_origins=[\"*\"],      \r\n    allow_credentials=True,\r\n    allow_methods=[\"*\"], \r\n    allow_headers=[\"*\"],\r\n)", "output": "How do you make the request? Could you use the web devtools to see how the request look like (with HTTP headers)?\r\n\r\nAlso you may want to follow the issue template.\n\n> How do you make the request? Could you use the web devtools to see how the request look like (with HTTP headers)?\r\n> \r\n> Also you may want to follow the issue template.\r\n\r\nvar apiUrl = \"http://127.0.0.1:8086/api\"; \r\nvar data-from = {  };\r\n$.ajax({\r\n        url: apiUrl,\r\n        type: 'POST',\r\n        data: JSON.stringify(data-from),\r\n        contentType: 'application/json;charset=utf-8',\r\n        dataType: 'json',                 \r\n        cache: false,\r\n        crossDomain: true,\r\n        async: true,\r\n       success: function (data) {\r\n               alert(JSON.stringify(data));                       \r\n       },\r\n       error: function (data, err) {\r\n             alert(\"fail \" + JSON.stringify(data) + \" \" + JSON.stringify(err));\r\n       }\r\n});\r\n\r\nClient:\r\nAccept: */*\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: zh-CN,zh;q=0.9\r\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.97 Safari/537.36\r\nAccess-Control-Request-Headers: content-type\r\nAccess-Control-Request-Method: POST\r\n\r\nResponse:\r\nHTTP/1.1 502 Fiddler\r\n\n\nYou should add `CORSMiddleware` like this:\r\n\r\n```python\r\napp.add_middleware(\r\nCORSMiddleware,\r\nallow_origins=[\"*\"], # Allows all origins\r\nallow_credentials=True,\r\nallow_methods=[\"*\"], # Allows all methods\r\nallow_headers=[\"*\"], # Allows all headers\r\n)\r\n```", "source": "bug_issue", "type": "bug_solution", "issue_number": 2}
{"instruction": "How to fix: Chineses translations", "input": "## Chinese translation tracking\r\n\r\n### Is your feature request related to a problem\r\n\r\nIs your feature request related to a problem?\r\n\r\nI want to be able to track chapters that are in progress or already translated.\r\n\r\n### The solution you would like\r\n\r\nEach person who is working in a chapter should notify in this issue. Comment with the name of the file. If more than two weeks are passed, other people can take this file.\r\n\r\n### Describe alternatives you've considered\r\n\r\nWe use notion to distribution chapter and tracking translating  sate.\r\nIf you want join our, you can contact with us.  @waynerv @RunningIkkyu \r\n\r\n### Additional context\r\nIt ‚Äôs okay to talk about this in this issue.", "output": "Add Chinese translation for tutorial/cookie-params.md. https://github.com/tiangolo/fastapi/pull/2261 \n\nAdd chinese translate for tutorial-middleware. #2334 \n\nchinese translate python-types.md Add `Generic types` Fix `Optional` #2360", "source": "bug_issue", "type": "bug_solution", "issue_number": 1}
